import{R as m,T as Hs,G as zs,H as qs,J as Bs,K as Vs,r as d,O as Ks,j as e}from"./vendor-ui-DJQMR4VV.js";import{b as as,u as Be,c as at,d as Us}from"./vendor-query-BT4y-huw.js";import{c as zt,a as Se,f as qt,D as ot,B as Y,C as Ve,g as vt,h as Bt,l as is,i as pt,L as Ge,p as Ws,X as xt,q as Qs,d as ye,I as Mt,u as Ys,S as Ne}from"./index-Dyae1WSo.js";import{S as At}from"./switch-DpomWc6Y.js";import{T as Xs,a as Gs,b as Qt,c as Yt}from"./tabs-rO4tL8ZK.js";import{B as it}from"./badge-AL0P0Psw.js";import{S as It,a as Ot,b as $t,c as Pt,d as Js}from"./sheet-CeCwUoeE.js";import{A as os,a as ls,b as cs,c as ds,d as us,e as ms,f as fs,g as hs,P as Zs}from"./alert-dialog-CsqA_DN1.js";import{B as ps,C as yt,I as en}from"./BottomActionBar-YY3wSWBc.js";import{c as tt}from"./design-tokens-CGMys_0P.js";import{L as tn}from"./loader-circle-BdxmrW54.js";import{C as sn}from"./circle-check-DoWuUKc-.js";import{S as nn}from"./sticky-note-CFcgp204.js";import{C as Xt}from"./check-C_sojMmi.js";import{T as rn}from"./timer-BBSE03PN.js";import{m as Lt,s as an,l as on,f as ln}from"./animations-BTr26p-C.js";import{S as cn}from"./search-BdFXoBi_.js";import{f as bt}from"./fr-CqUxEDd2.js";import{f as wt}from"./vendor-date-cQbdWov0.js";import{C as xs}from"./chevron-left-Yt11NKF_.js";import{S as dn,a as un,b as mn,c as fn,d as mt}from"./select-D6RXW32l.js";import{C as hn}from"./circle-alert-CJjyTAV2.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-Db4xOvcx.js";import"./vendor-supabase-D7B1G6YZ.js";import"./chevron-up-DYGqpyYs.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pn=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],xn=zt("calendar",pn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gn=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],vn=zt("pause",gn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yn=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],bn=zt("sliders-horizontal",yn);function wn(t){if(typeof document>"u")return;let s=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",s.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}const gs=m.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),lt=()=>{const t=m.useContext(gs);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};wn(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}`);function jn(){const t=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(t)&&/Mobile/.test(t)||/FxiOS/.test(t))}function Nn(){return Vt(/^Mac/)}function Sn(){return Vt(/^iPhone/)}function Gt(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function _n(){return Vt(/^iPad/)||Nn()&&navigator.maxTouchPoints>1}function vs(){return Sn()||_n()}function Vt(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const Cn=24,Rn=typeof window<"u"?d.useLayoutEffect:d.useEffect;function Jt(...t){return(...s)=>{for(let n of t)typeof n=="function"&&n(...s)}}const Ct=typeof document<"u"&&window.visualViewport;function Zt(t){let s=window.getComputedStyle(t);return/(auto|scroll)/.test(s.overflow+s.overflowX+s.overflowY)}function ys(t){for(Zt(t)&&(t=t.parentElement);t&&!Zt(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const En=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let ft=0,Rt;function kn(t={}){let{isDisabled:s}=t;Rn(()=>{if(!s)return ft++,ft===1&&vs()&&(Rt=Tn()),()=>{ft--,ft===0&&Rt?.()}},[s])}function Tn(){let t,s=0,n=i=>{t=ys(i.target),!(t===document.documentElement&&t===document.body)&&(s=i.changedTouches[0].pageY)},r=i=>{if(!t||t===document.documentElement||t===document.body){i.preventDefault();return}let v=i.changedTouches[0].pageY,E=t.scrollTop,$=t.scrollHeight-t.clientHeight;$!==0&&((E<=0&&v>s||E>=$&&v<s)&&i.preventDefault(),s=v)},l=i=>{let v=i.target;Ft(v)&&v!==document.activeElement&&(i.preventDefault(),v.style.transform="translateY(-2000px)",v.focus(),requestAnimationFrame(()=>{v.style.transform=""}))},o=i=>{let v=i.target;Ft(v)&&(v.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{v.style.transform="",Ct&&(Ct.height<window.innerHeight?requestAnimationFrame(()=>{es(v)}):Ct.addEventListener("resize",()=>es(v),{once:!0}))}))},p=()=>{window.scrollTo(0,0)},f=window.pageXOffset,x=window.pageYOffset,_=Jt(Dn(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let h=Jt(st(document,"touchstart",n,{passive:!1,capture:!0}),st(document,"touchmove",r,{passive:!1,capture:!0}),st(document,"touchend",l,{passive:!1,capture:!0}),st(document,"focus",o,!0),st(window,"scroll",p));return()=>{_(),h(),window.scrollTo(f,x)}}function Dn(t,s,n){let r=t.style[s];return t.style[s]=n,()=>{t.style[s]=r}}function st(t,s,n,r){return t.addEventListener(s,n,r),()=>{t.removeEventListener(s,n,r)}}function es(t){let s=document.scrollingElement||document.documentElement;for(;t&&t!==s;){let n=ys(t);if(n!==document.documentElement&&n!==document.body&&n!==t){let r=n.getBoundingClientRect().top,l=t.getBoundingClientRect().top,o=t.getBoundingClientRect().bottom;const p=n.getBoundingClientRect().bottom+Cn;o>p&&(n.scrollTop+=l-r)}t=n.parentElement}}function Ft(t){return t instanceof HTMLInputElement&&!En.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function Mn(t,s){typeof t=="function"?t(s):t!=null&&(t.current=s)}function An(...t){return s=>t.forEach(n=>Mn(n,s))}function bs(...t){return d.useCallback(An(...t),t)}const ws=new WeakMap;function ce(t,s,n=!1){if(!t||!(t instanceof HTMLElement))return;let r={};Object.entries(s).forEach(([l,o])=>{if(l.startsWith("--")){t.style.setProperty(l,o);return}r[l]=t.style[l],t.style[l]=o}),!n&&ws.set(t,r)}function In(t,s){if(!t||!(t instanceof HTMLElement))return;let n=ws.get(t);n&&(t.style[s]=n[s])}const le=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function ht(t,s){if(!t)return null;const n=window.getComputedStyle(t),r=n.transform||n.webkitTransform||n.mozTransform;let l=r.match(/^matrix3d\((.+)\)$/);return l?parseFloat(l[1].split(", ")[le(s)?13:12]):(l=r.match(/^matrix\((.+)\)$/),l?parseFloat(l[1].split(", ")[le(s)?5:4]):null)}function On(t){return 8*(Math.log(t+1)-2)}function Et(t,s){if(!t)return()=>{};const n=t.style.cssText;return Object.assign(t.style,s),()=>{t.style.cssText=n}}function $n(...t){return(...s)=>{for(const n of t)typeof n=="function"&&n(...s)}}const ne={DURATION:.5,EASE:[.32,.72,0,1]},js=.4,Pn=.25,Ln=100,Ns=8,Ue=16,Ht=26,kt="vaul-dragging";function Ss(t){const s=m.useRef(t);return m.useEffect(()=>{s.current=t}),m.useMemo(()=>(...n)=>s.current==null?void 0:s.current.call(s,...n),[])}function Fn({defaultProp:t,onChange:s}){const n=m.useState(t),[r]=n,l=m.useRef(r),o=Ss(s);return m.useEffect(()=>{l.current!==r&&(o(r),l.current=r)},[r,l,o]),n}function _s({prop:t,defaultProp:s,onChange:n=()=>{}}){const[r,l]=Fn({defaultProp:s,onChange:n}),o=t!==void 0,p=o?t:r,f=Ss(n),x=m.useCallback(_=>{if(o){const i=typeof _=="function"?_(t):_;i!==t&&f(i)}else l(_)},[o,t,l,f]);return[p,x]}function Hn({activeSnapPointProp:t,setActiveSnapPointProp:s,snapPoints:n,drawerRef:r,overlayRef:l,fadeFromIndex:o,onSnapPointChange:p,direction:f="bottom",container:x,snapToSequentialPoint:_}){const[h,i]=_s({prop:t,defaultProp:n?.[0],onChange:s}),[v,E]=m.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);m.useEffect(()=>{function w(){E({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",w),()=>window.removeEventListener("resize",w)},[]);const $=m.useMemo(()=>h===n?.[n.length-1]||null,[n,h]),D=m.useMemo(()=>{var w;return(w=n?.findIndex(A=>A===h))!=null?w:null},[n,h]),H=n&&n.length>0&&(o||o===0)&&!Number.isNaN(o)&&n[o]===h||!n,N=m.useMemo(()=>{const w=x?{width:x.getBoundingClientRect().width,height:x.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var A;return(A=n?.map(O=>{const k=typeof O=="string";let b=0;if(k&&(b=parseInt(O,10)),le(f)){const y=k?b:v?O*w.height:0;return v?f==="bottom"?w.height-y:-w.height+y:y}const K=k?b:v?O*w.width:0;return v?f==="right"?w.width-K:-w.width+K:K}))!=null?A:[]},[n,v,x]),M=m.useMemo(()=>D!==null?N?.[D]:null,[N,D]),P=m.useCallback(w=>{var A;const O=(A=N?.findIndex(k=>k===w))!=null?A:null;p(O),ce(r.current,{transition:`transform ${ne.DURATION}s cubic-bezier(${ne.EASE.join(",")})`,transform:le(f)?`translate3d(0, ${w}px, 0)`:`translate3d(${w}px, 0, 0)`}),N&&O!==N.length-1&&o!==void 0&&O!==o&&O<o?ce(l.current,{transition:`opacity ${ne.DURATION}s cubic-bezier(${ne.EASE.join(",")})`,opacity:"0"}):ce(l.current,{transition:`opacity ${ne.DURATION}s cubic-bezier(${ne.EASE.join(",")})`,opacity:"1"}),i(n?.[Math.max(O,0)])},[r.current,n,N,o,l,i]);m.useEffect(()=>{if(h||t){var w;const A=(w=n?.findIndex(O=>O===t||O===h))!=null?w:-1;N&&A!==-1&&typeof N[A]=="number"&&P(N[A])}},[h,t,n,N,P]);function g({draggedDistance:w,closeDrawer:A,velocity:O,dismissible:k}){if(o===void 0)return;const b=f==="bottom"||f==="right"?(M??0)-w:(M??0)+w,K=D===o-1,y=D===0,ee=w>0;if(K&&ce(l.current,{transition:`opacity ${ne.DURATION}s cubic-bezier(${ne.EASE.join(",")})`}),!_&&O>2&&!ee){k?A():P(N[0]);return}if(!_&&O>2&&ee&&N&&n){P(N[n.length-1]);return}const L=N?.reduce((B,Z)=>typeof B!="number"||typeof Z!="number"?B:Math.abs(Z-b)<Math.abs(B-b)?Z:B),X=le(f)?window.innerHeight:window.innerWidth;if(O>js&&Math.abs(w)<X*.4){const B=ee?1:-1;if(B>0&&$&&n){P(N[n.length-1]);return}if(y&&B<0&&k&&A(),D===null)return;P(N[D+B]);return}P(L)}function U({draggedDistance:w}){if(M===null)return;const A=f==="bottom"||f==="right"?M-w:M+w;(f==="bottom"||f==="right")&&A<N[N.length-1]||(f==="top"||f==="left")&&A>N[N.length-1]||ce(r.current,{transform:le(f)?`translate3d(0, ${A}px, 0)`:`translate3d(${A}px, 0, 0)`})}function W(w,A){if(!n||typeof D!="number"||!N||o===void 0)return null;const O=D===o-1;if(D>=o&&A)return 0;if(O&&!A)return 1;if(!H&&!O)return null;const b=O?D+1:D-1,K=O?N[b]-N[b-1]:N[b+1]-N[b],y=w/Math.abs(K);return O?1-y:y}return{isLastSnapPoint:$,activeSnapPoint:h,shouldFade:H,getPercentageDragged:W,setActiveSnapPoint:i,activeSnapPointIndex:D,onRelease:g,onDrag:U,snapPointsOffset:N}}const zn=()=>()=>{};function qn(){const{direction:t,isOpen:s,shouldScaleBackground:n,setBackgroundColorOnScale:r,noBodyStyles:l}=lt(),o=m.useRef(null),p=d.useMemo(()=>document.body.style.backgroundColor,[]);function f(){return(window.innerWidth-Ht)/window.innerWidth}m.useEffect(()=>{if(s&&n){o.current&&clearTimeout(o.current);const x=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!x)return;$n(r&&!l?Et(document.body,{background:"black"}):zn,Et(x,{transformOrigin:le(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${ne.DURATION}s`,transitionTimingFunction:`cubic-bezier(${ne.EASE.join(",")})`}));const _=Et(x,{borderRadius:`${Ns}px`,overflow:"hidden",...le(t)?{transform:`scale(${f()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${f()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{_(),o.current=window.setTimeout(()=>{p?document.body.style.background=p:document.body.style.removeProperty("background")},ne.DURATION*1e3)}}},[s,n,p])}let nt=null;function Bn({isOpen:t,modal:s,nested:n,hasBeenOpened:r,preventScrollRestoration:l,noBodyStyles:o}){const[p,f]=m.useState(()=>typeof window<"u"?window.location.href:""),x=m.useRef(0),_=m.useCallback(()=>{if(Gt()&&nt===null&&t&&!o){nt={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:i,innerHeight:v}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-x.current}px`,left:`${-i}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const E=v-window.innerHeight;E&&x.current>=v&&(document.body.style.top=`${-(x.current+E)}px`)}),300)}},[t]),h=m.useCallback(()=>{if(Gt()&&nt!==null&&!o){const i=-parseInt(document.body.style.top,10),v=-parseInt(document.body.style.left,10);Object.assign(document.body.style,nt),window.requestAnimationFrame(()=>{if(l&&p!==window.location.href){f(window.location.href);return}window.scrollTo(v,i)}),nt=null}},[p]);return m.useEffect(()=>{function i(){x.current=window.scrollY}return i(),window.addEventListener("scroll",i),()=>{window.removeEventListener("scroll",i)}},[]),m.useEffect(()=>{if(s)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||h()}},[s,h]),m.useEffect(()=>{n||!r||(t?(!window.matchMedia("(display-mode: standalone)").matches&&_(),s||window.setTimeout(()=>{h()},500)):h())},[t,r,p,s,n,_,h]),{restorePositionSetting:h}}function Vn({open:t,onOpenChange:s,children:n,onDrag:r,onRelease:l,snapPoints:o,shouldScaleBackground:p=!1,setBackgroundColorOnScale:f=!0,closeThreshold:x=Pn,scrollLockTimeout:_=Ln,dismissible:h=!0,handleOnly:i=!1,fadeFromIndex:v=o&&o.length-1,activeSnapPoint:E,setActiveSnapPoint:$,fixed:D,modal:H=!0,onClose:N,nested:M,noBodyStyles:P=!1,direction:g="bottom",defaultOpen:U=!1,disablePreventScroll:W=!0,snapToSequentialPoint:w=!1,preventScrollRestoration:A=!1,repositionInputs:O=!0,onAnimationEnd:k,container:b,autoFocus:K=!1}){var y,ee;const[L=!1,X]=_s({defaultProp:U,prop:t,onChange:S=>{s?.(S),!S&&!M&&u(),setTimeout(()=>{k?.(S)},ne.DURATION*1e3),S&&!H&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),S||(document.body.style.pointerEvents="auto")}}),[B,Z]=m.useState(!1),[fe,Ce]=m.useState(!1),[ue,Fe]=m.useState(!1),c=m.useRef(null),G=m.useRef(null),re=m.useRef(null),oe=m.useRef(null),te=m.useRef(null),me=m.useRef(!1),V=m.useRef(null),Re=m.useRef(0),Te=m.useRef(!1),He=m.useRef(!U),Ke=m.useRef(0),C=m.useRef(null),xe=m.useRef(((y=C.current)==null?void 0:y.getBoundingClientRect().height)||0),De=m.useRef(((ee=C.current)==null?void 0:ee.getBoundingClientRect().width)||0),be=m.useRef(0),we=m.useCallback(S=>{o&&S===Me.length-1&&(G.current=new Date)},[]),{activeSnapPoint:Je,activeSnapPointIndex:pe,setActiveSnapPoint:ze,onRelease:qe,snapPointsOffset:Me,onDrag:We,shouldFade:Qe,getPercentageDragged:Ye}=Hn({snapPoints:o,activeSnapPointProp:E,setActiveSnapPointProp:$,drawerRef:C,fadeFromIndex:v,overlayRef:c,onSnapPointChange:we,direction:g,container:b,snapToSequentialPoint:w});kn({isDisabled:!L||fe||!H||ue||!B||!O||!W});const{restorePositionSetting:u}=Bn({isOpen:L,modal:H,nested:M??!1,hasBeenOpened:B,preventScrollRestoration:A,noBodyStyles:P});function j(){return(window.innerWidth-Ht)/window.innerWidth}function de(S){var z,Q;!h&&!o||C.current&&!C.current.contains(S.target)||(xe.current=((z=C.current)==null?void 0:z.getBoundingClientRect().height)||0,De.current=((Q=C.current)==null?void 0:Q.getBoundingClientRect().width)||0,Ce(!0),re.current=new Date,vs()&&window.addEventListener("touchend",()=>me.current=!1,{once:!0}),S.target.setPointerCapture(S.pointerId),Re.current=le(g)?S.pageY:S.pageX)}function he(S,z){var Q;let F=S;const q=(Q=window.getSelection())==null?void 0:Q.toString(),J=C.current?ht(C.current,g):null,ae=new Date;if(F.tagName==="SELECT"||F.hasAttribute("data-vaul-no-drag")||F.closest("[data-vaul-no-drag]"))return!1;if(g==="right"||g==="left")return!0;if(G.current&&ae.getTime()-G.current.getTime()<500)return!1;if(J!==null&&(g==="bottom"?J>0:J<0))return!0;if(q&&q.length>0)return!1;if(te.current&&ae.getTime()-te.current.getTime()<_&&J===0||z)return te.current=ae,!1;for(;F;){if(F.scrollHeight>F.clientHeight){if(F.scrollTop!==0)return te.current=new Date,!1;if(F.getAttribute("role")==="dialog")return!0}F=F.parentNode}return!0}function se(S){if(C.current&&fe){const z=g==="bottom"||g==="right"?1:-1,Q=(Re.current-(le(g)?S.pageY:S.pageX))*z,F=Q>0,q=o&&!h&&!F;if(q&&pe===0)return;const J=Math.abs(Q),ae=document.querySelector("[data-vaul-drawer-wrapper]"),Ee=g==="bottom"||g==="top"?xe.current:De.current;let ve=J/Ee;const ke=Ye(J,F);if(ke!==null&&(ve=ke),q&&ve>=1||!me.current&&!he(S.target,F))return;if(C.current.classList.add(kt),me.current=!0,ce(C.current,{transition:"none"}),ce(c.current,{transition:"none"}),o&&We({draggedDistance:Q}),F&&!o){const _e=On(Q),Xe=Math.min(_e*-1,0)*z;ce(C.current,{transform:le(g)?`translate3d(0, ${Xe}px, 0)`:`translate3d(${Xe}px, 0, 0)`});return}const Ae=1-ve;if((Qe||v&&pe===v-1)&&(r?.(S,ve),ce(c.current,{opacity:`${Ae}`,transition:"none"},!0)),ae&&c.current&&p){const _e=Math.min(j()+ve*(1-j()),1),Xe=8-ve*8,Ze=Math.max(0,14-ve*14);ce(ae,{borderRadius:`${Xe}px`,transform:le(g)?`scale(${_e}) translate3d(0, ${Ze}px, 0)`:`scale(${_e}) translate3d(${Ze}px, 0, 0)`,transition:"none"},!0)}if(!o){const _e=J*z;ce(C.current,{transform:le(g)?`translate3d(0, ${_e}px, 0)`:`translate3d(${_e}px, 0, 0)`})}}}m.useEffect(()=>{window.requestAnimationFrame(()=>{He.current=!0})},[]),m.useEffect(()=>{var S;function z(){if(!C.current||!O)return;const Q=document.activeElement;if(Ft(Q)||Te.current){var F;const q=((F=window.visualViewport)==null?void 0:F.height)||0,J=window.innerHeight;let ae=J-q;const Ee=C.current.getBoundingClientRect().height||0,ve=Ee>J*.8;be.current||(be.current=Ee);const ke=C.current.getBoundingClientRect().top;if(Math.abs(Ke.current-ae)>60&&(Te.current=!Te.current),o&&o.length>0&&Me&&pe){const Ae=Me[pe]||0;ae+=Ae}if(Ke.current=ae,Ee>q||Te.current){const Ae=C.current.getBoundingClientRect().height;let _e=Ae;Ae>q&&(_e=q-(ve?ke:Ht)),D?C.current.style.height=`${Ae-Math.max(ae,0)}px`:C.current.style.height=`${Math.max(_e,q-ke)}px`}else jn()||(C.current.style.height=`${be.current}px`);o&&o.length>0&&!Te.current?C.current.style.bottom="0px":C.current.style.bottom=`${Math.max(ae,0)}px`}}return(S=window.visualViewport)==null||S.addEventListener("resize",z),()=>{var Q;return(Q=window.visualViewport)==null?void 0:Q.removeEventListener("resize",z)}},[pe,o,Me]);function je(S){ge(),N?.(),S||X(!1),setTimeout(()=>{o&&ze(o[0])},ne.DURATION*1e3)}function I(){if(!C.current)return;const S=document.querySelector("[data-vaul-drawer-wrapper]"),z=ht(C.current,g);ce(C.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${ne.DURATION}s cubic-bezier(${ne.EASE.join(",")})`}),ce(c.current,{transition:`opacity ${ne.DURATION}s cubic-bezier(${ne.EASE.join(",")})`,opacity:"1"}),p&&z&&z>0&&L&&ce(S,{borderRadius:`${Ns}px`,overflow:"hidden",...le(g)?{transform:`scale(${j()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${j()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${ne.DURATION}s`,transitionTimingFunction:`cubic-bezier(${ne.EASE.join(",")})`},!0)}function ge(){!fe||!C.current||(C.current.classList.remove(kt),me.current=!1,Ce(!1),oe.current=new Date)}function ct(S){if(!fe||!C.current)return;C.current.classList.remove(kt),me.current=!1,Ce(!1),oe.current=new Date;const z=ht(C.current,g);if(!S||!he(S.target,!1)||!z||Number.isNaN(z)||re.current===null)return;const Q=oe.current.getTime()-re.current.getTime(),F=Re.current-(le(g)?S.pageY:S.pageX),q=Math.abs(F)/Q;if(q>.05&&(Fe(!0),setTimeout(()=>{Fe(!1)},200)),o){qe({draggedDistance:F*(g==="bottom"||g==="right"?1:-1),closeDrawer:je,velocity:q,dismissible:h}),l?.(S,!0);return}if(g==="bottom"||g==="right"?F>0:F<0){I(),l?.(S,!0);return}if(q>js){je(),l?.(S,!1);return}var J;const ae=Math.min((J=C.current.getBoundingClientRect().height)!=null?J:0,window.innerHeight);var Ee;const ve=Math.min((Ee=C.current.getBoundingClientRect().width)!=null?Ee:0,window.innerWidth),ke=g==="left"||g==="right";if(Math.abs(z)>=(ke?ve:ae)*x){je(),l?.(S,!1);return}l?.(S,!0),I()}m.useEffect(()=>(L&&(ce(document.documentElement,{scrollBehavior:"auto"}),G.current=new Date),()=>{In(document.documentElement,"scrollBehavior")}),[L]);function jt(S){const z=S?(window.innerWidth-Ue)/window.innerWidth:1,Q=S?-Ue:0;V.current&&window.clearTimeout(V.current),ce(C.current,{transition:`transform ${ne.DURATION}s cubic-bezier(${ne.EASE.join(",")})`,transform:le(g)?`scale(${z}) translate3d(0, ${Q}px, 0)`:`scale(${z}) translate3d(${Q}px, 0, 0)`}),!S&&C.current&&(V.current=setTimeout(()=>{const F=ht(C.current,g);ce(C.current,{transition:"none",transform:le(g)?`translate3d(0, ${F}px, 0)`:`translate3d(${F}px, 0, 0)`})},500))}function dt(S,z){if(z<0)return;const Q=(window.innerWidth-Ue)/window.innerWidth,F=Q+z*(1-Q),q=-Ue+z*Ue;ce(C.current,{transform:le(g)?`scale(${F}) translate3d(0, ${q}px, 0)`:`scale(${F}) translate3d(${q}px, 0, 0)`,transition:"none"})}function Ie(S,z){const Q=le(g)?window.innerHeight:window.innerWidth,F=z?(Q-Ue)/Q:1,q=z?-Ue:0;z&&ce(C.current,{transition:`transform ${ne.DURATION}s cubic-bezier(${ne.EASE.join(",")})`,transform:le(g)?`scale(${F}) translate3d(0, ${q}px, 0)`:`scale(${F}) translate3d(${q}px, 0, 0)`})}return m.useEffect(()=>{H||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[H]),m.createElement(qs,{defaultOpen:U,onOpenChange:S=>{!h&&!S||(S?Z(!0):je(!0),X(S))},open:L},m.createElement(gs.Provider,{value:{activeSnapPoint:Je,snapPoints:o,setActiveSnapPoint:ze,drawerRef:C,overlayRef:c,onOpenChange:s,onPress:de,onRelease:ct,onDrag:se,dismissible:h,shouldAnimate:He,handleOnly:i,isOpen:L,isDragging:fe,shouldFade:Qe,closeDrawer:je,onNestedDrag:dt,onNestedOpenChange:jt,onNestedRelease:Ie,keyboardIsOpen:Te,modal:H,snapPointsOffset:Me,activeSnapPointIndex:pe,direction:g,shouldScaleBackground:p,setBackgroundColorOnScale:f,noBodyStyles:P,container:b,autoFocus:K}},n))}const Cs=m.forwardRef(function({...t},s){const{overlayRef:n,snapPoints:r,onRelease:l,shouldFade:o,isOpen:p,modal:f,shouldAnimate:x}=lt(),_=bs(s,n),h=r&&r.length>0;if(!f)return null;const i=m.useCallback(v=>l(v),[l]);return m.createElement(Ks,{onMouseUp:i,ref:_,"data-vaul-overlay":"","data-vaul-snap-points":p&&h?"true":"false","data-vaul-snap-points-overlay":p&&o?"true":"false","data-vaul-animate":x?.current?"true":"false",...t})});Cs.displayName="Drawer.Overlay";const Rs=m.forwardRef(function({onPointerDownOutside:t,style:s,onOpenAutoFocus:n,...r},l){const{drawerRef:o,onPress:p,onRelease:f,onDrag:x,keyboardIsOpen:_,snapPointsOffset:h,activeSnapPointIndex:i,modal:v,isOpen:E,direction:$,snapPoints:D,container:H,handleOnly:N,shouldAnimate:M,autoFocus:P}=lt(),[g,U]=m.useState(!1),W=bs(l,o),w=m.useRef(null),A=m.useRef(null),O=m.useRef(!1),k=D&&D.length>0;qn();const b=(y,ee,L=0)=>{if(O.current)return!0;const X=Math.abs(y.y),B=Math.abs(y.x),Z=B>X,fe=["bottom","right"].includes(ee)?1:-1;if(ee==="left"||ee==="right"){if(!(y.x*fe<0)&&B>=0&&B<=L)return Z}else if(!(y.y*fe<0)&&X>=0&&X<=L)return!Z;return O.current=!0,!0};m.useEffect(()=>{k&&window.requestAnimationFrame(()=>{U(!0)})},[]);function K(y){w.current=null,O.current=!1,f(y)}return m.createElement(Vs,{"data-vaul-drawer-direction":$,"data-vaul-drawer":"","data-vaul-delayed-snap-points":g?"true":"false","data-vaul-snap-points":E&&k?"true":"false","data-vaul-custom-container":H?"true":"false","data-vaul-animate":M?.current?"true":"false",...r,ref:W,style:h&&h.length>0?{"--snap-point-height":`${h[i??0]}px`,...s}:s,onPointerDown:y=>{N||(r.onPointerDown==null||r.onPointerDown.call(r,y),w.current={x:y.pageX,y:y.pageY},p(y))},onOpenAutoFocus:y=>{n?.(y),P||y.preventDefault()},onPointerDownOutside:y=>{if(t?.(y),!v||y.defaultPrevented){y.preventDefault();return}_.current&&(_.current=!1)},onFocusOutside:y=>{if(!v){y.preventDefault();return}},onPointerMove:y=>{if(A.current=y,N||(r.onPointerMove==null||r.onPointerMove.call(r,y),!w.current))return;const ee=y.pageY-w.current.y,L=y.pageX-w.current.x,X=y.pointerType==="touch"?10:2;b({x:L,y:ee},$,X)?x(y):(Math.abs(L)>X||Math.abs(ee)>X)&&(w.current=null)},onPointerUp:y=>{r.onPointerUp==null||r.onPointerUp.call(r,y),w.current=null,O.current=!1,f(y)},onPointerOut:y=>{r.onPointerOut==null||r.onPointerOut.call(r,y),K(A.current)},onContextMenu:y=>{r.onContextMenu==null||r.onContextMenu.call(r,y),A.current&&K(A.current)}})});Rs.displayName="Drawer.Content";const Kn=250,Un=120,Wn=m.forwardRef(function({preventCycle:t=!1,children:s,...n},r){const{closeDrawer:l,isDragging:o,snapPoints:p,activeSnapPoint:f,setActiveSnapPoint:x,dismissible:_,handleOnly:h,isOpen:i,onPress:v,onDrag:E}=lt(),$=m.useRef(null),D=m.useRef(!1);function H(){if(D.current){P();return}window.setTimeout(()=>{N()},Un)}function N(){if(o||t||D.current){P();return}if(P(),!p||p.length===0){_||l();return}if(f===p[p.length-1]&&_){l();return}const U=p.findIndex(w=>w===f);if(U===-1)return;const W=p[U+1];x(W)}function M(){$.current=window.setTimeout(()=>{D.current=!0},Kn)}function P(){$.current&&window.clearTimeout($.current),D.current=!1}return m.createElement("div",{onClick:H,onPointerCancel:P,onPointerDown:g=>{h&&v(g),M()},onPointerMove:g=>{h&&E(g)},ref:r,"data-vaul-drawer-visible":i?"true":"false","data-vaul-handle":"","aria-hidden":"true",...n},m.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},s))});Wn.displayName="Drawer.Handle";function Qn(t){const s=lt(),{container:n=s.container,...r}=t;return m.createElement(Bs,{container:n,...r})}const Le={Root:Vn,Content:Rs,Overlay:Cs,Portal:Qn,Title:Hs,Description:zs},Es=({shouldScaleBackground:t=!0,...s})=>e.jsx(Le.Root,{shouldScaleBackground:t,...s});Es.displayName="Drawer";const Yn=Le.Portal,ks=d.forwardRef(({className:t,...s},n)=>e.jsx(Le.Overlay,{ref:n,className:Se("fixed inset-0 z-50 bg-black/80 motion-reduce:animate-none",t),...s}));ks.displayName=Le.Overlay.displayName;const Ts=d.forwardRef(({className:t,children:s,...n},r)=>e.jsxs(Yn,{children:[e.jsx(ks,{}),e.jsxs(Le.Content,{ref:r,className:Se("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background motion-reduce:animate-none",t),...n,children:[e.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),s]})]}));Ts.displayName="DrawerContent";const Ds=({className:t,...s})=>e.jsx("div",{className:Se("grid gap-1.5 p-4 text-center sm:text-left",t),...s});Ds.displayName="DrawerHeader";const Ms=d.forwardRef(({className:t,...s},n)=>e.jsx(Le.Title,{ref:n,className:Se("text-lg font-semibold leading-none tracking-tight",t),...s}));Ms.displayName=Le.Title.displayName;const As=d.forwardRef(({className:t,...s},n)=>e.jsx(Le.Description,{ref:n,className:Se("text-sm text-muted-foreground",t),...s}));As.displayName=Le.Description.displayName;const Xn=[1,2,3,4,5];function ts({value:t,onChange:s,className:n,disabled:r=!1,size:l="md",ariaLabel:o="Sélecteur d'échelle 1 à 5"}){const p=l==="sm"?"h-10 w-10 text-xs":"h-11 w-11 text-sm";return e.jsx("div",{className:Se("flex items-center gap-2",n),role:"group","aria-label":o,children:Xn.map(f=>{const x=t===f;return e.jsx("button",{type:"button",className:Se("flex items-center justify-center rounded-full border font-semibold transition",p,x?"border-primary bg-primary text-primary-foreground":"border-muted-foreground/30 bg-background text-foreground",r&&"opacity-60"),"aria-pressed":x,disabled:r,onClick:()=>{r||s?.(f)},children:f},f)})})}const Gn=()=>{try{const t=new(window.AudioContext||window.webkitAudioContext),s=t.createOscillator(),n=t.createGain();s.connect(n),n.connect(t.destination),s.frequency.value=880,n.gain.value=.3,s.start(),s.stop(t.currentTime+.25);const r=t.createOscillator(),l=t.createGain();r.connect(l),l.connect(t.destination),r.frequency.value=1100,l.gain.value=.3,r.start(t.currentTime+.35),r.stop(t.currentTime+.6),r.onended=()=>t.close()}catch{}try{navigator.vibrate?.([200,100,200])}catch{}},gt=(t,s)=>{const n=Number(t?.set_index??t?.set_number??t?.setIndex??s);return!Number.isFinite(n)||n<=0?s:n},Is=(t=[],s,n)=>{if(!t.length)return 0;const r=Array.isArray(s)?s:[];if(r.length>0){const p=new Map;r.forEach((x,_)=>{if(!x?.exercise_id)return;const h=p.get(x.exercise_id)??[];h.push({...x,set_index:gt(x,_+1)}),p.set(x.exercise_id,h)});let f=t.length+1;for(let x=0;x<t.length;x+=1){const _=t[x];if((p.get(_.exercise_id)??[]).length<(_.sets??0)){f=x+1;break}}return f}const l=Number(n??0);if(!Number.isFinite(l)||l<=0)return 0;const o=Math.min(t.length,Math.max(0,Math.round(l/100*t.length)));return Math.min(t.length,o+1)},Pe=(t,s)=>{const n=Number(t);return!Number.isFinite(n)||n<=0?"—":s?`${n}${s}`:String(n)};function Jn({session:t,exercises:s,oneRMs:n,onFinish:r,onStart:l,onLogSets:o,onProgress:p,initialLogs:f,isFinishing:x,initialStep:_,onStepChange:h,initialInputOpen:i,initialSeriesOpen:v,onExitFocus:E,exerciseNotes:$,onUpdateNote:D}){const{toast:H}=qt(),N=d.useRef(!1),[M,P]=d.useState(_??0),[g,U]=d.useState([]),[W,w]=d.useState(0),[A,O]=d.useState(!0),k=d.useRef(Date.now()),b=d.useRef(0),[K,y]=d.useState(0),[ee,L]=d.useState(!1),[X,B]=d.useState(!1),Z=d.useRef(0),[fe,Ce]=d.useState(!0),[ue,Fe]=d.useState(3),[c,G]=d.useState(3),[re,oe]=d.useState(""),[te,me]=d.useState(!1),[V,Re]=d.useState(1),[Te,He]=d.useState(v??!1),[Ke,C]=d.useState(i??!1),[xe,De]=d.useState("weight"),[be,we]=d.useState(""),[Je,pe]=d.useState(!1),[ze,qe]=d.useState(!1),[Me,We]=d.useState(!1),[Qe,Ye]=d.useState(!1),[u,j]=d.useState(!1),[de,he]=d.useState("");d.useEffect(()=>{if(!A)return;const a=()=>{const T=Math.floor((Date.now()-k.current)/1e3)+b.current;w(T)};a();const R=setInterval(a,1e3),ie=()=>{document.visibilityState==="visible"&&a()};return document.addEventListener("visibilitychange",ie),()=>{clearInterval(R),document.removeEventListener("visibilitychange",ie)}},[A]),d.useEffect(()=>{if(!ze)return;const a=R=>{R.key==="Escape"&&qe(!1)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[ze]),d.useEffect(()=>{if(!ee||X)return;const a=()=>{if(Z.current<=0)return;const T=Math.max(0,Math.ceil((Z.current-Date.now())/1e3));y(T),T<=0&&(Gn(),H({title:"Temps de récupération terminé"}),L(!1),B(!1))};a();const R=setInterval(a,1e3),ie=()=>{document.visibilityState==="visible"&&a()};return document.addEventListener("visibilitychange",ie),()=>{clearInterval(R),document.removeEventListener("visibilitychange",ie)}},[ee,X]);const se=t.items||[],je=M-1,I=M>0&&M<=se.length?se[je]:null,ge=I?s.find(a=>a.id===I.exercise_id):null,ct=M<se.length?se[M]:null,jt=ct?s.find(a=>a.id===ct.exercise_id):null,dt=(()=>{const a=ge?.muscle_groups??ge?.muscles??ge?.muscleGroups??[];return Array.isArray(a)?a:[]})(),Ie=I?.rest_seconds??0,S=se.length?Math.min(100,Math.max(0,Math.round((M-1)/se.length*100))):0,z=Number(I?.percent_1rm),Q=Number.isFinite(z)&&z>0,F=Q&&n.find(a=>a.exercise_id===I?.exercise_id)?.weight||0,q=Q?Math.round(F*(z/100)):0,[J,ae]=d.useState({}),Ee=d.useMemo(()=>{const a=new Map;return g.forEach((R,ie)=>{const T=gt(R,ie+1);R.exercise_id&&a.set(`${R.exercise_id}-${T}`,R)}),a},[g]),ve=I?`${I.exercise_id}-${V}`:null,ke=ve?Ee.get(ve):null,Ae=ke?.weight??J[V-1]?.weight??q,_e=ke?.reps??J[V-1]?.reps??I?.reps??"",Xe=()=>{if(typeof window>"u")return;const a=[tt.status.success,tt.chart[2],tt.chart[3],tt.destructive,tt.accent],R=120;for(let ie=0;ie<R;ie+=1){const T=document.createElement("div"),Oe=Math.random()*6+6;T.style.position="fixed",T.style.top="-10px",T.style.left=`${Math.random()*100}vw`,T.style.width=`${Oe}px`,T.style.height=`${Oe*.6}px`,T.style.backgroundColor=a[ie%a.length],T.style.opacity="0.9",T.style.pointerEvents="none",T.style.zIndex="80",T.style.borderRadius="2px",document.body.appendChild(T);const $e=(Math.random()-.5)*200,et=1200+Math.random()*800,ut=Math.random()*360;T.animate([{transform:"translate3d(0, 0, 0) rotate(0deg)",opacity:1},{transform:`translate3d(${$e}px, ${window.innerHeight+200}px, 0) rotate(${ut}deg)`,opacity:0}],{duration:et,easing:"ease-out"}).onfinish=()=>T.remove()}};d.useEffect(()=>{if(N.current){f&&U(f);return}if(!f){U(T=>T.length?[]:T),ae(T=>Object.keys(T).length?{}:T);return}if(U(f),!f.length){ae(T=>Object.keys(T).length?{}:T),P(T=>T===0?T:0);return}const a=t.items||[];if(!a.length)return;const R=new Map;f.forEach((T,Oe)=>{if(!T.exercise_id)return;const $e=R.get(T.exercise_id)??[];$e.push({...T,set_index:gt(T,Oe+1)}),R.set(T.exercise_id,$e)});const ie=Is(a,f);if(ie>0&&ie<=a.length){const T=a[ie-1],Oe=R.get(T.exercise_id)??[],$e=Oe.reduce((ut,_t,Ls)=>{const Fs=gt(_t,Ls+1);return ut[Fs-1]={reps:_t.reps??void 0,weight:_t.weight??void 0},ut},{});ae($e);const et=Math.min(T.sets??1,Oe.length+1);Re(et)}else ae({}),Re(1);P(T=>T===ie?T:ie)},[f,t.items]),d.useEffect(()=>{M<=se.length||te||(Xe(),me(!0))},[M,se.length,te]);const Ze=a=>{P(a),h?.(a)},Kt=a=>{a<=0||(Z.current=Date.now()+a*1e3,y(a),L(!0),B(!1))},Nt=async()=>{window.scrollTo({top:0,behavior:"smooth"});const a=M+1;Re(1),ae({}),Ze(a);const R=Math.round(Math.min(a-1,se.length)/se.length*100);try{await p?.(R)}catch{H({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}},$s=async()=>{if(!I)return;if(ke){V>=I.sets?await Nt():Re(R=>Math.min(I.sets,R+1));return}const a={exercise_id:I.exercise_id,set_number:V,reps:J[V-1]?.reps||I.reps,weight:J[V-1]?.weight||q};U(R=>[...R,a]),N.current=!0;try{await o?.([a])}catch{H({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}finally{N.current=!1}if(fe&&I.rest_seconds>0&&Kt(I.rest_seconds),V>=I.sets){await Nt();return}Re(R=>Math.min(I.sets,R+1))},Ut=a=>{De(a);const R=a==="weight"?J[V-1]?.weight??q??"":J[V-1]?.reps??I?.reps??"";we(R?String(R):""),pe(!!R),C(!0)},Ps=()=>{if(!I)return;const a=Number(xe==="weight"?be.replace(",","."):be);Number.isFinite(a)&&(ae(R=>({...R,[V-1]:{...R[V-1],[xe]:a}})),C(!1))},St=a=>{if(Je){pe(!1),we(a);return}we(R=>a==="."&&R.includes(".")?R:R+a)},Wt=a=>{if(!I)return;De(a);const R=a==="weight"?J[V-1]?.weight??q??"":J[V-1]?.reps??I?.reps??"";we(R?String(R):""),pe(!!R)};return M===0?e.jsxs("div",{className:"space-y-6 text-center py-8 animate-in zoom-in duration-300",children:[e.jsx("div",{className:"h-24 w-24 bg-primary/10 rounded-full flex items-center justify-center mx-auto animate-pulse",children:e.jsx(ot,{className:"h-10 w-10 text-primary ml-1"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold font-display uppercase",children:t.title}),e.jsx("p",{className:"text-muted-foreground text-lg",children:t.description}),e.jsxs("div",{className:"flex gap-2 justify-center mt-4",children:[e.jsx(it,{variant:"outline",className:"text-sm px-3 py-1",children:t.cycle}),e.jsxs(it,{variant:"secondary",className:"text-sm px-3 py-1",children:[se.length," Exercices"]})]})]}),e.jsx(Y,{size:"lg",className:"w-full text-xl h-14 font-bold uppercase tracking-wider shadow-lg hover:scale-[1.02] transition-transform",disabled:Me,onClick:async()=>{We(!0);try{await l?.(),Ze(1)}finally{We(!1)}},children:Me?e.jsxs(e.Fragment,{children:[e.jsx(tn,{className:"mr-2 h-5 w-5 animate-spin"}),"CHARGEMENT..."]}):"COMMENCER SÉANCE"})]}):M>se.length?e.jsx("div",{className:"space-y-6 animate-in fade-in",children:e.jsxs(Ve,{className:"border-t-8 border-t-primary shadow-xl",children:[e.jsxs(vt,{className:"text-center pb-2",children:[e.jsx("div",{className:"mx-auto bg-primary/10 p-4 rounded-full w-fit mb-4",children:e.jsx(sn,{className:"h-12 w-12 text-primary"})}),e.jsx(Bt,{className:"text-3xl uppercase font-display italic",children:"Séance Terminée !"}),e.jsxs(is,{className:"text-lg",children:["Durée totale: ",Math.floor(W/60),"m ",W%60,"s"]})]}),e.jsxs(pt,{className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Volume"}),e.jsxs("div",{className:"text-2xl font-mono font-bold",children:[g.reduce((a,R)=>a+(Number(R.weight)||0)*(Number(R.reps)||0),0).toLocaleString("fr-FR")," kg"]})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Séries"}),e.jsx("div",{className:"text-2xl font-mono font-bold",children:g.length})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Ge,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Difficulté de la séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Facile"}),e.jsx("span",{children:"Très dur"})]}),e.jsx(ts,{value:ue,onChange:Fe})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Ge,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Fatigue fin de séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Frais"}),e.jsx("span",{children:"Épuisé"})]}),e.jsx(ts,{value:c,onChange:G})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ge,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Notes"}),e.jsx("textarea",{placeholder:"Sensations, douleurs...",value:re,onChange:a=>oe(a.target.value),rows:3,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none"})]})]}),e.jsx(Ws,{children:e.jsx(Y,{className:"w-full h-14 text-lg font-bold uppercase",disabled:x,onClick:()=>{x||r({duration:Math.floor(W/60),feeling:ue,fatigue:c,comments:re,logs:g})},children:x?"ENREGISTREMENT...":"ENREGISTRER & FERMER"})})]})}):e.jsxs("div",{className:"space-y-6 pb-44",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button","aria-label":"Voir l'animation de l'exercice",onClick:()=>{ge?.illustration_gif&&qe(!0)},className:"flex h-10 w-10 shrink-0 items-center justify-center overflow-hidden rounded-full border bg-card shadow-sm",children:ge?.illustration_gif?e.jsx("img",{src:ge.illustration_gif,alt:"",className:"h-full w-full object-cover",loading:"lazy",decoding:"async"}):e.jsx(ot,{className:"h-5 w-5 text-muted-foreground"})}),e.jsx("h2",{className:"flex-1 min-w-0 text-lg font-semibold tracking-tight truncate",children:ge?.nom_exercice??"Exercice"}),D&&I&&e.jsx(Y,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",onClick:()=>{he($?.[I.exercise_id]??""),j(!0)},"aria-label":"Notes personnelles",children:e.jsx(nn,{className:Se("h-4 w-4",$?.[I?.exercise_id]?"text-primary":"text-muted-foreground")})}),E&&e.jsx(Y,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0","aria-label":"Quitter le focus",onClick:()=>{g.length>0?Ye(!0):E()},children:e.jsx(xt,{className:"h-4 w-4"})})]}),I&&$?.[I.exercise_id]&&e.jsx("p",{className:"text-xs italic text-muted-foreground line-clamp-2 -mt-1",children:$[I.exercise_id]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"rounded-full bg-primary/10 text-primary px-2.5 py-0.5 text-xs font-bold shrink-0",children:["Ex ",M,"/",se.length]}),e.jsxs("span",{className:"rounded-full bg-muted px-2.5 py-0.5 text-xs font-semibold shrink-0",children:["S ",V,"/",Pe(I?.sets)]}),e.jsx("div",{className:"flex-1 h-1.5 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary transition-all",style:{width:`${S}%`}})}),e.jsxs("span",{className:"text-xs font-semibold text-muted-foreground shrink-0",children:[S,"%"]})]}),dt.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:dt.map(a=>e.jsx("span",{className:"rounded-full bg-muted px-2.5 py-0.5 text-xs font-semibold text-muted-foreground",children:a},a))})]}),e.jsxs(Ve,{className:"rounded-3xl border bg-card p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"text-sm font-semibold",children:["Série ",V,"/",Pe(I?.sets)," · ",Pe(I?.reps)," reps"]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(At,{checked:fe,onCheckedChange:Ce,className:"scale-90"}),e.jsx("span",{children:"Auto repos"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>Ut("weight"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:Ae||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>Ut("reps"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:_e||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"reps"})]})]})]})]}),(I?.notes||ge?.description)&&e.jsxs("div",{className:"rounded-2xl border bg-muted/10 px-4 py-3",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground/70 uppercase tracking-wide mb-1",children:"Notes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:I?.notes||ge?.description})]}),e.jsx(Y,{variant:"outline",className:"w-full rounded-2xl",onClick:()=>He(!0),children:"Voir les séries"}),!Ke&&!ee?e.jsxs(ps,{className:"bottom-0 z-modal",containerClassName:"gap-3 py-4",children:[e.jsxs(Y,{className:"flex-1 min-w-0 h-12 rounded-xl text-sm font-bold shadow-lg active:scale-95 transition-transform",onClick:$s,children:[e.jsx(Xt,{className:"mr-2 h-5 w-5"})," Valider série"]}),e.jsxs(Y,{type:"button",variant:"outline",className:"h-12 rounded-xl px-3 flex flex-col items-center justify-center gap-0.5 active:scale-95 transition-transform",onClick:()=>{Ie>0&&Kt(Ie)},disabled:Ie<=0,"aria-label":"Démarrer le repos",children:[e.jsx(rn,{className:"h-4 w-4"}),e.jsx("span",{className:"text-[10px] font-semibold leading-none",children:"Repos"})]}),e.jsxs(Y,{type:"button",variant:"outline",className:"h-12 rounded-xl px-3 flex flex-col items-center justify-center gap-0.5 active:scale-95 transition-transform",onClick:()=>Nt(),"aria-label":"Exercice suivant",children:[e.jsx(yt,{className:"h-4 w-4"}),e.jsx("span",{className:"text-[10px] font-semibold leading-none",children:"Passer"})]})]}):null,ee&&e.jsxs("div",{className:"fixed inset-0 z-modal flex flex-col bg-background/95 pb-[env(safe-area-inset-bottom)]",children:[e.jsxs("div",{className:"flex items-start justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Timer"}),e.jsx("div",{className:"text-lg font-semibold",children:"Transition inter-exercice"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Prochain exercice : ",jt?.nom_exercice??"À venir"]})]}),e.jsx(Y,{variant:"ghost",size:"icon",onClick:()=>{L(!1),B(!1)},"aria-label":"Fermer le timer de repos",children:e.jsx(xt,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-6 px-6 py-8",children:[e.jsxs(Ve,{className:"w-full max-w-sm rounded-3xl border p-6 shadow-sm",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Temps restant"}),e.jsxs("div",{className:"mt-2 text-5xl font-semibold tracking-tight",children:[Math.floor(K/60),":",String(K%60).padStart(2,"0")]}),e.jsx("div",{className:"mt-6 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:Ie?`${K/Ie*100}%`:"0%"}})}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx(Y,{variant:"outline",className:"flex-1 h-12 rounded-full text-base font-semibold",onClick:()=>{Z.current+=30*1e3,y(a=>a+30)},children:"+30s"}),e.jsxs(Y,{variant:"outline",className:"flex-1 h-12 rounded-full text-base font-semibold",onClick:()=>{Z.current=Date.now()+Ie*1e3,y(Ie)},children:[e.jsx(Qs,{className:"mr-2 h-4 w-4"})," Reset"]})]})]}),e.jsxs("div",{className:"flex w-full max-w-sm flex-wrap gap-3",children:[e.jsxs(Y,{className:"flex-1 rounded-full py-6 text-base font-semibold",onClick:()=>{X&&(Z.current=Date.now()+K*1e3),B(a=>!a)},children:[e.jsx(vn,{className:"mr-2 h-4 w-4"})," ",X?"Reprendre":"Pause"]}),e.jsxs(Y,{variant:"outline",className:"rounded-full px-6 py-6 text-base font-semibold",onClick:()=>{Z.current=0,L(!1),y(0),B(!1)},children:["Passer ",e.jsx(yt,{className:"ml-2 h-4 w-4"})]})]})]})]}),ze&&ge?.illustration_gif&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:()=>qe(!1),children:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button","aria-label":"Fermer",className:"absolute -right-3 -top-3 rounded-full bg-background p-2 shadow",onClick:()=>qe(!1),children:e.jsx(xt,{className:"h-4 w-4"})}),e.jsx("img",{src:ge.illustration_gif,alt:"",className:"max-h-[80vh] w-auto max-w-[92vw] rounded-2xl",loading:"lazy"})]})})}),e.jsx(It,{open:Te,onOpenChange:He,children:e.jsxs(Ot,{side:"bottom",className:"max-h-[80vh] overflow-y-auto",children:[e.jsx($t,{children:e.jsx(Pt,{children:"Aperçu séance"})}),e.jsx("div",{className:"mt-4 space-y-4",children:se.map((a,R)=>{const ie=s.find($e=>$e.id===a.exercise_id),T=Array.from({length:a.sets}).filter(($e,et)=>Ee.get(`${a.exercise_id}-${et+1}`)).length,Oe=a.sets?Math.round(T/a.sets*100):0;return e.jsxs(Ve,{className:"rounded-3xl border bg-muted/10 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:ie?.nom_exercice??a.exercise_name}),e.jsxs("div",{className:"mt-1 text-sm text-muted-foreground",children:[Pe(a.sets),"x",Pe(a.reps)," ·"," ",a.percent_1rm?`${Pe(a.percent_1rm)} 1RM`:"—"]})]}),e.jsxs("div",{className:"rounded-full bg-muted px-3 py-1 text-sm font-semibold",children:[T,"/",Pe(a.sets)]})]}),e.jsx("div",{className:"mt-4 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${Oe}%`}})})]},`${a.exercise_id}-${R}`)})})]})}),e.jsx(Es,{open:Ke,onOpenChange:C,children:e.jsx(Ts,{className:"max-h-[90vh]",children:e.jsxs("div",{className:"mx-auto w-full max-w-md px-4 pb-8",children:[e.jsxs(Ds,{className:"pb-2",children:[e.jsx(Ms,{className:"text-center",children:xe==="weight"?"Charge":"Répétitions"}),e.jsxs(As,{className:"text-center",children:["Série ",V,"/",Pe(I?.sets)," · Objectif"," ",Pe(I?.reps)," reps"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("button",{type:"button",className:Se("rounded-xl border-2 p-4 text-center transition-all",xe==="weight"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>Wt("weight"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[xe==="weight"?be||"—":String(J[V-1]?.weight??q??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:Se("rounded-xl border-2 p-4 text-center transition-all",xe==="reps"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>Wt("reps"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[xe==="reps"?be||"—":String(J[V-1]?.reps??I?.reps??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"reps"})]})]})]}),xe==="weight"&&q>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[q-10,q-5,q,q+5,q+10].filter(a=>a>0).map(a=>e.jsxs(Y,{variant:Number(be)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>we(String(a)),children:[a," kg"]},a))})]}),xe==="reps"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[6,8,10,12,15,20].map(a=>e.jsx(Y,{variant:Number(be)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>we(String(a)),children:a},a))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[[1,2,3,4,5,6,7,8,9].map(a=>e.jsx(Y,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>St(String(a)),children:a},a)),e.jsx(Y,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>St("."),children:","}),e.jsx(Y,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>St("0"),children:"0"}),e.jsx(Y,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>{pe(!1),we(a=>a.slice(0,-1))},children:"⌫"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Y,{variant:"outline",className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:()=>{pe(!1),we("")},children:"Effacer"}),e.jsxs(Y,{className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:Ps,children:[e.jsx(Xt,{className:"mr-2 h-5 w-5"}),"Valider"]})]})]})})}),E&&e.jsx(os,{open:Qe,onOpenChange:Ye,children:e.jsxs(ls,{children:[e.jsxs(cs,{children:[e.jsx(ds,{children:"Quitter la séance ?"}),e.jsx(us,{children:"Les séries enregistrées seront conservées."})]}),e.jsxs(ms,{children:[e.jsx(fs,{children:"Annuler"}),e.jsx(hs,{onClick:()=>{Ye(!1),E()},children:"Quitter"})]})]})}),D&&e.jsx(It,{open:u,onOpenChange:a=>{if(!a&&I){const R=de.trim()||null,ie=$?.[I.exercise_id]??null;R!==ie&&D(I.exercise_id,R)}j(a)},children:e.jsxs(Ot,{side:"bottom",className:"max-h-[60vh]",children:[e.jsx($t,{children:e.jsxs(Pt,{children:["Notes — ",ge?.nom_exercice]})}),e.jsx("textarea",{value:de,onChange:a=>he(a.target.value),placeholder:"Réglages machine, repères personnels...",rows:4,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm mt-4 resize-none ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"})]})})]})}const Os=(t=[])=>{if(!t.length)return t;const s=t.map((r,l)=>{const o=Number(r.order_index);return{item:r,index:l,order:Number.isFinite(o)?o:null}});return s.some(r=>r.order!==null)?s.sort((r,l)=>r.order===null&&l.order===null?r.index-l.index:r.order===null?1:l.order===null?-1:r.order===l.order?r.index-l.index:r.order-l.order).map(r=>r.item):t},Tt=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance";function Zn({user:t,userId:s,athleteName:n,athleteId:r,athleteKey:l,cycleType:o,searchQuery:p,isLoading:f,setSaveState:x,onCycleChange:_,onSearchChange:h,onStartAssignment:i,onStartCatalog:v,onResumeInProgress:E}){const{toast:$}=qt(),D=as(),[H,N]=d.useState(null),[M,P]=d.useState(!1),[g,U]=d.useState(null),W=[{value:"endurance",label:"Endurance"},{value:"hypertrophie",label:"Hypertrophie"},{value:"force",label:"Force"}],{data:w}=Be({queryKey:["assignments",t,"strength"],queryFn:()=>ye.getAssignments(t,s,{assignmentType:"strength"}),enabled:!!t}),{data:A}=Be({queryKey:["strength_catalog"],queryFn:()=>ye.getStrengthSessions()}),{data:O}=Be({queryKey:["exercises"],queryFn:()=>ye.getExercises()}),b=Be({queryKey:["strength_run_in_progress",l],queryFn:()=>ye.getStrengthHistory(n,{limit:1,offset:0,order:"desc",status:"in_progress",athleteId:r}),enabled:!!n}).data?.runs?.[0]??null,K=b?.status==="completed"||(b?.progress_pct??0)>=100,y=at({mutationFn:c=>ye.deleteStrengthRun(c),onMutate:()=>{x("saving")},onSuccess:c=>{x("saved"),setTimeout(()=>x("idle"),2e3),D.invalidateQueries({queryKey:["strength_run_in_progress",l]}),D.invalidateQueries({queryKey:["strength_history"]}),D.invalidateQueries({queryKey:["assignments",t,"strength"]});const G=c?.source==="local"?"Suppression locale : le serveur n'est pas disponible.":void 0;$({title:"Séance supprimée",description:G})},onError:()=>{x("error"),setTimeout(()=>x("idle"),3e3),$({title:"Erreur",description:"Impossible de supprimer la séance en cours.",variant:"destructive"})}});d.useMemo(()=>O?new Map(O.map(c=>[c.id,c])):new Map,[O]);const ee=d.useMemo(()=>w?.filter(c=>c.session_type==="strength")||[],[w]),L=d.useMemo(()=>ee.filter(c=>c.status!=="completed"),[ee]),X=d.useMemo(()=>b?L.find(c=>c.id===b.assignment_id)??null:null,[b,L]),B=d.useMemo(()=>b&&!X?A?.find(c=>c.id===b.session_id)??null:null,[b,X,A]),Z=(!!X?.items?.length||!!B?.items?.length)&&!K,fe=d.useMemo(()=>L.map(c=>{const G=(c.items??[]).filter(re=>"exercise_id"in re);return{key:`assignment-${c.id}`,title:c.title,description:c.description,type:"assignment",assignedDate:c.assigned_date,session:{id:c.session_id,title:c.title,description:c.description,cycle:Tt(c.cycle),items:G},assignment:c,exerciseCount:G.length}}),[L]),Ce=d.useMemo(()=>(A??[]).map(c=>({key:`catalog-${c.id}`,title:c.title,description:c.description,type:"catalog",session:{...c,cycle:o},exerciseCount:c.items?.length??0})),[A,o]),ue=d.useMemo(()=>{const c=p.trim().toLowerCase(),G=[...fe,...Ce];return c?G.filter(re=>`${re.title} ${re.description}`.toLowerCase().includes(c)):G},[fe,Ce,p]),Fe=d.useCallback((c,G)=>{if(!["ArrowUp","ArrowDown","Enter"].includes(c.key))return;if(c.preventDefault(),c.key==="Enter"){const te=ue[G];te.type==="assignment"&&te.assignment?i(te.assignment):v(te.session);return}let oe=G;c.key==="ArrowUp"&&(oe=Math.max(0,G-1)),c.key==="ArrowDown"&&(oe=Math.min(ue.length-1,G+1)),N(oe),setTimeout(()=>{const te=document.querySelectorAll('[data-session-card="true"]');te[oe]&&te[oe].focus()},0)},[ue,i,v]);return f?e.jsxs("div",{className:"space-y-5 pt-2",children:[e.jsx("div",{className:"rounded-xl bg-muted/40 p-1 flex gap-1",children:[1,2,3].map(c=>e.jsx("div",{className:"flex-1 h-10 rounded-lg bg-muted animate-pulse"},c))}),e.jsx("div",{className:"space-y-2.5",children:[1,2,3,4].map(c=>e.jsx("div",{className:"rounded-xl border bg-card p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 w-3/5 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-2/5 rounded bg-muted animate-pulse"})]})},c))})]}):e.jsxs("div",{className:"space-y-4 animate-in fade-in motion-reduce:animate-none",children:[e.jsxs("div",{children:[e.jsx("div",{className:"rounded-xl bg-muted/40 p-1 flex gap-1",children:W.map(c=>e.jsx("button",{type:"button",onClick:()=>_(Tt(c.value)),className:Se("flex-1 py-2.5 rounded-lg text-sm font-semibold transition-all active:scale-[0.97]",o===c.value?"bg-card text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:c.label},c.value))}),e.jsxs("p",{className:"text-center text-[11px] text-muted-foreground mt-2",children:[o==="endurance"&&"Beaucoup de reps, charges légères",o==="hypertrophie"&&"Reps et charges modérées",o==="force"&&"Peu de reps, charges lourdes"]})]}),ue.length>4&&e.jsxs("div",{className:"relative",children:[e.jsx(cn,{className:"absolute left-3.5 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground pointer-events-none"}),e.jsx(Mt,{placeholder:"Rechercher...",className:"h-10 rounded-xl bg-muted/30 pl-10 pr-4 border-0 text-sm focus-visible:ring-2",value:p,onChange:c=>h(c.target.value),"aria-label":"Rechercher une séance"})]}),b&&e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border-2 border-primary/30 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-primary/10 rounded-full blur-2xl -mr-8 -mt-8"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-primary"})]}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-primary",children:K?"Complétée":"En cours"})]}),e.jsx("h3",{className:"text-xl font-bold tracking-tight mb-1",children:X?.title??"Séance en cours"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Démarrée le"," ",wt(new Date(b.started_at||new Date),"dd MMMM",{locale:bt})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs font-semibold mb-1.5",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progression"}),e.jsxs("span",{className:"text-primary",children:[Math.round(b.progress_pct??0),"%"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-primary transition-all duration-500",style:{width:`${b.progress_pct??0}%`}})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Y,{variant:"default",className:"flex-1 h-12 rounded-xl font-semibold",disabled:!Z,onClick:()=>{const c=X??B;if(!c)return;const re=(X?.items??B?.items??[]).filter(V=>"exercise_id"in V),oe=Tt(X?.cycle??B?.cycle??re.find(V=>V.cycle_type)?.cycle_type),te=re.filter(V=>V.cycle_type===oe),me=Os(te.length?te:re);E({assignment:X??null,session:{...c,title:c.title,description:c.description??null,cycle:oe,items:me},runId:b.id,logs:b.logs??[],progressPct:b.progress_pct??0})},children:K?"Voir le résumé":"Reprendre"}),!K&&e.jsx(Y,{variant:"outline",className:"h-12 w-12 rounded-xl p-0",disabled:y.isPending,onClick:()=>{b&&(U(b.id),P(!0))},"aria-label":"Supprimer la séance",children:e.jsx(xt,{className:"h-5 w-5"})})]})]})]}),ue.length>0&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:[ue.length," séance",ue.length>1?"s":""]}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),ue.length>0?e.jsx(Lt.div,{className:"space-y-2.5 motion-reduce:animate-none",variants:an,initial:"hidden",animate:"visible",children:ue.map((c,G)=>{const re=H===G||H===null&&G===0,oe=c.type==="assignment";return e.jsx(Lt.button,{type:"button",tabIndex:re?0:-1,"data-session-card":"true",onKeyDown:te=>Fe(te,G),variants:on,className:Se("group w-full rounded-xl border bg-card text-left transition-all active:scale-[0.98] hover:shadow-md focus:outline-none motion-reduce:animate-none overflow-hidden",oe&&"border-l-[3px] border-l-primary",re&&"ring-2 ring-primary"),onClick:()=>{if(oe&&c.assignment){i(c.assignment);return}v(c.session)},children:e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3.5",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("h3",{className:"font-semibold tracking-tight truncate",children:c.title}),oe&&e.jsx("span",{className:"shrink-0 inline-flex items-center rounded-md bg-primary/10 px-1.5 py-0.5 text-[10px] font-bold uppercase text-primary",children:"Coach"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[c.exerciseCount," exercice",c.exerciseCount>1?"s":""]}),oe&&c.assignedDate&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-border",children:"·"}),e.jsx("span",{children:wt(new Date(c.assignedDate),"dd MMM",{locale:bt})})]}),c.description&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-border",children:"·"}),e.jsx("span",{className:"truncate",children:c.description})]})]})]}),e.jsx(yt,{className:"h-5 w-5 shrink-0 text-muted-foreground/40 transition-transform group-hover:translate-x-0.5 group-hover:text-primary"})]})},c.key)})}):e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-14 w-14 items-center justify-center rounded-full bg-muted/60",children:e.jsx(ot,{className:"h-6 w-6 text-muted-foreground"})}),e.jsx("h3",{className:"font-semibold text-sm",children:"Aucune séance trouvée"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Changez de cycle ou modifiez votre recherche."})]}),e.jsx(os,{open:M,onOpenChange:P,children:e.jsxs(ls,{children:[e.jsxs(cs,{children:[e.jsx(ds,{children:"Supprimer la séance ?"}),e.jsx(us,{children:"Les séries déjà enregistrées seront perdues."})]}),e.jsxs(ms,{children:[e.jsx(fs,{children:"Annuler"}),e.jsx(hs,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:()=>{g&&y.mutate(g),P(!1)},children:"Supprimer"})]})]})})]})}const ss=t=>{const s=Number(t);return!Number.isFinite(s)||s<=0?"—":String(s)},er=t=>{const s=Number(t);return!Number.isFinite(s)||s<=0?"—":`${s}s`};function tr({session:t,assignment:s,cycleType:n,cycleOptions:r,exercises:l,oneRMs:o,saveState:p,onBack:f,onLaunch:x}){const _=d.useMemo(()=>new Map(l.map(i=>[i.id,i])),[l]),h=t.items??[];return e.jsxs(Lt.div,{className:"space-y-5 pb-36",variants:ln,initial:"hidden",animate:"visible",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:f,className:"flex h-10 w-10 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors hover:bg-muted active:scale-95","aria-label":"Retour",children:e.jsx(xs,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground truncate",children:r.find(i=>i.value===n)?.label}),e.jsx("h1",{className:"text-xl font-bold tracking-tight truncate",children:t.title})]})]}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border border-primary/20 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-primary/10 rounded-full blur-3xl -mr-12 -mt-12"}),e.jsxs("div",{className:"relative space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-primary/20 px-3 py-1 text-xs font-bold uppercase text-primary",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-primary"}),"Assignée"]}),!s&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:"Catalogue"}),s?.assigned_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Prévue le ",wt(new Date(s.assigned_date),"dd MMM",{locale:bt})]})]}),t.description&&e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(ot,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:h.length}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Exercices"})]})]}),e.jsx("div",{className:"h-8 w-px bg-border"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(xn,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:r.find(i=>i.value===n)?.label}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Cycle"})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-1",children:[e.jsxs("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:[h.length," exercice",h.length>1?"s":""]}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsxs("div",{className:"space-y-2",children:[h.map((i,v)=>{const E=_.get(i.exercise_id),$=Number(i.percent_1rm),D=Number.isFinite($)&&$>0,H=D?o?.find(w=>w.exercise_id===i.exercise_id)?.weight??0:0,N=D?Math.round(H*($/100)):0,M=D?N>0?`${N} kg (${$}% 1RM)`:`${$}% 1RM`:null,P=i.notes?.trim(),g=ss(i.sets),U=ss(i.reps),W=er(i.rest_seconds);return e.jsxs(It,{children:[e.jsx(Js,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-3 rounded-xl border bg-card px-3 py-3 text-left transition-all active:scale-[0.98] hover:border-primary/50 hover:shadow-sm",children:[e.jsx("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-primary text-xs font-bold text-primary-foreground",children:v+1}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"font-semibold text-sm truncate",children:E?.nom_exercice??i.exercise_name??"Exercice"})}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 text-xs font-medium text-muted-foreground",children:[e.jsxs("span",{className:"font-mono",children:[g,"×",U]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("span",{className:"font-mono",children:W}),e.jsx(yt,{className:"h-4 w-4 text-muted-foreground/50"})]})]})}),e.jsxs(Ot,{side:"bottom",className:"max-h-[90vh] overflow-y-auto rounded-t-3xl pb-8",children:[e.jsx($t,{className:"text-left pb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-primary text-sm font-bold text-primary-foreground",children:v+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(Pt,{className:"text-xl leading-tight",children:E?.nom_exercice??i.exercise_name??"Exercice"}),E?.exercise_type&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:E.exercise_type})]})]})}),e.jsxs("div",{className:"space-y-4",children:[E?.illustration_gif&&e.jsx("div",{className:"rounded-xl overflow-hidden bg-muted/20 border aspect-video flex items-center justify-center",children:e.jsx("img",{src:E.illustration_gif,alt:E.nom_exercice??"Exercice",className:"w-full h-full max-h-36 object-contain",loading:"lazy",decoding:"async"})}),E?.description&&e.jsx("div",{className:"text-sm text-muted-foreground leading-relaxed",children:E.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:g}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Séries"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:U}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Reps"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:M??"—"}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Charge"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:W}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Repos"})]})]}),P&&e.jsxs("div",{className:"rounded-xl bg-primary/5 border border-primary/20 p-4",children:[e.jsx("div",{className:"text-[10px] uppercase text-primary font-semibold mb-1",children:"Notes coach"}),e.jsx("div",{className:"text-sm text-foreground",children:P})]})]})]})]},`${i.exercise_id}-${v}`)}),h.length===0&&e.jsx("div",{className:"p-6 border-2 border-dashed rounded-xl text-center text-muted-foreground",children:"Aucun exercice disponible pour cette séance."})]}),e.jsx(ps,{saveState:p,className:"bottom-0",children:e.jsxs(Y,{variant:"default",className:"flex-1 h-14 rounded-xl font-bold text-base shadow-lg",onClick:x,children:[e.jsx(Zs,{className:"h-5 w-5 mr-2"}),"Lancer la séance"]})})]})}function sr({athleteName:t,athleteId:s,athleteKey:n}){const[r,l]=d.useState("all"),[o,p]=d.useState(""),[f,x]=d.useState(""),_=Us({queryKey:["strength_history",n,r,o,f],queryFn:({pageParam:i=0})=>ye.getStrengthHistory(t,{athleteId:s,limit:10,offset:i,order:"desc",status:r==="all"?void 0:r,from:o||void 0,to:f||void 0}),enabled:!!t,getNextPageParam:i=>{const v=i.pagination.offset+i.pagination.limit;return v<i.pagination.total?v:void 0},initialPageParam:0}),h=_.data?.pages.flatMap(i=>i.runs)??[];return e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Ge,{htmlFor:"strength-history-status",children:"Statut"}),e.jsxs(dn,{value:r,onValueChange:l,children:[e.jsx(un,{id:"strength-history-status",children:e.jsx(mn,{placeholder:"Tous"})}),e.jsxs(fn,{children:[e.jsx(mt,{value:"all",children:"Tous"}),e.jsx(mt,{value:"in_progress",children:"En cours"}),e.jsx(mt,{value:"completed",children:"Terminé"}),e.jsx(mt,{value:"abandoned",children:"Abandonné"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Ge,{htmlFor:"strength-history-from",children:"Du"}),e.jsx(Mt,{id:"strength-history-from",type:"date",value:o,onChange:i=>p(i.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Ge,{htmlFor:"strength-history-to",children:"Au"}),e.jsx(Mt,{id:"strength-history-to",type:"date",value:f,onChange:i=>x(i.target.value)})]})]}),h.map(i=>e.jsx(Ve,{className:"group hover:border-primary/50 transition-colors",children:e.jsxs(vt,{className:"pb-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Bt,{className:"text-base font-bold uppercase",children:wt(new Date(i.started_at||i.date||i.created_at||new Date),"dd MMM yyyy",{locale:bt})}),e.jsxs("div",{className:"text-sm font-mono font-bold text-muted-foreground group-hover:text-primary",children:[i.duration??0," min"]})]}),e.jsxs("div",{className:"flex gap-2 text-xs font-bold text-muted-foreground",children:[e.jsxs("span",{children:["Difficulté ",i.feeling??i.rpe??0,"/5"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[i.logs?.length||0," Séries"]})]})]})},i.id)),h.length===0&&e.jsx("div",{className:"text-center text-muted-foreground py-10",children:"Aucun historique."}),_.hasNextPage&&e.jsx(Y,{variant:"outline",size:"sm",className:"w-full",onClick:()=>_.fetchNextPage(),disabled:_.isFetchingNextPage,children:_.isFetchingNextPage?"Chargement...":"Charger plus"})]})}const nr=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance";function rr({athleteKey:t}){const s="strength-preferences",n=d.useMemo(()=>`strength-focus-state-${t??"anonymous"}`,[t]),[r,l]=d.useState(null),[o,p]=d.useState(null),[f,x]=d.useState(null),[_,h]=d.useState(null),[i,v]=d.useState(0),[E,$]=d.useState("list"),[D,H]=d.useState(!1),[N,M]=d.useState("idle"),[P,g]=d.useState({poolMode:!1,largeText:!1}),[U,W]=d.useState(""),[w,A]=d.useState("endurance");return d.useEffect(()=>{if(typeof window>"u")return;const k=window.localStorage.getItem(s);if(k)try{const b=JSON.parse(k);g(K=>({...K,...b??{}}))}catch{return}},[]),d.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(s,JSON.stringify(P))},[s,P]),d.useEffect(()=>{if(!(typeof document>"u")){if(E==="focus")return document.body.dataset.focusMode="strength",()=>{document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode};document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode}},[E]),d.useEffect(()=>{if(typeof window>"u"||r)return;const k=window.localStorage.getItem(n);if(k)try{const b=JSON.parse(k),K=b?.screenMode==="focus"?"focus":b?.screenMode==="reader"?"reader":null;if(!K||!b?.session)return;l(b.session),p(b.assignment??null),x(typeof b.runId=="number"?b.runId:null),h(Array.isArray(b.runLogs)?b.runLogs:null),v(Number.isFinite(b.runnerStep)?b.runnerStep:0),b.cycleType&&A(nr(b.cycleType)),$(K)}catch{return}},[r,n]),d.useEffect(()=>{if(typeof window>"u")return;if(!(E==="focus"||E==="reader")||!r){window.localStorage.removeItem(n);return}const b={screenMode:E,session:r,assignment:o,runId:f,runLogs:_,runnerStep:i,cycleType:w};window.localStorage.setItem(n,JSON.stringify(b))},[o,f,_,i,r,w,n,E]),{activeSession:r,setActiveSession:l,activeAssignment:o,setActiveAssignment:p,activeRunId:f,setActiveRunId:x,activeRunLogs:_,setActiveRunLogs:h,activeRunnerStep:i,setActiveRunnerStep:v,screenMode:E,setScreenMode:$,isFinishing:D,setIsFinishing:H,saveState:N,setSaveState:M,preferences:P,setPreferences:g,searchQuery:U,setSearchQuery:W,cycleType:w,setCycleType:A,clearActiveRunState:()=>{l(null),p(null),x(null),h(null),v(0),$("list")}}}const ns=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance",rt=t=>{const s=Number(t);return!Number.isFinite(s)||s<=0?null:s},ar=(t,s)=>{if(!t)return{sets:null,reps:null,percent1rm:null,restSeries:null,restExercise:null};const n={endurance:{sets:t.Nb_series_endurance,reps:t.Nb_reps_endurance,percent1rm:t.pct_1rm_endurance,restSeries:t.recup_endurance,restExercise:t.recup_exercices_endurance},hypertrophie:{sets:t.Nb_series_hypertrophie,reps:t.Nb_reps_hypertrophie,percent1rm:t.pct_1rm_hypertrophie,restSeries:t.recup_hypertrophie,restExercise:t.recup_exercices_hypertrophie},force:{sets:t.Nb_series_force,reps:t.Nb_reps_force,percent1rm:t.pct_1rm_force,restSeries:t.recup_force,restExercise:t.recup_exercices_force}}[s];return{sets:rt(n.sets),reps:rt(n.reps),percent1rm:rt(n.percent1rm),restSeries:rt(n.restSeries),restExercise:rt(n.restExercise)}},ir=(t=[],s)=>{const n=t.filter(l=>l.cycle_type===s),r=n.length?n:t;return Os(r)},Dt=(t=[],s,n)=>ir(t,s).map(r=>{const l=ar(n.get(r.exercise_id),s);return{...r,sets:l.sets??0,reps:l.reps??0,rest_seconds:l.restSeries??0,percent_1rm:l.percent1rm??0}}),or=({runId:t,assignmentId:s,startedAt:n})=>({id:t,assignment_id:s??null,started_at:n,progress_pct:0,status:"in_progress",logs:[]}),rs=t=>({runs:t?[t]:[],pagination:{limit:1,offset:0,total:t?1:0},exercise_summary:[]});function Ir(){const{user:t,userId:s,role:n,selectedAthleteId:r,selectedAthleteName:l}=Ys(),{toast:o}=qt(),p=as(),f=(n==="coach"||n==="admin")&&(r!==null||!!l),x=f?l:t,_=f?r:s,h=_??x,{activeSession:i,setActiveSession:v,activeAssignment:E,setActiveAssignment:$,activeRunId:D,setActiveRunId:H,activeRunLogs:N,setActiveRunLogs:M,activeRunnerStep:P,setActiveRunnerStep:g,screenMode:U,setScreenMode:W,isFinishing:w,setIsFinishing:A,saveState:O,setSaveState:k,preferences:b,setPreferences:K,searchQuery:y,setSearchQuery:ee,cycleType:L,setCycleType:X}=rr({athleteKey:h}),{poolMode:B,largeText:Z}=b,fe=[{value:"endurance",label:"Endurance"},{value:"hypertrophie",label:"Hypertrophie"},{value:"force",label:"Force"}],{data:Ce,isLoading:ue,error:Fe,refetch:c}=Be({queryKey:["assignments",t,"strength"],queryFn:()=>ye.getAssignments(t,s,{assignmentType:"strength"}),enabled:!!t}),{data:G,isLoading:re,error:oe,refetch:te}=Be({queryKey:["strength_catalog"],queryFn:()=>ye.getStrengthSessions()}),{data:me,error:V,refetch:Re}=Be({queryKey:["exercises"],queryFn:()=>ye.getExercises()}),Te=ue||re,He=Fe||oe||V,Ke=()=>{c(),te(),Re()},{data:C}=Be({queryKey:["1rm",t,s],queryFn:()=>ye.get1RM({athleteName:t,athleteId:s}),enabled:!!t}),xe=d.useMemo(()=>{const u={};return(C??[]).forEach(j=>{j.notes&&(u[j.exercise_id]=j.notes)}),u},[C]),De=d.useMemo(()=>me?new Map(me.map(u=>[u.id,u])):new Map,[me]),be=d.useMemo(()=>i?Dt(i.items??[],L,De):[],[i,L,De]),we=at({mutationFn:u=>ye.startStrengthRun(u),onMutate:()=>{k("saving")},onSuccess:u=>{if(k("saved"),setTimeout(()=>k("idle"),2e3),u?.run_id&&(H(u.run_id),M(j=>j??[]),h)){const j=or({runId:u.run_id,assignmentId:E?.id??null,startedAt:new Date().toISOString()});p.setQueryData(["strength_run_in_progress",h],rs(j))}p.invalidateQueries({queryKey:["assignments",t,"strength"]}),p.invalidateQueries({queryKey:["strength_run_in_progress",h]}),p.invalidateQueries({queryKey:["strength_history"]})},onError:()=>{k("error"),setTimeout(()=>k("idle"),3e3),o({title:"Erreur",description:"Impossible de démarrer la séance.",variant:"destructive"})}}),Je=at({mutationFn:u=>ye.logStrengthSet(u),onMutate:()=>{k("saving")},onSuccess:u=>{k("saved"),setTimeout(()=>k("idle"),2e3),u?.one_rm_updated&&(p.invalidateQueries({queryKey:["1rm",t,s]}),o({title:"Nouveau 1RM détecté",description:"Ton record vient d'être mis à jour."}))},onError:()=>{k("error"),setTimeout(()=>k("idle"),3e3),o({title:"Erreur",description:"Impossible d'enregistrer une série.",variant:"destructive"})}}),pe=at({mutationFn:u=>ye.updateStrengthRun(u),onMutate:()=>{k("saving")},onSuccess:(u,j)=>{k("saved"),setTimeout(()=>k("idle"),2e3),A(!1),p.invalidateQueries({queryKey:["strength_history"]}),j?.status==="completed"&&(h&&p.setQueryData(["strength_run_in_progress",h],rs(null)),p.invalidateQueries({queryKey:["assignments",t]}),p.invalidateQueries({queryKey:["assignments",t,"strength"]}),p.invalidateQueries({queryKey:["1rm",t,s]}),$(null),H(null),v(null),M(null),W("list"),o({title:"Séance sauvegardée",description:"Bravo pour l'effort !"}))},onError:(u,j)=>{k("error"),setTimeout(()=>k("idle"),3e3),j?.status==="completed"&&(A(!1),o({title:"Erreur",description:"Impossible d'enregistrer la séance. Réessayez.",variant:"destructive"}))}}),ze=at({mutationFn:u=>ye.updateExerciseNote({athlete_id:s??0,exercise_id:u.exercise_id,notes:u.notes}),onMutate:()=>{k("saving")},onSuccess:()=>{k("saved"),setTimeout(()=>k("idle"),2e3),p.invalidateQueries({queryKey:["1rm",t,s]})},onError:()=>{k("error"),setTimeout(()=>k("idle"),3e3),o({title:"Erreur",description:"Impossible de sauvegarder la note.",variant:"destructive"})}}),qe=(u,j)=>{const de=u.items??[],he=ns(j??u.cycle??de.find(je=>je.cycle_type)?.cycle_type),se=Dt(de,he,De);$(u),v({...u,title:u.title,description:u.description,cycle:he,items:se}),H(null),M(null),g(0),W("reader")},Me=u=>{if((u.items??[]).length===0){o({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}qe(u,L),H(null),M(null)},We=u=>{const j=u.items??[],he=j.filter(je=>je.cycle_type===L).length>0?L:ns(u.cycle??j.find(je=>je.cycle_type)?.cycle_type),se=Dt(j,he,De);if(se.length===0){o({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}v({...u,cycle:he,items:se}),$(null),H(null),M(null),g(0),W("reader")},Qe=async()=>{if(!i)return;if(be.length===0){o({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}const u={...i,cycle:L,items:be};if(v(u),!D){const j=E?.session_id??i?.id??null;if(!j){o({title:"Session manquante",description:"Impossible de démarrer sans session associée.",variant:"destructive"});return}try{const de=await we.mutateAsync({assignment_id:E?.id??null,athlete_id:s??null,athleteName:t??void 0,progress_pct:0,session_id:j,cycle_type:u.cycle});de?.run_id&&(H(de.run_id),M(he=>he??[]))}catch{return}}g(1),W("focus")};return d.useEffect(()=>{if(U!=="reader")return;const u=j=>{j.key==="Escape"&&(j.preventDefault(),W("list"))};return window.addEventListener("keydown",u),()=>window.removeEventListener("keydown",u)},[U]),ue||re?e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Ne,{className:"h-8 w-32"}),e.jsx(Ne,{className:"h-10 w-10 rounded-full"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ne,{className:"h-10 w-32"}),e.jsx(Ne,{className:"h-10 w-32"})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[e.jsx(Ne,{className:"h-9 w-28 rounded-full"}),e.jsx(Ne,{className:"h-9 w-32 rounded-full"}),e.jsx(Ne,{className:"h-9 w-24 rounded-full"})]}),e.jsx(Ne,{className:"h-10 w-full rounded-lg"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((u,j)=>e.jsxs(Ve,{className:"overflow-hidden",children:[e.jsx(vt,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(Ne,{className:"h-5 w-48"}),e.jsx(Ne,{className:"h-4 w-32"})]}),e.jsx(Ne,{className:"h-6 w-20 rounded-full"})]})}),e.jsxs(pt,{className:"space-y-2",children:[e.jsx(Ne,{className:"h-4 w-full"}),e.jsx(Ne,{className:"h-4 w-3/4"})]})]},`skeleton-${j}`))})]}):He?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(hn,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:He.message}),e.jsx(Y,{variant:"default",onClick:()=>Ke(),className:"mt-4 h-12 md:h-10",children:"Réessayer"})]}):e.jsx("div",{className:Se("space-y-4 md:space-y-6",B&&"dark bg-background text-foreground contrast-125",Z&&"text-lg leading-relaxed [&_.text-xs]:text-sm [&_.text-sm]:text-base"),children:U==="focus"&&i?me?e.jsx("div",{className:"animate-in fade-in motion-reduce:animate-none",children:e.jsx(Jn,{session:i,exercises:me,oneRMs:C||[],exerciseNotes:xe,onUpdateNote:(u,j)=>ze.mutate({exercise_id:u,notes:j}),initialLogs:N,initialStep:P,isFinishing:w,onStepChange:u=>g(u),onExitFocus:()=>W("reader"),onStart:async()=>{if(D)return;const u=E?.session_id??i?.id??null;if(!u){o({title:"Session manquante",description:"Impossible de démarrer sans session associée.",variant:"destructive"});return}const j={assignment_id:E?.id??null,athlete_id:s??null,athleteName:t??void 0,progress_pct:0,session_id:u,cycle_type:i?.cycle};try{const de=await we.mutateAsync(j);de?.run_id&&H(de.run_id)}catch{return}},onLogSets:async u=>{D&&(M(j=>[...j??[],...u]),await Promise.all(u.map((j,de)=>Je.mutateAsync({run_id:D,exercise_id:j.exercise_id,set_index:j.set_number??de+1,reps:j.reps??null,weight:j.weight??null,athlete_id:s??null,athlete_name:t??null}))))},onProgress:async u=>{D&&await pe.mutateAsync({run_id:D,progress_pct:u,status:"in_progress"})},onFinish:u=>{D&&(A(!0),pe.mutate({assignment_id:E?.id??void 0,run_id:D,session_id:E?.session_id??i?.id??void 0,athlete_id:s??void 0,date:new Date().toISOString(),progress_pct:100,status:"completed",...u}))}})}):e.jsxs("div",{className:"space-y-4 py-10",children:[e.jsx("div",{className:"mx-auto h-8 w-48 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"mx-auto h-4 w-32 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"space-y-3 pt-4",children:[1,2,3].map(u=>e.jsx("div",{className:"h-20 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},u))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Musculation"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Y,{variant:"ghost",size:"sm","aria-label":"Informations sur le calcul du 1RM",onClick:()=>{window.location.hash="#/records?tab=1rm"},className:"text-muted-foreground",children:[e.jsx(ot,{className:"mr-2 h-4 w-4"})," Info 1RM"]}),e.jsx(Y,{variant:"ghost",size:"icon",onClick:()=>W("settings"),className:"rounded-full border border-muted/50 text-muted-foreground","aria-label":"Paramètres",children:e.jsx(bn,{className:"h-4 w-4"})})]})]}),e.jsxs(Xs,{defaultValue:"start",className:"w-full",children:[e.jsxs(Gs,{className:"grid w-full grid-cols-2",children:[e.jsx(Qt,{value:"start",children:"S'entraîner"}),e.jsx(Qt,{value:"history",children:"Historique"})]}),e.jsxs(Yt,{value:"start",className:"space-y-5 pt-4",children:[U==="list"&&e.jsx(Zn,{user:t,userId:s,athleteName:x,athleteId:_,athleteKey:h,cycleType:L,searchQuery:y,isLoading:Te,setSaveState:k,onCycleChange:X,onSearchChange:ee,onStartAssignment:u=>{u.session_type==="strength"&&Me(u)},onStartCatalog:We,onResumeInProgress:({assignment:u,session:j,runId:de,logs:he,progressPct:se})=>{$(u),v(j),H(de),M(he),g(Is(j?.items??[],he,se)),W("focus")}}),U==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(Y,{variant:"ghost",size:"sm",onClick:()=>W("list"),className:"gap-2",children:[e.jsx(xs,{className:"h-4 w-4"}),"Retour"]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Préférences"}),e.jsx("h2",{className:"text-2xl font-display font-bold uppercase text-primary",children:"Paramètres"})]})]}),e.jsxs(Ve,{className:"border border-muted/60 shadow-sm",children:[e.jsxs(vt,{children:[e.jsx(Bt,{className:"text-lg uppercase",children:"Lisibilité & contrastes"}),e.jsx(is,{children:"Ajuste l'écran pour rester lisible en bassin comme en extérieur."})]}),e.jsxs(pt,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Mode piscine"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Contraste renforcé et lisibilité optimisée."})]}),e.jsx(At,{checked:B,onCheckedChange:u=>K(j=>({...j,poolMode:u}))})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Texte grand"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Police plus large pour lire pendant l'effort."})]}),e.jsx(At,{checked:Z,onCheckedChange:u=>K(j=>({...j,largeText:u}))})]})]})]}),e.jsx(Ve,{className:"border border-muted/60 shadow-sm",children:e.jsxs(pt,{className:"space-y-3 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsx(en,{className:"h-4 w-4"}),e.jsx("span",{children:"Les préférences sont enregistrées sur cet appareil."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs font-semibold uppercase text-muted-foreground",children:[B&&e.jsx(it,{variant:"secondary",children:"Mode piscine activé"}),Z&&e.jsx(it,{variant:"secondary",children:"Texte grand activé"}),!B&&!Z&&e.jsx(it,{variant:"outline",children:"Réglages par défaut"})]})]})})]}),U==="reader"&&i&&me&&e.jsx(tr,{session:i,assignment:E,cycleType:L,cycleOptions:fe,exercises:me,oneRMs:C||[],saveState:O,onBack:()=>W("list"),onLaunch:Qe})]}),e.jsx(Yt,{value:"history",className:"space-y-4 pt-4",children:e.jsx(sr,{athleteName:x,athleteId:_,athleteKey:h})})]})]})})}export{Ir as default};
