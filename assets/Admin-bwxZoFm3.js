import{l as B,u as k,M as ne,N as ce,m as de,a as oe,Q as _,j as e,ak as me,C as R,g as U,h as M,a0 as F,i as T,Z as o,_ as C,B as P,S as q,b as L,d as z,e as V,f as i,k as N,al as ue}from"./index-DqxBy9a5.js";import{S as he}from"./switch-hqlgzcSF.js";import{B as b}from"./badge-CiNZkEw9.js";import{T as xe,a as je,b as ee,c as u,d as pe,e as h}from"./table-CD3Q3imF.js";import{S as ve}from"./search-DjwwSfRc.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ge=B("shield-check",fe);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Ce=B("user-minus",ye);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],be=B("user-plus",Ne),se=["athlete","coach","comite","admin"],Q=l=>!(l===!1||l===0),we=(l,t,w)=>l.map(m=>m.id===t?{...m,role:w}:m),D=(l,t)=>ue(l,t).message;function _e(){const{useMemo:l,useState:t}=de,w=typeof window>"u"?k.getState().role:k(s=>s.role),m=k(s=>s.userId),{toast:c}=ne(),x=ce(),[A,ae]=t(""),[j,ie]=t("all"),[p,te]=t(!1),[v,re]=t(null),[S,H]=t(""),[K,$]=t(""),[G,O]=t(""),[Z,J]=t(null),W=w==="admin",{data:d=[],isLoading:le}=oe({queryKey:["admin-users",p],queryFn:()=>N.listUsers({includeInactive:p}),enabled:W}),E=_({mutationFn:s=>N.createCoach(s),onMutate:()=>{J(null)},onSuccess:s=>{x.invalidateQueries({queryKey:["admin-users"]}),H(""),$(""),O(""),J(s.initialPassword??null),c({title:"Coach créé"})},onError:s=>{c({title:"Erreur création coach",description:D(s,"Impossible de créer le coach.")})}}),f=_({mutationFn:s=>N.updateUserRole(s),onSuccess:(s,a)=>{x.setQueryData(["admin-users",p],n=>n&&we(n,a.userId,a.role)),x.invalidateQueries({queryKey:["admin-users"]}),c({title:"Rôle mis à jour"})},onError:s=>{c({title:"Erreur mise à jour rôle",description:D(s,"Impossible de mettre à jour le rôle.")})}}),X=_({mutationFn:s=>N.disableUser(s),onSuccess:()=>{x.invalidateQueries({queryKey:["admin-users"]}),c({title:"Compte désactivé"})},onError:s=>{c({title:"Erreur désactivation",description:D(s,"Impossible de désactiver le compte.")})}}),g=l(()=>d.find(a=>a.role==="admin")?.id??null,[d]),Y=l(()=>{const s=A.trim().toLowerCase();return d.filter(a=>{if(j!=="all"&&a.role!==j)return!1;const n=a.display_name?.toLowerCase()??"",I=a.email?.toLowerCase()??"";return!(s&&!n.includes(s)&&!I.includes(s))})},[d,j,A]),r=l(()=>v?d.find(s=>s.id===v)??null:null,[v,d]);return W?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Administration"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ge,{className:"h-4 w-4 text-primary"}),e.jsx("span",{children:"Accès admin"})]})]}),e.jsxs(R,{children:[e.jsxs(U,{children:[e.jsx(M,{children:"Créer un coach"}),e.jsx(F,{children:"Laissez le mot de passe vide pour en générer un automatiquement (affiché une seule fois)."})]}),e.jsx(T,{children:e.jsxs("form",{className:"space-y-4",onSubmit:s=>{s.preventDefault();const a=S.trim();a&&E.mutate({display_name:a,email:K.trim()||void 0,password:G||void 0})},children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"coach-create-name",children:"Nom affiché"}),e.jsx(C,{id:"coach-create-name",value:S,onChange:s=>H(s.target.value),placeholder:"Ex: Coach Martin",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"coach-create-email",children:"Email"}),e.jsx(C,{id:"coach-create-email",type:"email",value:K,onChange:s=>$(s.target.value),placeholder:"coach@email.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"coach-create-password",children:"Mot de passe (optionnel)"}),e.jsx(C,{id:"coach-create-password",type:"text",value:G,onChange:s=>O(s.target.value),placeholder:"Laisser vide pour auto"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(P,{type:"submit",disabled:!S.trim()||E.isPending,children:E.isPending?"Création...":"Créer le coach"}),Z?e.jsxs("div",{className:"rounded-md border border-primary/30 bg-primary/5 px-4 py-2 text-sm",children:[e.jsx("p",{className:"font-medium text-primary",children:"Mot de passe initial (à copier)"}),e.jsx("p",{className:"font-mono",children:Z})]}):null]})]})})]}),e.jsxs(R,{children:[e.jsxs(U,{children:[e.jsx(M,{children:"Gestion des comptes"}),e.jsx(F,{children:"Mettre à jour les rôles, filtrer et désactiver les comptes."})]}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(o,{htmlFor:"admin-search",children:"Recherche"}),e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(C,{id:"admin-search",value:A,onChange:s=>ae(s.target.value),placeholder:"Nom ou email",className:"pl-9"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Rôle"}),e.jsxs(q,{value:j,onValueChange:s=>ie(s),children:[e.jsx(L,{children:e.jsx(z,{placeholder:"Tous"})}),e.jsxs(V,{children:[e.jsx(i,{value:"all",children:"Tous"}),e.jsx(i,{value:"athlete",children:"Athlète"}),e.jsx(i,{value:"coach",children:"Entraineur EAC"}),e.jsx(i,{value:"comite",children:"Comité"}),e.jsx(i,{value:"admin",children:"Admin"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{checked:p,onCheckedChange:te,id:"inactive-toggle"}),e.jsx(o,{htmlFor:"inactive-toggle",className:"text-sm",children:"Inclure désactivés"})]})]}),le?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Chargement des utilisateurs..."}):Y.length?e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs(xe,{children:[e.jsx(je,{children:e.jsxs(ee,{children:[e.jsx(u,{children:"Utilisateur"}),e.jsx(u,{children:"Email"}),e.jsx(u,{children:"Rôle"}),e.jsx(u,{children:"Statut"}),e.jsx(u,{className:"text-right",children:"Actions"})]})}),e.jsx(pe,{children:Y.map(s=>{const a=Q(s.is_active),n=m===s.id,I=g!==null&&g!==s.id;return e.jsxs(ee,{"data-selected":v===s.id,children:[e.jsx(h,{className:"font-medium",children:e.jsx(P,{variant:"ghost",size:"sm",className:"px-2",onClick:()=>re(s.id),children:s.display_name})}),e.jsx(h,{className:"text-sm text-muted-foreground",children:s.email||"-"}),e.jsx(h,{children:e.jsxs(q,{value:s.role,onValueChange:y=>{se.includes(y)&&s.id&&y!==s.role&&f.mutate({userId:s.id,role:y})},disabled:!a||f.isPending,children:[e.jsx(L,{className:"w-[140px]",children:e.jsx(z,{})}),e.jsxs(V,{children:[e.jsx(i,{value:"athlete",children:"Athlète"}),e.jsx(i,{value:"coach",children:"Entraineur EAC"}),e.jsx(i,{value:"comite",children:"Comité"}),e.jsx(i,{value:"admin",disabled:I,children:"Admin"})]})]})}),e.jsx(h,{children:a?e.jsx(b,{variant:"secondary",children:"Actif"}):e.jsx(b,{variant:"outline",children:"Désactivé"})}),e.jsx(h,{className:"text-right",children:e.jsxs(P,{variant:"destructive",size:"sm",onClick:()=>{if(!s.id)return;if(n){c({title:"Action impossible",description:"Vous ne pouvez pas désactiver votre propre compte."});return}window.confirm(`Confirmer la désactivation du compte "${s.display_name}" ?`)&&X.mutate({userId:s.id})},disabled:!a||X.isPending||n,children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),"Désactiver"]})})]},s.id)})})]})}):e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(be,{className:"h-4 w-4"}),"Aucun utilisateur ne correspond à votre recherche."]})]})]}),e.jsxs(R,{children:[e.jsxs(U,{children:[e.jsx(M,{children:"Fiche utilisateur"}),e.jsx(F,{children:"Sélectionnez un compte pour afficher les détails."})]}),e.jsx(T,{children:r?e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nom affiché"}),e.jsx("p",{className:"text-lg font-semibold",children:r.display_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Email"}),e.jsx("p",{children:r.email||"-"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Rôle"}),e.jsxs(q,{value:r.role,onValueChange:s=>{se.includes(s)&&r.id&&s!==r.role&&f.mutate({userId:r.id,role:s})},disabled:!Q(r.is_active)||f.isPending,children:[e.jsx(L,{className:"w-[180px]",children:e.jsx(z,{})}),e.jsxs(V,{children:[e.jsx(i,{value:"athlete",children:"Athlète"}),e.jsx(i,{value:"coach",children:"Entraineur EAC"}),e.jsx(i,{value:"comite",children:"Comité"}),e.jsx(i,{value:"admin",disabled:g!==null&&g!==r.id,children:"Admin"})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Statut"}),Q(r.is_active)?e.jsx(b,{variant:"secondary",children:"Actif"}):e.jsx(b,{variant:"outline",children:"Désactivé"})]}),r.group_label?e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Groupe"}),e.jsx("p",{children:r.group_label})]}):null]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun utilisateur sélectionné."})})]})]}):typeof window>"u"?null:e.jsx(me,{to:"/"})}export{_e as default,we as updateUserRoleInList};
