import{r as x,j as e}from"./vendor-ui-M0btmmZ9.js";import{u as cs,f as ms,C as H,i as X,B as y,W as $,D as ke,T as re,L as k,I as T,X as le,t as Ee,l as us,d as w}from"./index-CXQODy_x.js";import{b as xs,u as z,c as A}from"./vendor-query-CwV3kFk7.js";import{T as ie}from"./textarea-C6HM5vnF.js";import{T as ps,a as hs,b as Fe,c as Ie}from"./tabs-DQG8w_8x.js";import{S as fs,a as gs,b as bs,c as js,d as Re}from"./select-DgcaMAHn.js";import{shouldShowRecords as vs}from"./Profile-By7REL8a.js";import{s as ae,l as oe,f as Ns,b as ys}from"./animations-BOwBtprP.js";import{C as ws}from"./circle-alert-DU4AuKaT.js";import{C as Me}from"./clock-CIIny6Rz.js";import{m as E}from"./proxy-C_NwhSmp.js";import{P as Te}from"./pen-CV4wiS0r.js";import{C as de}from"./check-CkihZxKH.js";import{C as Pe}from"./chevron-up-Bz0QCRMN.js";import{R as Ss,g as _s,C as Cs,X as ks,Y as Es,T as Fs,f as Is}from"./vendor-charts-iZXyRt0a.js";import{S as Rs}from"./sticky-note-BJPAqTgV.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-B7dJFgIA.js";import"./badge-BEZPlI7-.js";import"./sheet-DZegwEsj.js";import"./types-EV_ysAoj.js";import"./save-D9cS9NDU.js";import"./chevron-right-ghgE02Z9.js";import"./design-tokens-CGMys_0P.js";const F=(...o)=>o.filter(Boolean).join(" ");function Y(o){if(!o)return"—";const a=new Date(o);return Number.isNaN(a.getTime())?o:a.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"2-digit"})}function D(o){if(o==null)return"—";const a=Math.round(Math.max(0,o*1e3)),g=Math.floor(a/6e4),p=Math.floor(a%6e4/1e3),j=Math.floor(a%1e3/10);return g>0?`${g}:${String(p).padStart(2,"0")}.${String(j).padStart(2,"0")}`:`${p}.${String(j).padStart(2,"0")}`}function Ms(o){const a=o.trim();if(!a)return null;if(a.includes(":")){const[p,j]=a.split(":"),N=Number(p);if(!Number.isFinite(N)||N<0)return null;const I=j.replace(",","."),_=Number(I);return!Number.isFinite(_)||_<0?null:N*60+_}const g=Number(a.replace(",","."));return!Number.isFinite(g)||g<0?null:g}function Ts(o){if(!o)return null;const a=o.match(/FFN\s*\((\d+)\s*pts\)/i);if(!a)return null;const g=Number(a[1]);return Number.isFinite(g)?g:null}function Ps({value:o,placeholder:a,onSave:g,onCancel:p,inputMode:j="decimal",hint:N}){const[I,_]=x.useState(o);return x.useEffect(()=>{_(o)},[o]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(T,{value:I,onChange:l=>_(l.target.value),placeholder:a,inputMode:j,className:"h-10 rounded-xl",autoFocus:!0}),N?e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:N}):null]}),e.jsx(y,{type:"button",onClick:()=>g(I),className:"h-10 w-10 p-0 rounded-xl","aria-label":"Valider",children:e.jsx(de,{className:"h-5 w-5"})}),e.jsx(y,{type:"button",variant:"outline",onClick:p,className:"h-10 w-10 p-0 rounded-xl","aria-label":"Annuler",children:e.jsx(le,{className:"h-5 w-5"})})]})})}const S=()=>e.jsx("div",{className:"h-10 rounded-xl bg-muted animate-pulse motion-reduce:animate-none"});function at(){const{user:o,userId:a,role:g}=cs(),{toast:p}=ms(),j=xs(),N={id:null,event_name:"",pool_length:"",time_seconds:"",record_date:"",notes:""},[I,_]=x.useState(()=>{const s=window.location.hash,t=s.indexOf("?");return t>=0&&new URLSearchParams(s.substring(t)).get("tab")==="1rm"?"1rm":"swim"}),[l,v]=x.useState(N),[m,Le]=x.useState("training"),[P,qe]=x.useState(25),[ce,K]=x.useState(null),[$e,me]=x.useState(null),[ze,ue]=x.useState(""),[Ae,De]=x.useState(null),[Ke,Q]=x.useState(null),[xe,L]=x.useState(""),[V,Qe]=x.useState(25),[B,Ve]=x.useState(null),[Be,pe]=x.useState(!1),R=vs(g);x.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[]);const he=s=>{const t=s?.pool_length??s?.poolLength??s?.poolLen??s?.pool;if(t==null)return null;if(typeof t=="number")return t===25||t===50?t:null;const i=String(t).match(/\b(25|50)\b/);if(!i)return null;const r=Number(i[1]);return r===25||r===50?r:null},G=z({queryKey:["1rm",o,a],queryFn:()=>w.get1RM({athleteName:o,athleteId:a}),enabled:!!o&&R}),J=z({queryKey:["exercises"],queryFn:()=>w.getExercises(),enabled:R}),Z=z({queryKey:["swim-records",a,o],queryFn:()=>w.getSwimRecords({athleteId:a??void 0,athleteName:o??void 0}),enabled:!!o&&R}),M=z({queryKey:["profile",a],queryFn:()=>w.getProfile({userId:a??void 0}),enabled:!!a&&R}),C=String(M.data?.ffn_iuf??"").trim(),fe=G.error||J.error||Z.error||M.error,Oe=()=>{G.refetch(),J.refetch(),Z.refetch(),M.refetch()},ee=z({queryKey:["swimmer-performances",a,C,V],queryFn:()=>w.getSwimmerPerformances({userId:a??void 0,iuf:C||void 0,poolLength:V}),enabled:!!C&&R&&m==="history"}),{data:se,isLoading:Ue,isError:We}=ee,O=A({mutationFn:()=>{if(!C)throw new Error("IUF FFN manquant. Ajoutez-le dans votre profil.");return w.importSwimmerPerformances({iuf:C,userId:a??void 0})},onSuccess:s=>{j.invalidateQueries({queryKey:["swimmer-performances"]}),p({title:"Import terminé",description:`${s.total_found} trouvée(s), ${s.new_imported} importée(s), ${s.already_existed} déjà existante(s)`}),pe(!0),setTimeout(()=>pe(!1),2e3)},onError:s=>{p({title:"Import impossible",description:String(s?.message||s),variant:"destructive"})}}),U=x.useMemo(()=>{if(!se?.length)return[];const s=new Map;for(const r of se){const n=s.get(r.event_code)??[];n.push(r),s.set(r.event_code,n)}const t=r=>r.toLowerCase().replace(/\./g,"").replace(/\s+/g," ").trim(),d=r=>{const n=t(r);return n.includes("nl")||n.includes("nage libre")?0:n.includes("dos")?1:n.includes("bra")||n.includes("brasse")?2:n.includes("pap")||n.includes("papillon")?3:n.includes("4n")||n.includes("4 n")||n.includes("4 nages")?4:99},i=r=>{const n=r.match(/^(\d+)/);return n?Number(n[1]):1/0};return[...s.entries()].map(([r,n])=>{const u=[...n].sort((f,c)=>(c.competition_date??"").localeCompare(f.competition_date??"")),h=u.reduce((f,c)=>c.time_seconds<f.time_seconds?c:f,u[0]);return{eventCode:r,performances:u,bestTime:h.time_seconds,bestId:h.id}}).sort((r,n)=>{const u=d(r.eventCode),h=d(n.eventCode);return u!==h?u-h:i(r.eventCode)-i(n.eventCode)})},[se]),ge=x.useMemo(()=>{if(!B)return[];const s=U.find(t=>t.eventCode===B);return s?[...s.performances].filter(t=>t.competition_date).sort((t,d)=>(t.competition_date??"").localeCompare(d.competition_date??"")).map(t=>({date:Y(t.competition_date),time:t.time_seconds,display:t.time_display??D(t.time_seconds)})):[]},[B,U]),{data:He,isLoading:Xe,isError:Ye}=G,{data:Ge,isLoading:Je,isError:Ze}=J,{data:be,isLoading:es,isFetching:Ls,isError:ss,refetch:ts}=Z,ns=()=>{ts()};x.useEffect(()=>{m==="comp"&&ns()},[m]);const je=A({mutationFn:s=>w.update1RM({...s,athlete_id:a,athlete_name:o}),onSuccess:()=>{j.invalidateQueries({queryKey:["1rm"]}),p({title:"1RM mis à jour"})}}),ve=A({mutationFn:s=>w.updateExerciseNote({athlete_id:a,exercise_id:s.exercise_id,notes:s.notes}),onSuccess:()=>{j.invalidateQueries({queryKey:["1rm"]}),p({title:"Note mise à jour"})}}),te=A({mutationFn:s=>w.upsertSwimRecord(s),onSuccess:()=>{j.invalidateQueries({queryKey:["swim-records"]}),v(N),K(null),p({title:"Record mis à jour"})}});A({mutationFn:s=>w.syncFfnSwimRecords({athleteId:a??void 0,athleteName:o??void 0,iuf:s}),onSuccess:s=>{j.invalidateQueries({queryKey:["swim-records"]}),p({title:"Synchro FFN terminée",description:`${s?.inserted??0} ajouté(s), ${s?.updated??0} mis à jour, ${s?.skipped??0} inchangé(s)`})},onError:s=>{p({title:"Synchro FFN impossible",description:String(s?.message||s),variant:"destructive"})}});const W=()=>{v(N),K(null)},rs=s=>{const t=he(s);v({id:s.id,event_name:s.event_name??"",pool_length:t?String(t):"",time_seconds:s.time_seconds!=null?D(Number(s.time_seconds)):"",record_date:s.record_date?String(s.record_date).split("T")[0]:"",notes:s.notes??""}),K(s.id)},Ne=()=>{if(!l.event_name.trim()){p({title:"Nom d'épreuve requis",variant:"destructive"});return}if(!l.pool_length){p({title:"Bassin requis",variant:"destructive"});return}const s=Ms(l.time_seconds);if(s===null){p({title:"Temps invalide",description:"Ex: 1:02.34 ou 62.34",variant:"destructive"});return}te.mutate({id:l.id||null,athlete_id:a,athleteName:o,athlete_name:o,event_name:l.event_name,pool_length:parseInt(l.pool_length,10),time_seconds:s,record_date:l.record_date||null,notes:l.notes||null,record_type:m})},is=s=>{s.preventDefault(),Ne()},ye=x.useMemo(()=>(be?.records??[]).filter(d=>{const i=he(d);if(!i||i!==P)return!1;const r=String(d.record_type??"training");return m==="comp"?r==="comp":r==="training"}).sort((d,i)=>{const r=String(d.event_name??""),n=String(i.event_name??""),u=q=>String(q??"").toLowerCase().replace(/\./g,"").replace(/\s+/g," ").trim(),h=q=>{const b=u(q);return b.includes("nl")||b.includes("nage libre")?0:b.includes("dos")?1:b.includes("bra")||b.includes("brasse")?2:b.includes("pap")||b.includes("papillon")?3:b.includes("4n")||b.includes("4 n")||b.includes("4 nages")?4:99},f=q=>{const b=String(q??"").match(/^(\d+)/);return b?Number(b[1]):Number.POSITIVE_INFINITY},c=h(r),Se=h(n);if(c!==Se)return c-Se;const _e=f(r),Ce=f(n);return _e!==Ce?_e-Ce:u(r).localeCompare(u(n),"fr")}),[be,P,m]),as=()=>{v({...N,pool_length:String(P)}),K("add")},ne=s=>{Le(s),W()},os=()=>{qe(s=>s===25?50:25),W()},ls=(s,t)=>{me(s),ue(t!=null&&Number(t)>0?String(t):"")},we=()=>{me(null),ue("")},ds=(s,t)=>{const d=Number(String(t??"").replace(",","."));if(!Number.isFinite(d)||d<=0){p({title:"Valeur invalide",description:"Entrez un nombre > 0",variant:"destructive"});return}je.mutate({exercise_id:s,one_rm:d}),we()};return R?fe?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(ws,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:fe.message}),e.jsx(y,{onClick:()=>Oe(),className:"mt-4",children:"Réessayer"})]}):e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg",children:[e.jsx("div",{className:"sticky top-0 z-20 scroll-mt-16 backdrop-blur bg-background/80 border-b border-border",children:e.jsxs("div",{className:"px-4 pt-4 pb-3",children:[e.jsx("div",{className:"text-xl font-semibold tracking-tight",children:"Records"}),e.jsx("div",{className:"mt-0.5 text-sm text-muted-foreground",children:"Natation & 1RM musculation"})]})}),e.jsx("div",{className:"px-2 sm:px-4 pt-3",children:e.jsxs(ps,{value:I,onValueChange:s=>_(s),children:[e.jsxs(hs,{className:"w-full rounded-3xl bg-muted/60 border border-border shadow-sm p-1.5 flex",children:[e.jsxs(Fe,{value:"swim","aria-label":"Records de natation",className:`flex-1 rounded-2xl px-4 py-2.5 text-sm font-semibold uppercase tracking-wide gap-2
                  data-[state=active]:bg-background data-[state=active]:text-foreground
                  data-[state=inactive]:text-muted-foreground`,children:[e.jsx($,{className:"h-4 w-4"}),"Natation"]}),e.jsxs(Fe,{value:"1rm","aria-label":"Records de musculation",className:`flex-1 rounded-2xl px-4 py-2.5 text-sm font-semibold uppercase tracking-wide gap-2
                  data-[state=active]:bg-background data-[state=active]:text-foreground
                  data-[state=inactive]:text-muted-foreground`,children:[e.jsx(ke,{className:"h-4 w-4"}),"Musculation"]})]}),I==="swim"?e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"w-full rounded-2xl bg-muted/25 border border-border/60 p-1 flex",children:[e.jsxs("button",{type:"button",onClick:()=>ne("training"),className:F("flex-1 rounded-2xl px-3 py-2 text-sm max-[360px]:text-xs font-semibold transition inline-flex items-center justify-center gap-2 whitespace-nowrap",m==="training"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),"aria-pressed":m==="training",children:[e.jsx(re,{className:"h-4 w-4 max-[360px]:hidden"}),"Entraînement"]}),e.jsxs("button",{type:"button",onClick:()=>ne("comp"),className:F("flex-1 rounded-2xl px-3 py-2 text-sm max-[360px]:text-xs font-semibold transition inline-flex items-center justify-center gap-2 whitespace-nowrap",m==="comp"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),"aria-pressed":m==="comp",children:[e.jsx($,{className:"h-4 w-4 max-[360px]:hidden"}),"Compétition"]}),e.jsxs("button",{type:"button",onClick:()=>ne("history"),className:F("flex-1 rounded-2xl px-3 py-2 text-sm max-[360px]:text-xs font-semibold transition inline-flex items-center justify-center gap-2 whitespace-nowrap",m==="history"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),"aria-pressed":m==="history",children:[e.jsx(Me,{className:"h-4 w-4 max-[360px]:hidden"}),"Historique"]})]})}):null,e.jsxs(Ie,{value:"swim",className:"mt-0",children:[m!=="history"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-5 mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted/50 border border-border flex items-center justify-center",children:m==="training"?e.jsx(re,{className:"h-5 w-5"}):e.jsx($,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-sm font-semibold",children:[m==="training"?"Records entraînement":"Records compétition"," "]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:os,className:"inline-flex items-center gap-2 whitespace-nowrap rounded-2xl bg-muted/25 border border-border/60 px-3 py-2 text-sm font-semibold active:scale-[0.99] transition cursor-pointer focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary","aria-label":"Changer le bassin",title:"Appuie pour basculer 25m / 50m",children:[e.jsx("span",{className:"inline-flex items-center justify-center h-6 w-6 rounded-xl bg-background/60 border border-border",children:e.jsx($,{className:"h-4 w-4"})}),e.jsxs("span",{className:"tabular-nums",children:[P,"m"]})]}),m!=="comp"?e.jsx(y,{type:"button",size:"sm",onClick:as,className:"rounded-2xl",children:"Ajouter"}):null]})]}),m==="comp"?e.jsx("div",{className:"-mt-1 mb-2 text-xs text-muted-foreground",children:"Records fédération (lecture seule)."}):null,e.jsx(H,{className:"w-full min-w-0 rounded-2xl",children:e.jsx(X,{className:"p-0",children:es?e.jsxs("div",{className:"p-4 grid gap-3",children:[e.jsx(S,{}),e.jsx(S,{}),e.jsx(S,{})]}):ss?e.jsx("div",{className:"mx-4 my-4 rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:"Impossible de charger les records natation."}):ye.length===0?e.jsxs("div",{className:"px-4 py-6 text-sm text-muted-foreground",children:["Aucun record en bassin ",P,"m."]}):e.jsx(E.div,{className:"divide-y divide-border motion-reduce:animate-none",variants:ae,initial:"hidden",animate:"visible",children:ye.map(s=>{const t=ce===s.id,d=D(s.time_seconds),i=Y(s.record_date),r=(s.notes??"").trim(),n=s?.ffn_points??s?.ffnPoints??s?.points??s?.pts??null,u=n==null?NaN:Number(n),h=Number.isFinite(u)?u:Ts(s?.notes),f=(s?.meet??s?.meet_name??s?.meetName??s?.competition??"").trim?.()??"";return e.jsxs(E.div,{className:"px-3 py-2.5 motion-reduce:animate-none",variants:oe,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-sm font-semibold truncate",children:s.event_name}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:"font-mono text-primary font-bold tabular-nums text-sm",children:d}),m==="training"&&e.jsx("button",{type:"button",onClick:()=>rs(s),className:"inline-flex items-center justify-center h-8 w-8 rounded-xl text-muted-foreground hover:text-foreground hover:bg-muted/60 transition","aria-label":`Modifier ${s.event_name}`,children:e.jsx(Te,{className:"h-3.5 w-3.5"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5 text-xs text-muted-foreground",children:[m==="comp"&&h!=null&&e.jsxs("span",{className:"tabular-nums",children:[String(h)," pts"]}),e.jsx("span",{className:"tabular-nums",children:i}),m==="comp"&&f&&e.jsx("span",{className:"truncate",children:f}),m==="training"&&r&&e.jsx("span",{className:"truncate italic",children:r})]}),m==="training"&&t?e.jsx(E.div,{className:"mt-3",variants:Ns,initial:"hidden",animate:"visible",children:e.jsxs("div",{className:"rounded-2xl bg-muted/30 border border-border p-4 space-y-4",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Temps"}),e.jsx(T,{value:l.time_seconds,inputMode:"decimal",placeholder:"1:02.34",onChange:c=>v({...l,time_seconds:c.target.value}),className:"rounded-xl"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Format: mm:ss.cc ou secondes"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Date"}),e.jsx(T,{type:"date",value:l.record_date,onChange:c=>v({...l,record_date:c.target.value}),className:"rounded-xl"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Notes"}),e.jsx(ie,{value:l.notes,onChange:c=>v({...l,notes:c.target.value}),rows:2,className:"rounded-xl"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs(y,{type:"button",size:"sm",variant:"outline",onClick:W,className:"rounded-2xl gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),"Annuler"]}),e.jsxs(y,{type:"button",size:"sm",onClick:Ne,disabled:te.isPending,className:"rounded-2xl gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Enregistrer"]})]})]})}):null]},s.id)})})})}),m==="training"&&ce==="add"?e.jsx("div",{className:"px-4 mt-4",children:e.jsx("form",{onSubmit:is,children:e.jsxs("div",{className:"rounded-2xl border border-border p-4 space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Épreuve"}),e.jsx(T,{value:l.event_name,onChange:s=>v({...l,event_name:s.target.value}),placeholder:"Ex: 100 NL, 200 Dos",className:"rounded-xl"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Bassin (m)"}),e.jsxs(fs,{value:l.pool_length,onValueChange:s=>v({...l,pool_length:s}),children:[e.jsx(gs,{className:"rounded-xl",children:e.jsx(bs,{placeholder:"Choisir"})}),e.jsxs(js,{children:[e.jsx(Re,{value:"25",children:"25"}),e.jsx(Re,{value:"50",children:"50"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Temps"}),e.jsx(T,{value:l.time_seconds,inputMode:"decimal",placeholder:"1:02.34",onChange:s=>v({...l,time_seconds:s.target.value}),className:"rounded-xl"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Date"}),e.jsx(T,{type:"date",value:l.record_date,onChange:s=>v({...l,record_date:s.target.value}),className:"rounded-xl"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{children:"Notes"}),e.jsx(ie,{value:l.notes,onChange:s=>v({...l,notes:s.target.value}),rows:3,className:"rounded-xl"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(y,{type:"button",variant:"outline",onClick:W,className:"rounded-2xl",children:"Annuler"}),e.jsx(y,{type:"submit",disabled:te.isPending,className:"rounded-2xl",children:"Ajouter"})]})]})})}):null]}):null,m==="history"?e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted/50 border border-border flex items-center justify-center",children:e.jsx(Me,{className:"h-5 w-5"})}),e.jsx("div",{className:"text-sm font-semibold",children:"Historique FFN"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{type:"button",onClick:()=>Qe(s=>s===25?50:25),className:"inline-flex items-center gap-2 whitespace-nowrap rounded-2xl bg-muted/25 border border-border/60 px-3 py-2 text-sm font-semibold active:scale-[0.99] transition cursor-pointer focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary","aria-label":"Changer le bassin",children:[e.jsx("span",{className:"inline-flex items-center justify-center h-6 w-6 rounded-xl bg-background/60 border border-border",children:e.jsx($,{className:"h-4 w-4"})}),e.jsxs("span",{className:"tabular-nums",children:[V,"m"]})]})})]}),M.isError?e.jsx("div",{className:"rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:"Impossible de charger votre profil. Vérifiez votre connexion et rechargez la page."}):null,!M.isError&&!C&&!M.isLoading?e.jsxs("div",{className:"rounded-lg border border-yellow-500/20 bg-yellow-500/10 p-4 text-sm text-yellow-700 dark:text-yellow-400",children:[e.jsx("p",{className:"font-semibold mb-1",children:"IUF FFN non renseigné"}),e.jsxs("p",{children:["Pour importer vos performances depuis la FFN, renseignez votre numéro IUF dans"," ",e.jsx("a",{href:"/#/profile",className:"underline underline-offset-2 font-medium hover:text-foreground",children:"votre profil"}),"."]})]}):null,e.jsx(E.div,{variants:ys,animate:Be?"visible":"hidden",className:"w-full",children:e.jsxs(y,{type:"button",onClick:()=>O.mutate(),disabled:O.isPending||!C,className:"w-full rounded-2xl gap-2",children:[O.isPending?e.jsx(Ee,{className:"h-4 w-4 animate-spin"}):e.jsx(us,{className:"h-4 w-4"}),O.isPending?"Import en cours...":"Importer mes performances FFN"]})}),Ue?e.jsxs("div",{className:"grid gap-3",children:[e.jsx(S,{}),e.jsx(S,{}),e.jsx(S,{})]}):We?e.jsxs("div",{className:"rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:[e.jsx("p",{className:"font-semibold",children:"Impossible de charger les performances"}),e.jsx("p",{className:"mt-1 text-xs",children:ee.error instanceof Error?ee.error.message:"Vérifiez votre connexion internet et réessayez."})]}):U.length===0?e.jsx("div",{className:"px-4 py-6 text-sm text-muted-foreground",children:C?'Aucune performance trouvée. Cliquez sur "Importer" pour récupérer vos données FFN.':"Ajoutez votre IUF FFN dans votre profil pour commencer."}):e.jsx(E.div,{className:"space-y-2 motion-reduce:animate-none",variants:ae,initial:"hidden",animate:"visible",children:U.map(s=>{const t=B===s.eventCode,d=()=>Ve(t?null:s.eventCode);return e.jsx(E.div,{variants:oe,children:e.jsx(H,{className:"rounded-2xl",children:e.jsxs(X,{className:"p-0",children:[e.jsxs("button",{type:"button",onClick:d,className:"w-full flex items-center justify-between gap-2 px-3 py-3 text-left cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(Pe,{className:F("h-4 w-4 shrink-0 text-muted-foreground transition-transform",t&&"rotate-180")}),e.jsx("span",{className:"text-sm font-semibold truncate",children:s.eventCode})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:"font-mono text-primary font-bold tabular-nums text-sm",children:D(s.bestTime)}),e.jsx("span",{className:"inline-flex items-center justify-center h-5 min-w-5 px-1.5 rounded-full bg-muted text-xs font-semibold tabular-nums text-muted-foreground",children:s.performances.length})]})]}),t?e.jsxs("div",{className:"border-t border-border",children:[ge.length>1?e.jsxs("div",{className:"px-2 pt-3 pb-1",children:[e.jsxs("div",{className:"text-xs text-muted-foreground mb-2 px-2",children:["Progression (",V,"m)"]}),e.jsx(Ss,{width:"100%",height:160,children:e.jsxs(_s,{data:ge,margin:{top:5,right:10,left:0,bottom:5},children:[e.jsx(Cs,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(ks,{dataKey:"date",tick:{fontSize:10},className:"text-muted-foreground"}),e.jsx(Es,{domain:["auto","auto"],tick:{fontSize:10},className:"text-muted-foreground",reversed:!0,tickFormatter:i=>{const r=Math.floor(i/60),n=Math.floor(i%60),u=Math.round(i%1*100);return r>0?`${r}:${String(n).padStart(2,"0")}`:`${n}.${String(u).padStart(2,"0")}`}}),e.jsx(Fs,{formatter:i=>{const r=Math.floor(i/60),n=Math.floor(i%60),u=Math.round(i%1*100);return[r>0?`${r}:${String(n).padStart(2,"0")}.${String(u).padStart(2,"0")}`:`${n}.${String(u).padStart(2,"0")}`,"Temps"]},labelStyle:{fontSize:11},contentStyle:{borderRadius:12,fontSize:12}}),e.jsx(Is,{type:"monotone",dataKey:"time",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{r:3},activeDot:{r:5}})]})})]}):null,e.jsx("div",{className:"divide-y divide-border",children:s.performances.map(i=>{const r=i.id===s.bestId;return e.jsxs("div",{className:F("px-3 py-2.5",r&&"bg-primary/5"),children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[r&&e.jsx(re,{className:"h-3.5 w-3.5 text-primary shrink-0"}),e.jsx("span",{className:"text-xs text-muted-foreground tabular-nums",children:Y(i.competition_date)})]}),e.jsx("span",{className:F("font-mono tabular-nums text-sm shrink-0",r?"text-primary font-bold":"font-medium"),children:i.time_display??D(i.time_seconds)})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-0.5 text-xs text-muted-foreground",children:[i.ffn_points!=null&&e.jsxs("span",{className:"tabular-nums",children:[String(i.ffn_points)," pts"]}),i.competition_name&&e.jsx("span",{className:"truncate",children:i.competition_name})]})]},i.id)})})]}):null]})})},s.eventCode)})})]}):null,e.jsx("div",{className:"h-10"})]}),e.jsxs(Ie,{value:"1rm",className:"mt-0",children:[e.jsx("div",{className:"mt-5 mb-2 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted/50 border border-border flex items-center justify-center",children:e.jsx(ke,{className:"h-5 w-5"})}),e.jsx("div",{className:"text-sm font-semibold",children:"1RM musculation"})]})}),e.jsx(H,{className:"w-full min-w-0 rounded-2xl",children:e.jsxs(X,{className:"p-0",children:[Xe||Je?e.jsxs("div",{className:"p-4 grid gap-3",children:[e.jsx(S,{}),e.jsx(S,{}),e.jsx(S,{})]}):Ye||Ze?e.jsx("div",{className:"p-4 text-sm text-muted-foreground",children:"Impossible de charger les records musculation."}):e.jsx(E.div,{className:"divide-y divide-border motion-reduce:animate-none",variants:ae,initial:"hidden",animate:"visible",children:Ge?.filter(s=>s.exercise_type!=="warmup").map(s=>{const t=He?.find(c=>c.exercise_id===s.id),d=Number(t?.weight??0),i=d>0?`${d} kg`:"—",r=t?.recorded_at??t?.date??null,n=t?.notes??null,u=$e===s.id,h=Ae===s.id,f=Ke===s.id;return e.jsxs(E.div,{className:"px-3 sm:px-4 py-3 motion-reduce:animate-none",variants:oe,children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"text-sm font-semibold truncate",children:s.nom_exercice}),e.jsx("button",{type:"button",onClick:()=>{f?(Q(null),L("")):(Q(s.id),L(n??""))},className:F("inline-flex items-center justify-center h-6 w-6 rounded-lg shrink-0",n?"text-primary hover:text-primary/80":"text-muted-foreground/50 hover:text-muted-foreground"),"aria-label":"Notes",title:n?"Modifier la note":"Ajouter une note",children:e.jsx(Rs,{className:"h-3.5 w-3.5"})})]}),e.jsx("div",{className:"mt-0.5 text-xs text-muted-foreground tabular-nums",children:Y(r)}),n&&!f?e.jsx("div",{className:"mt-1 text-xs italic text-muted-foreground truncate max-w-[200px]",children:n}):null]}),e.jsx("div",{className:"text-right shrink-0 flex items-start gap-1",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold tabular-nums whitespace-nowrap font-mono",children:i}),u?null:e.jsxs("div",{className:"flex items-center justify-end gap-1 mt-1",children:[d>0?e.jsxs("button",{type:"button",onClick:()=>De(h?null:s.id),className:"inline-flex items-center gap-0.5 text-xs text-muted-foreground hover:text-foreground","aria-label":"Table des pourcentages",title:"Table des pourcentages",children:[e.jsx(Pe,{className:F("h-3.5 w-3.5 transition-transform",h&&"rotate-180")}),"%"]}):null,e.jsxs("button",{type:"button",onClick:()=>ls(s.id,t?.weight??null),className:"inline-flex items-center gap-1 text-xs text-muted-foreground hover:text-foreground",children:[e.jsx(Te,{className:"h-3.5 w-3.5"}),"Modifier"]})]})]})})]}),u?e.jsx("div",{className:"mt-3",children:e.jsx(Ps,{value:ze,placeholder:"Ex: 100",inputMode:"decimal",hint:"Charge max (kg).",onCancel:we,onSave:c=>ds(s.id,c)})}):null,f?e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"w-full",children:[e.jsx(ie,{value:xe,onChange:c=>L(c.target.value),placeholder:"Ex: Machine n°3, cran 5, poignée large...",rows:2,className:"rounded-xl text-sm",autoFocus:!0}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-2",children:[e.jsx(y,{type:"button",size:"sm",variant:"outline",onClick:()=>{Q(null),L("")},className:"rounded-xl h-9 w-9 p-0","aria-label":"Annuler",children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx(y,{type:"button",size:"sm",onClick:()=>{const c=xe.trim()||null;ve.mutate({exercise_id:s.id,notes:c}),Q(null),L("")},disabled:ve.isPending,className:"rounded-xl h-9 w-9 p-0","aria-label":"Enregistrer la note",children:e.jsx(de,{className:"h-4 w-4"})})]})]})}):null,h&&d>0?e.jsxs("div",{className:"mt-3 rounded-xl bg-muted/30 border border-border p-3",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Table des pourcentages"}),e.jsx("div",{className:"grid grid-cols-5 gap-2 text-center text-xs",children:[50,60,70,80,90].map(c=>e.jsxs("div",{children:[e.jsxs("div",{className:"text-muted-foreground",children:[c,"%"]}),e.jsxs("div",{className:"font-semibold tabular-nums",children:[Math.round(d*c/10)/10," kg"]})]},c))})]}):null]},s.id)})}),je.isPending?e.jsxs("div",{className:"px-4 pb-4 text-xs text-muted-foreground flex items-center gap-2",children:[e.jsx(Ee,{className:"h-3 w-3 animate-spin"})," Mise à jour..."]}):null]})}),e.jsx("div",{className:"h-10"})]})]})}),e.jsx("div",{className:"pb-10"})]})}):e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg",children:[e.jsx("div",{className:"sticky top-0 z-20 scroll-mt-16 backdrop-blur bg-background/80 border-b border-border",children:e.jsxs("div",{className:"px-4 pt-4 pb-3",children:[e.jsx("div",{className:"text-xl font-semibold tracking-tight",children:"Records"}),e.jsx("div",{className:"mt-0.5 text-sm text-muted-foreground",children:"Natation & 1RM musculation"})]})}),e.jsx("div",{className:"px-4 pt-4 pb-10",children:e.jsx(H,{className:"rounded-2xl",children:e.jsx(X,{className:"pt-6 text-sm text-muted-foreground",children:"Cette page est réservée aux nageurs."})})})]})})}export{at as default};
