import{r as c,b as as,h as is,l as ls,m as rt,j as e,d as os,n as nt,o as je,u as Ie,I as at,p as vs,q as er,R as pe,c as sr,s as it,t as tr,v as rr,A as lt,w as nr,x as ar,y as ir,z as lr,F as or,D as cr,B as dr,E as ur}from"./vendor-ui-C9ymspZo.js";import{h as fe,k as B,i as qe,L as k,I as $,B as S,C as G,b as J,c as X,f as H,d as Z,s as Ps,g as V,u as Ke,l as mr,M as cs,a as pr,U as He,W as Ds,D as xr,T as hr}from"./index-B02B6PIp.js";import{b as ys,u as he,c as ae}from"./vendor-query-kM2vrB_e.js";import{u as fr,S as ce,a as de,b as ue,c as me,d as O}from"./select-B8VCsnm3.js";import{C as gr,P as ge}from"./plus-D2vopLZg.js";import{T as Pe}from"./textarea-2WcyqouS.js";import{D as De,a as Me,b as ps,c as xs}from"./dialog-CCKyrpGy.js";import{C as fs}from"./checkbox-BJ-YTRqk.js";import{L as Ms,A as Je,a as Xe,b as Ye,c as Ze,d as es,e as ss,f as ts,g as rs,P as Ts}from"./alert-dialog-DxzgVkSm.js";import{T as jr,a as vr,b as yr,c as br}from"./tabs-Cr9Fy0mU.js";import{S as We,P as Fs}from"./save-BvHLtNbS.js";import{E as Nr}from"./eye-DYEBquzn.js";import{c as ot,R as wr,i as $s,g as _r,S as Vs,a as Cr,L as Sr}from"./SwimSessionConsultation-DMpX-vrl.js";import{f as kr}from"./vendor-date-cQbdWov0.js";import{C as Rr}from"./chevron-left-1mCDdg3C.js";import{S as Er}from"./search-DFQ5bRVI.js";import{T as Ar}from"./timer-COkLMOvA.js";import{T as Pr,a as Dr,b as Is,c as Le,d as Mr,e as Be}from"./table-BnzbwCqN.js";import{B as Tr}from"./badge-mOauAOYw.js";import{A as Fr}from"./arrow-left-a7WHOTkO.js";import{C as $r}from"./chevron-up-B94mr-Ia.js";import{D as Vr}from"./download-CfRQJMmn.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-DSuxWnoS.js";import"./vendor-supabase-B2MyMyC0.js";import"./check-BXLnPru7.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],qr=fe("archive",Ir);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Or=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],qs=fe("arrow-down",Or);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zr=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],Os=fe("arrow-up",zr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gr=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],$e=fe("bell",Gr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lr=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Br=fe("funnel",Lr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ur=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],ct=fe("grip-vertical",Ur);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kr=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],zs=fe("heart-pulse",Kr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hr=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Wr=fe("pencil",Hr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qr=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ye=fe("trash-2",Qr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jr=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Gs=fe("upload",Jr);function gs(s,a,{checkForDefaultPrevented:r=!0}={}){return function(t){if(s?.(t),r===!1||!t.defaultPrevented)return a?.(t)}}var Xr=as[" useInsertionEffect ".trim().toString()]||is;function Yr({prop:s,defaultProp:a,onChange:r=()=>{},caller:n}){const[t,i,o]=Zr({defaultProp:a,onChange:r}),d=s!==void 0,v=d?s:t;{const x=c.useRef(s!==void 0);c.useEffect(()=>{const p=x.current;p!==d&&console.warn(`${n} is changing from ${p?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),x.current=d},[d,n])}const h=c.useCallback(x=>{if(d){const p=en(x)?x(s):x;p!==s&&o.current?.(p)}else i(x)},[d,s,i,o]);return[v,h]}function Zr({defaultProp:s,onChange:a}){const[r,n]=c.useState(s),t=c.useRef(r),i=c.useRef(a);return Xr(()=>{i.current=a},[a]),c.useEffect(()=>{t.current!==r&&(i.current?.(r),t.current=r)},[r,t]),[r,n,i]}function en(s){return typeof s=="function"}var bs="Radio",[sn,dt]=os(bs),[tn,rn]=sn(bs),ut=c.forwardRef((s,a)=>{const{__scopeRadio:r,name:n,checked:t=!1,required:i,disabled:o,value:d="on",onCheck:v,form:h,...x}=s,[p,f]=c.useState(null),C=Ie(a,y=>f(y)),N=c.useRef(!1),I=p?h||!!p.closest("form"):!0;return e.jsxs(tn,{scope:r,checked:t,disabled:o,children:[e.jsx(je.button,{type:"button",role:"radio","aria-checked":t,"data-state":ht(t),"data-disabled":o?"":void 0,disabled:o,value:d,...x,ref:C,onClick:gs(s.onClick,y=>{t||v?.(),I&&(N.current=y.isPropagationStopped(),N.current||y.stopPropagation())})}),I&&e.jsx(xt,{control:p,bubbles:!N.current,name:n,value:d,checked:t,required:i,disabled:o,form:h,style:{transform:"translateX(-100%)"}})]})});ut.displayName=bs;var mt="RadioIndicator",pt=c.forwardRef((s,a)=>{const{__scopeRadio:r,forceMount:n,...t}=s,i=rn(mt,r);return e.jsx(vs,{present:n||i.checked,children:e.jsx(je.span,{"data-state":ht(i.checked),"data-disabled":i.disabled?"":void 0,...t,ref:a})})});pt.displayName=mt;var nn="RadioBubbleInput",xt=c.forwardRef(({__scopeRadio:s,control:a,checked:r,bubbles:n=!0,...t},i)=>{const o=c.useRef(null),d=Ie(o,i),v=fr(r),h=er(a);return c.useEffect(()=>{const x=o.current;if(!x)return;const p=window.HTMLInputElement.prototype,C=Object.getOwnPropertyDescriptor(p,"checked").set;if(v!==r&&C){const N=new Event("click",{bubbles:n});C.call(x,r),x.dispatchEvent(N)}},[v,r,n]),e.jsx(je.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...t,tabIndex:-1,ref:d,style:{...t.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});xt.displayName=nn;function ht(s){return s?"checked":"unchecked"}var an=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ds="RadioGroup",[ln]=os(ds,[ls,dt]),ft=ls(),gt=dt(),[on,cn]=ln(ds),jt=c.forwardRef((s,a)=>{const{__scopeRadioGroup:r,name:n,defaultValue:t,value:i,required:o=!1,disabled:d=!1,orientation:v,dir:h,loop:x=!0,onValueChange:p,...f}=s,C=ft(r),N=rt(h),[I,y]=Yr({prop:i,defaultProp:t??null,onChange:p,caller:ds});return e.jsx(on,{scope:r,name:n,required:o,disabled:d,value:I,onValueChange:y,children:e.jsx(nt,{asChild:!0,...C,orientation:v,dir:N,loop:x,children:e.jsx(je.div,{role:"radiogroup","aria-required":o,"aria-orientation":v,"data-disabled":d?"":void 0,dir:N,...f,ref:a})})})});jt.displayName=ds;var vt="RadioGroupItem",yt=c.forwardRef((s,a)=>{const{__scopeRadioGroup:r,disabled:n,...t}=s,i=cn(vt,r),o=i.disabled||n,d=ft(r),v=gt(r),h=c.useRef(null),x=Ie(a,h),p=i.value===t.value,f=c.useRef(!1);return c.useEffect(()=>{const C=I=>{an.includes(I.key)&&(f.current=!0)},N=()=>f.current=!1;return document.addEventListener("keydown",C),document.addEventListener("keyup",N),()=>{document.removeEventListener("keydown",C),document.removeEventListener("keyup",N)}},[]),e.jsx(at,{asChild:!0,...d,focusable:!o,active:p,children:e.jsx(ut,{disabled:o,required:i.required,checked:p,...v,...t,name:i.name,ref:x,onCheck:()=>i.onValueChange(t.value),onKeyDown:gs(C=>{C.key==="Enter"&&C.preventDefault()}),onFocus:gs(t.onFocus,()=>{f.current&&h.current?.click()})})})});yt.displayName=vt;var dn="RadioGroupIndicator",bt=c.forwardRef((s,a)=>{const{__scopeRadioGroup:r,...n}=s,t=gt(r);return e.jsx(pt,{...t,...n,ref:a})});bt.displayName=dn;var Nt=jt,wt=yt,un=bt;const _t=c.forwardRef(({className:s,...a},r)=>e.jsx(Nt,{className:B("grid gap-2",s),...a,ref:r}));_t.displayName=Nt.displayName;const js=c.forwardRef(({className:s,...a},r)=>e.jsx(wt,{ref:r,className:B("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:e.jsx(un,{className:"flex items-center justify-center",children:e.jsx(gr,{className:"h-3.5 w-3.5 fill-primary"})})}));js.displayName=wt.displayName;const Ls=[{key:"endurance",label:"Endurance",fieldSuffix:"endurance"},{key:"hypertrophie",label:"Hypertrophie",fieldSuffix:"hypertrophie"},{key:"force",label:"Force",fieldSuffix:"force"}],Bs=s=>s==="endurance"||s==="hypertrophie"||s==="force"?s:"endurance",Us=({exercise:s,onChange:a,disabled:r=!1})=>e.jsxs(jr,{defaultValue:"endurance",className:"w-full",children:[e.jsx(vr,{className:"grid w-full grid-cols-3",children:Ls.map(n=>e.jsx(yr,{value:n.key,children:n.label},n.key))}),Ls.map(n=>{const t=`pct_1rm_${n.fieldSuffix}`,i=`Nb_series_${n.fieldSuffix}`,o=`Nb_reps_${n.fieldSuffix}`,d=`recup_${n.fieldSuffix}`,v=`recup_exercices_${n.fieldSuffix}`;return e.jsxs(br,{value:n.key,className:`space-y-3 rounded-lg border p-3 ${r?"opacity-60":""}`,children:[e.jsx("p",{className:"text-sm font-semibold",children:n.label}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"% 1RM"}),e.jsx($,{type:"number",value:s[t]??"",disabled:r,onChange:h=>a({[t]:h.target.value===""?null:Number(h.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Nb séries"}),e.jsx($,{type:"number",value:s[i]??"",disabled:r,onChange:h=>a({[i]:h.target.value===""?null:Number(h.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Nb reps"}),e.jsx($,{type:"number",value:s[o]??"",disabled:r,onChange:h=>a({[o]:h.target.value===""?null:Number(h.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Récup. séries (s)"}),e.jsx($,{type:"number",value:s[d]??"",disabled:r,onChange:h=>a({[d]:h.target.value===""?null:Number(h.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Récup. exercices (s)"}),e.jsx($,{type:"number",value:s[v]??"",disabled:r,onChange:h=>a({[v]:h.target.value===""?null:Number(h.target.value)})})]})]})]},n.key)})]}),mn={pct_1rm_endurance:60,pct_1rm_hypertrophie:75,pct_1rm_force:85,Nb_series_endurance:4,Nb_series_hypertrophie:3,Nb_series_force:3,Nb_reps_endurance:16,Nb_reps_hypertrophie:8,Nb_reps_force:3,recup_endurance:120,recup_hypertrophie:200,recup_force:300,recup_exercices_endurance:300,recup_exercices_hypertrophie:400,recup_exercices_force:500},Ue=s=>{const a=Number(s);return Number.isFinite(a)?a:0},Ks=(s,a,r,n)=>{const t=a==="force"?"force":a==="hypertrophie"?"hypertrophie":"endurance",i=`Nb_series_${t}`,o=`Nb_reps_${t}`,d=`pct_1rm_${t}`,v=`recup_${t}`;return{exercise_id:s.id,order_index:r,sets:Ue(s[i]),reps:Ue(s[o]),rest_seconds:Ue(s[v]),percent_1rm:Ue(s[d]),cycle_type:a,notes:n?.notes??""}},pn=()=>({nom_exercice:"",description:null,illustration_gif:null,exercise_type:"strength",warmup_reps:null,warmup_duration:null,...mn}),Hs=({exercise:s,warmupMode:a,onChange:r,onWarmupModeChange:n,idPrefix:t})=>e.jsxs("div",{className:"space-y-3 rounded-lg border p-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Paramètres d’échauffement"}),e.jsxs(_t,{value:a,onValueChange:i=>{n(i==="duration"?"duration":"reps"),r(i==="duration"?{warmup_reps:null,warmup_duration:s.warmup_duration??0}:{warmup_duration:null,warmup_reps:s.warmup_reps??0})},className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(js,{value:"reps",id:`${t}-warmup-reps`}),e.jsx(k,{htmlFor:`${t}-warmup-reps`,children:"Nombre de répétitions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(js,{value:"duration",id:`${t}-warmup-duration`}),e.jsx(k,{htmlFor:`${t}-warmup-duration`,children:"Durée (secondes)"})]})]}),a==="duration"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Durée (s)"}),e.jsx($,{type:"number",value:s.warmup_duration??"",onChange:i=>r({warmup_duration:i.target.value===""?null:Number(i.target.value)})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Nombre de répétitions"}),e.jsx($,{type:"number",value:s.warmup_reps??"",onChange:i=>r({warmup_reps:i.target.value===""?null:Number(i.target.value)})})]})]});function xn(){const{toast:s}=qe(),a=ys(),[r,n]=c.useState(!1),[t,i]=c.useState(null),[o,d]=c.useState("all"),[v,h]=c.useState(!1),[x,p]=c.useState(!1),[f,C]=c.useState(null),[N,I]=c.useState(null),[y,te]=c.useState(!1),[ee,w]=c.useState(null),[D,ie]=c.useState(null),[re,xe]=c.useState(null),[ve,u]=c.useState(null),[R,Y]=c.useState("reps"),[W,K]=c.useState("reps"),[U,se]=c.useState(!1),M=async(l,j)=>{if(l.size>10485760){s({title:"Fichier trop volumineux",description:"La taille maximale est de 10 Mo.",variant:"destructive"});return}se(!0);try{const L=l.name.split(".").pop()??"gif",Q=`exercises/${Date.now()}-${Math.random().toString(36).slice(2)}.${L}`,{error:Ge}=await Ps.storage.from("exercise-gifs").upload(Q,l,{upsert:!1});if(Ge)throw Ge;const{data:Zt}=Ps.storage.from("exercise-gifs").getPublicUrl(Q);j(Zt.publicUrl),s({title:"Image uploadée"})}catch(L){const Q=L instanceof Error?L.message:"Réessayez.";s({title:"Erreur d'upload",description:Q,variant:"destructive"})}finally{se(!1)}},[E,F]=c.useState({title:"",description:"",cycle:"endurance",items:[]}),[z,le]=c.useState({...pn()});c.useEffect(()=>{f&&K(f.warmup_duration!=null?"duration":"reps")},[f]);const{data:oe}=he({queryKey:["exercises"],queryFn:()=>V.getExercises()}),{data:Re}=he({queryKey:["strength_catalog"],queryFn:()=>V.getStrengthSessions()}),Ce=c.useMemo(()=>new Map((oe??[]).map(l=>[l.id,l])),[oe]),Ee=ae({mutationFn:l=>V.createExercise(l),onSuccess:()=>{a.invalidateQueries({queryKey:["exercises"]}),h(!1),s({title:"Exercice ajouté"})}}),Ae=ae({mutationFn:l=>V.createStrengthSession(l),onSuccess:()=>{a.invalidateQueries({queryKey:["strength_catalog"]}),n(!1),F({title:"",description:"",cycle:"endurance",items:[]}),s({title:"Séance créée avec succès"})}}),Se=ae({mutationFn:l=>V.updateExercise(l),onSuccess:()=>{a.invalidateQueries({queryKey:["exercises"]}),a.invalidateQueries({queryKey:["strength_catalog"]}),p(!1),C(null),s({title:"Exercice mis à jour"})}}),T=ae({mutationFn:l=>V.deleteExercise(l),onSuccess:()=>{a.invalidateQueries({queryKey:["exercises"]}),a.invalidateQueries({queryKey:["strength_catalog"]}),ie(null),s({title:"Exercice supprimé"})}}),m=ae({mutationFn:l=>V.deleteStrengthSession(l),onSuccess:()=>{a.invalidateQueries({queryKey:["strength_catalog"]}),w(null),s({title:"Séance supprimée"})}}),g=ae({mutationFn:l=>V.updateStrengthSession(l),onSuccess:()=>{a.invalidateQueries({queryKey:["strength_catalog"]}),n(!1),i(null),F({title:"",description:"",cycle:"endurance",items:[]}),s({title:"Séance mise à jour"})}}),b=ae({mutationFn:l=>V.persistStrengthSessionOrder(l)}),A=()=>{n(!1),i(null),F({title:"",description:"",cycle:"endurance",items:[]})},q=l=>{i(l.id),F({title:l.title??"",description:l.description??"",cycle:Bs(l.cycle),items:l.items?.map(j=>({exercise_id:j.exercise_id,order_index:j.order_index??0,sets:j.sets,reps:j.reps,rest_seconds:j.rest_seconds,percent_1rm:j.percent_1rm,cycle_type:j.cycle_type,notes:j.notes??""}))??[]}),n(!0)},ne=l=>{C(l),p(!0)},P=()=>{const l={...E,items:we(E.items)};t?g.mutate({...l,id:t}):Ae.mutate(l)},we=l=>l.map((j,_)=>({...j,order_index:_})),ze=()=>{const l=oe?.[0];F(j=>({...j,items:[...j.items,l?Ks(l,j.cycle,j.items.length):{exercise_id:1,order_index:j.items.length,sets:0,reps:0,rest_seconds:0,percent_1rm:0}]}))},_e=(l,j,_)=>{const L=[...E.items];if(j==="exercise_id"){const Q=oe?.find(Ge=>Ge.id===_);Q?L[l]=Ks(Q,E.cycle,L[l].order_index??l,L[l]):L[l]={...L[l],exercise_id:Number(_)}}else L[l]={...L[l],[j]:_};F({...E,items:L})},ms=l=>{const j=we(E.items.filter((_,L)=>L!==l));F({...E,items:j})},Xt=(l,j)=>{if(l===j)return;const _=[...E.items],[L]=_.splice(l,1);_.splice(j,0,L);const Q=we(_);F({...E,items:Q}),t&&b.mutate({id:t,title:E.title,description:E.description,cycle:E.cycle,items:Q})},Yt=new Set(E.items.map(l=>l.exercise_id)),Cs=oe?.filter(l=>o==="all"||Yt.has(l.id)?!0:l.exercise_type===o)??[],Ss=e.jsx(De,{open:x,onOpenChange:p,children:e.jsxs(Me,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(ps,{children:e.jsx(xs,{children:"Modifier l’exercice"})}),f&&e.jsxs("div",{className:"space-y-4",children:[f.exercise_type==="warmup"?e.jsx(Hs,{exercise:f,warmupMode:W,onChange:l=>C(j=>j&&{...j,...l}),onWarmupModeChange:K,idPrefix:"edit"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Nom"}),e.jsx($,{value:f.nom_exercice,onChange:l=>C({...f,nom_exercice:l.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Description"}),e.jsx(Pe,{value:f.description??"",onChange:l=>C({...f,description:l.target.value===""?null:l.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Illustration (GIF)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{value:f.illustration_gif??"",onChange:l=>C({...f,illustration_gif:l.target.value===""?null:l.target.value}),placeholder:"https://...",className:"flex-1"}),e.jsx(S,{type:"button",variant:"outline",size:"icon",disabled:U,onClick:()=>{const l=document.createElement("input");l.type="file",l.accept="image/*,.gif",l.onchange=j=>{const _=j.target.files?.[0];_&&M(_,L=>C(Q=>Q&&{...Q,illustration_gif:L}))},l.click()},"aria-label":"Uploader une image",children:U?e.jsx(Ms,{className:"h-4 w-4 animate-spin"}):e.jsx(Gs,{className:"h-4 w-4"})})]}),f.illustration_gif&&e.jsx("img",{src:f.illustration_gif,alt:"Aperçu",className:"mt-2 h-20 w-20 rounded-lg object-cover border"})]}),f.exercise_type!=="warmup"?e.jsx(Us,{exercise:f,onChange:l=>C(j=>j&&{...j,...l})}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fs,{id:"warmup-flag-edit",checked:f.exercise_type==="warmup",onCheckedChange:l=>C({...f,exercise_type:l===!0?"warmup":"strength"})}),e.jsx(k,{htmlFor:"warmup-flag-edit",children:"Exercice d’échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(S,{variant:"outline",onClick:()=>{p(!1),C(null)},children:"Annuler"}),e.jsxs(S,{onClick:()=>{f?.id&&Se.mutate(f)},disabled:!f.nom_exercice.trim(),children:[e.jsx(We,{className:"mr-2 h-4 w-4"})," Enregistrer"]})]})]})]})}),ks=e.jsx(De,{open:v,onOpenChange:h,children:e.jsxs(Me,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(ps,{children:e.jsx(xs,{children:"Créer un exercice"})}),e.jsxs("div",{className:"space-y-4",children:[z.exercise_type==="warmup"?e.jsx(Hs,{exercise:z,warmupMode:R,onChange:l=>le(j=>({...j,...l})),onWarmupModeChange:Y,idPrefix:"create"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Nom"}),e.jsx($,{value:z.nom_exercice,onChange:l=>le({...z,nom_exercice:l.target.value}),placeholder:"ex: Rotations Élastique"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Description"}),e.jsx(Pe,{value:z.description??"",onChange:l=>le({...z,description:l.target.value===""?null:l.target.value}),placeholder:"Détails, consignes..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Illustration (GIF)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{value:z.illustration_gif??"",onChange:l=>le({...z,illustration_gif:l.target.value===""?null:l.target.value}),placeholder:"https://...",className:"flex-1"}),e.jsx(S,{type:"button",variant:"outline",size:"icon",disabled:U,onClick:()=>{const l=document.createElement("input");l.type="file",l.accept="image/*,.gif",l.onchange=j=>{const _=j.target.files?.[0];_&&M(_,L=>le(Q=>({...Q,illustration_gif:L})))},l.click()},"aria-label":"Uploader une image",children:U?e.jsx(Ms,{className:"h-4 w-4 animate-spin"}):e.jsx(Gs,{className:"h-4 w-4"})})]}),z.illustration_gif&&e.jsx("img",{src:z.illustration_gif,alt:"Aperçu",className:"mt-2 h-20 w-20 rounded-lg object-cover border"})]}),z.exercise_type!=="warmup"?e.jsx(Us,{exercise:z,onChange:l=>le(j=>({...j,...l}))}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fs,{id:"warmup-flag",checked:z.exercise_type==="warmup",onCheckedChange:l=>le({...z,exercise_type:l===!0?"warmup":"strength"})}),e.jsx(k,{htmlFor:"warmup-flag",children:"Exercice d’échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(S,{variant:"outline",onClick:()=>h(!1),children:"Annuler"}),e.jsxs(S,{onClick:()=>Ee.mutate(z),disabled:!z.nom_exercice.trim(),children:[e.jsx(We,{className:"mr-2 h-4 w-4"})," Enregistrer"]})]})]})]})}),Rs=e.jsx(De,{open:y,onOpenChange:l=>{te(l),l||I(null)},children:e.jsxs(Me,{className:"sm:max-w-3xl",children:[e.jsx(ps,{children:e.jsx(xs,{children:"Détails de la séance"})}),N&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-lg font-semibold",children:N.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:N.description||"—"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cycle : ",N.cycle]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Exercices"}),e.jsx("div",{className:"space-y-2",children:(N.items??[]).slice().sort((l,j)=>(l.order_index??0)-(j.order_index??0)).map((l,j)=>{const _=Ce.get(l.exercise_id);return e.jsxs("div",{className:"rounded-md border px-3 py-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("span",{className:"font-medium",children:[j+1,". ",_?.nom_exercice??l.exercise_name??"Exercice"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:_?.exercise_type==="warmup"||l.category==="warmup"?"Échauffement":"Travail"})]}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[l.sets," séries • ",l.reps," reps • ",l.percent_1rm,"% 1RM • ",l.rest_seconds,"s"]})]},`${l.exercise_id}-${j}`)})})]})]})]})}),Es=e.jsx(Je,{open:!!ee,onOpenChange:l=>{l||w(null)},children:e.jsxs(Xe,{children:[e.jsxs(Ye,{children:[e.jsx(Ze,{children:"Supprimer la séance ?"}),e.jsxs(es,{children:['Cette action est définitive. La séance "',ee?.title,'" sera supprimée.']})]}),e.jsxs(ss,{children:[e.jsx(ts,{children:"Annuler"}),e.jsx(rs,{onClick:()=>{ee?.id&&m.mutate(ee.id)},children:"Supprimer"})]})]})}),As=e.jsx(Je,{open:!!D,onOpenChange:l=>{l||ie(null)},children:e.jsxs(Xe,{children:[e.jsxs(Ye,{children:[e.jsx(Ze,{children:"Supprimer l’exercice ?"}),e.jsxs(es,{children:['Cette action est définitive. L’exercice "',D?.nom_exercice,'" sera supprimé.']})]}),e.jsxs(ss,{children:[e.jsx(ts,{children:"Annuler"}),e.jsx(rs,{onClick:()=>{D?.id&&T.mutate(D.id)},children:"Supprimer"})]})]})});return r?e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-bottom-4",children:[ks,Ss,Rs,Es,As,e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold uppercase",children:t?"Modifier Séance Muscu":"Nouvelle Séance Muscu"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{variant:"outline",onClick:A,children:"Annuler"}),e.jsxs(S,{onClick:P,children:[e.jsx(We,{className:"mr-2 h-4 w-4"})," Enregistrer"]})]})]}),e.jsxs(G,{children:[e.jsx(J,{children:e.jsx(X,{children:"Informations Générales"})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Titre"}),e.jsx($,{value:E.title,onChange:l=>F({...E,title:l.target.value}),placeholder:"ex: Full Body A"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Cycle"}),e.jsxs(ce,{value:E.cycle,onValueChange:l=>F({...E,cycle:Bs(l)}),children:[e.jsx(de,{children:e.jsx(ue,{})}),e.jsxs(me,{children:[e.jsx(O,{value:"endurance",children:"Endurance"}),e.jsx(O,{value:"hypertrophie",children:"Hypertrophie"}),e.jsx(O,{value:"force",children:"Force"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Description"}),e.jsx(Pe,{value:E.description,onChange:l=>F({...E,description:l.target.value})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold",children:"Exercices"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(S,{size:"sm",variant:"outline",onClick:()=>h(!0),children:[e.jsx(ge,{className:"mr-2 h-4 w-4"})," Nouvel exercice"]}),e.jsxs(S,{size:"sm",onClick:ze,children:[e.jsx(ge,{className:"mr-2 h-4 w-4"})," Ajouter"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-[220px_1fr] items-end",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(Br,{className:"h-4 w-4"})," Filtre exercices"]}),e.jsxs(ce,{value:o,onValueChange:l=>d(l),children:[e.jsx(de,{children:e.jsx(ue,{})}),e.jsxs(me,{children:[e.jsx(O,{value:"all",children:"Tous"}),e.jsx(O,{value:"strength",children:"Séries de travail"}),e.jsx(O,{value:"warmup",children:"Échauffement"})]})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Les exercices marqués warmup sont affichés dans les séances avec le badge « Échauffement »."})]}),E.items.map((l,j)=>e.jsxs(G,{className:B("relative transition-all",ve===j&&re!==null&&re!==j&&"ring-2 ring-primary bg-accent/30"),onDragOver:_=>_.preventDefault(),onDragEnter:()=>u(j),onDragLeave:()=>u(_=>_===j?null:_),onDrop:()=>{re!==null&&(Xt(re,j),xe(null),u(null))},children:[e.jsx(S,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 text-destructive",onClick:()=>ms(j),"aria-label":"Supprimer l'exercice",children:e.jsx(ye,{className:"h-4 w-4"})}),e.jsxs(H,{className:"pt-6 grid md:grid-cols-12 gap-4 items-end",children:[e.jsx("div",{className:"md:col-span-1 flex items-center justify-center",children:e.jsx("button",{type:"button",className:"cursor-grab rounded-md border p-1 text-muted-foreground hover:text-foreground",draggable:!0,onDragStart:()=>xe(j),onDragEnd:()=>{xe(null),u(null)},"aria-label":"Réordonner",children:e.jsx(ct,{className:"h-4 w-4"})})}),e.jsxs("div",{className:"md:col-span-3 space-y-2",children:[e.jsx(k,{children:"Exercice"}),e.jsxs(ce,{value:l.exercise_id.toString(),onValueChange:_=>_e(j,"exercise_id",parseInt(_)),children:[e.jsx(de,{children:e.jsx(ue,{})}),e.jsx(me,{children:Cs.length?Cs.map(_=>e.jsxs(O,{value:_.id.toString(),children:[_.nom_exercice,_.exercise_type==="warmup"?" • Échauffement":""]},_.id)):e.jsx(O,{value:"no-exercise",disabled:!0,children:"Aucun exercice disponible"})})]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(k,{children:"Séries"}),e.jsx($,{type:"number",value:l.sets===0?"":l.sets,onChange:_=>_e(j,"sets",_.target.value===""?0:Number(_.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(k,{children:"Reps"}),e.jsx($,{type:"number",value:l.reps===0?"":l.reps,onChange:_=>_e(j,"reps",_.target.value===""?0:Number(_.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(k,{children:"% 1RM"}),e.jsx($,{type:"number",value:l.percent_1rm===0?"":l.percent_1rm,onChange:_=>_e(j,"percent_1rm",_.target.value===""?0:Number(_.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(k,{children:"Repos (s)"}),e.jsx($,{type:"number",value:l.rest_seconds===0?"":l.rest_seconds,onChange:_=>_e(j,"rest_seconds",_.target.value===""?0:Number(_.target.value))})]})]})]},`${l.exercise_id}-${j}`))]})]}):e.jsxs("div",{className:"space-y-4",children:[ks,Ss,Rs,Es,As,e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Catalogue Séances Musculation"}),e.jsxs(S,{onClick:()=>{i(null),F({title:"",description:"",cycle:"endurance",items:[]}),n(!0)},children:[e.jsx(ge,{className:"mr-2 h-4 w-4"})," Créer"]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:Re?.map(l=>e.jsxs(G,{children:[e.jsxs(J,{children:[e.jsx(X,{children:l.title}),e.jsxs(Z,{children:[l.items?.length||0," exercices • ",l.cycle]})]}),e.jsx(H,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{variant:"outline",size:"icon","aria-label":"Voir détails",onClick:()=>{I(l),te(!0)},children:e.jsx(Nr,{className:"h-4 w-4"})}),e.jsx(S,{variant:"secondary",size:"icon","aria-label":"Modifier",onClick:()=>q(l),children:e.jsx(Fs,{className:"h-4 w-4"})}),e.jsx(S,{variant:"destructive",size:"icon","aria-label":"Supprimer",onClick:()=>w(l),children:e.jsx(ye,{className:"h-4 w-4"})})]})})]},l.id))}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Catalogue Exercices"}),e.jsxs(S,{variant:"outline",onClick:()=>h(!0),children:[e.jsx(ge,{className:"mr-2 h-4 w-4"})," Ajouter un exercice"]})]}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:oe?.map(l=>e.jsx(G,{children:e.jsxs(H,{className:"flex flex-col gap-3 py-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[l.illustration_gif?e.jsx("img",{src:l.illustration_gif,alt:`Illustration ${l.nom_exercice}`,className:"h-14 w-14 rounded-md object-cover",loading:"lazy",decoding:"async"}):null,e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:l.nom_exercice}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.exercise_type==="warmup"?"Échauffement":"Séries de travail"})]})]}),e.jsxs("div",{className:"flex w-full gap-2 sm:w-auto",children:[e.jsx(S,{variant:"outline",size:"icon","aria-label":"Modifier",onClick:()=>ne(l),children:e.jsx(Fs,{className:"h-4 w-4"})}),e.jsx(S,{variant:"destructive",size:"icon","aria-label":"Supprimer",onClick:()=>ie(l),children:e.jsx(ye,{className:"h-4 w-4"})})]})]})},l.id))})]})]})}const Ws=["V0","V1","V2","V3","Max"],hn={V0:"bg-intensity-1",V1:"bg-intensity-2",V2:"bg-intensity-3",V3:"bg-intensity-4",Max:"bg-intensity-5"},Qs={souple:"V0",facile:"V0",relache:"V0",relâché:"V0"},fn=s=>{if(!s)return"V0";const a=s.trim();if(!a)return"V0";const r=a.toLowerCase();if(Qs[r])return Qs[r];const n=a.toUpperCase();if(n==="MAX")return"Max";if(n.startsWith("V")){const t=n.replace("V","V");return t==="V4"||t==="V5"?"Max":t}return a};function gn({value:s,onChange:a,className:r,ariaLabel:n="Sélection d'intensité"}){const t=fn(s),i=Ws.includes(t)?t:"Max";return e.jsx("div",{role:"radiogroup","aria-label":n,className:B("flex flex-wrap items-center gap-2",r),children:Ws.map(o=>{const d=i===o;return e.jsxs("button",{type:"button",role:"radio","aria-checked":d,"aria-label":`Intensité ${o==="Max"?"MAX":o}`,onClick:()=>a(o),className:B("flex flex-col items-center gap-1 rounded-full px-2 py-1 text-[10px] font-semibold text-muted-foreground transition","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",d?"text-foreground":"hover:text-foreground"),children:[e.jsx("span",{className:B("h-3 w-3 rounded-full",d?hn[o]??"bg-primary":"bg-muted")}),e.jsx("span",{children:o==="Max"?"MAX":o})]},o)})})}function jn(s){c.useEffect(()=>{if(!s)return;const a=r=>{r.preventDefault()};return window.addEventListener("beforeunload",a),()=>window.removeEventListener("beforeunload",a)},[s])}function Js(s){return`Séance du ${kr(s,"dd/MM/yyyy")} - Soir - Matin`}const Xs={souple:"V0",facile:"V0",relache:"V0",relâché:"V0"},vn=["V0","V1","V2","V3","Max"],Ve=s=>{if(!s)return"V0";const a=s.trim();if(!a)return"V0";const r=a.toLowerCase();if(Xs[r])return Xs[r];const n=a.toUpperCase();if(n==="MAX")return"Max";if(n.startsWith("V")){const t=Number.parseInt(n.slice(1),10);if(Number.isFinite(t)&&t>=4)return"Max";if(vn.includes(n))return n}return a},Ys=s=>s==="Max"?"MAX":s,hs=s=>{let a=0;return s.flatMap((r,n)=>r.exercises.map((t,i)=>{const o={block_title:r.title,block_description:r.description||null,block_order:n,block_repetitions:r.repetitions??null,block_modalities:r.modalities||null,block_equipment:r.equipment??[],exercise_repetitions:t.repetitions??null,exercise_rest:t.rest??null,exercise_stroke:t.stroke||null,exercise_stroke_type:t.strokeType||null,exercise_intensity:t.intensity?Ve(t.intensity):null,exercise_modalities:t.modalities||null,exercise_equipment:t.equipment??[],exercise_order:i},d=t.repetitions&&t.distance?`${t.repetitions}x${t.distance}m`:t.distance?`${t.distance}m`:null;return{ordre:a++,label:d,distance:t.distance??null,duration:null,intensity:t.intensity?Ve(t.intensity):null,notes:t.modalities||null,raw_payload:o}}))},yn=(s=[])=>{const a=new Map;return s.forEach(r=>{const n=r.raw_payload??{},t=n.block_title||n.section||"Bloc",i=Number(n.block_order??0),o=`${i}-${t}`,d=n.block_equipment??n.equipment??[],v=(Array.isArray(d)?d:String(d).split(",")).map(f=>String(f)).map(f=>Zs(f)).filter(Boolean);a.has(o)||a.set(o,{title:t,repetitions:n.block_repetitions??null,description:n.block_description??"",modalities:n.block_modalities??n.modalities??"",equipment:v,exercises:[],order:Number.isFinite(i)?i:0,exerciseOrder:new Map});const h=a.get(o),x=Number(n.exercise_order??r.ordre??h.exercises.length),p=Ve(n.exercise_intensity??r.intensity??"V1");h.exerciseOrder.set(x,{repetitions:n.exercise_repetitions??null,distance:r.distance??null,rest:n.exercise_rest??null,stroke:n.exercise_stroke??n.stroke??"crawl",strokeType:n.exercise_stroke_type??n.stroke_type??"nc",intensity:p,modalities:n.exercise_modalities??r.notes??"",equipment:Array.isArray(n.exercise_equipment)?n.exercise_equipment.map(f=>Zs(f)):[]})}),Array.from(a.values()).sort((r,n)=>r.order-n.order).map(r=>({title:r.title,repetitions:r.repetitions,description:r.description,modalities:r.modalities,equipment:r.equipment,exercises:Array.from(r.exerciseOrder.entries()).sort(([n],[t])=>n-t).map(([,n])=>n)}))},bn=s=>s?s.length>48?`${s.slice(0,45).trim()}…`:s:"",Zs=s=>{const a=s.trim().toLowerCase();return a&&(a.startsWith("plaquette")?"plaquettes":a.startsWith("palm")?"palmes":a.startsWith("tuba")?"tuba":a.startsWith("pull")?"pull":a.startsWith("elas")?"elastique":a)},Nn=(s=[])=>new Set(s.map(r=>{const n=r.raw_payload;return n?.block_title||n?.section||"Bloc"})).size,wn=s=>{const a=ot(s.items??[]),n=s.items?.some(i=>i.duration!=null)??!1?s.items?.reduce((i,o)=>i+(o.duration??0),0)??0:null,t=Nn(s.items??[]);return{totalDistance:a,totalDuration:n,blockCount:t}},et="swim_catalog_archived_ids",_n=(s,a)=>a===null?!1:!a.some(r=>r.session_type==="swim"&&r.session_id===s);function Cn(){const{toast:s}=qe(),a=ys(),{userId:r,role:n}=Ke(),[t,i]=c.useState(!1);jn(t);const[o,d]=c.useState(null),[v,h]=c.useState(null),[x,p]=c.useState(null),[f,C]=c.useState(""),[N,I]=c.useState("compact"),[y,te]=c.useState(new Set),ee=()=>({id:null,name:Js(new Date),description:"",estimatedDuration:0,blocks:[]}),[w,D]=c.useState(ee),{data:ie,isLoading:re}=he({queryKey:["swim_catalog"],queryFn:()=>V.getSwimCatalog()}),{data:xe,isError:ve}=he({queryKey:["coach-assignments"],queryFn:()=>V.getAssignmentsForCoach(),enabled:n==="coach"||n==="admin"});c.useEffect(()=>{if(typeof window>"u")return;const m=window.localStorage.getItem(et);if(m)try{const g=JSON.parse(m);Array.isArray(g)&&te(new Set(g.map(b=>Number(b)).filter(b=>Number.isFinite(b))))}catch{return}},[]),c.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(et,JSON.stringify(Array.from(y.values())))},[y]);const R=c.useMemo(()=>{const m=f.trim().toLowerCase();return m?(ie??[]).filter(g=>g.name.toLowerCase().includes(m)):ie??[]},[ie,f]).filter(m=>!y.has(m.id)),Y=ae({mutationFn:m=>V.createSwimSession(m),onSuccess:(m,g)=>{a.invalidateQueries({queryKey:["swim_catalog"]}),i(!1),D(ee()),s({title:g?.id?"Séance natation mise à jour":"Séance natation créée"})}}),W=ae({mutationFn:m=>V.deleteSwimSession(m),onSuccess:()=>{a.invalidateQueries({queryKey:["swim_catalog"]}),h(null),s({title:"Séance supprimée"})},onError:()=>{s({title:"Suppression impossible",description:"Cette séance est utilisée dans une assignation.",variant:"destructive"})}}),K=()=>{D(m=>({...m,blocks:[...m.blocks,{title:"Nouveau bloc",repetitions:1,description:"",modalities:"",equipment:[],exercises:[{repetitions:4,distance:50,rest:null,stroke:"crawl",strokeType:"nc",intensity:"V2",modalities:"",equipment:[]}]}]}))},U=(m,g,b)=>{const A=[...w.blocks];A[m]={...A[m],[g]:b},D({...w,blocks:A})},se=m=>{const g=w.blocks.filter((b,A)=>A!==m);D({...w,blocks:g})},M=(m,g)=>{const b=g==="up"?m-1:m+1;if(b<0||b>=w.blocks.length)return;const A=[...w.blocks],[q]=A.splice(m,1);A.splice(b,0,q),D({...w,blocks:A})},E=m=>{const g=[...w.blocks];g[m].exercises.push({repetitions:4,distance:50,rest:null,stroke:"crawl",strokeType:"nc",intensity:"V2",modalities:"",equipment:[]}),D({...w,blocks:g})},F=(m,g,b,A)=>{const q=[...w.blocks],ne=[...q[m].exercises];ne[g]={...ne[g],[b]:A},q[m]={...q[m],exercises:ne},D({...w,blocks:q})},z=(m,g)=>{const b=[...w.blocks];b[m].exercises=b[m].exercises.filter((A,q)=>q!==g),D({...w,blocks:b})},le=[{value:"palmes",label:"Palmes"},{value:"tuba",label:"Tuba"},{value:"plaquettes",label:"Plaquettes"},{value:"pull",label:"Pull"},{value:"elastique",label:"Élastique"}],oe=[{value:"pap",label:"Papillon"},{value:"dos",label:"Dos"},{value:"brasse",label:"Brasse"},{value:"crawl",label:"Crawl"},{value:"4n",label:"4 nages"},{value:"spe",label:"Spé"}],Re=[{value:"nc",label:"NC"},{value:"educ",label:"Educ"},{value:"jambes",label:"Jambes"}];oe.reduce((m,g)=>(m[g.value]=g.label,m),{});const Ce=Re.reduce((m,g)=>(m[g.value]=g.label,m),{});w.id;const Ee=c.useMemo(()=>ot(hs(w.blocks)),[w.blocks]),Ae={nc:"bg-sky-100 text-sky-900 ring-sky-200",educ:"bg-violet-100 text-violet-900 ring-violet-200",jambes:"bg-teal-100 text-teal-900 ring-teal-200"},Se={V0:"text-intensity-1",V1:"text-intensity-2",V2:"text-intensity-3",V3:"text-intensity-4",Max:"text-intensity-5"},T={V0:"ring-intensity-1/30",V1:"ring-intensity-2/30",V2:"ring-intensity-3/30",V3:"ring-intensity-4/30",Max:"ring-intensity-5/30"};return t?e.jsxs("div",{className:"animate-in slide-in-from-bottom-4 motion-reduce:animate-none",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{i(!1),D(ee())},className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Retour",children:e.jsx(Rr,{className:"h-4 w-4"})}),e.jsx("div",{className:"text-base font-semibold",children:"Édition"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>d({id:w.id??Date.now(),name:w.name,description:w.description,created_by:r??null,items:hs(w.blocks)}),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Aperçu nageur",title:"Aperçu nageur",children:e.jsx(Ts,{className:"h-4 w-4"})}),e.jsxs("button",{type:"button",onClick:()=>{if(!w.name.trim()){s({title:"Titre requis",description:"Ajoutez un nom de séance avant d'enregistrer.",variant:"destructive"});return}Y.mutate({id:w.id??void 0,name:w.name,description:w.description,estimated_duration:w.estimatedDuration||null,items:hs(w.blocks),created_by:r})},className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(We,{className:"h-4 w-4"})," Sauver"]})]})]}),e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(G,{className:"rounded-2xl border-border",children:e.jsxs("div",{className:"space-y-3 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Infos séance"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Nom"}),e.jsx("div",{className:"mt-1",children:e.jsx($,{value:w.name,onChange:m=>D({...w,name:m.target.value}),placeholder:"Nom de la séance",className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Durée estimée (min)"}),e.jsx("div",{className:"mt-1",children:e.jsx($,{type:"number",min:0,value:w.estimatedDuration||"",onChange:m=>D({...w,estimatedDuration:m.target.value===""?0:Number(m.target.value)}),placeholder:"55",className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Distance totale"}),e.jsxs("div",{className:"mt-1 rounded-2xl border border-border bg-muted px-3 py-2 text-sm font-semibold",children:[Ee,"m"]})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Vue coach"}),e.jsxs("div",{className:"inline-flex rounded-full border border-border bg-card p-1 text-xs font-semibold",children:[e.jsx("button",{type:"button",onClick:()=>I("compact"),className:B("rounded-full px-3 py-1",N==="compact"?"bg-primary text-primary-foreground":"text-muted-foreground"),children:"Condensé"}),e.jsx("button",{type:"button",onClick:()=>I("detailed"),className:B("rounded-full px-3 py-1",N==="detailed"?"bg-primary text-primary-foreground":"text-muted-foreground"),children:"Détail"})]})]}),N==="compact"?e.jsx(G,{className:"rounded-2xl border-border",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:"Plan (ultra compact)"}),e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Manipule les blocs vite. Passe en “Détail” pour éditer."})]}),e.jsxs(S,{variant:"secondary",size:"sm",onClick:K,className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(ge,{className:"h-4 w-4"})," Bloc"]})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[w.blocks.map((m,g)=>e.jsx("div",{className:"rounded-2xl border border-border bg-card px-3 py-2",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-primary px-2 py-0.5 text-[11px] font-semibold text-primary-foreground",children:[e.jsx(wr,{className:"inline h-3 w-3"})," ",m.repetitions??1,"x"]}),e.jsx("div",{className:"truncate text-xs font-semibold",children:m.title?m.title:`Bloc ${g+1}`}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:["· ",m.exercises.length," ex"]})]}),e.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[m.exercises.slice(0,4).map((b,A)=>{const q=Ve(b.intensity),ne=Ce[b.strokeType]??b.strokeType;return e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted px-2 py-0.5 text-[11px] font-semibold text-muted-foreground",title:b.modalities?bn(b.modalities):"",children:[b.repetitions&&b.distance?`${b.repetitions}x`:"",b.distance?`${b.distance}m`:"—",e.jsx("span",{className:B("ml-1 inline-flex items-center rounded-full px-2 py-0.5 ring-1",Ae[b.strokeType]??"bg-muted text-muted-foreground ring-border"),children:ne}),e.jsxs("span",{className:B("ml-1 inline-flex items-center gap-1 rounded-full bg-card px-2 py-0.5 ring-1",T[q],Se[q]),children:[e.jsx("span",{className:B("h-2 w-2 rounded-full",$s[q]??"bg-muted")}),Ys(q)]})]},`${g}-${A}`)}),m.exercises.length>4?e.jsxs("span",{className:"text-[11px] text-muted-foreground",children:["+",m.exercises.length-4]}):null]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>M(g,"up"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Monter",title:"Monter",disabled:g===0,children:e.jsx(Os,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>M(g,"down"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Descendre",title:"Descendre",disabled:g===w.blocks.length-1,children:e.jsx(qs,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>se(g),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer bloc",title:"Supprimer bloc",children:e.jsx(ye,{className:"h-4 w-4"})})]})]})},g)),w.blocks.length?null:e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-muted px-3 py-6 text-center text-sm text-muted-foreground",children:"Aucun bloc. Ajoute un bloc pour commencer."})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Édition détaillée"}),e.jsxs(S,{variant:"secondary",size:"sm",onClick:K,className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(ge,{className:"h-4 w-4"})," Ajouter bloc"]})]}),e.jsx("div",{className:"space-y-4",children:w.blocks.map((m,g)=>e.jsx(G,{className:"rounded-2xl border-border",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"mt-1 inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-muted text-muted-foreground",children:e.jsx(ct,{className:"h-4 w-4"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Titre bloc"}),e.jsx($,{value:m.title,onChange:b=>U(g,"title",b.target.value),placeholder:`Bloc ${g+1}`,className:"rounded-2xl"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>M(g,"up"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Monter",title:"Monter",disabled:g===0,children:e.jsx(Os,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>M(g,"down"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Descendre",title:"Descendre",disabled:g===w.blocks.length-1,children:e.jsx(qs,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>se(g),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer bloc",title:"Supprimer bloc",children:e.jsx(ye,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Répétitions du bloc"}),e.jsx("div",{className:"mt-1",children:e.jsx($,{type:"number",min:1,value:m.repetitions??"",onChange:b=>U(g,"repetitions",b.target.value===""?null:Number(b.target.value)),placeholder:"1",className:"rounded-2xl"})})]}),e.jsx("div",{className:"flex items-end justify-end",children:e.jsxs(S,{variant:"secondary",size:"sm",onClick:()=>E(g),className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(ge,{className:"h-4 w-4"})," Exercice"]})})]}),e.jsx("div",{className:"mt-4 space-y-3",children:m.exercises.map((b,A)=>{const q=Ve(b.intensity),ne=b.modalities??"";return e.jsx("div",{className:"rounded-2xl border border-border bg-card p-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"grid flex-1 grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Répétitions"}),e.jsx("div",{className:"mt-1",children:e.jsx($,{type:"number",min:1,value:b.repetitions??"",onChange:P=>F(g,A,"repetitions",P.target.value===""?null:Number(P.target.value)),className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Distance (m)"}),e.jsx("div",{className:"mt-1",children:e.jsx($,{type:"number",min:0,value:b.distance??"",onChange:P=>F(g,A,"distance",P.target.value===""?null:Number(P.target.value)),className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Nage"}),e.jsx("div",{className:"mt-1",children:e.jsxs(ce,{value:b.stroke,onValueChange:P=>F(g,A,"stroke",P),children:[e.jsx(de,{className:"rounded-2xl",children:e.jsx(ue,{})}),e.jsx(me,{children:oe.map(P=>e.jsx(O,{value:P.value,children:P.label},P.value))})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Type"}),e.jsx("div",{className:"mt-1",children:e.jsxs(ce,{value:b.strokeType,onValueChange:P=>F(g,A,"strokeType",P),children:[e.jsx(de,{className:"rounded-2xl",children:e.jsx(ue,{})}),e.jsx(me,{children:Re.map(P=>e.jsx(O,{value:P.value,children:P.label},P.value))})]})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Intensité (clic sur points)"}),e.jsxs("span",{className:B("inline-flex items-center gap-2 rounded-full bg-card px-2.5 py-1 text-xs font-semibold ring-1",T[q],Se[q]),children:[e.jsx("span",{className:B("h-2 w-2 rounded-full",$s[q]??"bg-muted")}),Ys(q)]})]}),e.jsx("div",{className:"mt-2 flex items-center justify-between gap-2",children:e.jsx(gn,{value:b.intensity,onChange:P=>F(g,A,"intensity",P)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Équipements"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:le.map(P=>{const we=b.equipment.includes(P.value),ze=_r(P.value);return e.jsxs("button",{type:"button",onClick:()=>{const _e=we?b.equipment.filter(ms=>ms!==P.value):[...b.equipment,P.value];F(g,A,"equipment",_e)},className:B("inline-flex items-center gap-2 rounded-full border px-3 py-2 text-xs font-semibold",we?"border-primary bg-primary text-primary-foreground":"border-border bg-card text-muted-foreground hover:bg-muted"),children:[e.jsx("span",{className:B("inline-flex h-7 w-7 items-center justify-center rounded-full",we?"bg-white/10":"bg-muted"),children:ze?e.jsx("img",{src:ze,alt:"",className:"h-4 w-4","aria-hidden":"true",loading:"lazy"}):null}),P.label]},P.value)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Modalités"}),e.jsx("div",{className:"mt-1",children:e.jsx(Pe,{value:ne,onChange:P=>F(g,A,"modalities",P.target.value),placeholder:"Une modalité par ligne",rows:3,className:"rounded-2xl"})})]})]}),e.jsx("button",{type:"button",onClick:()=>z(g,A),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer exercice",title:"Supprimer exercice",children:e.jsx(ye,{className:"h-4 w-4"})})]})},A)})}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs(S,{variant:"secondary",size:"sm",onClick:()=>E(g),className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(ge,{className:"h-4 w-4"})," Ajouter exercice"]}),e.jsxs(S,{variant:"destructive",size:"sm",onClick:()=>se(g),className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(ye,{className:"h-4 w-4"})," Supprimer bloc"]})]})]})},g))})]}),e.jsx("div",{className:"h-8"})]}),e.jsx(De,{open:!!o,onOpenChange:m=>{m||d(null)},children:e.jsx(Me,{className:"max-w-4xl",children:e.jsx(Vs,{title:o?.name??"",description:o?.description??void 0,items:o?.items})})})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:"Coach"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Création"})]}),e.jsxs("button",{type:"button",onClick:()=>{D(ee()),I("compact"),i(!0)},className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(ge,{className:"h-4 w-4"})," Nouvelle"]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-border bg-card px-3 py-2",children:[e.jsx(Er,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{className:"w-full bg-transparent text-sm outline-none placeholder:text-muted-foreground",placeholder:"Rechercher une séance",value:f,onChange:m=>C(m.target.value)})]}),ve&&e.jsx("div",{className:"mt-4 rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:"Impossible de charger les assignations."}),re&&e.jsx("div",{className:"mt-4 space-y-4",children:[1,2,3].map(m=>e.jsx("div",{className:"h-24 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},m))}),e.jsx("div",{className:"mt-4 space-y-3",children:R.map(m=>{const{totalDistance:g,totalDuration:b,blockCount:A}=wn(m),q=_n(m.id,xe??null),ne=!q||W.isPending;return e.jsx(G,{className:"rounded-2xl border-border",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold tracking-tight",children:m.name}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Cr,{className:"h-3.5 w-3.5"}),g,"m"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Ar,{className:"h-3.5 w-3.5"}),"~",b??"—"," min"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Sr,{className:"h-3.5 w-3.5"}),A]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>d(m),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Aperçu nageur",title:"Aperçu nageur",children:e.jsx(Ts,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>{D({id:m.id??null,name:m.name??Js(new Date),description:m.description??"",estimatedDuration:Number(m.estimated_duration??0),blocks:yn(m.items??[])}),I("compact"),i(!0)},className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Modifier",title:"Modifier",children:e.jsx(Wr,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>p(m),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Archiver",title:"Archiver",children:e.jsx(qr,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>{ne||h(m)},className:B("inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted",ne&&"cursor-not-allowed text-muted-foreground"),"aria-label":"Supprimer",title:xe===null?"Suppression désactivée":q?"Supprimer":"Séance déjà assignée",children:e.jsx(ye,{className:"h-4 w-4"})})]})]})})},m.id)})}),e.jsx("div",{className:"h-8"})]}),e.jsx(De,{open:!!o,onOpenChange:m=>{m||d(null)},children:e.jsx(Me,{className:"max-w-4xl",children:e.jsx(Vs,{title:o?.name??"",description:o?.description??void 0,items:o?.items})})}),e.jsx(Je,{open:!!x,onOpenChange:m=>{m||p(null)},children:e.jsxs(Xe,{children:[e.jsxs(Ye,{children:[e.jsx(Ze,{children:"Archiver la séance ?"}),e.jsx(es,{children:"La séance sera masquée du catalogue (sans suppression)."})]}),e.jsxs(ss,{children:[e.jsx(ts,{children:"Annuler"}),e.jsx(rs,{onClick:()=>{x&&(te(m=>new Set([...Array.from(m),x.id])),p(null),s({title:"Séance archivée"}))},children:"Archiver"})]})]})}),e.jsx(Je,{open:!!v,onOpenChange:m=>{m||h(null)},children:e.jsxs(Xe,{children:[e.jsxs(Ye,{children:[e.jsx(Ze,{children:"Supprimer la séance ?"}),e.jsx(es,{children:"Cette action est définitive. La séance sera supprimée du catalogue."})]}),e.jsxs(ss,{children:[e.jsx(ts,{children:"Annuler"}),e.jsx(rs,{onClick:()=>{v&&W.mutate(v.id)},children:"Supprimer"})]})]})})]})}function Sn(s,a,{checkForDefaultPrevented:r=!0}={}){return function(t){if(s?.(t),r===!1||!t.defaultPrevented)return a?.(t)}}var kn=as[" useInsertionEffect ".trim().toString()]||is;function Rn({prop:s,defaultProp:a,onChange:r=()=>{},caller:n}){const[t,i,o]=En({defaultProp:a,onChange:r}),d=s!==void 0,v=d?s:t;{const x=c.useRef(s!==void 0);c.useEffect(()=>{const p=x.current;p!==d&&console.warn(`${n} is changing from ${p?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),x.current=d},[d,n])}const h=c.useCallback(x=>{if(d){const p=An(x)?x(s):x;p!==s&&o.current?.(p)}else i(x)},[d,s,i,o]);return[v,h]}function En({defaultProp:s,onChange:a}){const[r,n]=c.useState(s),t=c.useRef(r),i=c.useRef(a);return kn(()=>{i.current=a},[a]),c.useEffect(()=>{t.current!==r&&(i.current?.(r),t.current=r)},[r,t]),[r,n,i]}function An(s){return typeof s=="function"}var Ct="Toggle",Ns=c.forwardRef((s,a)=>{const{pressed:r,defaultPressed:n,onPressedChange:t,...i}=s,[o,d]=Rn({prop:r,onChange:t,defaultProp:n??!1,caller:Ct});return e.jsx(je.button,{type:"button","aria-pressed":o,"data-state":o?"on":"off","data-disabled":s.disabled?"":void 0,...i,ref:a,onClick:Sn(s.onClick,()=>{s.disabled||d(!o)})})});Ns.displayName=Ct;var St=Ns,Pn=as[" useInsertionEffect ".trim().toString()]||is;function kt({prop:s,defaultProp:a,onChange:r=()=>{},caller:n}){const[t,i,o]=Dn({defaultProp:a,onChange:r}),d=s!==void 0,v=d?s:t;{const x=c.useRef(s!==void 0);c.useEffect(()=>{const p=x.current;p!==d&&console.warn(`${n} is changing from ${p?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),x.current=d},[d,n])}const h=c.useCallback(x=>{if(d){const p=Mn(x)?x(s):x;p!==s&&o.current?.(p)}else i(x)},[d,s,i,o]);return[v,h]}function Dn({defaultProp:s,onChange:a}){const[r,n]=c.useState(s),t=c.useRef(r),i=c.useRef(a);return Pn(()=>{i.current=a},[a]),c.useEffect(()=>{t.current!==r&&(i.current?.(r),t.current=r)},[r,t]),[r,n,i]}function Mn(s){return typeof s=="function"}var be="ToggleGroup",[Rt]=os(be,[ls]),Et=ls(),ws=pe.forwardRef((s,a)=>{const{type:r,...n}=s;if(r==="single"){const t=n;return e.jsx(Tn,{...t,ref:a})}if(r==="multiple"){const t=n;return e.jsx(Fn,{...t,ref:a})}throw new Error(`Missing prop \`type\` expected on \`${be}\``)});ws.displayName=be;var[At,Pt]=Rt(be),Tn=pe.forwardRef((s,a)=>{const{value:r,defaultValue:n,onValueChange:t=()=>{},...i}=s,[o,d]=kt({prop:r,defaultProp:n??"",onChange:t,caller:be});return e.jsx(At,{scope:s.__scopeToggleGroup,type:"single",value:pe.useMemo(()=>o?[o]:[],[o]),onItemActivate:d,onItemDeactivate:pe.useCallback(()=>d(""),[d]),children:e.jsx(Dt,{...i,ref:a})})}),Fn=pe.forwardRef((s,a)=>{const{value:r,defaultValue:n,onValueChange:t=()=>{},...i}=s,[o,d]=kt({prop:r,defaultProp:n??[],onChange:t,caller:be}),v=pe.useCallback(x=>d((p=[])=>[...p,x]),[d]),h=pe.useCallback(x=>d((p=[])=>p.filter(f=>f!==x)),[d]);return e.jsx(At,{scope:s.__scopeToggleGroup,type:"multiple",value:o,onItemActivate:v,onItemDeactivate:h,children:e.jsx(Dt,{...i,ref:a})})});ws.displayName=be;var[$n,Vn]=Rt(be),Dt=pe.forwardRef((s,a)=>{const{__scopeToggleGroup:r,disabled:n=!1,rovingFocus:t=!0,orientation:i,dir:o,loop:d=!0,...v}=s,h=Et(r),x=rt(o),p={role:"group",dir:x,...v};return e.jsx($n,{scope:r,rovingFocus:t,disabled:n,children:t?e.jsx(nt,{asChild:!0,...h,orientation:i,dir:x,loop:d,children:e.jsx(je.div,{...p,ref:a})}):e.jsx(je.div,{...p,ref:a})})}),ns="ToggleGroupItem",Mt=pe.forwardRef((s,a)=>{const r=Pt(ns,s.__scopeToggleGroup),n=Vn(ns,s.__scopeToggleGroup),t=Et(s.__scopeToggleGroup),i=r.value.includes(s.value),o=n.disabled||s.disabled,d={...s,pressed:i,disabled:o},v=pe.useRef(null);return n.rovingFocus?e.jsx(at,{asChild:!0,...t,focusable:!o,active:i,ref:v,children:e.jsx(st,{...d,ref:a})}):e.jsx(st,{...d,ref:a})});Mt.displayName=ns;var st=pe.forwardRef((s,a)=>{const{__scopeToggleGroup:r,value:n,...t}=s,i=Pt(ns,r),o={role:"radio","aria-checked":s.pressed,"aria-pressed":void 0},d=i.type==="single"?o:void 0;return e.jsx(Ns,{...d,...t,ref:a,onPressedChange:v=>{v?i.onItemActivate(n):i.onItemDeactivate(n)}})}),Tt=ws,Ft=Mt;const $t=mr("inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-2 min-w-9",sm:"h-8 px-1.5 min-w-8",lg:"h-10 px-2.5 min-w-10"}},defaultVariants:{variant:"default",size:"default"}}),In=c.forwardRef(({className:s,variant:a,size:r,...n},t)=>e.jsx(St,{ref:t,className:B($t({variant:a,size:r,className:s})),...n}));In.displayName=St.displayName;const Vt=c.createContext({size:"default",variant:"default"}),It=c.forwardRef(({className:s,variant:a,size:r,children:n,...t},i)=>e.jsx(Tt,{ref:i,className:B("flex items-center justify-center gap-1",s),...t,children:e.jsx(Vt.Provider,{value:{variant:a,size:r},children:n})}));It.displayName=Tt.displayName;const Qe=c.forwardRef(({className:s,children:a,variant:r,size:n,...t},i)=>{const o=c.useContext(Vt);return e.jsx(Ft,{ref:i,className:B($t({variant:o.variant||r,size:o.size||n}),s),...t,children:a})});Qe.displayName=Ft.displayName;const Te=({title:s,description:a,onBack:r,actions:n})=>e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(S,{variant:"ghost",size:"sm",className:"-ml-2",onClick:r,children:[e.jsx(Fr,{className:"mr-2 h-4 w-4"}),"Retour à l'accueil"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:s}),a?e.jsx("p",{className:"text-sm text-muted-foreground",children:a}):null]}),n?e.jsx("div",{className:"flex items-center gap-2",children:n}):null]});function Fe(s,a,{checkForDefaultPrevented:r=!0}={}){return function(t){if(s?.(t),r===!1||!t.defaultPrevented)return a?.(t)}}function qn(s){const a=On(s),r=c.forwardRef((n,t)=>{const{children:i,...o}=n,d=c.Children.toArray(i),v=d.find(Gn);if(v){const h=v.props.children,x=d.map(p=>p===v?c.Children.count(h)>1?c.Children.only(null):c.isValidElement(h)?h.props.children:null:p);return e.jsx(a,{...o,ref:t,children:c.isValidElement(h)?c.cloneElement(h,void 0,x):null})}return e.jsx(a,{...o,ref:t,children:i})});return r.displayName=`${s}.Slot`,r}function On(s){const a=c.forwardRef((r,n)=>{const{children:t,...i}=r;if(c.isValidElement(t)){const o=Bn(t),d=Ln(i,t.props);return t.type!==c.Fragment&&(d.ref=n?sr(n,o):o),c.cloneElement(t,d)}return c.Children.count(t)>1?c.Children.only(null):null});return a.displayName=`${s}.SlotClone`,a}var zn=Symbol("radix.slottable");function Gn(s){return c.isValidElement(s)&&typeof s.type=="function"&&"__radixId"in s.type&&s.type.__radixId===zn}function Ln(s,a){const r={...a};for(const n in a){const t=s[n],i=a[n];/^on[A-Z]/.test(n)?t&&i?r[n]=(...d)=>{const v=i(...d);return t(...d),v}:t&&(r[n]=t):n==="style"?r[n]={...t,...i}:n==="className"&&(r[n]=[t,i].filter(Boolean).join(" "))}return{...s,...r}}function Bn(s){let a=Object.getOwnPropertyDescriptor(s.props,"ref")?.get,r=a&&"isReactWarning"in a&&a.isReactWarning;return r?s.ref:(a=Object.getOwnPropertyDescriptor(s,"ref")?.get,r=a&&"isReactWarning"in a&&a.isReactWarning,r?s.props.ref:s.props.ref||s.ref)}var Un=as[" useInsertionEffect ".trim().toString()]||is;function Kn({prop:s,defaultProp:a,onChange:r=()=>{},caller:n}){const[t,i,o]=Hn({defaultProp:a,onChange:r}),d=s!==void 0,v=d?s:t;{const x=c.useRef(s!==void 0);c.useEffect(()=>{const p=x.current;p!==d&&console.warn(`${n} is changing from ${p?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),x.current=d},[d,n])}const h=c.useCallback(x=>{if(d){const p=Wn(x)?x(s):x;p!==s&&o.current?.(p)}else i(x)},[d,s,i,o]);return[v,h]}function Hn({defaultProp:s,onChange:a}){const[r,n]=c.useState(s),t=c.useRef(r),i=c.useRef(a);return Un(()=>{i.current=a},[a]),c.useEffect(()=>{t.current!==r&&(i.current?.(r),t.current=r)},[r,t]),[r,n,i]}function Wn(s){return typeof s=="function"}var us="Popover",[qt]=os(us,[it]),Oe=it(),[Qn,Ne]=qt(us),Ot=s=>{const{__scopePopover:a,children:r,open:n,defaultOpen:t,onOpenChange:i,modal:o=!1}=s,d=Oe(a),v=c.useRef(null),[h,x]=c.useState(!1),[p,f]=Kn({prop:n,defaultProp:t??!1,onChange:i,caller:us});return e.jsx(tr,{...d,children:e.jsx(Qn,{scope:a,contentId:rr(),triggerRef:v,open:p,onOpenChange:f,onOpenToggle:c.useCallback(()=>f(C=>!C),[f]),hasCustomAnchor:h,onCustomAnchorAdd:c.useCallback(()=>x(!0),[]),onCustomAnchorRemove:c.useCallback(()=>x(!1),[]),modal:o,children:r})})};Ot.displayName=us;var zt="PopoverAnchor",Jn=c.forwardRef((s,a)=>{const{__scopePopover:r,...n}=s,t=Ne(zt,r),i=Oe(r),{onCustomAnchorAdd:o,onCustomAnchorRemove:d}=t;return c.useEffect(()=>(o(),()=>d()),[o,d]),e.jsx(lt,{...i,...n,ref:a})});Jn.displayName=zt;var Gt="PopoverTrigger",Lt=c.forwardRef((s,a)=>{const{__scopePopover:r,...n}=s,t=Ne(Gt,r),i=Oe(r),o=Ie(a,t.triggerRef),d=e.jsx(je.button,{type:"button","aria-haspopup":"dialog","aria-expanded":t.open,"aria-controls":t.contentId,"data-state":Wt(t.open),...n,ref:o,onClick:Fe(s.onClick,t.onOpenToggle)});return t.hasCustomAnchor?d:e.jsx(lt,{asChild:!0,...i,children:d})});Lt.displayName=Gt;var _s="PopoverPortal",[Xn,Yn]=qt(_s,{forceMount:void 0}),Bt=s=>{const{__scopePopover:a,forceMount:r,children:n,container:t}=s,i=Ne(_s,a);return e.jsx(Xn,{scope:a,forceMount:r,children:e.jsx(vs,{present:r||i.open,children:e.jsx(nr,{asChild:!0,container:t,children:n})})})};Bt.displayName=_s;var ke="PopoverContent",Ut=c.forwardRef((s,a)=>{const r=Yn(ke,s.__scopePopover),{forceMount:n=r.forceMount,...t}=s,i=Ne(ke,s.__scopePopover);return e.jsx(vs,{present:n||i.open,children:i.modal?e.jsx(ea,{...t,ref:a}):e.jsx(sa,{...t,ref:a})})});Ut.displayName=ke;var Zn=qn("PopoverContent.RemoveScroll"),ea=c.forwardRef((s,a)=>{const r=Ne(ke,s.__scopePopover),n=c.useRef(null),t=Ie(a,n),i=c.useRef(!1);return c.useEffect(()=>{const o=n.current;if(o)return ar(o)},[]),e.jsx(ir,{as:Zn,allowPinchZoom:!0,children:e.jsx(Kt,{...s,ref:t,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Fe(s.onCloseAutoFocus,o=>{o.preventDefault(),i.current||r.triggerRef.current?.focus()}),onPointerDownOutside:Fe(s.onPointerDownOutside,o=>{const d=o.detail.originalEvent,v=d.button===0&&d.ctrlKey===!0,h=d.button===2||v;i.current=h},{checkForDefaultPrevented:!1}),onFocusOutside:Fe(s.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),sa=c.forwardRef((s,a)=>{const r=Ne(ke,s.__scopePopover),n=c.useRef(!1),t=c.useRef(!1);return e.jsx(Kt,{...s,ref:a,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{s.onCloseAutoFocus?.(i),i.defaultPrevented||(n.current||r.triggerRef.current?.focus(),i.preventDefault()),n.current=!1,t.current=!1},onInteractOutside:i=>{s.onInteractOutside?.(i),i.defaultPrevented||(n.current=!0,i.detail.originalEvent.type==="pointerdown"&&(t.current=!0));const o=i.target;r.triggerRef.current?.contains(o)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&t.current&&i.preventDefault()}})}),Kt=c.forwardRef((s,a)=>{const{__scopePopover:r,trapFocus:n,onOpenAutoFocus:t,onCloseAutoFocus:i,disableOutsidePointerEvents:o,onEscapeKeyDown:d,onPointerDownOutside:v,onFocusOutside:h,onInteractOutside:x,...p}=s,f=Ne(ke,r),C=Oe(r);return lr(),e.jsx(or,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:t,onUnmountAutoFocus:i,children:e.jsx(cr,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:x,onEscapeKeyDown:d,onPointerDownOutside:v,onFocusOutside:h,onDismiss:()=>f.onOpenChange(!1),children:e.jsx(dr,{"data-state":Wt(f.open),role:"dialog",id:f.contentId,...C,...p,ref:a,style:{...p.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Ht="PopoverClose",ta=c.forwardRef((s,a)=>{const{__scopePopover:r,...n}=s,t=Ne(Ht,r);return e.jsx(je.button,{type:"button",...n,ref:a,onClick:Fe(s.onClick,()=>t.onOpenChange(!1))})});ta.displayName=Ht;var ra="PopoverArrow",na=c.forwardRef((s,a)=>{const{__scopePopover:r,...n}=s,t=Oe(r);return e.jsx(ur,{...t,...n,ref:a})});na.displayName=ra;function Wt(s){return s?"open":"closed"}var aa=Ot,ia=Lt,la=Bt,Qt=Ut;const oa=aa,ca=ia,Jt=c.forwardRef(({className:s,align:a="center",sideOffset:r=4,...n},t)=>e.jsx(la,{children:e.jsx(Qt,{ref:t,align:a,sideOffset:r,className:B("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",s),...n})}));Jt.displayName=Qt.displayName;const da=({onBack:s,swimSessions:a,strengthSessions:r,athletes:n,groups:t})=>{const{toast:i}=qe(),[o,d]=c.useState({session_type:"swim",session_id:"",assigned_date:new Date().toISOString().split("T")[0],assigned_slot:"morning"}),[v,h]=c.useState(!1),[x,p]=c.useState("user"),[f,C]=c.useState(""),[N,I]=c.useState([]),y=u=>{const R=typeof u=="number"?u:Number(u);return Number.isFinite(R)&&R>0?R:null},te=c.useMemo(()=>n.map(u=>({value:u.id?`id:${u.id}`:`name:${u.display_name}`,label:u.group_label?`${u.display_name} · ${u.group_label}`:u.display_name,id:u.id,name:u.display_name})),[n]),ee=c.useMemo(()=>new Map(te.map(u=>[u.value,u])),[te]),w=c.useMemo(()=>t.map(u=>{const R=y(u.id);return R?{...u,gid:R}:null}).filter(u=>!!u),[t]),D=c.useMemo(()=>w.filter(u=>N.includes(u.gid)),[w,N]),ie=c.useMemo(()=>{if(D.length===0)return"Choisir des groupes";const u=D.slice(0,2).map(Y=>Y.name).join(", "),R=D.length>2?` +${D.length-2}`:"";return`${u}${R}`},[D]),re=ae({mutationFn:async u=>V.assignments_create(u),onSuccess:()=>{i({title:"Séance assignée & notifiée"})},onError:u=>{const R="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",Y=u instanceof Error?u.message:typeof u=="string"?u:R;let W=Y;const K=Y.match(/HTTP \d+:\s*(\{.*\})/);if(K)try{W=JSON.parse(K[1])?.error||R}catch{W=R}i({title:"Erreur d'assignation",description:W})}}),xe=async()=>{const u=Number(o.session_id);if(!Number.isInteger(u)||u<=0){i({title:"Séance invalide",description:"Sélectionnez une séance valide."});return}if(x==="group"){if(N.length===0){i({title:"Groupe manquant",description:"Sélectionnez au moins un groupe."});return}h(!0);try{const U={assignment_type:o.session_type,session_id:u,scheduled_date:o.assigned_date,scheduled_slot:o.assigned_slot},se=Array.from(new Set(N));await Promise.all(se.map(M=>V.assignments_create({...U,target_group_id:M}))),i({title:"Séance assignée & notifiée"})}catch(U){const se="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",M=U instanceof Error?U.message:typeof U=="string"?U:se;let E=M;const F=M.match(/HTTP \d+:\s*(\{.*\})/);if(F)try{E=JSON.parse(F[1])?.error||se}catch{E=se}i({title:"Erreur d'assignation",description:E})}finally{h(!1)}return}const R=f.trim();if(!R){i({title:"Nageur manquant",description:"Sélectionnez un nageur."});return}const Y=ee.get(R),W=Y?.id??(Number.isFinite(Number(R))&&Number(R)>0?Number(R):void 0);if(!Number.isFinite(W)||Number(W)<=0){i({title:"Nageur invalide",description:"Sélectionnez un nageur avec un identifiant valide."});return}const K=Y?.name??R.replace(/^name:/,"");re.mutate({assignment_type:o.session_type,session_id:u,target_athlete:K,target_user_id:W,scheduled_date:o.assigned_date,scheduled_slot:o.assigned_slot})},ve=!o.session_id||(x==="group"?N.length===0:!f.trim())||re.isPending||v;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(Te,{title:"Assigner une séance",description:"Planifiez une séance pour un nageur ou un ou plusieurs groupes.",onBack:s}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(G,{className:"border-l-4 border-l-primary",children:[e.jsxs(J,{children:[e.jsx(X,{children:"Séance"}),e.jsx(Z,{children:"Choisissez le type et la séance à envoyer."})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Type"}),e.jsxs(ce,{value:o.session_type,onValueChange:u=>d({...o,session_type:u,session_id:""}),children:[e.jsx(de,{children:e.jsx(ue,{})}),e.jsxs(me,{children:[e.jsx(O,{value:"swim",children:"Natation"}),e.jsx(O,{value:"strength",children:"Musculation"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Séance"}),e.jsxs(ce,{value:o.session_id,onValueChange:u=>d({...o,session_id:u}),children:[e.jsx(de,{children:e.jsx(ue,{placeholder:"Choisir..."})}),e.jsx(me,{children:o.session_type==="swim"?a?.map(u=>e.jsx(O,{value:u.id.toString(),children:u.name},u.id)):r?.map(u=>e.jsx(O,{value:u.id.toString(),children:u.title},u.id))})]})]})]})]}),e.jsxs(G,{children:[e.jsxs(J,{children:[e.jsx(X,{children:"Cible & planification"}),e.jsx(Z,{children:"Définissez le destinataire, la date et le créneau."})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Cible"}),e.jsxs(ce,{value:x,onValueChange:u=>{p(u),C(""),I([])},children:[e.jsx(de,{children:e.jsx(ue,{})}),e.jsxs(me,{children:[e.jsx(O,{value:"user",children:"Nageur"}),e.jsx(O,{value:"group",children:"Groupe(s)"})]})]})]}),x==="user"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Nageur"}),te.length>0?e.jsxs(ce,{value:f,onValueChange:C,children:[e.jsx(de,{children:e.jsx(ue,{placeholder:"Choisir un nageur"})}),e.jsx(me,{children:te.map(u=>e.jsx(O,{value:u.value,children:u.label},u.value))})]}):e.jsx($,{value:f,onChange:u=>C(u.target.value),placeholder:"ex: Camille"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Groupes"}),t.length>0?e.jsxs(oa,{children:[e.jsx(ca,{asChild:!0,children:e.jsxs(S,{type:"button",variant:"outline",className:"w-full justify-between","aria-label":"Sélection des groupes",children:[e.jsx("span",{className:"truncate",children:ie}),e.jsx($r,{className:"ml-2 h-4 w-4 opacity-50"})]})}),e.jsxs(Jt,{className:"w-[--radix-popover-trigger-width] p-2",align:"start",children:[e.jsx("div",{className:"max-h-64 overflow-auto",children:e.jsx("div",{className:"space-y-1",children:w.map(u=>{const R=N.includes(u.gid);return e.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 hover:bg-muted",children:[e.jsx(fs,{checked:R,onCheckedChange:Y=>{const W=Y===!0;I(K=>W?K.includes(u.gid)?K:[...K,u.gid]:K.filter(U=>U!==u.gid))}}),e.jsx("span",{className:"text-sm",children:u.name})]},u.gid)})})}),N.length>0?e.jsx(S,{type:"button",variant:"ghost",size:"sm",className:"mt-2 w-full",onClick:()=>I([]),children:"Tout désélectionner"}):null]})]}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"Aucun groupe disponible."}),N.length>0?e.jsxs("div",{className:"text-xs text-muted-foreground",children:[N.length," groupe",N.length>1?"s":""," sélectionné",N.length>1?"s":"","."]}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Date"}),e.jsx($,{type:"date",value:o.assigned_date,onChange:u=>d({...o,assigned_date:u.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Créneau"}),e.jsxs(ce,{value:o.assigned_slot,onValueChange:u=>d({...o,assigned_slot:u}),children:[e.jsx(de,{children:e.jsx(ue,{placeholder:"Choisir..."})}),e.jsxs(me,{children:[e.jsx(O,{value:"morning",children:"Matin"}),e.jsx(O,{value:"evening",children:"Soir"})]})]})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(S,{className:"w-full sm:w-auto",onClick:xe,disabled:ve,children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),re.isPending||v?"Assignation...":"Assigner & notifier"]})})]})},ua=({onBack:s,athletes:a,groups:r,athletesLoading:n})=>{const{toast:t}=qe(),[i,o]=c.useState(""),[d,v]=c.useState("Message Coach"),[h,x]=c.useState(""),p=c.useMemo(()=>a.filter(y=>y.id).map(y=>({value:`user:${y.id}`,label:y.group_label?`${y.display_name} · ${y.group_label}`:y.display_name,id:y.id})),[a]),f=c.useMemo(()=>r.map(y=>({value:`group:${y.id}`,label:y.name,id:y.id})),[r]),C=c.useMemo(()=>new Map([...p,...f].map(y=>[y.value,y])),[p,f]),N=ae({mutationFn:y=>V.notifications_send({...y,type:"message"}),onSuccess:()=>{t({title:"Message envoyé"}),o("")}}),I=()=>{if(!d.trim()||!i.trim()){t({title:"Message incomplet",description:"Ajoutez un titre et un contenu."});return}if(!h){t({title:"Destinataire manquant",description:"Sélectionnez un nageur ou un groupe."});return}const y=C.get(h);if(!y?.id){t({title:"Destinataire invalide",description:"Sélectionnez un destinataire valide."});return}if(h.startsWith("group:")){N.mutate({title:d,body:i,targets:[{target_group_id:y.id}]});return}N.mutate({title:d,body:i,targets:[{target_user_id:y.id}]})};return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(Te,{title:"Messagerie rapide",description:"Envoyez un message ciblé à vos nageurs.",onBack:s}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(G,{className:"border-l-4 border-l-primary",children:[e.jsxs(J,{children:[e.jsx(X,{children:"Destinataire"}),e.jsx(Z,{children:"Sélectionnez un nageur ou un groupe à prévenir."})]}),e.jsx(H,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Destinataire"}),e.jsxs(ce,{value:h,onValueChange:x,children:[e.jsx(de,{children:e.jsx(ue,{placeholder:n?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(me,{children:[f.length?e.jsxs(e.Fragment,{children:[e.jsx(O,{value:"section-group",disabled:!0,children:"Groupes"}),f.map(y=>e.jsx(O,{value:y.value,children:y.label},y.value))]}):null,p.length?e.jsxs(e.Fragment,{children:[e.jsx(O,{value:"section-athlete",disabled:!0,children:"Nageurs"}),p.map(y=>e.jsx(O,{value:y.value,children:y.label},y.value))]}):null]})]})]})})]}),e.jsxs(G,{children:[e.jsxs(J,{children:[e.jsx(X,{children:"Contenu"}),e.jsx(Z,{children:"Rédigez votre message en quelques lignes."})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"msg-title",children:"Titre"}),e.jsx($,{id:"msg-title",value:d,onChange:y=>v(y.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"msg-body",children:"Message"}),e.jsx(Pe,{id:"msg-body",placeholder:"Message...",value:i,onChange:y=>o(y.target.value),rows:5,maxLength:500}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[i.length,"/500"]})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(S,{className:"w-full sm:w-auto",onClick:I,disabled:N.isPending,children:[e.jsx(cs,{className:"mr-2 h-4 w-4"}),N.isPending?"Envoi...":"Envoyer"]})})]})},ma=({onNavigate:s})=>e.jsxs(G,{className:"border-l-4 border-l-primary",children:[e.jsxs(J,{children:[e.jsx(X,{children:"Actions rapides"}),e.jsx(Z,{children:"Accélérez vos tâches les plus fréquentes."})]}),e.jsxs(H,{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs(S,{className:"justify-start",variant:"outline",onClick:()=>s("assignments"),children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),"Assigner une séance"]}),e.jsxs(S,{className:"justify-start",variant:"outline",onClick:()=>s("messaging"),children:[e.jsx(cs,{className:"mr-2 h-4 w-4"}),"Message rapide"]})]})]}),pa=({onNavigate:s,onOpenRecordsAdmin:a,athletes:r,athletesLoading:n,upcomingBirthdays:t,birthdaysLoading:i,kpiLoading:o,kpiPeriod:d,onKpiPeriodChange:v,fatigueAlerts:h,mostLoadedAthlete:x})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Espace Coach"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Votre tableau de bord pour gérer les séances, les nageurs et la communication."})]}),e.jsxs("div",{className:"space-y-3 sm:hidden",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-[0.2em] text-muted-foreground",children:"Par où commencer"})}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("button",{type:"button",onClick:()=>s("swim"),className:"rounded-xl border bg-white p-4 text-left shadow-sm transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Créer une séance natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Structurer un nouveau plan."})]}),e.jsx(Ds,{className:"h-5 w-5 text-primary"})]})}),e.jsx("button",{type:"button",onClick:()=>s("assignments"),className:"rounded-xl border bg-white p-4 text-left shadow-sm transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Assigner une séance"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Envoyer une séance à un nageur."})]}),e.jsx($e,{className:"h-5 w-5 text-primary"})]})}),e.jsx("button",{type:"button",onClick:()=>s("messaging"),className:"rounded-xl border bg-white p-4 text-left shadow-sm transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Envoyer un message"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Relancer ou féliciter un nageur."})]}),e.jsx(cs,{className:"h-5 w-5 text-primary"})]})})]})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsx(ma,{onNavigate:s})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(G,{className:"shadow-sm",children:[e.jsxs(J,{children:[e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(Ds,{className:"h-5 w-5 text-primary"}),"Natation"]}),e.jsx(Z,{children:"Consultez et créez des séances natation."})]}),e.jsx(H,{children:e.jsx(S,{className:"w-full",onClick:()=>s("swim"),children:"Accéder à la bibliothèque"})})]}),e.jsxs(G,{className:"shadow-sm",children:[e.jsxs(J,{children:[e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(xr,{className:"h-5 w-5 text-primary"}),"Musculation"]}),e.jsx(Z,{children:"Préparez les plans muscu et les suivis."})]}),e.jsx(H,{children:e.jsx(S,{className:"w-full",onClick:()=>s("strength"),children:"Accéder à la bibliothèque"})})]}),e.jsxs(G,{className:"shadow-sm",children:[e.jsxs(J,{children:[e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(He,{className:"h-5 w-5 text-primary"}),"Mes nageurs"]}),e.jsx(Z,{children:"Accédez aux fiches individuelles et aux groupes."})]}),e.jsx(H,{children:e.jsx(S,{className:"w-full",onClick:()=>s("swimmers"),children:"Voir les nageurs"})})]}),e.jsxs(G,{className:"shadow-sm",children:[e.jsxs(J,{children:[e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(hr,{className:"h-5 w-5 text-primary"}),"Records club"]}),e.jsx(Z,{children:"Importer les performances FFN et reconstruire les records."})]}),e.jsxs(H,{children:[e.jsx(S,{className:"w-full",variant:"outline",onClick:a,children:"Administration des records"}),e.jsx(S,{className:"w-full mt-2",variant:"outline",onClick:()=>{window.location.hash="#/records-club"},children:"Voir les records du club"})]})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(G,{className:"sm:hidden bg-primary text-primary-foreground",children:[e.jsxs(J,{className:"space-y-1",children:[e.jsx(X,{className:"text-base",children:"Indicateurs clés"}),e.jsx(Z,{className:"text-primary-foreground/70",children:"Synthèse rapide pour aujourd'hui."})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-primary-foreground/10 bg-primary-foreground/5 p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-primary-foreground/70",children:"Fatigue 5/5"}),e.jsx("p",{className:"text-2xl font-semibold",children:o?"…":h.length}),e.jsx("p",{className:"text-xs text-primary-foreground/70",children:o?"Chargement...":h.length?h.slice(0,2).map(p=>p.athleteName).join(", "):"Aucune alerte"})]}),e.jsx(zs,{className:"h-5 w-5 text-primary-foreground/70"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-primary-foreground/10 bg-primary-foreground/5 p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-primary-foreground/70",children:"Nageur le plus chargé"}),e.jsx("p",{className:"text-lg font-semibold",children:o?"…":x?.athleteName??"-"}),e.jsx("p",{className:"text-xs text-primary-foreground/70",children:o?"Calcul en cours":x?`Charge ${Math.round(x.loadScore)}`:"Pas de données récentes"})]}),e.jsx(He,{className:"h-5 w-5 text-primary-foreground/70"})]})]})]}),e.jsxs(G,{className:"hidden sm:block",children:[e.jsx(J,{className:"space-y-2",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(X,{children:"Signaux clés"}),e.jsx(Z,{children:"Vue d'ensemble rapide de votre groupe."})]}),e.jsxs(It,{type:"single",size:"sm",variant:"outline",value:String(d),onValueChange:p=>{p&&v(Number(p))},children:[e.jsx(Qe,{value:"7","aria-label":"Période 7 jours","aria-pressed":d===7,children:"7j"}),e.jsx(Qe,{value:"30","aria-label":"Période 30 jours","aria-pressed":d===30,children:"30j"}),e.jsx(Qe,{value:"365","aria-label":"Période 365 jours","aria-pressed":d===365,children:"365j"})]})]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border bg-muted/30 p-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Fatigue 5/5 (",d,"j)"]}),e.jsx("p",{className:"text-xl font-semibold",children:o?"…":h.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o?"Chargement...":h.length?h.slice(0,2).map(p=>p.athleteName).join(", "):"Aucune alerte"})]}),e.jsx(zs,{className:"h-5 w-5 text-muted-foreground"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border bg-muted/30 p-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Nageur le plus chargé (",d,"j)"]}),e.jsx("p",{className:"text-xl font-semibold",children:o?"…":x?.athleteName??"-"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o?"Calcul en cours":x?`Charge ${Math.round(x.loadScore)}`:"Pas de données récentes"})]}),e.jsx(He,{className:"h-5 w-5 text-muted-foreground"})]})]})]}),e.jsxs(G,{children:[e.jsxs(J,{children:[e.jsx(X,{children:"Anniversaires à venir"}),e.jsx(Z,{children:"Les 30 prochains jours."})]}),e.jsxs(H,{className:"space-y-3",children:[i?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Chargement..."}):t&&t.length>0?t.slice(0,3).map(p=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:p.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:xa(p.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-semibold text-primary",children:["J-",p.days_until]})]},p.id)):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun anniversaire dans les 30 prochains jours."}),e.jsx(S,{variant:"outline",className:"w-full",onClick:()=>s("swimmers"),children:"Voir tous les nageurs"})]})]})]})]}),xa=s=>{if(!s)return"-";const a=new Date(s);return Number.isNaN(a.getTime())?s:a.toLocaleDateString("fr-FR")},tt=s=>s.toISOString().split("T")[0],ha=s=>new Date(s.completed_at||s.started_at||s.date||s.created_at||0).getTime(),fa=s=>{if(!s.length)return null;const a=s.reduce((n,t)=>n+t,0)/s.length,r=Math.min(5,Math.max(1,Math.round(a/10*5)));return{average:a,rating:r}};function La(){const s=Ke(u=>u.role);Ke(u=>u.selectedAthleteId);const a=Ke(u=>u.setSelectedAthlete),[,r]=pr(),[n,t]=c.useState("home"),[i,o]=c.useState(7),d=s==="coach"||s==="admin",v=n==="assignments",h=n==="home"||n==="assignments"||n==="messaging"||n==="swimmers",x=n==="assignments"||n==="messaging",p=n==="home"||n==="swimmers",{data:f}=he({queryKey:["swim_catalog"],queryFn:()=>V.getSwimCatalog(),enabled:d&&v}),{data:C}=he({queryKey:["strength_catalog"],queryFn:()=>V.getStrengthSessions(),enabled:d&&v}),{data:N=[],isLoading:I}=he({queryKey:["athletes"],queryFn:()=>V.getAthletes(),enabled:d&&h}),y=c.useMemo(()=>N.slice(0,5),[N]),{data:te=[]}=he({queryKey:["groups"],queryFn:()=>V.getGroups(),enabled:d&&x}),ee=he({queryKey:["upcoming-birthdays"],queryFn:()=>V.getUpcomingBirthdays({days:30}),enabled:d&&p}),w=ee.data,D=he({queryKey:["coach-kpis",i,y.map(u=>u.id??u.display_name)],enabled:d&&n==="home"&&y.length>0,queryFn:async()=>{const u=i,R=new Date;R.setDate(R.getDate()-u);const Y=tt(R),W=tt(new Date),K=await Promise.all(y.map(async M=>{const[E,F]=await Promise.all([V.getSessions(M.display_name,M.id),V.getStrengthHistory(M.display_name,{athleteId:M.id,limit:50,from:Y,to:W})]),z=E.filter(T=>new Date(T.date).getTime()>=R.getTime()),le=z.map(T=>T.fatigue??T.feeling).filter(T=>Number.isFinite(T)),oe=z.reduce((T,m)=>T+(Number(m.duration)||0)*(Number(m.effort)||0),0),Ce=(F?.runs??[]).filter(T=>ha(T)>=R.getTime()),Ee=Ce.map(T=>T.fatigue??T.feeling??T.rpe).filter(T=>Number.isFinite(Number(T))).map(T=>Number(T)),Ae=Ce.reduce((T,m)=>{const g=Number(m.feeling??m.rpe??0),b=Number(m.duration??0);if(b>0&&g>0)return T+b*g;const A=Array.isArray(m.logs)?m.logs.length:0;return T+A*5},0),Se=fa([...le,...Ee]);return{athleteName:M.display_name,loadScore:oe+Ae,fatigueRating:Se}})),U=K.filter(M=>M.fatigueRating?.rating===5).map(M=>({athleteName:M.athleteName,rating:M.fatigueRating?.rating??0})),se=K.filter(M=>M.loadScore>0).sort((M,E)=>E.loadScore-M.loadScore)[0];return{fatigueAlerts:U,mostLoadedAthlete:se??null}}}),ie=u=>{a({id:u.id??null,name:u.display_name}),r("/progress")},{toast:re}=qe(),xe=ys(),ve=ae({mutationFn:async u=>{const R=await V.importSingleSwimmer(u.iuf,u.name);return await V.recalculateClubRecords(),R},onSuccess:u=>{re({title:"Import terminé",description:`${u.total_found} trouvées, ${u.new_imported} nouvelles.`}),xe.invalidateQueries({queryKey:["club-records"]})},onError:u=>{re({title:"Erreur import",description:u.message,variant:"destructive"})}});return d?e.jsxs("div",{className:"space-y-6",children:[n==="home"?e.jsx(pa,{onNavigate:t,onOpenRecordsAdmin:()=>r("/records-admin"),athletes:N,athletesLoading:I,upcomingBirthdays:w,birthdaysLoading:ee.isLoading,kpiLoading:D.isLoading,kpiPeriod:i,onKpiPeriodChange:o,fatigueAlerts:D.data?.fatigueAlerts??[],mostLoadedAthlete:D.data?.mostLoadedAthlete??null}):null,n==="assignments"?e.jsx(da,{onBack:()=>t("home"),swimSessions:f,strengthSessions:C,athletes:N,groups:te}):null,n==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Te,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>t("home"),actions:e.jsxs(S,{variant:"outline",onClick:()=>t("assignments"),children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(Cn,{})]}):null,n==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Te,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>t("home"),actions:e.jsxs(S,{variant:"outline",onClick:()=>t("assignments"),children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(xn,{})]}):null,n==="swimmers"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Te,{title:"Nageurs",description:"Accédez aux fiches individuelles des nageurs.",onBack:()=>t("home"),actions:e.jsxs(S,{variant:"outline",onClick:()=>t("messaging"),children:[e.jsx(cs,{className:"mr-2 h-4 w-4"}),"Message rapide"]})}),e.jsxs(G,{children:[e.jsxs(J,{children:[e.jsx(X,{children:"Suivi des Nageurs"}),e.jsx(Z,{children:"Accédez aux fiches individuelles des nageurs."})]}),e.jsx(H,{children:I?e.jsx("div",{className:"space-y-3 p-2",children:[1,2,3,4,5].map(u=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-1/3 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"h-4 w-1/4 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"ml-auto h-8 w-16 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"})]},u))}):N.length?e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs(Pr,{children:[e.jsx(Dr,{children:e.jsxs(Is,{children:[e.jsx(Le,{children:"Nageur"}),e.jsx(Le,{children:"Groupe"}),e.jsx(Le,{children:"IUF"}),e.jsx(Le,{className:"text-right",children:"Actions"})]})}),e.jsx(Mr,{children:N.map(u=>e.jsxs(Is,{children:[e.jsx(Be,{className:"font-medium",children:u.display_name}),e.jsx(Be,{children:u.group_label?e.jsx(Tr,{variant:"secondary",children:u.group_label}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"Sans groupe"})}),e.jsx(Be,{children:u.ffn_iuf?e.jsx("span",{className:"text-xs font-mono text-muted-foreground",children:u.ffn_iuf}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"-"})}),e.jsx(Be,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[u.ffn_iuf?e.jsx(S,{size:"sm",variant:"ghost",disabled:ve.isPending,onClick:()=>ve.mutate({iuf:u.ffn_iuf,name:u.display_name}),title:"Importer performances FFN",children:e.jsx(Vr,{className:"h-4 w-4"})}):null,e.jsx(S,{size:"sm",variant:"outline",onClick:()=>ie(u),children:"Voir la fiche"})]})})]},u.id??u.display_name))})]})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun nageur disponible."})})]})]}):null,n==="messaging"?e.jsx(ua,{onBack:()=>t("home"),athletes:N,groups:te,athletesLoading:I}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(G,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(J,{children:[e.jsxs(X,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(He,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(Z,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(H,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}export{La as default};
