import{R as c,T as un,D as mn,t as fn,v as pn,w as hn,r as g,O as xn,j as e}from"./vendor-ui-CMUPCwTD.js";import{b as gn,u as Xe,d as vn,c as Ge}from"./vendor-query-WtxIVPOV.js";import{h as rt,j as ye,D as qe,B as L,C as Ve,b as yt,c as bt,d as Ft,f as wt,o as yn,X as ut,u as bn,i as wn,g as Re}from"./index-T_agY1No.js";import{I as ft}from"./input-3OPSM2FB.js";import{L as Qe}from"./label-CQnZ0Rjc.js";import{S as Lt,a as Ht,b as zt,c as Bt,d as Nn}from"./sheet-BqVuH-yT.js";import{S as Nt}from"./switch-B63MwlLq.js";import{S as jn,a as Sn,b as _n,c as Cn,d as it}from"./select-CiW2Vdzo.js";import{T as Rn,a as En,b as Rt,c as Et}from"./tabs-Ba-ZukLq.js";import{B as nt}from"./badge-CHYaj2Uv.js";import{C as kt}from"./check-DdXCpPtH.js";import{T as kn}from"./timer-D7rM232v.js";import{C as jt,I as Tn}from"./info-bm7tD2Ht.js";import{S as Mn}from"./search-CipplgHB.js";import{P as Tt}from"./play-BbtdGhhH.js";import{C as Mt}from"./chevron-left-CvSdFqfW.js";import{f as ot}from"./fr-CqUxEDd2.js";import{f as lt}from"./vendor-date-cQbdWov0.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BHfjz9SJ.js";import"./vendor-supabase-CrvtPqJM.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dn=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],An=rt("calendar",Dn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const In=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],$n=rt("circle-check",In);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const On=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],Pn=rt("pause",On);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fn=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Ln=rt("rotate-ccw",Fn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hn=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],zn=rt("sliders-horizontal",Hn);function Bn(t){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",r.appendChild(s),s.styleSheet?s.styleSheet.cssText=t:s.appendChild(document.createTextNode(t))}const qt=c.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),st=()=>{const t=c.useContext(qt);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};Bn(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}`);function qn(){const t=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(t)&&/Mobile/.test(t)||/FxiOS/.test(t))}function Vn(){return Ct(/^Mac/)}function Un(){return Ct(/^iPhone/)}function Dt(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function Wn(){return Ct(/^iPad/)||Vn()&&navigator.maxTouchPoints>1}function Vt(){return Un()||Wn()}function Ct(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const Kn=24,Qn=typeof window<"u"?g.useLayoutEffect:g.useEffect;function At(...t){return(...r)=>{for(let s of t)typeof s=="function"&&s(...r)}}const pt=typeof document<"u"&&window.visualViewport;function It(t){let r=window.getComputedStyle(t);return/(auto|scroll)/.test(r.overflow+r.overflowX+r.overflowY)}function Ut(t){for(It(t)&&(t=t.parentElement);t&&!It(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const Yn=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let ct=0,ht;function Xn(t={}){let{isDisabled:r}=t;Qn(()=>{if(!r)return ct++,ct===1&&Vt()&&(ht=Gn()),()=>{ct--,ct===0&&ht?.()}},[r])}function Gn(){let t,r=0,s=C=>{t=Ut(C.target),!(t===document.documentElement&&t===document.body)&&(r=C.changedTouches[0].pageY)},i=C=>{if(!t||t===document.documentElement||t===document.body){C.preventDefault();return}let j=C.changedTouches[0].pageY,z=t.scrollTop,I=t.scrollHeight-t.clientHeight;I!==0&&((z<=0&&j>r||z>=I&&j<r)&&C.preventDefault(),r=j)},l=C=>{let j=C.target;St(j)&&j!==document.activeElement&&(C.preventDefault(),j.style.transform="translateY(-2000px)",j.focus(),requestAnimationFrame(()=>{j.style.transform=""}))},o=C=>{let j=C.target;St(j)&&(j.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{j.style.transform="",pt&&(pt.height<window.innerHeight?requestAnimationFrame(()=>{$t(j)}):pt.addEventListener("resize",()=>$t(j),{once:!0}))}))},p=()=>{window.scrollTo(0,0)},h=window.pageXOffset,u=window.pageYOffset,R=At(Jn(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let v=At(Je(document,"touchstart",s,{passive:!1,capture:!0}),Je(document,"touchmove",i,{passive:!1,capture:!0}),Je(document,"touchend",l,{passive:!1,capture:!0}),Je(document,"focus",o,!0),Je(window,"scroll",p));return()=>{R(),v(),window.scrollTo(h,u)}}function Jn(t,r,s){let i=t.style[r];return t.style[r]=s,()=>{t.style[r]=i}}function Je(t,r,s,i){return t.addEventListener(r,s,i),()=>{t.removeEventListener(r,s,i)}}function $t(t){let r=document.scrollingElement||document.documentElement;for(;t&&t!==r;){let s=Ut(t);if(s!==document.documentElement&&s!==document.body&&s!==t){let i=s.getBoundingClientRect().top,l=t.getBoundingClientRect().top,o=t.getBoundingClientRect().bottom;const p=s.getBoundingClientRect().bottom+Kn;o>p&&(s.scrollTop+=l-i)}t=s.parentElement}}function St(t){return t instanceof HTMLInputElement&&!Yn.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function Zn(t,r){typeof t=="function"?t(r):t!=null&&(t.current=r)}function er(...t){return r=>t.forEach(s=>Zn(s,r))}function Wt(...t){return g.useCallback(er(...t),t)}const Kt=new WeakMap;function se(t,r,s=!1){if(!t||!(t instanceof HTMLElement))return;let i={};Object.entries(r).forEach(([l,o])=>{if(l.startsWith("--")){t.style.setProperty(l,o);return}i[l]=t.style[l],t.style[l]=o}),!s&&Kt.set(t,i)}function tr(t,r){if(!t||!(t instanceof HTMLElement))return;let s=Kt.get(t);s&&(t.style[r]=s[r])}const Z=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function dt(t,r){if(!t)return null;const s=window.getComputedStyle(t),i=s.transform||s.webkitTransform||s.mozTransform;let l=i.match(/^matrix3d\((.+)\)$/);return l?parseFloat(l[1].split(", ")[Z(r)?13:12]):(l=i.match(/^matrix\((.+)\)$/),l?parseFloat(l[1].split(", ")[Z(r)?5:4]):null)}function nr(t){return 8*(Math.log(t+1)-2)}function xt(t,r){if(!t)return()=>{};const s=t.style.cssText;return Object.assign(t.style,r),()=>{t.style.cssText=s}}function rr(...t){return(...r)=>{for(const s of t)typeof s=="function"&&s(...r)}}const Q={DURATION:.5,EASE:[.32,.72,0,1]},Qt=.4,sr=.25,ar=100,Yt=8,ze=16,_t=26,gt="vaul-dragging";function Xt(t){const r=c.useRef(t);return c.useEffect(()=>{r.current=t}),c.useMemo(()=>(...s)=>r.current==null?void 0:r.current.call(r,...s),[])}function ir({defaultProp:t,onChange:r}){const s=c.useState(t),[i]=s,l=c.useRef(i),o=Xt(r);return c.useEffect(()=>{l.current!==i&&(o(i),l.current=i)},[i,l,o]),s}function Gt({prop:t,defaultProp:r,onChange:s=()=>{}}){const[i,l]=ir({defaultProp:r,onChange:s}),o=t!==void 0,p=o?t:i,h=Xt(s),u=c.useCallback(R=>{if(o){const C=typeof R=="function"?R(t):R;C!==t&&h(C)}else l(R)},[o,t,l,h]);return[p,u]}function or({activeSnapPointProp:t,setActiveSnapPointProp:r,snapPoints:s,drawerRef:i,overlayRef:l,fadeFromIndex:o,onSnapPointChange:p,direction:h="bottom",container:u,snapToSequentialPoint:R}){const[v,C]=Gt({prop:t,defaultProp:s?.[0],onChange:r}),[j,z]=c.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);c.useEffect(()=>{function y(){z({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",y),()=>window.removeEventListener("resize",y)},[]);const I=c.useMemo(()=>v===s?.[s.length-1]||null,[s,v]),T=c.useMemo(()=>{var y;return(y=s?.findIndex(w=>w===v))!=null?y:null},[s,v]),W=s&&s.length>0&&(o||o===0)&&!Number.isNaN(o)&&s[o]===v||!s,S=c.useMemo(()=>{const y=u?{width:u.getBoundingClientRect().width,height:u.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var w;return(w=s?.map(E=>{const q=typeof E=="string";let V=0;if(q&&(V=parseInt(E,10)),Z(h)){const N=q?V:j?E*y.height:0;return j?h==="bottom"?y.height-N:-y.height+N:N}const ee=q?V:j?E*y.width:0;return j?h==="right"?y.width-ee:-y.width+ee:ee}))!=null?w:[]},[s,j,u]),$=c.useMemo(()=>T!==null?S?.[T]:null,[S,T]),O=c.useCallback(y=>{var w;const E=(w=S?.findIndex(q=>q===y))!=null?w:null;p(E),se(i.current,{transition:`transform ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`,transform:Z(h)?`translate3d(0, ${y}px, 0)`:`translate3d(${y}px, 0, 0)`}),S&&E!==S.length-1&&o!==void 0&&E!==o&&E<o?se(l.current,{transition:`opacity ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`,opacity:"0"}):se(l.current,{transition:`opacity ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`,opacity:"1"}),C(s?.[Math.max(E,0)])},[i.current,s,S,o,l,C]);c.useEffect(()=>{if(v||t){var y;const w=(y=s?.findIndex(E=>E===t||E===v))!=null?y:-1;S&&w!==-1&&typeof S[w]=="number"&&O(S[w])}},[v,t,s,S,O]);function _({draggedDistance:y,closeDrawer:w,velocity:E,dismissible:q}){if(o===void 0)return;const V=h==="bottom"||h==="right"?($??0)-y:($??0)+y,ee=T===o-1,N=T===0,X=y>0;if(ee&&se(l.current,{transition:`opacity ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`}),!R&&E>2&&!X){q?w():O(S[0]);return}if(!R&&E>2&&X&&S&&s){O(S[s.length-1]);return}const te=S?.reduce((U,ue)=>typeof U!="number"||typeof ue!="number"?U:Math.abs(ue-V)<Math.abs(U-V)?ue:U),ae=Z(h)?window.innerHeight:window.innerWidth;if(E>Qt&&Math.abs(y)<ae*.4){const U=X?1:-1;if(U>0&&I&&s){O(S[s.length-1]);return}if(N&&U<0&&q&&w(),T===null)return;O(S[T+U]);return}O(te)}function me({draggedDistance:y}){if($===null)return;const w=h==="bottom"||h==="right"?$-y:$+y;(h==="bottom"||h==="right")&&w<S[S.length-1]||(h==="top"||h==="left")&&w>S[S.length-1]||se(i.current,{transform:Z(h)?`translate3d(0, ${w}px, 0)`:`translate3d(${w}px, 0, 0)`})}function le(y,w){if(!s||typeof T!="number"||!S||o===void 0)return null;const E=T===o-1;if(T>=o&&w)return 0;if(E&&!w)return 1;if(!W&&!E)return null;const V=E?T+1:T-1,ee=E?S[V]-S[V-1]:S[V+1]-S[V],N=y/Math.abs(ee);return E?1-N:N}return{isLastSnapPoint:I,activeSnapPoint:v,shouldFade:W,getPercentageDragged:le,setActiveSnapPoint:C,activeSnapPointIndex:T,onRelease:_,onDrag:me,snapPointsOffset:S}}const lr=()=>()=>{};function cr(){const{direction:t,isOpen:r,shouldScaleBackground:s,setBackgroundColorOnScale:i,noBodyStyles:l}=st(),o=c.useRef(null),p=g.useMemo(()=>document.body.style.backgroundColor,[]);function h(){return(window.innerWidth-_t)/window.innerWidth}c.useEffect(()=>{if(r&&s){o.current&&clearTimeout(o.current);const u=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!u)return;rr(i&&!l?xt(document.body,{background:"black"}):lr,xt(u,{transformOrigin:Z(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${Q.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Q.EASE.join(",")})`}));const R=xt(u,{borderRadius:`${Yt}px`,overflow:"hidden",...Z(t)?{transform:`scale(${h()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${h()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{R(),o.current=window.setTimeout(()=>{p?document.body.style.background=p:document.body.style.removeProperty("background")},Q.DURATION*1e3)}}},[r,s,p])}let Ze=null;function dr({isOpen:t,modal:r,nested:s,hasBeenOpened:i,preventScrollRestoration:l,noBodyStyles:o}){const[p,h]=c.useState(()=>typeof window<"u"?window.location.href:""),u=c.useRef(0),R=c.useCallback(()=>{if(Dt()&&Ze===null&&t&&!o){Ze={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:C,innerHeight:j}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-u.current}px`,left:`${-C}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const z=j-window.innerHeight;z&&u.current>=j&&(document.body.style.top=`${-(u.current+z)}px`)}),300)}},[t]),v=c.useCallback(()=>{if(Dt()&&Ze!==null&&!o){const C=-parseInt(document.body.style.top,10),j=-parseInt(document.body.style.left,10);Object.assign(document.body.style,Ze),window.requestAnimationFrame(()=>{if(l&&p!==window.location.href){h(window.location.href);return}window.scrollTo(j,C)}),Ze=null}},[p]);return c.useEffect(()=>{function C(){u.current=window.scrollY}return C(),window.addEventListener("scroll",C),()=>{window.removeEventListener("scroll",C)}},[]),c.useEffect(()=>{if(r)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||v()}},[r,v]),c.useEffect(()=>{s||!i||(t?(!window.matchMedia("(display-mode: standalone)").matches&&R(),r||window.setTimeout(()=>{v()},500)):v())},[t,i,p,r,s,R,v]),{restorePositionSetting:v}}function ur({open:t,onOpenChange:r,children:s,onDrag:i,onRelease:l,snapPoints:o,shouldScaleBackground:p=!1,setBackgroundColorOnScale:h=!0,closeThreshold:u=sr,scrollLockTimeout:R=ar,dismissible:v=!0,handleOnly:C=!1,fadeFromIndex:j=o&&o.length-1,activeSnapPoint:z,setActiveSnapPoint:I,fixed:T,modal:W=!0,onClose:S,nested:$,noBodyStyles:O=!1,direction:_="bottom",defaultOpen:me=!1,disablePreventScroll:le=!0,snapToSequentialPoint:y=!1,preventScrollRestoration:w=!1,repositionInputs:E=!0,onAnimationEnd:q,container:V,autoFocus:ee=!1}){var N,X;const[te=!1,ae]=Gt({defaultProp:me,prop:t,onChange:x=>{r?.(x),!x&&!$&&J(),setTimeout(()=>{q?.(x)},Q.DURATION*1e3),x&&!W&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),x||(document.body.style.pointerEvents="auto")}}),[U,ue]=c.useState(!1),[K,he]=c.useState(!1),[Ae,H]=c.useState(!1),xe=c.useRef(null),Ie=c.useRef(null),we=c.useRef(null),ke=c.useRef(null),fe=c.useRef(null),ie=c.useRef(!1),Pe=c.useRef(null),B=c.useRef(0),ne=c.useRef(!1),$e=c.useRef(!me),Te=c.useRef(0),f=c.useRef(null),Ue=c.useRef(((N=f.current)==null?void 0:N.getBoundingClientRect().height)||0),A=c.useRef(((X=f.current)==null?void 0:X.getBoundingClientRect().width)||0),ce=c.useRef(0),ge=c.useCallback(x=>{o&&x===_e.length-1&&(Ie.current=new Date)},[]),{activeSnapPoint:Ye,activeSnapPointIndex:Se,setActiveSnapPoint:Ne,onRelease:je,snapPointsOffset:_e,onDrag:We,shouldFade:Fe,getPercentageDragged:G}=or({snapPoints:o,activeSnapPointProp:z,setActiveSnapPointProp:I,drawerRef:f,fadeFromIndex:j,overlayRef:xe,onSnapPointChange:ge,direction:_,container:V,snapToSequentialPoint:y});Xn({isDisabled:!te||K||!W||Ae||!U||!E||!le});const{restorePositionSetting:J}=dr({isOpen:te,modal:W,nested:$??!1,hasBeenOpened:U,preventScrollRestoration:w,noBodyStyles:O});function be(){return(window.innerWidth-_t)/window.innerWidth}function Ke(x){var M,D;!v&&!o||f.current&&!f.current.contains(x.target)||(Ue.current=((M=f.current)==null?void 0:M.getBoundingClientRect().height)||0,A.current=((D=f.current)==null?void 0:D.getBoundingClientRect().width)||0,he(!0),we.current=new Date,Vt()&&window.addEventListener("touchend",()=>ie.current=!1,{once:!0}),x.target.setPointerCapture(x.pointerId),B.current=Z(_)?x.pageY:x.pageX)}function Le(x,M){var D;let k=x;const a=(D=window.getSelection())==null?void 0:D.toString(),m=f.current?dt(f.current,_):null,F=new Date;if(k.tagName==="SELECT"||k.hasAttribute("data-vaul-no-drag")||k.closest("[data-vaul-no-drag]"))return!1;if(_==="right"||_==="left")return!0;if(Ie.current&&F.getTime()-Ie.current.getTime()<500)return!1;if(m!==null&&(_==="bottom"?m>0:m<0))return!0;if(a&&a.length>0)return!1;if(fe.current&&F.getTime()-fe.current.getTime()<R&&m===0||M)return fe.current=F,!1;for(;k;){if(k.scrollHeight>k.clientHeight){if(k.scrollTop!==0)return fe.current=new Date,!1;if(k.getAttribute("role")==="dialog")return!0}k=k.parentNode}return!0}function He(x){if(f.current&&K){const M=_==="bottom"||_==="right"?1:-1,D=(B.current-(Z(_)?x.pageY:x.pageX))*M,k=D>0,a=o&&!v&&!k;if(a&&Se===0)return;const m=Math.abs(D),F=document.querySelector("[data-vaul-drawer-wrapper]"),b=_==="bottom"||_==="top"?Ue.current:A.current;let Y=m/b;const de=G(m,k);if(de!==null&&(Y=de),a&&Y>=1||!ie.current&&!Le(x.target,k))return;if(f.current.classList.add(gt),ie.current=!0,se(f.current,{transition:"none"}),se(xe.current,{transition:"none"}),o&&We({draggedDistance:D}),k&&!o){const pe=nr(D),Oe=Math.min(pe*-1,0)*M;se(f.current,{transform:Z(_)?`translate3d(0, ${Oe}px, 0)`:`translate3d(${Oe}px, 0, 0)`});return}const ve=1-Y;if((Fe||j&&Se===j-1)&&(i?.(x,Y),se(xe.current,{opacity:`${ve}`,transition:"none"},!0)),F&&xe.current&&p){const pe=Math.min(be()+Y*(1-be()),1),Oe=8-Y*8,at=Math.max(0,14-Y*14);se(F,{borderRadius:`${Oe}px`,transform:Z(_)?`scale(${pe}) translate3d(0, ${at}px, 0)`:`scale(${pe}) translate3d(${at}px, 0, 0)`,transition:"none"},!0)}if(!o){const pe=m*M;se(f.current,{transform:Z(_)?`translate3d(0, ${pe}px, 0)`:`translate3d(${pe}px, 0, 0)`})}}}c.useEffect(()=>{window.requestAnimationFrame(()=>{$e.current=!0})},[]),c.useEffect(()=>{var x;function M(){if(!f.current||!E)return;const D=document.activeElement;if(St(D)||ne.current){var k;const a=((k=window.visualViewport)==null?void 0:k.height)||0,m=window.innerHeight;let F=m-a;const b=f.current.getBoundingClientRect().height||0,Y=b>m*.8;ce.current||(ce.current=b);const de=f.current.getBoundingClientRect().top;if(Math.abs(Te.current-F)>60&&(ne.current=!ne.current),o&&o.length>0&&_e&&Se){const ve=_e[Se]||0;F+=ve}if(Te.current=F,b>a||ne.current){const ve=f.current.getBoundingClientRect().height;let pe=ve;ve>a&&(pe=a-(Y?de:_t)),T?f.current.style.height=`${ve-Math.max(F,0)}px`:f.current.style.height=`${Math.max(pe,a-de)}px`}else qn()||(f.current.style.height=`${ce.current}px`);o&&o.length>0&&!ne.current?f.current.style.bottom="0px":f.current.style.bottom=`${Math.max(F,0)}px`}}return(x=window.visualViewport)==null||x.addEventListener("resize",M),()=>{var D;return(D=window.visualViewport)==null?void 0:D.removeEventListener("resize",M)}},[Se,o,_e]);function Ee(x){d(),S?.(),x||ae(!1),setTimeout(()=>{o&&Ne(o[0])},Q.DURATION*1e3)}function n(){if(!f.current)return;const x=document.querySelector("[data-vaul-drawer-wrapper]"),M=dt(f.current,_);se(f.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`}),se(xe.current,{transition:`opacity ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`,opacity:"1"}),p&&M&&M>0&&te&&se(x,{borderRadius:`${Yt}px`,overflow:"hidden",...Z(_)?{transform:`scale(${be()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${be()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${Q.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Q.EASE.join(",")})`},!0)}function d(){!K||!f.current||(f.current.classList.remove(gt),ie.current=!1,he(!1),ke.current=new Date)}function P(x){if(!K||!f.current)return;f.current.classList.remove(gt),ie.current=!1,he(!1),ke.current=new Date;const M=dt(f.current,_);if(!x||!Le(x.target,!1)||!M||Number.isNaN(M)||we.current===null)return;const D=ke.current.getTime()-we.current.getTime(),k=B.current-(Z(_)?x.pageY:x.pageX),a=Math.abs(k)/D;if(a>.05&&(H(!0),setTimeout(()=>{H(!1)},200)),o){je({draggedDistance:k*(_==="bottom"||_==="right"?1:-1),closeDrawer:Ee,velocity:a,dismissible:v}),l?.(x,!0);return}if(_==="bottom"||_==="right"?k>0:k<0){n(),l?.(x,!0);return}if(a>Qt){Ee(),l?.(x,!1);return}var m;const F=Math.min((m=f.current.getBoundingClientRect().height)!=null?m:0,window.innerHeight);var b;const Y=Math.min((b=f.current.getBoundingClientRect().width)!=null?b:0,window.innerWidth),de=_==="left"||_==="right";if(Math.abs(M)>=(de?Y:F)*u){Ee(),l?.(x,!1);return}l?.(x,!0),n()}c.useEffect(()=>(te&&(se(document.documentElement,{scrollBehavior:"auto"}),Ie.current=new Date),()=>{tr(document.documentElement,"scrollBehavior")}),[te]);function re(x){const M=x?(window.innerWidth-ze)/window.innerWidth:1,D=x?-ze:0;Pe.current&&window.clearTimeout(Pe.current),se(f.current,{transition:`transform ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`,transform:Z(_)?`scale(${M}) translate3d(0, ${D}px, 0)`:`scale(${M}) translate3d(${D}px, 0, 0)`}),!x&&f.current&&(Pe.current=setTimeout(()=>{const k=dt(f.current,_);se(f.current,{transition:"none",transform:Z(_)?`translate3d(0, ${k}px, 0)`:`translate3d(${k}px, 0, 0)`})},500))}function oe(x,M){if(M<0)return;const D=(window.innerWidth-ze)/window.innerWidth,k=D+M*(1-D),a=-ze+M*ze;se(f.current,{transform:Z(_)?`scale(${k}) translate3d(0, ${a}px, 0)`:`scale(${k}) translate3d(${a}px, 0, 0)`,transition:"none"})}function Ce(x,M){const D=Z(_)?window.innerHeight:window.innerWidth,k=M?(D-ze)/D:1,a=M?-ze:0;M&&se(f.current,{transition:`transform ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`,transform:Z(_)?`scale(${k}) translate3d(0, ${a}px, 0)`:`scale(${k}) translate3d(${a}px, 0, 0)`})}return c.useEffect(()=>{W||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[W]),c.createElement(fn,{defaultOpen:me,onOpenChange:x=>{!v&&!x||(x?ue(!0):Ee(!0),ae(x))},open:te},c.createElement(qt.Provider,{value:{activeSnapPoint:Ye,snapPoints:o,setActiveSnapPoint:Ne,drawerRef:f,overlayRef:xe,onOpenChange:r,onPress:Ke,onRelease:P,onDrag:He,dismissible:v,shouldAnimate:$e,handleOnly:C,isOpen:te,isDragging:K,shouldFade:Fe,closeDrawer:Ee,onNestedDrag:oe,onNestedOpenChange:re,onNestedRelease:Ce,keyboardIsOpen:ne,modal:W,snapPointsOffset:_e,activeSnapPointIndex:Se,direction:_,shouldScaleBackground:p,setBackgroundColorOnScale:h,noBodyStyles:O,container:V,autoFocus:ee}},s))}const Jt=c.forwardRef(function({...t},r){const{overlayRef:s,snapPoints:i,onRelease:l,shouldFade:o,isOpen:p,modal:h,shouldAnimate:u}=st(),R=Wt(r,s),v=i&&i.length>0;if(!h)return null;const C=c.useCallback(j=>l(j),[l]);return c.createElement(xn,{onMouseUp:C,ref:R,"data-vaul-overlay":"","data-vaul-snap-points":p&&v?"true":"false","data-vaul-snap-points-overlay":p&&o?"true":"false","data-vaul-animate":u?.current?"true":"false",...t})});Jt.displayName="Drawer.Overlay";const Zt=c.forwardRef(function({onPointerDownOutside:t,style:r,onOpenAutoFocus:s,...i},l){const{drawerRef:o,onPress:p,onRelease:h,onDrag:u,keyboardIsOpen:R,snapPointsOffset:v,activeSnapPointIndex:C,modal:j,isOpen:z,direction:I,snapPoints:T,container:W,handleOnly:S,shouldAnimate:$,autoFocus:O}=st(),[_,me]=c.useState(!1),le=Wt(l,o),y=c.useRef(null),w=c.useRef(null),E=c.useRef(!1),q=T&&T.length>0;cr();const V=(N,X,te=0)=>{if(E.current)return!0;const ae=Math.abs(N.y),U=Math.abs(N.x),ue=U>ae,K=["bottom","right"].includes(X)?1:-1;if(X==="left"||X==="right"){if(!(N.x*K<0)&&U>=0&&U<=te)return ue}else if(!(N.y*K<0)&&ae>=0&&ae<=te)return!ue;return E.current=!0,!0};c.useEffect(()=>{q&&window.requestAnimationFrame(()=>{me(!0)})},[]);function ee(N){y.current=null,E.current=!1,h(N)}return c.createElement(hn,{"data-vaul-drawer-direction":I,"data-vaul-drawer":"","data-vaul-delayed-snap-points":_?"true":"false","data-vaul-snap-points":z&&q?"true":"false","data-vaul-custom-container":W?"true":"false","data-vaul-animate":$?.current?"true":"false",...i,ref:le,style:v&&v.length>0?{"--snap-point-height":`${v[C??0]}px`,...r}:r,onPointerDown:N=>{S||(i.onPointerDown==null||i.onPointerDown.call(i,N),y.current={x:N.pageX,y:N.pageY},p(N))},onOpenAutoFocus:N=>{s?.(N),O||N.preventDefault()},onPointerDownOutside:N=>{if(t?.(N),!j||N.defaultPrevented){N.preventDefault();return}R.current&&(R.current=!1)},onFocusOutside:N=>{if(!j){N.preventDefault();return}},onPointerMove:N=>{if(w.current=N,S||(i.onPointerMove==null||i.onPointerMove.call(i,N),!y.current))return;const X=N.pageY-y.current.y,te=N.pageX-y.current.x,ae=N.pointerType==="touch"?10:2;V({x:te,y:X},I,ae)?u(N):(Math.abs(te)>ae||Math.abs(X)>ae)&&(y.current=null)},onPointerUp:N=>{i.onPointerUp==null||i.onPointerUp.call(i,N),y.current=null,E.current=!1,h(N)},onPointerOut:N=>{i.onPointerOut==null||i.onPointerOut.call(i,N),ee(w.current)},onContextMenu:N=>{i.onContextMenu==null||i.onContextMenu.call(i,N),w.current&&ee(w.current)}})});Zt.displayName="Drawer.Content";const mr=250,fr=120,pr=c.forwardRef(function({preventCycle:t=!1,children:r,...s},i){const{closeDrawer:l,isDragging:o,snapPoints:p,activeSnapPoint:h,setActiveSnapPoint:u,dismissible:R,handleOnly:v,isOpen:C,onPress:j,onDrag:z}=st(),I=c.useRef(null),T=c.useRef(!1);function W(){if(T.current){O();return}window.setTimeout(()=>{S()},fr)}function S(){if(o||t||T.current){O();return}if(O(),!p||p.length===0){R||l();return}if(h===p[p.length-1]&&R){l();return}const me=p.findIndex(y=>y===h);if(me===-1)return;const le=p[me+1];u(le)}function $(){I.current=window.setTimeout(()=>{T.current=!0},mr)}function O(){I.current&&window.clearTimeout(I.current),T.current=!1}return c.createElement("div",{onClick:W,onPointerCancel:O,onPointerDown:_=>{v&&j(_),$()},onPointerMove:_=>{v&&z(_)},ref:i,"data-vaul-drawer-visible":C?"true":"false","data-vaul-handle":"","aria-hidden":"true",...s},c.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},r))});pr.displayName="Drawer.Handle";function hr(t){const r=st(),{container:s=r.container,...i}=t;return c.createElement(pn,{container:s,...i})}const De={Root:ur,Content:Zt,Overlay:Jt,Portal:hr,Title:un,Description:mn},en=({shouldScaleBackground:t=!0,...r})=>e.jsx(De.Root,{shouldScaleBackground:t,...r});en.displayName="Drawer";const xr=De.Portal,tn=g.forwardRef(({className:t,...r},s)=>e.jsx(De.Overlay,{ref:s,className:ye("fixed inset-0 z-50 bg-black/80",t),...r}));tn.displayName=De.Overlay.displayName;const nn=g.forwardRef(({className:t,children:r,...s},i)=>e.jsxs(xr,{children:[e.jsx(tn,{}),e.jsxs(De.Content,{ref:i,className:ye("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",t),...s,children:[e.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),r]})]}));nn.displayName="DrawerContent";const rn=({className:t,...r})=>e.jsx("div",{className:ye("grid gap-1.5 p-4 text-center sm:text-left",t),...r});rn.displayName="DrawerHeader";const sn=g.forwardRef(({className:t,...r},s)=>e.jsx(De.Title,{ref:s,className:ye("text-lg font-semibold leading-none tracking-tight",t),...r}));sn.displayName=De.Title.displayName;const an=g.forwardRef(({className:t,...r},s)=>e.jsx(De.Description,{ref:s,className:ye("text-sm text-muted-foreground",t),...r}));an.displayName=De.Description.displayName;function on({children:t,className:r,containerClassName:s}){return e.jsx("div",{role:"region","aria-label":"Actions",className:ye("fixed bottom-16 left-0 right-0 z-bar md:bottom-0 md:z-bar",r),children:e.jsx("div",{className:ye("mx-auto flex w-full max-w-md items-center justify-between gap-2 border-t bg-background px-4 py-3 shadow-[0_-2px_10px_rgba(0,0,0,0.1)]","md:supports-[padding:env(safe-area-inset-bottom)]:pb-[calc(env(safe-area-inset-bottom)+0.75rem)]",s),children:t})})}const gr=[1,2,3,4,5];function Ot({value:t,onChange:r,className:s,disabled:i=!1,size:l="md",ariaLabel:o="Sélecteur d'échelle 1 à 5"}){const p=l==="sm"?"h-10 w-10 text-xs":"h-11 w-11 text-sm";return e.jsx("div",{className:ye("flex items-center gap-2",s),role:"group","aria-label":o,children:gr.map(h=>{const u=t===h;return e.jsx("button",{type:"button",className:ye("flex items-center justify-center rounded-full border font-semibold transition",p,u?"border-primary bg-primary text-primary-foreground":"border-muted-foreground/30 bg-background text-foreground",i&&"opacity-60"),"aria-pressed":u,disabled:i,onClick:()=>{i||r?.(h)},children:h},h)})})}const mt=(t,r)=>{const s=Number(t?.set_index??t?.set_number??t?.setIndex??r);return!Number.isFinite(s)||s<=0?r:s},ln=(t=[],r,s)=>{if(!t.length)return 0;const i=Array.isArray(r)?r:[];if(i.length>0){const p=new Map;i.forEach((u,R)=>{if(!u?.exercise_id)return;const v=p.get(u.exercise_id)??[];v.push({...u,set_index:mt(u,R+1)}),p.set(u.exercise_id,v)});let h=t.length+1;for(let u=0;u<t.length;u+=1){const R=t[u];if((p.get(R.exercise_id)??[]).length<(R.sets??0)){h=u+1;break}}return h}const l=Number(s??0);if(!Number.isFinite(l)||l<=0)return 0;const o=Math.min(t.length,Math.max(0,Math.round(l/100*t.length)));return Math.min(t.length,o+1)},Me=(t,r)=>{const s=Number(t);return!Number.isFinite(s)||s<=0?"—":r?`${s}${r}`:String(s)};function vr({session:t,exercises:r,oneRMs:s,onFinish:i,onStart:l,onLogSets:o,onProgress:p,initialLogs:h,isFinishing:u,initialStep:R,onStepChange:v,initialInputOpen:C,initialSeriesOpen:j,onExitFocus:z}){const[I,T]=g.useState(R??0),[W,S]=g.useState([]),[$,O]=g.useState(0),[_,me]=g.useState(!0),[le,y]=g.useState(0),[w,E]=g.useState(!1),[q,V]=g.useState(!1),[ee,N]=g.useState(!0),[X,te]=g.useState(3),[ae,U]=g.useState(3),[ue,K]=g.useState(""),[he,Ae]=g.useState(!1),[H,xe]=g.useState(1),[Ie,we]=g.useState(j??!1),[ke,fe]=g.useState(C??!1),[ie,Pe]=g.useState("weight"),[B,ne]=g.useState(""),[$e,Te]=g.useState(!1);g.useEffect(()=>{let a=null;return _&&(a=setInterval(()=>O(m=>m+1),1e3)),()=>{a&&clearInterval(a)}},[_]),g.useEffect(()=>{if(!$e)return;const a=m=>{m.key==="Escape"&&Te(!1)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[$e]),g.useEffect(()=>{let a=null;return w&&!q&&le>0?a=setInterval(()=>y(m=>m-1),1e3):le===0&&w&&(E(!1),V(!1)),()=>{a&&clearInterval(a)}},[w,q,le]);const f=t.items||[],Ue=I-1,A=I>0&&I<=f.length?f[Ue]:null,ce=A?r.find(a=>a.id===A.exercise_id):null,ge=I<f.length?f[I]:null,Ye=ge?r.find(a=>a.id===ge.exercise_id):null,Se=(()=>{const a=ce?.muscle_groups??ce?.muscles??ce?.muscleGroups??[];return Array.isArray(a)?a:[]})(),Ne=A?.rest_seconds??0,je=f.length?Math.min(100,Math.max(0,Math.round((I-1)/f.length*100))):0,_e=Number(A?.percent_1rm),We=Number.isFinite(_e)&&_e>0,Fe=We&&s.find(a=>a.exercise_id===A?.exercise_id)?.weight||0,G=We?Math.round(Fe*(_e/100)):0,[J,be]=g.useState({}),Ke=g.useMemo(()=>{const a=new Map;return W.forEach((m,F)=>{const b=mt(m,F+1);m.exercise_id&&a.set(`${m.exercise_id}-${b}`,m)}),a},[W]),Le=A?`${A.exercise_id}-${H}`:null,He=Le?Ke.get(Le):null,Ee=He?.weight??J[H-1]?.weight??G,n=He?.reps??J[H-1]?.reps??A?.reps??"",d=()=>{if(typeof window>"u")return;const a=["#22c55e","#3b82f6","#f97316","#e11d48","#a855f7"],m=120;for(let F=0;F<m;F+=1){const b=document.createElement("div"),Y=Math.random()*6+6;b.style.position="fixed",b.style.top="-10px",b.style.left=`${Math.random()*100}vw`,b.style.width=`${Y}px`,b.style.height=`${Y*.6}px`,b.style.backgroundColor=a[F%a.length],b.style.opacity="0.9",b.style.pointerEvents="none",b.style.zIndex="9999",b.style.borderRadius="2px",document.body.appendChild(b);const de=(Math.random()-.5)*200,ve=1200+Math.random()*800,pe=Math.random()*360;b.animate([{transform:"translate3d(0, 0, 0) rotate(0deg)",opacity:1},{transform:`translate3d(${de}px, ${window.innerHeight+200}px, 0) rotate(${pe}deg)`,opacity:0}],{duration:ve,easing:"ease-out"}).onfinish=()=>b.remove()}};g.useEffect(()=>{if(!h){S(b=>b.length?[]:b),be(b=>Object.keys(b).length?{}:b);return}if(S(h),!h.length){be(b=>Object.keys(b).length?{}:b),T(b=>b===0?b:0);return}const a=t.items||[];if(!a.length)return;const m=new Map;h.forEach((b,Y)=>{if(!b.exercise_id)return;const de=m.get(b.exercise_id)??[];de.push({...b,set_index:mt(b,Y+1)}),m.set(b.exercise_id,de)});const F=ln(a,h);if(F>0&&F<=a.length){const b=a[F-1],Y=m.get(b.exercise_id)??[],de=Y.reduce((pe,Oe,at)=>{const dn=mt(Oe,at+1);return pe[dn-1]={reps:Oe.reps??void 0,weight:Oe.weight??void 0},pe},{});be(de);const ve=Math.min(b.sets??1,Y.length+1);xe(ve)}else be({}),xe(1);T(b=>b===F?b:F)},[h,t.items]),g.useEffect(()=>{I<=f.length||he||(d(),Ae(!0))},[I,f.length,he]);const P=a=>{T(a),v?.(a)},re=a=>{a<=0||(y(a),E(!0),V(!1))},oe=async()=>{const a=I+1;xe(1),be({}),P(a);const m=Math.round(Math.min(a-1,f.length)/f.length*100);try{await p?.(m)}catch{}},Ce=async()=>{if(!A)return;if(He){H>=A.sets?await oe():xe(m=>Math.min(A.sets,m+1));return}const a={exercise_id:A.exercise_id,set_number:H,reps:J[H-1]?.reps||A.reps,weight:J[H-1]?.weight||G};S(m=>[...m,a]);try{await o?.([a])}catch{}if(ee&&A.rest_seconds>0&&re(A.rest_seconds),H>=A.sets){await oe();return}xe(m=>Math.min(A.sets,m+1))},x=a=>{Pe(a);const m=a==="weight"?J[H-1]?.weight??G??"":J[H-1]?.reps??A?.reps??"";ne(m?String(m):""),fe(!0)},M=()=>{if(!A)return;const a=Number(ie==="weight"?B.replace(",","."):B);Number.isFinite(a)&&(be(m=>({...m,[H-1]:{...m[H-1],[ie]:a}})),fe(!1))},D=a=>{ne(m=>a==="."&&m.includes(".")?m:m+a)},k=a=>{if(!A)return;Pe(a);const m=a==="weight"?J[H-1]?.weight??G??"":J[H-1]?.reps??A?.reps??"";ne(m?String(m):"")};return I===0?e.jsxs("div",{className:"space-y-6 text-center py-8 animate-in zoom-in duration-300",children:[e.jsx("div",{className:"h-24 w-24 bg-primary/10 rounded-full flex items-center justify-center mx-auto animate-pulse",children:e.jsx(qe,{className:"h-10 w-10 text-primary ml-1"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold font-display uppercase",children:t.title}),e.jsx("p",{className:"text-muted-foreground text-lg",children:t.description}),e.jsxs("div",{className:"flex gap-2 justify-center mt-4",children:[e.jsx(nt,{variant:"outline",className:"text-sm px-3 py-1",children:t.cycle}),e.jsxs(nt,{variant:"secondary",className:"text-sm px-3 py-1",children:[f.length," Exercices"]})]})]}),e.jsx(L,{size:"lg",className:"w-full text-xl h-14 font-bold uppercase tracking-wider shadow-lg hover:scale-[1.02] transition-transform",onClick:async()=>{await l?.(),P(1)},children:"COMMENCER SÉANCE"})]}):I>f.length?e.jsx("div",{className:"space-y-6 animate-in fade-in",children:e.jsxs(Ve,{className:"border-t-8 border-t-primary shadow-xl",children:[e.jsxs(yt,{className:"text-center pb-2",children:[e.jsx("div",{className:"mx-auto bg-primary/10 p-4 rounded-full w-fit mb-4",children:e.jsx($n,{className:"h-12 w-12 text-primary"})}),e.jsx(bt,{className:"text-3xl uppercase font-display italic",children:"Séance Terminée !"}),e.jsxs(Ft,{className:"text-lg",children:["Durée totale: ",Math.floor($/60),"m ",$%60,"s"]})]}),e.jsxs(wt,{className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Volume"}),e.jsxs("div",{className:"text-2xl font-mono font-bold",children:[W.reduce((a,m)=>a+(Number(m.weight)||0)*(Number(m.reps)||0),0)," kg"]})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Séries"}),e.jsx("div",{className:"text-2xl font-mono font-bold",children:W.length})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Qe,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Difficulté de la séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Facile"}),e.jsx("span",{children:"Très dur"})]}),e.jsx(Ot,{value:X,onChange:te})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Qe,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Fatigue fin de séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Frais"}),e.jsx("span",{children:"Épuisé"})]}),e.jsx(Ot,{value:ae,onChange:U})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Qe,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Notes"}),e.jsx("textarea",{placeholder:"Sensations, douleurs...",value:ue,onChange:a=>K(a.target.value),rows:3,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none"})]})]}),e.jsx(yn,{children:e.jsx(L,{className:"w-full h-14 text-lg font-bold uppercase",disabled:u,onClick:()=>{u||i({duration:Math.floor($/60),feeling:X,fatigue:ae,comments:ue,logs:W})},children:u?"ENREGISTREMENT...":"ENREGISTRER & FERMER"})})]})}):e.jsxs("div",{className:"space-y-6 pb-32",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button","aria-label":"Voir l’animation de l’exercice",onClick:()=>{ce?.illustration_gif&&Te(!0)},className:"flex h-12 w-12 items-center justify-center overflow-hidden rounded-full border bg-card shadow-sm",children:ce?.illustration_gif?e.jsx("img",{src:ce.illustration_gif,alt:"",className:"h-full w-full object-cover",loading:"lazy",decoding:"async"}):e.jsx(qe,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold",children:["Ex ",I,"/",f.length]}),e.jsxs("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold",children:["S ",H,"/",Me(A?.sets)]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Séance"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-28 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${je}%`}})}),e.jsxs("div",{className:"text-sm font-semibold",children:[je,"%"]})]}),z?e.jsx(L,{variant:"ghost",size:"icon","aria-label":"Quitter le focus",onClick:z,children:e.jsx(ut,{className:"h-4 w-4"})}):null]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold tracking-tight",children:ce?.nom_exercice??"Exercice"}),Se.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:Se.map(a=>e.jsx("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:a},a))})]}),e.jsxs(Ve,{className:"rounded-3xl border bg-card p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-base font-semibold",children:"Série en cours"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Nt,{checked:ee,onCheckedChange:N}),"Auto repos"]})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border bg-muted/20 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"En cours"}),e.jsxs("div",{className:"mt-2 text-lg font-semibold",children:["Série ",H,"/",Me(A?.sets)," · Objectif"," ",Me(A?.reps)," reps"]}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:"Appuie sur une tuile pour saisir."})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>x("weight"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:Ee||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>x("reps"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:n||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"reps"})]})]})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border bg-muted/10 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Notes"}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:A?.notes||ce?.description||"Aucune note spécifique."})]}),e.jsx(L,{type:"button",variant:"outline",className:"mt-4 w-full rounded-2xl",onClick:()=>we(!0),children:"Voir les séries"})]}),!ke&&!w?e.jsxs(on,{className:"bottom-0 z-[60]",containerClassName:"gap-3 py-4",children:[e.jsxs(L,{className:"flex-1 min-w-0 h-12 rounded-xl text-sm font-bold shadow-lg active:scale-95 transition-transform",onClick:Ce,children:[e.jsx(kt,{className:"mr-2 h-5 w-5"})," Valider série"]}),e.jsx(L,{type:"button",variant:"outline",className:"h-12 w-12 rounded-xl p-0 active:scale-95 transition-transform",onClick:()=>{Ne<=0||re(Ne)},"aria-label":"Démarrer le repos",children:e.jsx(kn,{className:"h-5 w-5"})}),e.jsx(L,{type:"button",variant:"outline",className:"h-12 w-12 rounded-xl p-0 active:scale-95 transition-transform",onClick:()=>oe(),"aria-label":"Exercice suivant",children:e.jsx(jt,{className:"h-5 w-5"})})]}):null,w&&e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-background/95 pb-[env(safe-area-inset-bottom)]",children:[e.jsxs("div",{className:"flex items-start justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Timer"}),e.jsx("div",{className:"text-lg font-semibold",children:"Transition inter-exercice"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Prochain exercice : ",Ye?.nom_exercice??"À venir"]})]}),e.jsx(L,{variant:"ghost",size:"icon",onClick:()=>{E(!1),V(!1)},"aria-label":"Fermer le timer de repos",children:e.jsx(ut,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-6 px-6 py-8",children:[e.jsxs(Ve,{className:"w-full max-w-sm rounded-3xl border p-6 shadow-sm",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Temps restant"}),e.jsxs("div",{className:"mt-2 text-5xl font-semibold tracking-tight",children:[Math.floor(le/60),":",String(le%60).padStart(2,"0")]}),e.jsx("div",{className:"mt-6 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:Ne?`${le/Ne*100}%`:"0%"}})}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[e.jsx(L,{variant:"outline",className:"rounded-full",onClick:()=>y(a=>a+15),children:"+15s"}),e.jsx(L,{variant:"outline",className:"rounded-full",onClick:()=>y(a=>a+30),children:"+30s"}),e.jsx(L,{variant:"outline",className:"rounded-full",onClick:()=>y(a=>Math.max(0,a-15)),children:"-15s"}),e.jsxs(L,{variant:"outline",className:"ml-auto rounded-full",onClick:()=>y(Ne),children:[e.jsx(Ln,{className:"mr-2 h-4 w-4"}),"Reset"]})]})]}),e.jsxs("div",{className:"flex w-full max-w-sm flex-wrap gap-3",children:[e.jsxs(L,{className:"flex-1 rounded-full py-6 text-base font-semibold",onClick:()=>V(a=>!a),children:[e.jsx(Pn,{className:"mr-2 h-4 w-4"})," ",q?"Reprendre":"Pause"]}),e.jsxs(L,{variant:"outline",className:"rounded-full px-6 py-6 text-base font-semibold",onClick:()=>{E(!1),y(0),V(!1)},children:["Passer ",e.jsx(jt,{className:"ml-2 h-4 w-4"})]})]})]})]}),$e&&ce?.illustration_gif&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:()=>Te(!1),children:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button","aria-label":"Fermer",className:"absolute -right-3 -top-3 rounded-full bg-background p-2 shadow",onClick:()=>Te(!1),children:e.jsx(ut,{className:"h-4 w-4"})}),e.jsx("img",{src:ce.illustration_gif,alt:"",className:"max-h-[80vh] w-auto max-w-[92vw] rounded-2xl"})]})})}),e.jsx(Lt,{open:Ie,onOpenChange:we,children:e.jsxs(Ht,{side:"bottom",className:"max-h-[80vh] overflow-y-auto",children:[e.jsx(zt,{children:e.jsx(Bt,{children:"Aperçu séance"})}),e.jsx("div",{className:"mt-4 space-y-4",children:f.map((a,m)=>{const F=r.find(de=>de.id===a.exercise_id),b=Array.from({length:a.sets}).filter((de,ve)=>Ke.get(`${a.exercise_id}-${ve+1}`)).length,Y=a.sets?Math.round(b/a.sets*100):0;return e.jsxs(Ve,{className:"rounded-3xl border bg-muted/10 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:F?.nom_exercice??a.exercise_name}),e.jsxs("div",{className:"mt-1 text-sm text-muted-foreground",children:[Me(a.sets),"x",Me(a.reps)," ·"," ",a.percent_1rm?`${Me(a.percent_1rm)} 1RM`:"—"]})]}),e.jsxs("div",{className:"rounded-full bg-muted px-3 py-1 text-sm font-semibold",children:[b,"/",Me(a.sets)]})]}),e.jsx("div",{className:"mt-4 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${Y}%`}})})]},`${a.exercise_id}-${m}`)})})]})}),e.jsx(en,{open:ke,onOpenChange:fe,children:e.jsx(nn,{className:"max-h-[90vh]",children:e.jsxs("div",{className:"mx-auto w-full max-w-md px-4 pb-8",children:[e.jsxs(rn,{className:"pb-2",children:[e.jsx(sn,{className:"text-center",children:ie==="weight"?"Charge":"Répétitions"}),e.jsxs(an,{className:"text-center",children:["Série ",H,"/",Me(A?.sets)," · Objectif"," ",Me(A?.reps)," reps"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("button",{type:"button",className:ye("rounded-xl border-2 p-4 text-center transition-all",ie==="weight"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>k("weight"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[ie==="weight"?B||"—":String(J[H-1]?.weight??G??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:ye("rounded-xl border-2 p-4 text-center transition-all",ie==="reps"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>k("reps"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[ie==="reps"?B||"—":String(J[H-1]?.reps??A?.reps??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"reps"})]})]})]}),ie==="weight"&&G>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[G-10,G-5,G,G+5,G+10].filter(a=>a>0).map(a=>e.jsxs(L,{variant:Number(B)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>ne(String(a)),children:[a," kg"]},a))})]}),ie==="reps"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[6,8,10,12,15,20].map(a=>e.jsx(L,{variant:Number(B)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>ne(String(a)),children:a},a))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[[1,2,3,4,5,6,7,8,9].map(a=>e.jsx(L,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>D(String(a)),children:a},a)),e.jsx(L,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>D("."),children:","}),e.jsx(L,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>D("0"),children:"0"}),e.jsx(L,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>ne(a=>a.slice(0,-1)),children:"⌫"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(L,{variant:"outline",className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:()=>ne(""),children:"Effacer"}),e.jsxs(L,{className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:M,children:[e.jsx(kt,{className:"mr-2 h-5 w-5"}),"Valider"]})]})]})})})]})}const Be=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance",et=t=>{const r=Number(t);return!Number.isFinite(r)||r<=0?null:r},yr=(t,r)=>{if(!t)return{sets:null,reps:null,percent1rm:null,restSeries:null,restExercise:null};const s={endurance:{sets:t.Nb_series_endurance,reps:t.Nb_reps_endurance,percent1rm:t.pct_1rm_endurance,restSeries:t.recup_endurance,restExercise:t.recup_exercices_endurance},hypertrophie:{sets:t.Nb_series_hypertrophie,reps:t.Nb_reps_hypertrophie,percent1rm:t.pct_1rm_hypertrophie,restSeries:t.recup_hypertrophie,restExercise:t.recup_exercices_hypertrophie},force:{sets:t.Nb_series_force,reps:t.Nb_reps_force,percent1rm:t.pct_1rm_force,restSeries:t.recup_force,restExercise:t.recup_exercices_force}}[r];return{sets:et(s.sets),reps:et(s.reps),percent1rm:et(s.percent1rm),restSeries:et(s.restSeries),restExercise:et(s.restExercise)}},tt=(t=[],r,s)=>wr(t,r).map(i=>{const l=yr(s.get(i.exercise_id),r);return{...i,sets:l.sets??0,reps:l.reps??0,rest_seconds:l.restSeries??0,percent_1rm:l.percent1rm??0}}),Pt=t=>{const r=Number(t);return!Number.isFinite(r)||r<=0?"—":String(r)},br=t=>{const r=Number(t);return!Number.isFinite(r)||r<=0?"—":`${r}s`},cn=(t=[])=>{if(!t.length)return t;const r=t.map((i,l)=>{const o=Number(i.order_index);return{item:i,index:l,order:Number.isFinite(o)?o:null}});return r.some(i=>i.order!==null)?r.sort((i,l)=>i.order===null&&l.order===null?i.index-l.index:i.order===null?1:l.order===null?-1:i.order===l.order?i.index-l.index:i.order-l.order).map(i=>i.item):t},wr=(t=[],r)=>{const s=t.filter(l=>l.cycle_type===r),i=s.length?s:t;return cn(i)},Nr=t=>{t.setActiveSession(null),t.setActiveAssignment(null),t.setActiveRunId(null),t.setActiveRunLogs(null),t.setActiveRunnerStep(0),t.setScreenMode("list")},jr=({runId:t,assignmentId:r,startedAt:s})=>({id:t,assignment_id:r??null,started_at:s,progress_pct:0,status:"in_progress",logs:[]}),vt=t=>({runs:t?[t]:[],pagination:{limit:1,offset:0,total:t?1:0},exercise_summary:[]});function Ur(){const{user:t,userId:r,role:s,selectedAthleteId:i,selectedAthleteName:l}=bn(),{toast:o}=wn(),p=gn(),h="strength-preferences",[u,R]=g.useState(null),[v,C]=g.useState(null),[j,z]=g.useState(null),[I,T]=g.useState(null),[W,S]=g.useState(0),[$,O]=g.useState("list"),[_,me]=g.useState({poolMode:!1,largeText:!1}),[le,y]=g.useState(""),[w,E]=g.useState("endurance"),[q,V]=g.useState("all"),[ee,N]=g.useState(""),[X,te]=g.useState(""),ae=(s==="coach"||s==="admin")&&(i!==null||!!l),U=ae?l:t,ue=ae?i:r,K=ue??U,he=g.useMemo(()=>`strength-focus-state-${K??"anonymous"}`,[K]),{poolMode:Ae,largeText:H}=_;g.useEffect(()=>{if(typeof window>"u")return;const n=window.localStorage.getItem(h);if(n)try{const d=JSON.parse(n);me(P=>({...P,...d??{}}))}catch{return}},[]),g.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(h,JSON.stringify(_))},[h,_]),g.useEffect(()=>{if(!(typeof document>"u")){if($==="focus")return document.body.dataset.focusMode="strength",()=>{document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode};document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode}},[$]),g.useEffect(()=>{if(typeof window>"u"||u)return;const n=window.localStorage.getItem(he);if(n)try{const d=JSON.parse(n),P=d?.screenMode==="focus"?"focus":d?.screenMode==="reader"?"reader":null;if(!P||!d?.session)return;R(d.session),C(d.assignment??null),z(typeof d.runId=="number"?d.runId:null),T(Array.isArray(d.runLogs)?d.runLogs:null),S(Number.isFinite(d.runnerStep)?d.runnerStep:0),d.cycleType&&E(Be(d.cycleType)),O(P)}catch{return}},[u,he]),g.useEffect(()=>{if(typeof window>"u")return;if(!($==="focus"||$==="reader")||!u){window.localStorage.removeItem(he);return}const d={screenMode:$,session:u,assignment:v,runId:j,runLogs:I,runnerStep:W,cycleType:w};window.localStorage.setItem(he,JSON.stringify(d))},[v,j,I,W,u,w,he,$]);const{data:xe}=Xe({queryKey:["assignments",t,"strength"],queryFn:()=>Re.getAssignments(t,r,{assignmentType:"strength"}),enabled:!!t}),{data:Ie}=Xe({queryKey:["strength_catalog"],queryFn:()=>Re.getStrengthSessions()}),{data:we}=Xe({queryKey:["exercises"],queryFn:()=>Re.getExercises()}),{data:ke}=Xe({queryKey:["1rm",t,r],queryFn:()=>Re.get1RM({athleteName:t,athleteId:r}),enabled:!!t}),fe=vn({queryKey:["strength_history",K,q,ee,X],queryFn:({pageParam:n=0})=>Re.getStrengthHistory(U,{athleteId:ue,limit:10,offset:n,order:"desc",status:q==="all"?void 0:q,from:ee||void 0,to:X||void 0}),enabled:!!U,getNextPageParam:n=>{const d=n.pagination.offset+n.pagination.limit;return d<n.pagination.total?d:void 0},initialPageParam:0}),ie=fe.data?.pages.flatMap(n=>n.runs)??[],B=Xe({queryKey:["strength_run_in_progress",K],queryFn:()=>Re.getStrengthHistory(U,{limit:1,offset:0,order:"desc",status:"in_progress",athleteId:ue}),enabled:!!U}).data?.runs?.[0]??null,ne=B?.status==="completed"||(B?.progress_pct??0)>=100,$e=Ge({mutationFn:n=>Re.startStrengthRun(n),onSuccess:n=>{if(n?.run_id&&(z(n.run_id),T(d=>d??[]),K)){const d=jr({runId:n.run_id,assignmentId:v?.id??null,startedAt:new Date().toISOString()});p.setQueryData(["strength_run_in_progress",K],vt(d))}p.invalidateQueries({queryKey:["assignments",t,"strength"]}),p.invalidateQueries({queryKey:["strength_run_in_progress",K]}),p.invalidateQueries({queryKey:["strength_history"]})},onError:()=>{o({title:"Erreur",description:"Impossible de démarrer la séance.",variant:"destructive"})}}),Te=Ge({mutationFn:n=>Re.logStrengthSet(n),onSuccess:n=>{n?.one_rm_updated&&(p.invalidateQueries({queryKey:["1rm",t,r]}),o({title:"Nouveau 1RM détecté",description:"Ton record vient d'être mis à jour."}))},onError:()=>{o({title:"Erreur",description:"Impossible d'enregistrer une série.",variant:"destructive"})}}),f=Ge({mutationFn:n=>Re.updateStrengthRun(n),onSuccess:(n,d)=>{p.invalidateQueries({queryKey:["strength_history"]}),d?.status==="completed"&&(K&&p.setQueryData(["strength_run_in_progress",K],vt(null)),p.invalidateQueries({queryKey:["assignments",t]}),p.invalidateQueries({queryKey:["assignments",t,"strength"]}),p.invalidateQueries({queryKey:["1rm",t,r]}),C(null),z(null),R(null),T(null),O("list"),o({title:"Séance sauvegardée",description:"Bravo pour l'effort !"}))}});Ge({mutationFn:n=>Re.startStrengthRun(n),onError:()=>{o({title:"Erreur",description:"Impossible de mettre à jour la séance.",variant:"destructive"})}});const Ue=(n,d)=>{const P=n.items??[],re=Be(d??n.cycle??P.find(Ce=>Ce.cycle_type)?.cycle_type),oe=tt(P,re,je);C(n),R({...n,title:n.title,description:n.description,cycle:re,items:oe}),z(null),T(null),S(0),O("reader")},ce=(xe?.filter(n=>n.session_type==="strength")||[]).filter(n=>n.status!=="completed"),ge=B?ce.find(n=>n.id===B.assignment_id):null,Ye=!!ge?.items?.length&&!ne,Se=ce.map(n=>({...n,session:{id:n.session_id,title:n.title,description:n.description,cycle:Be(n.cycle),items:n.items??[]}})),Ne=[{value:"endurance",label:"Endurance"},{value:"hypertrophie",label:"Hypertrophie"},{value:"force",label:"Force"}],je=g.useMemo(()=>we?new Map(we.map(n=>[n.id,n])):new Map,[we]),_e=Se.map(n=>{const d=tt(n.items??[],w,je);return{key:`assignment-${n.id}`,title:n.title,description:n.description,type:"assignment",assignedDate:n.assigned_date,session:{id:n.session_id,title:n.title,description:n.description,cycle:Be(n.cycle),items:d},assignment:n,exerciseCount:d.length}}),We=(Ie??[]).map(n=>{const d=tt(n.items??[],w,je);return{key:`catalog-${n.id}`,title:n.title,description:n.description,type:"catalog",session:{...n,items:d,cycle:w},exerciseCount:d.length}}),Fe=le.trim().toLowerCase(),G=[..._e,...We].filter(n=>Fe?`${n.title} ${n.description}`.toLowerCase().includes(Fe):!0),J=g.useMemo(()=>u?tt(u.items??[],w,je):[],[u,w,je]),be=n=>{if((n.items??[]).length===0){o({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}Ue(n,w),z(null),T(null)},Ke=n=>{const d=n.items??[],re=d.filter(Ce=>Ce.cycle_type===w).length>0?w:Be(n.cycle??d.find(Ce=>Ce.cycle_type)?.cycle_type),oe=tt(d,re,je);if(oe.length===0){o({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}R({...n,cycle:re,items:oe}),C(null),z(null),T(null),S(0),O("reader")},Le=()=>{if(u){if(J.length===0){o({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}R({...u,cycle:w,items:J}),S(0),O("focus")}},He=()=>{Nr({setActiveSession:R,setActiveAssignment:C,setActiveRunId:z,setActiveRunLogs:T,setActiveRunnerStep:S,setScreenMode:O})},Ee=Ge({mutationFn:n=>Re.deleteStrengthRun(n),onSuccess:n=>{He(),K&&p.setQueryData(["strength_run_in_progress",K],vt(null)),p.invalidateQueries({queryKey:["strength_run_in_progress",K]}),p.invalidateQueries({queryKey:["strength_history"]}),p.invalidateQueries({queryKey:["assignments",t,"strength"]});const d=n?.source==="local"?"Suppression locale : le serveur n'est pas disponible.":void 0;o({title:"Séance supprimée",description:d})},onError:()=>{o({title:"Erreur",description:"Impossible de supprimer la séance en cours.",variant:"destructive"})}});return e.jsx("div",{className:ye("space-y-4 md:space-y-6",Ae&&"dark bg-background text-foreground contrast-125",H&&"text-lg leading-relaxed [&_.text-xs]:text-sm [&_.text-sm]:text-base"),children:$==="focus"&&u?we?e.jsx("div",{className:"animate-in fade-in motion-reduce:animate-none",children:e.jsx(vr,{session:u,exercises:we,oneRMs:ke||[],initialLogs:I,initialStep:W,isFinishing:f.isPending,onStepChange:n=>S(n),onExitFocus:()=>O("reader"),onStart:async()=>{if(j)return;const n=v?.session_id??u?.id??null;if(!n){o({title:"Session manquante",description:"Impossible de démarrer sans session associée.",variant:"destructive"});return}const d={assignment_id:v?.id??null,athlete_id:r??null,athleteName:t??void 0,progress_pct:0,session_id:n,cycle_type:u?.cycle};try{const P=await $e.mutateAsync(d);P?.run_id&&z(P.run_id)}catch{return}},onLogSets:async n=>{j&&(T(d=>[...d??[],...n]),await Promise.all(n.map((d,P)=>Te.mutateAsync({run_id:j,exercise_id:d.exercise_id,set_index:d.set_number??P+1,reps:d.reps??null,weight:d.weight??null,athlete_id:r??null,athlete_name:t??null}))))},onProgress:async n=>{j&&await f.mutateAsync({run_id:j,progress_pct:n,status:"in_progress"})},onFinish:n=>{j&&f.mutate({assignment_id:v?.id??void 0,run_id:j,session_id:v?.session_id??u?.id??void 0,athlete_id:r??void 0,date:new Date().toISOString(),progress_pct:100,status:"completed",...n})}})}):e.jsxs("div",{className:"space-y-4 py-10",children:[e.jsx("div",{className:"mx-auto h-8 w-48 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"mx-auto h-4 w-32 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"space-y-3 pt-4",children:[1,2,3].map(n=>e.jsx("div",{className:"h-20 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},n))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Musculation"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(L,{variant:"ghost",size:"sm","aria-label":"Informations sur le calcul du 1RM",onClick:()=>o({title:"Info",description:"Le 1RM est calculé automatiquement."}),className:"text-muted-foreground",children:[e.jsx(qe,{className:"mr-2 h-4 w-4"})," Info 1RM"]}),e.jsx(L,{variant:"ghost",size:"icon",onClick:()=>O("settings"),className:"rounded-full border border-muted/50 text-muted-foreground","aria-label":"Paramètres",children:e.jsx(zn,{className:"h-4 w-4"})})]})]}),e.jsxs(Rn,{defaultValue:"start",className:"w-full",children:[e.jsxs(En,{className:"grid w-full grid-cols-2",children:[e.jsx(Rt,{value:"start",children:"S'entraîner"}),e.jsx(Rt,{value:"history",children:"Historique"})]}),e.jsxs(Et,{value:"start",className:"space-y-5 pt-4",children:[$==="list"&&e.jsxs("div",{className:"space-y-5 animate-in fade-in motion-reduce:animate-none",children:[e.jsxs("p",{className:"text-center text-sm text-muted-foreground py-1",children:[G.length," séance",G.length>1?"s":""," disponible",G.length>1?"s":""]}),e.jsx("div",{className:"flex justify-center gap-2",children:Ne.map(n=>e.jsx("button",{type:"button",onClick:()=>E(Be(n.value)),className:ye("px-5 py-2.5 rounded-full text-sm font-semibold transition-all active:scale-95",w===n.value?"bg-primary text-primary-foreground shadow-md":"bg-muted/50 text-muted-foreground hover:bg-muted"),children:n.label},n.value))}),e.jsxs("div",{className:"relative",children:[e.jsx(Mn,{className:"absolute left-4 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground pointer-events-none"}),e.jsx(ft,{placeholder:"Rechercher une séance...",className:"h-12 rounded-2xl bg-muted/30 pl-11 pr-4 border-0 shadow-sm focus-visible:ring-2",value:le,onChange:n=>y(n.target.value),"aria-label":"Rechercher une séance"})]}),B&&e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border-2 border-primary/30 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-primary/10 rounded-full blur-2xl -mr-8 -mt-8"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-primary"})]}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-primary",children:ne?"Complétée":"En cours"})]}),e.jsx("h3",{className:"text-xl font-bold tracking-tight mb-1",children:ge?.title??"Séance en cours"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Démarrée le ",lt(new Date(B.started_at||new Date),"dd MMMM",{locale:ot})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs font-semibold mb-1.5",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progression"}),e.jsxs("span",{className:"text-primary",children:[Math.round(B.progress_pct??0),"%"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-primary transition-all duration-500",style:{width:`${B.progress_pct??0}%`}})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{className:"flex-1 h-12 rounded-xl font-semibold",disabled:!Ye,onClick:()=>{if(!ge)return;const n=ge.items??[],d=Be(ge.cycle??n.find(oe=>oe.cycle_type)?.cycle_type),P=n.filter(oe=>oe.cycle_type===d),re=cn(P.length?P:n);C(ge),R({...ge,title:ge.title,description:ge.description,cycle:d,items:re}),z(B.id),T(B.logs??[]),S(ln(re,B.logs??[],B.progress_pct)),O("focus")},children:ne?"Voir le résumé":"Reprendre"}),!ne&&e.jsx(L,{variant:"outline",className:"h-12 w-12 rounded-xl p-0",disabled:Ee.isPending,onClick:()=>{!B||!window.confirm("Supprimer la séance en cours ?")||Ee.mutate(B.id)},"aria-label":"Supprimer la séance",children:e.jsx(ut,{className:"h-5 w-5"})})]})]})]}),!B&&G.length>0&&e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(qe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Choisir une séance"})]}),G.length>0?e.jsx("div",{className:"space-y-3",children:G.map(n=>e.jsx("button",{type:"button",className:"group w-full rounded-2xl border bg-card p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:shadow-md hover:border-primary/30",onClick:()=>{if(n.type==="assignment"){be(n.assignment);return}Ke(n.session)},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:ye("flex h-12 w-12 shrink-0 items-center justify-center rounded-xl",n.type==="assignment"?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"),children:e.jsx(qe,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[n.type==="assignment"&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-primary/10 px-2 py-0.5 text-[10px] font-bold uppercase text-primary",children:"Assignée"}),n.type==="assignment"&&n.assignedDate&&e.jsx("span",{className:"text-xs text-muted-foreground",children:lt(new Date(n.assignedDate),"dd MMM",{locale:ot})})]}),e.jsx("h3",{className:"font-semibold tracking-tight truncate",children:n.title}),e.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:[n.exerciseCount," exercice",n.exerciseCount>1?"s":"",n.description?` · ${n.description}`:""]})]}),e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors group-hover:bg-primary group-hover:text-primary-foreground",children:e.jsx(Tt,{className:"h-4 w-4 ml-0.5"})})]})},n.key))}):e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-muted",children:e.jsx(qe,{className:"h-7 w-7 text-muted-foreground"})}),e.jsx("h3",{className:"font-semibold",children:"Aucune séance"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Essayez un autre mot-clé ou changez de cycle."})]})]}),$==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(L,{variant:"ghost",size:"sm",onClick:()=>O("list"),className:"gap-2",children:[e.jsx(Mt,{className:"h-4 w-4"}),"Retour"]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Préférences"}),e.jsx("h2",{className:"text-2xl font-display font-bold uppercase text-primary",children:"Paramètres"})]})]}),e.jsxs(Ve,{className:"border border-muted/60 shadow-sm",children:[e.jsxs(yt,{children:[e.jsx(bt,{className:"text-lg uppercase",children:"Lisibilité & contrastes"}),e.jsx(Ft,{children:"Ajuste l'écran pour rester lisible en bassin comme en extérieur."})]}),e.jsxs(wt,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Mode piscine"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Contraste renforcé et lisibilité optimisée."})]}),e.jsx(Nt,{checked:Ae,onCheckedChange:n=>me(d=>({...d,poolMode:n}))})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Texte grand"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Police plus large pour lire pendant l'effort."})]}),e.jsx(Nt,{checked:H,onCheckedChange:n=>me(d=>({...d,largeText:n}))})]})]})]}),e.jsx(Ve,{className:"border border-muted/60 shadow-sm",children:e.jsxs(wt,{className:"space-y-3 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsx(Tn,{className:"h-4 w-4"}),e.jsx("span",{children:"Les préférences sont enregistrées sur cet appareil."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs font-semibold uppercase text-muted-foreground",children:[Ae&&e.jsx(nt,{variant:"secondary",children:"Mode piscine activé"}),H&&e.jsx(nt,{variant:"secondary",children:"Texte grand activé"}),!Ae&&!H&&e.jsx(nt,{variant:"outline",children:"Réglages par défaut"})]})]})})]}),$==="reader"&&u&&e.jsxs("div",{className:"space-y-5 animate-in fade-in motion-reduce:animate-none pb-40",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>O("list"),className:"flex h-10 w-10 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors hover:bg-muted active:scale-95","aria-label":"Retour",children:e.jsx(Mt,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground truncate",children:Ne.find(n=>n.value===w)?.label}),e.jsx("h1",{className:"text-xl font-bold tracking-tight truncate",children:u.title})]})]}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border border-primary/20 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-primary/10 rounded-full blur-3xl -mr-12 -mt-12"}),e.jsxs("div",{className:"relative space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[v&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-primary/20 px-3 py-1 text-xs font-bold uppercase text-primary",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-primary"}),"Assignée"]}),!v&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:"Catalogue"}),v?.assigned_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Prévue le ",lt(new Date(v.assigned_date),"dd MMM",{locale:ot})]})]}),u.description&&e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:u.description}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(qe,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:J.length}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Exercices"})]})]}),e.jsx("div",{className:"h-8 w-px bg-border"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(An,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:Ne.find(n=>n.value===w)?.label}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Cycle"})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-1",children:[e.jsxs("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:[J.length," exercice",J.length>1?"s":""]}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsxs("div",{className:"space-y-2",children:[J.map((n,d)=>{const P=je.get(n.exercise_id),re=Number(n.percent_1rm),oe=Number.isFinite(re)&&re>0,Ce=oe?ke?.find(F=>F.exercise_id===n.exercise_id)?.weight??0:0,x=oe?Math.round(Ce*(re/100)):0,M=oe?x>0?`${x} kg (${re}% 1RM)`:`${re}% 1RM`:null,D=n.notes?.trim(),k=Pt(n.sets),a=Pt(n.reps),m=br(n.rest_seconds);return e.jsxs(Lt,{children:[e.jsx(Nn,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-3 rounded-xl border bg-card px-3 py-3 text-left transition-all active:scale-[0.98] hover:border-primary/50 hover:shadow-sm",children:[e.jsx("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-primary text-xs font-bold text-primary-foreground",children:d+1}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"font-semibold text-sm truncate",children:P?.nom_exercice??n.exercise_name??"Exercice"})}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 text-xs font-medium text-muted-foreground",children:[e.jsxs("span",{className:"font-mono",children:[k,"×",a]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("span",{className:"font-mono",children:m}),e.jsx(jt,{className:"h-4 w-4 text-muted-foreground/50"})]})]})}),e.jsxs(Ht,{side:"bottom",className:"max-h-[90vh] overflow-y-auto rounded-t-3xl pb-8",children:[e.jsx(zt,{className:"text-left pb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-primary text-sm font-bold text-primary-foreground",children:d+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(Bt,{className:"text-xl leading-tight",children:P?.nom_exercice??n.exercise_name??"Exercice"}),P?.exercise_type&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:P.exercise_type})]})]})}),e.jsxs("div",{className:"space-y-4",children:[P?.illustration_gif&&e.jsx("div",{className:"rounded-xl overflow-hidden bg-muted/20 border aspect-video flex items-center justify-center",children:e.jsx("img",{src:P.illustration_gif,alt:P.nom_exercice??"Exercice",className:"w-full h-full max-h-36 object-contain",loading:"lazy",decoding:"async"})}),P?.description&&e.jsx("div",{className:"text-sm text-muted-foreground leading-relaxed",children:P.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:k}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Séries"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:a}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Reps"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:M??"—"}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Charge"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:m}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Repos"})]})]}),D&&e.jsxs("div",{className:"rounded-xl bg-primary/5 border border-primary/20 p-4",children:[e.jsx("div",{className:"text-[10px] uppercase text-primary font-semibold mb-1",children:"Notes coach"}),e.jsx("div",{className:"text-sm text-foreground",children:D})]})]})]})]},`${n.exercise_id}-${d}`)}),J.length===0&&e.jsx("div",{className:"p-6 border-2 border-dashed rounded-xl text-center text-muted-foreground",children:"Aucun exercice disponible pour cette séance."})]}),e.jsx(on,{children:e.jsxs(L,{className:"flex-1 h-14 rounded-xl font-bold text-base bg-primary hover:bg-primary/90 shadow-lg",onClick:Le,children:[e.jsx(Tt,{className:"h-5 w-5 mr-2"}),"Lancer la séance"]})})]})]}),e.jsxs(Et,{value:"history",className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Qe,{htmlFor:"strength-history-status",children:"Statut"}),e.jsxs(jn,{value:q,onValueChange:V,children:[e.jsx(Sn,{id:"strength-history-status",children:e.jsx(_n,{placeholder:"Tous"})}),e.jsxs(Cn,{children:[e.jsx(it,{value:"all",children:"Tous"}),e.jsx(it,{value:"in_progress",children:"En cours"}),e.jsx(it,{value:"completed",children:"Terminé"}),e.jsx(it,{value:"abandoned",children:"Abandonné"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Qe,{htmlFor:"strength-history-from",children:"Du"}),e.jsx(ft,{id:"strength-history-from",type:"date",value:ee,onChange:n=>N(n.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Qe,{htmlFor:"strength-history-to",children:"Au"}),e.jsx(ft,{id:"strength-history-to",type:"date",value:X,onChange:n=>te(n.target.value)})]})]}),ie.map(n=>e.jsx(Ve,{className:"group hover:border-primary/50 transition-colors",children:e.jsxs(yt,{className:"pb-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(bt,{className:"text-base font-bold uppercase",children:lt(new Date(n.started_at||n.date||n.created_at||new Date),"dd MMM yyyy",{locale:ot})}),e.jsxs("div",{className:"text-sm font-mono font-bold text-muted-foreground group-hover:text-primary",children:[n.duration??0," min"]})]}),e.jsxs("div",{className:"flex gap-2 text-xs font-bold text-muted-foreground",children:[e.jsxs("span",{children:["Difficulté ",n.feeling??n.rpe??0,"/5"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[n.logs?.length||0," Séries"]})]})]})},n.id)),ie.length===0&&e.jsx("div",{className:"text-center text-muted-foreground py-10",children:"Aucun historique."}),fe.hasNextPage&&e.jsx(L,{variant:"outline",size:"sm",className:"w-full",onClick:()=>fe.fetchNextPage(),disabled:fe.isFetchingNextPage,children:fe.isFetchingNextPage?"Chargement...":"Charger plus"})]})]})]})})}export{vt as buildInProgressRunCache,jr as createInProgressRun,Ur as default,cn as orderStrengthItems,Nr as resetStrengthRunState};
