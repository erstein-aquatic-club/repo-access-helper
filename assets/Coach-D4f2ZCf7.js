const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StrengthCatalog-CN6YiDEa.js","assets/vendor-query-BiSH4r2z.js","assets/vendor-react-BzrpNAyj.js","assets/api-BYPGA3pp.js","assets/index-4NxNgYqB.js","assets/vendor-supabase-6k692oZB.js","assets/index-DZKGqAkW.css","assets/index-Dg5Ladxd.js","assets/index-BknIKlvV.js","assets/index-qvJS2CDq.js","assets/select-BGzZx6nq.js","assets/index-B4XJ3uYX.js","assets/chevron-down-DPxJtwCl.js","assets/check-cSRTxcf-.js","assets/CalendarGrid-BHrvBizy.js","assets/chevron-left-CAZIvbZC.js","assets/chevron-right-BOyUCCgN.js","assets/textarea-BSQCek8q.js","assets/dialog-WFYO7Ctd.js","assets/index-CHqvNSpb.js","assets/checkbox-ChYhNu65.js","assets/alert-dialog-Qid_k4Ss.js","assets/tabs-BCKNB47q.js","assets/SessionListView-DAJYs_Ci.js","assets/play-D68ADxXK.js","assets/circle-alert-CaF6prtI.js","assets/pencil-CKjYUEuO.js","assets/drawer-DE8GbfCX.js","assets/search-CXfImzf2.js","assets/plus-BuQH_PXV.js","assets/loader-circle-e06Q0mVP.js","assets/pen-C18lpEMm.js","assets/badge-BiCs3y38.js","assets/toggle-group-SIl_-tGy.js","assets/sheet-BIAo4ixe.js","assets/separator-DDYKc2r2.js","assets/collapsible-Z8LqqSMu.js","assets/user-plus-BuxuKMnA.js","assets/SwimCatalog-CpZ1XKXN.js","assets/SwimSessionTimeline-1MpEX9xb.js","assets/eye-Dd9v4kcB.js","assets/clock-pTPTL46C.js","assets/format-B9mPVj_w.js","assets/timer-D1WwsrIj.js"])))=>i.map(i=>d[i]);
import{c as te,B as A,l as ws,m as Ss,n as Ye,R as _s,o as ks,p as Je,P as Ze,A as Xe,q as es,r as Ms,t as As,v as Ps,w as Ds,a as Rs,d as ne,C as ue,h as me,j as pe,x as he,g as xe,L as B,I as ge,W as ss,D as ts,y as Os,U as ye,z as Ts,E as Fs,u as Ke,b as Es,G as Be,H as zs,k as Is,_ as ns}from"./index-4NxNgYqB.js";import{j as e,r as o,R as $s,d as H,u as U,c as Ne}from"./vendor-query-BiSH4r2z.js";import{a as P}from"./api-BYPGA3pp.js";import{B as ae}from"./badge-BiCs3y38.js";import{T as rs,a as ce}from"./toggle-group-SIl_-tGy.js";import{C as je}from"./checkbox-ChYhNu65.js";import{h as qs,R as Ls,u as Gs,F as Vs}from"./index-B4XJ3uYX.js";import{u as Ks}from"./index-qvJS2CDq.js";import{S as W,a as Y,b as J,c as Z,d as $}from"./select-BGzZx6nq.js";import{C as as}from"./chevron-down-DPxJtwCl.js";import{a as Bs,b as Hs,T as os,P as Qs}from"./CalendarGrid-BHrvBizy.js";import{S as Fe,a as Ee,b as ze,c as Ie,d as $e}from"./sheet-BIAo4ixe.js";import{S as Us}from"./separator-DDYKc2r2.js";import{A as _e,a as ke,b as Me,c as Ae,d as Pe,e as De,f as Re,g as Oe}from"./alert-dialog-Qid_k4Ss.js";import{C as Ws,a as Ys,b as Js}from"./collapsible-Z8LqqSMu.js";import{P as Te}from"./plus-BuQH_PXV.js";import{U as Zs,a as Xs}from"./user-plus-BuxuKMnA.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ve=te("arrow-left",et);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],be=te("bell",st);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],nt=te("calendar-days",tt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],at=te("external-link",rt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],it=te("heart-pulse",ot);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],qe=te("mail",lt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=[["path",{d:"M18 21a8 8 0 0 0-16 0",key:"3ypg7q"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M22 20c0-3.37-2-6.5-4-8a5 5 0 0 0-.45-8.3",key:"10s06x"}]],is=te("users-round",ct),se=({title:s,description:a,onBack:c,actions:n})=>e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(A,{variant:"ghost",size:"sm",className:"-ml-2",onClick:c,children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Retour à l'accueil"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:s}),a?e.jsx("p",{className:"text-sm text-muted-foreground",children:a}):null]}),n?e.jsx("div",{className:"flex items-center gap-2",children:n}):null]});function de(s,a,{checkForDefaultPrevented:c=!0}={}){return function(r){if(s?.(r),c===!1||!r.defaultPrevented)return a?.(r)}}function dt(s){const a=ut(s),c=o.forwardRef((n,r)=>{const{children:d,...u}=n,l=o.Children.toArray(d),p=l.find(pt);if(p){const h=p.props.children,x=l.map(m=>m===p?o.Children.count(h)>1?o.Children.only(null):o.isValidElement(h)?h.props.children:null:m);return e.jsx(a,{...u,ref:r,children:o.isValidElement(h)?o.cloneElement(h,void 0,x):null})}return e.jsx(a,{...u,ref:r,children:d})});return c.displayName=`${s}.Slot`,c}function ut(s){const a=o.forwardRef((c,n)=>{const{children:r,...d}=c;if(o.isValidElement(r)){const u=xt(r),l=ht(d,r.props);return r.type!==o.Fragment&&(l.ref=n?ws(n,u):u),o.cloneElement(r,l)}return o.Children.count(r)>1?o.Children.only(null):null});return a.displayName=`${s}.SlotClone`,a}var mt=Symbol("radix.slottable");function pt(s){return o.isValidElement(s)&&typeof s.type=="function"&&"__radixId"in s.type&&s.type.__radixId===mt}function ht(s,a){const c={...a};for(const n in a){const r=s[n],d=a[n];/^on[A-Z]/.test(n)?r&&d?c[n]=(...l)=>{const p=d(...l);return r(...l),p}:r&&(c[n]=r):n==="style"?c[n]={...r,...d}:n==="className"&&(c[n]=[r,d].filter(Boolean).join(" "))}return{...s,...c}}function xt(s){let a=Object.getOwnPropertyDescriptor(s.props,"ref")?.get,c=a&&"isReactWarning"in a&&a.isReactWarning;return c?s.ref:(a=Object.getOwnPropertyDescriptor(s,"ref")?.get,c=a&&"isReactWarning"in a&&a.isReactWarning,c?s.props.ref:s.props.ref||s.ref)}var gt=$s[" useInsertionEffect ".trim().toString()]||Ss;function ft({prop:s,defaultProp:a,onChange:c=()=>{},caller:n}){const[r,d,u]=jt({defaultProp:a,onChange:c}),l=s!==void 0,p=l?s:r;{const x=o.useRef(s!==void 0);o.useEffect(()=>{const m=x.current;m!==l&&console.warn(`${n} is changing from ${m?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),x.current=l},[l,n])}const h=o.useCallback(x=>{if(l){const m=vt(x)?x(s):x;m!==s&&u.current?.(m)}else d(x)},[l,s,d,u]);return[p,h]}function jt({defaultProp:s,onChange:a}){const[c,n]=o.useState(s),r=o.useRef(c),d=o.useRef(a);return gt(()=>{d.current=a},[a]),o.useEffect(()=>{r.current!==c&&(d.current?.(c),r.current=c)},[c,r]),[c,n,d]}function vt(s){return typeof s=="function"}var Ce="Popover",[ls]=ks(Ce,[Ye]),fe=Ye(),[yt,ee]=ls(Ce),cs=s=>{const{__scopePopover:a,children:c,open:n,defaultOpen:r,onOpenChange:d,modal:u=!1}=s,l=fe(a),p=o.useRef(null),[h,x]=o.useState(!1),[m,g]=ft({prop:n,defaultProp:r??!1,onChange:d,caller:Ce});return e.jsx(_s,{...l,children:e.jsx(yt,{scope:a,contentId:Ks(),triggerRef:p,open:m,onOpenChange:g,onOpenToggle:o.useCallback(()=>g(f=>!f),[g]),hasCustomAnchor:h,onCustomAnchorAdd:o.useCallback(()=>x(!0),[]),onCustomAnchorRemove:o.useCallback(()=>x(!1),[]),modal:u,children:c})})};cs.displayName=Ce;var ds="PopoverAnchor",bt=o.forwardRef((s,a)=>{const{__scopePopover:c,...n}=s,r=ee(ds,c),d=fe(c),{onCustomAnchorAdd:u,onCustomAnchorRemove:l}=r;return o.useEffect(()=>(u(),()=>l()),[u,l]),e.jsx(Xe,{...d,...n,ref:a})});bt.displayName=ds;var us="PopoverTrigger",ms=o.forwardRef((s,a)=>{const{__scopePopover:c,...n}=s,r=ee(us,c),d=fe(c),u=Je(a,r.triggerRef),l=e.jsx(Ze.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":fs(r.open),...n,ref:u,onClick:de(s.onClick,r.onOpenToggle)});return r.hasCustomAnchor?l:e.jsx(Xe,{asChild:!0,...d,children:l})});ms.displayName=us;var Le="PopoverPortal",[Nt,Ct]=ls(Le,{forceMount:void 0}),ps=s=>{const{__scopePopover:a,forceMount:c,children:n,container:r}=s,d=ee(Le,a);return e.jsx(Nt,{scope:a,forceMount:c,children:e.jsx(es,{present:c||d.open,children:e.jsx(Ms,{asChild:!0,container:r,children:n})})})};ps.displayName=Le;var oe="PopoverContent",hs=o.forwardRef((s,a)=>{const c=Ct(oe,s.__scopePopover),{forceMount:n=c.forceMount,...r}=s,d=ee(oe,s.__scopePopover);return e.jsx(es,{present:n||d.open,children:d.modal?e.jsx(St,{...r,ref:a}):e.jsx(_t,{...r,ref:a})})});hs.displayName=oe;var wt=dt("PopoverContent.RemoveScroll"),St=o.forwardRef((s,a)=>{const c=ee(oe,s.__scopePopover),n=o.useRef(null),r=Je(a,n),d=o.useRef(!1);return o.useEffect(()=>{const u=n.current;if(u)return qs(u)},[]),e.jsx(Ls,{as:wt,allowPinchZoom:!0,children:e.jsx(xs,{...s,ref:r,trapFocus:c.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:de(s.onCloseAutoFocus,u=>{u.preventDefault(),d.current||c.triggerRef.current?.focus()}),onPointerDownOutside:de(s.onPointerDownOutside,u=>{const l=u.detail.originalEvent,p=l.button===0&&l.ctrlKey===!0,h=l.button===2||p;d.current=h},{checkForDefaultPrevented:!1}),onFocusOutside:de(s.onFocusOutside,u=>u.preventDefault(),{checkForDefaultPrevented:!1})})})}),_t=o.forwardRef((s,a)=>{const c=ee(oe,s.__scopePopover),n=o.useRef(!1),r=o.useRef(!1);return e.jsx(xs,{...s,ref:a,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:d=>{s.onCloseAutoFocus?.(d),d.defaultPrevented||(n.current||c.triggerRef.current?.focus(),d.preventDefault()),n.current=!1,r.current=!1},onInteractOutside:d=>{s.onInteractOutside?.(d),d.defaultPrevented||(n.current=!0,d.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const u=d.target;c.triggerRef.current?.contains(u)&&d.preventDefault(),d.detail.originalEvent.type==="focusin"&&r.current&&d.preventDefault()}})}),xs=o.forwardRef((s,a)=>{const{__scopePopover:c,trapFocus:n,onOpenAutoFocus:r,onCloseAutoFocus:d,disableOutsidePointerEvents:u,onEscapeKeyDown:l,onPointerDownOutside:p,onFocusOutside:h,onInteractOutside:x,...m}=s,g=ee(oe,c),f=fe(c);return Gs(),e.jsx(Vs,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:r,onUnmountAutoFocus:d,children:e.jsx(As,{asChild:!0,disableOutsidePointerEvents:u,onInteractOutside:x,onEscapeKeyDown:l,onPointerDownOutside:p,onFocusOutside:h,onDismiss:()=>g.onOpenChange(!1),children:e.jsx(Ps,{"data-state":fs(g.open),role:"dialog",id:g.contentId,...f,...m,ref:a,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),gs="PopoverClose",kt=o.forwardRef((s,a)=>{const{__scopePopover:c,...n}=s,r=ee(gs,c);return e.jsx(Ze.button,{type:"button",...n,ref:a,onClick:de(s.onClick,()=>r.onOpenChange(!1))})});kt.displayName=gs;var Mt="PopoverArrow",At=o.forwardRef((s,a)=>{const{__scopePopover:c,...n}=s,r=fe(c);return e.jsx(Ds,{...r,...n,ref:a})});At.displayName=Mt;function fs(s){return s?"open":"closed"}var Pt=cs,Dt=ms,Rt=ps,js=hs;const Ot=Pt,Tt=Dt,vs=o.forwardRef(({className:s,align:a="center",sideOffset:c=4,...n},r)=>e.jsx(Rt,{children:e.jsx(js,{ref:r,align:a,sideOffset:c,className:Rs("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",s),...n})}));vs.displayName=js.displayName;const Ft=({onBack:s,swimSessions:a,strengthSessions:c,athletes:n,groups:r})=>{const{toast:d}=ne(),[u,l]=o.useState({session_type:"swim",session_id:"",assigned_date:new Date().toISOString().split("T")[0],assigned_slot:"morning"}),[p,h]=o.useState(!1),[x,m]=o.useState("user"),[g,f]=o.useState(""),[i,j]=o.useState([]),D=t=>{const S=typeof t=="number"?t:Number(t);return Number.isFinite(S)&&S>0?S:null},v=o.useMemo(()=>n.map(t=>({value:t.id?`id:${t.id}`:`name:${t.display_name}`,label:t.group_label?`${t.display_name} · ${t.group_label}`:t.display_name,id:t.id,name:t.display_name})),[n]),_=o.useMemo(()=>new Map(v.map(t=>[t.value,t])),[v]),E=o.useMemo(()=>r.map(t=>{const S=D(t.id);return S?{...t,gid:S}:null}).filter(t=>!!t),[r]),z=o.useMemo(()=>E.filter(t=>i.includes(t.gid)),[E,i]),K=o.useMemo(()=>{if(z.length===0)return"Choisir des groupes";const t=z.slice(0,2).map(T=>T.name).join(", "),S=z.length>2?` +${z.length-2}`:"";return`${t}${S}`},[z]),L=H({mutationFn:async t=>P.assignments_create(t),onSuccess:()=>{d({title:"Séance assignée & notifiée"})},onError:t=>{const S="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",T=t instanceof Error?t.message:typeof t=="string"?t:S;let M=T;const y=T.match(/HTTP \d+:\s*(\{.*\})/);if(y)try{M=JSON.parse(y[1])?.error||S}catch{M=S}d({title:"Erreur d'assignation",description:M})}}),Q=async()=>{const t=Number(u.session_id);if(!Number.isInteger(t)||t<=0){d({title:"Séance invalide",description:"Sélectionnez une séance valide."});return}if(x==="group"){if(i.length===0){d({title:"Groupe manquant",description:"Sélectionnez au moins un groupe."});return}h(!0);try{const C={assignment_type:u.session_type,session_id:t,scheduled_date:u.assigned_date,scheduled_slot:u.assigned_slot},k=Array.from(new Set(i));await Promise.all(k.map(N=>P.assignments_create({...C,target_group_id:N}))),d({title:"Séance assignée & notifiée"})}catch(C){const k="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",N=C instanceof Error?C.message:typeof C=="string"?C:k;let R=N;const F=N.match(/HTTP \d+:\s*(\{.*\})/);if(F)try{R=JSON.parse(F[1])?.error||k}catch{R=k}d({title:"Erreur d'assignation",description:R})}finally{h(!1)}return}const S=g.trim();if(!S){d({title:"Nageur manquant",description:"Sélectionnez un nageur."});return}const T=_.get(S),M=T?.id??(Number.isFinite(Number(S))&&Number(S)>0?Number(S):void 0);if(!Number.isFinite(M)||Number(M)<=0){d({title:"Nageur invalide",description:"Sélectionnez un nageur avec un identifiant valide."});return}const y=T?.name??S.replace(/^name:/,"");L.mutate({assignment_type:u.session_type,session_id:t,target_athlete:y,target_user_id:M,scheduled_date:u.assigned_date,scheduled_slot:u.assigned_slot})},w=!u.session_id||(x==="group"?i.length===0:!g.trim())||L.isPending||p;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(se,{title:"Assigner une séance",description:"Planifiez une séance pour un nageur ou un ou plusieurs groupes.",onBack:s}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(ue,{className:"border-l-4 border-l-primary",children:[e.jsxs(me,{children:[e.jsx(pe,{children:"Séance"}),e.jsx(he,{children:"Choisissez le type et la séance à envoyer."})]}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Type"}),e.jsxs(W,{value:u.session_type,onValueChange:t=>l({...u,session_type:t,session_id:""}),children:[e.jsx(Y,{children:e.jsx(J,{})}),e.jsxs(Z,{children:[e.jsx($,{value:"swim",children:"Natation"}),e.jsx($,{value:"strength",children:"Musculation"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Séance"}),e.jsxs(W,{value:u.session_id,onValueChange:t=>l({...u,session_id:t}),children:[e.jsx(Y,{children:e.jsx(J,{placeholder:"Choisir..."})}),e.jsx(Z,{children:u.session_type==="swim"?a?.map(t=>e.jsx($,{value:t.id.toString(),children:t.name},t.id)):c?.map(t=>e.jsx($,{value:t.id.toString(),children:t.title},t.id))})]})]})]})]}),e.jsxs(ue,{children:[e.jsxs(me,{children:[e.jsx(pe,{children:"Cible & planification"}),e.jsx(he,{children:"Définissez le destinataire, la date et le créneau."})]}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Cible"}),e.jsxs(W,{value:x,onValueChange:t=>{m(t),f(""),j([])},children:[e.jsx(Y,{children:e.jsx(J,{})}),e.jsxs(Z,{children:[e.jsx($,{value:"user",children:"Nageur"}),e.jsx($,{value:"group",children:"Groupe(s)"})]})]})]}),x==="user"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Nageur"}),v.length>0?e.jsxs(W,{value:g,onValueChange:f,children:[e.jsx(Y,{children:e.jsx(J,{placeholder:"Choisir un nageur"})}),e.jsx(Z,{children:v.map(t=>e.jsx($,{value:t.value,children:t.label},t.value))})]}):e.jsx(ge,{value:g,onChange:t=>f(t.target.value),placeholder:"ex: Camille"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Groupes"}),r.length>0?e.jsxs(Ot,{children:[e.jsx(Tt,{asChild:!0,children:e.jsxs(A,{type:"button",variant:"outline",className:"w-full justify-between","aria-label":"Sélection des groupes",children:[e.jsx("span",{className:"truncate",children:K}),e.jsx(as,{className:"ml-2 h-4 w-4 opacity-50"})]})}),e.jsxs(vs,{className:"w-[--radix-popover-trigger-width] p-2",align:"start",children:[e.jsx("div",{className:"max-h-64 overflow-auto",children:e.jsxs("div",{className:"space-y-1",children:[E.filter(t=>t.is_temporary&&!t.parent_group_id).map(t=>{const S=i.includes(t.gid),T=E.filter(M=>M.parent_group_id===t.gid);return e.jsxs("div",{children:[e.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 hover:bg-muted",children:[e.jsx(je,{checked:S,onCheckedChange:M=>{const y=M===!0;j(C=>y?C.includes(t.gid)?C:[...C,t.gid]:C.filter(k=>k!==t.gid))}}),e.jsx("span",{className:"text-sm font-medium",children:t.name}),e.jsx(ae,{variant:"secondary",className:"text-[9px] ml-auto px-1.5 py-0",children:"Stage"})]}),T.map(M=>{const y=i.includes(M.gid);return e.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded-md pl-7 pr-2 py-1.5 hover:bg-muted",children:[e.jsx(je,{checked:y,onCheckedChange:C=>{const k=C===!0;j(N=>k?N.includes(M.gid)?N:[...N,M.gid]:N.filter(R=>R!==M.gid))}}),e.jsx("span",{className:"text-sm text-muted-foreground",children:M.name})]},M.gid)})]},t.gid)}),E.some(t=>t.is_temporary)&&E.some(t=>!t.is_temporary)?e.jsx("div",{className:"border-t my-1"}):null,E.filter(t=>!t.is_temporary).map(t=>{const S=i.includes(t.gid);return e.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 hover:bg-muted",children:[e.jsx(je,{checked:S,onCheckedChange:T=>{const M=T===!0;j(y=>M?y.includes(t.gid)?y:[...y,t.gid]:y.filter(C=>C!==t.gid))}}),e.jsx("span",{className:"text-sm",children:t.name})]},t.gid)})]})}),i.length>0?e.jsx(A,{type:"button",variant:"ghost",size:"sm",className:"mt-2 w-full",onClick:()=>j([]),children:"Tout désélectionner"}):null]})]}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"Aucun groupe disponible."}),i.length>0?e.jsxs("div",{className:"text-xs text-muted-foreground",children:[i.length," groupe",i.length>1?"s":""," sélectionné",i.length>1?"s":"","."]}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Date"}),e.jsx(ge,{type:"date",value:u.assigned_date,onChange:t=>l({...u,assigned_date:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Créneau"}),e.jsxs(W,{value:u.assigned_slot,onValueChange:t=>l({...u,assigned_slot:t}),children:[e.jsx(Y,{children:e.jsx(J,{placeholder:"Choisir..."})}),e.jsxs(Z,{children:[e.jsx($,{value:"morning",children:"Matin"}),e.jsx($,{value:"evening",children:"Soir"})]})]})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(A,{className:"w-full sm:w-auto",onClick:Q,disabled:w,children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),L.isPending||p?"Assignation...":"Assigner & notifier"]})})]})},Et=({onBack:s,athletes:a,groups:c,athletesLoading:n})=>{const{toast:r}=ne(),[d,u]=o.useState(""),[l,p]=o.useState(""),h=o.useMemo(()=>a.filter(i=>i.id&&i.email).map(i=>({value:`user:${i.id}`,label:i.group_label?`${i.display_name} · ${i.group_label}`:i.display_name,email:i.email})),[a]),x=o.useMemo(()=>c.map(i=>({value:`group:${i.id}`,label:i.name,id:i.id})),[c]),m=()=>{if(!l)return[];if(l.startsWith("user:")){const i=h.find(j=>j.value===l);return i?[i.email]:[]}if(l.startsWith("group:")){const i=Number(l.split(":")[1]);return a.filter(j=>j.group_id===i&&j.email).map(j=>j.email)}return[]},g=()=>{const i=m();if(!i.length){r({title:"Aucune adresse email",description:"Aucun nageur avec une adresse email dans cette sélection."});return}const j=new URLSearchParams;j.set("bcc",i.join(",")),d.trim()&&j.set("subject",d.trim()),window.location.href=`mailto:?${j.toString()}`},f=m();return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(se,{title:"Contacter par email",description:"Ouvre votre application mail avec les destinataires en CCI.",onBack:s}),e.jsxs(ue,{className:"border-l-4 border-l-primary",children:[e.jsxs(me,{children:[e.jsx(pe,{children:"Destinataire"}),e.jsx(he,{children:"Sélectionnez un nageur ou un groupe."})]}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Destinataire"}),e.jsxs(W,{value:l,onValueChange:p,children:[e.jsx(Y,{children:e.jsx(J,{placeholder:n?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(Z,{children:[x.length?e.jsxs(e.Fragment,{children:[e.jsx($,{value:"section-group",disabled:!0,children:"Groupes"}),x.map(i=>e.jsx($,{value:i.value,children:i.label},i.value))]}):null,h.length?e.jsxs(e.Fragment,{children:[e.jsx($,{value:"section-athlete",disabled:!0,children:"Nageurs"}),h.map(i=>e.jsx($,{value:i.value,children:i.label},i.value))]}):null]})]})]}),l&&f.length>0?e.jsxs("p",{className:"text-xs text-muted-foreground",children:[f.length," adresse",f.length>1?"s":""," email",f.length>1?" (envoi en CCI)":""]}):null,l&&f.length===0?e.jsx("p",{className:"text-xs text-destructive",children:"Aucune adresse email disponible pour cette sélection."}):null]})]}),e.jsxs(ue,{children:[e.jsxs(me,{children:[e.jsx(pe,{children:"Objet"}),e.jsx(he,{children:"Optionnel — pré-rempli dans votre application mail."})]}),e.jsx(xe,{children:e.jsx(ge,{value:d,onChange:i=>u(i.target.value),placeholder:"Objet du mail…"})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(A,{className:"w-full sm:w-auto",onClick:g,disabled:!l||f.length===0,children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),"Ouvrir dans l'app mail",e.jsx(at,{className:"ml-2 h-3 w-3"})]})})]})};function He(s){return String(s).padStart(2,"0")}function re(s){return`${s.getFullYear()}-${He(s.getMonth()+1)}-${He(s.getDate())}`}function we(s){return new Date(s.getFullYear(),s.getMonth(),1)}function Qe(s,a){const c=new Date(s);return c.setDate(c.getDate()+a),c}function zt(s){return(s.getDay()+6)%7}function Se(s){if(!s)return"AM";const a=s.toLowerCase();return a==="evening"||a.includes("soir")||a==="pm"?"PM":"AM"}const It=[{key:"swim-morning",label:"Nage — Matin",type:"swim",scheduledSlot:"morning"},{key:"swim-evening",label:"Nage — Soir",type:"swim",scheduledSlot:"evening"},{key:"strength",label:"Musculation",type:"strength",scheduledSlot:null}];function $t({groupId:s,userId:a,enabled:c}){const n=o.useMemo(()=>new Date,[]),[r,d]=o.useState(()=>we(new Date)),[u,l]=o.useState(()=>re(new Date)),[p,h]=o.useState(null),[x,m]=o.useState(!1),g=o.useMemo(()=>we(r),[r]),f=o.useMemo(()=>{const y=zt(g),C=Qe(g,-y),k=[];for(let N=0;N<42;N++)k.push(Qe(C,N));return k},[g]),i=o.useMemo(()=>{const y=re(f[0]),C=re(f[f.length-1]);return{from:y,to:C}},[f]),j=!!(s||a),{data:D=[],isLoading:v}=U({queryKey:["coach-calendar-assignments",s,a,i.from,i.to],queryFn:()=>P.getCoachAssignments({groupId:s??null,userId:a??null,from:i.from,to:i.to}),enabled:j}),_=o.useMemo(()=>{const y=new Map;for(const C of D){const k=C.scheduledDate?.slice(0,10);k&&(y.has(k)||y.set(k,[]),y.get(k).push(C))}return y},[D]),E=o.useMemo(()=>{const y={};for(const C of f){const k=re(C),N=_.get(k)??[],R=N.some(I=>Se(I.scheduledSlot)==="AM"),F=N.some(I=>Se(I.scheduledSlot)==="PM"),b=(R?1:0)+(F?1:0),q=[{slotKey:"AM",expected:R,completed:R,absent:!1},{slotKey:"PM",expected:F,completed:F,absent:!1}];y[k]={completed:b,total:b,slots:q}}return y},[f,_]),z=o.useMemo(()=>{const[y,C,k]=u.split("-").map(Number);return new Date(y,C-1,k)},[u]),K=o.useMemo(()=>_.get(u)??[],[_,u]),L=o.useMemo(()=>{const y=K;return It.map(C=>{const k=y.filter(F=>C.type!==F.type?!1:C.type==="swim"?Se(F.scheduledSlot)===(C.scheduledSlot==="morning"?"AM":"PM"):!0),N=k.find(F=>F.targetType==="user"),R=k.find(F=>F.targetType==="group");return{...C,assignment:N??R??null}})},[K]),Q=o.useMemo(()=>{const y={};for(const C of f){const k=re(C),N=_.get(k)??[];y[k]=N.some(R=>R.type==="strength")}return y},[f,_]),w=E[u]??{completed:0,total:0,slots:[{slotKey:"AM",expected:!1,completed:!1,absent:!1},{slotKey:"PM",expected:!1,completed:!1,absent:!1}]},t=o.useCallback(()=>{d(y=>new Date(y.getFullYear(),y.getMonth()-1,1))},[]),S=o.useCallback(()=>{d(y=>new Date(y.getFullYear(),y.getMonth()+1,1))},[]),T=o.useCallback(()=>{d(we(new Date)),l(re(new Date))},[]),M=o.useCallback(y=>{l(y),m(!0)},[]);return{today:n,monthCursor:r,selectedISO:u,selectedDayIndex:p,drawerOpen:x,gridDates:f,completionByISO:E,selectedDate:z,selectedDayStatus:w,assignmentsForSelectedDay:K,slotsForSelectedDay:L,hasStrengthByISO:Q,isLoading:v,hasFilter:j,setSelectedISO:l,setSelectedDayIndex:h,setDrawerOpen:m,prevMonth:t,nextMonth:S,jumpToday:T,openDay:M}}function qt(s){const[a,c,n]=s.split("-").map(Number);return new Date(a,c-1,n).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})}function Lt({onBack:s,athletes:a,groups:c,swimSessions:n,strengthSessions:r}){const[d,u]=o.useState("group"),[l,p]=o.useState(""),[h,x]=o.useState(""),m=d==="group"&&l?Number(l):null,g=d==="user"&&h?Number(h):null,{today:f,monthCursor:i,selectedISO:j,selectedDayIndex:D,drawerOpen:v,gridDates:_,completionByISO:E,selectedDayStatus:z,slotsForSelectedDay:K,hasStrengthByISO:L,hasFilter:Q,setSelectedISO:w,setSelectedDayIndex:t,setDrawerOpen:S,prevMonth:T,nextMonth:M,jumpToday:y,openDay:C}=$t({groupId:m,userId:g,enabled:!0}),k=Ne(),N=H({mutationFn:b=>P.assignments_create(b),onSuccess:()=>{k.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),R=H({mutationFn:b=>P.assignments_delete(b),onSuccess:()=>{k.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),F=(b,q)=>{let I=q;if(b.key==="ArrowLeft"&&(I=Math.max(0,q-1)),b.key==="ArrowRight"&&(I=Math.min(_.length-1,q+1)),b.key==="ArrowUp"&&(I=Math.max(0,q-7)),b.key==="ArrowDown"&&(I=Math.min(_.length-1,q+7)),I!==q){b.preventDefault(),t(I);const V=le=>String(le).padStart(2,"0"),G=_[I],ie=`${G.getFullYear()}-${V(G.getMonth()+1)}-${V(G.getDate())}`;w(ie)}if(b.key==="Enter"||b.key===" "){b.preventDefault();const V=le=>String(le).padStart(2,"0"),G=_[q],ie=`${G.getFullYear()}-${V(G.getMonth()+1)}-${V(G.getDate())}`;C(ie)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(se,{title:"Calendrier",description:"Vue mensuelle des assignations",onBack:s}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs(rs,{type:"single",value:d,onValueChange:b=>{(b==="group"||b==="user")&&u(b)},className:"shrink-0",children:[e.jsx(ce,{value:"group",className:"text-xs px-3",children:"Groupe"}),e.jsx(ce,{value:"user",className:"text-xs px-3",children:"Nageur"})]}),d==="group"?e.jsxs(W,{value:l,onValueChange:p,children:[e.jsx(Y,{className:"w-full sm:w-56",children:e.jsx(J,{placeholder:"Choisir un groupe"})}),e.jsx(Z,{children:c.map(b=>e.jsx($,{value:String(b.id),children:b.name},String(b.id)))})]}):e.jsxs(W,{value:h,onValueChange:x,children:[e.jsx(Y,{className:"w-full sm:w-56",children:e.jsx(J,{placeholder:"Choisir un nageur"})}),e.jsx(Z,{children:a.filter(b=>b.id!=null).map(b=>e.jsxs($,{value:String(b.id),children:[b.display_name,b.group_label?` · ${b.group_label}`:""]},String(b.id)))})]})]}),Q?e.jsxs("div",{className:"rounded-2xl border bg-card shadow-sm",children:[e.jsx(Bs,{monthCursor:i,selectedDayStatus:z,onPrevMonth:T,onNextMonth:M,onJumpToday:y}),e.jsx(Hs,{monthCursor:i,gridDates:_,completionByISO:E,strengthByISO:L,selectedISO:j,selectedDayIndex:D,today:f,onDayClick:C,onKeyDown:F})]}):e.jsx("div",{className:"py-12 text-center text-sm text-muted-foreground",children:"Sélectionnez un groupe ou un nageur pour afficher le calendrier."}),e.jsx(Fe,{open:v,onOpenChange:S,children:e.jsxs(Ee,{side:"bottom",className:"max-h-[70vh] overflow-y-auto rounded-t-2xl",children:[e.jsxs(ze,{className:"pb-3",children:[e.jsx(Ie,{className:"capitalize text-left",children:qt(j)}),e.jsx($e,{className:"sr-only",children:"Gérer les assignations pour cette journée"})]}),e.jsx("div",{className:"space-y-3",children:K.map(b=>{const q=b.assignment?.targetType==="group",I=d==="user";return e.jsx(Gt,{slot:b,swimSessions:n,strengthSessions:r,isGroupAssignment:q&&I,onAssign:V=>{N.mutate({assignment_type:b.type,session_id:V,scheduled_date:j,scheduled_slot:b.scheduledSlot??void 0,target_group_id:m,target_user_id:g})},onDelete:V=>{R.mutate(V)},onReplace:(V,G)=>{q&&I?N.mutate({assignment_type:b.type,session_id:G,scheduled_date:j,scheduled_slot:b.scheduledSlot??void 0,target_user_id:g}):R.mutate(V,{onSuccess:()=>{N.mutate({assignment_type:b.type,session_id:G,scheduled_date:j,scheduled_slot:b.scheduledSlot??void 0,target_group_id:m,target_user_id:g})}})},isPending:N.isPending||R.isPending},b.key)})})]})})]})}function Gt({slot:s,swimSessions:a,strengthSessions:c,isGroupAssignment:n,onAssign:r,onDelete:d,onReplace:u,isPending:l}){const[p,h]=o.useState(!1),x=s.type==="swim",m=x?(a??[]).map(i=>({id:i.id,label:i.name})):(c??[]).map(i=>({id:i.id,label:i.title})),g=s.assignment!==null,f=i=>{const j=Number(i);j&&(g&&p?(u(s.assignment.id,j),h(!1)):r(j))};return e.jsxs("div",{className:"rounded-xl border p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[x?e.jsx(ss,{className:"h-4 w-4 text-blue-500 shrink-0"}):e.jsx(ts,{className:"h-4 w-4 text-orange-500 shrink-0"}),e.jsx("span",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:s.label})]}),g&&!p?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm font-semibold truncate flex-1",children:[s.assignment.title,n&&e.jsx("span",{className:"ml-1.5 text-[10px] font-medium text-muted-foreground bg-muted px-1.5 py-0.5 rounded-full align-middle",children:"Groupe"})]}),e.jsx(A,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0",disabled:l,onClick:()=>h(!0),title:n?"Personnaliser":"Changer",children:e.jsx(Os,{className:"h-3.5 w-3.5"})}),!n&&e.jsx(A,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0 text-destructive hover:text-destructive",disabled:l,onClick:()=>d(s.assignment.id),title:"Supprimer",children:e.jsx(os,{className:"h-3.5 w-3.5"})})]}):e.jsxs(W,{value:"",onValueChange:f,disabled:l||m.length===0,children:[e.jsx(Y,{className:"h-9 text-xs",children:e.jsx(J,{placeholder:p?n?"Personnaliser pour ce nageur":"Choisir le remplacement":"Choisir une séance"})}),e.jsx(Z,{children:m.map(i=>e.jsx($,{value:String(i.id),children:i.label},i.id))})]}),p?e.jsx("button",{type:"button",className:"text-xs text-muted-foreground hover:text-foreground",onClick:()=>h(!1),children:"Annuler"}):null]})}const ys=({athletes:s,selected:a,onToggle:c,filterToUserIds:n})=>{const[r,d]=o.useState(""),u=o.useMemo(()=>{let p=s.filter(h=>h.id!=null);if(n&&(p=p.filter(h=>n.has(h.id))),r.trim()){const h=r.toLowerCase();p=p.filter(x=>x.display_name.toLowerCase().includes(h))}return p},[s,n,r]),l=o.useMemo(()=>{const p=new Map;for(const h of u){const x=h.group_label||"Sans groupe";p.has(x)||p.set(x,[]),p.get(x).push(h)}return[...p.entries()].sort(([h],[x])=>h.localeCompare(x,"fr"))},[u]);return e.jsxs("div",{className:"space-y-3",children:[e.jsx(ge,{placeholder:"Rechercher un nageur...",value:r,onChange:p=>d(p.target.value)}),e.jsxs("div",{className:"max-h-[50vh] overflow-y-auto space-y-3",children:[l.map(([p,h])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-1.5",children:p}),e.jsx("div",{className:"space-y-1",children:h.map(x=>e.jsxs("label",{className:"flex items-center gap-2.5 rounded-lg border px-3 py-2 cursor-pointer hover:bg-muted/50 transition-colors",children:[e.jsx(je,{checked:a.has(x.id),onCheckedChange:()=>c(x.id)}),e.jsx("span",{className:"text-sm",children:x.display_name})]},x.id))})]},p)),l.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun nageur trouvé."})]}),a.size>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.size," nageur",a.size>1?"s":""," ","sélectionné",a.size>1?"s":""]})]})},bs=({open:s,onOpenChange:a,athletes:c,parentGroupId:n,parentMembers:r,onCreated:d})=>{const{toast:u}=ne(),[l,p]=o.useState(""),[h,x]=o.useState(new Set),m=i=>{x(j=>{const D=new Set(j);return D.has(i)?D.delete(i):D.add(i),D})},g=H({mutationFn:()=>P.createTemporaryGroup({name:l.trim(),member_user_ids:[...h],parent_group_id:n??void 0}),onSuccess:()=>{u({title:"Groupe créé",description:`Le groupe "${l.trim()}" a été créé avec ${h.size} nageur${h.size>1?"s":""}.`}),p(""),x(new Set),a(!1),d()},onError:i=>{u({title:"Erreur",description:i.message,variant:"destructive"})}}),f=()=>{if(!l.trim()){u({title:"Nom requis",description:"Veuillez saisir un nom pour le groupe.",variant:"destructive"});return}g.mutate()};return e.jsx(Fe,{open:s,onOpenChange:a,children:e.jsxs(Ee,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(ze,{children:[e.jsx(Ie,{children:n?"Créer un sous-groupe":"Créer un groupe"}),e.jsx($e,{children:n?"Sélectionnez des nageurs du groupe parent pour ce sous-groupe.":"Créez un groupe temporaire (stage, compétition) avec des nageurs de différents groupes."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"group-name",children:"Nom du groupe"}),e.jsx(ge,{id:"group-name",placeholder:"Ex : Stage Pâques 2026",value:l,onChange:i=>p(i.target.value)})]}),e.jsx(Us,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Nageurs"}),e.jsx(ys,{athletes:c,selected:h,onToggle:m,filterToUserIds:r??null})]}),e.jsx(A,{className:"w-full",onClick:f,disabled:g.isPending||!l.trim(),children:g.isPending?"Création...":"Créer le groupe"})]})]})})},Vt=({open:s,onOpenChange:a,groupId:c,athletes:n,existingMemberIds:r,onAdded:d})=>{const{toast:u}=ne(),[l,p]=o.useState(new Set),h=o.useMemo(()=>n.filter(g=>g.id!=null&&!r.has(g.id)),[n,r]),x=g=>{p(f=>{const i=new Set(f);return i.has(g)?i.delete(g):i.add(g),i})},m=H({mutationFn:()=>P.addTemporaryGroupMembers(c,[...l]),onSuccess:()=>{u({title:"Nageurs ajoutés",description:`${l.size} nageur${l.size>1?"s":""} ajouté${l.size>1?"s":""}.`}),p(new Set),a(!1),d()},onError:g=>{u({title:"Erreur",description:g.message,variant:"destructive"})}});return e.jsx(Fe,{open:s,onOpenChange:a,children:e.jsxs(Ee,{side:"right",className:"w-full sm:max-w-md overflow-y-auto",children:[e.jsxs(ze,{children:[e.jsx(Ie,{children:"Ajouter des nageurs"}),e.jsx($e,{children:"Sélectionnez les nageurs à ajouter au groupe."})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx(ys,{athletes:h,selected:l,onToggle:x}),e.jsx(A,{className:"w-full",onClick:()=>m.mutate(),disabled:m.isPending||l.size===0,children:m.isPending?"Ajout...":`Ajouter ${l.size} nageur${l.size>1?"s":""}`})]})]})})},Kt=({groupId:s,athletes:a,onBack:c})=>{const{toast:n}=ne(),r=Ne(),[d,u]=o.useState(!1),[l,p]=o.useState(!1),[h,x]=o.useState(null),{data:m,isLoading:g}=U({queryKey:["temp-group-detail",s],queryFn:()=>P.getTemporaryGroupDetail(s)}),f=H({mutationFn:v=>P.removeTemporaryGroupMember(s,v),onSuccess:()=>{n({title:"Nageur retiré"}),r.invalidateQueries({queryKey:["temp-group-detail",s]}),r.invalidateQueries({queryKey:["temp-groups"]})},onError:v=>{n({title:"Erreur",description:v.message,variant:"destructive"})}}),i=()=>{r.invalidateQueries({queryKey:["temp-group-detail",s]}),r.invalidateQueries({queryKey:["temp-groups"]})},j=o.useMemo(()=>new Set((m?.members??[]).map(v=>v.user_id)),[m]),D=o.useMemo(()=>new Set((m?.members??[]).map(v=>v.user_id)),[m]);return g?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(A,{variant:"ghost",size:"sm",className:"-ml-2",onClick:c,children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("div",{className:"space-y-2",children:[1,2,3].map(v=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-4 w-32 rounded bg-muted"})},v))})]}):m?e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(A,{variant:"ghost",size:"sm",className:"-ml-2",onClick:c,children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:m.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{variant:m.is_active?"default":"secondary",children:m.is_active?"Actif":"Terminé"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[m.members.length," membre",m.members.length!==1?"s":""]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Membres"}),m.is_active&&e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>u(!0),children:[e.jsx(Zs,{className:"mr-1.5 h-3.5 w-3.5"}),"Ajouter"]})]}),m.members.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun membre dans ce groupe."}):e.jsx("div",{className:"space-y-1.5",children:m.members.map(v=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border bg-card p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:v.display_name}),v.permanent_group_label&&e.jsx(ae,{variant:"secondary",className:"text-[10px] px-1.5 py-0 mt-0.5",children:v.permanent_group_label})]}),m.is_active&&e.jsx(A,{size:"icon",variant:"ghost",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>x({userId:v.user_id,name:v.display_name}),title:"Retirer du groupe",children:e.jsx(Xs,{className:"h-4 w-4"})})]},v.user_id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Sous-groupes"}),m.is_active&&e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>p(!0),children:[e.jsx(Te,{className:"mr-1.5 h-3.5 w-3.5"}),"Sous-groupe"]})]}),m.subgroups.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucun sous-groupe."}):e.jsx("div",{className:"space-y-2",children:m.subgroups.map(v=>e.jsxs(Ws,{children:[e.jsxs(Ys,{className:"flex w-full items-center justify-between rounded-xl border bg-card p-3 text-left hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(is,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-semibold",children:v.name}),e.jsx(ae,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:v.members.length})]}),e.jsx(as,{className:"h-4 w-4 text-muted-foreground transition-transform [[data-state=open]_&]:rotate-180"})]}),e.jsx(Js,{children:e.jsxs("div",{className:"ml-4 mt-1 space-y-1",children:[v.members.map(_=>e.jsx("div",{className:"flex items-center gap-2 rounded-lg border px-3 py-2",children:e.jsx("span",{className:"text-sm",children:_.display_name})},_.user_id)),v.members.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground py-2",children:"Aucun membre."})]})})]},v.id))})]}),e.jsx(Vt,{open:d,onOpenChange:u,groupId:s,athletes:a,existingMemberIds:j,onAdded:i}),e.jsx(bs,{open:l,onOpenChange:p,athletes:a,parentGroupId:s,parentMembers:D,onCreated:i}),e.jsx(_e,{open:!!h,onOpenChange:v=>{v||x(null)},children:e.jsxs(ke,{children:[e.jsxs(Me,{children:[e.jsx(Ae,{children:"Retirer du groupe"}),e.jsxs(Pe,{children:["Voulez-vous retirer ",h?.name," de ce groupe ?",m.subgroups.length>0?" Le nageur sera aussi retiré des sous-groupes.":""]})]}),e.jsxs(De,{children:[e.jsx(Re,{children:"Annuler"}),e.jsx(Oe,{onClick:()=>{h&&(f.mutate(h.userId),x(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Retirer"})]})]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(A,{variant:"ghost",size:"sm",className:"-ml-2",onClick:c,children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Retour aux groupes"]}),e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Groupe introuvable."})]})},Ue=({group:s,onManage:a,onDeactivate:c,onReactivate:n,onDelete:r})=>{const d=new Date(s.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"});return e.jsxs("div",{className:"rounded-xl border bg-card p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-bold truncate",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.member_count," membre",s.member_count!==1?"s":""]}),s.subgroup_count>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.subgroup_count," sous-groupe",s.subgroup_count!==1?"s":""]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:d})]})]}),e.jsx(ae,{variant:s.is_active?"default":"secondary",children:s.is_active?"Actif":"Terminé"})]}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:s.is_active?e.jsxs(e.Fragment,{children:[e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>a(s.id),children:[e.jsx(Ts,{className:"mr-1.5 h-3.5 w-3.5"}),"Gérer"]}),e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>c(s.id),children:[e.jsx(Qs,{className:"mr-1.5 h-3.5 w-3.5"}),"Terminer"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>n(s.id),children:[e.jsx(Fs,{className:"mr-1.5 h-3.5 w-3.5"}),"Réactiver"]}),e.jsxs(A,{size:"sm",variant:"outline",className:"text-destructive hover:text-destructive",onClick:()=>r(s.id),children:[e.jsx(os,{className:"mr-1.5 h-3.5 w-3.5"}),"Supprimer"]})]})})]})},Bt=({onBack:s,athletes:a,athletesLoading:c})=>{const{toast:n}=ne(),r=Ne(),[d,u]=o.useState("list"),[l,p]=o.useState(null),[h,x]=o.useState(!1),[m,g]=o.useState(null),[f,i]=o.useState(null),{data:j=[],isLoading:D}=U({queryKey:["temp-groups"],queryFn:()=>P.getTemporaryGroups()}),v=o.useMemo(()=>j.filter(w=>w.is_active),[j]),_=o.useMemo(()=>j.filter(w=>!w.is_active),[j]),E=H({mutationFn:w=>P.deactivateTemporaryGroup(w),onSuccess:()=>{n({title:"Groupe terminé"}),r.invalidateQueries({queryKey:["temp-groups"]})},onError:w=>{n({title:"Erreur",description:w.message,variant:"destructive"})}}),z=H({mutationFn:w=>P.reactivateTemporaryGroup(w),onSuccess:()=>{n({title:"Groupe réactivé"}),r.invalidateQueries({queryKey:["temp-groups"]})},onError:w=>{n({title:"Erreur",description:w.message,variant:"destructive"})}}),K=H({mutationFn:w=>P.deleteTemporaryGroup(w),onSuccess:()=>{n({title:"Groupe supprimé"}),r.invalidateQueries({queryKey:["temp-groups"]})},onError:w=>{n({title:"Erreur",description:w.message,variant:"destructive"})}}),L=w=>{p(w),u("detail")},Q=()=>{p(null),u("list"),r.invalidateQueries({queryKey:["temp-groups"]})};return d==="detail"&&l!=null?e.jsx(Kt,{groupId:l,athletes:a,onBack:Q}):e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(se,{title:"Groupes temporaires",description:"Créez et gérez des groupes pour les stages, compétitions ou événements.",onBack:s,actions:e.jsxs(A,{onClick:()=>x(!0),children:[e.jsx(Te,{className:"mr-2 h-4 w-4"}),"Créer un groupe"]})}),D||c?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(w=>e.jsx("div",{className:"rounded-xl border p-4 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-40 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-6 w-16 rounded bg-muted"})]})},w))}):j.length===0?e.jsxs("div",{className:"text-center py-12 space-y-3",children:[e.jsx(ye,{className:"h-10 w-10 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun groupe temporaire pour le moment."}),e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>x(!0),children:[e.jsx(Te,{className:"mr-1.5 h-3.5 w-3.5"}),"Créer le premier groupe"]})]}):e.jsxs(e.Fragment,{children:[v.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Actifs (",v.length,")"]}),v.map(w=>e.jsx(Ue,{group:w,onManage:L,onDeactivate:t=>g(t),onReactivate:t=>z.mutate(t),onDelete:t=>i(t)},w.id))]}),_.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Terminés (",_.length,")"]}),_.map(w=>e.jsx(Ue,{group:w,onManage:L,onDeactivate:t=>g(t),onReactivate:t=>z.mutate(t),onDelete:t=>i(t)},w.id))]})]}),e.jsx(bs,{open:h,onOpenChange:x,athletes:a,onCreated:()=>{r.invalidateQueries({queryKey:["temp-groups"]})}}),e.jsx(_e,{open:m!=null,onOpenChange:w=>{w||g(null)},children:e.jsxs(ke,{children:[e.jsxs(Me,{children:[e.jsx(Ae,{children:"Terminer le groupe"}),e.jsx(Pe,{children:"Voulez-vous marquer ce groupe comme terminé ? Les sous-groupes seront aussi désactivés. Vous pourrez le réactiver plus tard si nécessaire."})]}),e.jsxs(De,{children:[e.jsx(Re,{children:"Annuler"}),e.jsx(Oe,{onClick:()=>{m!=null&&(E.mutate(m),g(null))},children:"Terminer"})]})]})}),e.jsx(_e,{open:f!=null,onOpenChange:w=>{w||i(null)},children:e.jsxs(ke,{children:[e.jsxs(Me,{children:[e.jsx(Ae,{children:"Supprimer le groupe"}),e.jsx(Pe,{children:"Cette action est irréversible. Le groupe et tous ses sous-groupes seront supprimés définitivement."})]}),e.jsxs(De,{children:[e.jsx(Re,{children:"Annuler"}),e.jsx(Oe,{onClick:()=>{f!=null&&(K.mutate(f),i(null))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Supprimer"})]})]})})]})},Ht=o.lazy(()=>ns(()=>import("./StrengthCatalog-CN6YiDEa.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]))),Qt=o.lazy(()=>ns(()=>import("./SwimCatalog-CpZ1XKXN.js"),__vite__mapDeps([38,1,2,3,4,5,6,18,19,9,11,21,16,39,40,12,41,23,15,24,17,25,26,14,10,8,13,29,42,28,43]))),Ut=({onNavigate:s,onOpenRecordsAdmin:a,onOpenRecordsClub:c,athletes:n,athletesLoading:r,upcomingBirthdays:d,birthdaysLoading:u,kpiLoading:l,kpiPeriod:p,onKpiPeriodChange:h,fatigueAlerts:x,mostLoadedAthlete:m,swimSessionCount:g,strengthSessionCount:f})=>{const i=new Date().getHours(),j=i<12?"Bonjour":i<18?"Bon après-midi":"Bonsoir",D=new Date().toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}),v=x.length>0;return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold uppercase italic",children:[j,", ",e.jsx("span",{className:"text-primary",children:"Coach"})]}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:D})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Signaux · ",p,"j"]}),e.jsxs(rs,{type:"single",size:"sm",variant:"outline",value:String(p),onValueChange:_=>{_&&h(Number(_))},children:[e.jsx(ce,{value:"7",className:"h-7 px-2 text-xs","aria-label":"7 jours",children:"7j"}),e.jsx(ce,{value:"30",className:"h-7 px-2 text-xs","aria-label":"30 jours",children:"30j"}),e.jsx(ce,{value:"365",className:"h-7 px-2 text-xs","aria-label":"1 an",children:"1an"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:`rounded-xl border p-3 ${v?"border-destructive/30 bg-destructive/5":"bg-muted/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Fatigue 5/5"}),e.jsx(it,{className:`h-3.5 w-3.5 ${v?"text-destructive":"text-muted-foreground"}`})]}),e.jsx("p",{className:"text-xl font-bold tabular-nums",children:l?"–":x.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground truncate",children:l?"Chargement…":v?x.slice(0,2).map(_=>_.athleteName.split(" ")[0]).join(", "):"Aucune alerte"})]}),e.jsxs("div",{className:"rounded-xl border bg-muted/30 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Plus chargé"}),e.jsx(ye,{className:"h-3.5 w-3.5 text-muted-foreground"})]}),e.jsx("p",{className:"text-xl font-bold truncate",children:l?"–":m?.athleteName?.split(" ")[0]??"–"}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:l?"Calcul…":m?`Charge ${Math.round(m.loadScore)}`:"Pas de données"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>s("assignments"),className:"flex items-center gap-1.5 rounded-full bg-primary text-primary-foreground px-4 py-2 text-sm font-semibold active:opacity-80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(be,{className:"h-3.5 w-3.5"}),"Assigner"]}),e.jsxs("button",{type:"button",onClick:()=>s("messaging"),className:"flex items-center gap-1.5 rounded-full border px-4 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(qe,{className:"h-3.5 w-3.5"}),"Email"]}),e.jsxs("button",{type:"button",onClick:()=>s("calendar"),className:"flex items-center gap-1.5 rounded-full border px-4 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(nt,{className:"h-3.5 w-3.5"}),"Calendrier"]}),e.jsxs("button",{type:"button",onClick:()=>s("groups"),className:"flex items-center gap-1.5 rounded-full border px-4 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(is,{className:"h-3.5 w-3.5"}),"Groupes"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>s("swim"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ss,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:g!=null?`${g} séance${g!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>s("strength"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ts,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Musculation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:f!=null?`${f} séance${f!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>s("swimmers"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ye,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Nageurs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r?"Chargement…":`${n.length} nageur${n.length!==1?"s":""}`})]}),e.jsxs("button",{type:"button",onClick:a,className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Is,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Records club"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Import & administration"})]})]}),e.jsx("button",{type:"button",onClick:c,className:"w-full text-center text-sm text-primary font-semibold py-1 active:opacity-70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring rounded",children:"Voir les records du club"}),!u&&d&&d.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Anniversaires"}),e.jsx("div",{className:"space-y-1.5",children:d.slice(0,3).map(_=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:_.display_name}),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:Wt(_.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-bold text-primary",children:["J-",_.days_until]})]},_.id))})]}):null]})},Wt=s=>{if(!s)return"-";const a=new Date(s);return Number.isNaN(a.getTime())?s:a.toLocaleDateString("fr-FR")},We=s=>s.toISOString().split("T")[0],Yt=s=>new Date(s.completed_at||s.started_at||s.date||s.created_at||0).getTime(),Jt=s=>{if(!s.length)return null;const a=s.reduce((n,r)=>n+r,0)/s.length,c=Math.min(5,Math.max(1,Math.round(a/10*5)));return{average:a,rating:c}};function Zt(){const s=Ke(t=>t.role),a=Ke(t=>t.setSelectedAthlete),[,c]=Es(),[n,r]=o.useState("home"),[d,u]=o.useState(7),l=s==="coach"||s==="admin",p=n==="home"||n==="assignments"||n==="calendar",h=n==="home"||n==="assignments"||n==="messaging"||n==="swimmers"||n==="calendar"||n==="groups",x=n==="assignments"||n==="messaging"||n==="calendar"||n==="groups",m=n==="home"||n==="swimmers",{data:g}=U({queryKey:["swim_catalog"],queryFn:()=>P.getSwimCatalog(),enabled:l&&p}),{data:f}=U({queryKey:["strength_catalog"],queryFn:()=>P.getStrengthSessions(),enabled:l&&p}),{data:i=[],isLoading:j}=U({queryKey:["athletes"],queryFn:()=>P.getAthletes(),enabled:l&&h}),D=o.useMemo(()=>i.slice(0,5),[i]),{data:v=[]}=U({queryKey:["groups"],queryFn:()=>P.getGroups(),enabled:l&&x}),_=U({queryKey:["upcoming-birthdays"],queryFn:()=>P.getUpcomingBirthdays({days:30}),enabled:l&&m}),E=_.data,z=U({queryKey:["coach-kpis",d,D.map(t=>t.id??t.display_name)],enabled:l&&n==="home"&&D.length>0,queryFn:async()=>{const t=d,S=new Date;S.setDate(S.getDate()-t);const T=We(S),M=We(new Date),y=await Promise.all(D.map(async N=>{const[R,F]=await Promise.all([P.getSessions(N.display_name,N.id),P.getStrengthHistory(N.display_name,{athleteId:N.id,limit:50,from:T,to:M})]),b=R.filter(O=>new Date(O.date).getTime()>=S.getTime()),q=b.map(O=>O.fatigue??O.feeling).filter(O=>Number.isFinite(O)),I=b.reduce((O,X)=>O+(Number(X.duration)||0)*(Number(X.effort)||0),0),G=(F?.runs??[]).filter(O=>Yt(O)>=S.getTime()),ie=G.map(O=>O.fatigue??O.feeling??O.rpe).filter(O=>Number.isFinite(Number(O))).map(O=>Number(O)),le=G.reduce((O,X)=>{const Ge=Number(X.feeling??X.rpe??0),Ve=Number(X.duration??0);if(Ve>0&&Ge>0)return O+Ve*Ge;const Cs=Array.isArray(X.logs)?X.logs.length:0;return O+Cs*5},0),Ns=Jt([...q,...ie]);return{athleteName:N.display_name,loadScore:I+le,fatigueRating:Ns}})),C=y.filter(N=>N.fatigueRating?.rating===5).map(N=>({athleteName:N.athleteName,rating:N.fatigueRating?.rating??0})),k=y.filter(N=>N.loadScore>0).sort((N,R)=>R.loadScore-N.loadScore)[0];return{fatigueAlerts:C,mostLoadedAthlete:k??null}}}),K=t=>{a({id:t.id??null,name:t.display_name}),c("/progress")},{toast:L}=ne(),Q=Ne(),w=H({mutationFn:async t=>{const S=await P.importSingleSwimmer(t.iuf,t.name);return await P.recalculateClubRecords(),S},onSuccess:t=>{L({title:"Import terminé",description:`${t.total_found} trouvées, ${t.new_imported} nouvelles.`}),Q.invalidateQueries({queryKey:["club-records"]})},onError:t=>{L({title:"Erreur import",description:t.message,variant:"destructive"})}});return l?e.jsxs("div",{className:"space-y-6",children:[n==="home"?e.jsx(Ut,{onNavigate:r,onOpenRecordsAdmin:()=>c("/records-admin"),onOpenRecordsClub:()=>c("/records-club"),athletes:i,athletesLoading:j,upcomingBirthdays:E,birthdaysLoading:_.isLoading,kpiLoading:z.isLoading,kpiPeriod:d,onKpiPeriodChange:u,fatigueAlerts:z.data?.fatigueAlerts??[],mostLoadedAthlete:z.data?.mostLoadedAthlete??null,swimSessionCount:g?.length,strengthSessionCount:f?.length}):null,n==="assignments"?e.jsx(Ft,{onBack:()=>r("home"),swimSessions:g,strengthSessions:f,athletes:i,groups:v}):null,n==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(se,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>r("home"),actions:e.jsxs(A,{variant:"outline",onClick:()=>r("assignments"),children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(o.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(Qt,{})})]}):null,n==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(se,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>r("home"),actions:e.jsxs(A,{variant:"outline",onClick:()=>r("assignments"),children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(o.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(Ht,{})})]}):null,n==="swimmers"?e.jsxs("div",{className:"space-y-4",children:[e.jsx(se,{title:"Nageurs",description:j?"Chargement…":`${i.length} nageur${i.length!==1?"s":""} inscrit${i.length!==1?"s":""}`,onBack:()=>r("home"),actions:e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>r("messaging"),children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),"Email"]})}),j?e.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(t=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-8 w-16 rounded bg-muted"})]})},t))}):i.length?e.jsx("div",{className:"space-y-2",children:i.map(t=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border bg-card p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:t.display_name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[t.group_label?e.jsx(ae,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:t.group_label}):null,t.ffn_iuf?e.jsx("span",{className:"text-[10px] font-mono text-muted-foreground",children:t.ffn_iuf}):null]})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[t.ffn_iuf?e.jsx(A,{size:"icon",variant:"ghost",className:"h-8 w-8",disabled:w.isPending,onClick:()=>w.mutate({iuf:t.ffn_iuf,name:t.display_name}),title:"Importer performances FFN",children:e.jsx(zs,{className:"h-4 w-4"})}):null,e.jsx(A,{size:"sm",variant:"outline",onClick:()=>K(t),children:"Fiche"})]})]},t.id??t.display_name))}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Aucun nageur disponible."})]}):null,n==="messaging"?e.jsx(Et,{onBack:()=>r("home"),athletes:i,groups:v,athletesLoading:j}):null,n==="calendar"?e.jsx(Lt,{onBack:()=>r("home"),athletes:i,groups:v,swimSessions:g,strengthSessions:f}):null,n==="groups"?e.jsx(Bt,{onBack:()=>r("home"),athletes:i,groups:v,athletesLoading:j}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(ue,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(me,{children:[e.jsxs(pe,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(ye,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(he,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(xe,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}const fn=Object.freeze(Object.defineProperty({__proto__:null,default:Zt},Symbol.toStringTag,{value:"Module"}));export{fn as C,Ot as P,Tt as a,vs as b};
