import{r as j,c as A,u as T,d as L,j as e}from"./vendor-query-BiSH4r2z.js";import{u as E,b as I,d as B,B as o,C as R,g as q,S as c}from"./index-dJTQaNU8.js";import{B as N}from"./badge-Cy1chgd7.js";import{S as M}from"./separator-C4V_zd_d.js";import{S as _,a as $,b as z,c as D}from"./sheet-O15r7SDf.js";import{S as F}from"./SwimSessionTimeline-K4v4A7IE.js";import{a as b}from"./api-DC2xj5DQ.js";import{g as Q}from"./swim-DqyPe04L.js";import{C as H}from"./circle-alert-CisG-JlM.js";import{C as K}from"./chevron-left-DHZ4pvCx.js";import{S as P}from"./share-2-Cke3Tp_X.js";import{f as O}from"./format-B9mPVj_w.js";import{f as U}from"./fr-CFyqyHeU.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-6k692oZB.js";import"./index-CN7jm4px.js";import"./index-C4OokYr0.js";import"./index-Dpp-mmzY.js";import"./eye-Z5IMXPKN.js";import"./chevron-down-BaAYQCpb.js";import"./clock--mIv53JK.js";const V={assigned:"Assignée",pending:"Assignée",in_progress:"En cours",completed:"Terminée",cancelled:"Annulée"},G=n=>{if(!n)return"-";const i=new Date(n);return Number.isNaN(i.getTime())?n:O(i,"dd MMM",{locale:U})};function fe(){const{user:n,userId:i}=E(),[d,m]=I(),[s,u]=j.useState(null),{toast:l}=B(),y=A(),p=j.useMemo(()=>{const[,t]=d.split("?");if(!t)return null;const f=new URLSearchParams(t).get("assignmentId"),g=f?Number(f):NaN;return Number.isFinite(g)?g:null},[d]),{data:v,isLoading:w,error:x,refetch:S}=T({queryKey:["assignments",n],queryFn:()=>b.getAssignments(n,i),enabled:!!n}),h=v?.filter(t=>t.session_type==="swim")||[],a=p?h.find(t=>t.id===p):h[0],k=L({mutationFn:t=>b.assignments_delete(t),onSuccess:()=>{y.invalidateQueries({queryKey:["assignments"]}),l({title:"Séance retirée",description:"La séance a été retirée de votre feed."}),m("/")},onError:()=>{l({title:"Erreur",description:"Impossible de retirer la séance.",variant:"destructive"})}}),C=async()=>{if(a)try{const t=await Q(a.session_id),r=`${window.location.origin}${window.location.pathname}#/s/${t}`;navigator.share?await navigator.share({title:a.title,url:r}):(await navigator.clipboard.writeText(r),l({title:"Lien copié !",description:"Le lien de partage a été copié dans le presse-papier."}))}catch{l({title:"Erreur",description:"Impossible de générer le lien de partage.",variant:"destructive"})}};return x?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(H,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:x.message}),e.jsx(o,{onClick:()=>S(),className:"mt-4",children:"Réessayer"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>m("/"),"aria-label":"Retour à l'accueil",children:e.jsx(K,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.2em] text-muted-foreground",children:"Séance natation"}),e.jsx("h1",{className:"text-2xl font-display font-bold uppercase",children:"Lecture"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a?e.jsx(o,{variant:"ghost",size:"icon",onClick:C,"aria-label":"Partager la séance",children:e.jsx(P,{className:"h-5 w-5"})}):null,a?e.jsx(N,{variant:"secondary",className:"text-xs",children:V[a.status]??"Assignée"}):null]})]}),e.jsx(R,{className:"border border-border shadow-sm",children:e.jsxs(q,{className:"space-y-4 p-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-lg font-semibold tracking-tight",children:a?.title??"Séance natation"}),a?.description?e.jsx("p",{className:"text-sm text-muted-foreground",children:a.description}):null]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx(N,{variant:"outline",className:"text-xs",children:G(a?.assigned_date)}),a?e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>{window.confirm("Retirer cette séance de votre feed ?")&&k.mutate(a.id)},className:"text-xs text-muted-foreground hover:text-foreground",children:"Retirer de mon feed"}):null]}),e.jsx(M,{}),w?e.jsxs("div",{className:"space-y-4","aria-live":"polite","aria-busy":"true",children:[e.jsx("div",{className:"sr-only",children:"Chargement de la séance..."}),e.jsx(c,{className:"h-6 w-48"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((t,r)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"h-5 w-32"}),e.jsx(c,{className:"h-4 w-full"}),e.jsx(c,{className:"h-4 w-3/4"})]},`skeleton-${r}`))})]}):a?e.jsx(F,{title:a.title,description:a.description,items:a.items,showHeader:!0,onExerciseSelect:t=>{u(t)}}):e.jsx("div",{className:"rounded-2xl border border-dashed border-muted/70 bg-muted/30 p-6 text-sm text-muted-foreground",children:"Aucune séance de natation assignée pour le moment."})]})}),e.jsx(_,{open:!!s,onOpenChange:t=>{t||u(null)},children:e.jsxs($,{side:"bottom",className:"max-h-[80vh] overflow-y-auto",children:[e.jsx(z,{children:e.jsx(D,{children:"Détails de l'exercice"})}),s?e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-muted-foreground",children:s.blockTitle&&s.blockIndex!==void 0?`Bloc ${s.blockIndex+1}`:"Bloc"}),e.jsx("p",{className:"text-lg font-semibold",children:s.label})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:[s.repetitions?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:[s.repetitions,"x"]}):null,s.distance?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:[s.distance,"m"]}):null,s.rest?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:["Récup ",s.rest,"s"]}):null,s.stroke?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:["Nage : ",s.stroke]}):null,s.strokeType?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:["Type : ",s.strokeType]}):null,s.intensity?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:["Intensité : ",s.intensity]}):null]}),s.modalities?e.jsx("div",{className:"rounded-2xl border bg-muted/10 p-3 text-sm text-muted-foreground",children:s.modalities}):null,s.equipment?.length?e.jsx("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:s.equipment.map(t=>e.jsx("span",{className:"rounded-full border px-2 py-1",children:t},t))}):null]}):null]})})]})}export{fe as default};
