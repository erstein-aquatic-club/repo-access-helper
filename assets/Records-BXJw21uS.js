import{r as l,j as e}from"./vendor-ui-DJQMR4VV.js";import{u as hs,f as fs,C as A,i as K,B as v,W as Q,D as Fe,T as Ee,L as E,I as L,X as ae,r as ke,m as gs,d as b}from"./index-DEbtO7mD.js";import{b as js,u as V,c as O}from"./vendor-query-BT4y-huw.js";import{T as ie}from"./textarea-C_k3ugiN.js";import{T as vs,a as bs,b as Ie,c as Re}from"./tabs-_-3J_u5w.js";import{S as Me,a as Te,b as Pe,c as Le,d as Y}from"./select-CIA5Ao1g.js";import{shouldShowRecords as Ns}from"./Profile-OjZ31pPa.js";import{m as P,s as qe,l as $e,f as ws,d as ys}from"./animations-BTr26p-C.js";import{C as _s}from"./circle-alert-BJhKOhot.js";import{C as De}from"./clock-CkYUphR9.js";import{P as ze}from"./pen-Cmp8QotO.js";import{C as oe}from"./check-CU62I3Qf.js";import{R as Ss,g as Cs,C as Fs,X as Es,Y as ks,T as Is,f as Rs}from"./vendor-charts-Db4xOvcx.js";import{S as Ms}from"./sticky-note-Da8QHcf_.js";import{C as Ts}from"./chevron-up-CVqo8Jbl.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-D7B1G6YZ.js";import"./types-C34sGj02.js";import"./save-C4QMocUH.js";import"./design-tokens-CGMys_0P.js";const I=(...n)=>n.filter(Boolean).join(" ");function G(n){if(!n)return"—";const r=new Date(n);return Number.isNaN(r.getTime())?n:r.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"2-digit"})}function J(n){if(n==null)return"—";const r=Math.round(Math.max(0,n*1e3)),x=Math.floor(r/6e4),c=Math.floor(r%6e4/1e3),f=Math.floor(r%1e3/10);return x>0?`${x}:${String(c).padStart(2,"0")}.${String(f).padStart(2,"0")}`:`${c}.${String(f).padStart(2,"0")}`}function Ps(n){const r=n.trim();if(!r)return null;if(r.includes(":")){const[c,f]=r.split(":"),j=Number(c);if(!Number.isFinite(j)||j<0)return null;const k=f.replace(",","."),S=Number(k);return!Number.isFinite(S)||S<0?null:j*60+S}const x=Number(r.replace(",","."));return!Number.isFinite(x)||x<0?null:x}function Ls(n){if(!n)return null;const r=n.match(/FFN\s*\((\d+)\s*pts\)/i);if(!r)return null;const x=Number(r[1]);return Number.isFinite(x)?x:null}function qs({value:n,placeholder:r,onSave:x,onCancel:c,inputMode:f="decimal",hint:j}){const[k,S]=l.useState(n);return l.useEffect(()=>{S(n)},[n]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(L,{value:k,onChange:a=>S(a.target.value),placeholder:r,inputMode:f,className:"h-10 rounded-xl",autoFocus:!0}),j?e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:j}):null]}),e.jsx(v,{type:"button",onClick:()=>x(k),className:"h-10 w-10 p-0 rounded-xl","aria-label":"Valider",children:e.jsx(oe,{className:"h-5 w-5"})}),e.jsx(v,{type:"button",variant:"outline",onClick:c,className:"h-10 w-10 p-0 rounded-xl","aria-label":"Annuler",children:e.jsx(ae,{className:"h-5 w-5"})})]})})}const _=()=>e.jsx("div",{className:"h-10 rounded-xl bg-muted animate-pulse motion-reduce:animate-none"});function at(){const{user:n,userId:r,role:x}=hs(),{toast:c}=fs(),f=js(),j={id:null,event_name:"",pool_length:"",time_seconds:"",record_date:"",notes:""},[k,S]=l.useState(()=>{const s=window.location.hash,t=s.indexOf("?");return t>=0&&new URLSearchParams(s.substring(t)).get("tab")==="1rm"?"1rm":"swim"}),[a,g]=l.useState(j),[i,Ae]=l.useState("training"),[q,Ke]=l.useState(25),[le,B]=l.useState(null),[Qe,de]=l.useState(null),[Ve,ce]=l.useState(""),[Oe,Be]=l.useState(null),[Ue,U]=l.useState(null),[me,$]=l.useState(""),[W,We]=l.useState(25),[C,He]=l.useState("all"),[Xe,ue]=l.useState(!1),R=Ns(x);l.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[]);const xe=s=>{const t=s?.pool_length??s?.poolLength??s?.poolLen??s?.pool;if(t==null)return null;if(typeof t=="number")return t===25||t===50?t:null;const m=String(t).match(/\b(25|50)\b/);if(!m)return null;const u=Number(m[1]);return u===25||u===50?u:null},Z=V({queryKey:["1rm",n,r],queryFn:()=>b.get1RM({athleteName:n,athleteId:r}),enabled:!!n&&R}),ee=V({queryKey:["exercises"],queryFn:()=>b.getExercises(),enabled:R}),se=V({queryKey:["swim-records",r,n],queryFn:()=>b.getSwimRecords({athleteId:r??void 0,athleteName:n??void 0}),enabled:!!n&&R}),M=V({queryKey:["profile",r],queryFn:()=>b.getProfile({userId:r??void 0}),enabled:!!r&&R}),F=String(M.data?.ffn_iuf??"").trim(),pe=Z.error||ee.error||se.error||M.error,Ye=()=>{Z.refetch(),ee.refetch(),se.refetch(),M.refetch()},te=V({queryKey:["swimmer-performances",r,F,W],queryFn:()=>b.getSwimmerPerformances({userId:r??void 0,iuf:F||void 0,poolLength:W}),enabled:!!F&&R&&i==="history"}),{data:T,isLoading:Ge,isError:Je}=te,H=O({mutationFn:()=>{if(!F)throw new Error("IUF FFN manquant. Ajoutez-le dans votre profil.");return b.importSwimmerPerformances({iuf:F,userId:r??void 0})},onSuccess:s=>{f.invalidateQueries({queryKey:["swimmer-performances"]}),c({title:"Import terminé",description:`${s.total_found} trouvée(s), ${s.new_imported} importée(s), ${s.already_existed} déjà existante(s)`}),ue(!0),setTimeout(()=>ue(!1),2e3)},onError:s=>{c({title:"Import impossible",description:String(s?.message||s),variant:"destructive"})}}),he=l.useMemo(()=>T?[...new Set(T.map(t=>t.event_code))].sort():[],[T]),D=l.useMemo(()=>{if(!T)return[];let s=T;return C!=="all"&&(s=s.filter(t=>t.event_code===C)),s},[T,C]),fe=l.useMemo(()=>C==="all"||!D.length?[]:[...D].filter(s=>s.competition_date).sort((s,t)=>(s.competition_date??"").localeCompare(t.competition_date??"")).map(s=>({date:G(s.competition_date),time:s.time_seconds,display:s.time_display??J(s.time_seconds)})),[D,C]),{data:Ze,isLoading:es,isError:ss}=Z,{data:ts,isLoading:rs,isError:ns}=ee,{data:ge,isLoading:is,isFetching:$s,isError:as,refetch:os}=se,ls=()=>{os()};l.useEffect(()=>{i==="comp"&&ls()},[i]);const je=O({mutationFn:s=>b.update1RM({...s,athlete_id:r,athlete_name:n}),onSuccess:()=>{f.invalidateQueries({queryKey:["1rm"]}),c({title:"1RM mis à jour"})}}),ve=O({mutationFn:s=>b.updateExerciseNote({athlete_id:r,exercise_id:s.exercise_id,notes:s.notes}),onSuccess:()=>{f.invalidateQueries({queryKey:["1rm"]}),c({title:"Note mise à jour"})}}),re=O({mutationFn:s=>b.upsertSwimRecord(s),onSuccess:()=>{f.invalidateQueries({queryKey:["swim-records"]}),g(j),B(null),c({title:"Record mis à jour"})}});O({mutationFn:s=>b.syncFfnSwimRecords({athleteId:r??void 0,athleteName:n??void 0,iuf:s}),onSuccess:s=>{f.invalidateQueries({queryKey:["swim-records"]}),c({title:"Synchro FFN terminée",description:`${s?.inserted??0} ajouté(s), ${s?.updated??0} mis à jour, ${s?.skipped??0} inchangé(s)`})},onError:s=>{c({title:"Synchro FFN impossible",description:String(s?.message||s),variant:"destructive"})}});const X=()=>{g(j),B(null)},ds=s=>{const t=xe(s);g({id:s.id,event_name:s.event_name??"",pool_length:t?String(t):"",time_seconds:s.time_seconds!=null?J(Number(s.time_seconds)):"",record_date:s.record_date?String(s.record_date).split("T")[0]:"",notes:s.notes??""}),B(s.id)},be=()=>{if(!a.event_name.trim()){c({title:"Nom d'épreuve requis",variant:"destructive"});return}if(!a.pool_length){c({title:"Bassin requis",variant:"destructive"});return}const s=Ps(a.time_seconds);if(s===null){c({title:"Temps invalide",description:"Ex: 1:02.34 ou 62.34",variant:"destructive"});return}re.mutate({id:a.id||null,athlete_id:r,athleteName:n,athlete_name:n,event_name:a.event_name,pool_length:parseInt(a.pool_length,10),time_seconds:s,record_date:a.record_date||null,notes:a.notes||null,record_type:i})},cs=s=>{s.preventDefault(),be()},Ne=l.useMemo(()=>(ge?.records??[]).filter(o=>{const m=xe(o);if(!m||m!==q)return!1;const u=String(o.record_type??"training");return i==="comp"?u==="comp":u==="training"}).sort((o,m)=>{const u=String(o.event_name??""),p=String(m.event_name??""),N=z=>String(z??"").toLowerCase().replace(/\./g,"").replace(/\s+/g," ").trim(),w=z=>{const h=N(z);return h.includes("nl")||h.includes("nage libre")?0:h.includes("dos")?1:h.includes("bra")||h.includes("brasse")?2:h.includes("pap")||h.includes("papillon")?3:h.includes("4n")||h.includes("4 n")||h.includes("4 nages")?4:99},y=z=>{const h=String(z??"").match(/^(\d+)/);return h?Number(h[1]):Number.POSITIVE_INFINITY},d=w(u),_e=w(p);if(d!==_e)return d-_e;const Se=y(u),Ce=y(p);return Se!==Ce?Se-Ce:N(u).localeCompare(N(p),"fr")}),[ge,q,i]),ms=()=>{g({...j,pool_length:String(q)}),B("add")},ne=s=>{Ae(s),X()},us=()=>{Ke(s=>s===25?50:25),X()},xs=(s,t)=>{de(s),ce(t!=null&&Number(t)>0?String(t):"")},we=()=>{de(null),ce("")},ps=(s,t)=>{const o=Number(String(t??"").replace(",","."));if(!Number.isFinite(o)||o<=0){c({title:"Valeur invalide",description:"Entrez un nombre > 0",variant:"destructive"});return}je.mutate({exercise_id:s,one_rm:o}),we()},ye=i==="training"?"grid-cols-[minmax(0,1fr)_3.75rem_3.75rem_2.25rem] sm:grid-cols-[minmax(0,1fr)_4.75rem_4.75rem_2.5rem]":"grid-cols-[minmax(0,1fr)_3.75rem_2.75rem_3.75rem] sm:grid-cols-[minmax(0,1fr)_4.75rem_3.75rem_4.75rem]";return R?pe?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(_s,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:pe.message}),e.jsx(v,{onClick:()=>Ye(),className:"mt-4",children:"Réessayer"})]}):e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg",children:[e.jsx("div",{className:"sticky top-0 z-20 scroll-mt-16 backdrop-blur bg-background/80 border-b border-border",children:e.jsxs("div",{className:"px-4 pt-4 pb-3",children:[e.jsx("div",{className:"text-xl font-semibold tracking-tight",children:"Records"}),e.jsx("div",{className:"mt-0.5 text-sm text-muted-foreground",children:"Natation & 1RM musculation"})]})}),e.jsx("div",{className:"px-2 sm:px-4 pt-3",children:e.jsxs(vs,{value:k,onValueChange:s=>S(s),children:[e.jsxs(bs,{className:"w-full rounded-3xl bg-muted/60 border border-border shadow-sm p-1.5 flex",children:[e.jsxs(Ie,{value:"swim","aria-label":"Records de natation",className:`flex-1 rounded-2xl px-4 py-2.5 text-sm font-semibold uppercase tracking-wide gap-2
                  data-[state=active]:bg-background data-[state=active]:text-foreground
                  data-[state=inactive]:text-muted-foreground`,children:[e.jsx(Q,{className:"h-4 w-4"}),"Natation"]}),e.jsxs(Ie,{value:"1rm","aria-label":"Records de musculation",className:`flex-1 rounded-2xl px-4 py-2.5 text-sm font-semibold uppercase tracking-wide gap-2
                  data-[state=active]:bg-background data-[state=active]:text-foreground
                  data-[state=inactive]:text-muted-foreground`,children:[e.jsx(Fe,{className:"h-4 w-4"}),"Musculation"]})]}),k==="swim"?e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"w-full rounded-2xl bg-muted/25 border border-border/60 p-1 flex",children:[e.jsxs("button",{type:"button",onClick:()=>ne("training"),className:I("flex-1 rounded-2xl px-3 py-2 text-sm max-[360px]:text-xs font-semibold transition inline-flex items-center justify-center gap-2 whitespace-nowrap",i==="training"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),"aria-pressed":i==="training",children:[e.jsx(Ee,{className:"h-4 w-4 max-[360px]:hidden"}),"Entraînement"]}),e.jsxs("button",{type:"button",onClick:()=>ne("comp"),className:I("flex-1 rounded-2xl px-3 py-2 text-sm max-[360px]:text-xs font-semibold transition inline-flex items-center justify-center gap-2 whitespace-nowrap",i==="comp"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),"aria-pressed":i==="comp",children:[e.jsx(Q,{className:"h-4 w-4 max-[360px]:hidden"}),"Compétition"]}),e.jsxs("button",{type:"button",onClick:()=>ne("history"),className:I("flex-1 rounded-2xl px-3 py-2 text-sm max-[360px]:text-xs font-semibold transition inline-flex items-center justify-center gap-2 whitespace-nowrap",i==="history"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),"aria-pressed":i==="history",children:[e.jsx(De,{className:"h-4 w-4 max-[360px]:hidden"}),"Historique"]})]})}):null,e.jsxs(Re,{value:"swim",className:"mt-0",children:[i!=="history"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-5 mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted/50 border border-border flex items-center justify-center",children:i==="training"?e.jsx(Ee,{className:"h-5 w-5"}):e.jsx(Q,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-sm font-semibold",children:[i==="training"?"Records entraînement":"Records compétition"," "]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:us,className:"inline-flex items-center gap-2 whitespace-nowrap rounded-2xl bg-muted/25 border border-border/60 px-3 py-2 text-sm font-semibold active:scale-[0.99] transition cursor-pointer focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary","aria-label":"Changer le bassin",title:"Appuie pour basculer 25m / 50m",children:[e.jsx("span",{className:"inline-flex items-center justify-center h-6 w-6 rounded-xl bg-background/60 border border-border",children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsxs("span",{className:"tabular-nums",children:[q,"m"]})]}),i!=="comp"?e.jsx(v,{type:"button",size:"sm",onClick:ms,className:"rounded-2xl",children:"Ajouter"}):null]})]}),i==="comp"?e.jsx("div",{className:"-mt-1 mb-2 text-xs text-muted-foreground",children:"Records fédération (lecture seule)."}):null,e.jsx(A,{className:"w-full min-w-0 overflow-x-auto rounded-2xl",children:e.jsx(K,{className:"p-0",children:is?e.jsxs("div",{className:"p-4 grid gap-3",children:[e.jsx(_,{}),e.jsx(_,{}),e.jsx(_,{})]}):as?e.jsx("div",{className:"mx-4 my-4 rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:"Impossible de charger les records natation."}):Ne.length===0?e.jsxs("div",{className:"px-4 py-6 text-sm text-muted-foreground",children:["Aucun record en bassin ",q,"m."]}):e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"px-3 sm:px-4 py-2 text-[11px] text-muted-foreground border-b border-border",children:e.jsxs("div",{className:I("grid items-center gap-2",ye),children:[e.jsx("div",{className:"truncate justify-self-start",children:"Épreuve"}),e.jsx("div",{className:"whitespace-nowrap justify-self-end",children:"Temps"}),i==="comp"?e.jsx("div",{className:"whitespace-nowrap justify-self-end",children:"Pts"}):e.jsx("div",{className:"whitespace-nowrap justify-self-end",children:"Date"}),i==="comp"?e.jsx("div",{className:"whitespace-nowrap justify-self-end",children:"Date"}):e.jsx("div",{className:"sr-only",children:"Actions"})]})}),e.jsx(P.div,{className:"divide-y divide-border motion-reduce:animate-none",variants:qe,initial:"hidden",animate:"visible",children:Ne.map(s=>{const t=le===s.id,o=J(s.time_seconds),m=G(s.record_date),u=(s.notes??"").trim(),p=s?.ffn_points??s?.ffnPoints??s?.points??s?.pts??null,N=p==null?NaN:Number(p),w=Number.isFinite(N)?N:Ls(s?.notes),y=(s?.meet??s?.meet_name??s?.meetName??s?.competition??"").trim?.()??"";return e.jsxs(P.div,{className:"px-3 sm:px-4 py-3 motion-reduce:animate-none",variants:$e,children:[e.jsxs("div",{className:I("grid items-center gap-2",ye),children:[e.jsx("div",{className:"min-w-0 justify-self-start",children:e.jsx("div",{className:"text-sm font-semibold truncate",children:s.event_name})}),e.jsx("div",{className:"justify-self-end text-sm font-semibold tabular-nums whitespace-nowrap overflow-hidden font-mono",children:o}),i==="comp"?e.jsx("div",{className:"justify-self-end text-sm tabular-nums text-muted-foreground whitespace-nowrap overflow-hidden",children:w==null?"—":String(w)}):e.jsx("div",{className:"justify-self-end text-sm tabular-nums text-muted-foreground whitespace-nowrap overflow-hidden",children:m}),i==="comp"?e.jsx("div",{className:"justify-self-end text-sm tabular-nums text-muted-foreground whitespace-nowrap overflow-hidden",children:m}):e.jsx("button",{type:"button",onClick:()=>ds(s),className:"justify-self-end inline-flex items-center justify-center h-9 w-9 rounded-xl bg-transparent text-muted-foreground hover:text-foreground hover:bg-muted/60 focus:outline-none focus:ring-2 focus:ring-ring/20","aria-label":`Modifier ${s.event_name}`,title:"Modifier",children:e.jsx(ze,{className:"h-4 w-4"})})]}),i==="comp"&&y?e.jsx("div",{className:"mt-1 text-xs text-muted-foreground truncate",children:y}):null,i==="training"&&u?e.jsx("div",{className:"mt-1 text-xs text-muted-foreground truncate",children:u}):null,i==="training"&&t?e.jsx(P.div,{className:"mt-3",variants:ws,initial:"hidden",animate:"visible",children:e.jsxs("div",{className:"rounded-2xl bg-muted/30 border border-border p-4 space-y-4",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{children:"Temps"}),e.jsx(L,{value:a.time_seconds,inputMode:"decimal",placeholder:"1:02.34",onChange:d=>g({...a,time_seconds:d.target.value}),className:"rounded-xl"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Format: mm:ss.cc ou secondes"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{children:"Date"}),e.jsx(L,{type:"date",value:a.record_date,onChange:d=>g({...a,record_date:d.target.value}),className:"rounded-xl"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{children:"Notes"}),e.jsx(ie,{value:a.notes,onChange:d=>g({...a,notes:d.target.value}),rows:2,className:"rounded-xl"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs(v,{type:"button",size:"sm",variant:"outline",onClick:X,className:"rounded-2xl gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Annuler"]}),e.jsxs(v,{type:"button",size:"sm",onClick:be,disabled:re.isPending,className:"rounded-2xl gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"Enregistrer"]})]})]})}):null]},s.id)})})]})})}),i==="training"&&le==="add"?e.jsx("div",{className:"px-4 mt-4",children:e.jsx("form",{onSubmit:cs,children:e.jsxs("div",{className:"rounded-2xl border border-border p-4 space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{children:"Épreuve"}),e.jsx(L,{value:a.event_name,onChange:s=>g({...a,event_name:s.target.value}),placeholder:"Ex: 100 NL, 200 Dos",className:"rounded-xl"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{children:"Bassin (m)"}),e.jsxs(Me,{value:a.pool_length,onValueChange:s=>g({...a,pool_length:s}),children:[e.jsx(Te,{className:"rounded-xl",children:e.jsx(Pe,{placeholder:"Choisir"})}),e.jsxs(Le,{children:[e.jsx(Y,{value:"25",children:"25"}),e.jsx(Y,{value:"50",children:"50"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{children:"Temps"}),e.jsx(L,{value:a.time_seconds,inputMode:"decimal",placeholder:"1:02.34",onChange:s=>g({...a,time_seconds:s.target.value}),className:"rounded-xl"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{children:"Date"}),e.jsx(L,{type:"date",value:a.record_date,onChange:s=>g({...a,record_date:s.target.value}),className:"rounded-xl"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{children:"Notes"}),e.jsx(ie,{value:a.notes,onChange:s=>g({...a,notes:s.target.value}),rows:3,className:"rounded-xl"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(v,{type:"button",variant:"outline",onClick:X,className:"rounded-2xl",children:"Annuler"}),e.jsx(v,{type:"submit",disabled:re.isPending,className:"rounded-2xl",children:"Ajouter"})]})]})})}):null]}):null,i==="history"?e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted/50 border border-border flex items-center justify-center",children:e.jsx(De,{className:"h-5 w-5"})}),e.jsx("div",{className:"text-sm font-semibold",children:"Historique FFN"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{type:"button",onClick:()=>We(s=>s===25?50:25),className:"inline-flex items-center gap-2 whitespace-nowrap rounded-2xl bg-muted/25 border border-border/60 px-3 py-2 text-sm font-semibold active:scale-[0.99] transition cursor-pointer focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary","aria-label":"Changer le bassin",children:[e.jsx("span",{className:"inline-flex items-center justify-center h-6 w-6 rounded-xl bg-background/60 border border-border",children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsxs("span",{className:"tabular-nums",children:[W,"m"]})]})})]}),M.isError?e.jsx("div",{className:"rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:"Impossible de charger votre profil. Vérifiez votre connexion et rechargez la page."}):null,!M.isError&&!F&&!M.isLoading?e.jsxs("div",{className:"rounded-lg border border-yellow-500/20 bg-yellow-500/10 p-4 text-sm text-yellow-700 dark:text-yellow-400",children:[e.jsx("p",{className:"font-semibold mb-1",children:"IUF FFN non renseigné"}),e.jsxs("p",{children:["Pour importer vos performances depuis la FFN, renseignez votre numéro IUF dans"," ",e.jsx("a",{href:"/#/profile",className:"underline underline-offset-2 font-medium hover:text-foreground",children:"votre profil"}),"."]})]}):null,e.jsx(P.div,{variants:ys,animate:Xe?"visible":"hidden",className:"w-full",children:e.jsxs(v,{type:"button",onClick:()=>H.mutate(),disabled:H.isPending||!F,className:"w-full rounded-2xl gap-2",children:[H.isPending?e.jsx(ke,{className:"h-4 w-4 animate-spin"}):e.jsx(gs,{className:"h-4 w-4"}),H.isPending?"Import en cours...":"Importer mes performances FFN"]})}),he.length>0?e.jsxs(Me,{value:C,onValueChange:s=>He(s),children:[e.jsx(Te,{className:"rounded-xl",children:e.jsx(Pe,{placeholder:"Filtrer par épreuve"})}),e.jsxs(Le,{children:[e.jsx(Y,{value:"all",children:"Toutes les épreuves"}),he.map(s=>e.jsx(Y,{value:s,children:s},s))]})]}):null,C!=="all"&&fe.length>1?e.jsx(A,{className:"rounded-2xl",children:e.jsxs(K,{className:"pt-4 pb-2 px-2",children:[e.jsxs("div",{className:"text-xs text-muted-foreground mb-2 px-2",children:["Progression : ",C," (",W,"m)"]}),e.jsx(Ss,{width:"100%",height:220,children:e.jsxs(Cs,{data:fe,margin:{top:5,right:10,left:0,bottom:5},children:[e.jsx(Fs,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(Es,{dataKey:"date",tick:{fontSize:10},className:"text-muted-foreground"}),e.jsx(ks,{domain:["auto","auto"],tick:{fontSize:10},className:"text-muted-foreground",reversed:!0,tickFormatter:s=>{const t=Math.floor(s/60),o=Math.floor(s%60),m=Math.round(s%1*100);return t>0?`${t}:${String(o).padStart(2,"0")}`:`${o}.${String(m).padStart(2,"0")}`}}),e.jsx(Is,{formatter:s=>{const t=Math.floor(s/60),o=Math.floor(s%60),m=Math.round(s%1*100);return[t>0?`${t}:${String(o).padStart(2,"0")}.${String(m).padStart(2,"0")}`:`${o}.${String(m).padStart(2,"0")}`,"Temps"]},labelStyle:{fontSize:11},contentStyle:{borderRadius:12,fontSize:12}}),e.jsx(Rs,{type:"monotone",dataKey:"time",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{r:3},activeDot:{r:5}})]})})]})}):null,e.jsx(A,{className:"w-full min-w-0 overflow-x-auto rounded-2xl",children:e.jsx(K,{className:"p-0",children:Ge?e.jsxs("div",{className:"p-4 grid gap-3",children:[e.jsx(_,{}),e.jsx(_,{}),e.jsx(_,{})]}):Je?e.jsxs("div",{className:"mx-4 my-4 rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:[e.jsx("p",{className:"font-semibold",children:"Impossible de charger les performances"}),e.jsx("p",{className:"mt-1 text-xs",children:te.error instanceof Error?te.error.message:"Vérifiez votre connexion internet et réessayez."})]}):D.length===0?e.jsx("div",{className:"px-4 py-6 text-sm text-muted-foreground",children:F?'Aucune performance trouvée. Cliquez sur "Importer" pour récupérer vos données FFN.':"Ajoutez votre IUF FFN dans votre profil pour commencer."}):e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"px-3 sm:px-4 py-2 text-[11px] text-muted-foreground border-b border-border",children:e.jsxs("div",{className:"grid items-center gap-2 grid-cols-[minmax(0,1fr)_3.75rem_2.75rem_3.75rem] sm:grid-cols-[minmax(0,1fr)_4.75rem_3.75rem_4.75rem]",children:[e.jsx("div",{className:"truncate justify-self-start",children:"Épreuve"}),e.jsx("div",{className:"whitespace-nowrap justify-self-end",children:"Temps"}),e.jsx("div",{className:"whitespace-nowrap justify-self-end",children:"Pts"}),e.jsx("div",{className:"whitespace-nowrap justify-self-end",children:"Date"})]})}),e.jsx("div",{className:"divide-y divide-border",children:D.map(s=>e.jsxs("div",{className:"px-3 sm:px-4 py-3",children:[e.jsxs("div",{className:"grid items-center gap-2 grid-cols-[minmax(0,1fr)_3.75rem_2.75rem_3.75rem] sm:grid-cols-[minmax(0,1fr)_4.75rem_3.75rem_4.75rem]",children:[e.jsx("div",{className:"min-w-0 justify-self-start",children:e.jsx("div",{className:"text-sm font-semibold truncate",children:s.event_code})}),e.jsx("div",{className:"justify-self-end text-sm font-semibold tabular-nums whitespace-nowrap overflow-hidden font-mono",children:s.time_display??J(s.time_seconds)}),e.jsx("div",{className:"justify-self-end text-sm tabular-nums text-muted-foreground whitespace-nowrap overflow-hidden",children:s.ffn_points!=null?String(s.ffn_points):"—"}),e.jsx("div",{className:"justify-self-end text-sm tabular-nums text-muted-foreground whitespace-nowrap overflow-hidden",children:G(s.competition_date)})]}),s.competition_name?e.jsx("div",{className:"mt-1 text-xs text-muted-foreground truncate",children:s.competition_name}):null]},s.id))})]})})})]}):null,e.jsx("div",{className:"h-10"})]}),e.jsxs(Re,{value:"1rm",className:"mt-0",children:[e.jsx("div",{className:"mt-5 mb-2 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted/50 border border-border flex items-center justify-center",children:e.jsx(Fe,{className:"h-5 w-5"})}),e.jsx("div",{className:"text-sm font-semibold",children:"1RM musculation"})]})}),e.jsx(A,{className:"w-full min-w-0 overflow-x-auto rounded-2xl",children:e.jsxs(K,{className:"p-0",children:[es||rs?e.jsxs("div",{className:"p-4 grid gap-3",children:[e.jsx(_,{}),e.jsx(_,{}),e.jsx(_,{})]}):ss||ns?e.jsx("div",{className:"p-4 text-sm text-muted-foreground",children:"Impossible de charger les records musculation."}):e.jsx(P.div,{className:"divide-y divide-border motion-reduce:animate-none",variants:qe,initial:"hidden",animate:"visible",children:ts?.filter(s=>s.exercise_type!=="warmup").map(s=>{const t=Ze?.find(d=>d.exercise_id===s.id),o=Number(t?.weight??0),m=o>0?`${o} kg`:"—",u=t?.recorded_at??t?.date??null,p=t?.notes??null,N=Qe===s.id,w=Oe===s.id,y=Ue===s.id;return e.jsxs(P.div,{className:"px-3 sm:px-4 py-3 motion-reduce:animate-none",variants:$e,children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"text-sm font-semibold truncate",children:s.nom_exercice}),e.jsx("button",{type:"button",onClick:()=>{y?(U(null),$("")):(U(s.id),$(p??""))},className:I("inline-flex items-center justify-center h-6 w-6 rounded-lg shrink-0",p?"text-primary hover:text-primary/80":"text-muted-foreground/50 hover:text-muted-foreground"),"aria-label":"Notes",title:p?"Modifier la note":"Ajouter une note",children:e.jsx(Ms,{className:"h-3.5 w-3.5"})})]}),e.jsx("div",{className:"mt-0.5 text-xs text-muted-foreground tabular-nums",children:G(u)}),p&&!y?e.jsx("div",{className:"mt-1 text-xs italic text-muted-foreground truncate max-w-[200px]",children:p}):null]}),e.jsx("div",{className:"text-right shrink-0 flex items-start gap-1",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold tabular-nums whitespace-nowrap font-mono",children:m}),N?null:e.jsxs("div",{className:"flex items-center justify-end gap-1 mt-1",children:[o>0?e.jsxs("button",{type:"button",onClick:()=>Be(w?null:s.id),className:"inline-flex items-center gap-0.5 text-xs text-muted-foreground hover:text-foreground","aria-label":"Table des pourcentages",title:"Table des pourcentages",children:[e.jsx(Ts,{className:I("h-3.5 w-3.5 transition-transform",w&&"rotate-180")}),"%"]}):null,e.jsxs("button",{type:"button",onClick:()=>xs(s.id,t?.weight??null),className:"inline-flex items-center gap-1 text-xs text-muted-foreground hover:text-foreground",children:[e.jsx(ze,{className:"h-3.5 w-3.5"}),"Modifier"]})]})]})})]}),N?e.jsx("div",{className:"mt-3",children:e.jsx(qs,{value:Ve,placeholder:"Ex: 100",inputMode:"decimal",hint:"Charge max (kg).",onCancel:we,onSave:d=>ps(s.id,d)})}):null,y?e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"w-full",children:[e.jsx(ie,{value:me,onChange:d=>$(d.target.value),placeholder:"Ex: Machine n°3, cran 5, poignée large...",rows:2,className:"rounded-xl text-sm",autoFocus:!0}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-2",children:[e.jsx(v,{type:"button",size:"sm",variant:"outline",onClick:()=>{U(null),$("")},className:"rounded-xl h-9 w-9 p-0","aria-label":"Annuler",children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsx(v,{type:"button",size:"sm",onClick:()=>{const d=me.trim()||null;ve.mutate({exercise_id:s.id,notes:d}),U(null),$("")},disabled:ve.isPending,className:"rounded-xl h-9 w-9 p-0","aria-label":"Enregistrer la note",children:e.jsx(oe,{className:"h-4 w-4"})})]})]})}):null,w&&o>0?e.jsxs("div",{className:"mt-3 rounded-xl bg-muted/30 border border-border p-3",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Table des pourcentages"}),e.jsx("div",{className:"grid grid-cols-5 gap-2 text-center text-xs",children:[50,60,70,80,90].map(d=>e.jsxs("div",{children:[e.jsxs("div",{className:"text-muted-foreground",children:[d,"%"]}),e.jsxs("div",{className:"font-semibold tabular-nums",children:[Math.round(o*d/10)/10," kg"]})]},d))})]}):null]},s.id)})}),je.isPending?e.jsxs("div",{className:"px-4 pb-4 text-xs text-muted-foreground flex items-center gap-2",children:[e.jsx(ke,{className:"h-3 w-3 animate-spin"})," Mise à jour..."]}):null]})}),e.jsx("div",{className:"h-10"})]})]})}),e.jsx("div",{className:"pb-10"})]})}):e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg",children:[e.jsx("div",{className:"sticky top-0 z-20 scroll-mt-16 backdrop-blur bg-background/80 border-b border-border",children:e.jsxs("div",{className:"px-4 pt-4 pb-3",children:[e.jsx("div",{className:"text-xl font-semibold tracking-tight",children:"Records"}),e.jsx("div",{className:"mt-0.5 text-sm text-muted-foreground",children:"Natation & 1RM musculation"})]})}),e.jsx("div",{className:"px-4 pt-4 pb-10",children:e.jsx(A,{className:"rounded-2xl",children:e.jsx(K,{className:"pt-6 text-sm text-muted-foreground",children:"Cette page est réservée aux nageurs."})})})]})})}export{at as default};
