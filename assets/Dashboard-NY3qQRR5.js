import{r as c,j as e,R as Me}from"./vendor-ui-M0btmmZ9.js";import{b as jt,u as Xe,c as _e}from"./vendor-query-CwV3kFk7.js";import{c as ue,b as Lt,X as $e,W as Ge,F as Nt,d as re,u as It,f as Pt,s as Be,B as Kt}from"./index-Dd2k2fWK.js";import{C as Rt}from"./chevron-left-C855OS8C.js";import{C as Pe}from"./chevron-right-DtloH5-Z.js";import{C as Ee}from"./circle-hIpm4byI.js";import{A as Oe,B as Tt,I as rt}from"./BottomActionBar-Czzn3f18.js";import{a as Bt,s as qt,l as ot}from"./animations-CrcLFysI.js";import{d as it}from"./design-tokens-CKgCpdH6.js";import{T as Le}from"./timer-BJPodKWl.js";import{P as pe}from"./plus-BF7W0fcu.js";import{T as Ne,P as zt}from"./trash-2-dUexeVPa.js";import{m as de}from"./proxy-C_NwhSmp.js";import{C as Ze}from"./check-myxeqXmH.js";import{C as Qt}from"./circle-alert-Bd79sf9b.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-D_WtzBoI.js";import"./vendor-supabase-B7dJFgIA.js";import"./loader-circle-BoI_5Q4u.js";import"./circle-check-CqpcYGy1.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],et=ue("activity",Jt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],tt=ue("hash",Yt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=[["path",{d:"M5 12h14",key:"1ays0h"}]],vt=ue("minus",Ht);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],wt=ue("moon",Vt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],Ut=ue("power",Wt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],at=ue("settings-2",Xt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Zt=ue("sun",Gt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],lt=ue("user-check",es);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],De=ue("user-x",ts),qe={NL:"",DOS:"",BR:"",PAP:"",QN:""};function ct(t){return String(t).padStart(2,"0")}function dt(t){return`${t.getFullYear()}-${ct(t.getMonth()+1)}-${ct(t.getDate())}`}function ut(t){return new Date(t.getFullYear(),t.getMonth(),1)}function mt(t,s){const n=new Date(t);return n.setDate(n.getDate()+s),n}function ze(t){return(t.getDay()+6)%7}function Ce(t){const s=Number(t);return Number.isFinite(s)?Math.round(s/1e3*100)/100:0}function ss(t){const s=Number(t);return Number.isFinite(s)?Math.round(s*1e3):0}function ns(t){return t?String(t).replaceAll(`\r
`,`
`).split(`
`).map(n=>n.trim()).filter(Boolean).flatMap(n=>{const r=n.replace(/^[•\\-–—]\\s*/,"").trim();return r?[r]:[]}):[]}function rs(t){if(!t)return null;const n=String(t).match(/(\\d+(?:[\\.,]\\d+)?)\\s*(km|m)\\b/i);if(!n)return null;const r=Number(String(n[1]).replace(",","."));return Number.isFinite(r)?n[2].toLowerCase()==="m"?Ce(r):r:null}function os(t,s){const n=t?.slot??t?.session_slot??t?.assigned_slot??t?.time_slot??t?.timeOfDay??t?.slot_key??t?.slotKey,r=String(n||"").toLowerCase();if(r.includes("mat")||r.includes("morning")||r==="am")return"AM";if(r.includes("soir")||r.includes("evening")||r==="pm")return"PM";const u=`${t?.title??""} ${t?.description??""}`.toLowerCase();return u.includes("matin")||u.includes(" am ")||u.includes("(am)")?"AM":u.includes("soir")||u.includes(" pm ")||u.includes("(pm)")?"PM":s===0?"AM":"PM"}function is(t){const s=t?.assigned_date??t?.date??t?.day??t?.scheduled_for??t?.scheduledAt??null;if(!s)return null;const n=String(s),r=n.length>=10?n.slice(0,10):n;return/\d{4}-\d{2}-\d{2}/.test(r)?r:null}function as(t){if(Array.isArray(t?.items)){let u=0;for(const i of t.items){const b=Number(i?.distance);if(!Number.isFinite(b)||b<=0)continue;const a=i?.raw_payload,f=Number(a?.exercise_repetitions),g=Number(a?.block_repetitions),N=Number.isFinite(f)&&f>0?f:1,k=Number.isFinite(g)&&g>0?g:1;u+=b*N*k}if(u>0)return Ce(u)}const s=t?.distance_meters??t?.distanceMeters??t?.meters??t?.planned_meters??t?.plannedMeters??t?.distance??null;if(s!=null&&Number.isFinite(Number(s))){const u=Number(s);return u>0&&u<=50?u:Ce(u)}const n=t?.km??t?.distance_km??t?.distanceKm??t?.planned_km??t?.plannedKm??null;if(n!=null&&Number.isFinite(Number(n)))return Number(n);const r=rs(`${t?.title??""} ${t?.description??""}`);return r??null}function ls(t){if(!Array.isArray(t)||t.length===0)return null;const s={crawl:"NL",dos:"DOS",brasse:"BR",pap:"PAP","4n":"QN"},n={NL:0,DOS:0,BR:0,PAP:0,QN:0};for(const u of t){const i=Number(u?.distance);if(!Number.isFinite(i)||i<=0)continue;const b=u?.raw_payload,a=Number(b?.exercise_repetitions),f=Number(b?.block_repetitions),g=Number.isFinite(a)&&a>0?a:1,N=Number.isFinite(f)&&f>0?f:1,k=i*g*N,E=b?.exercise_stroke??b?.stroke??"crawl",P=s[String(E).toLowerCase()];P?n[P]+=k:n.NL+=k}return Object.values(n).some(u=>u>0)?n:null}function xt(t){const s=Number(t);if(!Number.isFinite(s))return"—";const n=Math.round(s*100)/100,r=String(n);return r.endsWith(".0")?r.slice(0,-2):r}function cs(){const t={};for(let s=0;s<7;s++)t[s]={AM:!0,PM:!0};return t}function Qe(t){if(!t)return null;try{return JSON.parse(t)}catch{return null}}function ds({sessions:t,assignments:s,userId:n,user:r}){const u=`swim-dashboard-v2:${n??r??"anon"}`,i=`${u}:presenceDefaults`,b=`${u}:attendanceOverrides`,a=`${u}:stableFields`,[f,g]=c.useState(()=>cs()),[N,k]=c.useState({}),[E,P]=c.useState(90);c.useEffect(()=>{if(typeof window>"u")return;const d=Qe(window.localStorage.getItem(i));d&&g(d);const p=Qe(window.localStorage.getItem(b));p&&k(p);const m=Qe(window.localStorage.getItem(a));m?.duration&&Number.isFinite(m.duration)&&m.duration>=30&&m.duration<=240&&P(m.duration)},[i,b,a]),c.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(i,JSON.stringify(f))},[f,i]),c.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(b,JSON.stringify(N))},[N,b]),c.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(a,JSON.stringify({duration:E}))},[E,a]);const h=c.useMemo(()=>new Date,[]),[y,v]=c.useState(()=>ut(new Date)),[l,j]=c.useState(()=>dt(new Date)),[A,D]=c.useState(!1),[$,Q]=c.useState(!1),[be,O]=c.useState(!1),[C,B]=c.useState(null),[K,G]=c.useState(!1),[z,oe]=c.useState(null),[R,me]=c.useState(!1),[L,V]=c.useTransition(),te=c.useMemo(()=>(Array.isArray(s)?s:[]).filter(p=>p?.session_type==="swim"),[s]),ie=c.useMemo(()=>{const d=new Map;for(const p of te){const m=is(p);m&&(d.has(m)||d.set(m,[]),d.get(m).push(p))}for(const[p,m]of d.entries())m.sort((S,M)=>Number(S?.id??0)-Number(M?.id??0)),d.set(p,m);return d},[te]),F=c.useMemo(()=>{const d=Array.isArray(t)?t:[],p={};for(const m of d){const S=String(m?.date??"").slice(0,10),M=m?.slot==="Soir"?"PM":"AM";p[`${S}__${M}`]=m}return p},[t]),ae=c.useRef(new Map);c.useEffect(()=>{ae.current.clear()},[ie]);const le=c.useCallback(d=>{const p=ae.current;if(p.has(d))return p.get(d);const m=[{id:`${d}__AM`,iso:d,slotKey:"AM",title:"Séance vide",km:null,details:[],isEmpty:!0},{id:`${d}__PM`,iso:d,slotKey:"PM",title:"Séance vide",km:null,details:[],isEmpty:!0}],S=ie.get(d)??[],M=new Set;return S.forEach((_,q)=>{const H=_,se=os(H,q);if(M.has(se))return;const ne=se==="AM"?0:1,fe=as(H),Ke=Array.isArray(H?.details)?H.details.map(String):ns(_?.description);m[ne]={id:`${d}__${se}`,iso:d,slotKey:se,title:String(_?.title??"Séance coach"),km:fe,details:Ke,assignmentId:typeof _?.id=="number"?_.id:Number(_?.id)||void 0,isEmpty:!1},M.add(se)}),p.set(d,m),m},[ie]),ce=c.useCallback((d,p)=>{const m=ze(p),S=!!f?.[m]?.[d.slotKey],M=N[d.id];return M==="present"?{status:"present",expected:!0,expectedByDefault:S}:M==="absent"?{status:"absent",expected:!0,expectedByDefault:S}:S?{status:"present",expected:!0,expectedByDefault:S}:{status:"not_expected",expected:!1,expectedByDefault:S}},[N,f]),Z=c.useMemo(()=>ut(y),[y]),ge=c.useMemo(()=>{const d=ze(Z),p=mt(Z,-d),m=[];for(let S=0;S<42;S++)m.push(mt(p,S));return m},[Z]),ve=c.useMemo(()=>{const d={};for(const p of ge){const m=dt(p),S=le(m);let M=0,_=0;const q=[];for(const H of S){const se=ce(H,p);if(!se.expected){q.push({slotKey:H.slotKey,expected:!1,completed:!1,absent:!1});continue}M+=1;const ne=!!F[H.id],fe=se.status==="absent";ne&&(_+=1),q.push({slotKey:H.slotKey,expected:!0,completed:ne,absent:fe})}d[m]={completed:_,total:M,slots:q}}return d},[ge,le,ce,F]),we=c.useMemo(()=>{const[d,p,m]=l.split("-").map(Number);return new Date(d,p-1,m)},[l]),W=c.useMemo(()=>le(l),[le,l]),U=ve[l]||{completed:0,total:2,slots:[{slotKey:"AM",expected:!0,completed:!1,absent:!1},{slotKey:"PM",expected:!0,completed:!1,absent:!1}]},he=c.useMemo(()=>{const d=Array.isArray(t)?t:[];let p=0;for(const m of d){const S=String(m?.date??"").slice(0,10),M=m?.slot==="Soir"?"PM":"AM",_=`${S}__${M}`;if(N[_]==="absent")continue;const q=ze(new Date(S));(f?.[q]?.[M]||N[_]==="present")&&Number.isFinite(Number(m?.distance))&&(p+=Number(m.distance))}return xt(Ce(p))},[t,N,f]),ye=c.useMemo(()=>{const d=W;let p=0;for(const m of d){const S=ce(m,we);if(!S.expected||S.status==="absent")continue;const M=F[m.id];M&&Number.isFinite(Number(M?.distance))&&(p+=Number(M.distance))}return xt(Ce(p))},[W,ce,we,F]),je=c.useMemo(()=>C&&F[C]||null,[C,F]),ee=c.useMemo(()=>{const d=je||{},p=d?.stroke_distances,m=p?{NL:p.NL?String(p.NL):"",DOS:p.DOS?String(p.DOS):"",BR:p.BR?String(p.BR):"",PAP:p.PAP?String(p.PAP):"",QN:p.QN?String(p.QN):""}:qe;return{difficulty:d?.effort??null,fatigue_end:d?.fatigue??d?.feeling??null,performance:d?.performance??d?.feeling??null,engagement:d?.engagement??d?.feeling??null,comment:String(d?.comments??""),distanceMeters:Number.isFinite(Number(d?.distance))?Number(d.distance):null,showStrokeDetail:!!(p&&Object.values(p).some(S=>S&&S>0)),strokes:m,exerciseLogs:[]}},[je]),[X,J]=c.useState(()=>({difficulty:null,fatigue_end:null,performance:null,engagement:null,comment:"",distanceMeters:null,showStrokeDetail:!1,strokes:qe,exerciseLogs:[]}));return c.useEffect(()=>{const d=W.find(p=>p.id===C);if(d){const p=ss(d.km??0);let m=qe;if(d.assignmentId){const M=(s??[]).find(_=>_.id===d.assignmentId);if(M?.items){const _=ls(M.items);_&&(m={NL:String(_.NL||""),DOS:String(_.DOS||""),BR:String(_.BR||""),PAP:String(_.PAP||""),QN:String(_.QN||"")})}}const S=Object.values(ee.strokes).some(M=>M&&Number(M)>0);J(M=>({...M,...ee,distanceMeters:ee.distanceMeters==null?p:ee.distanceMeters,strokes:S?ee.strokes:m,showStrokeDetail:S||Object.values(m).some(_=>_&&Number(_)>0)}));return}J(p=>({...p,...ee}))},[ee,C,W,s]),c.useEffect(()=>{A&&R&&U.total>0&&U.completed>=U.total&&(D(!1),B(null),G(!1),me(!1))},[A,R,U.completed,U.total]),{today:h,monthCursor:y,selectedISO:l,drawerOpen:A,settingsOpen:$,infoOpen:be,activeSessionId:C,detailsOpen:K,selectedDayIndex:z,isPending:L,presenceDefaults:f,attendanceOverrideBySessionId:N,stableDurationMin:E,draftState:X,gridDates:ge,completionByISO:ve,selectedDate:we,sessionsForSelectedDay:W,selectedDayStatus:U,globalKm:he,dayKm:ye,logsBySessionId:F,setMonthCursor:v,setSelectedISO:j,setDrawerOpen:D,setSettingsOpen:Q,setInfoOpen:O,setActiveSessionId:B,setDetailsOpen:G,setSelectedDayIndex:oe,setPresenceDefaults:g,setAttendanceOverrideBySessionId:k,setStableDurationMin:P,setDraftState:J,setAutoCloseArmed:me,startTransition:V,getSessionStatus:ce,getSessionsForISO:le}}function kt(...t){return t.filter(Boolean).join(" ")}function us(t){return t.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})}function Je({onClick:t,label:s,children:n,tone:r="neutral",disabled:u}){const i={neutral:"bg-background border-border text-foreground hover:bg-muted",dark:"bg-foreground border-foreground text-background hover:opacity-90",sky:"bg-primary/10 border-primary/30 text-primary hover:bg-primary/20"};return e.jsxs("button",{type:"button",onClick:t,disabled:u,className:kt("inline-flex items-center justify-center rounded-2xl border p-2 transition",i[r],u&&"opacity-50 cursor-not-allowed hover:bg-background"),"aria-label":s,title:s,children:[n,e.jsx("span",{className:"sr-only",children:s})]})}function ms({monthCursor:t,selectedDayStatus:s,onPrevMonth:n,onNextMonth:r,onJumpToday:u}){return e.jsxs("div",{className:"flex items-center justify-between px-3 sm:px-5 py-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Je,{onClick:n,label:"Mois précédent",children:e.jsx(Rt,{className:"h-5 w-5"})}),e.jsx(Je,{onClick:r,label:"Mois suivant",children:e.jsx(Pe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"min-w-0 text-center",children:[e.jsx("div",{className:"text-base font-semibold text-foreground capitalize truncate",children:us(t)}),e.jsx("div",{className:"mt-1 flex items-center justify-center gap-1",children:s.total>0?s.slots.filter(i=>i.expected).map(i=>e.jsx("span",{className:kt("h-1.5 w-1.5 rounded-full",i.completed?"bg-status-success":i.absent?"bg-muted-foreground/15":"bg-muted-foreground/30")},i.slotKey)):e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"repos"})})]}),e.jsx(Je,{onClick:u,label:"Aller à aujourd'hui",tone:"neutral",children:e.jsx(Ee,{className:"h-5 w-5"})})]})}function Ye(...t){return t.filter(Boolean).join(" ")}function xs(t){const s=n=>String(n).padStart(2,"0");return`${t.getFullYear()}-${s(t.getMonth()+1)}-${s(t.getDate())}`}const ps=c.memo(function({date:s,inMonth:n,isToday:r,isSelected:u,isFocused:i,status:b,onClick:a,onKeyDown:f}){const{total:g,slots:N}=b,k=g===0,E=N.filter(Q=>Q.expected),P=E.length>0&&E.every(Q=>Q.absent),h=g>0&&b.completed===g&&!P,y=k?"bg-muted/30":h?"bg-status-success/10":"bg-card",v="border-border",l=u?"ring-2 ring-primary/30":"",j=r&&!u?"ring-2 ring-primary/50":"",A=i?"ring-2 ring-primary":"",D=N.find(Q=>Q.slotKey==="AM"),$=N.find(Q=>Q.slotKey==="PM");return e.jsx("button",{type:"button",onClick:a,onKeyDown:f,tabIndex:i?0:-1,"data-calendar-cell":"true",className:Ye("aspect-square min-w-0 rounded-2xl border p-1 transition",y,v,!n&&"opacity-40","hover:shadow-sm focus:outline-none",l,j,A),"aria-label":`${xs(s)} — ${k?"Repos":`${b.completed}/${g}`}`,children:e.jsxs("div",{className:"flex h-full flex-col justify-between",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:"text-[12px] font-semibold text-foreground",children:s.getDate()}),e.jsx("div",{className:"h-[14px] w-[14px]"})]}),e.jsx("div",{className:"flex items-center justify-end",children:k?e.jsx(wt,{className:"h-3 w-3 text-muted-foreground/40"}):e.jsx("div",{className:"w-6",children:e.jsxs("div",{className:"flex gap-1",children:[D?.expected?e.jsx("span",{className:Ye("h-1.5 flex-1 rounded-full",D.completed?"bg-status-success":D.absent?"bg-muted-foreground/15":"bg-muted-foreground/30")}):e.jsx("span",{className:"flex-1"}),$?.expected?e.jsx("span",{className:Ye("h-1.5 flex-1 rounded-full",$.completed?"bg-status-success":$.absent?"bg-muted-foreground/15":"bg-muted-foreground/30")}):e.jsx("span",{className:"flex-1"})]})})})]})})}),fs=["L","M","M","J","V","S","D"],bs=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"];function gs(t){const s=n=>String(n).padStart(2,"0");return`${t.getFullYear()}-${s(t.getMonth()+1)}-${s(t.getDate())}`}function hs(t,s){return t.getFullYear()===s.getFullYear()&&t.getMonth()===s.getMonth()&&t.getDate()===s.getDate()}function ys({monthCursor:t,gridDates:s,completionByISO:n,selectedISO:r,selectedDayIndex:u,today:i,onDayClick:b,onKeyDown:a}){return e.jsx("div",{className:"p-3 sm:p-5",children:e.jsxs("div",{className:"grid grid-cols-7 gap-1.5 sm:gap-2",children:[fs.map((f,g)=>e.jsxs("div",{className:"px-0.5 pb-1 text-[10px] font-semibold text-muted-foreground text-center",children:[e.jsx("span",{className:"sm:hidden",children:f}),e.jsx("span",{className:"hidden sm:inline",children:bs[g]})]},f+g)),s.map((f,g)=>{const N=gs(f),k=f.getMonth()===t.getMonth(),E=N===r,P=n[N]||{completed:0,total:2,slots:[{slotKey:"AM",expected:!0,completed:!1,absent:!1},{slotKey:"PM",expected:!0,completed:!1,absent:!1}]},h=hs(f,i),y=u===g||u===null&&h;return e.jsx(ps,{date:f,inMonth:k,isToday:h,isSelected:E,isFocused:y,status:P,onClick:()=>b(N),onKeyDown:v=>a(v,g)},N)})]})})}function He(...t){return t.filter(Boolean).join(" ")}const pt={NL:"NL",DOS:"Dos",BR:"Brasse",PAP:"Pap",QN:"4N"};function js({strokes:t,showStrokeDetail:s,disabled:n=!1,onToggle:r,onChange:u}){return e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{type:"button",disabled:n,onClick:r,className:He("flex w-full items-center justify-between rounded-2xl border px-3 py-2 text-sm font-semibold transition",n?"text-muted-foreground border-border cursor-not-allowed":"text-foreground border-border hover:bg-muted"),children:[e.jsx("span",{children:"Détail par nage"}),e.jsx(Pe,{className:He("h-4 w-4 transition-transform",s&&"rotate-90")})]}),s&&e.jsx("div",{className:"mt-2 grid grid-cols-5 gap-2",children:Object.keys(pt).map(i=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-center text-xs font-medium text-muted-foreground",children:pt[i]}),e.jsx("input",{type:"number",inputMode:"numeric",min:0,step:100,disabled:n,value:t[i],onChange:b=>u({...t,[i]:b.target.value}),placeholder:"0",className:He("w-full rounded-xl border px-1 py-2 text-center text-sm outline-none",n?"bg-muted text-muted-foreground":"bg-card text-foreground border-border focus:ring-2 focus:ring-foreground/10")}),e.jsx("div",{className:"text-center text-[10px] text-muted-foreground",children:"m"})]},i))})]})}function Ve(...t){return t.filter(Boolean).join(" ")}function Ns({exerciseLogs:t,assignmentItems:s,disabled:n=!1,onLogsChange:r}){const[u,i]=c.useState(t.length>0),[b,a]=c.useState(""),f=h=>{const y=h.label||`Exercice ${h.ordre??""}`;t.some(v=>v.source_item_id===h.id)||r([...t,{exercise_label:y,source_item_id:h.id??null,split_times:[],tempo:null,stroke_count:[],notes:null}])},g=()=>{const h=b.trim();h&&(r([...t,{exercise_label:h,source_item_id:null,split_times:[],tempo:null,stroke_count:[],notes:null}]),a(""))},N=h=>{r(t.filter((y,v)=>v!==h))},k=(h,y)=>{r(t.map((v,l)=>l===h?{...v,...y}:v))},P=(Array.isArray(s)?s:[]).filter(h=>h.id!=null&&!t.some(y=>y.source_item_id===h.id));return e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{type:"button",disabled:n,onClick:()=>i(h=>!h),className:Ve("flex w-full items-center justify-between rounded-2xl border px-3 py-2 text-sm font-semibold transition",n?"text-muted-foreground border-border cursor-not-allowed":"text-foreground border-border hover:bg-muted"),children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4"}),"Notes techniques",t.length>0&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-primary/10 px-1.5 py-0.5 text-xs font-semibold text-primary",children:t.length})]}),e.jsx(Pe,{className:Ve("h-4 w-4 transition-transform",u&&"rotate-90")})]}),u&&!n&&e.jsxs("div",{className:"mt-2 space-y-3",children:[P.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Exercices de la seance"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:P.map(h=>e.jsxs("button",{type:"button",onClick:()=>f(h),className:"inline-flex items-center gap-1 rounded-full border border-border bg-card px-2.5 py-1 text-xs font-medium text-foreground hover:bg-muted transition",children:[e.jsx(pe,{className:"h-3 w-3"}),h.label||`Ex. ${h.ordre??""}`]},h.id))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:b,onChange:h=>a(h.target.value),onKeyDown:h=>{h.key==="Enter"&&(h.preventDefault(),g())},placeholder:"Exercice libre (ex: 4x50 max)",className:"flex-1 rounded-xl border border-border bg-card px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-foreground/10"}),e.jsx("button",{type:"button",onClick:g,disabled:!b.trim(),className:Ve("rounded-xl border px-3 py-2 text-sm font-semibold transition",b.trim()?"bg-card text-foreground border-border hover:bg-muted":"bg-muted text-muted-foreground border-border cursor-not-allowed"),children:e.jsx(pe,{className:"h-4 w-4"})})]}),t.map((h,y)=>e.jsx(vs,{log:h,onUpdate:v=>k(y,v),onRemove:()=>N(y)},y))]})]})}function vs({log:t,onUpdate:s,onRemove:n}){const[r,u]=c.useState((t.split_times?.length??0)>0),[i,b]=c.useState((t.stroke_count?.length??0)>0),a=t.split_times??[],f=t.stroke_count??[],g=()=>{s({split_times:[...a,{rep:a.length+1,time_seconds:0}]}),u(!0)},N=(y,v)=>{s({split_times:a.map((l,j)=>j===y?{...l,time_seconds:v}:l)})},k=y=>{const v=a.filter((l,j)=>j!==y).map((l,j)=>({...l,rep:j+1}));s({split_times:v}),v.length===0&&u(!1)},E=()=>{s({stroke_count:[...f,{rep:f.length+1,count:0}]}),b(!0)},P=(y,v)=>{s({stroke_count:f.map((l,j)=>j===y?{...l,count:v}:l)})},h=y=>{const v=f.filter((l,j)=>j!==y).map((l,j)=>({...l,rep:j+1}));s({stroke_count:v}),v.length===0&&b(!1)};return e.jsxs("div",{className:"rounded-2xl border border-border bg-card overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-border bg-muted/50",children:[e.jsx("span",{className:"text-sm font-semibold text-foreground truncate",children:t.exercise_label}),e.jsx("button",{type:"button",onClick:n,className:"p-1 rounded-lg text-muted-foreground hover:text-destructive hover:bg-destructive/10 transition","aria-label":"Supprimer",children:e.jsx(Ne,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground min-w-[80px]",children:[e.jsx(et,{className:"h-3.5 w-3.5"}),"Tempo"]}),e.jsx("input",{type:"number",inputMode:"decimal",step:"0.1",min:0,value:t.tempo??"",onChange:y=>s({tempo:y.target.value?Number(y.target.value):null}),placeholder:"coups/min",className:"w-24 rounded-xl border border-border bg-background px-2 py-1.5 text-sm text-center outline-none focus:ring-2 focus:ring-foreground/10"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(Le,{className:"h-3.5 w-3.5"}),"Temps"]}),e.jsxs("button",{type:"button",onClick:g,className:"inline-flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition",children:[e.jsx(pe,{className:"h-3 w-3"}),"Rep"]})]}),r&&a.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:a.map((y,v)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-4 text-right",children:y.rep}),e.jsx("input",{type:"number",inputMode:"decimal",step:"0.1",min:0,value:y.time_seconds||"",onChange:l=>N(v,Number(l.target.value)||0),placeholder:"sec",className:"w-16 rounded-lg border border-border bg-background px-1.5 py-1 text-xs text-center outline-none focus:ring-2 focus:ring-foreground/10"}),e.jsx("button",{type:"button",onClick:()=>k(v),className:"p-0.5 text-muted-foreground hover:text-destructive transition","aria-label":`Supprimer rep ${y.rep}`,children:e.jsx(Ne,{className:"h-3 w-3"})})]},v))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(tt,{className:"h-3.5 w-3.5"}),"Coups de bras"]}),e.jsxs("button",{type:"button",onClick:E,className:"inline-flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition",children:[e.jsx(pe,{className:"h-3 w-3"}),"Rep"]})]}),i&&f.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:f.map((y,v)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-4 text-right",children:y.rep}),e.jsx("input",{type:"number",inputMode:"numeric",min:0,value:y.count||"",onChange:l=>P(v,Number(l.target.value)||0),placeholder:"nb",className:"w-14 rounded-lg border border-border bg-background px-1.5 py-1 text-xs text-center outline-none focus:ring-2 focus:ring-foreground/10"}),e.jsx("button",{type:"button",onClick:()=>h(v),className:"p-0.5 text-muted-foreground hover:text-destructive transition","aria-label":`Supprimer rep ${y.rep}`,children:e.jsx(Ne,{className:"h-3 w-3"})})]},v))})]}),e.jsx("div",{children:e.jsx("textarea",{value:t.notes??"",onChange:y=>s({notes:y.target.value||null}),placeholder:"Notes libres...",rows:2,className:"w-full resize-none rounded-xl border border-border bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-foreground/10"})})]})]})}function T(...t){return t.filter(Boolean).join(" ")}function ws(t){return t.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}function Ie(t){const s=Number(t);if(!Number.isFinite(s))return"—";const n=Math.round(s*100)/100,r=String(n);return r.endsWith(".0")?r.slice(0,-2):r}function ft(t){const s=Number(t);return Number.isFinite(s)?Math.round(s/1e3*100)/100:0}function ks(t){const s=Number(t);return Number.isFinite(s)?Math.round(s*1e3):0}const We=[{key:"difficulty",label:"Difficulté",mode:"hard"},{key:"fatigue_end",label:"Fatigue fin",mode:"hard"},{key:"performance",label:"Perf perçue",mode:"good"},{key:"engagement",label:"Engagement",mode:"good"}],Ss=[{key:"AM",label:"Matin",Icon:Zt},{key:"PM",label:"Soir",Icon:wt}];function Fe({children:t}){return e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-2 py-0.5 text-xs font-semibold text-muted-foreground",children:t})}function Se({onClick:t,label:s,children:n,tone:r="neutral",disabled:u}){const i={neutral:"bg-background border-border text-foreground hover:bg-muted",dark:"bg-foreground border-foreground text-background hover:opacity-90",sky:"bg-primary/10 border-primary/30 text-primary hover:bg-primary/20"};return e.jsxs("button",{type:"button",onClick:t,disabled:u,className:T("inline-flex items-center justify-center rounded-2xl border p-2 transition",i[r],u&&"opacity-50 cursor-not-allowed hover:bg-background"),"aria-label":s,title:s,children:[n,e.jsx("span",{className:"sr-only",children:s})]})}function Ms(t,s){const n=Number(s);return!Number.isFinite(n)||n<1||n>5?"neutral":t==="hard"?{1:"bg-intensity-1 border-intensity-1 text-white",2:"bg-intensity-2 border-intensity-2 text-white",3:"bg-intensity-3 border-intensity-3 text-white",4:"bg-intensity-4 border-intensity-4 text-white",5:"bg-intensity-5 border-intensity-5 text-white"}[n]:{1:"bg-intensity-5 border-intensity-5 text-white",2:"bg-intensity-4 border-intensity-4 text-white",3:"bg-intensity-3 border-intensity-3 text-white",4:"bg-intensity-2 border-intensity-2 text-white",5:"bg-intensity-1 border-intensity-1 text-white"}[n]}function _s({plannedMeters:t,valueMeters:s,onChange:n,disabled:r}){const a=Number.isFinite(Number(s))?Number(s):t,f=a-t;return e.jsxs("div",{className:T("mt-4 rounded-3xl border px-4 py-3",r?"bg-muted border-border":"bg-card border-border"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:T("text-xs font-semibold",r?"text-muted-foreground":"text-foreground"),children:"Ajuster kilométrage"}),f!==0&&e.jsx("div",{className:T("text-xs font-semibold px-2 py-0.5 rounded-full",f>0?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400"),children:f>0?`+${f}m`:`${f}m`})]}),e.jsx("div",{className:"text-center mb-3",children:e.jsxs("div",{className:T("text-xs","text-muted-foreground"),children:["Planifié : ",t,"m (",Ie(ft(t))," km)"]})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("button",{type:"button",disabled:r||a-100<0,onClick:()=>n(a-100),className:T("h-11 w-11 rounded-2xl border flex items-center justify-center transition-colors",r?"bg-muted border-border text-muted-foreground cursor-not-allowed":"bg-card border-border text-foreground hover:bg-muted active:scale-95"),"aria-label":"-100m",children:e.jsx(vt,{className:"h-5 w-5"})}),e.jsxs("div",{className:"min-w-[140px] text-center",children:[e.jsxs("div",{className:T("text-2xl font-bold",r?"text-muted-foreground":"text-foreground"),children:[a,"m"]}),e.jsxs("div",{className:T("text-sm font-medium mt-0.5",r?"text-muted-foreground":"text-primary"),children:[Ie(ft(a))," km"]})]}),e.jsx("button",{type:"button",disabled:r||a+100>3e4,onClick:()=>n(a+100),className:T("h-11 w-11 rounded-2xl border flex items-center justify-center transition-colors",r?"bg-muted border-border text-muted-foreground cursor-not-allowed":"bg-card border-border text-foreground hover:bg-muted active:scale-95"),"aria-label":"+100m",children:e.jsx(pe,{className:"h-5 w-5"})})]})]})}function Cs({open:t,selectedDate:s,sessionsForSelectedDay:n,selectedDayStatus:r,dayKm:u,activeSessionId:i,detailsOpen:b,draftState:a,saveState:f,isPending:g,logsBySessionId:N,assignmentItems:k,onClose:E,onDayOffAll:P,onOpenSession:h,onCloseSession:y,onToggleDetails:v,onMarkAbsent:l,onMarkPresent:j,onClearOverride:A,onSaveFeedback:D,onDraftStateChange:$,getSessionStatus:Q}){const[,be]=Lt(),O=c.useMemo(()=>i&&n.find(C=>C.id===i)||null,[i,n]);return e.jsx(Oe,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(de.div,{className:"fixed inset-0 z-overlay bg-black/30",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:E}),e.jsx(de.div,{className:T("fixed z-modal bg-background shadow-2xl","left-0 right-0 bottom-0 top-auto max-h-[calc(100dvh-env(safe-area-inset-top))] h-[88dvh] rounded-t-3xl","sm:right-0 sm:top-0 sm:left-auto sm:bottom-auto sm:h-full sm:w-full sm:max-w-xl sm:rounded-none"),variants:Bt,initial:"hidden",animate:"visible",exit:"exit",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"px-5 pt-3 sm:hidden",children:e.jsx("div",{className:"mx-auto h-1.5 w-12 rounded-full bg-muted"})}),e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b bg-background px-4 sm:px-5 py-3",children:[e.jsx("div",{className:"min-w-0",children:e.jsx("div",{className:"truncate text-base font-semibold text-foreground",children:ws(s)})}),e.jsx(Se,{onClick:E,label:"Fermer",children:e.jsx($e,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 sm:p-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-2xl border border-border bg-card flex items-center justify-center",children:e.jsx(Ge,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"text-sm font-semibold text-foreground",children:[u," km"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:T("h-1.5 w-1.5 rounded-full",r.total>0&&r.completed>=1?"bg-status-success":"bg-muted-foreground/30")}),e.jsx("span",{className:T("h-1.5 w-1.5 rounded-full",r.total>0&&r.completed>=2?"bg-status-success":"bg-muted-foreground/30")})]})]})]}),e.jsx(Se,{onClick:P,label:"OFF (absent journée)",tone:"dark",disabled:g,children:e.jsx(Ut,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"mt-4 grid gap-2",children:n.map(C=>{const B=Q(C,s),K=!!N[C.id],G=B.status==="absent",z=B.status==="not_expected",oe=G||z,R=B.expected&&!K&&!G,me=K?"bg-status-success-bg border-status-success/30":oe?"bg-sky-50 border-sky-200":R?"bg-status-warning-bg border-status-warning/30":"bg-card border-border",L=Ss.find(V=>V.key===C.slotKey)?.Icon||Ee;return e.jsx("button",{type:"button",onClick:()=>h(C.id),className:T("w-full rounded-3xl border px-3 py-3 text-left transition",me,"hover:shadow-sm"),children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:T("h-10 w-10 rounded-2xl border flex items-center justify-center",K?"border-status-success/30 bg-status-success-bg":oe?"border-sky-200 bg-sky-100":R?"border-status-warning/30 bg-status-warning-bg":"border-border bg-muted"),children:e.jsx(L,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:C.title}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[C.isEmpty?e.jsx(Fe,{children:"Vide"}):e.jsxs(Fe,{children:[Ie(C.km)," km"]}),K&&e.jsxs("span",{className:"inline-flex items-center text-emerald-800",children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Présent"})]}),oe&&!K&&e.jsxs("span",{className:"inline-flex items-center text-sky-800",children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Absent"})]}),R&&e.jsxs("span",{className:"inline-flex items-center text-orange-900",children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"En attente"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[z&&e.jsx(Se,{onClick:V=>{V.stopPropagation(),j(C.id)},label:"Je suis venu",disabled:g,children:e.jsx(lt,{className:"h-5 w-5"})}),B.expected&&!K&&!G&&e.jsx(Se,{onClick:V=>{V.stopPropagation(),l(C.id)},label:"Absent",tone:"sky",disabled:g,children:e.jsx(De,{className:"h-5 w-5"})})]})]})},C.id)})}),e.jsx(Oe,{children:O&&e.jsx(de.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:8},transition:{duration:it.normal},className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:(()=>{const C=Q(O,s),B=C.status==="absent",K=C.status==="not_expected",G=!!N[O.id],z=C.expected&&!B,oe=B?"Annuler":K?"Je suis venu":"Absent",R=B?()=>A(O.id):K?()=>j(O.id):()=>l(O.id),me=ks(O.km??0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:O.title}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[O.isEmpty?e.jsx(Fe,{children:"Vide"}):e.jsxs(Fe,{children:[Ie(O.km)," km"]}),G?e.jsxs("span",{className:"inline-flex items-center text-emerald-800",children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Présent"})]}):B||K?e.jsxs("span",{className:"inline-flex items-center text-sky-800",children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Absent"})]}):e.jsxs("span",{className:"inline-flex items-center text-orange-900",children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"En attente"})]})]})]}),e.jsx(Se,{onClick:y,label:"Retour",children:e.jsx($e,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 p-3",children:[e.jsxs("button",{type:"button",onClick:R,className:T("rounded-2xl px-3 py-3 text-sm font-semibold border transition inline-flex items-center justify-center gap-2",K?"bg-foreground text-background border-foreground hover:opacity-90":"bg-card text-foreground border-border hover:bg-muted"),children:[K?e.jsx(lt,{className:"h-4 w-4"}):e.jsx(De,{className:"h-4 w-4"}),oe]}),e.jsxs("button",{type:"button",onClick:v,className:"rounded-2xl px-3 py-3 text-sm font-semibold border border-border bg-card hover:bg-muted inline-flex items-center justify-center gap-2",children:[e.jsx(Nt,{className:"h-4 w-4"}),"Fiche"]})]}),e.jsx(Oe,{children:b&&e.jsxs(de.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:6},transition:{duration:it.normal},className:"mx-3 mb-3 rounded-2xl border border-border bg-muted p-3",children:[O.details?.length?e.jsx("ul",{className:"list-disc pl-5 space-y-1 text-sm text-foreground",children:O.details.map((L,V)=>e.jsx("li",{children:L},V))}):e.jsx("div",{className:"text-sm text-muted-foreground",children:O.assignmentId?"Séance coach — détails dans la fiche.":"Aucun détail pour ce créneau."}),O.assignmentId?e.jsx("div",{className:"mt-3",children:e.jsx("button",{type:"button",onClick:()=>be(`/swim-session?assignmentId=${O.assignmentId}`),className:"w-full rounded-2xl border border-border bg-card px-3 py-2 text-sm font-semibold text-foreground hover:bg-muted",children:"Ouvrir la fiche complète"})}):null]})}),e.jsxs("div",{className:"px-4 pb-4",children:[!z&&e.jsx("div",{className:"mb-3 rounded-2xl bg-sky-50 text-sky-900 px-3 py-2 text-xs",children:B?"Absent: aucun ressenti.":'Non prévu: appuyez "Je suis venu".'}),e.jsxs(de.div,{className:"space-y-4",variants:qt,initial:"hidden",animate:"visible",children:[We.map(L=>{const V=a[L.key];return e.jsxs(de.div,{className:"space-y-2",variants:ot,children:[e.jsx("div",{className:T("text-sm font-semibold",z?"text-foreground":"text-muted-foreground"),children:L.label}),e.jsx("div",{className:"flex items-center gap-2",children:[1,2,3,4,5].map(te=>{const ie=V===te;return e.jsx("button",{type:"button",disabled:!z,onClick:()=>$({...a,[L.key]:te}),className:T("h-11 w-11 rounded-2xl border text-sm font-semibold transition",z?ie?Ms(L.mode,te):"bg-card text-foreground border-border hover:bg-muted":"bg-muted text-muted-foreground border-border cursor-not-allowed"),children:te},te)})})]},L.key)}),e.jsxs(de.div,{className:"space-y-2",variants:ot,children:[e.jsx("div",{className:T("text-sm font-semibold",z?"text-foreground":"text-muted-foreground"),children:"Commentaire"}),e.jsx("textarea",{value:a.comment,onChange:L=>$({...a,comment:L.target.value}),disabled:!z,rows:3,placeholder:"Sensations, points techniques…",className:T("w-full resize-none rounded-3xl border px-4 py-3 text-sm outline-none",z?"bg-card text-foreground border-border focus:ring-2 focus:ring-foreground/10":"bg-muted text-muted-foreground border-border")})]})]}),e.jsx(_s,{plannedMeters:me,valueMeters:a.distanceMeters,onChange:L=>$({...a,distanceMeters:L}),disabled:!z}),e.jsx(js,{strokes:a.strokes,showStrokeDetail:a.showStrokeDetail,disabled:!z,onToggle:()=>$({...a,showStrokeDetail:!a.showStrokeDetail}),onChange:L=>$({...a,strokes:L})}),e.jsx(Ns,{exerciseLogs:a.exerciseLogs,assignmentItems:k,disabled:!z,onLogsChange:L=>$({...a,exerciseLogs:L})})]})]})})()},O.id)})]}),O&&(()=>{const C=Q(O,s),B=C.expected&&C.status!=="absent";return e.jsxs(Tt,{saveState:f,position:"static",children:[e.jsx("button",{type:"button",onClick:D,disabled:g||!B||!We.every(K=>Number.isInteger(a[K.key])),className:T("rounded-2xl px-4 py-3 text-sm font-semibold transition flex-1",g||!B?"bg-muted text-muted-foreground cursor-not-allowed":We.every(K=>Number.isInteger(a[K.key]))?"bg-status-success text-white hover:opacity-90":"bg-status-success-bg text-status-success cursor-not-allowed"),children:"Valider"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["→"," km"]})]})})()]})})]})})}function As(...t){return t.filter(Boolean).join(" ")}function Ds(t){try{return new Date(t).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short"})}catch{return t}}function Fs(t){if(!t||!Number.isFinite(t))return"—";if(t<60)return`${t.toFixed(1)}s`;const s=Math.floor(t/60),n=t%60;return`${s}:${n<10?"0":""}${n.toFixed(1)}`}function Es({userId:t,expanded:s,onToggle:n}){const r=jt(),{data:u,isLoading:i}=Xe({queryKey:["swim-exercise-logs-history",t],queryFn:()=>re.getSwimExerciseLogsHistory(t,100),enabled:!!t&&s}),b=_e({mutationFn:({logId:g,patch:N})=>re.updateSwimExerciseLog(g,N),onSuccess:()=>{r.invalidateQueries({queryKey:["swim-exercise-logs-history",t]})}}),a=_e({mutationFn:g=>re.deleteSwimExerciseLog(g),onSuccess:()=>{r.invalidateQueries({queryKey:["swim-exercise-logs-history",t]})}}),f=Me.useMemo(()=>{if(!u?.length)return[];const g=new Map;for(const N of u){const k=(N.created_at??"").slice(0,10);g.has(k)||g.set(k,[]),g.get(k).push(N)}return Array.from(g.entries()).map(([N,k])=>({date:N,entries:k}))},[u]);return e.jsxs("div",{className:"mt-6",children:[e.jsxs("button",{type:"button",onClick:n,className:"flex w-full items-center justify-between rounded-2xl border border-border px-3 py-2.5 text-sm font-semibold text-foreground hover:bg-muted transition",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Nt,{className:"h-4 w-4"}),"Historique notes techniques"]}),e.jsx(Pe,{className:As("h-4 w-4 transition-transform",s&&"rotate-90")})]}),s&&e.jsxs("div",{className:"mt-3 space-y-3",children:[i&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"Chargement..."}),!i&&f.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucune note technique enregistree."}),f.map(({date:g,entries:N})=>e.jsxs("div",{className:"rounded-2xl border border-border overflow-hidden",children:[e.jsx("div",{className:"bg-muted/50 px-3 py-2 text-xs font-semibold text-muted-foreground",children:Ds(g)}),e.jsx("div",{className:"divide-y divide-border",children:N.map(k=>e.jsx(Os,{log:k,onSave:E=>b.mutate({logId:k.id,patch:E}),onDelete:()=>a.mutate(k.id),saving:b.isPending},k.id))})]},g))]})]})}function Os({log:t,onSave:s,onDelete:n,saving:r}){const[u,i]=c.useState(!1),[b,a]=c.useState({notes:t.notes??"",tempo:t.tempo,split_times:t.split_times,stroke_count:t.stroke_count}),f=()=>{a({notes:t.notes??"",tempo:t.tempo,split_times:[...t.split_times],stroke_count:[...t.stroke_count]}),i(!0)},g=()=>i(!1),N=()=>{s({notes:b.notes.trim()||null,tempo:b.tempo,split_times:b.split_times,stroke_count:b.stroke_count}),i(!1)},k=()=>{a(l=>({...l,split_times:[...l.split_times,{rep:l.split_times.length+1,time_seconds:0}]}))},E=(l,j)=>{a(A=>({...A,split_times:A.split_times.map((D,$)=>$===l?{...D,time_seconds:j}:D)}))},P=l=>{a(j=>({...j,split_times:j.split_times.filter((A,D)=>D!==l).map((A,D)=>({...A,rep:D+1}))}))},h=()=>{a(l=>({...l,stroke_count:[...l.stroke_count,{rep:l.stroke_count.length+1,count:0}]}))},y=(l,j)=>{a(A=>({...A,stroke_count:A.stroke_count.map((D,$)=>$===l?{...D,count:j}:D)}))},v=l=>{a(j=>({...j,stroke_count:j.stroke_count.filter((A,D)=>D!==l).map((A,D)=>({...A,rep:D+1}))}))};return u?e.jsxs("div",{className:"px-3 py-2.5 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold text-foreground",children:t.exercise_label}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:N,disabled:r,className:"p-1.5 rounded-lg text-primary hover:bg-primary/10 transition","aria-label":"Enregistrer",children:e.jsx(Ze,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:g,className:"p-1.5 rounded-lg text-muted-foreground hover:bg-muted transition","aria-label":"Annuler",children:e.jsx($e,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:n,className:"p-1.5 rounded-lg text-muted-foreground hover:text-destructive hover:bg-destructive/10 transition","aria-label":"Supprimer",children:e.jsx(Ne,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground min-w-[80px]",children:[e.jsx(et,{className:"h-3.5 w-3.5"}),"Tempo"]}),e.jsx("input",{type:"number",inputMode:"decimal",step:"0.1",min:0,value:b.tempo??"",onChange:l=>a(j=>({...j,tempo:l.target.value?Number(l.target.value):null})),placeholder:"coups/min",className:"w-24 rounded-xl border border-border bg-background px-2 py-1.5 text-sm text-center outline-none focus:ring-2 focus:ring-foreground/10"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(Le,{className:"h-3.5 w-3.5"}),"Temps"]}),e.jsxs("button",{type:"button",onClick:k,className:"inline-flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition",children:[e.jsx(pe,{className:"h-3 w-3"}),"Rep"]})]}),b.split_times.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:b.split_times.map((l,j)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-4 text-right",children:l.rep}),e.jsx("input",{type:"number",inputMode:"decimal",step:"0.1",min:0,value:l.time_seconds||"",onChange:A=>E(j,Number(A.target.value)||0),placeholder:"sec",className:"w-16 rounded-lg border border-border bg-background px-1.5 py-1 text-xs text-center outline-none focus:ring-2 focus:ring-foreground/10"}),e.jsx("button",{type:"button",onClick:()=>P(j),className:"p-0.5 text-muted-foreground hover:text-destructive transition",children:e.jsx(Ne,{className:"h-3 w-3"})})]},j))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(tt,{className:"h-3.5 w-3.5"}),"Coups de bras"]}),e.jsxs("button",{type:"button",onClick:h,className:"inline-flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition",children:[e.jsx(pe,{className:"h-3 w-3"}),"Rep"]})]}),b.stroke_count.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:b.stroke_count.map((l,j)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-4 text-right",children:l.rep}),e.jsx("input",{type:"number",inputMode:"numeric",min:0,value:l.count||"",onChange:A=>y(j,Number(A.target.value)||0),placeholder:"nb",className:"w-14 rounded-lg border border-border bg-background px-1.5 py-1 text-xs text-center outline-none focus:ring-2 focus:ring-foreground/10"}),e.jsx("button",{type:"button",onClick:()=>v(j),className:"p-0.5 text-muted-foreground hover:text-destructive transition",children:e.jsx(Ne,{className:"h-3 w-3"})})]},j))})]}),e.jsx("textarea",{value:b.notes,onChange:l=>a(j=>({...j,notes:l.target.value})),placeholder:"Notes libres...",rows:2,className:"w-full resize-none rounded-xl border border-border bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-foreground/10"})]}):e.jsxs("div",{className:"px-3 py-2.5 space-y-1.5 group",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:t.exercise_label}),e.jsx("button",{type:"button",onClick:f,className:"p-1.5 rounded-lg text-muted-foreground hover:bg-muted transition","aria-label":"Modifier",children:e.jsx(zt,{className:"h-3.5 w-3.5"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-xs text-muted-foreground",children:[t.tempo!=null&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(et,{className:"h-3 w-3"}),t.tempo," c/min"]}),t.split_times.length>0&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Le,{className:"h-3 w-3"}),t.split_times.map(l=>Fs(l.time_seconds)).join(" / ")]}),t.stroke_count.length>0&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(tt,{className:"h-3 w-3"}),t.stroke_count.map(l=>l.count).join(" / ")," cps"]})]}),t.notes&&e.jsx("div",{className:"text-xs text-foreground/70 italic",children:t.notes})]})}const $s=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],Ls=[{key:"AM",label:"Matin"},{key:"PM",label:"Soir"}],Is=[{key:"difficulty",label:"Difficulté",mode:"hard"},{key:"fatigue_end",label:"Fatigue fin",mode:"hard"},{key:"performance",label:"Perf perçue",mode:"good"},{key:"engagement",label:"Engagement",mode:"good"}];function bt(...t){return t.filter(Boolean).join(" ")}function gt(t){return String(t).padStart(2,"0")}function Ue(t){return`${t.getFullYear()}-${gt(t.getMonth()+1)}-${gt(t.getDate())}`}function Ps(t){return new Date(t.getFullYear(),t.getMonth(),1)}function Ks(t){const s=String(t).split("__");return{iso:s[0],slotKey:s[1]||""}}function ht(t,s){return Number.isFinite(t)?Math.round(t/s)*s:0}function yt({open:t,title:s,onClose:n,children:r}){return e.jsx(Oe,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(de.div,{className:"fixed inset-0 z-overlay bg-black/30",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n}),e.jsx(de.div,{className:"fixed inset-0 z-modal flex items-end sm:items-center justify-center p-3 pb-24 sm:p-4 sm:pb-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},children:e.jsxs("div",{className:"w-full max-w-md rounded-3xl border bg-background shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[e.jsx("div",{className:"truncate text-base font-semibold text-foreground",children:s}),e.jsxs("button",{type:"button",onClick:n,className:"inline-flex items-center justify-center rounded-2xl border border-border bg-background p-2 transition hover:bg-muted","aria-label":"Fermer",children:[e.jsx($e,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Fermer"})]})]}),e.jsx("div",{className:"p-4",children:r})]})})]})})}function on(){const{user:t,userId:s}=It(),{toast:n}=Pt(),r=jt(),[u,i]=Me.useState("idle"),[b,a]=Me.useState(!1),[f,g]=Me.useState(null);Me.useEffect(()=>{Be.auth.getSession().then(({data:o})=>{g(o.session?.user?.id??null)})},[t]);const{data:N,isLoading:k,error:E,refetch:P}=Xe({queryKey:["sessions",s??t],queryFn:()=>re.getSessions(t,s),enabled:!!t}),{data:h,isLoading:y,error:v,refetch:l}=Xe({queryKey:["assignments",t],queryFn:()=>re.getAssignments(t,s),enabled:!!t}),j=k||y,A=E||v,D=()=>{P(),l()},$=_e({mutationFn:o=>re.deleteSession(o),onMutate:()=>{i("saving")},onSuccess:()=>{r.invalidateQueries({queryKey:["sessions"]}),n({title:"Séance supprimée",description:"La saisie a été supprimée."}),i("saved"),setTimeout(()=>i("idle"),2e3)},onError:()=>{n({title:"Erreur",description:"Impossible de supprimer la séance.",variant:"destructive"}),i("error"),setTimeout(()=>i("idle"),3e3)}}),Q=_e({mutationFn:async o=>{const{_exerciseLogs:x,...w}=o,I=await re.syncSession({...w,athlete_name:t,athlete_id:s??void 0});if(x&&x.length>0&&I.sessionId)try{const{data:Y}=await Be.auth.getSession(),xe=Y.session?.user?.id;xe&&await re.saveSwimExerciseLogs(I.sessionId,xe,x)}catch(Y){console.warn("[EAC] Failed to save exercise logs:",Y)}return I},onMutate:()=>{i("saving")},onSuccess:()=>{r.invalidateQueries({queryKey:["sessions"]}),r.invalidateQueries({queryKey:["assignments"]}),n({title:"Séance enregistrée",description:"Vos données ont été synchronisées."}),i("saved"),setTimeout(()=>i("idle"),2e3)},onError:()=>{n({title:"Erreur",description:"Impossible d'enregistrer la séance.",variant:"destructive"}),i("error"),setTimeout(()=>i("idle"),3e3)}}),be=_e({mutationFn:async o=>{const{_exerciseLogs:x,...w}=o,I=await re.updateSession(w);if(console.log("[EAC] updateMutation - exerciseLogs:",x),x&&w.id)try{const{data:Y}=await Be.auth.getSession(),xe=Y.session?.user?.id;console.log("[EAC] updateMutation - authUid:",xe,"sessionId:",w.id),xe?(console.log("[EAC] updateMutation - calling saveSwimExerciseLogs with logs:",x),await re.saveSwimExerciseLogs(w.id,xe,x),console.log("[EAC] updateMutation - saveSwimExerciseLogs completed successfully")):console.warn("[EAC] updateMutation - No authUid found, skipping exercise logs save")}catch(Y){throw console.error("[EAC] Failed to save exercise logs:",Y),Y}else console.log("[EAC] updateMutation - skipping exercise logs (empty or no session ID)");return I},onMutate:()=>{i("saving")},onSuccess:()=>{r.invalidateQueries({queryKey:["sessions"]}),n({title:"Séance mise à jour",description:"Votre saisie a été mise à jour."}),i("saved"),setTimeout(()=>i("idle"),2e3)},onError:()=>{n({title:"Erreur",description:"Impossible de mettre à jour la séance.",variant:"destructive"}),i("error"),setTimeout(()=>i("idle"),3e3)}}),O=ds({sessions:N,assignments:h,userId:s,user:t}),{today:C,monthCursor:B,selectedISO:K,drawerOpen:G,settingsOpen:z,infoOpen:oe,activeSessionId:R,detailsOpen:me,selectedDayIndex:L,isPending:V,presenceDefaults:te,stableDurationMin:ie,draftState:F,gridDates:ae,completionByISO:le,selectedDate:ce,sessionsForSelectedDay:Z,selectedDayStatus:ge,globalKm:ve,dayKm:we,logsBySessionId:W,setMonthCursor:U,setSelectedISO:he,setDrawerOpen:ye,setSettingsOpen:je,setInfoOpen:ee,setActiveSessionId:X,setDetailsOpen:J,setSelectedDayIndex:d,setPresenceDefaults:p,setAttendanceOverrideBySessionId:m,setStableDurationMin:S,setDraftState:M,setAutoCloseArmed:_,startTransition:q,getSessionStatus:H}=O,se=c.useMemo(()=>{if(!R)return[];const o=Z.find(w=>w.id===R);if(!o?.assignmentId)return[];const x=(h??[]).find(w=>w.id===o.assignmentId);return x?.items?x.items.filter(w=>w.label):[]},[R,Z,h]),ne=c.useCallback(o=>{he(o),ye(!0),X(null),J(!1);const x=le[o]||{completed:0,total:2};_(x.total>0&&x.completed<x.total)},[le,he,ye,X,J,_]),fe=c.useCallback(()=>{ye(!1),X(null),J(!1),_(!1),d(null)},[ye,X,J,_,d]),Ke=c.useCallback(()=>{U(o=>new Date(o.getFullYear(),o.getMonth()-1,1))},[U]),St=c.useCallback(()=>{U(o=>new Date(o.getFullYear(),o.getMonth()+1,1))},[U]),Mt=c.useCallback(()=>{const o=new Date;U(Ps(o)),ne(Ue(o))},[ne,U]),Re=c.useCallback(o=>{X(o),J(!1)},[X,J]),_t=c.useCallback(o=>{q(()=>{m(w=>({...w,[o]:"absent"}))});const x=W[o];x?.id&&$.mutate(Number(x.id))},[$,W,q,m]),Ct=c.useCallback(o=>{q(()=>{m(x=>({...x,[o]:"present"}))})},[q,m]),At=c.useCallback(o=>{q(()=>{m(x=>{const w={...x};return delete w[o],w})})},[q,m]),Dt=c.useCallback(()=>{const o=Z.map(x=>H(x,ce).expected?x.id:null).filter(Boolean);o.length!==0&&(q(()=>{m(x=>{const w={...x};for(const I of o)w[I]="absent";return w}),X(null),J(!1)}),o.forEach(x=>{const w=W[x];w?.id&&$.mutate(Number(w.id))}))},[Z,H,ce,q,W,$,m,X,J]),Ft=c.useCallback(()=>{if(!R||!t||!Is.every(ke=>Number.isInteger(F[ke.key])))return;const{iso:x,slotKey:w}=Ks(R),I=w==="PM"?"Soir":"Matin",Y=ht(Number(F.distanceMeters??0),100),xe=ht(Number(ie),15),Te={};for(const[ke,$t]of Object.entries(F.strokes)){const nt=Number($t);nt>0&&(Te[ke]=nt)}const st={date:x,slot:I,distance:Y,duration:xe,effort:Number(F.difficulty),feeling:Number(F.fatigue_end),performance:Number(F.performance),engagement:Number(F.engagement),comments:String(F.comment||"").slice(0,400),athlete_name:t,athlete_id:s??void 0,stroke_distances:Object.keys(Te).length>0?Te:null},Ae=W[R];console.log("[EAC] saveFeedback - draftState.exerciseLogs:",F.exerciseLogs),q(()=>{m(ke=>({...ke,[R]:"present"}))}),Ae?.id?(console.log("[EAC] saveFeedback - updating existing session:",Ae.id),be.mutate({...st,id:Ae.id,created_at:Ae.created_at??new Date().toISOString(),_exerciseLogs:F.exerciseLogs.length>0?F.exerciseLogs:[]})):(console.log("[EAC] saveFeedback - creating new session"),Q.mutate({...st,_exerciseLogs:F.exerciseLogs.length>0?F.exerciseLogs:void 0})),X(null),J(!1)},[R,t,s,F,ie,W,q,be,Q,m,X,J]),Et=c.useCallback((o,x)=>{p(w=>({...w,[o]:{...w[o],[x]:!w[o][x]}}))},[p]);c.useEffect(()=>{if(!G)return;const o=x=>{if(x.key==="Escape"){x.preventDefault(),fe();return}(x.key==="Enter"||x.key===" ")&&(x.preventDefault(),Z.length>0&&!R&&Re(Z[0].id))};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[G,fe,Z,R,Re]);const Ot=c.useCallback((o,x)=>{if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"," "].includes(o.key))return;if(o.preventDefault(),o.key==="Enter"||o.key===" "){const Y=Ue(ae[x]);ne(Y);return}let I=x;o.key==="ArrowLeft"&&(I=Math.max(0,x-1)),o.key==="ArrowRight"&&(I=Math.min(ae.length-1,x+1)),o.key==="ArrowUp"&&(I=Math.max(0,x-7)),o.key==="ArrowDown"&&(I=Math.min(ae.length-1,x+7)),d(I),he(Ue(ae[I])),setTimeout(()=>{const Y=document.querySelectorAll('[data-calendar-cell="true"]');Y[I]&&Y[I].focus()},0)},[ae,ne,d,he]);return j?e.jsxs("div",{className:"min-h-screen bg-muted",children:[e.jsx("div",{className:"sm:hidden fixed top-0 left-0 right-0 z-overlay border-b border-border bg-card/90 backdrop-blur",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-3 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-2xl bg-muted animate-pulse"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"h-4 w-12 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-16 rounded bg-muted animate-pulse"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"})]})]})}),e.jsx("div",{className:"mx-auto max-w-6xl px-3 sm:px-4 pt-20 pb-5 sm:py-8",children:e.jsxs("div",{className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 sm:px-5 py-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"})]}),e.jsx("div",{className:"h-6 w-32 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"})]}),e.jsx("div",{className:"p-3 sm:p-5",children:e.jsxs("div",{className:"grid grid-cols-7 gap-1.5 sm:gap-2",children:[Array.from({length:7}).map((o,x)=>e.jsx("div",{className:"px-0.5 pb-1 flex justify-center",children:e.jsx("div",{className:"h-3 w-4 rounded bg-muted animate-pulse"})},`wh-${x}`)),Array.from({length:35}).map((o,x)=>e.jsx("div",{className:"aspect-square rounded-2xl bg-muted/50 animate-pulse"},`cs-${x}`))]})})]})})]}):A?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(Qt,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:A.message}),e.jsx(Kt,{onClick:()=>D(),className:"mt-4",children:"Réessayer"})]}):e.jsxs("div",{className:"min-h-screen bg-muted",children:[e.jsx("div",{className:"sm:hidden fixed top-0 left-0 right-0 z-overlay border-b border-border bg-card/90 backdrop-blur",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-3 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-2xl bg-card border border-border flex items-center justify-center",children:e.jsx(Ge,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:"Suivi"}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[ve," km"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>ee(!0),className:"inline-flex items-center justify-center rounded-2xl border border-border bg-background p-2 transition hover:bg-muted","aria-label":"Infos",children:e.jsx(rt,{className:"h-5 w-5"})}),e.jsx("button",{type:"button",onClick:()=>je(!0),className:"inline-flex items-center justify-center rounded-2xl border border-border bg-background p-2 transition hover:bg-muted","aria-label":"Paramètres",children:e.jsx(at,{className:"h-5 w-5"})})]})]})}),e.jsxs("div",{className:"mx-auto max-w-6xl px-3 sm:px-4 pt-20 pb-5 sm:py-8",children:[e.jsxs("div",{className:"invisible sm:visible flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-2xl bg-card border border-border flex items-center justify-center",children:e.jsx(Ge,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:"Suivi"}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[ve," km"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>ee(!0),className:"inline-flex items-center justify-center rounded-2xl border border-border bg-background p-2 transition hover:bg-muted","aria-label":"Infos",children:e.jsx(rt,{className:"h-5 w-5"})}),e.jsx("button",{type:"button",onClick:()=>je(!0),className:"inline-flex items-center justify-center rounded-2xl border border-border bg-background p-2 transition hover:bg-muted","aria-label":"Paramètres",children:e.jsx(at,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:[e.jsx(ms,{monthCursor:B,selectedDayStatus:ge,onPrevMonth:Ke,onNextMonth:St,onJumpToday:Mt}),e.jsx(ys,{monthCursor:B,gridDates:ae,completionByISO:le,selectedISO:K,selectedDayIndex:L,today:C,onDayClick:ne,onKeyDown:Ot})]}),f&&e.jsx(Es,{userId:f,expanded:b,onToggle:()=>a(o=>!o)}),e.jsx(yt,{open:oe,title:"Codes",onClose:()=>ee(!1),children:e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-orange-200 bg-orange-50 px-3 py-2",children:[e.jsx("span",{className:"font-semibold",children:"Orange"}),e.jsx("span",{className:"text-foreground",children:"À compléter"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-emerald-200 bg-emerald-50 px-3 py-2",children:[e.jsx("span",{className:"font-semibold",children:"Vert"}),e.jsx("span",{className:"text-foreground",children:"Validé → km"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-sky-200 bg-sky-50 px-3 py-2",children:[e.jsx("span",{className:"font-semibold",children:"Bleu"}),e.jsx("span",{className:"text-foreground",children:"Absent / Non prévu"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Les km comptent uniquement après validation."})]})}),e.jsx(yt,{open:z,title:"Présence",onClose:()=>je(!1),children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Toggle hebdo (séances attendues)."}),e.jsxs("div",{className:"overflow-hidden rounded-2xl border border-border bg-card",children:[e.jsxs("div",{className:"grid grid-cols-[1fr_110px_110px] bg-muted border-b border-border px-3 py-2 text-xs font-semibold text-muted-foreground",children:[e.jsx("div",{children:"Jour"}),e.jsx("div",{className:"text-center",children:"Matin"}),e.jsx("div",{className:"text-center",children:"Soir"})]}),$s.map((o,x)=>e.jsxs("div",{className:bt("grid grid-cols-[1fr_110px_110px] items-center px-3 py-2",x!==6&&"border-b border-border"),children:[e.jsx("div",{className:"text-sm font-medium text-foreground",children:o}),Ls.map(w=>{const I=!!te?.[x]?.[w.key];return e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",onClick:()=>Et(x,w.key),className:bt("w-24 rounded-2xl border px-3 py-2 text-sm font-semibold transition",I?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"),"aria-label":`${o} ${w.label}`,children:I?"On":"Off"})},w.key)})]},o))]}),e.jsxs("div",{className:"rounded-2xl border border-border bg-muted px-3 py-2",children:[e.jsx("div",{className:"text-xs font-semibold text-foreground",children:"Durée (valeur par défaut)"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"h-9 w-9 rounded-2xl border border-border bg-card hover:bg-muted flex items-center justify-center",onClick:()=>S(o=>Math.max(30,o-15)),"aria-label":"Diminuer la durée",children:e.jsx(vt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"text-sm font-semibold text-foreground",children:[ie," min"]}),e.jsx("button",{type:"button",className:"h-9 w-9 rounded-2xl border border-border bg-card hover:bg-muted flex items-center justify-center",onClick:()=>S(o=>Math.min(240,o+15)),"aria-label":"Augmenter la durée",children:e.jsx(pe,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"mt-1 text-[11px] text-muted-foreground",children:"Durée envoyée au back-end (non affichée dans la maquette)."})]})]})}),e.jsx(Cs,{open:G,selectedDate:ce,sessionsForSelectedDay:Z,selectedDayStatus:ge,dayKm:we,activeSessionId:R,detailsOpen:me,draftState:F,saveState:u,isPending:V,logsBySessionId:W,onClose:fe,onDayOffAll:Dt,onOpenSession:Re,onCloseSession:()=>{X(null),J(!1)},onToggleDetails:()=>J(o=>!o),onMarkAbsent:_t,onMarkPresent:Ct,onClearOverride:At,onSaveFeedback:Ft,onDraftStateChange:M,getSessionStatus:H,assignmentItems:se})]})]})}export{on as default};
