import{r as N,j as e,a as O,c as pt,u as be,d as K}from"./vendor-query-BiSH4r2z.js";import{c as Z,a as w,a3 as xt,T as ft,I as P,f as Oe,F as bt,B as W,u as ht,d as B,S as U}from"./index-6muuOvs8.js";import{D as X,a as Y,b as he,c as ge}from"./dialog-B2nx49CN.js";import{A as ye,a as je,b as ve,c as Ne,d as we,e as ke,f as Se,g as _e}from"./alert-dialog-CYtEWvZU.js";import{C as gt}from"./chevron-right-CZsFkbnp.js";import{i as We,g as yt,c as Ke,L as Ue,b as jt,a as Qe,R as vt}from"./SwimSessionConsultation-CAk5jKfr.js";import{F as Nt,S as wt,A as kt,a as St,d as Ce,c as _t,e as Ct}from"./SessionListView-DhxdDQRD.js";import{T as Tt}from"./textarea-CFzKIu7Y.js";import{S as Te,a as Me,b as Ae,c as Ve,d as De}from"./select-nd3Hyo6s.js";import{T as ne}from"./trash-2-C-W0ssK-.js";import{P as ie}from"./plus-CPLUokny.js";import{f as Mt}from"./format-B9mPVj_w.js";import{C as qe}from"./circle-alert-CHFRKtcI.js";import{S as At}from"./search-Bk-q-1R0.js";import{T as Vt}from"./timer-rnmLVcgE.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-6k692oZB.js";import"./index-D1_iiZyK.js";import"./index-C9_rGpcd.js";import"./index-ZPi-Pkm6.js";import"./badge-DL9uOR-m.js";import"./chevron-down-yX48Xfmh.js";import"./chevron-left-BIsLSve0.js";import"./save-CMneDxT6.js";import"./index-CaFnqI5V.js";import"./check-CjwpUZCJ.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],qt=Z("copy",Dt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],Ee=Z("folder-open",Et);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],Be=Z("house",Bt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],Rt=Z("sparkles",Pt),He=N.forwardRef(({...t},s)=>e.jsx("nav",{ref:s,"aria-label":"breadcrumb",...t}));He.displayName="Breadcrumb";const Xe=N.forwardRef(({className:t,...s},r)=>e.jsx("ol",{ref:r,className:w("flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",t),...s}));Xe.displayName="BreadcrumbList";const J=N.forwardRef(({className:t,...s},r)=>e.jsx("li",{ref:r,className:w("inline-flex items-center gap-1.5",t),...s}));J.displayName="BreadcrumbItem";const ae=N.forwardRef(({asChild:t,className:s,...r},n)=>{const a=t?xt:"a";return e.jsx(a,{ref:n,className:w("transition-colors hover:text-foreground",s),...r})});ae.displayName="BreadcrumbLink";const oe=N.forwardRef(({className:t,...s},r)=>e.jsx("span",{ref:r,role:"link","aria-disabled":"true","aria-current":"page",className:w("font-normal text-foreground",t),...s}));oe.displayName="BreadcrumbPage";const le=({children:t,className:s,...r})=>e.jsx("li",{role:"presentation","aria-hidden":"true",className:w("[&>svg]:w-3.5 [&>svg]:h-3.5",s),...r,children:t??e.jsx(gt,{})});le.displayName="BreadcrumbSeparator";const Pe=["V0","V1","V2","V3","Max","Prog"],Ft={V0:"bg-intensity-1",V1:"bg-intensity-2",V2:"bg-intensity-3",V3:"bg-intensity-4",Max:"bg-intensity-5",Prog:"bg-intensity-prog"},Re={souple:"V0",facile:"V0",relache:"V0",rel√¢ch√©:"V0"},$t=t=>{if(!t)return"V0";const s=t.trim();if(!s)return"V0";const r=s.toLowerCase();if(Re[r])return Re[r];if(r==="prog"||r==="progressif")return"Prog";const n=s.toUpperCase();if(n==="MAX")return"Max";if(n.startsWith("V")){const a=n.replace("V","V");return a==="V4"||a==="V5"?"Max":a}return s};function Lt({value:t,onChange:s,className:r,ariaLabel:n="S√©lection d'intensit√©"}){const a=$t(t),x=Pe.includes(a)?a:"Max";return e.jsx("div",{role:"radiogroup","aria-label":n,className:w("flex flex-wrap items-center gap-1",r),children:Pe.map(b=>{const o=x===b,l=b==="Max"?"MAX":b==="Prog"?"Prog":b;return e.jsxs("button",{type:"button",role:"radio","aria-checked":o,"aria-label":`Intensit√© ${l}`,onClick:()=>s(b),className:w("flex flex-col items-center gap-1 rounded-full px-2 py-1 text-[10px] font-semibold text-muted-foreground transition","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",o?"text-foreground":"hover:text-foreground"),children:[b==="Prog"?e.jsx(ft,{className:w("h-3 w-3",o?"text-intensity-prog":"text-muted-foreground")}):e.jsx("span",{className:w("h-3 w-3 rounded-full",o?Ft[b]??"bg-primary":"bg-muted")}),e.jsx("span",{children:l})]},b)})})}const Fe={souple:"V0",facile:"V0",relache:"V0",rel√¢ch√©:"V0",ez:"V0"},zt=["V0","V1","V2","V3","Max","Prog"],R=t=>{if(!t)return"V0";const s=t.trim();if(!s)return"V0";const r=s.toLowerCase();if(r==="prog"||r==="progressif")return"Prog";if(Fe[r])return Fe[r];const n=s.toUpperCase();if(n==="MAX"||n==="VMAX")return"Max";if(n.startsWith("V")){const a=Number.parseInt(n.slice(1),10);if(Number.isFinite(a)&&a>=4)return"Max";if(zt.includes(n))return n}return s},$e=t=>{const s=t.trim().toLowerCase();return s&&(s.startsWith("plaquette")||s.startsWith("plaq")?"plaquettes":s.startsWith("palm")?"palmes":s.startsWith("tuba")?"tuba":s.startsWith("pull")?"pull":s.startsWith("elas")?"elastique":s)};function It(t){const s=t.trim();return s?/^x\d+/i.test(s)?{type:"block_rep",raw:t,trimmed:s}:s.startsWith("#")?{type:"sub_detail",raw:t,trimmed:s}:s.startsWith("+")?{type:"continuation",raw:t,trimmed:s}:/^[SB]\d+\s*:/i.test(s)?{type:"annotation",raw:t,trimmed:s}:/^\d/.test(s)?{type:"exercise",raw:t,trimmed:s}:/^total\s*:/i.test(s)?{type:"unparsed",raw:t,trimmed:s}:{type:"unparsed",raw:t,trimmed:s}:{type:"empty",raw:t,trimmed:s}}function Le(t){const s=t.match(/(\d+)'(\d+)/);if(s)return Number(s[1])*60+Number(s[2]);const r=t.match(/(\d+)(?:''|"|‚Ä≥)/);if(r)return Number(r[1]);const n=t.match(/^(\d+)$/);return n?Number(n[1]):null}function Ot(t){const s=t.join(" "),r=s.match(/@\s*([\d''"‚Ä≥]+(?:\s*\/\s*[\d''"‚Ä≥]+)?)/)||s.match(/\bd\s*:\s*([\d''"‚Ä≥]+(?:\s*\/\s*[\d''"‚Ä≥]+)?)/);if(r){const a=r[1].split("/")[0].trim(),x=Le(a);if(x!==null)return{rest:x,restType:"departure"}}const n=s.match(/\br\s*:\s*([\d''"‚Ä≥]+(?:\s*\/\s*[\d''"‚Ä≥]+)?)/);if(n){const a=n[1].split("/")[0].trim(),x=Le(a);if(x!==null)return{rest:x,restType:"rest"}}return null}function Wt(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}const Kt=[[/\b4n\b/i,"4n"],[/\bqn\b/i,"4n"],[/\bcrawl\b/i,"crawl"],[/\bcr\b/i,"crawl"],[/\bnl\b/i,"crawl"],[/\bpapillon\b/i,"pap"],[/\bpap\b/i,"pap"],[/\bdos\b/i,"dos"],[/\b[dD]\b/,"dos"],[/\bbrasse\b/i,"brasse"],[/\bbr\b/i,"brasse"],[/\bspe\b/i,"spe"]],Ut=[[/\beduc\b/i,"educ"],[/\bjbes\b/i,"jambes"],[/\bjambes\b/i,"jambes"],[/\bnac\b/i,"nc"],[/\bnc\b/i,"nc"]],Qt=[[/\bvmax\b/i,"Max"],[/\bmax\b/i,"Max"],[/\bvacc\b/i,"Max"],[/\bv3\b/i,"V3"],[/\bv2\b/i,"V2"],[/\bv1\b/i,"V1"],[/\bv0\b/i,"V0"],[/\bez\b/i,"V0"],[/\bsouple\b/i,"V0"],[/\bprog\b/i,"Prog"]],Ht=[[/\bplaq(?:uettes?)?\b/i,"plaquettes"],[/\bpalm(?:es)?\b/i,"palmes"],[/\btuba\b/i,"tuba"],[/\bpull\b/i,"pull"],[/\belas(?:tique)?\b/i,"elastique"]],Xt=[/\bW\b/,/\bmat\.\s*\w+/i,/\bDP\b/,/\bCB\b/,/\bR2N\b/,/\bD2B\b/,/\bampli\b/i,/\bAC\b/,/\bCP\b/,/\bRA\b/,/\b1\/2\s*pull\b/i,/\bfocus\b/i];function Yt(t){return t.replace(/\br\s*:\s*[\d''"‚Ä≥\/\s]+/g," ").replace(/@\s*[\d''"‚Ä≥\/\s]+/g," ").replace(/\bd\s*:\s*[\d''"‚Ä≥\/\s]+/g," ")}function G(t){const s={repetitions:1,distance:null,stroke:"crawl",strokeType:"nc",intensity:"V1",rest:null,restType:"rest",equipment:[],modalities:""},r=Ot(t.split(/\s+/));r&&(s.rest=r.rest,s.restType=r.restType);const n=Yt(t),a=Wt(n),x=n.match(/(\d+)\s*[*x√ó]\s*(\d+)/i);if(x)s.repetitions=Number(x[1]),s.distance=Number(x[2]);else{const f=n.match(/^(\d+)\b/);f&&(s.distance=Number(f[1]))}/‚Üó|‚ÜóÔ∏é/.test(t)&&(s.intensity="Prog");const b=new Set,o=/\b(?:D2B|DP|CB|R2N|AC|CP|RA)\b/gi;let l;for(;(l=o.exec(a))!==null;)for(let f=l.index;f<l.index+l[0].length;f++)b.add(f);const c=f=>{for(let g=f.index;g<f.index+f[0].length;g++)if(b.has(g))return!0;return!1};if(s.intensity!=="Prog")for(const[f,g]of Qt){const T=new RegExp(f.source,f.flags+(f.flags.includes("g"),"")).exec(a);if(T&&!c(T)){s.intensity=g;break}}for(const[f,g]of Kt){const T=new RegExp(f.source,f.flags).exec(a);if(T&&!c(T)){if(g==="dos"&&f.source==="\\b[dD]\\b"&&T[0]!=="D")continue;s.stroke=g;break}}for(const[f,g]of Ut)if(f.test(a)){s.strokeType=g;break}for(const[f,g]of Ht)f.test(a)&&(s.equipment.includes(g)||s.equipment.push(g));const p=[],S=n.match(/\bW\s+[^\r\n]+/i);S&&p.push(S[0].trim());const k=n.match(/\bmat\.\s*\w+/i);k&&p.push(k[0].trim());for(const f of Xt){if(f.source.startsWith("\\bW\\b")||f.source.startsWith("\\bmat"))continue;const g=n.match(f);if(g){const A=g[0].trim();p.some(T=>T.includes(A))||p.push(A)}}const M=t.match(/\(([^)]+)\)/);if(M){const f=M[1].trim();f.length>2&&!p.some(g=>g.includes(f))&&p.push(`(${f})`)}const v=n.match(/\brespi\s+[\d\-]+\s*(?:temps)?/i);return v&&p.push(v[0].trim()),s.modalities=p.join(" / ").trim(),s}function Jt(t){const s=t.replace(/^#\s*/,"");if(/^\d+(?:-\d+)?\s*[:(\s]/.test(s)){if(/^\d+(?:-\d+)?\s*:/.test(s))return{form:"B",text:s.trim()};if(/^\d+\s*\(/.test(s))return{form:"B",text:s.trim()}}const r=s.match(/^(\d+)\b/);if(r){const n=G(s);return{form:"A",distance:Number(r[1]),tokens:n}}return{form:"B",text:s.trim()}}function F(t){return{repetitions:t.repetitions,distance:t.distance,rest:t.rest,restType:t.restType,stroke:t.stroke,strokeType:t.strokeType,intensity:t.intensity,modalities:t.modalities,equipment:t.equipment}}function Gt(t){const s=[];let r=[];for(const n of t)n.type==="empty"?r.length>0&&(s.push({lines:r}),r=[]):r.push(n);return r.length>0&&s.push({lines:r}),s}function Zt(t,s){const r={title:`Bloc ${s+1}`,repetitions:1,description:"",modalities:"",equipment:[],exercises:[]};let n=null;const a=[],x=[];for(let o=0;o<t.lines.length;o++){const l=t.lines[o];switch(l.type){case"block_rep":{const c=l.trimmed.match(/^x(\d+)/i);c&&(r.repetitions=Number(c[1]));const p=l.trimmed.match(/\(([^)]+)\)/);if(p){const S=p[1].trim(),k=l.trimmed.slice(l.trimmed.indexOf(")")+1).trim();k&&x.push(k);const M=S.split(/\s*\+\s*/);for(const v of M)if(/^\d/.test(v.trim())){const f=G(v.trim());r.exercises.push(F(f))}k&&(r.modalities=k)}break}case"exercise":{n&&r.exercises.push(F(n)),n=G(l.trimmed);break}case"sub_detail":{const c=Jt(l.trimmed);if(c.form==="A"&&n){const p=F(c.tokens);p.distance=c.distance,c.tokens.stroke==="crawl"&&n.stroke!=="crawl"&&(p.stroke=n.stroke),!p.rest&&n.rest&&(p.rest=n.rest,p.restType=n.restType),p.equipment.length===0&&n.equipment.length>0&&(p.equipment=[...n.equipment]),r.exercises.push(p),n=null}else if(c.form==="B"&&n){const p=n.modalities;n.modalities=p?`${p} / ${c.text}`:c.text}else if(c.form==="A"){const p=F(c.tokens);p.distance=c.distance,r.exercises.push(p)}else a.push(c.text);break}case"continuation":{n&&(r.exercises.push(F(n)),n=null);const c=l.trimmed.replace(/^\+\s*/,"").trim();/^\d/.test(c)?n=G(c):a.push(c);break}case"annotation":{a.push(l.trimmed);break}case"unparsed":{o===0&&r.exercises.length===0&&!n?r.title=l.trimmed:a.push(l.trimmed);break}}}n&&r.exercises.push(F(n)),a.length>0&&(r.description=a.join(`
`)),x.length>0&&(r.modalities=x.join(" / "));const b=new Set;for(const o of r.exercises)for(const l of o.equipment)b.add(l);return r.equipment=Array.from(b),r}function es(t){if(!t||!t.trim())return[];const n=t.replace(/\r\n/g,`
`).replace(/\r/g,`
`).replace(/\u2018|\u2019/g,"'").replace(/\u201C|\u201D/g,'"').replace(/\u00A0/g," ").split(`
`).map(l=>It(l)),a=Gt(n),x=[];let b=0;for(const l of a){const c=l.lines.filter(S=>S.type!=="unparsed"||!/^total\s*:/i.test(S.trimmed));if(c.length===0)continue;const p=Zt({lines:c},b);(p.exercises.length>0||p.description)&&(x.push(p),b++)}const o=[];for(let l=0;l<x.length;l++){const c=x[l];if(c.exercises.length===0&&!c.description&&(c.repetitions??1)>1&&l+1<x.length){const p=x[l+1];p.repetitions=c.repetitions}else o.push(c)}return o}const Q=t=>t?{min:Math.floor(t/60),sec:t%60}:{min:0,sec:0},ts=[{value:"palmes",label:"Palmes"},{value:"tuba",label:"Tuba"},{value:"plaquettes",label:"Plaquettes"},{value:"pull",label:"Pull"},{value:"elastique",label:"√âlastique"}],ss=[{value:"pap",label:"Papillon"},{value:"dos",label:"Dos"},{value:"brasse",label:"Brasse"},{value:"crawl",label:"Crawl"},{value:"4n",label:"4 nages"},{value:"spe",label:"Sp√©"}],rs=[{value:"nc",label:"NC"},{value:"educ",label:"Educ"},{value:"jambes",label:"Jambes"}],ns=t=>t==="Max"?"MAX":t,is={V0:"text-intensity-1",V1:"text-intensity-2",V2:"text-intensity-3",V3:"text-intensity-4",Max:"text-intensity-5",Prog:"text-intensity-prog"},as={V0:"ring-intensity-1/30",V1:"ring-intensity-2/30",V2:"ring-intensity-3/30",V3:"ring-intensity-4/30",Max:"ring-intensity-5/30",Prog:"ring-intensity-prog/30"};function os({exercise:t,onChange:s,onDelete:r,onDuplicate:n,showDelete:a=!0}){const x=R(t.intensity),b=t.modalities??"";return e.jsx("div",{className:"rounded-2xl border border-border bg-card p-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"grid flex-1 grid-cols-2 sm:grid-cols-4 gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"R√©p."}),e.jsx("div",{className:"mt-1",children:e.jsx(P,{type:"number",min:1,value:t.repetitions??"",onChange:o=>s("repetitions",o.target.value===""?null:Number(o.target.value)),className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Dist. (m)"}),e.jsx("div",{className:"mt-1",children:e.jsx(P,{type:"number",min:0,value:t.distance??"",onChange:o=>s("distance",o.target.value===""?null:Number(o.target.value)),className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Nage"}),e.jsx("div",{className:"mt-1",children:e.jsxs(Te,{value:t.stroke,onValueChange:o=>s("stroke",o),children:[e.jsx(Me,{className:"rounded-2xl",children:e.jsx(Ae,{})}),e.jsx(Ve,{children:ss.map(o=>e.jsx(De,{value:o.value,children:o.label},o.value))})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Type"}),e.jsx("div",{className:"mt-1",children:e.jsxs(Te,{value:t.strokeType,onValueChange:o=>s("strokeType",o),children:[e.jsx(Me,{className:"rounded-2xl",children:e.jsx(Ae,{})}),e.jsx(Ve,{children:rs.map(o=>e.jsx(De,{value:o.value,children:o.label},o.value))})]})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Intensit√© (clic sur points)"}),e.jsxs("span",{className:w("inline-flex items-center gap-2 rounded-full bg-card px-2.5 py-1 text-xs font-semibold ring-1",as[x],is[x]),children:[e.jsx("span",{className:w("h-2 w-2 rounded-full",We[x]??"bg-muted")}),ns(x)]})]}),e.jsx("div",{className:"mt-2 flex items-center justify-between gap-2",children:e.jsx(Lt,{value:t.intensity,onChange:o=>s("intensity",o)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"R√©cup√©ration"}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"inline-flex rounded-full border border-border bg-card p-0.5 text-xs font-semibold",children:[e.jsx("button",{type:"button",onClick:()=>s("restType","departure"),className:w("rounded-full px-2.5 py-1 transition-colors",t.restType==="departure"?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground"),children:"D√©part"}),e.jsx("button",{type:"button",onClick:()=>s("restType","rest"),className:w("rounded-full px-2.5 py-1 transition-colors",t.restType==="rest"?"bg-primary text-primary-foreground":"text-muted-foreground hover:text-foreground"),children:"Repos"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{type:"number",min:0,max:59,value:Q(t.rest).min||"",onChange:o=>{const l=o.target.value===""?0:Number(o.target.value),c=Q(t.rest).sec;s("rest",l*60+c||null)},placeholder:"0",className:"w-12 rounded-2xl text-center"}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"min"}),e.jsx(P,{type:"number",min:0,max:59,value:Q(t.rest).sec||"",onChange:o=>{const l=o.target.value===""?0:Number(o.target.value),c=Q(t.rest).min;s("rest",c*60+l||null)},placeholder:"0",className:"w-12 rounded-2xl text-center"}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"sec"})]}),t.rest?e.jsx("button",{type:"button",onClick:()=>s("rest",null),className:"text-[11px] text-muted-foreground hover:text-foreground",children:"Effacer"}):null]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"√âquipements"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:ts.map(o=>{const l=t.equipment.includes(o.value),c=yt(o.value);return e.jsxs("button",{type:"button",onClick:()=>{const p=l?t.equipment.filter(S=>S!==o.value):[...t.equipment,o.value];s("equipment",p)},className:w("inline-flex items-center gap-2 rounded-full border px-3 py-2 text-xs font-semibold",l?"border-primary bg-primary text-primary-foreground":"border-border bg-card text-muted-foreground hover:bg-muted"),children:[e.jsx("span",{className:w("inline-flex h-7 w-7 items-center justify-center rounded-full",l?"bg-white/10":"bg-muted"),children:c?e.jsx("img",{src:c,alt:"",className:"h-4 w-4","aria-hidden":"true",loading:"lazy"}):null}),o.label]},o.value)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Modalit√©s"}),e.jsx("div",{className:"mt-1",children:e.jsx(Tt,{value:b,onChange:o=>s("modalities",o.target.value),placeholder:"Une modalit√© par ligne",rows:3,className:"rounded-2xl"})})]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[n&&e.jsx("button",{type:"button",onClick:n,className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-muted-foreground hover:bg-muted","aria-label":"Dupliquer exercice",title:"Dupliquer exercice",children:e.jsx(qt,{className:"h-4 w-4"})}),a&&r&&e.jsx("button",{type:"button",onClick:r,className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer exercice",title:"Supprimer exercice",children:e.jsx(ne,{className:"h-4 w-4"})})]})]})})}const ls={nc:"NC",educ:"Educ",jambes:"Jambes"},cs={nc:"bg-sky-100 text-sky-900 ring-sky-200",educ:"bg-violet-100 text-violet-900 ring-violet-200",jambes:"bg-teal-100 text-teal-900 ring-teal-200"},ds={V0:"text-intensity-1",V1:"text-intensity-2",V2:"text-intensity-3",V3:"text-intensity-4",Max:"text-intensity-5",Prog:"text-intensity-prog"},us={V0:"ring-intensity-1/30",V1:"ring-intensity-2/30",V2:"ring-intensity-3/30",V3:"ring-intensity-4/30",Max:"ring-intensity-5/30",Prog:"ring-intensity-prog/30"},ms=t=>t==="Max"?"MAX":t,ps=t=>{if(!t)return"";const s=Math.floor(t/60),r=t%60;return s>0&&r>0?`${s}'${r.toString().padStart(2,"0")}`:s>0?`${s}'00`:`${r}s`},ze=t=>{let s=0;return t.flatMap((r,n)=>r.exercises.map((a,x)=>{const b={block_title:r.title,block_description:r.description||null,block_order:n,block_repetitions:r.repetitions??null,block_modalities:r.modalities||null,block_equipment:r.equipment??[],exercise_repetitions:a.repetitions??null,exercise_rest:a.rest??null,exercise_rest_type:a.restType??"rest",exercise_stroke:a.stroke||null,exercise_stroke_type:a.strokeType||null,exercise_intensity:a.intensity?R(a.intensity):null,exercise_modalities:a.modalities||null,exercise_equipment:a.equipment??[],exercise_order:x},o=a.repetitions&&a.distance?`${a.repetitions}x${a.distance}m`:a.distance?`${a.distance}m`:null;return{ordre:s++,label:o,distance:a.distance??null,duration:null,intensity:a.intensity?R(a.intensity):null,notes:a.modalities||null,raw_payload:b}}))};function xs({session:t,onSessionChange:s,onSave:r,onCancel:n,userId:a,isSaving:x}){const{toast:b}=Oe(),[o,l]=O.useState("blocks"),[c,p]=O.useState(""),[S,k]=O.useState(null),[M,v]=O.useState(null),f=N.useMemo(()=>Ke(ze(t.blocks)),[t.blocks]),g=()=>{s({...t,blocks:[...t.blocks,{title:"Nouveau bloc",repetitions:1,description:"",modalities:"",equipment:[],exercises:[{repetitions:4,distance:50,rest:null,restType:"rest",stroke:"crawl",strokeType:"nc",intensity:"V2",modalities:"",equipment:[]}]}]})},A=(d,u,m)=>{const y=[...t.blocks];y[d]={...y[d],[u]:m},s({...t,blocks:y})},T=d=>{const u=t.blocks.filter((m,y)=>y!==d);s({...t,blocks:u})},E=(d,u)=>{const m=u==="up"?d-1:d+1;if(m<0||m>=t.blocks.length)return;const y=[...t.blocks],[_]=y.splice(d,1);y.splice(m,0,_),s({...t,blocks:y})},D=d=>{const u=[...t.blocks];u[d].exercises.push({repetitions:4,distance:50,rest:null,restType:"rest",stroke:"crawl",strokeType:"nc",intensity:"V2",modalities:"",equipment:[]}),s({...t,blocks:u})},$=(d,u,m,y)=>{const _=[...t.blocks],C=[..._[d].exercises];C[u]={...C[u],[m]:y},_[d]={..._[d],exercises:C},s({...t,blocks:_})},V=(d,u)=>{const m=[...t.blocks];m[d].exercises=m[d].exercises.filter((y,_)=>_!==u),s({...t,blocks:m})},L=(d,u)=>{const m=[...t.blocks],_={...m[d].exercises[u]};m[d].exercises=[...m[d].exercises.slice(0,u+1),_,...m[d].exercises.slice(u+1)],s({...t,blocks:m}),k({blockIndex:d,exerciseIndex:u+1})};return e.jsxs("div",{className:"animate-in slide-in-from-bottom-4 motion-reduce:animate-none",children:[e.jsx(Nt,{isEditing:!!t.id,isSaving:x,saveDisabled:o==="text",onSave:r,onCancel:n,onPreview:o==="blocks"?()=>v({id:t.id??Date.now(),name:t.name,description:t.description,created_by:a??null,items:ze(t.blocks)}):void 0}),e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(wt,{name:t.name,onNameChange:d=>s({...t,name:d}),estimatedDuration:t.estimatedDuration,onEstimatedDurationChange:d=>s({...t,estimatedDuration:d}),totalDistance:o==="blocks"?f:void 0,showDuration:!0,showTotalDistance:o==="blocks"}),e.jsxs("div",{className:"flex items-center rounded-xl border border-border bg-muted/50 p-0.5",children:[e.jsxs("button",{type:"button",onClick:()=>l("blocks"),className:w("flex flex-1 items-center justify-center gap-1.5 rounded-lg px-3 py-2 text-xs font-semibold transition-colors",o==="blocks"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(Ue,{className:"h-3.5 w-3.5"}),"Blocs"]}),e.jsxs("button",{type:"button",onClick:()=>l("text"),className:w("flex flex-1 items-center justify-center gap-1.5 rounded-lg px-3 py-2 text-xs font-semibold transition-colors",o==="text"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(bt,{className:"h-3.5 w-3.5"}),"Texte"]})]}),o==="text"?e.jsxs("div",{className:"space-y-3",children:[e.jsx("textarea",{value:c,onChange:d=>p(d.target.value),placeholder:`Collez ou tapez votre s√©ance ici‚Ä¶

Exemple :
√âchauffement
4x100 crawl V1 R30
8x50 educ dos V0

Corps de s√©ance
2x(4x100 NL V3 D1'30)
6x50 papillon jambes V2 R20

Retour au calme
200 4N souple`,className:"min-h-[280px] w-full resize-y rounded-2xl border border-border bg-card px-4 py-3 text-sm leading-relaxed placeholder:text-muted-foreground/60 focus:outline-none focus:ring-2 focus:ring-ring"}),e.jsxs("button",{type:"button",onClick:()=>{if(!c.trim())return;const d=es(c);if(d.length===0){b({title:"Aucun bloc reconnu",description:"V√©rifiez le format du texte.",variant:"destructive"});return}s({...t,blocks:d}),l("blocks"),b({title:`${d.length} bloc(s) import√©(s)`})},className:"inline-flex w-full items-center justify-center gap-2 rounded-full bg-primary px-4 py-2.5 text-sm font-semibold text-primary-foreground transition-colors hover:bg-primary/90",children:[e.jsx(Rt,{className:"h-4 w-4"}),"Convertir en s√©ance"]}),e.jsx("p",{className:"text-center text-[11px] text-muted-foreground",children:"La conversion analysera votre texte et cr√©era les blocs correspondants."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3",children:[t.blocks.map((d,u)=>e.jsxs("div",{className:"rounded-2xl border border-border bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between gap-1 px-3 py-2",children:[e.jsxs("div",{className:"flex min-w-0 flex-1 items-center gap-1.5",children:[e.jsxs("span",{className:"inline-flex shrink-0 items-center gap-1 rounded-full bg-primary px-2 py-0.5 text-[11px] font-semibold text-primary-foreground",children:[e.jsx(jt,{className:"inline h-3 w-3"})," ",d.repetitions??1,"x"]}),e.jsx(P,{value:d.title,onChange:m=>A(u,"title",m.target.value),placeholder:`Bloc ${u+1}`,className:"h-7 min-w-0 flex-1 rounded-lg border-none bg-transparent px-1 text-xs font-semibold shadow-none focus-visible:bg-muted focus-visible:ring-1"}),e.jsxs("div",{className:"shrink-0 text-[11px] text-muted-foreground whitespace-nowrap",children:["¬∑ ",d.exercises.length," ex"]})]}),e.jsxs("div",{className:"flex shrink-0 items-center gap-0.5",children:[e.jsx(P,{type:"number",min:1,value:d.repetitions??"",onChange:m=>A(u,"repetitions",m.target.value===""?null:Number(m.target.value)),className:"h-7 w-11 rounded-lg text-center text-xs",placeholder:"1"}),e.jsx("button",{type:"button",onClick:()=>E(u,"up"),className:"inline-flex h-7 w-7 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40",disabled:u===0,children:e.jsx(kt,{className:"h-3.5 w-3.5"})}),e.jsx("button",{type:"button",onClick:()=>E(u,"down"),className:"inline-flex h-7 w-7 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40",disabled:u===t.blocks.length-1,children:e.jsx(St,{className:"h-3.5 w-3.5"})}),e.jsx("button",{type:"button",onClick:()=>T(u),className:"inline-flex h-7 w-7 items-center justify-center rounded-full text-destructive hover:bg-destructive/10",children:e.jsx(ne,{className:"h-3.5 w-3.5"})})]})]}),e.jsx("div",{className:"border-t border-border",children:d.exercises.map((m,y)=>{const _=S?.blockIndex===u&&S?.exerciseIndex===y,C=R(m.intensity);return e.jsxs("div",{className:"border-b border-border last:border-b-0",children:[e.jsxs("button",{type:"button",onClick:()=>k(_?null:{blockIndex:u,exerciseIndex:y}),className:w("flex w-full items-center gap-1 px-3 py-2 text-left text-[11px] font-semibold transition-colors hover:bg-muted/50 overflow-hidden",_&&"bg-muted/50"),children:[e.jsxs("div",{className:"flex min-w-0 flex-1 flex-wrap items-center gap-1",children:[e.jsxs("span",{className:"text-muted-foreground whitespace-nowrap",children:[m.repetitions??"","√ó",m.distance??"","m"]}),e.jsx("span",{className:"text-muted-foreground whitespace-nowrap",children:m.stroke}),e.jsx("span",{className:w("inline-flex items-center rounded-full px-1.5 py-0.5 ring-1 whitespace-nowrap",cs[m.strokeType]??"bg-muted ring-border"),children:ls[m.strokeType]??m.strokeType}),e.jsxs("span",{className:w("inline-flex items-center gap-1 rounded-full bg-card px-1.5 py-0.5 ring-1 whitespace-nowrap",us[C],ds[C]),children:[e.jsx("span",{className:w("h-1.5 w-1.5 rounded-full",We[C]??"bg-muted")}),ms(C)]}),m.rest?e.jsxs("span",{className:"text-muted-foreground whitespace-nowrap",children:[m.restType==="departure"?"‚è±":"‚è∏"," ",m.restType==="departure"?"D√©p.":"Repos"," ",ps(m.rest)]}):null,m.equipment.length>0?e.jsxs("span",{className:"text-muted-foreground whitespace-nowrap",children:["üèä",m.equipment.length]}):null]}),e.jsx("span",{onClick:z=>{z.stopPropagation(),V(u,y)},className:"inline-flex h-6 w-6 shrink-0 items-center justify-center rounded-full text-destructive hover:bg-destructive/10",children:e.jsx(ne,{className:"h-3 w-3"})})]}),_?e.jsx("div",{className:"border-t border-border bg-muted/30 px-3 py-3",children:e.jsx(os,{exercise:m,onChange:(z,ee)=>$(u,y,z,ee),onDelete:()=>V(u,y),onDuplicate:()=>L(u,y),showDelete:!0})}):null]},y)})}),e.jsx("div",{className:"border-t border-border px-3 py-2",children:e.jsxs("button",{type:"button",onClick:()=>D(u),className:"inline-flex items-center gap-1 rounded-full bg-muted px-3 py-1.5 text-[11px] font-semibold text-muted-foreground hover:bg-muted/80",children:[e.jsx(ie,{className:"h-3 w-3"})," Exercice"]})})]},u)),t.blocks.length?null:e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-muted px-3 py-6 text-center text-sm text-muted-foreground",children:"Aucun bloc. Ajoute un bloc pour commencer."})]}),e.jsxs(W,{variant:"outline",size:"sm",onClick:g,className:"h-10 rounded-full px-3 text-xs",children:[e.jsx(ie,{className:"h-4 w-4"})," Ajouter bloc"]})]}),e.jsx("div",{className:"h-8"})]}),e.jsx(X,{open:!!M,onOpenChange:d=>{d||v(null)},children:e.jsx(Y,{className:"max-w-4xl",children:e.jsx(Qe,{title:M?.name??"",description:M?.description??void 0,items:M?.items})})})]})}function fs(t){N.useEffect(()=>{if(!t)return;const s=r=>{r.preventDefault()};return window.addEventListener("beforeunload",s),()=>window.removeEventListener("beforeunload",s)},[t])}function Ie(t){return`S√©ance du ${Mt(t,"dd/MM/yyyy")} - Soir - Matin`}const bs=t=>{let s=0;return t.flatMap((r,n)=>r.exercises.map((a,x)=>{const b={block_title:r.title,block_description:r.description||null,block_order:n,block_repetitions:r.repetitions??null,block_modalities:r.modalities||null,block_equipment:r.equipment??[],exercise_repetitions:a.repetitions??null,exercise_rest:a.rest??null,exercise_rest_type:a.restType??"rest",exercise_stroke:a.stroke||null,exercise_stroke_type:a.strokeType||null,exercise_intensity:a.intensity?R(a.intensity):null,exercise_modalities:a.modalities||null,exercise_equipment:a.equipment??[],exercise_order:x},o=a.repetitions&&a.distance?`${a.repetitions}x${a.distance}m`:a.distance?`${a.distance}m`:null;return{ordre:s++,label:o,distance:a.distance??null,duration:null,intensity:a.intensity?R(a.intensity):null,notes:a.modalities||null,raw_payload:b}}))},hs=(t=[])=>{const s=new Map;return t.forEach(r=>{const n=r.raw_payload??{},a=n.block_title||n.section||"Bloc",x=Number(n.block_order??0),b=`${x}-${a}`,o=n.block_equipment??n.equipment??[],l=(Array.isArray(o)?o:String(o).split(",")).map(k=>String(k)).map(k=>$e(k)).filter(Boolean);s.has(b)||s.set(b,{title:a,repetitions:n.block_repetitions??null,description:n.block_description??"",modalities:n.block_modalities??n.modalities??"",equipment:l,exercises:[],order:Number.isFinite(x)?x:0,exerciseOrder:new Map});const c=s.get(b),p=Number(n.exercise_order??r.ordre??c.exercises.length),S=R(n.exercise_intensity??r.intensity??"V1");c.exerciseOrder.set(p,{repetitions:n.exercise_repetitions??null,distance:r.distance??null,rest:n.exercise_rest??null,restType:n.exercise_rest_type??"rest",stroke:n.exercise_stroke??n.stroke??"crawl",strokeType:n.exercise_stroke_type??n.stroke_type??"nc",intensity:S,modalities:n.exercise_modalities??r.notes??"",equipment:Array.isArray(n.exercise_equipment)?n.exercise_equipment.map(k=>$e(k)):[]})}),Array.from(s.values()).sort((r,n)=>r.order-n.order).map(r=>({title:r.title,repetitions:r.repetitions,description:r.description,modalities:r.modalities,equipment:r.equipment,exercises:Array.from(r.exerciseOrder.entries()).sort(([n],[a])=>n-a).map(([,n])=>n)}))},gs=(t=[])=>new Set(t.map(r=>{const n=r.raw_payload;return n?.block_title||n?.section||"Bloc"})).size,H="swim_catalog_archived_ids",I="swim_catalog_archive_migrated",ys=(t,s)=>s===null?!1:!s.some(r=>r.session_type==="swim"&&r.session_id===t),js=(t,s)=>s===null?t:t.slice(s.length+1);function Qs(){const{toast:t}=Oe(),s=pt(),{userId:r,role:n}=ht(),[a,x]=N.useState(!1);fs(a);const[b,o]=N.useState(null),[l,c]=N.useState(null),[p,S]=N.useState(null),[k,M]=N.useState(""),[v,f]=N.useState(null),[g,A]=N.useState(!1),[T,E]=N.useState(!1),[D,$]=N.useState(""),[V,L]=N.useState(null),d=()=>({id:null,name:Ie(new Date),description:"",estimatedDuration:0,folder:v,blocks:[]}),[u,m]=N.useState(d),{data:y,isLoading:_,error:C,refetch:z}=be({queryKey:["swim_catalog"],queryFn:()=>B.getSwimCatalog()}),{data:ee,isLoading:Ye,isError:Je,error:ce,refetch:Ge}=be({queryKey:["coach-assignments"],queryFn:()=>B.getAssignmentsForCoach(),enabled:n==="coach"||n==="admin"});N.useEffect(()=>{if(typeof window>"u"||window.localStorage.getItem(I))return;const i=window.localStorage.getItem(H);if(!i){window.localStorage.setItem(I,"true");return}try{const h=JSON.parse(i);if(Array.isArray(h)&&h.length>0){const j=h.map(Number).filter(Number.isFinite);B.migrateLocalStorageArchive(j).then(()=>{window.localStorage.removeItem(H),window.localStorage.setItem(I,"true"),s.invalidateQueries({queryKey:["swim_catalog"]})}).catch(()=>{})}else window.localStorage.removeItem(H),window.localStorage.setItem(I,"true")}catch{window.localStorage.removeItem(H),window.localStorage.setItem(I,"true")}},[s]);const te=N.useMemo(()=>{const i=new Set;return(y??[]).forEach(h=>{if(h.folder){const j=h.folder.split("/");for(let q=1;q<=j.length;q++)i.add(j.slice(0,q).join("/"))}}),Array.from(i).sort()},[y]),se=N.useMemo(()=>{const i=v?v+"/":"",h=new Set;return te.forEach(j=>{if(v===null)j.includes("/")||h.add(j);else if(j.startsWith(i)){const q=j.slice(i.length);q&&!q.includes("/")&&h.add(j)}}),Array.from(h).sort()},[te,v]),Ze=N.useMemo(()=>{const i={};return(y??[]).filter(h=>!h.is_archived).forEach(h=>{h.folder&&se.forEach(j=>{(h.folder===j||h.folder.startsWith(j+"/"))&&(i[j]=(i[j]??0)+1)})}),i},[y,se]),de=N.useMemo(()=>(y??[]).filter(i=>i.is_archived).length,[y]),et=N.useMemo(()=>{let i=y??[];const h=k.trim().toLowerCase();return g?i=i.filter(j=>j.is_archived):(i=i.filter(j=>!j.is_archived),i=i.filter(j=>v===null?!j.folder:j.folder===v)),h&&(i=i.filter(j=>j.name.toLowerCase().includes(h))),i},[y,k,v,g]),ue=K({mutationFn:i=>B.createSwimSession(i),onSuccess:(i,h)=>{s.invalidateQueries({queryKey:["swim_catalog"]}),x(!1),m(d()),t({title:h?.id?"S√©ance natation mise √† jour":"S√©ance natation cr√©√©e"})}}),me=K({mutationFn:i=>B.deleteSwimSession(i),onSuccess:()=>{s.invalidateQueries({queryKey:["swim_catalog"]}),c(null),t({title:"S√©ance supprim√©e"})},onError:()=>{t({title:"Suppression impossible",description:"Cette s√©ance est utilis√©e dans une assignation.",variant:"destructive"})}}),pe=K({mutationFn:({sessionId:i,archived:h})=>B.archiveSwimSession(i,h),onSuccess:(i,h)=>{s.invalidateQueries({queryKey:["swim_catalog"]}),S(null),t({title:h.archived?"S√©ance archiv√©e":"S√©ance restaur√©e"})}}),tt=K({mutationFn:({sessionId:i,folder:h})=>B.moveSwimSession(i,h),onSuccess:()=>{s.invalidateQueries({queryKey:["swim_catalog"]}),L(null),t({title:"S√©ance d√©plac√©e"})}}),st=()=>{if(!u.name.trim()){t({title:"Titre requis",description:"Ajoutez un nom de s√©ance avant d'enregistrer.",variant:"destructive"});return}ue.mutate({id:u.id??void 0,name:u.name,description:u.description,estimated_duration:u.estimatedDuration||null,folder:u.folder??v,items:bs(u.blocks),created_by:r??null})},rt=()=>{x(!1),m(d())},nt=i=>{m({id:i.id??null,name:i.name??Ie(new Date),description:i.description??"",estimatedDuration:Number(i.estimated_duration??0),folder:i.folder??null,blocks:hs(i.items??[])}),x(!0)},it=i=>{S(i)},at=()=>{p&&pe.mutate({sessionId:p.id,archived:!0})},ot=i=>{pe.mutate({sessionId:i.id,archived:!1})},lt=i=>{c(i)},ct=()=>{l&&me.mutate(l.id)},xe=()=>{const i=D.trim();if(!i)return;const h=v?`${v}/${i}`:i;f(h),E(!1),$("")},fe=i=>{V&&tt.mutate({sessionId:V.id,folder:i})},dt=i=>{const h=Ke(i.items??[]),q=i.items?.some(re=>re.duration!=null)??!1?i.items?.reduce((re,mt)=>re+(mt.duration??0),0)??0:null,ut=gs(i.items??[]);return e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(vt,{className:"h-3.5 w-3.5"}),h,"m"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Vt,{className:"h-3.5 w-3.5"}),"~",q??"‚Äî"," min"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Ue,{className:"h-3.5 w-3.5"}),ut]})]})};return a?e.jsx(xs,{session:u,onSessionChange:m,onSave:st,onCancel:rt,userId:r,isSaving:ue.isPending}):_||Ye?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{children:[e.jsx(U,{className:"h-5 w-16 mb-1"}),e.jsx(U,{className:"h-3 w-20"})]}),e.jsx(U,{className:"h-9 w-24 rounded-full"})]}),e.jsxs("div",{className:"p-4",children:[e.jsx(U,{className:"h-10 w-full rounded-2xl mb-4"}),e.jsx(Ce,{sessions:[],isLoading:!0,renderTitle:()=>"",renderMetrics:()=>null,onPreview:()=>{},onEdit:()=>{},onArchive:()=>{},onDelete:()=>{},canDelete:()=>!1})]})]}):C?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(qe,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les donn√©es"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:C instanceof Error?C.message:"Une erreur s'est produite"}),e.jsx(W,{variant:"default",onClick:()=>z(),className:"mt-4 h-12 md:h-10",children:"R√©essayer"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:"Coach"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Cr√©ation"})]}),!g&&e.jsxs("button",{type:"button",onClick:()=>{m(d()),x(!0)},className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(ie,{className:"h-4 w-4"})," Nouvelle"]})]}),e.jsxs("div",{className:"p-4",children:[(v!==null||g)&&e.jsx(He,{className:"mb-3",children:e.jsxs(Xe,{children:[e.jsx(J,{children:e.jsx(ae,{className:"cursor-pointer",onClick:()=>{f(null),A(!1)},children:e.jsx(Be,{className:"h-4 w-4"})})}),g?e.jsxs(e.Fragment,{children:[e.jsx(le,{}),e.jsx(J,{children:e.jsx(oe,{children:"Archives"})})]}):v?.split("/").map((i,h,j)=>e.jsxs(O.Fragment,{children:[e.jsx(le,{}),e.jsx(J,{children:h===j.length-1?e.jsx(oe,{children:i}):e.jsx(ae,{className:"cursor-pointer",onClick:()=>f(j.slice(0,h+1).join("/")),children:i})})]},h))]})}),e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-border bg-card px-3 py-2",children:[e.jsx(At,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{className:"w-full bg-transparent text-sm outline-none placeholder:text-muted-foreground",placeholder:"Rechercher une s√©ance",value:k,onChange:i=>M(i.target.value)})]}),!g&&e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[se.map(i=>e.jsxs("button",{type:"button",onClick:()=>f(i),className:"inline-flex items-center gap-1.5 rounded-xl border border-border bg-card px-3 py-1.5 text-sm font-medium hover:bg-muted transition-colors",children:[e.jsx(Ee,{className:"h-4 w-4 text-muted-foreground"}),js(i,v),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",Ze[i]??0,")"]})]},i)),e.jsxs("button",{type:"button",onClick:()=>E(!0),className:"inline-flex items-center gap-1.5 rounded-xl border border-dashed border-border px-3 py-1.5 text-sm text-muted-foreground hover:bg-muted transition-colors",children:[e.jsx(_t,{className:"h-4 w-4"}),"Nouveau dossier"]}),v===null&&de>0&&e.jsxs("button",{type:"button",onClick:()=>A(!0),className:"inline-flex items-center gap-1.5 rounded-xl border border-border bg-muted/50 px-3 py-1.5 text-sm text-muted-foreground hover:bg-muted transition-colors",children:[e.jsx(Ct,{className:"h-4 w-4"}),"Archives",e.jsxs("span",{className:"text-xs",children:["(",de,")"]})]})]}),Je&&e.jsxs("div",{className:"mt-4 flex flex-col items-center rounded-lg border border-destructive/20 bg-destructive/10 p-4",children:[e.jsx(qe,{className:"h-8 w-8 text-destructive mb-2"}),e.jsx("p",{className:"text-sm text-destructive font-semibold",children:"Impossible de charger les assignations"}),e.jsx("p",{className:"text-xs text-destructive/80 mt-1",children:ce instanceof Error?ce.message:"Une erreur s'est produite"}),e.jsx(W,{variant:"outline",size:"sm",onClick:()=>Ge(),className:"mt-2 h-10",children:"R√©essayer"})]}),e.jsx("div",{className:"mt-4",children:e.jsx(Ce,{sessions:et,isLoading:_,error:C,renderTitle:i=>i.name,renderMetrics:dt,onPreview:o,onEdit:nt,onArchive:g?ot:it,onDelete:lt,canDelete:i=>ys(i,ee??null),isDeleting:me.isPending,onMove:g?void 0:i=>L(i),archiveMode:g?"restore":"archive"})}),e.jsx("div",{className:"h-8"})]}),e.jsx(X,{open:!!b,onOpenChange:i=>{i||o(null)},children:e.jsx(Y,{className:"max-w-4xl",children:e.jsx(Qe,{title:b?.name??"",description:b?.description??void 0,items:b?.items})})}),e.jsx(X,{open:T,onOpenChange:E,children:e.jsxs(Y,{children:[e.jsx(he,{children:e.jsx(ge,{children:"Nouveau dossier"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(P,{placeholder:"Nom du dossier",value:D,onChange:i=>$(i.target.value),onKeyDown:i=>{i.key==="Enter"&&xe()},className:"rounded-2xl"}),D.trim()&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Chemin : ",v?`${v}/${D.trim()}`:D.trim()]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(W,{variant:"outline",onClick:()=>{E(!1),$("")},children:"Annuler"}),e.jsx(W,{onClick:xe,disabled:!D.trim(),children:"Cr√©er"})]})]})]})}),e.jsx(X,{open:!!V,onOpenChange:i=>{i||L(null)},children:e.jsxs(Y,{children:[e.jsx(he,{children:e.jsxs(ge,{children:["D√©placer ¬´ ",V?.name," ¬ª"]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("button",{type:"button",onClick:()=>fe(null),className:`w-full rounded-xl px-3 py-2 text-left text-sm font-medium transition-colors hover:bg-muted ${V?.folder?"text-muted-foreground":"bg-muted text-foreground"}`,children:[e.jsx(Be,{className:"mr-2 inline h-4 w-4"}),"Racine"]}),te.map(i=>e.jsxs("button",{type:"button",onClick:()=>fe(i),className:`w-full rounded-xl px-3 py-2 text-left text-sm font-medium transition-colors hover:bg-muted ${V?.folder===i?"bg-muted text-foreground":"text-muted-foreground"}`,children:[e.jsx(Ee,{className:"mr-2 inline h-4 w-4"}),i]},i))]})]})}),e.jsx(ye,{open:!!p,onOpenChange:i=>{i||S(null)},children:e.jsxs(je,{children:[e.jsxs(ve,{children:[e.jsx(Ne,{children:"Archiver la s√©ance ?"}),e.jsx(we,{children:"La s√©ance sera d√©plac√©e dans les archives. Vous pourrez la restaurer √† tout moment."})]}),e.jsxs(ke,{children:[e.jsx(Se,{children:"Annuler"}),e.jsx(_e,{onClick:at,children:"Archiver"})]})]})}),e.jsx(ye,{open:!!l,onOpenChange:i=>{i||c(null)},children:e.jsxs(je,{children:[e.jsxs(ve,{children:[e.jsx(Ne,{children:"Supprimer la s√©ance ?"}),e.jsx(we,{children:"Cette action est d√©finitive. La s√©ance sera supprim√©e du catalogue."})]}),e.jsxs(ke,{children:[e.jsx(Se,{children:"Annuler"}),e.jsx(_e,{onClick:ct,children:"Supprimer"})]})]})})]})}export{ys as canDeleteSwimCatalog,Qs as default};
