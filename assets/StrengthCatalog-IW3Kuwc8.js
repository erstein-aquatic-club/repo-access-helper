import{r as d,b as ys,h as Ns,m as Le,n as bs,j as e,d as Oe,o as _s,l as X,u as ue,I as ws,t as Ss,E as Cs}from"./vendor-ui-DJQMR4VV.js";import{b as Es,u as Ne,c as $}from"./vendor-query-BT4y-huw.js";import{c as Ge,a as q,C as Rs,L as N,I as k,f as ks,d as I,B as T,S as se,D as be,s as _e}from"./index-p3lMzPTv.js";import{u as Ds,S as re,a as ae,b as ne,c as ie,d as A}from"./select-BFT7QT53.js";import{C as Fs}from"./circle-C-K4rXel.js";import{T as V}from"./textarea-dgPf_0hf.js";import{D as Q,a as W,b as le,c as ce}from"./dialog-CzWpLOQP.js";import{C as we}from"./checkbox-LsmNkHm3.js";import{A as Se,a as Ce,b as Ee,c as Re,d as ke,e as De,f as Fe,g as Ie}from"./alert-dialog-gPCvsP3N.js";import{T as Is,a as As,b as Ms,c as Ps}from"./tabs-Bt3tZWC_.js";import{A as $s,a as Ts,F as Ls,S as Os,b as Gs}from"./SessionListView-1YC8TR0r.js";import{C as qs}from"./chevron-up-VxPSOCWt.js";import{T as qe,P as H}from"./trash-2-Dy8-qqxu.js";import{L as Ae}from"./loader-circle-5sjHJh8V.js";import{C as Us}from"./circle-alert-DI28R9Xv.js";import{S as Ks}from"./search-BgMmQs7Z.js";import{P as Bs}from"./pen-Cl2SomxM.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-Db4xOvcx.js";import"./vendor-supabase-D7B1G6YZ.js";import"./check-BguUDhs-.js";import"./chevron-left-CGUrpBr7.js";import"./save-FwOiHuZ-.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Vs=Ge("funnel",zs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Me=Ge("upload",Qs);function oe(t,r,{checkForDefaultPrevented:a=!0}={}){return function(n){if(t?.(n),a===!1||!n.defaultPrevented)return r?.(n)}}var Ws=ys[" useInsertionEffect ".trim().toString()]||Ns;function Hs({prop:t,defaultProp:r,onChange:a=()=>{},caller:c}){const[n,l,g]=Xs({defaultProp:r,onChange:a}),x=t!==void 0,b=x?t:n;{const o=d.useRef(t!==void 0);d.useEffect(()=>{const h=o.current;h!==x&&console.warn(`${c} is changing from ${h?"controlled":"uncontrolled"} to ${x?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),o.current=x},[x,c])}const u=d.useCallback(o=>{if(x){const h=Ys(o)?o(t):o;h!==t&&g.current?.(h)}else l(o)},[x,t,l,g]);return[b,u]}function Xs({defaultProp:t,onChange:r}){const[a,c]=d.useState(t),n=d.useRef(a),l=d.useRef(r);return Ws(()=>{l.current=r},[r]),d.useEffect(()=>{n.current!==a&&(l.current?.(a),n.current=a)},[a,n]),[a,c,l]}function Ys(t){return typeof t=="function"}var me="Radio",[Js,Ue]=Oe(me),[Zs,et]=Js(me),Ke=d.forwardRef((t,r)=>{const{__scopeRadio:a,name:c,checked:n=!1,required:l,disabled:g,value:x="on",onCheck:b,form:u,...o}=t,[h,w]=d.useState(null),j=ue(r,D=>w(D)),_=d.useRef(!1),E=h?u||!!h.closest("form"):!0;return e.jsxs(Zs,{scope:a,checked:n,disabled:g,children:[e.jsx(X.button,{type:"button",role:"radio","aria-checked":n,"data-state":Qe(n),"data-disabled":g?"":void 0,disabled:g,value:x,...o,ref:j,onClick:oe(t.onClick,D=>{n||b?.(),E&&(_.current=D.isPropagationStopped(),_.current||D.stopPropagation())})}),E&&e.jsx(Ve,{control:h,bubbles:!_.current,name:c,value:x,checked:n,required:l,disabled:g,form:u,style:{transform:"translateX(-100%)"}})]})});Ke.displayName=me;var Be="RadioIndicator",ze=d.forwardRef((t,r)=>{const{__scopeRadio:a,forceMount:c,...n}=t,l=et(Be,a);return e.jsx(Ss,{present:c||l.checked,children:e.jsx(X.span,{"data-state":Qe(l.checked),"data-disabled":l.disabled?"":void 0,...n,ref:r})})});ze.displayName=Be;var st="RadioBubbleInput",Ve=d.forwardRef(({__scopeRadio:t,control:r,checked:a,bubbles:c=!0,...n},l)=>{const g=d.useRef(null),x=ue(g,l),b=Ds(a),u=Cs(r);return d.useEffect(()=>{const o=g.current;if(!o)return;const h=window.HTMLInputElement.prototype,j=Object.getOwnPropertyDescriptor(h,"checked").set;if(b!==a&&j){const _=new Event("click",{bubbles:c});j.call(o,a),o.dispatchEvent(_)}},[b,a,c]),e.jsx(X.input,{type:"radio","aria-hidden":!0,defaultChecked:a,...n,tabIndex:-1,ref:x,style:{...n.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Ve.displayName=st;function Qe(t){return t?"checked":"unchecked"}var tt=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Y="RadioGroup",[rt]=Oe(Y,[Le,Ue]),We=Le(),He=Ue(),[at,nt]=rt(Y),Xe=d.forwardRef((t,r)=>{const{__scopeRadioGroup:a,name:c,defaultValue:n,value:l,required:g=!1,disabled:x=!1,orientation:b,dir:u,loop:o=!0,onValueChange:h,...w}=t,j=We(a),_=bs(u),[E,D]=Hs({prop:l,defaultProp:n??null,onChange:h,caller:Y});return e.jsx(at,{scope:a,name:c,required:g,disabled:x,value:E,onValueChange:D,children:e.jsx(_s,{asChild:!0,...j,orientation:b,dir:_,loop:o,children:e.jsx(X.div,{role:"radiogroup","aria-required":g,"aria-orientation":b,"data-disabled":x?"":void 0,dir:_,...w,ref:r})})})});Xe.displayName=Y;var Ye="RadioGroupItem",Je=d.forwardRef((t,r)=>{const{__scopeRadioGroup:a,disabled:c,...n}=t,l=nt(Ye,a),g=l.disabled||c,x=We(a),b=He(a),u=d.useRef(null),o=ue(r,u),h=l.value===n.value,w=d.useRef(!1);return d.useEffect(()=>{const j=E=>{tt.includes(E.key)&&(w.current=!0)},_=()=>w.current=!1;return document.addEventListener("keydown",j),document.addEventListener("keyup",_),()=>{document.removeEventListener("keydown",j),document.removeEventListener("keyup",_)}},[]),e.jsx(ws,{asChild:!0,...x,focusable:!g,active:h,children:e.jsx(Ke,{disabled:g,required:l.required,checked:h,...b,...n,name:l.name,ref:o,onCheck:()=>l.onValueChange(n.value),onKeyDown:oe(j=>{j.key==="Enter"&&j.preventDefault()}),onFocus:oe(n.onFocus,()=>{w.current&&u.current?.click()})})})});Je.displayName=Ye;var it="RadioGroupIndicator",Ze=d.forwardRef((t,r)=>{const{__scopeRadioGroup:a,...c}=t,n=He(a);return e.jsx(ze,{...n,...c,ref:r})});Ze.displayName=it;var es=Xe,ss=Je,lt=Ze;const ts=d.forwardRef(({className:t,...r},a)=>e.jsx(es,{className:q("grid gap-2",t),...r,ref:a}));ts.displayName=es.displayName;const de=d.forwardRef(({className:t,...r},a)=>e.jsx(ss,{ref:a,className:q("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),...r,children:e.jsx(lt,{className:"flex items-center justify-center",children:e.jsx(Fs,{className:"h-3.5 w-3.5 fill-primary"})})}));de.displayName=ss.displayName;function ct({exercise:t,exercises:r,exerciseFilter:a,index:c,totalItems:n,onChange:l,onDelete:g,onMoveUp:x,onMoveDown:b}){const[u,o]=d.useState(!1),[h,w]=d.useState(!1),j=r.filter(m=>a==="all"?!0:m.exercise_type===a),_=r.find(m=>m.id===t.exercise_id),E=_?.nom_exercice??"Exercice",D=_?.exercise_type==="warmup",F=_?.illustration_gif;return e.jsxs(e.Fragment,{children:[e.jsxs(Rs,{className:q("rounded-2xl border-border transition-all",u&&"ring-1 ring-primary/20"),children:[e.jsxs("button",{type:"button",className:"flex w-full items-center gap-3 p-3 text-left",onClick:()=>o(!u),children:[e.jsx("span",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-muted text-xs font-bold text-muted-foreground",children:c+1}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"truncate text-sm font-semibold",children:E}),D&&e.jsx("span",{className:"shrink-0 rounded-full bg-amber-100 px-2 py-0.5 text-[10px] font-semibold text-amber-800",children:"Échauf."})]}),e.jsxs("div",{className:"mt-0.5 text-xs text-muted-foreground",children:[t.sets,"×",t.reps,t.percent_1rm?` @ ${t.percent_1rm}% 1RM`:"",t.rest_seconds?` · ${t.rest_seconds}s repos`:""]})]}),F&&e.jsx("button",{type:"button",className:"shrink-0 rounded-lg overflow-hidden border border-border bg-muted",onClick:m=>{m.stopPropagation(),w(!0)},children:e.jsx("img",{src:F,alt:E,className:"h-9 w-9 object-cover"})}),e.jsx(qs,{className:q("h-4 w-4 shrink-0 text-muted-foreground transition-transform",u&&"rotate-180")})]}),u&&e.jsxs("div",{className:"border-t border-border px-3 pb-3 pt-3 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(N,{className:"text-xs",children:"Séries"}),e.jsx(k,{type:"number",inputMode:"numeric",value:t.sets===0?"":t.sets,onChange:m=>l("sets",m.target.value===""?0:Number(m.target.value)),className:"rounded-xl h-10"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(N,{className:"text-xs",children:"Reps"}),e.jsx(k,{type:"number",inputMode:"numeric",value:t.reps===0?"":t.reps,onChange:m=>l("reps",m.target.value===""?0:Number(m.target.value)),className:"rounded-xl h-10"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(N,{className:"text-xs",children:"% 1RM"}),e.jsx(k,{type:"number",inputMode:"numeric",value:t.percent_1rm===0?"":t.percent_1rm,onChange:m=>l("percent_1rm",m.target.value===""?0:Number(m.target.value)),className:"rounded-xl h-10"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(N,{className:"text-xs",children:"Repos (s)"}),e.jsx(k,{type:"number",inputMode:"numeric",value:t.rest_seconds===0?"":t.rest_seconds,onChange:m=>l("rest_seconds",m.target.value===""?0:Number(m.target.value)),className:"rounded-xl h-10"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(N,{className:"text-xs",children:"Exercice"}),e.jsxs(re,{value:t.exercise_id.toString(),onValueChange:m=>l("exercise_id",parseInt(m)),children:[e.jsx(ae,{className:"rounded-xl",children:e.jsx(ne,{})}),e.jsx(ie,{children:j.length?j.map(m=>e.jsxs(A,{value:m.id.toString(),children:[m.nom_exercice,m.exercise_type==="warmup"?" · Échauffement":""]},m.id)):e.jsx(A,{value:"no-exercise",disabled:!0,children:"Aucun exercice disponible"})})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(N,{className:"text-xs",children:"Notes"}),e.jsx(V,{value:t.notes??"",onChange:m=>l("notes",m.target.value||null),placeholder:"Notes optionnelles...",className:"rounded-xl min-h-[60px]"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:m=>{m.stopPropagation(),x()},disabled:c===0,className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-30","aria-label":"Monter",children:e.jsx($s,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:m=>{m.stopPropagation(),b()},disabled:c===n-1,className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-30","aria-label":"Descendre",children:e.jsx(Ts,{className:"h-4 w-4"})})]}),e.jsxs("button",{type:"button",onClick:m=>{m.stopPropagation(),g()},className:"inline-flex h-9 items-center gap-2 rounded-full px-3 text-xs font-medium text-destructive hover:bg-destructive/10",children:[e.jsx(qe,{className:"h-3.5 w-3.5"}),"Supprimer"]})]})]})]}),F&&e.jsx(Q,{open:h,onOpenChange:w,children:e.jsx(W,{className:"sm:max-w-md p-2",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("img",{src:F,alt:E,className:"w-full max-h-[70vh] object-contain rounded-lg"}),e.jsx("p",{className:"text-sm font-medium text-center",children:E})]})})})]})}const ot=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance";function dt({session:t,exercises:r,editingSessionId:a,onSessionChange:c,onCycleChange:n,onSave:l,onCancel:g,onAddItem:x,onUpdateItem:b,onRemoveItem:u,onReorderItems:o,onExerciseDialogOpen:h,isSaving:w}){const[j,_]=d.useState("all"),[E,D]=d.useState(!1),[F,m]=d.useState(!1),U=new Map(r.map(p=>[p.id,p])),M=t.items.reduce((p,f)=>p+(f.sets||0),0),K=p=>{p>0&&o(p,p-1)},L=p=>{p<t.items.length-1&&o(p,p+1)},J=()=>{D(!0)};return e.jsxs("div",{className:"space-y-4 animate-in slide-in-from-bottom-4",children:[e.jsx(Ls,{isEditing:!!a,isSaving:w,onSave:l,onCancel:g,onPreview:J}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(Os,{name:t.title,onNameChange:p=>c({...t,title:p}),showDuration:!1,showTotalDistance:!1,collapsible:!0,collapsed:F,onToggleCollapse:()=>m(!F),collapsedSummary:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:t.title||"Sans titre"}),e.jsx("span",{children:"·"}),e.jsx("span",{className:"capitalize",children:t.cycle}),e.jsx("span",{children:"·"}),e.jsxs("span",{children:[M," séries"]})]}),additionalFields:e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Cycle"}),e.jsx("div",{className:"mt-1",children:e.jsxs(re,{value:t.cycle,onValueChange:p=>n(ot(p)),children:[e.jsx(ae,{className:"rounded-2xl",children:e.jsx(ne,{})}),e.jsxs(ie,{children:[e.jsx(A,{value:"endurance",children:"Endurance"}),e.jsx(A,{value:"hypertrophie",children:"Hypertrophie"}),e.jsx(A,{value:"force",children:"Force"})]})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Séries totales"}),e.jsx("div",{className:"mt-1 rounded-2xl border border-border bg-muted px-3 py-2 text-sm font-semibold",children:M})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Description"}),e.jsx("div",{className:"mt-1",children:e.jsx(V,{value:t.description,onChange:p=>c({...t,description:p.target.value}),placeholder:"Description optionnelle...",className:"rounded-2xl min-h-[60px]"})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-semibold",children:["Exercices (",t.items.length,")"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(re,{value:j,onValueChange:p=>_(p),children:[e.jsxs(ae,{className:"h-8 w-auto gap-1 rounded-full border-dashed text-xs",children:[e.jsx(Vs,{className:"h-3 w-3"}),e.jsx(ne,{})]}),e.jsxs(ie,{children:[e.jsx(A,{value:"all",children:"Tous"}),e.jsx(A,{value:"strength",children:"Travail"}),e.jsx(A,{value:"warmup",children:"Échauf."})]})]})})]}),e.jsx("div",{className:"space-y-2",children:t.items.map((p,f)=>e.jsx(ct,{exercise:p,exercises:r,exerciseFilter:j,index:f,totalItems:t.items.length,onChange:(R,C)=>b(f,R,C),onDelete:()=>u(f),onMoveUp:()=>K(f),onMoveDown:()=>L(f)},`${p.exercise_id}-${f}`))}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:x,className:"inline-flex items-center gap-2 rounded-full bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(H,{className:"h-4 w-4"})," Ajouter un exercice"]}),e.jsxs("button",{type:"button",onClick:h,className:"inline-flex items-center gap-2 rounded-full border border-border px-4 py-2 text-xs font-semibold hover:bg-muted",children:[e.jsx(H,{className:"h-4 w-4"})," Nouvel exercice"]})]})]}),e.jsx(Q,{open:E,onOpenChange:D,children:e.jsxs(W,{className:"sm:max-w-3xl",children:[e.jsx(le,{children:e.jsx(ce,{children:"Aperçu de la séance"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-lg font-semibold",children:t.title||"Sans titre"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description||"—"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cycle : ",t.cycle]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Exercices"}),e.jsx("div",{className:"space-y-2",children:t.items.slice().sort((p,f)=>(p.order_index??0)-(f.order_index??0)).map((p,f)=>{const R=U.get(p.exercise_id);return e.jsxs("div",{className:"rounded-xl border px-3 py-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("span",{className:"font-medium",children:[f+1,". ",R?.nom_exercice??"Exercice"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:R?.exercise_type==="warmup"?"Échauffement":"Travail"})]}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[p.sets," séries • ",p.reps," reps • ",p.percent_1rm,"% 1RM •"," ",p.rest_seconds,"s"]})]},`${p.exercise_id}-${f}`)})})]})]})]})})]})}const Pe=[{key:"endurance",label:"Endurance",fieldSuffix:"endurance"},{key:"hypertrophie",label:"Hypertrophie",fieldSuffix:"hypertrophie"},{key:"force",label:"Force",fieldSuffix:"force"}],ut=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance",$e=({exercise:t,onChange:r,disabled:a=!1})=>e.jsxs(Is,{defaultValue:"endurance",className:"w-full",children:[e.jsx(As,{className:"grid w-full grid-cols-3",children:Pe.map(c=>e.jsx(Ms,{value:c.key,children:c.label},c.key))}),Pe.map(c=>{const n=`pct_1rm_${c.fieldSuffix}`,l=`Nb_series_${c.fieldSuffix}`,g=`Nb_reps_${c.fieldSuffix}`,x=`recup_${c.fieldSuffix}`,b=`recup_exercices_${c.fieldSuffix}`;return e.jsxs(Ps,{value:c.key,className:`space-y-3 rounded-lg border p-3 ${a?"opacity-60":""}`,children:[e.jsx("p",{className:"text-sm font-semibold",children:c.label}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"% 1RM"}),e.jsx(k,{type:"number",value:t[n]??"",disabled:a,onChange:u=>r({[n]:u.target.value===""?null:Number(u.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Nb séries"}),e.jsx(k,{type:"number",value:t[l]??"",disabled:a,onChange:u=>r({[l]:u.target.value===""?null:Number(u.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Nb reps"}),e.jsx(k,{type:"number",value:t[g]??"",disabled:a,onChange:u=>r({[g]:u.target.value===""?null:Number(u.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Récup. séries (s)"}),e.jsx(k,{type:"number",value:t[x]??"",disabled:a,onChange:u=>r({[x]:u.target.value===""?null:Number(u.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Récup. exercices (s)"}),e.jsx(k,{type:"number",value:t[b]??"",disabled:a,onChange:u=>r({[b]:u.target.value===""?null:Number(u.target.value)})})]})]})]},c.key)})]}),mt={pct_1rm_endurance:60,pct_1rm_hypertrophie:75,pct_1rm_force:85,Nb_series_endurance:4,Nb_series_hypertrophie:3,Nb_series_force:3,Nb_reps_endurance:16,Nb_reps_hypertrophie:8,Nb_reps_force:3,recup_endurance:120,recup_hypertrophie:200,recup_force:300,recup_exercices_endurance:300,recup_exercices_hypertrophie:400,recup_exercices_force:500},z=t=>{const r=Number(t);return Number.isFinite(r)?r:0},te=(t,r,a,c)=>{const n=r==="force"?"force":r==="hypertrophie"?"hypertrophie":"endurance",l=`Nb_series_${n}`,g=`Nb_reps_${n}`,x=`pct_1rm_${n}`,b=`recup_${n}`;return{exercise_id:t.id,order_index:a,sets:z(t[l]),reps:z(t[g]),rest_seconds:z(t[b]),percent_1rm:z(t[x]),cycle_type:r,notes:c?.notes??""}},pt=()=>({nom_exercice:"",description:null,illustration_gif:null,exercise_type:"strength",warmup_reps:null,warmup_duration:null,...mt}),Te=({exercise:t,warmupMode:r,onChange:a,onWarmupModeChange:c,idPrefix:n})=>e.jsxs("div",{className:"space-y-3 rounded-lg border p-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Paramètres d'échauffement"}),e.jsxs(ts,{value:r,onValueChange:l=>{c(l==="duration"?"duration":"reps"),a(l==="duration"?{warmup_reps:null,warmup_duration:t.warmup_duration??0}:{warmup_duration:null,warmup_reps:t.warmup_reps??0})},className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(de,{value:"reps",id:`${n}-warmup-reps`}),e.jsx(N,{htmlFor:`${n}-warmup-reps`,children:"Nombre de répétitions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(de,{value:"duration",id:`${n}-warmup-duration`}),e.jsx(N,{htmlFor:`${n}-warmup-duration`,children:"Durée (secondes)"})]})]}),r==="duration"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Durée (s)"}),e.jsx(k,{type:"number",value:t.warmup_duration??"",onChange:l=>a({warmup_duration:l.target.value===""?null:Number(l.target.value)})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Nombre de répétitions"}),e.jsx(k,{type:"number",value:t.warmup_reps??"",onChange:l=>a({warmup_reps:l.target.value===""?null:Number(l.target.value)})})]})]});function Lt(){const{toast:t}=ks(),r=Es(),[a,c]=d.useState(!1),[n,l]=d.useState(null),[g,x]=d.useState(!1),[b,u]=d.useState(!1),[o,h]=d.useState(null),[w,j]=d.useState(null),[_,E]=d.useState(null),[D,F]=d.useState("reps"),[m,U]=d.useState("reps"),[M,K]=d.useState(!1),[L,J]=d.useState(""),p=async(s,i)=>{if(s.size>10485760){t({title:"Fichier trop volumineux",description:"La taille maximale est de 10 Mo.",variant:"destructive"});return}K(!0);try{const y=s.name.split(".").pop()??"gif",S=`exercises/${Date.now()}-${Math.random().toString(36).slice(2)}.${y}`,{error:G}=await _e.storage.from("exercise-gifs").upload(S,s,{upsert:!1});if(G)throw G;const{data:vs}=_e.storage.from("exercise-gifs").getPublicUrl(S);i(vs.publicUrl),t({title:"Image uploadée"})}catch(y){const S=y instanceof Error?y.message:"Réessayez.";t({title:"Erreur d'upload",description:S,variant:"destructive"})}finally{K(!1)}},[f,R]=d.useState({title:"",description:"",cycle:"endurance",items:[]}),[C,P]=d.useState({...pt()});d.useEffect(()=>{o&&U(o.warmup_duration!=null?"duration":"reps")},[o]);const{data:O,isLoading:rs,error:Z,refetch:as}=Ne({queryKey:["exercises"],queryFn:()=>I.getExercises()}),{data:B,isLoading:ns,error:is,refetch:xt}=Ne({queryKey:["strength_catalog"],queryFn:()=>I.getStrengthSessions()}),ls=d.useMemo(()=>{if(!B)return[];if(!L.trim())return B;const s=L.toLowerCase();return B.filter(i=>i.title?.toLowerCase().includes(s))},[B,L]),cs=$({mutationFn:s=>I.createExercise(s),onSuccess:()=>{r.invalidateQueries({queryKey:["exercises"]}),x(!1),t({title:"Exercice ajouté"})}}),pe=$({mutationFn:s=>I.createStrengthSession(s),onSuccess:()=>{r.invalidateQueries({queryKey:["strength_catalog"]}),c(!1),R({title:"",description:"",cycle:"endurance",items:[]}),t({title:"Séance créée avec succès"})}}),os=$({mutationFn:s=>I.updateExercise(s),onSuccess:()=>{r.invalidateQueries({queryKey:["exercises"]}),r.invalidateQueries({queryKey:["strength_catalog"]}),u(!1),h(null),t({title:"Exercice mis à jour"})}}),ds=$({mutationFn:s=>I.deleteExercise(s),onSuccess:()=>{r.invalidateQueries({queryKey:["exercises"]}),r.invalidateQueries({queryKey:["strength_catalog"]}),E(null),t({title:"Exercice supprimé"})}}),xe=$({mutationFn:s=>I.deleteStrengthSession(s),onSuccess:()=>{r.invalidateQueries({queryKey:["strength_catalog"]}),j(null),t({title:"Séance supprimée"})}}),he=$({mutationFn:s=>I.updateStrengthSession(s),onSuccess:()=>{r.invalidateQueries({queryKey:["strength_catalog"]}),c(!1),l(null),R({title:"",description:"",cycle:"endurance",items:[]}),t({title:"Séance mise à jour"})}}),us=$({mutationFn:s=>I.persistStrengthSessionOrder(s)}),ms=()=>{c(!1),l(null),R({title:"",description:"",cycle:"endurance",items:[]})},fe=s=>{l(s.id),R({title:s.title??"",description:s.description??"",cycle:ut(s.cycle),items:s.items?.map(i=>({exercise_id:i.exercise_id,order_index:i.order_index??0,sets:i.sets,reps:i.reps,rest_seconds:i.rest_seconds,percent_1rm:i.percent_1rm,cycle_type:i.cycle_type,notes:i.notes??""}))??[]}),c(!0)},ps=s=>{h(s),u(!0)},xs=()=>{const s={...f,items:ee(f.items)};n?he.mutate({...s,id:n}):pe.mutate(s)},ee=s=>s.map((i,v)=>({...i,order_index:v})),hs=()=>{const s=O?.[0];R(i=>({...i,items:[...i.items,s?te(s,i.cycle,i.items.length):{exercise_id:1,order_index:i.items.length,sets:0,reps:0,rest_seconds:0,percent_1rm:0}]}))},fs=(s,i,v)=>{const y=[...f.items];if(i==="exercise_id"){const S=O?.find(G=>G.id===v);S?y[s]=te(S,f.cycle,y[s].order_index??s,y[s]):y[s]={...y[s],exercise_id:Number(v)}}else y[s]={...y[s],[i]:v};R({...f,items:y})},gs=s=>{const i=ee(f.items.filter((v,y)=>y!==s));R({...f,items:i})},js=(s,i)=>{if(s===i)return;const v=[...f.items],[y]=v.splice(s,1);v.splice(i,0,y);const S=ee(v);R({...f,items:S}),n&&us.mutate({id:n,title:f.title,description:f.description,cycle:f.cycle,items:S})},ge=e.jsx(Q,{open:b,onOpenChange:u,children:e.jsxs(W,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(le,{children:e.jsx(ce,{children:"Modifier l'exercice"})}),o&&e.jsxs("div",{className:"space-y-4",children:[o.exercise_type==="warmup"?e.jsx(Te,{exercise:o,warmupMode:m,onChange:s=>h(i=>i&&{...i,...s}),onWarmupModeChange:U,idPrefix:"edit"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Nom"}),e.jsx(k,{value:o.nom_exercice,onChange:s=>h({...o,nom_exercice:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Description"}),e.jsx(V,{value:o.description??"",onChange:s=>h({...o,description:s.target.value===""?null:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Illustration (GIF)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{value:o.illustration_gif??"",onChange:s=>h({...o,illustration_gif:s.target.value===""?null:s.target.value}),placeholder:"https://...",className:"flex-1"}),e.jsx(T,{type:"button",variant:"outline",size:"icon",disabled:M,onClick:()=>{const s=document.createElement("input");s.type="file",s.accept="image/*,.gif",s.onchange=i=>{const v=i.target.files?.[0];v&&p(v,y=>h(S=>S&&{...S,illustration_gif:y}))},s.click()},"aria-label":"Uploader une image",children:M?e.jsx(Ae,{className:"h-4 w-4 animate-spin"}):e.jsx(Me,{className:"h-4 w-4"})})]}),o.illustration_gif&&e.jsx("img",{src:o.illustration_gif,alt:"Aperçu",className:"mt-2 h-20 w-20 rounded-lg object-cover border"})]}),o.exercise_type!=="warmup"?e.jsx($e,{exercise:o,onChange:s=>h(i=>i&&{...i,...s})}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{id:"warmup-flag-edit",checked:o.exercise_type==="warmup",onCheckedChange:s=>h({...o,exercise_type:s===!0?"warmup":"strength"})}),e.jsx(N,{htmlFor:"warmup-flag-edit",children:"Exercice d'échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(T,{variant:"outline",onClick:()=>{u(!1),h(null)},className:"h-10",children:"Annuler"}),e.jsx(T,{variant:"default",onClick:()=>{o?.id&&os.mutate(o)},disabled:!o.nom_exercice.trim(),className:"h-10",children:"Enregistrer"})]})]})]})}),je=e.jsx(Q,{open:g,onOpenChange:x,children:e.jsxs(W,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(le,{children:e.jsx(ce,{children:"Créer un exercice"})}),e.jsxs("div",{className:"space-y-4",children:[C.exercise_type==="warmup"?e.jsx(Te,{exercise:C,warmupMode:D,onChange:s=>P(i=>({...i,...s})),onWarmupModeChange:F,idPrefix:"create"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Nom"}),e.jsx(k,{value:C.nom_exercice,onChange:s=>P({...C,nom_exercice:s.target.value}),placeholder:"ex: Rotations Élastique"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Description"}),e.jsx(V,{value:C.description??"",onChange:s=>P({...C,description:s.target.value===""?null:s.target.value}),placeholder:"Détails, consignes..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Illustration (GIF)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{value:C.illustration_gif??"",onChange:s=>P({...C,illustration_gif:s.target.value===""?null:s.target.value}),placeholder:"https://...",className:"flex-1"}),e.jsx(T,{type:"button",variant:"outline",size:"icon",disabled:M,onClick:()=>{const s=document.createElement("input");s.type="file",s.accept="image/*,.gif",s.onchange=i=>{const v=i.target.files?.[0];v&&p(v,y=>P(S=>({...S,illustration_gif:y})))},s.click()},"aria-label":"Uploader une image",children:M?e.jsx(Ae,{className:"h-4 w-4 animate-spin"}):e.jsx(Me,{className:"h-4 w-4"})})]}),C.illustration_gif&&e.jsx("img",{src:C.illustration_gif,alt:"Aperçu",className:"mt-2 h-20 w-20 rounded-lg object-cover border"})]}),C.exercise_type!=="warmup"?e.jsx($e,{exercise:C,onChange:s=>P(i=>({...i,...s}))}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{id:"warmup-flag",checked:C.exercise_type==="warmup",onCheckedChange:s=>P({...C,exercise_type:s===!0?"warmup":"strength"})}),e.jsx(N,{htmlFor:"warmup-flag",children:"Exercice d'échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(T,{variant:"outline",onClick:()=>x(!1),className:"h-10",children:"Annuler"}),e.jsx(T,{variant:"default",onClick:()=>cs.mutate(C),disabled:!C.nom_exercice.trim(),className:"h-10",children:"Enregistrer"})]})]})]})}),ve=e.jsx(Se,{open:!!w,onOpenChange:s=>{s||j(null)},children:e.jsxs(Ce,{children:[e.jsxs(Ee,{children:[e.jsx(Re,{children:"Supprimer la séance ?"}),e.jsxs(ke,{children:['Cette action est définitive. La séance "',w?.title,'" sera supprimée.']})]}),e.jsxs(De,{children:[e.jsx(Fe,{children:"Annuler"}),e.jsx(Ie,{onClick:()=>{w?.id&&xe.mutate(w.id)},children:"Supprimer"})]})]})}),ye=e.jsx(Se,{open:!!_,onOpenChange:s=>{s||E(null)},children:e.jsxs(Ce,{children:[e.jsxs(Ee,{children:[e.jsx(Re,{children:"Supprimer l'exercice ?"}),e.jsxs(ke,{children:[`Cette action est définitive. L'exercice "`,_?.nom_exercice,'" sera supprimé.']})]}),e.jsxs(De,{children:[e.jsx(Fe,{children:"Annuler"}),e.jsx(Ie,{onClick:()=>{_?.id&&ds.mutate(_.id)},children:"Supprimer"})]})]})});return a?e.jsxs(e.Fragment,{children:[je,ge,ve,ye,e.jsx(dt,{session:f,exercises:O??[],editingSessionId:n,onSessionChange:R,onCycleChange:s=>{const i=f.items.map((v,y)=>{const S=O?.find(G=>G.id===v.exercise_id);return S?te(S,s,y,v):{...v,cycle_type:s}});R({...f,cycle:s,items:i})},onSave:xs,onCancel:ms,onAddItem:hs,onUpdateItem:fs,onRemoveItem:gs,onReorderItems:js,onExerciseDialogOpen:()=>x(!0),isSaving:pe.isPending||he.isPending})]}):rs?e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(se,{className:"h-7 w-64"}),e.jsx(se,{className:"h-10 w-full rounded-2xl"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:4}).map((s,i)=>e.jsx(se,{className:"h-20 w-full rounded-2xl"},i))})]}):Z?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(Us,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:Z instanceof Error?Z.message:"Une erreur s'est produite"}),e.jsx(T,{variant:"default",onClick:()=>as(),className:"mt-4 h-12 md:h-10",children:"Réessayer"})]}):e.jsxs("div",{children:[je,ge,ve,ye,e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:"Musculation"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Catalogue"})]}),e.jsxs("button",{type:"button",onClick:()=>{l(null),R({title:"",description:"",cycle:"endurance",items:[]}),c(!0)},className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(H,{className:"h-4 w-4"})," Nouvelle"]})]}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-border bg-card px-3 py-2",children:[e.jsx(Ks,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{className:"w-full bg-transparent text-sm outline-none placeholder:text-muted-foreground",placeholder:"Rechercher une séance",value:L,onChange:s=>J(s.target.value)})]}),e.jsx(Gs,{sessions:ls,isLoading:ns,error:is,renderTitle:s=>s.title??"Sans titre",renderMetrics:s=>{const i=s.items?.length??0,v=s.cycle==="force"?"bg-red-100 text-red-800":s.cycle==="hypertrophie"?"bg-violet-100 text-violet-800":"bg-blue-100 text-blue-800";return e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(be,{className:"h-3.5 w-3.5"}),i," exo",i>1?"s":""]}),e.jsx("span",{className:q("rounded-full px-2 py-0.5 text-[10px] font-semibold",v),children:s.cycle})]})},onPreview:s=>fe(s),onEdit:s=>fe(s),onDelete:s=>j(s),canDelete:()=>!0,isDeleting:xe.isPending}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-semibold",children:["Exercices (",O?.length??0,")"]}),e.jsxs("button",{type:"button",onClick:()=>x(!0),className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-2 text-xs font-semibold hover:bg-muted",children:[e.jsx(H,{className:"h-4 w-4"})," Ajouter"]})]}),e.jsx("div",{className:"space-y-1",children:O?.map(s=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl px-3 py-2 hover:bg-muted/50",children:[s.illustration_gif?e.jsx("img",{src:s.illustration_gif,alt:s.nom_exercice,className:"h-10 w-10 shrink-0 rounded-lg object-cover",loading:"lazy",decoding:"async"}):e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-muted",children:e.jsx(be,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"truncate text-sm font-medium",children:s.nom_exercice}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.exercise_type==="warmup"?"Échauffement":"Séries de travail"})]}),e.jsxs("div",{className:"flex shrink-0 items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>ps(s),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Modifier",children:e.jsx(Bs,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>E(s),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer",children:e.jsx(qe,{className:"h-4 w-4"})})]})]},s.id))})]})]})]})}export{te as createStrengthItemFromExercise,Lt as default};
