import{r as c,b as ss,h as ts,l as rs,m as Xs,j as e,d as ns,n as Ys,o as he,u as $e,I as Zs,p as js,q as Wt,R as ue,c as Ht,s as et,t as Qt,v as Jt,A as st,w as Xt,x as Yt,y as Zt,z as er,F as sr,D as tr,B as rr,E as nr}from"./vendor-ui-CDk0TPZB.js";import{h as pe,j as B,i as as,B as k,C as L,b as H,c as Q,f as U,d as Y,g as z,u as Ge,k as ar,M as is,a as ir,U as Le,W as Rs,D as lr,T as or}from"./index-DkY2h0px.js";import{b as tt,u as me,c as ie}from"./vendor-query-aL7hzhW6.js";import{I}from"./input-Dyipb55u.js";import{L as R}from"./label-CqV2Lp4b.js";import{u as cr,S as le,a as oe,b as ce,c as de,d as G,C as dr}from"./select-BhyF-CVR.js";import{C as ur,P as xe}from"./plus-DbjtxQ0-.js";import{T as Ae}from"./textarea-DTYQtJ1F.js";import{D as Pe,a as De,b as ds,c as us}from"./dialog-D01RxeH2.js";import{C as hs}from"./checkbox-BQDFmrhu.js";import{A as Ue,a as We,b as He,c as Qe,d as Je,e as Xe,f as Ye,g as Ze,P as Es}from"./alert-dialog-BRafJguC.js";import{T as mr,a as pr,b as xr,c as hr}from"./tabs-CEIQb0sF.js";import{S as Be,P as As}from"./save-DV-J3x3l.js";import{c as rt,R as fr,i as Ps,g as gr,S as Ds,a as jr,L as vr}from"./SwimSessionConsultation-BwLLhC3N.js";import{f as yr}from"./vendor-date-cQbdWov0.js";import{C as br}from"./chevron-left-HmQUMaia.js";import{S as Nr}from"./search-C_M-8eZk.js";import{T as wr}from"./timer-v05TvBGV.js";import{T as _r,a as Cr,b as Ms,c as ms,d as Sr,e as ps}from"./table-D-SNBW9G.js";import{B as kr}from"./badge-CQUSkGsT.js";import{A as Rr}from"./arrow-left-CqEF6It1.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-bGfQb4ap.js";import"./vendor-supabase-CgI36rMY.js";import"./check-DxsCHFcs.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Er=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],Ar=pe("archive",Er);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pr=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],Ts=pe("arrow-down",Pr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dr=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],Fs=pe("arrow-up",Dr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mr=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],Fe=pe("bell",Mr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tr=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Fr=pe("eye",Tr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vr=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],$r=pe("funnel",Vr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],nt=pe("grip-vertical",Ir);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Or=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],Vs=pe("heart-pulse",Or);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qr=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],zr=pe("pencil",qr);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gr=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],fe=pe("trash-2",Gr);function fs(s,a,{checkForDefaultPrevented:r=!0}={}){return function(t){if(s?.(t),r===!1||!t.defaultPrevented)return a?.(t)}}var Lr=ss[" useInsertionEffect ".trim().toString()]||ts;function Br({prop:s,defaultProp:a,onChange:r=()=>{},caller:n}){const[t,i,l]=Kr({defaultProp:a,onChange:r}),d=s!==void 0,g=d?s:t;{const p=c.useRef(s!==void 0);c.useEffect(()=>{const m=p.current;m!==d&&console.warn(`${n} is changing from ${m?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),p.current=d},[d,n])}const x=c.useCallback(p=>{if(d){const m=Ur(p)?p(s):p;m!==s&&l.current?.(m)}else i(p)},[d,s,i,l]);return[g,x]}function Kr({defaultProp:s,onChange:a}){const[r,n]=c.useState(s),t=c.useRef(r),i=c.useRef(a);return Lr(()=>{i.current=a},[a]),c.useEffect(()=>{t.current!==r&&(i.current?.(r),t.current=r)},[r,t]),[r,n,i]}function Ur(s){return typeof s=="function"}var vs="Radio",[Wr,at]=ns(vs),[Hr,Qr]=Wr(vs),it=c.forwardRef((s,a)=>{const{__scopeRadio:r,name:n,checked:t=!1,required:i,disabled:l,value:d="on",onCheck:g,form:x,...p}=s,[m,f]=c.useState(null),_=$e(a,y=>f(y)),N=c.useRef(!1),O=m?x||!!m.closest("form"):!0;return e.jsxs(Hr,{scope:r,checked:t,disabled:l,children:[e.jsx(he.button,{type:"button",role:"radio","aria-checked":t,"data-state":dt(t),"data-disabled":l?"":void 0,disabled:l,value:d,...p,ref:_,onClick:fs(s.onClick,y=>{t||g?.(),O&&(N.current=y.isPropagationStopped(),N.current||y.stopPropagation())})}),O&&e.jsx(ct,{control:m,bubbles:!N.current,name:n,value:d,checked:t,required:i,disabled:l,form:x,style:{transform:"translateX(-100%)"}})]})});it.displayName=vs;var lt="RadioIndicator",ot=c.forwardRef((s,a)=>{const{__scopeRadio:r,forceMount:n,...t}=s,i=Qr(lt,r);return e.jsx(js,{present:n||i.checked,children:e.jsx(he.span,{"data-state":dt(i.checked),"data-disabled":i.disabled?"":void 0,...t,ref:a})})});ot.displayName=lt;var Jr="RadioBubbleInput",ct=c.forwardRef(({__scopeRadio:s,control:a,checked:r,bubbles:n=!0,...t},i)=>{const l=c.useRef(null),d=$e(l,i),g=cr(r),x=Wt(a);return c.useEffect(()=>{const p=l.current;if(!p)return;const m=window.HTMLInputElement.prototype,_=Object.getOwnPropertyDescriptor(m,"checked").set;if(g!==r&&_){const N=new Event("click",{bubbles:n});_.call(p,r),p.dispatchEvent(N)}},[g,r,n]),e.jsx(he.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...t,tabIndex:-1,ref:d,style:{...t.style,...x,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});ct.displayName=Jr;function dt(s){return s?"checked":"unchecked"}var Xr=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ls="RadioGroup",[Yr]=ns(ls,[rs,at]),ut=rs(),mt=at(),[Zr,en]=Yr(ls),pt=c.forwardRef((s,a)=>{const{__scopeRadioGroup:r,name:n,defaultValue:t,value:i,required:l=!1,disabled:d=!1,orientation:g,dir:x,loop:p=!0,onValueChange:m,...f}=s,_=ut(r),N=Xs(x),[O,y]=Br({prop:i,defaultProp:t??null,onChange:m,caller:ls});return e.jsx(Zr,{scope:r,name:n,required:l,disabled:d,value:O,onValueChange:y,children:e.jsx(Ys,{asChild:!0,..._,orientation:g,dir:N,loop:p,children:e.jsx(he.div,{role:"radiogroup","aria-required":l,"aria-orientation":g,"data-disabled":d?"":void 0,dir:N,...f,ref:a})})})});pt.displayName=ls;var xt="RadioGroupItem",ht=c.forwardRef((s,a)=>{const{__scopeRadioGroup:r,disabled:n,...t}=s,i=en(xt,r),l=i.disabled||n,d=ut(r),g=mt(r),x=c.useRef(null),p=$e(a,x),m=i.value===t.value,f=c.useRef(!1);return c.useEffect(()=>{const _=O=>{Xr.includes(O.key)&&(f.current=!0)},N=()=>f.current=!1;return document.addEventListener("keydown",_),document.addEventListener("keyup",N),()=>{document.removeEventListener("keydown",_),document.removeEventListener("keyup",N)}},[]),e.jsx(Zs,{asChild:!0,...d,focusable:!l,active:m,children:e.jsx(it,{disabled:l,required:i.required,checked:m,...g,...t,name:i.name,ref:p,onCheck:()=>i.onValueChange(t.value),onKeyDown:fs(_=>{_.key==="Enter"&&_.preventDefault()}),onFocus:fs(t.onFocus,()=>{f.current&&x.current?.click()})})})});ht.displayName=xt;var sn="RadioGroupIndicator",ft=c.forwardRef((s,a)=>{const{__scopeRadioGroup:r,...n}=s,t=mt(r);return e.jsx(ot,{...t,...n,ref:a})});ft.displayName=sn;var gt=pt,jt=ht,tn=ft;const vt=c.forwardRef(({className:s,...a},r)=>e.jsx(gt,{className:B("grid gap-2",s),...a,ref:r}));vt.displayName=gt.displayName;const gs=c.forwardRef(({className:s,...a},r)=>e.jsx(jt,{ref:r,className:B("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:e.jsx(tn,{className:"flex items-center justify-center",children:e.jsx(ur,{className:"h-3.5 w-3.5 fill-primary"})})}));gs.displayName=jt.displayName;const $s=[{key:"endurance",label:"Endurance",fieldSuffix:"endurance"},{key:"hypertrophie",label:"Hypertrophie",fieldSuffix:"hypertrophie"},{key:"force",label:"Force",fieldSuffix:"force"}],Is=s=>s==="endurance"||s==="hypertrophie"||s==="force"?s:"endurance",Os=({exercise:s,onChange:a,disabled:r=!1})=>e.jsxs(mr,{defaultValue:"endurance",className:"w-full",children:[e.jsx(pr,{className:"grid w-full grid-cols-3",children:$s.map(n=>e.jsx(xr,{value:n.key,children:n.label},n.key))}),$s.map(n=>{const t=`pct_1rm_${n.fieldSuffix}`,i=`Nb_series_${n.fieldSuffix}`,l=`Nb_reps_${n.fieldSuffix}`,d=`recup_${n.fieldSuffix}`,g=`recup_exercices_${n.fieldSuffix}`;return e.jsxs(hr,{value:n.key,className:`space-y-3 rounded-lg border p-3 ${r?"opacity-60":""}`,children:[e.jsx("p",{className:"text-sm font-semibold",children:n.label}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"% 1RM"}),e.jsx(I,{type:"number",value:s[t]??"",disabled:r,onChange:x=>a({[t]:x.target.value===""?null:Number(x.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Nb séries"}),e.jsx(I,{type:"number",value:s[i]??"",disabled:r,onChange:x=>a({[i]:x.target.value===""?null:Number(x.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Nb reps"}),e.jsx(I,{type:"number",value:s[l]??"",disabled:r,onChange:x=>a({[l]:x.target.value===""?null:Number(x.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Récup. séries (s)"}),e.jsx(I,{type:"number",value:s[d]??"",disabled:r,onChange:x=>a({[d]:x.target.value===""?null:Number(x.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Récup. exercices (s)"}),e.jsx(I,{type:"number",value:s[g]??"",disabled:r,onChange:x=>a({[g]:x.target.value===""?null:Number(x.target.value)})})]})]})]},n.key)})]}),rn={pct_1rm_endurance:60,pct_1rm_hypertrophie:75,pct_1rm_force:85,Nb_series_endurance:4,Nb_series_hypertrophie:3,Nb_series_force:3,Nb_reps_endurance:16,Nb_reps_hypertrophie:8,Nb_reps_force:3,recup_endurance:120,recup_hypertrophie:200,recup_force:300,recup_exercices_endurance:300,recup_exercices_hypertrophie:400,recup_exercices_force:500},ze=s=>{const a=Number(s);return Number.isFinite(a)?a:0},qs=(s,a,r,n)=>{const t=a==="force"?"force":a==="hypertrophie"?"hypertrophie":"endurance",i=`Nb_series_${t}`,l=`Nb_reps_${t}`,d=`pct_1rm_${t}`,g=`recup_${t}`;return{exercise_id:s.id,order_index:r,sets:ze(s[i]),reps:ze(s[l]),rest_seconds:ze(s[g]),percent_1rm:ze(s[d]),cycle_type:a,notes:n?.notes??""}},nn=()=>({nom_exercice:"",description:null,illustration_gif:null,exercise_type:"strength",warmup_reps:null,warmup_duration:null,...rn}),zs=({exercise:s,warmupMode:a,onChange:r,onWarmupModeChange:n,idPrefix:t})=>e.jsxs("div",{className:"space-y-3 rounded-lg border p-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Paramètres d’échauffement"}),e.jsxs(vt,{value:a,onValueChange:i=>{n(i==="duration"?"duration":"reps"),r(i==="duration"?{warmup_reps:null,warmup_duration:s.warmup_duration??0}:{warmup_duration:null,warmup_reps:s.warmup_reps??0})},className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(gs,{value:"reps",id:`${t}-warmup-reps`}),e.jsx(R,{htmlFor:`${t}-warmup-reps`,children:"Nombre de répétitions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(gs,{value:"duration",id:`${t}-warmup-duration`}),e.jsx(R,{htmlFor:`${t}-warmup-duration`,children:"Durée (secondes)"})]})]}),a==="duration"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Durée (s)"}),e.jsx(I,{type:"number",value:s.warmup_duration??"",onChange:i=>r({warmup_duration:i.target.value===""?null:Number(i.target.value)})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Nombre de répétitions"}),e.jsx(I,{type:"number",value:s.warmup_reps??"",onChange:i=>r({warmup_reps:i.target.value===""?null:Number(i.target.value)})})]})]});function an(){const{toast:s}=as(),a=tt(),[r,n]=c.useState(!1),[t,i]=c.useState(null),[l,d]=c.useState("all"),[g,x]=c.useState(!1),[p,m]=c.useState(!1),[f,_]=c.useState(null),[N,O]=c.useState(null),[y,se]=c.useState(!1),[Z,w]=c.useState(null),[D,ae]=c.useState(null),[A,ee]=c.useState(null),[ve,h]=c.useState(null),[M,J]=c.useState("reps"),[W,P]=c.useState("reps"),[C,q]=c.useState({title:"",description:"",cycle:"endurance",items:[]}),[F,X]=c.useState({...nn()});c.useEffect(()=>{f&&P(f.warmup_duration!=null?"duration":"reps")},[f]);const{data:K}=me({queryKey:["exercises"],queryFn:()=>z.getExercises()}),{data:Se}=me({queryKey:["strength_catalog"],queryFn:()=>z.getStrengthSessions()}),Ne=c.useMemo(()=>new Map((K??[]).map(o=>[o.id,o])),[K]),we=ie({mutationFn:o=>z.createExercise(o),onSuccess:()=>{a.invalidateQueries({queryKey:["exercises"]}),x(!1),s({title:"Exercice ajouté"})}}),_e=ie({mutationFn:o=>z.createStrengthSession(o),onSuccess:()=>{a.invalidateQueries({queryKey:["strength_catalog"]}),n(!1),q({title:"",description:"",cycle:"endurance",items:[]}),s({title:"Séance créée avec succès"})}}),ke=ie({mutationFn:o=>z.updateExercise(o),onSuccess:()=>{a.invalidateQueries({queryKey:["exercises"]}),a.invalidateQueries({queryKey:["strength_catalog"]}),m(!1),_(null),s({title:"Exercice mis à jour"})}}),V=ie({mutationFn:o=>z.deleteExercise(o),onSuccess:()=>{a.invalidateQueries({queryKey:["exercises"]}),a.invalidateQueries({queryKey:["strength_catalog"]}),ae(null),s({title:"Exercice supprimé"})}}),te=ie({mutationFn:o=>z.deleteStrengthSession(o),onSuccess:()=>{a.invalidateQueries({queryKey:["strength_catalog"]}),w(null),s({title:"Séance supprimée"})}}),ye=ie({mutationFn:o=>z.updateStrengthSession(o),onSuccess:()=>{a.invalidateQueries({queryKey:["strength_catalog"]}),n(!1),i(null),q({title:"",description:"",cycle:"endurance",items:[]}),s({title:"Séance mise à jour"})}}),be=ie({mutationFn:o=>z.persistStrengthSessionOrder(o)}),u=()=>{n(!1),i(null),q({title:"",description:"",cycle:"endurance",items:[]})},j=o=>{i(o.id),q({title:o.title??"",description:o.description??"",cycle:Is(o.cycle),items:o.items?.map(v=>({exercise_id:v.exercise_id,order_index:v.order_index??0,sets:v.sets,reps:v.reps,rest_seconds:v.rest_seconds,percent_1rm:v.percent_1rm,cycle_type:v.cycle_type,notes:v.notes??""}))??[]}),n(!0)},b=o=>{_(o),m(!0)},T=()=>{const o={...C,items:$(C.items)};t?ye.mutate({...o,id:t}):_e.mutate(o)},$=o=>o.map((v,S)=>({...v,order_index:S})),re=()=>{const o=K?.[0];q(v=>({...v,items:[...v.items,o?qs(o,v.cycle,v.items.length):{exercise_id:1,order_index:v.items.length,sets:0,reps:0,rest_seconds:0,percent_1rm:0}]}))},E=(o,v,S)=>{const ne=[...C.items];if(v==="exercise_id"){const Ee=K?.find(Ut=>Ut.id===S);Ee?ne[o]=qs(Ee,C.cycle,ne[o].order_index??o,ne[o]):ne[o]={...ne[o],exercise_id:Number(S)}}else ne[o]={...ne[o],[v]:S};q({...C,items:ne})},Re=o=>{const v=$(C.items.filter((S,ne)=>ne!==o));q({...C,items:v})},Oe=(o,v)=>{if(o===v)return;const S=[...C.items],[ne]=S.splice(o,1);S.splice(v,0,ne);const Ee=$(S);q({...C,items:Ee}),t&&be.mutate({id:t,title:C.title,description:C.description,cycle:C.cycle,items:Ee})},cs=new Set(C.items.map(o=>o.exercise_id)),qe=K?.filter(o=>l==="all"||cs.has(o.id)?!0:o.exercise_type===l)??[],ws=e.jsx(Pe,{open:p,onOpenChange:m,children:e.jsxs(De,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(ds,{children:e.jsx(us,{children:"Modifier l’exercice"})}),f&&e.jsxs("div",{className:"space-y-4",children:[f.exercise_type==="warmup"?e.jsx(zs,{exercise:f,warmupMode:W,onChange:o=>_(v=>v&&{...v,...o}),onWarmupModeChange:P,idPrefix:"edit"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Nom"}),e.jsx(I,{value:f.nom_exercice,onChange:o=>_({...f,nom_exercice:o.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Description"}),e.jsx(Ae,{value:f.description??"",onChange:o=>_({...f,description:o.target.value===""?null:o.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Illustration (GIF)"}),e.jsx(I,{value:f.illustration_gif??"",onChange:o=>_({...f,illustration_gif:o.target.value===""?null:o.target.value}),placeholder:"https://..."})]}),f.exercise_type!=="warmup"?e.jsx(Os,{exercise:f,onChange:o=>_(v=>v&&{...v,...o})}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(hs,{id:"warmup-flag-edit",checked:f.exercise_type==="warmup",onCheckedChange:o=>_({...f,exercise_type:o===!0?"warmup":"strength"})}),e.jsx(R,{htmlFor:"warmup-flag-edit",children:"Exercice d’échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(k,{variant:"outline",onClick:()=>{m(!1),_(null)},children:"Annuler"}),e.jsxs(k,{onClick:()=>{f?.id&&ke.mutate(f)},disabled:!f.nom_exercice.trim(),children:[e.jsx(Be,{className:"mr-2 h-4 w-4"})," Enregistrer"]})]})]})]})}),_s=e.jsx(Pe,{open:g,onOpenChange:x,children:e.jsxs(De,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(ds,{children:e.jsx(us,{children:"Créer un exercice"})}),e.jsxs("div",{className:"space-y-4",children:[F.exercise_type==="warmup"?e.jsx(zs,{exercise:F,warmupMode:M,onChange:o=>X(v=>({...v,...o})),onWarmupModeChange:J,idPrefix:"create"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Nom"}),e.jsx(I,{value:F.nom_exercice,onChange:o=>X({...F,nom_exercice:o.target.value}),placeholder:"ex: Rotations Élastique"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Description"}),e.jsx(Ae,{value:F.description??"",onChange:o=>X({...F,description:o.target.value===""?null:o.target.value}),placeholder:"Détails, consignes..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Illustration (GIF)"}),e.jsx(I,{value:F.illustration_gif??"",onChange:o=>X({...F,illustration_gif:o.target.value===""?null:o.target.value}),placeholder:"https://..."})]}),F.exercise_type!=="warmup"?e.jsx(Os,{exercise:F,onChange:o=>X(v=>({...v,...o}))}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(hs,{id:"warmup-flag",checked:F.exercise_type==="warmup",onCheckedChange:o=>X({...F,exercise_type:o===!0?"warmup":"strength"})}),e.jsx(R,{htmlFor:"warmup-flag",children:"Exercice d’échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(k,{variant:"outline",onClick:()=>x(!1),children:"Annuler"}),e.jsxs(k,{onClick:()=>we.mutate(F),disabled:!F.nom_exercice.trim(),children:[e.jsx(Be,{className:"mr-2 h-4 w-4"})," Enregistrer"]})]})]})]})}),Cs=e.jsx(Pe,{open:y,onOpenChange:o=>{se(o),o||O(null)},children:e.jsxs(De,{className:"sm:max-w-3xl",children:[e.jsx(ds,{children:e.jsx(us,{children:"Détails de la séance"})}),N&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-lg font-semibold",children:N.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:N.description||"—"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cycle : ",N.cycle]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Exercices"}),e.jsx("div",{className:"space-y-2",children:(N.items??[]).slice().sort((o,v)=>(o.order_index??0)-(v.order_index??0)).map((o,v)=>{const S=Ne.get(o.exercise_id);return e.jsxs("div",{className:"rounded-md border px-3 py-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("span",{className:"font-medium",children:[v+1,". ",S?.nom_exercice??o.exercise_name??"Exercice"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:S?.exercise_type==="warmup"||o.category==="warmup"?"Échauffement":"Travail"})]}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[o.sets," séries • ",o.reps," reps • ",o.percent_1rm,"% 1RM • ",o.rest_seconds,"s"]})]},`${o.exercise_id}-${v}`)})})]})]})]})}),Ss=e.jsx(Ue,{open:!!Z,onOpenChange:o=>{o||w(null)},children:e.jsxs(We,{children:[e.jsxs(He,{children:[e.jsx(Qe,{children:"Supprimer la séance ?"}),e.jsxs(Je,{children:['Cette action est définitive. La séance "',Z?.title,'" sera supprimée.']})]}),e.jsxs(Xe,{children:[e.jsx(Ye,{children:"Annuler"}),e.jsx(Ze,{onClick:()=>{Z?.id&&te.mutate(Z.id)},children:"Supprimer"})]})]})}),ks=e.jsx(Ue,{open:!!D,onOpenChange:o=>{o||ae(null)},children:e.jsxs(We,{children:[e.jsxs(He,{children:[e.jsx(Qe,{children:"Supprimer l’exercice ?"}),e.jsxs(Je,{children:['Cette action est définitive. L’exercice "',D?.nom_exercice,'" sera supprimé.']})]}),e.jsxs(Xe,{children:[e.jsx(Ye,{children:"Annuler"}),e.jsx(Ze,{onClick:()=>{D?.id&&V.mutate(D.id)},children:"Supprimer"})]})]})});return r?e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-bottom-4",children:[_s,ws,Cs,Ss,ks,e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold uppercase",children:t?"Modifier Séance Muscu":"Nouvelle Séance Muscu"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{variant:"outline",onClick:u,children:"Annuler"}),e.jsxs(k,{onClick:T,children:[e.jsx(Be,{className:"mr-2 h-4 w-4"})," Enregistrer"]})]})]}),e.jsxs(L,{children:[e.jsx(H,{children:e.jsx(Q,{children:"Informations Générales"})}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Titre"}),e.jsx(I,{value:C.title,onChange:o=>q({...C,title:o.target.value}),placeholder:"ex: Full Body A"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Cycle"}),e.jsxs(le,{value:C.cycle,onValueChange:o=>q({...C,cycle:Is(o)}),children:[e.jsx(oe,{children:e.jsx(ce,{})}),e.jsxs(de,{children:[e.jsx(G,{value:"endurance",children:"Endurance"}),e.jsx(G,{value:"hypertrophie",children:"Hypertrophie"}),e.jsx(G,{value:"force",children:"Force"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Description"}),e.jsx(Ae,{value:C.description,onChange:o=>q({...C,description:o.target.value})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold",children:"Exercices"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(k,{size:"sm",variant:"outline",onClick:()=>x(!0),children:[e.jsx(xe,{className:"mr-2 h-4 w-4"})," Nouvel exercice"]}),e.jsxs(k,{size:"sm",onClick:re,children:[e.jsx(xe,{className:"mr-2 h-4 w-4"})," Ajouter"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-[220px_1fr] items-end",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx($r,{className:"h-4 w-4"})," Filtre exercices"]}),e.jsxs(le,{value:l,onValueChange:o=>d(o),children:[e.jsx(oe,{children:e.jsx(ce,{})}),e.jsxs(de,{children:[e.jsx(G,{value:"all",children:"Tous"}),e.jsx(G,{value:"strength",children:"Séries de travail"}),e.jsx(G,{value:"warmup",children:"Échauffement"})]})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Les exercices marqués warmup sont affichés dans les séances avec le badge « Échauffement »."})]}),C.items.map((o,v)=>e.jsxs(L,{className:B("relative transition-all",ve===v&&A!==null&&A!==v&&"ring-2 ring-primary bg-accent/30"),onDragOver:S=>S.preventDefault(),onDragEnter:()=>h(v),onDragLeave:()=>h(S=>S===v?null:S),onDrop:()=>{A!==null&&(Oe(A,v),ee(null),h(null))},children:[e.jsx(k,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 text-destructive",onClick:()=>Re(v),"aria-label":"Supprimer l'exercice",children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsxs(U,{className:"pt-6 grid md:grid-cols-12 gap-4 items-end",children:[e.jsx("div",{className:"md:col-span-1 flex items-center justify-center",children:e.jsx("button",{type:"button",className:"cursor-grab rounded-md border p-1 text-muted-foreground hover:text-foreground",draggable:!0,onDragStart:()=>ee(v),onDragEnd:()=>{ee(null),h(null)},"aria-label":"Réordonner",children:e.jsx(nt,{className:"h-4 w-4"})})}),e.jsxs("div",{className:"md:col-span-3 space-y-2",children:[e.jsx(R,{children:"Exercice"}),e.jsxs(le,{value:o.exercise_id.toString(),onValueChange:S=>E(v,"exercise_id",parseInt(S)),children:[e.jsx(oe,{children:e.jsx(ce,{})}),e.jsx(de,{children:qe.length?qe.map(S=>e.jsxs(G,{value:S.id.toString(),children:[S.nom_exercice,S.exercise_type==="warmup"?" • Échauffement":""]},S.id)):e.jsx(G,{value:"no-exercise",disabled:!0,children:"Aucun exercice disponible"})})]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(R,{children:"Séries"}),e.jsx(I,{type:"number",value:o.sets===0?"":o.sets,onChange:S=>E(v,"sets",S.target.value===""?0:Number(S.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(R,{children:"Reps"}),e.jsx(I,{type:"number",value:o.reps===0?"":o.reps,onChange:S=>E(v,"reps",S.target.value===""?0:Number(S.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(R,{children:"% 1RM"}),e.jsx(I,{type:"number",value:o.percent_1rm===0?"":o.percent_1rm,onChange:S=>E(v,"percent_1rm",S.target.value===""?0:Number(S.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(R,{children:"Repos (s)"}),e.jsx(I,{type:"number",value:o.rest_seconds===0?"":o.rest_seconds,onChange:S=>E(v,"rest_seconds",S.target.value===""?0:Number(S.target.value))})]})]})]},`${o.exercise_id}-${v}`))]})]}):e.jsxs("div",{className:"space-y-4",children:[_s,ws,Cs,Ss,ks,e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Catalogue Séances Musculation"}),e.jsxs(k,{onClick:()=>{i(null),q({title:"",description:"",cycle:"endurance",items:[]}),n(!0)},children:[e.jsx(xe,{className:"mr-2 h-4 w-4"})," Créer"]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:Se?.map(o=>e.jsxs(L,{children:[e.jsxs(H,{children:[e.jsx(Q,{children:o.title}),e.jsxs(Y,{children:[o.items?.length||0," exercices • ",o.cycle]})]}),e.jsx(U,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:"outline",size:"icon","aria-label":"Voir détails",onClick:()=>{O(o),se(!0)},children:e.jsx(Fr,{className:"h-4 w-4"})}),e.jsx(k,{variant:"secondary",size:"icon","aria-label":"Modifier",onClick:()=>j(o),children:e.jsx(As,{className:"h-4 w-4"})}),e.jsx(k,{variant:"destructive",size:"icon","aria-label":"Supprimer",onClick:()=>w(o),children:e.jsx(fe,{className:"h-4 w-4"})})]})})]},o.id))}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Catalogue Exercices"}),e.jsxs(k,{variant:"outline",onClick:()=>x(!0),children:[e.jsx(xe,{className:"mr-2 h-4 w-4"})," Ajouter un exercice"]})]}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:K?.map(o=>e.jsx(L,{children:e.jsxs(U,{className:"flex flex-col gap-3 py-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[o.illustration_gif?e.jsx("img",{src:o.illustration_gif,alt:`Illustration ${o.nom_exercice}`,className:"h-14 w-14 rounded-md object-cover",loading:"lazy",decoding:"async"}):null,e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:o.nom_exercice}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o.exercise_type==="warmup"?"Échauffement":"Séries de travail"})]})]}),e.jsxs("div",{className:"flex w-full gap-2 sm:w-auto",children:[e.jsx(k,{variant:"outline",size:"icon","aria-label":"Modifier",onClick:()=>b(o),children:e.jsx(As,{className:"h-4 w-4"})}),e.jsx(k,{variant:"destructive",size:"icon","aria-label":"Supprimer",onClick:()=>ae(o),children:e.jsx(fe,{className:"h-4 w-4"})})]})]})},o.id))})]})]})}const Gs=["V0","V1","V2","V3","Max"],ln={V0:"bg-emerald-500",V1:"bg-green-500",V2:"bg-yellow-500",V3:"bg-orange-500",Max:"bg-red-600"},Ls={souple:"V0",facile:"V0",relache:"V0",relâché:"V0"},on=s=>{if(!s)return"V0";const a=s.trim();if(!a)return"V0";const r=a.toLowerCase();if(Ls[r])return Ls[r];const n=a.toUpperCase();if(n==="MAX")return"Max";if(n.startsWith("V")){const t=n.replace("V","V");return t==="V4"||t==="V5"?"Max":t}return a};function cn({value:s,onChange:a,className:r,ariaLabel:n="Sélection d'intensité"}){const t=on(s),i=Gs.includes(t)?t:"Max";return e.jsx("div",{role:"radiogroup","aria-label":n,className:B("flex flex-wrap items-center gap-2",r),children:Gs.map(l=>{const d=i===l;return e.jsxs("button",{type:"button",role:"radio","aria-checked":d,"aria-label":`Intensité ${l==="Max"?"MAX":l}`,onClick:()=>a(l),className:B("flex flex-col items-center gap-1 rounded-full px-2 py-1 text-[10px] font-semibold text-muted-foreground transition","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",d?"text-foreground":"hover:text-foreground"),children:[e.jsx("span",{className:B("h-3 w-3 rounded-full",d?ln[l]??"bg-primary":"bg-muted")}),e.jsx("span",{children:l==="Max"?"MAX":l})]},l)})})}function dn(s){c.useEffect(()=>{if(!s)return;const a=r=>{r.preventDefault()};return window.addEventListener("beforeunload",a),()=>window.removeEventListener("beforeunload",a)},[s])}function Bs(s){return`Séance du ${yr(s,"dd/MM/yyyy")} - Soir - Matin`}const Ks={souple:"V0",facile:"V0",relache:"V0",relâché:"V0"},un=["V0","V1","V2","V3","Max"],Ve=s=>{if(!s)return"V0";const a=s.trim();if(!a)return"V0";const r=a.toLowerCase();if(Ks[r])return Ks[r];const n=a.toUpperCase();if(n==="MAX")return"Max";if(n.startsWith("V")){const t=Number.parseInt(n.slice(1),10);if(Number.isFinite(t)&&t>=4)return"Max";if(un.includes(n))return n}return a},Us=s=>s==="Max"?"MAX":s,xs=s=>{let a=0;return s.flatMap((r,n)=>r.exercises.map((t,i)=>{const l={block_title:r.title,block_description:r.description||null,block_order:n,block_repetitions:r.repetitions??null,block_modalities:r.modalities||null,block_equipment:r.equipment??[],exercise_repetitions:t.repetitions??null,exercise_rest:t.rest??null,exercise_stroke:t.stroke||null,exercise_stroke_type:t.strokeType||null,exercise_intensity:t.intensity?Ve(t.intensity):null,exercise_modalities:t.modalities||null,exercise_equipment:t.equipment??[],exercise_order:i},d=t.repetitions&&t.distance?`${t.repetitions}x${t.distance}m`:t.distance?`${t.distance}m`:null;return{ordre:a++,label:d,distance:t.distance??null,duration:null,intensity:t.intensity?Ve(t.intensity):null,notes:t.modalities||null,raw_payload:l}}))},mn=(s=[])=>{const a=new Map;return s.forEach(r=>{const n=r.raw_payload??{},t=n.block_title||n.section||"Bloc",i=Number(n.block_order??0),l=`${i}-${t}`,d=n.block_equipment??n.equipment??[],g=(Array.isArray(d)?d:String(d).split(",")).map(f=>String(f)).map(f=>Ws(f)).filter(Boolean);a.has(l)||a.set(l,{title:t,repetitions:n.block_repetitions??null,description:n.block_description??"",modalities:n.block_modalities??n.modalities??"",equipment:g,exercises:[],order:Number.isFinite(i)?i:0,exerciseOrder:new Map});const x=a.get(l),p=Number(n.exercise_order??r.ordre??x.exercises.length),m=Ve(n.exercise_intensity??r.intensity??"V1");x.exerciseOrder.set(p,{repetitions:n.exercise_repetitions??null,distance:r.distance??null,rest:n.exercise_rest??null,stroke:n.exercise_stroke??n.stroke??"crawl",strokeType:n.exercise_stroke_type??n.stroke_type??"nc",intensity:m,modalities:n.exercise_modalities??r.notes??"",equipment:Array.isArray(n.exercise_equipment)?n.exercise_equipment.map(f=>Ws(f)):[]})}),Array.from(a.values()).sort((r,n)=>r.order-n.order).map(r=>({title:r.title,repetitions:r.repetitions,description:r.description,modalities:r.modalities,equipment:r.equipment,exercises:Array.from(r.exerciseOrder.entries()).sort(([n],[t])=>n-t).map(([,n])=>n)}))},pn=s=>s?s.length>48?`${s.slice(0,45).trim()}…`:s:"",Ws=s=>{const a=s.trim().toLowerCase();return a&&(a.startsWith("plaquette")?"plaquettes":a.startsWith("palm")?"palmes":a.startsWith("tuba")?"tuba":a.startsWith("pull")?"pull":a.startsWith("elas")?"elastique":a)},xn=(s=[])=>new Set(s.map(r=>{const n=r.raw_payload;return n?.block_title||n?.section||"Bloc"})).size,hn=s=>{const a=rt(s.items??[]),n=s.items?.some(i=>i.duration!=null)??!1?s.items?.reduce((i,l)=>i+(l.duration??0),0)??0:null,t=xn(s.items??[]);return{totalDistance:a,totalDuration:n,blockCount:t}},Hs="swim_catalog_archived_ids",fn=(s,a)=>a===null?!1:!a.some(r=>r.session_type==="swim"&&r.session_id===s);function gn(){const{toast:s}=as(),a=tt(),{userId:r,role:n}=Ge(),[t,i]=c.useState(!1);dn(t);const[l,d]=c.useState(null),[g,x]=c.useState(null),[p,m]=c.useState(null),[f,_]=c.useState(""),[N,O]=c.useState("compact"),[y,se]=c.useState(new Set),Z=()=>({id:null,name:Bs(new Date),description:"",estimatedDuration:0,blocks:[]}),[w,D]=c.useState(Z),{data:ae,isLoading:A}=me({queryKey:["swim_catalog"],queryFn:()=>z.getSwimCatalog()}),{data:ee,isError:ve}=me({queryKey:["coach-assignments"],queryFn:()=>z.getAssignmentsForCoach(),enabled:n==="coach"||n==="admin"});c.useEffect(()=>{if(typeof window>"u")return;const u=window.localStorage.getItem(Hs);if(u)try{const j=JSON.parse(u);Array.isArray(j)&&se(new Set(j.map(b=>Number(b)).filter(b=>Number.isFinite(b))))}catch{return}},[]),c.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Hs,JSON.stringify(Array.from(y.values())))},[y]);const M=c.useMemo(()=>{const u=f.trim().toLowerCase();return u?(ae??[]).filter(j=>j.name.toLowerCase().includes(u)):ae??[]},[ae,f]).filter(u=>!y.has(u.id)),J=ie({mutationFn:u=>z.createSwimSession(u),onSuccess:(u,j)=>{a.invalidateQueries({queryKey:["swim_catalog"]}),i(!1),D(Z()),s({title:j?.id?"Séance natation mise à jour":"Séance natation créée"})}}),W=ie({mutationFn:u=>z.deleteSwimSession(u),onSuccess:()=>{a.invalidateQueries({queryKey:["swim_catalog"]}),x(null),s({title:"Séance supprimée"})},onError:()=>{s({title:"Suppression impossible",description:"Cette séance est utilisée dans une assignation.",variant:"destructive"})}}),P=()=>{D(u=>({...u,blocks:[...u.blocks,{title:"Nouveau bloc",repetitions:1,description:"",modalities:"",equipment:[],exercises:[{repetitions:4,distance:50,rest:null,stroke:"crawl",strokeType:"nc",intensity:"V2",modalities:"",equipment:[]}]}]}))},C=(u,j,b)=>{const T=[...w.blocks];T[u]={...T[u],[j]:b},D({...w,blocks:T})},q=u=>{const j=w.blocks.filter((b,T)=>T!==u);D({...w,blocks:j})},F=(u,j)=>{const b=j==="up"?u-1:u+1;if(b<0||b>=w.blocks.length)return;const T=[...w.blocks],[$]=T.splice(u,1);T.splice(b,0,$),D({...w,blocks:T})},X=u=>{const j=[...w.blocks];j[u].exercises.push({repetitions:4,distance:50,rest:null,stroke:"crawl",strokeType:"nc",intensity:"V2",modalities:"",equipment:[]}),D({...w,blocks:j})},K=(u,j,b,T)=>{const $=[...w.blocks],re=[...$[u].exercises];re[j]={...re[j],[b]:T},$[u]={...$[u],exercises:re},D({...w,blocks:$})},Se=(u,j)=>{const b=[...w.blocks];b[u].exercises=b[u].exercises.filter((T,$)=>$!==j),D({...w,blocks:b})},Ne=[{value:"palmes",label:"Palmes"},{value:"tuba",label:"Tuba"},{value:"plaquettes",label:"Plaquettes"},{value:"pull",label:"Pull"},{value:"elastique",label:"Élastique"}],we=[{value:"pap",label:"Papillon"},{value:"dos",label:"Dos"},{value:"brasse",label:"Brasse"},{value:"crawl",label:"Crawl"},{value:"4n",label:"4 nages"},{value:"spe",label:"Spé"}],_e=[{value:"nc",label:"NC"},{value:"educ",label:"Educ"},{value:"jambes",label:"Jambes"}];we.reduce((u,j)=>(u[j.value]=j.label,u),{});const ke=_e.reduce((u,j)=>(u[j.value]=j.label,u),{});w.id;const V=c.useMemo(()=>rt(xs(w.blocks)),[w.blocks]),te={nc:"bg-sky-100 text-sky-900 ring-sky-200",educ:"bg-violet-100 text-violet-900 ring-violet-200",jambes:"bg-teal-100 text-teal-900 ring-teal-200"},ye={V0:"text-emerald-800",V1:"text-lime-800",V2:"text-yellow-800",V3:"text-orange-800",Max:"text-red-900"},be={V0:"ring-emerald-200",V1:"ring-lime-200",V2:"ring-yellow-200",V3:"ring-orange-200",Max:"ring-red-300"};return t?e.jsxs("div",{className:"animate-in slide-in-from-bottom-4 motion-reduce:animate-none",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{i(!1),D(Z())},className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Retour",children:e.jsx(br,{className:"h-4 w-4"})}),e.jsx("div",{className:"text-base font-semibold",children:"Édition"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>d({id:w.id??Date.now(),name:w.name,description:w.description,created_by:r??null,items:xs(w.blocks)}),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Aperçu nageur",title:"Aperçu nageur",children:e.jsx(Es,{className:"h-4 w-4"})}),e.jsxs("button",{type:"button",onClick:()=>{if(!w.name.trim()){s({title:"Titre requis",description:"Ajoutez un nom de séance avant d'enregistrer.",variant:"destructive"});return}J.mutate({id:w.id??void 0,name:w.name,description:w.description,estimated_duration:w.estimatedDuration||null,items:xs(w.blocks),created_by:r})},className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(Be,{className:"h-4 w-4"})," Sauver"]})]})]}),e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(L,{className:"rounded-2xl border-border",children:e.jsxs("div",{className:"space-y-3 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Infos séance"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Nom"}),e.jsx("div",{className:"mt-1",children:e.jsx(I,{value:w.name,onChange:u=>D({...w,name:u.target.value}),placeholder:"Nom de la séance",className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Durée estimée (min)"}),e.jsx("div",{className:"mt-1",children:e.jsx(I,{type:"number",min:0,value:w.estimatedDuration||"",onChange:u=>D({...w,estimatedDuration:u.target.value===""?0:Number(u.target.value)}),placeholder:"55",className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Distance totale"}),e.jsxs("div",{className:"mt-1 rounded-2xl border border-border bg-muted px-3 py-2 text-sm font-semibold",children:[V,"m"]})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Vue coach"}),e.jsxs("div",{className:"inline-flex rounded-full border border-border bg-card p-1 text-xs font-semibold",children:[e.jsx("button",{type:"button",onClick:()=>O("compact"),className:B("rounded-full px-3 py-1",N==="compact"?"bg-primary text-primary-foreground":"text-muted-foreground"),children:"Condensé"}),e.jsx("button",{type:"button",onClick:()=>O("detailed"),className:B("rounded-full px-3 py-1",N==="detailed"?"bg-primary text-primary-foreground":"text-muted-foreground"),children:"Détail"})]})]}),N==="compact"?e.jsx(L,{className:"rounded-2xl border-border",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:"Plan (ultra compact)"}),e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Manipule les blocs vite. Passe en “Détail” pour éditer."})]}),e.jsxs(k,{variant:"secondary",size:"sm",onClick:P,className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(xe,{className:"h-4 w-4"})," Bloc"]})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[w.blocks.map((u,j)=>e.jsx("div",{className:"rounded-2xl border border-border bg-card px-3 py-2",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-primary px-2 py-0.5 text-[11px] font-semibold text-primary-foreground",children:[e.jsx(fr,{className:"inline h-3 w-3"})," ",u.repetitions??1,"x"]}),e.jsx("div",{className:"truncate text-xs font-semibold",children:u.title?u.title:`Bloc ${j+1}`}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:["· ",u.exercises.length," ex"]})]}),e.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[u.exercises.slice(0,4).map((b,T)=>{const $=Ve(b.intensity),re=ke[b.strokeType]??b.strokeType;return e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted px-2 py-0.5 text-[11px] font-semibold text-muted-foreground",title:b.modalities?pn(b.modalities):"",children:[b.repetitions&&b.distance?`${b.repetitions}x`:"",b.distance?`${b.distance}m`:"—",e.jsx("span",{className:B("ml-1 inline-flex items-center rounded-full px-2 py-0.5 ring-1",te[b.strokeType]??"bg-muted text-muted-foreground ring-border"),children:re}),e.jsxs("span",{className:B("ml-1 inline-flex items-center gap-1 rounded-full bg-card px-2 py-0.5 ring-1",be[$],ye[$]),children:[e.jsx("span",{className:B("h-2 w-2 rounded-full",Ps[$]??"bg-muted")}),Us($)]})]},`${j}-${T}`)}),u.exercises.length>4?e.jsxs("span",{className:"text-[11px] text-muted-foreground",children:["+",u.exercises.length-4]}):null]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>F(j,"up"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Monter",title:"Monter",disabled:j===0,children:e.jsx(Fs,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>F(j,"down"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Descendre",title:"Descendre",disabled:j===w.blocks.length-1,children:e.jsx(Ts,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>q(j),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer bloc",title:"Supprimer bloc",children:e.jsx(fe,{className:"h-4 w-4"})})]})]})},j)),w.blocks.length?null:e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-muted px-3 py-6 text-center text-sm text-muted-foreground",children:"Aucun bloc. Ajoute un bloc pour commencer."})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Édition détaillée"}),e.jsxs(k,{variant:"secondary",size:"sm",onClick:P,className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(xe,{className:"h-4 w-4"})," Ajouter bloc"]})]}),e.jsx("div",{className:"space-y-4",children:w.blocks.map((u,j)=>e.jsx(L,{className:"rounded-2xl border-border",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"mt-1 inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-muted text-muted-foreground",children:e.jsx(nt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Titre bloc"}),e.jsx(I,{value:u.title,onChange:b=>C(j,"title",b.target.value),placeholder:`Bloc ${j+1}`,className:"rounded-2xl"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>F(j,"up"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Monter",title:"Monter",disabled:j===0,children:e.jsx(Fs,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>F(j,"down"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Descendre",title:"Descendre",disabled:j===w.blocks.length-1,children:e.jsx(Ts,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>q(j),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer bloc",title:"Supprimer bloc",children:e.jsx(fe,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Répétitions du bloc"}),e.jsx("div",{className:"mt-1",children:e.jsx(I,{type:"number",min:1,value:u.repetitions??"",onChange:b=>C(j,"repetitions",b.target.value===""?null:Number(b.target.value)),placeholder:"1",className:"rounded-2xl"})})]}),e.jsx("div",{className:"flex items-end justify-end",children:e.jsxs(k,{variant:"secondary",size:"sm",onClick:()=>X(j),className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(xe,{className:"h-4 w-4"})," Exercice"]})})]}),e.jsx("div",{className:"mt-4 space-y-3",children:u.exercises.map((b,T)=>{const $=Ve(b.intensity),re=b.modalities??"";return e.jsx("div",{className:"rounded-2xl border border-border bg-card p-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"grid flex-1 grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Répétitions"}),e.jsx("div",{className:"mt-1",children:e.jsx(I,{type:"number",min:1,value:b.repetitions??"",onChange:E=>K(j,T,"repetitions",E.target.value===""?null:Number(E.target.value)),className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Distance (m)"}),e.jsx("div",{className:"mt-1",children:e.jsx(I,{type:"number",min:0,value:b.distance??"",onChange:E=>K(j,T,"distance",E.target.value===""?null:Number(E.target.value)),className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Nage"}),e.jsx("div",{className:"mt-1",children:e.jsxs(le,{value:b.stroke,onValueChange:E=>K(j,T,"stroke",E),children:[e.jsx(oe,{className:"rounded-2xl",children:e.jsx(ce,{})}),e.jsx(de,{children:we.map(E=>e.jsx(G,{value:E.value,children:E.label},E.value))})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Type"}),e.jsx("div",{className:"mt-1",children:e.jsxs(le,{value:b.strokeType,onValueChange:E=>K(j,T,"strokeType",E),children:[e.jsx(oe,{className:"rounded-2xl",children:e.jsx(ce,{})}),e.jsx(de,{children:_e.map(E=>e.jsx(G,{value:E.value,children:E.label},E.value))})]})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Intensité (clic sur points)"}),e.jsxs("span",{className:B("inline-flex items-center gap-2 rounded-full bg-card px-2.5 py-1 text-xs font-semibold ring-1",be[$],ye[$]),children:[e.jsx("span",{className:B("h-2 w-2 rounded-full",Ps[$]??"bg-muted")}),Us($)]})]}),e.jsx("div",{className:"mt-2 flex items-center justify-between gap-2",children:e.jsx(cn,{value:b.intensity,onChange:E=>K(j,T,"intensity",E)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Équipements"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:Ne.map(E=>{const Re=b.equipment.includes(E.value),Oe=gr(E.value);return e.jsxs("button",{type:"button",onClick:()=>{const cs=Re?b.equipment.filter(qe=>qe!==E.value):[...b.equipment,E.value];K(j,T,"equipment",cs)},className:B("inline-flex items-center gap-2 rounded-full border px-3 py-2 text-xs font-semibold",Re?"border-primary bg-primary text-primary-foreground":"border-border bg-card text-muted-foreground hover:bg-muted"),children:[e.jsx("span",{className:B("inline-flex h-7 w-7 items-center justify-center rounded-full",Re?"bg-white/10":"bg-muted"),children:Oe?e.jsx("img",{src:Oe,alt:"",className:"h-4 w-4","aria-hidden":"true",loading:"lazy"}):null}),E.label]},E.value)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Modalités"}),e.jsx("div",{className:"mt-1",children:e.jsx(Ae,{value:re,onChange:E=>K(j,T,"modalities",E.target.value),placeholder:"Une modalité par ligne",rows:3,className:"rounded-2xl"})})]})]}),e.jsx("button",{type:"button",onClick:()=>Se(j,T),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer exercice",title:"Supprimer exercice",children:e.jsx(fe,{className:"h-4 w-4"})})]})},T)})}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs(k,{variant:"secondary",size:"sm",onClick:()=>X(j),className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(xe,{className:"h-4 w-4"})," Ajouter exercice"]}),e.jsxs(k,{variant:"destructive",size:"sm",onClick:()=>q(j),className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(fe,{className:"h-4 w-4"})," Supprimer bloc"]})]})]})},j))})]}),e.jsx("div",{className:"h-8"})]}),e.jsx(Pe,{open:!!l,onOpenChange:u=>{u||d(null)},children:e.jsx(De,{className:"max-w-4xl",children:e.jsx(Ds,{title:l?.name??"",description:l?.description??void 0,items:l?.items})})})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:"Coach"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Création"})]}),e.jsxs("button",{type:"button",onClick:()=>{D(Z()),O("compact"),i(!0)},className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(xe,{className:"h-4 w-4"})," Nouvelle"]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-border bg-card px-3 py-2",children:[e.jsx(Nr,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{className:"w-full bg-transparent text-sm outline-none placeholder:text-muted-foreground",placeholder:"Rechercher une séance",value:f,onChange:u=>_(u.target.value)})]}),ve&&e.jsx("div",{className:"mt-4 rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:"Impossible de charger les assignations."}),A&&e.jsx("div",{className:"mt-4 space-y-4",children:[1,2,3].map(u=>e.jsx("div",{className:"h-24 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},u))}),e.jsx("div",{className:"mt-4 space-y-3",children:M.map(u=>{const{totalDistance:j,totalDuration:b,blockCount:T}=hn(u),$=fn(u.id,ee??null),re=!$||W.isPending;return e.jsx(L,{className:"rounded-2xl border-border",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold tracking-tight",children:u.name}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(jr,{className:"h-3.5 w-3.5"}),j,"m"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(wr,{className:"h-3.5 w-3.5"}),"~",b??"—"," min"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(vr,{className:"h-3.5 w-3.5"}),T]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>d(u),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Aperçu nageur",title:"Aperçu nageur",children:e.jsx(Es,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>{D({id:u.id??null,name:u.name??Bs(new Date),description:u.description??"",estimatedDuration:Number(u.estimated_duration??0),blocks:mn(u.items??[])}),O("compact"),i(!0)},className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Modifier",title:"Modifier",children:e.jsx(zr,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>m(u),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Archiver",title:"Archiver",children:e.jsx(Ar,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>{re||x(u)},className:B("inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted",re&&"cursor-not-allowed text-muted-foreground"),"aria-label":"Supprimer",title:ee===null?"Suppression désactivée":$?"Supprimer":"Séance déjà assignée",children:e.jsx(fe,{className:"h-4 w-4"})})]})]})})},u.id)})}),e.jsx("div",{className:"h-8"})]}),e.jsx(Pe,{open:!!l,onOpenChange:u=>{u||d(null)},children:e.jsx(De,{className:"max-w-4xl",children:e.jsx(Ds,{title:l?.name??"",description:l?.description??void 0,items:l?.items})})}),e.jsx(Ue,{open:!!p,onOpenChange:u=>{u||m(null)},children:e.jsxs(We,{children:[e.jsxs(He,{children:[e.jsx(Qe,{children:"Archiver la séance ?"}),e.jsx(Je,{children:"La séance sera masquée du catalogue (sans suppression)."})]}),e.jsxs(Xe,{children:[e.jsx(Ye,{children:"Annuler"}),e.jsx(Ze,{onClick:()=>{p&&(se(u=>new Set([...Array.from(u),p.id])),m(null),s({title:"Séance archivée"}))},children:"Archiver"})]})]})}),e.jsx(Ue,{open:!!g,onOpenChange:u=>{u||x(null)},children:e.jsxs(We,{children:[e.jsxs(He,{children:[e.jsx(Qe,{children:"Supprimer la séance ?"}),e.jsx(Je,{children:"Cette action est définitive. La séance sera supprimée du catalogue."})]}),e.jsxs(Xe,{children:[e.jsx(Ye,{children:"Annuler"}),e.jsx(Ze,{onClick:()=>{g&&W.mutate(g.id)},children:"Supprimer"})]})]})})]})}function jn(s,a,{checkForDefaultPrevented:r=!0}={}){return function(t){if(s?.(t),r===!1||!t.defaultPrevented)return a?.(t)}}var vn=ss[" useInsertionEffect ".trim().toString()]||ts;function yn({prop:s,defaultProp:a,onChange:r=()=>{},caller:n}){const[t,i,l]=bn({defaultProp:a,onChange:r}),d=s!==void 0,g=d?s:t;{const p=c.useRef(s!==void 0);c.useEffect(()=>{const m=p.current;m!==d&&console.warn(`${n} is changing from ${m?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),p.current=d},[d,n])}const x=c.useCallback(p=>{if(d){const m=Nn(p)?p(s):p;m!==s&&l.current?.(m)}else i(p)},[d,s,i,l]);return[g,x]}function bn({defaultProp:s,onChange:a}){const[r,n]=c.useState(s),t=c.useRef(r),i=c.useRef(a);return vn(()=>{i.current=a},[a]),c.useEffect(()=>{t.current!==r&&(i.current?.(r),t.current=r)},[r,t]),[r,n,i]}function Nn(s){return typeof s=="function"}var yt="Toggle",ys=c.forwardRef((s,a)=>{const{pressed:r,defaultPressed:n,onPressedChange:t,...i}=s,[l,d]=yn({prop:r,onChange:t,defaultProp:n??!1,caller:yt});return e.jsx(he.button,{type:"button","aria-pressed":l,"data-state":l?"on":"off","data-disabled":s.disabled?"":void 0,...i,ref:a,onClick:jn(s.onClick,()=>{s.disabled||d(!l)})})});ys.displayName=yt;var bt=ys,wn=ss[" useInsertionEffect ".trim().toString()]||ts;function Nt({prop:s,defaultProp:a,onChange:r=()=>{},caller:n}){const[t,i,l]=_n({defaultProp:a,onChange:r}),d=s!==void 0,g=d?s:t;{const p=c.useRef(s!==void 0);c.useEffect(()=>{const m=p.current;m!==d&&console.warn(`${n} is changing from ${m?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),p.current=d},[d,n])}const x=c.useCallback(p=>{if(d){const m=Cn(p)?p(s):p;m!==s&&l.current?.(m)}else i(p)},[d,s,i,l]);return[g,x]}function _n({defaultProp:s,onChange:a}){const[r,n]=c.useState(s),t=c.useRef(r),i=c.useRef(a);return wn(()=>{i.current=a},[a]),c.useEffect(()=>{t.current!==r&&(i.current?.(r),t.current=r)},[r,t]),[r,n,i]}function Cn(s){return typeof s=="function"}var ge="ToggleGroup",[wt]=ns(ge,[rs]),_t=rs(),bs=ue.forwardRef((s,a)=>{const{type:r,...n}=s;if(r==="single"){const t=n;return e.jsx(Sn,{...t,ref:a})}if(r==="multiple"){const t=n;return e.jsx(kn,{...t,ref:a})}throw new Error(`Missing prop \`type\` expected on \`${ge}\``)});bs.displayName=ge;var[Ct,St]=wt(ge),Sn=ue.forwardRef((s,a)=>{const{value:r,defaultValue:n,onValueChange:t=()=>{},...i}=s,[l,d]=Nt({prop:r,defaultProp:n??"",onChange:t,caller:ge});return e.jsx(Ct,{scope:s.__scopeToggleGroup,type:"single",value:ue.useMemo(()=>l?[l]:[],[l]),onItemActivate:d,onItemDeactivate:ue.useCallback(()=>d(""),[d]),children:e.jsx(kt,{...i,ref:a})})}),kn=ue.forwardRef((s,a)=>{const{value:r,defaultValue:n,onValueChange:t=()=>{},...i}=s,[l,d]=Nt({prop:r,defaultProp:n??[],onChange:t,caller:ge}),g=ue.useCallback(p=>d((m=[])=>[...m,p]),[d]),x=ue.useCallback(p=>d((m=[])=>m.filter(f=>f!==p)),[d]);return e.jsx(Ct,{scope:s.__scopeToggleGroup,type:"multiple",value:l,onItemActivate:g,onItemDeactivate:x,children:e.jsx(kt,{...i,ref:a})})});bs.displayName=ge;var[Rn,En]=wt(ge),kt=ue.forwardRef((s,a)=>{const{__scopeToggleGroup:r,disabled:n=!1,rovingFocus:t=!0,orientation:i,dir:l,loop:d=!0,...g}=s,x=_t(r),p=Xs(l),m={role:"group",dir:p,...g};return e.jsx(Rn,{scope:r,rovingFocus:t,disabled:n,children:t?e.jsx(Ys,{asChild:!0,...x,orientation:i,dir:p,loop:d,children:e.jsx(he.div,{...m,ref:a})}):e.jsx(he.div,{...m,ref:a})})}),es="ToggleGroupItem",Rt=ue.forwardRef((s,a)=>{const r=St(es,s.__scopeToggleGroup),n=En(es,s.__scopeToggleGroup),t=_t(s.__scopeToggleGroup),i=r.value.includes(s.value),l=n.disabled||s.disabled,d={...s,pressed:i,disabled:l},g=ue.useRef(null);return n.rovingFocus?e.jsx(Zs,{asChild:!0,...t,focusable:!l,active:i,ref:g,children:e.jsx(Qs,{...d,ref:a})}):e.jsx(Qs,{...d,ref:a})});Rt.displayName=es;var Qs=ue.forwardRef((s,a)=>{const{__scopeToggleGroup:r,value:n,...t}=s,i=St(es,r),l={role:"radio","aria-checked":s.pressed,"aria-pressed":void 0},d=i.type==="single"?l:void 0;return e.jsx(ys,{...d,...t,ref:a,onPressedChange:g=>{g?i.onItemActivate(n):i.onItemDeactivate(n)}})}),Et=bs,At=Rt;const Pt=ar("inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-2 min-w-9",sm:"h-8 px-1.5 min-w-8",lg:"h-10 px-2.5 min-w-10"}},defaultVariants:{variant:"default",size:"default"}}),An=c.forwardRef(({className:s,variant:a,size:r,...n},t)=>e.jsx(bt,{ref:t,className:B(Pt({variant:a,size:r,className:s})),...n}));An.displayName=bt.displayName;const Dt=c.createContext({size:"default",variant:"default"}),Mt=c.forwardRef(({className:s,variant:a,size:r,children:n,...t},i)=>e.jsx(Et,{ref:i,className:B("flex items-center justify-center gap-1",s),...t,children:e.jsx(Dt.Provider,{value:{variant:a,size:r},children:n})}));Mt.displayName=Et.displayName;const Ke=c.forwardRef(({className:s,children:a,variant:r,size:n,...t},i)=>{const l=c.useContext(Dt);return e.jsx(At,{ref:i,className:B(Pt({variant:l.variant||r,size:l.size||n}),s),...t,children:a})});Ke.displayName=At.displayName;const Me=({title:s,description:a,onBack:r,actions:n})=>e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(k,{variant:"ghost",size:"sm",className:"-ml-2",onClick:r,children:[e.jsx(Rr,{className:"mr-2 h-4 w-4"}),"Retour à l'accueil"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:s}),a?e.jsx("p",{className:"text-sm text-muted-foreground",children:a}):null]}),n?e.jsx("div",{className:"flex items-center gap-2",children:n}):null]});function Te(s,a,{checkForDefaultPrevented:r=!0}={}){return function(t){if(s?.(t),r===!1||!t.defaultPrevented)return a?.(t)}}function Pn(s){const a=Dn(s),r=c.forwardRef((n,t)=>{const{children:i,...l}=n,d=c.Children.toArray(i),g=d.find(Tn);if(g){const x=g.props.children,p=d.map(m=>m===g?c.Children.count(x)>1?c.Children.only(null):c.isValidElement(x)?x.props.children:null:m);return e.jsx(a,{...l,ref:t,children:c.isValidElement(x)?c.cloneElement(x,void 0,p):null})}return e.jsx(a,{...l,ref:t,children:i})});return r.displayName=`${s}.Slot`,r}function Dn(s){const a=c.forwardRef((r,n)=>{const{children:t,...i}=r;if(c.isValidElement(t)){const l=Vn(t),d=Fn(i,t.props);return t.type!==c.Fragment&&(d.ref=n?Ht(n,l):l),c.cloneElement(t,d)}return c.Children.count(t)>1?c.Children.only(null):null});return a.displayName=`${s}.SlotClone`,a}var Mn=Symbol("radix.slottable");function Tn(s){return c.isValidElement(s)&&typeof s.type=="function"&&"__radixId"in s.type&&s.type.__radixId===Mn}function Fn(s,a){const r={...a};for(const n in a){const t=s[n],i=a[n];/^on[A-Z]/.test(n)?t&&i?r[n]=(...d)=>{const g=i(...d);return t(...d),g}:t&&(r[n]=t):n==="style"?r[n]={...t,...i}:n==="className"&&(r[n]=[t,i].filter(Boolean).join(" "))}return{...s,...r}}function Vn(s){let a=Object.getOwnPropertyDescriptor(s.props,"ref")?.get,r=a&&"isReactWarning"in a&&a.isReactWarning;return r?s.ref:(a=Object.getOwnPropertyDescriptor(s,"ref")?.get,r=a&&"isReactWarning"in a&&a.isReactWarning,r?s.props.ref:s.props.ref||s.ref)}var $n=ss[" useInsertionEffect ".trim().toString()]||ts;function In({prop:s,defaultProp:a,onChange:r=()=>{},caller:n}){const[t,i,l]=On({defaultProp:a,onChange:r}),d=s!==void 0,g=d?s:t;{const p=c.useRef(s!==void 0);c.useEffect(()=>{const m=p.current;m!==d&&console.warn(`${n} is changing from ${m?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),p.current=d},[d,n])}const x=c.useCallback(p=>{if(d){const m=qn(p)?p(s):p;m!==s&&l.current?.(m)}else i(p)},[d,s,i,l]);return[g,x]}function On({defaultProp:s,onChange:a}){const[r,n]=c.useState(s),t=c.useRef(r),i=c.useRef(a);return $n(()=>{i.current=a},[a]),c.useEffect(()=>{t.current!==r&&(i.current?.(r),t.current=r)},[r,t]),[r,n,i]}function qn(s){return typeof s=="function"}var os="Popover",[Tt]=ns(os,[et]),Ie=et(),[zn,je]=Tt(os),Ft=s=>{const{__scopePopover:a,children:r,open:n,defaultOpen:t,onOpenChange:i,modal:l=!1}=s,d=Ie(a),g=c.useRef(null),[x,p]=c.useState(!1),[m,f]=In({prop:n,defaultProp:t??!1,onChange:i,caller:os});return e.jsx(Qt,{...d,children:e.jsx(zn,{scope:a,contentId:Jt(),triggerRef:g,open:m,onOpenChange:f,onOpenToggle:c.useCallback(()=>f(_=>!_),[f]),hasCustomAnchor:x,onCustomAnchorAdd:c.useCallback(()=>p(!0),[]),onCustomAnchorRemove:c.useCallback(()=>p(!1),[]),modal:l,children:r})})};Ft.displayName=os;var Vt="PopoverAnchor",Gn=c.forwardRef((s,a)=>{const{__scopePopover:r,...n}=s,t=je(Vt,r),i=Ie(r),{onCustomAnchorAdd:l,onCustomAnchorRemove:d}=t;return c.useEffect(()=>(l(),()=>d()),[l,d]),e.jsx(st,{...i,...n,ref:a})});Gn.displayName=Vt;var $t="PopoverTrigger",It=c.forwardRef((s,a)=>{const{__scopePopover:r,...n}=s,t=je($t,r),i=Ie(r),l=$e(a,t.triggerRef),d=e.jsx(he.button,{type:"button","aria-haspopup":"dialog","aria-expanded":t.open,"aria-controls":t.contentId,"data-state":Lt(t.open),...n,ref:l,onClick:Te(s.onClick,t.onOpenToggle)});return t.hasCustomAnchor?d:e.jsx(st,{asChild:!0,...i,children:d})});It.displayName=$t;var Ns="PopoverPortal",[Ln,Bn]=Tt(Ns,{forceMount:void 0}),Ot=s=>{const{__scopePopover:a,forceMount:r,children:n,container:t}=s,i=je(Ns,a);return e.jsx(Ln,{scope:a,forceMount:r,children:e.jsx(js,{present:r||i.open,children:e.jsx(Xt,{asChild:!0,container:t,children:n})})})};Ot.displayName=Ns;var Ce="PopoverContent",qt=c.forwardRef((s,a)=>{const r=Bn(Ce,s.__scopePopover),{forceMount:n=r.forceMount,...t}=s,i=je(Ce,s.__scopePopover);return e.jsx(js,{present:n||i.open,children:i.modal?e.jsx(Un,{...t,ref:a}):e.jsx(Wn,{...t,ref:a})})});qt.displayName=Ce;var Kn=Pn("PopoverContent.RemoveScroll"),Un=c.forwardRef((s,a)=>{const r=je(Ce,s.__scopePopover),n=c.useRef(null),t=$e(a,n),i=c.useRef(!1);return c.useEffect(()=>{const l=n.current;if(l)return Yt(l)},[]),e.jsx(Zt,{as:Kn,allowPinchZoom:!0,children:e.jsx(zt,{...s,ref:t,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Te(s.onCloseAutoFocus,l=>{l.preventDefault(),i.current||r.triggerRef.current?.focus()}),onPointerDownOutside:Te(s.onPointerDownOutside,l=>{const d=l.detail.originalEvent,g=d.button===0&&d.ctrlKey===!0,x=d.button===2||g;i.current=x},{checkForDefaultPrevented:!1}),onFocusOutside:Te(s.onFocusOutside,l=>l.preventDefault(),{checkForDefaultPrevented:!1})})})}),Wn=c.forwardRef((s,a)=>{const r=je(Ce,s.__scopePopover),n=c.useRef(!1),t=c.useRef(!1);return e.jsx(zt,{...s,ref:a,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{s.onCloseAutoFocus?.(i),i.defaultPrevented||(n.current||r.triggerRef.current?.focus(),i.preventDefault()),n.current=!1,t.current=!1},onInteractOutside:i=>{s.onInteractOutside?.(i),i.defaultPrevented||(n.current=!0,i.detail.originalEvent.type==="pointerdown"&&(t.current=!0));const l=i.target;r.triggerRef.current?.contains(l)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&t.current&&i.preventDefault()}})}),zt=c.forwardRef((s,a)=>{const{__scopePopover:r,trapFocus:n,onOpenAutoFocus:t,onCloseAutoFocus:i,disableOutsidePointerEvents:l,onEscapeKeyDown:d,onPointerDownOutside:g,onFocusOutside:x,onInteractOutside:p,...m}=s,f=je(Ce,r),_=Ie(r);return er(),e.jsx(sr,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:t,onUnmountAutoFocus:i,children:e.jsx(tr,{asChild:!0,disableOutsidePointerEvents:l,onInteractOutside:p,onEscapeKeyDown:d,onPointerDownOutside:g,onFocusOutside:x,onDismiss:()=>f.onOpenChange(!1),children:e.jsx(rr,{"data-state":Lt(f.open),role:"dialog",id:f.contentId,..._,...m,ref:a,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Gt="PopoverClose",Hn=c.forwardRef((s,a)=>{const{__scopePopover:r,...n}=s,t=je(Gt,r);return e.jsx(he.button,{type:"button",...n,ref:a,onClick:Te(s.onClick,()=>t.onOpenChange(!1))})});Hn.displayName=Gt;var Qn="PopoverArrow",Jn=c.forwardRef((s,a)=>{const{__scopePopover:r,...n}=s,t=Ie(r);return e.jsx(nr,{...t,...n,ref:a})});Jn.displayName=Qn;function Lt(s){return s?"open":"closed"}var Xn=Ft,Yn=It,Zn=Ot,Bt=qt;const ea=Xn,sa=Yn,Kt=c.forwardRef(({className:s,align:a="center",sideOffset:r=4,...n},t)=>e.jsx(Zn,{children:e.jsx(Bt,{ref:t,align:a,sideOffset:r,className:B("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",s),...n})}));Kt.displayName=Bt.displayName;const ta=({onBack:s,swimSessions:a,strengthSessions:r,athletes:n,groups:t})=>{const{toast:i}=as(),[l,d]=c.useState({session_type:"swim",session_id:"",assigned_date:new Date().toISOString().split("T")[0],assigned_slot:"morning"}),[g,x]=c.useState(!1),[p,m]=c.useState("user"),[f,_]=c.useState(""),[N,O]=c.useState([]),y=h=>{const M=typeof h=="number"?h:Number(h);return Number.isFinite(M)&&M>0?M:null},se=c.useMemo(()=>n.map(h=>({value:h.id?`id:${h.id}`:`name:${h.display_name}`,label:h.group_label?`${h.display_name} · ${h.group_label}`:h.display_name,id:h.id,name:h.display_name})),[n]),Z=c.useMemo(()=>new Map(se.map(h=>[h.value,h])),[se]),w=c.useMemo(()=>t.map(h=>{const M=y(h.id);return M?{...h,gid:M}:null}).filter(h=>!!h),[t]),D=c.useMemo(()=>w.filter(h=>N.includes(h.gid)),[w,N]),ae=c.useMemo(()=>{if(D.length===0)return"Choisir des groupes";const h=D.slice(0,2).map(J=>J.name).join(", "),M=D.length>2?` +${D.length-2}`:"";return`${h}${M}`},[D]),A=ie({mutationFn:async h=>z.assignments_create(h),onSuccess:()=>{i({title:"Séance assignée & notifiée"})},onError:h=>{const M="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",J=h instanceof Error?h.message:typeof h=="string"?h:M;let W=J;const P=J.match(/HTTP \d+:\s*(\{.*\})/);if(P)try{W=JSON.parse(P[1])?.error||M}catch{W=M}i({title:"Erreur d'assignation",description:W})}}),ee=async()=>{const h=Number(l.session_id);if(!Number.isInteger(h)||h<=0){i({title:"Séance invalide",description:"Sélectionnez une séance valide."});return}if(p==="group"){if(N.length===0){i({title:"Groupe manquant",description:"Sélectionnez au moins un groupe."});return}x(!0);try{const C={assignment_type:l.session_type,session_id:h,scheduled_date:l.assigned_date,scheduled_slot:l.assigned_slot},q=Array.from(new Set(N));await Promise.all(q.map(F=>z.assignments_create({...C,target_group_id:F}))),i({title:"Séance assignée & notifiée"})}catch(C){const q="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",F=C instanceof Error?C.message:typeof C=="string"?C:q;let X=F;const K=F.match(/HTTP \d+:\s*(\{.*\})/);if(K)try{X=JSON.parse(K[1])?.error||q}catch{X=q}i({title:"Erreur d'assignation",description:X})}finally{x(!1)}return}const M=f.trim();if(!M){i({title:"Nageur manquant",description:"Sélectionnez un nageur."});return}const J=Z.get(M),W=J?.id??(Number.isFinite(Number(M))&&Number(M)>0?Number(M):void 0);if(!Number.isFinite(W)||Number(W)<=0){i({title:"Nageur invalide",description:"Sélectionnez un nageur avec un identifiant valide."});return}const P=J?.name??M.replace(/^name:/,"");A.mutate({assignment_type:l.session_type,session_id:h,target_athlete:P,target_user_id:W,scheduled_date:l.assigned_date,scheduled_slot:l.assigned_slot})},ve=!l.session_id||(p==="group"?N.length===0:!f.trim())||A.isPending||g;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(Me,{title:"Assigner une séance",description:"Planifiez une séance pour un nageur ou un ou plusieurs groupes.",onBack:s}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(L,{className:"border-l-4 border-l-primary",children:[e.jsxs(H,{children:[e.jsx(Q,{children:"Séance"}),e.jsx(Y,{children:"Choisissez le type et la séance à envoyer."})]}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Type"}),e.jsxs(le,{value:l.session_type,onValueChange:h=>d({...l,session_type:h,session_id:""}),children:[e.jsx(oe,{children:e.jsx(ce,{})}),e.jsxs(de,{children:[e.jsx(G,{value:"swim",children:"Natation"}),e.jsx(G,{value:"strength",children:"Musculation"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Séance"}),e.jsxs(le,{value:l.session_id,onValueChange:h=>d({...l,session_id:h}),children:[e.jsx(oe,{children:e.jsx(ce,{placeholder:"Choisir..."})}),e.jsx(de,{children:l.session_type==="swim"?a?.map(h=>e.jsx(G,{value:h.id.toString(),children:h.name},h.id)):r?.map(h=>e.jsx(G,{value:h.id.toString(),children:h.title},h.id))})]})]})]})]}),e.jsxs(L,{children:[e.jsxs(H,{children:[e.jsx(Q,{children:"Cible & planification"}),e.jsx(Y,{children:"Définissez le destinataire, la date et le créneau."})]}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Cible"}),e.jsxs(le,{value:p,onValueChange:h=>{m(h),_(""),O([])},children:[e.jsx(oe,{children:e.jsx(ce,{})}),e.jsxs(de,{children:[e.jsx(G,{value:"user",children:"Nageur"}),e.jsx(G,{value:"group",children:"Groupe(s)"})]})]})]}),p==="user"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Nageur"}),se.length>0?e.jsxs(le,{value:f,onValueChange:_,children:[e.jsx(oe,{children:e.jsx(ce,{placeholder:"Choisir un nageur"})}),e.jsx(de,{children:se.map(h=>e.jsx(G,{value:h.value,children:h.label},h.value))})]}):e.jsx(I,{value:f,onChange:h=>_(h.target.value),placeholder:"ex: Camille"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Groupes"}),t.length>0?e.jsxs(ea,{children:[e.jsx(sa,{asChild:!0,children:e.jsxs(k,{type:"button",variant:"outline",className:"w-full justify-between","aria-label":"Sélection des groupes",children:[e.jsx("span",{className:"truncate",children:ae}),e.jsx(dr,{className:"ml-2 h-4 w-4 opacity-50"})]})}),e.jsxs(Kt,{className:"w-[--radix-popover-trigger-width] p-2",align:"start",children:[e.jsx("div",{className:"max-h-64 overflow-auto",children:e.jsx("div",{className:"space-y-1",children:w.map(h=>{const M=N.includes(h.gid);return e.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 hover:bg-muted",children:[e.jsx(hs,{checked:M,onCheckedChange:J=>{const W=J===!0;O(P=>W?P.includes(h.gid)?P:[...P,h.gid]:P.filter(C=>C!==h.gid))}}),e.jsx("span",{className:"text-sm",children:h.name})]},h.gid)})})}),N.length>0?e.jsx(k,{type:"button",variant:"ghost",size:"sm",className:"mt-2 w-full",onClick:()=>O([]),children:"Tout désélectionner"}):null]})]}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"Aucun groupe disponible."}),N.length>0?e.jsxs("div",{className:"text-xs text-muted-foreground",children:[N.length," groupe",N.length>1?"s":""," sélectionné",N.length>1?"s":"","."]}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Date"}),e.jsx(I,{type:"date",value:l.assigned_date,onChange:h=>d({...l,assigned_date:h.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Créneau"}),e.jsxs(le,{value:l.assigned_slot,onValueChange:h=>d({...l,assigned_slot:h}),children:[e.jsx(oe,{children:e.jsx(ce,{placeholder:"Choisir..."})}),e.jsxs(de,{children:[e.jsx(G,{value:"morning",children:"Matin"}),e.jsx(G,{value:"evening",children:"Soir"})]})]})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(k,{className:"w-full sm:w-auto",onClick:ee,disabled:ve,children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),A.isPending||g?"Assignation...":"Assigner & notifier"]})})]})},ra=({onBack:s,athletes:a,groups:r,athletesLoading:n})=>{const{toast:t}=as(),[i,l]=c.useState(""),[d,g]=c.useState("Message Coach"),[x,p]=c.useState(""),m=c.useMemo(()=>a.filter(y=>y.id).map(y=>({value:`user:${y.id}`,label:y.group_label?`${y.display_name} · ${y.group_label}`:y.display_name,id:y.id})),[a]),f=c.useMemo(()=>r.map(y=>({value:`group:${y.id}`,label:y.name,id:y.id})),[r]),_=c.useMemo(()=>new Map([...m,...f].map(y=>[y.value,y])),[m,f]),N=ie({mutationFn:y=>z.notifications_send({...y,type:"message"}),onSuccess:()=>{t({title:"Message envoyé"}),l("")}}),O=()=>{if(!d.trim()||!i.trim()){t({title:"Message incomplet",description:"Ajoutez un titre et un contenu."});return}if(!x){t({title:"Destinataire manquant",description:"Sélectionnez un nageur ou un groupe."});return}const y=_.get(x);if(!y?.id){t({title:"Destinataire invalide",description:"Sélectionnez un destinataire valide."});return}if(x.startsWith("group:")){N.mutate({title:d,body:i,targets:[{target_group_id:y.id}]});return}N.mutate({title:d,body:i,targets:[{target_user_id:y.id}]})};return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(Me,{title:"Messagerie rapide",description:"Envoyez un message ciblé à vos nageurs.",onBack:s}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(L,{className:"border-l-4 border-l-primary",children:[e.jsxs(H,{children:[e.jsx(Q,{children:"Destinataire"}),e.jsx(Y,{children:"Sélectionnez un nageur ou un groupe à prévenir."})]}),e.jsx(U,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Destinataire"}),e.jsxs(le,{value:x,onValueChange:p,children:[e.jsx(oe,{children:e.jsx(ce,{placeholder:n?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(de,{children:[f.length?e.jsxs(e.Fragment,{children:[e.jsx(G,{value:"section-group",disabled:!0,children:"Groupes"}),f.map(y=>e.jsx(G,{value:y.value,children:y.label},y.value))]}):null,m.length?e.jsxs(e.Fragment,{children:[e.jsx(G,{value:"section-athlete",disabled:!0,children:"Nageurs"}),m.map(y=>e.jsx(G,{value:y.value,children:y.label},y.value))]}):null]})]})]})})]}),e.jsxs(L,{children:[e.jsxs(H,{children:[e.jsx(Q,{children:"Contenu"}),e.jsx(Y,{children:"Rédigez votre message en quelques lignes."})]}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"msg-title",children:"Titre"}),e.jsx(I,{id:"msg-title",value:d,onChange:y=>g(y.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"msg-body",children:"Message"}),e.jsx(Ae,{id:"msg-body",placeholder:"Message...",value:i,onChange:y=>l(y.target.value),rows:5,maxLength:500}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[i.length,"/500"]})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(k,{className:"w-full sm:w-auto",onClick:O,disabled:N.isPending,children:[e.jsx(is,{className:"mr-2 h-4 w-4"}),N.isPending?"Envoi...":"Envoyer"]})})]})},na=({onNavigate:s})=>e.jsxs(L,{className:"border-l-4 border-l-primary",children:[e.jsxs(H,{children:[e.jsx(Q,{children:"Actions rapides"}),e.jsx(Y,{children:"Accélérez vos tâches les plus fréquentes."})]}),e.jsxs(U,{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs(k,{className:"justify-start",variant:"outline",onClick:()=>s("assignments"),children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),"Assigner une séance"]}),e.jsxs(k,{className:"justify-start",variant:"outline",onClick:()=>s("messaging"),children:[e.jsx(is,{className:"mr-2 h-4 w-4"}),"Message rapide"]})]})]}),aa=({onNavigate:s,onOpenRecordsAdmin:a,athletes:r,athletesLoading:n,upcomingBirthdays:t,birthdaysLoading:i,kpiLoading:l,kpiPeriod:d,onKpiPeriodChange:g,fatigueAlerts:x,mostLoadedAthlete:p})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Espace Coach"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Votre tableau de bord pour gérer les séances, les nageurs et la communication."})]}),e.jsxs("div",{className:"space-y-3 sm:hidden",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-[0.2em] text-muted-foreground",children:"Par où commencer"})}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("button",{type:"button",onClick:()=>s("swim"),className:"rounded-xl border bg-white p-4 text-left shadow-sm transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Créer une séance natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Structurer un nouveau plan."})]}),e.jsx(Rs,{className:"h-5 w-5 text-primary"})]})}),e.jsx("button",{type:"button",onClick:()=>s("assignments"),className:"rounded-xl border bg-white p-4 text-left shadow-sm transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Assigner une séance"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Envoyer une séance à un nageur."})]}),e.jsx(Fe,{className:"h-5 w-5 text-primary"})]})}),e.jsx("button",{type:"button",onClick:()=>s("messaging"),className:"rounded-xl border bg-white p-4 text-left shadow-sm transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Envoyer un message"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Relancer ou féliciter un nageur."})]}),e.jsx(is,{className:"h-5 w-5 text-primary"})]})})]})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsx(na,{onNavigate:s})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(L,{className:"shadow-sm",children:[e.jsxs(H,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(Rs,{className:"h-5 w-5 text-primary"}),"Natation"]}),e.jsx(Y,{children:"Consultez et créez des séances natation."})]}),e.jsx(U,{children:e.jsx(k,{className:"w-full",onClick:()=>s("swim"),children:"Accéder à la bibliothèque"})})]}),e.jsxs(L,{className:"shadow-sm",children:[e.jsxs(H,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(lr,{className:"h-5 w-5 text-primary"}),"Musculation"]}),e.jsx(Y,{children:"Préparez les plans muscu et les suivis."})]}),e.jsx(U,{children:e.jsx(k,{className:"w-full",onClick:()=>s("strength"),children:"Accéder à la bibliothèque"})})]}),e.jsxs(L,{className:"shadow-sm",children:[e.jsxs(H,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-5 w-5 text-primary"}),"Mes nageurs"]}),e.jsx(Y,{children:"Accédez aux fiches individuelles et aux groupes."})]}),e.jsx(U,{children:e.jsx(k,{className:"w-full",onClick:()=>s("swimmers"),children:"Voir les nageurs"})})]}),e.jsxs(L,{className:"shadow-sm",children:[e.jsxs(H,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(or,{className:"h-5 w-5 text-primary"}),"Records club"]}),e.jsx(Y,{children:"Importer les performances FFN et reconstruire les records."})]}),e.jsx(U,{children:e.jsx(k,{className:"w-full",variant:"outline",onClick:a,children:"Administration des records"})})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(L,{className:"sm:hidden bg-primary text-primary-foreground",children:[e.jsxs(H,{className:"space-y-1",children:[e.jsx(Q,{className:"text-base",children:"Indicateurs clés"}),e.jsx(Y,{className:"text-primary-foreground/70",children:"Synthèse rapide pour aujourd'hui."})]}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-primary-foreground/10 bg-primary-foreground/5 p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-primary-foreground/70",children:"Fatigue 5/5"}),e.jsx("p",{className:"text-2xl font-semibold",children:l?"…":x.length}),e.jsx("p",{className:"text-xs text-primary-foreground/70",children:l?"Chargement...":x.length?x.slice(0,2).map(m=>m.athleteName).join(", "):"Aucune alerte"})]}),e.jsx(Vs,{className:"h-5 w-5 text-primary-foreground/70"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-primary-foreground/10 bg-primary-foreground/5 p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-primary-foreground/70",children:"Nageur le plus chargé"}),e.jsx("p",{className:"text-lg font-semibold",children:l?"…":p?.athleteName??"-"}),e.jsx("p",{className:"text-xs text-primary-foreground/70",children:l?"Calcul en cours":p?`Charge ${Math.round(p.loadScore)}`:"Pas de données récentes"})]}),e.jsx(Le,{className:"h-5 w-5 text-primary-foreground/70"})]})]})]}),e.jsxs(L,{className:"hidden sm:block",children:[e.jsx(H,{className:"space-y-2",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Q,{children:"Signaux clés"}),e.jsx(Y,{children:"Vue d'ensemble rapide de votre groupe."})]}),e.jsxs(Mt,{type:"single",size:"sm",variant:"outline",value:String(d),onValueChange:m=>{m&&g(Number(m))},children:[e.jsx(Ke,{value:"7","aria-label":"Période 7 jours","aria-pressed":d===7,children:"7j"}),e.jsx(Ke,{value:"30","aria-label":"Période 30 jours","aria-pressed":d===30,children:"30j"}),e.jsx(Ke,{value:"365","aria-label":"Période 365 jours","aria-pressed":d===365,children:"365j"})]})]})}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border bg-muted/30 p-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Fatigue 5/5 (",d,"j)"]}),e.jsx("p",{className:"text-xl font-semibold",children:l?"…":x.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l?"Chargement...":x.length?x.slice(0,2).map(m=>m.athleteName).join(", "):"Aucune alerte"})]}),e.jsx(Vs,{className:"h-5 w-5 text-muted-foreground"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border bg-muted/30 p-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Nageur le plus chargé (",d,"j)"]}),e.jsx("p",{className:"text-xl font-semibold",children:l?"…":p?.athleteName??"-"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l?"Calcul en cours":p?`Charge ${Math.round(p.loadScore)}`:"Pas de données récentes"})]}),e.jsx(Le,{className:"h-5 w-5 text-muted-foreground"})]})]})]}),e.jsxs(L,{children:[e.jsxs(H,{children:[e.jsx(Q,{children:"Anniversaires à venir"}),e.jsx(Y,{children:"Les 30 prochains jours."})]}),e.jsxs(U,{className:"space-y-3",children:[i?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Chargement..."}):t&&t.length>0?t.slice(0,3).map(m=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:m.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:ia(m.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-semibold text-primary",children:["J-",m.days_until]})]},m.id)):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun anniversaire dans les 30 prochains jours."}),e.jsx(k,{variant:"outline",className:"w-full",onClick:()=>s("swimmers"),children:"Voir tous les nageurs"})]})]})]})]}),ia=s=>{if(!s)return"-";const a=new Date(s);return Number.isNaN(a.getTime())?s:a.toLocaleDateString("fr-FR")},Js=s=>s.toISOString().split("T")[0],la=s=>new Date(s.completed_at||s.started_at||s.date||s.created_at||0).getTime(),oa=s=>{if(!s.length)return null;const a=s.reduce((n,t)=>n+t,0)/s.length,r=Math.min(5,Math.max(1,Math.round(a/10*5)));return{average:a,rating:r}};function Ta(){const s=Ge(A=>A.role);Ge(A=>A.selectedAthleteId);const a=Ge(A=>A.setSelectedAthlete),[,r]=ir(),[n,t]=c.useState("home"),[i,l]=c.useState(7),d=s==="coach"||s==="admin",g=n==="assignments",x=n==="home"||n==="assignments"||n==="messaging"||n==="swimmers",p=n==="assignments"||n==="messaging",m=n==="home"||n==="swimmers",{data:f}=me({queryKey:["swim_catalog"],queryFn:()=>z.getSwimCatalog(),enabled:d&&g}),{data:_}=me({queryKey:["strength_catalog"],queryFn:()=>z.getStrengthSessions(),enabled:d&&g}),{data:N=[],isLoading:O}=me({queryKey:["athletes"],queryFn:()=>z.getAthletes(),enabled:d&&x}),y=c.useMemo(()=>N.slice(0,5),[N]),{data:se=[]}=me({queryKey:["groups"],queryFn:()=>z.getGroups(),enabled:d&&p}),Z=me({queryKey:["upcoming-birthdays"],queryFn:()=>z.getUpcomingBirthdays({days:30}),enabled:d&&m}),w=Z.data,D=me({queryKey:["coach-kpis",i,y.map(A=>A.id??A.display_name)],enabled:d&&n==="home"&&y.length>0,queryFn:async()=>{const A=i,ee=new Date;ee.setDate(ee.getDate()-A);const ve=Js(ee),h=Js(new Date),M=await Promise.all(y.map(async P=>{const[C,q]=await Promise.all([z.getSessions(P.display_name,P.id),z.getStrengthHistory(P.display_name,{athleteId:P.id,limit:50,from:ve,to:h})]),F=C.filter(V=>new Date(V.date).getTime()>=ee.getTime()),X=F.map(V=>V.fatigue??V.feeling).filter(V=>Number.isFinite(V)),K=F.reduce((V,te)=>V+(Number(te.duration)||0)*(Number(te.effort)||0),0),Ne=(q?.runs??[]).filter(V=>la(V)>=ee.getTime()),we=Ne.map(V=>V.fatigue??V.feeling??V.rpe).filter(V=>Number.isFinite(Number(V))).map(V=>Number(V)),_e=Ne.reduce((V,te)=>{const ye=Number(te.feeling??te.rpe??0),be=Number(te.duration??0);if(be>0&&ye>0)return V+be*ye;const u=Array.isArray(te.logs)?te.logs.length:0;return V+u*5},0),ke=oa([...X,...we]);return{athleteName:P.display_name,loadScore:K+_e,fatigueRating:ke}})),J=M.filter(P=>P.fatigueRating?.rating===5).map(P=>({athleteName:P.athleteName,rating:P.fatigueRating?.rating??0})),W=M.filter(P=>P.loadScore>0).sort((P,C)=>C.loadScore-P.loadScore)[0];return{fatigueAlerts:J,mostLoadedAthlete:W??null}}}),ae=A=>{a({id:A.id??null,name:A.display_name}),r("/progress")};return d?e.jsxs("div",{className:"space-y-6",children:[n==="home"?e.jsx(aa,{onNavigate:t,onOpenRecordsAdmin:()=>r("/records-admin"),athletes:N,athletesLoading:O,upcomingBirthdays:w,birthdaysLoading:Z.isLoading,kpiLoading:D.isLoading,kpiPeriod:i,onKpiPeriodChange:l,fatigueAlerts:D.data?.fatigueAlerts??[],mostLoadedAthlete:D.data?.mostLoadedAthlete??null}):null,n==="assignments"?e.jsx(ta,{onBack:()=>t("home"),swimSessions:f,strengthSessions:_,athletes:N,groups:se}):null,n==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Me,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>t("home"),actions:e.jsxs(k,{variant:"outline",onClick:()=>t("assignments"),children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(gn,{})]}):null,n==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Me,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>t("home"),actions:e.jsxs(k,{variant:"outline",onClick:()=>t("assignments"),children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(an,{})]}):null,n==="swimmers"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Me,{title:"Nageurs",description:"Accédez aux fiches individuelles des nageurs.",onBack:()=>t("home"),actions:e.jsxs(k,{variant:"outline",onClick:()=>t("messaging"),children:[e.jsx(is,{className:"mr-2 h-4 w-4"}),"Message rapide"]})}),e.jsxs(L,{children:[e.jsxs(H,{children:[e.jsx(Q,{children:"Suivi des Nageurs"}),e.jsx(Y,{children:"Accédez aux fiches individuelles des nageurs."})]}),e.jsx(U,{children:O?e.jsx("div",{className:"space-y-3 p-2",children:[1,2,3,4,5].map(A=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-1/3 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"h-4 w-1/4 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"ml-auto h-8 w-16 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"})]},A))}):N.length?e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs(_r,{children:[e.jsx(Cr,{children:e.jsxs(Ms,{children:[e.jsx(ms,{children:"Nageur"}),e.jsx(ms,{children:"Groupe"}),e.jsx(ms,{className:"text-right",children:"Fiche"})]})}),e.jsx(Sr,{children:N.map(A=>e.jsxs(Ms,{children:[e.jsx(ps,{className:"font-medium",children:A.display_name}),e.jsx(ps,{children:A.group_label?e.jsx(kr,{variant:"secondary",children:A.group_label}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"Sans groupe"})}),e.jsx(ps,{className:"text-right",children:e.jsx(k,{size:"sm",variant:"outline",onClick:()=>ae(A),children:"Voir la fiche"})})]},A.id??A.display_name))})]})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun nageur disponible."})})]})]}):null,n==="messaging"?e.jsx(ra,{onBack:()=>t("home"),athletes:N,groups:se,athletesLoading:O}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(L,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(H,{children:[e.jsxs(Q,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(Le,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(Y,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(U,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}export{Ta as default};
