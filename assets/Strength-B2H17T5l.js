import{R as m,T as ks,L as Ts,G as Ds,H as Ms,J as As,r as u,O as Is,j as e}from"./vendor-ui-C9ymspZo.js";import{b as Os,u as mt,d as $s,c as ot}from"./vendor-query-kM2vrB_e.js";import{i as Kt,c as ye,j as as,D as st,B as F,C as Qe,b as Ct,d as Pt,f as is,g as Rt,L as lt,p as Ps,X as Et,q as Ls,u as Fs,I as Dt,h as Me}from"./index-Ckx1yfUE.js";import{S as Lt,a as Ft,b as Ht,c as zt,d as Hs}from"./sheet-Cz8aWamU.js";import{S as Bt}from"./switch-dN7IHaNu.js";import{S as zs,a as Bs,b as qs,c as Vs,d as wt}from"./select-BfTNK-GR.js";import{T as Us,a as Ks,b as Qt,c as Yt}from"./tabs-BuNKXSmf.js";import{B as gt}from"./badge-BMs32RqT.js";import{S as _e}from"./skeleton-CZirY6KC.js";import{A as Ws,a as Qs,b as Ys,c as Xs,d as Gs,e as Js,f as Zs,g as en,P as Xt}from"./alert-dialog-CRlRqv0F.js";import{B as os,C as qt,I as tn}from"./BottomActionBar-BPEpX7z4.js";import{L as sn}from"./loader-circle-B2NPwL9n.js";import{C as nn}from"./circle-check-CDWA-ax-.js";import{S as rn}from"./sticky-note-COjgSmtS.js";import{C as Gt}from"./check-CO911p3d.js";import{T as an}from"./timer-BfdpVelL.js";import{C as on}from"./circle-alert-CAD55kto.js";import{S as ln}from"./search-CS3JxpuE.js";import{C as Jt}from"./chevron-left-CwzB7EZ_.js";import{f as jt}from"./fr-CqUxEDd2.js";import{f as Nt}from"./vendor-date-cQbdWov0.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-DSuxWnoS.js";import"./vendor-supabase-B2MyMyC0.js";import"./chevron-up-OPtm0Vk9.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cn=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],dn=Kt("calendar",cn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const un=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],mn=Kt("pause",un);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fn=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],hn=Kt("sliders-horizontal",fn);function pn(t){if(typeof document>"u")return;let n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",n.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}const ls=m.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),vt=()=>{const t=m.useContext(ls);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};pn(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}`);function xn(){const t=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(t)&&/Mobile/.test(t)||/FxiOS/.test(t))}function gn(){return Wt(/^Mac/)}function vn(){return Wt(/^iPhone/)}function Zt(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function yn(){return Wt(/^iPad/)||gn()&&navigator.maxTouchPoints>1}function cs(){return vn()||yn()}function Wt(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const bn=24,wn=typeof window<"u"?u.useLayoutEffect:u.useEffect;function es(...t){return(...n)=>{for(let r of t)typeof r=="function"&&r(...n)}}const Mt=typeof document<"u"&&window.visualViewport;function ts(t){let n=window.getComputedStyle(t);return/(auto|scroll)/.test(n.overflow+n.overflowX+n.overflowY)}function ds(t){for(ts(t)&&(t=t.parentElement);t&&!ts(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const jn=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let St=0,At;function Nn(t={}){let{isDisabled:n}=t;wn(()=>{if(!n)return St++,St===1&&cs()&&(At=Sn()),()=>{St--,St===0&&At?.()}},[n])}function Sn(){let t,n=0,r=_=>{t=ds(_.target),!(t===document.documentElement&&t===document.body)&&(n=_.changedTouches[0].pageY)},i=_=>{if(!t||t===document.documentElement||t===document.body){_.preventDefault();return}let w=_.changedTouches[0].pageY,H=t.scrollTop,K=t.scrollHeight-t.clientHeight;K!==0&&((H<=0&&w>n||H>=K&&w<n)&&_.preventDefault(),n=w)},c=_=>{let w=_.target;Vt(w)&&w!==document.activeElement&&(_.preventDefault(),w.style.transform="translateY(-2000px)",w.focus(),requestAnimationFrame(()=>{w.style.transform=""}))},l=_=>{let w=_.target;Vt(w)&&(w.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{w.style.transform="",Mt&&(Mt.height<window.innerHeight?requestAnimationFrame(()=>{ss(w)}):Mt.addEventListener("resize",()=>ss(w),{once:!0}))}))},p=()=>{window.scrollTo(0,0)},x=window.pageXOffset,f=window.pageYOffset,k=es(_n(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let g=es(ft(document,"touchstart",r,{passive:!1,capture:!0}),ft(document,"touchmove",i,{passive:!1,capture:!0}),ft(document,"touchend",c,{passive:!1,capture:!0}),ft(document,"focus",l,!0),ft(window,"scroll",p));return()=>{k(),g(),window.scrollTo(x,f)}}function _n(t,n,r){let i=t.style[n];return t.style[n]=r,()=>{t.style[n]=i}}function ft(t,n,r,i){return t.addEventListener(n,r,i),()=>{t.removeEventListener(n,r,i)}}function ss(t){let n=document.scrollingElement||document.documentElement;for(;t&&t!==n;){let r=ds(t);if(r!==document.documentElement&&r!==document.body&&r!==t){let i=r.getBoundingClientRect().top,c=t.getBoundingClientRect().top,l=t.getBoundingClientRect().bottom;const p=r.getBoundingClientRect().bottom+bn;l>p&&(r.scrollTop+=c-i)}t=r.parentElement}}function Vt(t){return t instanceof HTMLInputElement&&!jn.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function Cn(t,n){typeof t=="function"?t(n):t!=null&&(t.current=n)}function Rn(...t){return n=>t.forEach(r=>Cn(r,n))}function us(...t){return u.useCallback(Rn(...t),t)}const ms=new WeakMap;function ce(t,n,r=!1){if(!t||!(t instanceof HTMLElement))return;let i={};Object.entries(n).forEach(([c,l])=>{if(c.startsWith("--")){t.style.setProperty(c,l);return}i[c]=t.style[c],t.style[c]=l}),!r&&ms.set(t,i)}function En(t,n){if(!t||!(t instanceof HTMLElement))return;let r=ms.get(t);r&&(t.style[n]=r[n])}const ie=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function _t(t,n){if(!t)return null;const r=window.getComputedStyle(t),i=r.transform||r.webkitTransform||r.mozTransform;let c=i.match(/^matrix3d\((.+)\)$/);return c?parseFloat(c[1].split(", ")[ie(n)?13:12]):(c=i.match(/^matrix\((.+)\)$/),c?parseFloat(c[1].split(", ")[ie(n)?5:4]):null)}function kn(t){return 8*(Math.log(t+1)-2)}function It(t,n){if(!t)return()=>{};const r=t.style.cssText;return Object.assign(t.style,n),()=>{t.style.cssText=r}}function Tn(...t){return(...n)=>{for(const r of t)typeof r=="function"&&r(...n)}}const G={DURATION:.5,EASE:[.32,.72,0,1]},fs=.4,Dn=.25,Mn=100,hs=8,et=16,Ut=26,Ot="vaul-dragging";function ps(t){const n=m.useRef(t);return m.useEffect(()=>{n.current=t}),m.useMemo(()=>(...r)=>n.current==null?void 0:n.current.call(n,...r),[])}function An({defaultProp:t,onChange:n}){const r=m.useState(t),[i]=r,c=m.useRef(i),l=ps(n);return m.useEffect(()=>{c.current!==i&&(l(i),c.current=i)},[i,c,l]),r}function xs({prop:t,defaultProp:n,onChange:r=()=>{}}){const[i,c]=An({defaultProp:n,onChange:r}),l=t!==void 0,p=l?t:i,x=ps(r),f=m.useCallback(k=>{if(l){const _=typeof k=="function"?k(t):k;_!==t&&x(_)}else c(k)},[l,t,c,x]);return[p,f]}function In({activeSnapPointProp:t,setActiveSnapPointProp:n,snapPoints:r,drawerRef:i,overlayRef:c,fadeFromIndex:l,onSnapPointChange:p,direction:x="bottom",container:f,snapToSequentialPoint:k}){const[g,_]=xs({prop:t,defaultProp:r?.[0],onChange:n}),[w,H]=m.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);m.useEffect(()=>{function d(){H({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[]);const K=m.useMemo(()=>g===r?.[r.length-1]||null,[r,g]),T=m.useMemo(()=>{var d;return(d=r?.findIndex(D=>D===g))!=null?d:null},[r,g]),ee=r&&r.length>0&&(l||l===0)&&!Number.isNaN(l)&&r[l]===g||!r,j=m.useMemo(()=>{const d=f?{width:f.getBoundingClientRect().width,height:f.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var D;return(D=r?.map(M=>{const re=typeof M=="string";let ae=0;if(re&&(ae=parseInt(M,10)),ie(x)){const h=re?ae:w?M*d.height:0;return w?x==="bottom"?d.height-h:-d.height+h:h}const P=re?ae:w?M*d.width:0;return w?x==="right"?d.width-P:-d.width+P:P}))!=null?D:[]},[r,w,f]),C=m.useMemo(()=>T!==null?j?.[T]:null,[j,T]),O=m.useCallback(d=>{var D;const M=(D=j?.findIndex(re=>re===d))!=null?D:null;p(M),ce(i.current,{transition:`transform ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`,transform:ie(x)?`translate3d(0, ${d}px, 0)`:`translate3d(${d}px, 0, 0)`}),j&&M!==j.length-1&&l!==void 0&&M!==l&&M<l?ce(c.current,{transition:`opacity ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`,opacity:"0"}):ce(c.current,{transition:`opacity ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`,opacity:"1"}),_(r?.[Math.max(M,0)])},[i.current,r,j,l,c,_]);m.useEffect(()=>{if(g||t){var d;const D=(d=r?.findIndex(M=>M===t||M===g))!=null?d:-1;j&&D!==-1&&typeof j[D]=="number"&&O(j[D])}},[g,t,r,j,O]);function N({draggedDistance:d,closeDrawer:D,velocity:M,dismissible:re}){if(l===void 0)return;const ae=x==="bottom"||x==="right"?(C??0)-d:(C??0)+d,P=T===l-1,h=T===0,X=d>0;if(P&&ce(c.current,{transition:`opacity ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`}),!k&&M>2&&!X){re?D():O(j[0]);return}if(!k&&M>2&&X&&j&&r){O(j[r.length-1]);return}const J=j?.reduce((W,Q)=>typeof W!="number"||typeof Q!="number"?W:Math.abs(Q-ae)<Math.abs(W-ae)?Q:W),te=ie(x)?window.innerHeight:window.innerWidth;if(M>fs&&Math.abs(d)<te*.4){const W=X?1:-1;if(W>0&&K&&r){O(j[r.length-1]);return}if(h&&W<0&&re&&D(),T===null)return;O(j[T+W]);return}O(J)}function oe({draggedDistance:d}){if(C===null)return;const D=x==="bottom"||x==="right"?C-d:C+d;(x==="bottom"||x==="right")&&D<j[j.length-1]||(x==="top"||x==="left")&&D>j[j.length-1]||ce(i.current,{transform:ie(x)?`translate3d(0, ${D}px, 0)`:`translate3d(${D}px, 0, 0)`})}function be(d,D){if(!r||typeof T!="number"||!j||l===void 0)return null;const M=T===l-1;if(T>=l&&D)return 0;if(M&&!D)return 1;if(!ee&&!M)return null;const ae=M?T+1:T-1,P=M?j[ae]-j[ae-1]:j[ae+1]-j[ae],h=d/Math.abs(P);return M?1-h:h}return{isLastSnapPoint:K,activeSnapPoint:g,shouldFade:ee,getPercentageDragged:be,setActiveSnapPoint:_,activeSnapPointIndex:T,onRelease:N,onDrag:oe,snapPointsOffset:j}}const On=()=>()=>{};function $n(){const{direction:t,isOpen:n,shouldScaleBackground:r,setBackgroundColorOnScale:i,noBodyStyles:c}=vt(),l=m.useRef(null),p=u.useMemo(()=>document.body.style.backgroundColor,[]);function x(){return(window.innerWidth-Ut)/window.innerWidth}m.useEffect(()=>{if(n&&r){l.current&&clearTimeout(l.current);const f=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!f)return;Tn(i&&!c?It(document.body,{background:"black"}):On,It(f,{transformOrigin:ie(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${G.DURATION}s`,transitionTimingFunction:`cubic-bezier(${G.EASE.join(",")})`}));const k=It(f,{borderRadius:`${hs}px`,overflow:"hidden",...ie(t)?{transform:`scale(${x()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${x()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{k(),l.current=window.setTimeout(()=>{p?document.body.style.background=p:document.body.style.removeProperty("background")},G.DURATION*1e3)}}},[n,r,p])}let ht=null;function Pn({isOpen:t,modal:n,nested:r,hasBeenOpened:i,preventScrollRestoration:c,noBodyStyles:l}){const[p,x]=m.useState(()=>typeof window<"u"?window.location.href:""),f=m.useRef(0),k=m.useCallback(()=>{if(Zt()&&ht===null&&t&&!l){ht={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:_,innerHeight:w}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-f.current}px`,left:`${-_}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const H=w-window.innerHeight;H&&f.current>=w&&(document.body.style.top=`${-(f.current+H)}px`)}),300)}},[t]),g=m.useCallback(()=>{if(Zt()&&ht!==null&&!l){const _=-parseInt(document.body.style.top,10),w=-parseInt(document.body.style.left,10);Object.assign(document.body.style,ht),window.requestAnimationFrame(()=>{if(c&&p!==window.location.href){x(window.location.href);return}window.scrollTo(w,_)}),ht=null}},[p]);return m.useEffect(()=>{function _(){f.current=window.scrollY}return _(),window.addEventListener("scroll",_),()=>{window.removeEventListener("scroll",_)}},[]),m.useEffect(()=>{if(n)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||g()}},[n,g]),m.useEffect(()=>{r||!i||(t?(!window.matchMedia("(display-mode: standalone)").matches&&k(),n||window.setTimeout(()=>{g()},500)):g())},[t,i,p,n,r,k,g]),{restorePositionSetting:g}}function Ln({open:t,onOpenChange:n,children:r,onDrag:i,onRelease:c,snapPoints:l,shouldScaleBackground:p=!1,setBackgroundColorOnScale:x=!0,closeThreshold:f=Dn,scrollLockTimeout:k=Mn,dismissible:g=!0,handleOnly:_=!1,fadeFromIndex:w=l&&l.length-1,activeSnapPoint:H,setActiveSnapPoint:K,fixed:T,modal:ee=!0,onClose:j,nested:C,noBodyStyles:O=!1,direction:N="bottom",defaultOpen:oe=!1,disablePreventScroll:be=!0,snapToSequentialPoint:d=!1,preventScrollRestoration:D=!1,repositionInputs:M=!0,onAnimationEnd:re,container:ae,autoFocus:P=!1}){var h,X;const[J=!1,te]=xs({defaultProp:oe,prop:t,onChange:v=>{n?.(v),!v&&!C&&yt(),setTimeout(()=>{re?.(v)},G.DURATION*1e3),v&&!ee&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),v||(document.body.style.pointerEvents="auto")}}),[W,Q]=m.useState(!1),[we,Ie]=m.useState(!1),[nt,Ye]=m.useState(!1),me=m.useRef(null),Oe=m.useRef(null),le=m.useRef(null),Ae=m.useRef(null),je=m.useRef(null),Ce=m.useRef(!1),q=m.useRef(null),Re=m.useRef(0),$e=m.useRef(!1),Xe=m.useRef(!oe),qe=m.useRef(0),S=m.useRef(null),xe=m.useRef(((h=S.current)==null?void 0:h.getBoundingClientRect().height)||0),Ge=m.useRef(((X=S.current)==null?void 0:X.getBoundingClientRect().width)||0),ue=m.useRef(0),Ee=m.useCallback(v=>{l&&v===Ne.length-1&&(Oe.current=new Date)},[]),{activeSnapPoint:ct,activeSnapPointIndex:fe,setActiveSnapPoint:Fe,onRelease:Ve,snapPointsOffset:Ne,onDrag:rt,shouldFade:Pe,getPercentageDragged:Ue}=In({snapPoints:l,activeSnapPointProp:H,setActiveSnapPointProp:K,drawerRef:S,fadeFromIndex:w,overlayRef:me,onSnapPointChange:Ee,direction:N,container:ae,snapToSequentialPoint:d});Nn({isDisabled:!J||we||!ee||nt||!W||!M||!be});const{restorePositionSetting:yt}=Pn({isOpen:J,modal:ee,nested:C??!1,hasBeenOpened:W,preventScrollRestoration:D,noBodyStyles:O});function V(){return(window.innerWidth-Ut)/window.innerWidth}function He(v){var A,$;!g&&!l||S.current&&!S.current.contains(v.target)||(xe.current=((A=S.current)==null?void 0:A.getBoundingClientRect().height)||0,Ge.current=(($=S.current)==null?void 0:$.getBoundingClientRect().width)||0,Ie(!0),le.current=new Date,cs()&&window.addEventListener("touchend",()=>Ce.current=!1,{once:!0}),v.target.setPointerCapture(v.pointerId),Re.current=ie(N)?v.pageY:v.pageX)}function Je(v,A){var $;let E=v;const I=($=window.getSelection())==null?void 0:$.toString(),z=S.current?_t(S.current,N):null,U=new Date;if(E.tagName==="SELECT"||E.hasAttribute("data-vaul-no-drag")||E.closest("[data-vaul-no-drag]"))return!1;if(N==="right"||N==="left")return!0;if(Oe.current&&U.getTime()-Oe.current.getTime()<500)return!1;if(z!==null&&(N==="bottom"?z>0:z<0))return!0;if(I&&I.length>0)return!1;if(je.current&&U.getTime()-je.current.getTime()<k&&z===0||A)return je.current=U,!1;for(;E;){if(E.scrollHeight>E.clientHeight){if(E.scrollTop!==0)return je.current=new Date,!1;if(E.getAttribute("role")==="dialog")return!0}E=E.parentNode}return!0}function de(v){if(S.current&&we){const A=N==="bottom"||N==="right"?1:-1,$=(Re.current-(ie(N)?v.pageY:v.pageX))*A,E=$>0,I=l&&!g&&!E;if(I&&fe===0)return;const z=Math.abs($),U=document.querySelector("[data-vaul-drawer-wrapper]"),se=N==="bottom"||N==="top"?xe.current:Ge.current;let Z=z/se;const pe=Ue(z,E);if(pe!==null&&(Z=pe),I&&Z>=1||!Ce.current&&!Je(v.target,E))return;if(S.current.classList.add(Ot),Ce.current=!0,ce(S.current,{transition:"none"}),ce(me.current,{transition:"none"}),l&&rt({draggedDistance:$}),E&&!l){const ve=kn($),Ke=Math.min(ve*-1,0)*A;ce(S.current,{transform:ie(N)?`translate3d(0, ${Ke}px, 0)`:`translate3d(${Ke}px, 0, 0)`});return}const ge=1-Z;if((Pe||w&&fe===w-1)&&(i?.(v,Z),ce(me.current,{opacity:`${ge}`,transition:"none"},!0)),U&&me.current&&p){const ve=Math.min(V()+Z*(1-V()),1),Ke=8-Z*8,Ze=Math.max(0,14-Z*14);ce(U,{borderRadius:`${Ke}px`,transform:ie(N)?`scale(${ve}) translate3d(0, ${Ze}px, 0)`:`scale(${ve}) translate3d(${Ze}px, 0, 0)`,transition:"none"},!0)}if(!l){const ve=z*A;ce(S.current,{transform:ie(N)?`translate3d(0, ${ve}px, 0)`:`translate3d(${ve}px, 0, 0)`})}}}m.useEffect(()=>{window.requestAnimationFrame(()=>{Xe.current=!0})},[]),m.useEffect(()=>{var v;function A(){if(!S.current||!M)return;const $=document.activeElement;if(Vt($)||$e.current){var E;const I=((E=window.visualViewport)==null?void 0:E.height)||0,z=window.innerHeight;let U=z-I;const se=S.current.getBoundingClientRect().height||0,Z=se>z*.8;ue.current||(ue.current=se);const pe=S.current.getBoundingClientRect().top;if(Math.abs(qe.current-U)>60&&($e.current=!$e.current),l&&l.length>0&&Ne&&fe){const ge=Ne[fe]||0;U+=ge}if(qe.current=U,se>I||$e.current){const ge=S.current.getBoundingClientRect().height;let ve=ge;ge>I&&(ve=I-(Z?pe:Ut)),T?S.current.style.height=`${ge-Math.max(U,0)}px`:S.current.style.height=`${Math.max(ve,I-pe)}px`}else xn()||(S.current.style.height=`${ue.current}px`);l&&l.length>0&&!$e.current?S.current.style.bottom="0px":S.current.style.bottom=`${Math.max(U,0)}px`}}return(v=window.visualViewport)==null||v.addEventListener("resize",A),()=>{var $;return($=window.visualViewport)==null?void 0:$.removeEventListener("resize",A)}},[fe,l,Ne]);function Le(v){he(),j?.(),v||te(!1),setTimeout(()=>{l&&Fe(l[0])},G.DURATION*1e3)}function R(){if(!S.current)return;const v=document.querySelector("[data-vaul-drawer-wrapper]"),A=_t(S.current,N);ce(S.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`}),ce(me.current,{transition:`opacity ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`,opacity:"1"}),p&&A&&A>0&&J&&ce(v,{borderRadius:`${hs}px`,overflow:"hidden",...ie(N)?{transform:`scale(${V()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${V()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${G.DURATION}s`,transitionTimingFunction:`cubic-bezier(${G.EASE.join(",")})`},!0)}function he(){!we||!S.current||(S.current.classList.remove(Ot),Ce.current=!1,Ie(!1),Ae.current=new Date)}function dt(v){if(!we||!S.current)return;S.current.classList.remove(Ot),Ce.current=!1,Ie(!1),Ae.current=new Date;const A=_t(S.current,N);if(!v||!Je(v.target,!1)||!A||Number.isNaN(A)||le.current===null)return;const $=Ae.current.getTime()-le.current.getTime(),E=Re.current-(ie(N)?v.pageY:v.pageX),I=Math.abs(E)/$;if(I>.05&&(Ye(!0),setTimeout(()=>{Ye(!1)},200)),l){Ve({draggedDistance:E*(N==="bottom"||N==="right"?1:-1),closeDrawer:Le,velocity:I,dismissible:g}),c?.(v,!0);return}if(N==="bottom"||N==="right"?E>0:E<0){R(),c?.(v,!0);return}if(I>fs){Le(),c?.(v,!1);return}var z;const U=Math.min((z=S.current.getBoundingClientRect().height)!=null?z:0,window.innerHeight);var se;const Z=Math.min((se=S.current.getBoundingClientRect().width)!=null?se:0,window.innerWidth),pe=N==="left"||N==="right";if(Math.abs(A)>=(pe?Z:U)*f){Le(),c?.(v,!1);return}c?.(v,!0),R()}m.useEffect(()=>(J&&(ce(document.documentElement,{scrollBehavior:"auto"}),Oe.current=new Date),()=>{En(document.documentElement,"scrollBehavior")}),[J]);function at(v){const A=v?(window.innerWidth-et)/window.innerWidth:1,$=v?-et:0;q.current&&window.clearTimeout(q.current),ce(S.current,{transition:`transform ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`,transform:ie(N)?`scale(${A}) translate3d(0, ${$}px, 0)`:`scale(${A}) translate3d(${$}px, 0, 0)`}),!v&&S.current&&(q.current=setTimeout(()=>{const E=_t(S.current,N);ce(S.current,{transition:"none",transform:ie(N)?`translate3d(0, ${E}px, 0)`:`translate3d(${E}px, 0, 0)`})},500))}function ke(v,A){if(A<0)return;const $=(window.innerWidth-et)/window.innerWidth,E=$+A*(1-$),I=-et+A*et;ce(S.current,{transform:ie(N)?`scale(${E}) translate3d(0, ${I}px, 0)`:`scale(${E}) translate3d(${I}px, 0, 0)`,transition:"none"})}function Se(v,A){const $=ie(N)?window.innerHeight:window.innerWidth,E=A?($-et)/$:1,I=A?-et:0;A&&ce(S.current,{transition:`transform ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`,transform:ie(N)?`scale(${E}) translate3d(0, ${I}px, 0)`:`scale(${E}) translate3d(${I}px, 0, 0)`})}return m.useEffect(()=>{ee||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[ee]),m.createElement(Ds,{defaultOpen:oe,onOpenChange:v=>{!g&&!v||(v?Q(!0):Le(!0),te(v))},open:J},m.createElement(ls.Provider,{value:{activeSnapPoint:ct,snapPoints:l,setActiveSnapPoint:Fe,drawerRef:S,overlayRef:me,onOpenChange:n,onPress:He,onRelease:dt,onDrag:de,dismissible:g,shouldAnimate:Xe,handleOnly:_,isOpen:J,isDragging:we,shouldFade:Pe,closeDrawer:Le,onNestedDrag:ke,onNestedOpenChange:at,onNestedRelease:Se,keyboardIsOpen:$e,modal:ee,snapPointsOffset:Ne,activeSnapPointIndex:fe,direction:N,shouldScaleBackground:p,setBackgroundColorOnScale:x,noBodyStyles:O,container:ae,autoFocus:P}},r))}const gs=m.forwardRef(function({...t},n){const{overlayRef:r,snapPoints:i,onRelease:c,shouldFade:l,isOpen:p,modal:x,shouldAnimate:f}=vt(),k=us(n,r),g=i&&i.length>0;if(!x)return null;const _=m.useCallback(w=>c(w),[c]);return m.createElement(Is,{onMouseUp:_,ref:k,"data-vaul-overlay":"","data-vaul-snap-points":p&&g?"true":"false","data-vaul-snap-points-overlay":p&&l?"true":"false","data-vaul-animate":f?.current?"true":"false",...t})});gs.displayName="Drawer.Overlay";const vs=m.forwardRef(function({onPointerDownOutside:t,style:n,onOpenAutoFocus:r,...i},c){const{drawerRef:l,onPress:p,onRelease:x,onDrag:f,keyboardIsOpen:k,snapPointsOffset:g,activeSnapPointIndex:_,modal:w,isOpen:H,direction:K,snapPoints:T,container:ee,handleOnly:j,shouldAnimate:C,autoFocus:O}=vt(),[N,oe]=m.useState(!1),be=us(c,l),d=m.useRef(null),D=m.useRef(null),M=m.useRef(!1),re=T&&T.length>0;$n();const ae=(h,X,J=0)=>{if(M.current)return!0;const te=Math.abs(h.y),W=Math.abs(h.x),Q=W>te,we=["bottom","right"].includes(X)?1:-1;if(X==="left"||X==="right"){if(!(h.x*we<0)&&W>=0&&W<=J)return Q}else if(!(h.y*we<0)&&te>=0&&te<=J)return!Q;return M.current=!0,!0};m.useEffect(()=>{re&&window.requestAnimationFrame(()=>{oe(!0)})},[]);function P(h){d.current=null,M.current=!1,x(h)}return m.createElement(As,{"data-vaul-drawer-direction":K,"data-vaul-drawer":"","data-vaul-delayed-snap-points":N?"true":"false","data-vaul-snap-points":H&&re?"true":"false","data-vaul-custom-container":ee?"true":"false","data-vaul-animate":C?.current?"true":"false",...i,ref:be,style:g&&g.length>0?{"--snap-point-height":`${g[_??0]}px`,...n}:n,onPointerDown:h=>{j||(i.onPointerDown==null||i.onPointerDown.call(i,h),d.current={x:h.pageX,y:h.pageY},p(h))},onOpenAutoFocus:h=>{r?.(h),O||h.preventDefault()},onPointerDownOutside:h=>{if(t?.(h),!w||h.defaultPrevented){h.preventDefault();return}k.current&&(k.current=!1)},onFocusOutside:h=>{if(!w){h.preventDefault();return}},onPointerMove:h=>{if(D.current=h,j||(i.onPointerMove==null||i.onPointerMove.call(i,h),!d.current))return;const X=h.pageY-d.current.y,J=h.pageX-d.current.x,te=h.pointerType==="touch"?10:2;ae({x:J,y:X},K,te)?f(h):(Math.abs(J)>te||Math.abs(X)>te)&&(d.current=null)},onPointerUp:h=>{i.onPointerUp==null||i.onPointerUp.call(i,h),d.current=null,M.current=!1,x(h)},onPointerOut:h=>{i.onPointerOut==null||i.onPointerOut.call(i,h),P(D.current)},onContextMenu:h=>{i.onContextMenu==null||i.onContextMenu.call(i,h),D.current&&P(D.current)}})});vs.displayName="Drawer.Content";const Fn=250,Hn=120,zn=m.forwardRef(function({preventCycle:t=!1,children:n,...r},i){const{closeDrawer:c,isDragging:l,snapPoints:p,activeSnapPoint:x,setActiveSnapPoint:f,dismissible:k,handleOnly:g,isOpen:_,onPress:w,onDrag:H}=vt(),K=m.useRef(null),T=m.useRef(!1);function ee(){if(T.current){O();return}window.setTimeout(()=>{j()},Hn)}function j(){if(l||t||T.current){O();return}if(O(),!p||p.length===0){k||c();return}if(x===p[p.length-1]&&k){c();return}const oe=p.findIndex(d=>d===x);if(oe===-1)return;const be=p[oe+1];f(be)}function C(){K.current=window.setTimeout(()=>{T.current=!0},Fn)}function O(){K.current&&window.clearTimeout(K.current),T.current=!1}return m.createElement("div",{onClick:ee,onPointerCancel:O,onPointerDown:N=>{g&&w(N),C()},onPointerMove:N=>{g&&H(N)},ref:i,"data-vaul-drawer-visible":_?"true":"false","data-vaul-handle":"","aria-hidden":"true",...r},m.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},n))});zn.displayName="Drawer.Handle";function Bn(t){const n=vt(),{container:r=n.container,...i}=t;return m.createElement(Ms,{container:r,...i})}const Be={Root:Ln,Content:vs,Overlay:gs,Portal:Bn,Title:ks,Description:Ts},ys=({shouldScaleBackground:t=!0,...n})=>e.jsx(Be.Root,{shouldScaleBackground:t,...n});ys.displayName="Drawer";const qn=Be.Portal,bs=u.forwardRef(({className:t,...n},r)=>e.jsx(Be.Overlay,{ref:r,className:ye("fixed inset-0 z-50 bg-black/80",t),...n}));bs.displayName=Be.Overlay.displayName;const ws=u.forwardRef(({className:t,children:n,...r},i)=>e.jsxs(qn,{children:[e.jsx(bs,{}),e.jsxs(Be.Content,{ref:i,className:ye("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",t),...r,children:[e.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),n]})]}));ws.displayName="DrawerContent";const js=({className:t,...n})=>e.jsx("div",{className:ye("grid gap-1.5 p-4 text-center sm:text-left",t),...n});js.displayName="DrawerHeader";const Ns=u.forwardRef(({className:t,...n},r)=>e.jsx(Be.Title,{ref:r,className:ye("text-lg font-semibold leading-none tracking-tight",t),...n}));Ns.displayName=Be.Title.displayName;const Ss=u.forwardRef(({className:t,...n},r)=>e.jsx(Be.Description,{ref:r,className:ye("text-sm text-muted-foreground",t),...n}));Ss.displayName=Be.Description.displayName;const Vn=[1,2,3,4,5];function ns({value:t,onChange:n,className:r,disabled:i=!1,size:c="md",ariaLabel:l="Sélecteur d'échelle 1 à 5"}){const p=c==="sm"?"h-10 w-10 text-xs":"h-11 w-11 text-sm";return e.jsx("div",{className:ye("flex items-center gap-2",r),role:"group","aria-label":l,children:Vn.map(x=>{const f=t===x;return e.jsx("button",{type:"button",className:ye("flex items-center justify-center rounded-full border font-semibold transition",p,f?"border-primary bg-primary text-primary-foreground":"border-muted-foreground/30 bg-background text-foreground",i&&"opacity-60"),"aria-pressed":f,disabled:i,onClick:()=>{i||n?.(x)},children:x},x)})})}const Un=()=>{try{const t=new(window.AudioContext||window.webkitAudioContext),n=t.createOscillator(),r=t.createGain();n.connect(r),r.connect(t.destination),n.frequency.value=880,r.gain.value=.3,n.start(),n.stop(t.currentTime+.25);const i=t.createOscillator(),c=t.createGain();i.connect(c),c.connect(t.destination),i.frequency.value=1100,c.gain.value=.3,i.start(t.currentTime+.35),i.stop(t.currentTime+.6),i.onended=()=>t.close()}catch{}try{navigator.vibrate?.([200,100,200])}catch{}},kt=(t,n)=>{const r=Number(t?.set_index??t?.set_number??t?.setIndex??n);return!Number.isFinite(r)||r<=0?n:r},_s=(t=[],n,r)=>{if(!t.length)return 0;const i=Array.isArray(n)?n:[];if(i.length>0){const p=new Map;i.forEach((f,k)=>{if(!f?.exercise_id)return;const g=p.get(f.exercise_id)??[];g.push({...f,set_index:kt(f,k+1)}),p.set(f.exercise_id,g)});let x=t.length+1;for(let f=0;f<t.length;f+=1){const k=t[f];if((p.get(k.exercise_id)??[]).length<(k.sets??0)){x=f+1;break}}return x}const c=Number(r??0);if(!Number.isFinite(c)||c<=0)return 0;const l=Math.min(t.length,Math.max(0,Math.round(c/100*t.length)));return Math.min(t.length,l+1)},ze=(t,n)=>{const r=Number(t);return!Number.isFinite(r)||r<=0?"—":n?`${r}${n}`:String(r)};function Kn({session:t,exercises:n,oneRMs:r,onFinish:i,onStart:c,onLogSets:l,onProgress:p,initialLogs:x,isFinishing:f,initialStep:k,onStepChange:g,initialInputOpen:_,initialSeriesOpen:w,onExitFocus:H,exerciseNotes:K,onUpdateNote:T}){const{toast:ee}=as(),j=u.useRef(!1),[C,O]=u.useState(k??0),[N,oe]=u.useState([]),[be,d]=u.useState(0),[D,M]=u.useState(!0),re=u.useRef(Date.now()),ae=u.useRef(0),[P,h]=u.useState(0),[X,J]=u.useState(!1),[te,W]=u.useState(!1),Q=u.useRef(0),[we,Ie]=u.useState(!0),[nt,Ye]=u.useState(3),[me,Oe]=u.useState(3),[le,Ae]=u.useState(""),[je,Ce]=u.useState(!1),[q,Re]=u.useState(1),[$e,Xe]=u.useState(w??!1),[qe,S]=u.useState(_??!1),[xe,Ge]=u.useState("weight"),[ue,Ee]=u.useState(""),[ct,fe]=u.useState(!1),[Fe,Ve]=u.useState(!1),[Ne,rt]=u.useState(!1),[Pe,Ue]=u.useState(!1),[yt,V]=u.useState(!1),[He,Je]=u.useState("");u.useEffect(()=>{if(!D)return;const a=()=>{const b=Math.floor((Date.now()-re.current)/1e3)+ae.current;d(b)};a();const y=setInterval(a,1e3),Y=()=>{document.visibilityState==="visible"&&a()};return document.addEventListener("visibilitychange",Y),()=>{clearInterval(y),document.removeEventListener("visibilitychange",Y)}},[D]),u.useEffect(()=>{if(!Fe)return;const a=y=>{y.key==="Escape"&&Ve(!1)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[Fe]),u.useEffect(()=>{if(!X||te)return;const a=()=>{if(Q.current<=0)return;const b=Math.max(0,Math.ceil((Q.current-Date.now())/1e3));h(b),b<=0&&(Un(),ee({title:"Temps de récupération terminé"}),J(!1),W(!1))};a();const y=setInterval(a,1e3),Y=()=>{document.visibilityState==="visible"&&a()};return document.addEventListener("visibilitychange",Y),()=>{clearInterval(y),document.removeEventListener("visibilitychange",Y)}},[X,te]);const de=t.items||[],Le=C-1,R=C>0&&C<=de.length?de[Le]:null,he=R?n.find(a=>a.id===R.exercise_id):null,dt=C<de.length?de[C]:null,at=dt?n.find(a=>a.id===dt.exercise_id):null,ke=(()=>{const a=he?.muscle_groups??he?.muscles??he?.muscleGroups??[];return Array.isArray(a)?a:[]})(),Se=R?.rest_seconds??0,v=de.length?Math.min(100,Math.max(0,Math.round((C-1)/de.length*100))):0,A=Number(R?.percent_1rm),$=Number.isFinite(A)&&A>0,E=$&&r.find(a=>a.exercise_id===R?.exercise_id)?.weight||0,I=$?Math.round(E*(A/100)):0,[z,U]=u.useState({}),se=u.useMemo(()=>{const a=new Map;return N.forEach((y,Y)=>{const b=kt(y,Y+1);y.exercise_id&&a.set(`${y.exercise_id}-${b}`,y)}),a},[N]),Z=R?`${R.exercise_id}-${q}`:null,pe=Z?se.get(Z):null,ge=pe?.weight??z[q-1]?.weight??I,ve=pe?.reps??z[q-1]?.reps??R?.reps??"",Ke=()=>{if(typeof window>"u")return;const a=["#22c55e","#3b82f6","#f97316","#e11d48","#a855f7"],y=120;for(let Y=0;Y<y;Y+=1){const b=document.createElement("div"),Te=Math.random()*6+6;b.style.position="fixed",b.style.top="-10px",b.style.left=`${Math.random()*100}vw`,b.style.width=`${Te}px`,b.style.height=`${Te*.6}px`,b.style.backgroundColor=a[Y%a.length],b.style.opacity="0.9",b.style.pointerEvents="none",b.style.zIndex="9999",b.style.borderRadius="2px",document.body.appendChild(b);const De=(Math.random()-.5)*200,We=1200+Math.random()*800,it=Math.random()*360;b.animate([{transform:"translate3d(0, 0, 0) rotate(0deg)",opacity:1},{transform:`translate3d(${De}px, ${window.innerHeight+200}px, 0) rotate(${it}deg)`,opacity:0}],{duration:We,easing:"ease-out"}).onfinish=()=>b.remove()}};u.useEffect(()=>{if(j.current){x&&oe(x);return}if(!x){oe(b=>b.length?[]:b),U(b=>Object.keys(b).length?{}:b);return}if(oe(x),!x.length){U(b=>Object.keys(b).length?{}:b),O(b=>b===0?b:0);return}const a=t.items||[];if(!a.length)return;const y=new Map;x.forEach((b,Te)=>{if(!b.exercise_id)return;const De=y.get(b.exercise_id)??[];De.push({...b,set_index:kt(b,Te+1)}),y.set(b.exercise_id,De)});const Y=_s(a,x);if(Y>0&&Y<=a.length){const b=a[Y-1],Te=y.get(b.exercise_id)??[],De=Te.reduce((it,Tt,Rs)=>{const Es=kt(Tt,Rs+1);return it[Es-1]={reps:Tt.reps??void 0,weight:Tt.weight??void 0},it},{});U(De);const We=Math.min(b.sets??1,Te.length+1);Re(We)}else U({}),Re(1);O(b=>b===Y?b:Y)},[x,t.items]),u.useEffect(()=>{C<=de.length||je||(Ke(),Ce(!0))},[C,de.length,je]);const Ze=a=>{O(a),g?.(a)},ut=a=>{a<=0||(Q.current=Date.now()+a*1e3,h(a),J(!0),W(!1))},bt=async()=>{window.scrollTo({top:0,behavior:"smooth"});const a=C+1;Re(1),U({}),Ze(a);const y=Math.round(Math.min(a-1,de.length)/de.length*100);try{await p?.(y)}catch{ee({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}},s=async()=>{if(!R)return;if(pe){q>=R.sets?await bt():Re(y=>Math.min(R.sets,y+1));return}const a={exercise_id:R.exercise_id,set_number:q,reps:z[q-1]?.reps||R.reps,weight:z[q-1]?.weight||I};oe(y=>[...y,a]),j.current=!0;try{await l?.([a])}catch{ee({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}finally{j.current=!1}if(we&&R.rest_seconds>0&&ut(R.rest_seconds),q>=R.sets){await bt();return}Re(y=>Math.min(R.sets,y+1))},o=a=>{Ge(a);const y=a==="weight"?z[q-1]?.weight??I??"":z[q-1]?.reps??R?.reps??"";Ee(y?String(y):""),fe(!!y),S(!0)},L=()=>{if(!R)return;const a=Number(xe==="weight"?ue.replace(",","."):ue);Number.isFinite(a)&&(U(y=>({...y,[q-1]:{...y[q-1],[xe]:a}})),S(!1))},B=a=>{if(ct){fe(!1),Ee(a);return}Ee(y=>a==="."&&y.includes(".")?y:y+a)},ne=a=>{if(!R)return;Ge(a);const y=a==="weight"?z[q-1]?.weight??I??"":z[q-1]?.reps??R?.reps??"";Ee(y?String(y):""),fe(!!y)};return C===0?e.jsxs("div",{className:"space-y-6 text-center py-8 animate-in zoom-in duration-300",children:[e.jsx("div",{className:"h-24 w-24 bg-primary/10 rounded-full flex items-center justify-center mx-auto animate-pulse",children:e.jsx(st,{className:"h-10 w-10 text-primary ml-1"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold font-display uppercase",children:t.title}),e.jsx("p",{className:"text-muted-foreground text-lg",children:t.description}),e.jsxs("div",{className:"flex gap-2 justify-center mt-4",children:[e.jsx(gt,{variant:"outline",className:"text-sm px-3 py-1",children:t.cycle}),e.jsxs(gt,{variant:"secondary",className:"text-sm px-3 py-1",children:[de.length," Exercices"]})]})]}),e.jsx(F,{size:"lg",className:"w-full text-xl h-14 font-bold uppercase tracking-wider shadow-lg hover:scale-[1.02] transition-transform",disabled:Ne,onClick:async()=>{rt(!0);try{await c?.(),Ze(1)}finally{rt(!1)}},children:Ne?e.jsxs(e.Fragment,{children:[e.jsx(sn,{className:"mr-2 h-5 w-5 animate-spin"}),"CHARGEMENT..."]}):"COMMENCER SÉANCE"})]}):C>de.length?e.jsx("div",{className:"space-y-6 animate-in fade-in",children:e.jsxs(Qe,{className:"border-t-8 border-t-primary shadow-xl",children:[e.jsxs(Ct,{className:"text-center pb-2",children:[e.jsx("div",{className:"mx-auto bg-primary/10 p-4 rounded-full w-fit mb-4",children:e.jsx(nn,{className:"h-12 w-12 text-primary"})}),e.jsx(Pt,{className:"text-3xl uppercase font-display italic",children:"Séance Terminée !"}),e.jsxs(is,{className:"text-lg",children:["Durée totale: ",Math.floor(be/60),"m ",be%60,"s"]})]}),e.jsxs(Rt,{className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Volume"}),e.jsxs("div",{className:"text-2xl font-mono font-bold",children:[N.reduce((a,y)=>a+(Number(y.weight)||0)*(Number(y.reps)||0),0)," kg"]})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Séries"}),e.jsx("div",{className:"text-2xl font-mono font-bold",children:N.length})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(lt,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Difficulté de la séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Facile"}),e.jsx("span",{children:"Très dur"})]}),e.jsx(ns,{value:nt,onChange:Ye})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(lt,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Fatigue fin de séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Frais"}),e.jsx("span",{children:"Épuisé"})]}),e.jsx(ns,{value:me,onChange:Oe})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(lt,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Notes"}),e.jsx("textarea",{placeholder:"Sensations, douleurs...",value:le,onChange:a=>Ae(a.target.value),rows:3,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none"})]})]}),e.jsx(Ps,{children:e.jsx(F,{className:"w-full h-14 text-lg font-bold uppercase",disabled:f,onClick:()=>{f||i({duration:Math.floor(be/60),feeling:nt,fatigue:me,comments:le,logs:N})},children:f?"ENREGISTREMENT...":"ENREGISTRER & FERMER"})})]})}):e.jsxs("div",{className:"space-y-6 pb-32",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button","aria-label":"Voir l’animation de l’exercice",onClick:()=>{he?.illustration_gif&&Ve(!0)},className:"flex h-12 w-12 items-center justify-center overflow-hidden rounded-full border bg-card shadow-sm",children:he?.illustration_gif?e.jsx("img",{src:he.illustration_gif,alt:"",className:"h-full w-full object-cover",loading:"lazy",decoding:"async"}):e.jsx(st,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold",children:["Ex ",C,"/",de.length]}),e.jsxs("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold",children:["S ",q,"/",ze(R?.sets)]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Séance"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-28 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${v}%`}})}),e.jsxs("div",{className:"text-sm font-semibold",children:[v,"%"]})]}),H?e.jsx(F,{variant:"ghost",size:"icon","aria-label":"Quitter le focus",onClick:()=>{N.length>0?Ue(!0):H()},children:e.jsx(Et,{className:"h-4 w-4"})}):null]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-2xl font-semibold tracking-tight",children:he?.nom_exercice??"Exercice"}),T&&R&&e.jsx(F,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",onClick:()=>{Je(K?.[R.exercise_id]??""),V(!0)},"aria-label":"Notes personnelles",children:e.jsx(rn,{className:ye("h-4 w-4",K?.[R?.exercise_id]?"text-primary":"text-muted-foreground")})})]}),R&&K?.[R.exercise_id]&&e.jsx("p",{className:"mt-1 text-xs italic text-muted-foreground line-clamp-2",children:K[R.exercise_id]}),ke.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:ke.map(a=>e.jsx("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:a},a))})]}),e.jsxs(Qe,{className:"rounded-3xl border bg-card p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-base font-semibold",children:"Série en cours"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Bt,{checked:we,onCheckedChange:Ie}),"Auto repos"]})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border bg-muted/20 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"En cours"}),e.jsxs("div",{className:"mt-2 text-lg font-semibold",children:["Série ",q,"/",ze(R?.sets)," · Objectif"," ",ze(R?.reps)," reps"]}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:"Appuie sur une tuile pour saisir."})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>o("weight"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:ge||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>o("reps"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:ve||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"reps"})]})]})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border bg-muted/10 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Notes"}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:R?.notes||he?.description||"Aucune note spécifique."})]}),e.jsx(F,{type:"button",variant:"outline",className:"mt-4 w-full rounded-2xl",onClick:()=>Xe(!0),children:"Voir les séries"})]}),!qe&&!X?e.jsxs(os,{className:"bottom-0 z-[60]",containerClassName:"gap-3 py-4",children:[e.jsxs(F,{className:"flex-1 min-w-0 h-12 rounded-xl text-sm font-bold shadow-lg active:scale-95 transition-transform",onClick:s,children:[e.jsx(Gt,{className:"mr-2 h-5 w-5"})," Valider série"]}),e.jsx(F,{type:"button",variant:"outline",className:"h-12 w-12 rounded-xl p-0 active:scale-95 transition-transform",onClick:()=>{Se<=0||ut(Se)},"aria-label":"Démarrer le repos",children:e.jsx(an,{className:"h-5 w-5"})}),e.jsx(F,{type:"button",variant:"outline",className:"h-12 w-12 rounded-xl p-0 active:scale-95 transition-transform",onClick:()=>bt(),"aria-label":"Exercice suivant",children:e.jsx(qt,{className:"h-5 w-5"})})]}):null,X&&e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-background/95 pb-[env(safe-area-inset-bottom)]",children:[e.jsxs("div",{className:"flex items-start justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Timer"}),e.jsx("div",{className:"text-lg font-semibold",children:"Transition inter-exercice"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Prochain exercice : ",at?.nom_exercice??"À venir"]})]}),e.jsx(F,{variant:"ghost",size:"icon",onClick:()=>{J(!1),W(!1)},"aria-label":"Fermer le timer de repos",children:e.jsx(Et,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-6 px-6 py-8",children:[e.jsxs(Qe,{className:"w-full max-w-sm rounded-3xl border p-6 shadow-sm",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Temps restant"}),e.jsxs("div",{className:"mt-2 text-5xl font-semibold tracking-tight",children:[Math.floor(P/60),":",String(P%60).padStart(2,"0")]}),e.jsx("div",{className:"mt-6 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:Se?`${P/Se*100}%`:"0%"}})}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[e.jsx(F,{variant:"outline",className:"rounded-full",onClick:()=>{Q.current+=15*1e3,h(a=>a+15)},children:"+15s"}),e.jsx(F,{variant:"outline",className:"rounded-full",onClick:()=>{Q.current+=30*1e3,h(a=>a+30)},children:"+30s"}),e.jsx(F,{variant:"outline",className:"rounded-full",onClick:()=>{Q.current=Math.max(Date.now(),Q.current-15*1e3),h(a=>Math.max(0,a-15))},children:"-15s"}),e.jsxs(F,{variant:"outline",className:"ml-auto rounded-full",onClick:()=>{Q.current=Date.now()+Se*1e3,h(Se)},children:[e.jsx(Ls,{className:"mr-2 h-4 w-4"}),"Reset"]})]})]}),e.jsxs("div",{className:"flex w-full max-w-sm flex-wrap gap-3",children:[e.jsxs(F,{className:"flex-1 rounded-full py-6 text-base font-semibold",onClick:()=>{te&&(Q.current=Date.now()+P*1e3),W(a=>!a)},children:[e.jsx(mn,{className:"mr-2 h-4 w-4"})," ",te?"Reprendre":"Pause"]}),e.jsxs(F,{variant:"outline",className:"rounded-full px-6 py-6 text-base font-semibold",onClick:()=>{Q.current=0,J(!1),h(0),W(!1)},children:["Passer ",e.jsx(qt,{className:"ml-2 h-4 w-4"})]})]})]})]}),Fe&&he?.illustration_gif&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:()=>Ve(!1),children:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button","aria-label":"Fermer",className:"absolute -right-3 -top-3 rounded-full bg-background p-2 shadow",onClick:()=>Ve(!1),children:e.jsx(Et,{className:"h-4 w-4"})}),e.jsx("img",{src:he.illustration_gif,alt:"",className:"max-h-[80vh] w-auto max-w-[92vw] rounded-2xl",loading:"lazy"})]})})}),e.jsx(Lt,{open:$e,onOpenChange:Xe,children:e.jsxs(Ft,{side:"bottom",className:"max-h-[80vh] overflow-y-auto",children:[e.jsx(Ht,{children:e.jsx(zt,{children:"Aperçu séance"})}),e.jsx("div",{className:"mt-4 space-y-4",children:de.map((a,y)=>{const Y=n.find(De=>De.id===a.exercise_id),b=Array.from({length:a.sets}).filter((De,We)=>se.get(`${a.exercise_id}-${We+1}`)).length,Te=a.sets?Math.round(b/a.sets*100):0;return e.jsxs(Qe,{className:"rounded-3xl border bg-muted/10 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:Y?.nom_exercice??a.exercise_name}),e.jsxs("div",{className:"mt-1 text-sm text-muted-foreground",children:[ze(a.sets),"x",ze(a.reps)," ·"," ",a.percent_1rm?`${ze(a.percent_1rm)} 1RM`:"—"]})]}),e.jsxs("div",{className:"rounded-full bg-muted px-3 py-1 text-sm font-semibold",children:[b,"/",ze(a.sets)]})]}),e.jsx("div",{className:"mt-4 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${Te}%`}})})]},`${a.exercise_id}-${y}`)})})]})}),e.jsx(ys,{open:qe,onOpenChange:S,children:e.jsx(ws,{className:"max-h-[90vh]",children:e.jsxs("div",{className:"mx-auto w-full max-w-md px-4 pb-8",children:[e.jsxs(js,{className:"pb-2",children:[e.jsx(Ns,{className:"text-center",children:xe==="weight"?"Charge":"Répétitions"}),e.jsxs(Ss,{className:"text-center",children:["Série ",q,"/",ze(R?.sets)," · Objectif"," ",ze(R?.reps)," reps"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("button",{type:"button",className:ye("rounded-xl border-2 p-4 text-center transition-all",xe==="weight"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>ne("weight"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[xe==="weight"?ue||"—":String(z[q-1]?.weight??I??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:ye("rounded-xl border-2 p-4 text-center transition-all",xe==="reps"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>ne("reps"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[xe==="reps"?ue||"—":String(z[q-1]?.reps??R?.reps??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"reps"})]})]})]}),xe==="weight"&&I>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[I-10,I-5,I,I+5,I+10].filter(a=>a>0).map(a=>e.jsxs(F,{variant:Number(ue)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>Ee(String(a)),children:[a," kg"]},a))})]}),xe==="reps"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[6,8,10,12,15,20].map(a=>e.jsx(F,{variant:Number(ue)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>Ee(String(a)),children:a},a))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[[1,2,3,4,5,6,7,8,9].map(a=>e.jsx(F,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>B(String(a)),children:a},a)),e.jsx(F,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>B("."),children:","}),e.jsx(F,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>B("0"),children:"0"}),e.jsx(F,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>{fe(!1),Ee(a=>a.slice(0,-1))},children:"⌫"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(F,{variant:"outline",className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:()=>{fe(!1),Ee("")},children:"Effacer"}),e.jsxs(F,{className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:L,children:[e.jsx(Gt,{className:"mr-2 h-5 w-5"}),"Valider"]})]})]})})}),H&&e.jsx(Ws,{open:Pe,onOpenChange:Ue,children:e.jsxs(Qs,{children:[e.jsxs(Ys,{children:[e.jsx(Xs,{children:"Quitter la séance ?"}),e.jsx(Gs,{children:"Les séries enregistrées seront conservées."})]}),e.jsxs(Js,{children:[e.jsx(Zs,{children:"Annuler"}),e.jsx(en,{onClick:()=>{Ue(!1),H()},children:"Quitter"})]})]})}),T&&e.jsx(Lt,{open:yt,onOpenChange:a=>{if(!a&&R){const y=He.trim()||null,Y=K?.[R.exercise_id]??null;y!==Y&&T(R.exercise_id,y)}V(a)},children:e.jsxs(Ft,{side:"bottom",className:"max-h-[60vh]",children:[e.jsx(Ht,{children:e.jsxs(zt,{children:["Notes — ",he?.nom_exercice]})}),e.jsx("textarea",{value:He,onChange:a=>Je(a.target.value),placeholder:"Réglages machine, repères personnels...",rows:4,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm mt-4 resize-none ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"})]})})]})}const tt=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance",pt=t=>{const n=Number(t);return!Number.isFinite(n)||n<=0?null:n},Wn=(t,n)=>{if(!t)return{sets:null,reps:null,percent1rm:null,restSeries:null,restExercise:null};const r={endurance:{sets:t.Nb_series_endurance,reps:t.Nb_reps_endurance,percent1rm:t.pct_1rm_endurance,restSeries:t.recup_endurance,restExercise:t.recup_exercices_endurance},hypertrophie:{sets:t.Nb_series_hypertrophie,reps:t.Nb_reps_hypertrophie,percent1rm:t.pct_1rm_hypertrophie,restSeries:t.recup_hypertrophie,restExercise:t.recup_exercices_hypertrophie},force:{sets:t.Nb_series_force,reps:t.Nb_reps_force,percent1rm:t.pct_1rm_force,restSeries:t.recup_force,restExercise:t.recup_exercices_force}}[n];return{sets:pt(r.sets),reps:pt(r.reps),percent1rm:pt(r.percent1rm),restSeries:pt(r.restSeries),restExercise:pt(r.restExercise)}},xt=(t=[],n,r)=>Yn(t,n).map(i=>{const c=Wn(r.get(i.exercise_id),n);return{...i,sets:c.sets??0,reps:c.reps??0,rest_seconds:c.restSeries??0,percent_1rm:c.percent1rm??0}}),rs=t=>{const n=Number(t);return!Number.isFinite(n)||n<=0?"—":String(n)},Qn=t=>{const n=Number(t);return!Number.isFinite(n)||n<=0?"—":`${n}s`},Cs=(t=[])=>{if(!t.length)return t;const n=t.map((i,c)=>{const l=Number(i.order_index);return{item:i,index:c,order:Number.isFinite(l)?l:null}});return n.some(i=>i.order!==null)?n.sort((i,c)=>i.order===null&&c.order===null?i.index-c.index:i.order===null?1:c.order===null?-1:i.order===c.order?i.index-c.index:i.order-c.order).map(i=>i.item):t},Yn=(t=[],n)=>{const r=t.filter(c=>c.cycle_type===n),i=r.length?r:t;return Cs(i)},Xn=t=>{t.setActiveSession(null),t.setActiveAssignment(null),t.setActiveRunId(null),t.setActiveRunLogs(null),t.setActiveRunnerStep(0),t.setScreenMode("list")},Gn=({runId:t,assignmentId:n,startedAt:r})=>({id:t,assignment_id:n??null,started_at:r,progress_pct:0,status:"in_progress",logs:[]}),$t=t=>({runs:t?[t]:[],pagination:{limit:1,offset:0,total:t?1:0},exercise_summary:[]});function Nr(){const{user:t,userId:n,role:r,selectedAthleteId:i,selectedAthleteName:c}=Fs(),{toast:l}=as(),p=Os(),x="strength-preferences",[f,k]=u.useState(null),[g,_]=u.useState(null),[w,H]=u.useState(null),[K,T]=u.useState(null),[ee,j]=u.useState(0),[C,O]=u.useState("list"),[N,oe]=u.useState(!1),[be,d]=u.useState("idle"),[D,M]=u.useState({poolMode:!1,largeText:!1}),[re,ae]=u.useState(""),[P,h]=u.useState("endurance"),[X,J]=u.useState("all"),[te,W]=u.useState(""),[Q,we]=u.useState(""),[Ie,nt]=u.useState(null),Ye=(r==="coach"||r==="admin")&&(i!==null||!!c),me=Ye?c:t,Oe=Ye?i:n,le=Oe??me,Ae=u.useMemo(()=>`strength-focus-state-${le??"anonymous"}`,[le]),{poolMode:je,largeText:Ce}=D;u.useEffect(()=>{if(typeof window>"u")return;const s=window.localStorage.getItem(x);if(s)try{const o=JSON.parse(s);M(L=>({...L,...o??{}}))}catch{return}},[]),u.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(x,JSON.stringify(D))},[x,D]),u.useEffect(()=>{if(!(typeof document>"u")){if(C==="focus")return document.body.dataset.focusMode="strength",()=>{document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode};document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode}},[C]),u.useEffect(()=>{if(typeof window>"u"||f)return;const s=window.localStorage.getItem(Ae);if(s)try{const o=JSON.parse(s),L=o?.screenMode==="focus"?"focus":o?.screenMode==="reader"?"reader":null;if(!L||!o?.session)return;k(o.session),_(o.assignment??null),H(typeof o.runId=="number"?o.runId:null),T(Array.isArray(o.runLogs)?o.runLogs:null),j(Number.isFinite(o.runnerStep)?o.runnerStep:0),o.cycleType&&h(tt(o.cycleType)),O(L)}catch{return}},[f,Ae]),u.useEffect(()=>{if(typeof window>"u")return;if(!(C==="focus"||C==="reader")||!f){window.localStorage.removeItem(Ae);return}const o={screenMode:C,session:f,assignment:g,runId:w,runLogs:K,runnerStep:ee,cycleType:P};window.localStorage.setItem(Ae,JSON.stringify(o))},[g,w,K,ee,f,P,Ae,C]);const{data:q,isLoading:Re,error:$e,refetch:Xe}=mt({queryKey:["assignments",t,"strength"],queryFn:()=>Me.getAssignments(t,n,{assignmentType:"strength"}),enabled:!!t}),{data:qe,isLoading:S,error:xe,refetch:Ge}=mt({queryKey:["strength_catalog"],queryFn:()=>Me.getStrengthSessions()}),{data:ue,error:Ee,refetch:ct}=mt({queryKey:["exercises"],queryFn:()=>Me.getExercises()}),fe=Re||S,Fe=$e||xe||Ee,Ve=()=>{Xe(),Ge(),ct()},{data:Ne}=mt({queryKey:["1rm",t,n],queryFn:()=>Me.get1RM({athleteName:t,athleteId:n}),enabled:!!t}),rt=u.useMemo(()=>{const s={};return(Ne??[]).forEach(o=>{o.notes&&(s[o.exercise_id]=o.notes)}),s},[Ne]),Pe=$s({queryKey:["strength_history",le,X,te,Q],queryFn:({pageParam:s=0})=>Me.getStrengthHistory(me,{athleteId:Oe,limit:10,offset:s,order:"desc",status:X==="all"?void 0:X,from:te||void 0,to:Q||void 0}),enabled:!!me,getNextPageParam:s=>{const o=s.pagination.offset+s.pagination.limit;return o<s.pagination.total?o:void 0},initialPageParam:0}),Ue=Pe.data?.pages.flatMap(s=>s.runs)??[],V=mt({queryKey:["strength_run_in_progress",le],queryFn:()=>Me.getStrengthHistory(me,{limit:1,offset:0,order:"desc",status:"in_progress",athleteId:Oe}),enabled:!!me}).data?.runs?.[0]??null,He=V?.status==="completed"||(V?.progress_pct??0)>=100,Je=ot({mutationFn:s=>Me.startStrengthRun(s),onMutate:()=>{d("saving")},onSuccess:s=>{if(d("saved"),setTimeout(()=>d("idle"),2e3),s?.run_id&&(H(s.run_id),T(o=>o??[]),le)){const o=Gn({runId:s.run_id,assignmentId:g?.id??null,startedAt:new Date().toISOString()});p.setQueryData(["strength_run_in_progress",le],$t(o))}p.invalidateQueries({queryKey:["assignments",t,"strength"]}),p.invalidateQueries({queryKey:["strength_run_in_progress",le]}),p.invalidateQueries({queryKey:["strength_history"]})},onError:()=>{d("error"),setTimeout(()=>d("idle"),3e3),l({title:"Erreur",description:"Impossible de démarrer la séance.",variant:"destructive"})}}),de=ot({mutationFn:s=>Me.logStrengthSet(s),onMutate:()=>{d("saving")},onSuccess:s=>{d("saved"),setTimeout(()=>d("idle"),2e3),s?.one_rm_updated&&(p.invalidateQueries({queryKey:["1rm",t,n]}),l({title:"Nouveau 1RM détecté",description:"Ton record vient d'être mis à jour."}))},onError:()=>{d("error"),setTimeout(()=>d("idle"),3e3),l({title:"Erreur",description:"Impossible d'enregistrer une série.",variant:"destructive"})}}),Le=ot({mutationFn:s=>Me.updateStrengthRun(s),onMutate:()=>{d("saving")},onSuccess:(s,o)=>{d("saved"),setTimeout(()=>d("idle"),2e3),oe(!1),p.invalidateQueries({queryKey:["strength_history"]}),o?.status==="completed"&&(le&&p.setQueryData(["strength_run_in_progress",le],$t(null)),p.invalidateQueries({queryKey:["assignments",t]}),p.invalidateQueries({queryKey:["assignments",t,"strength"]}),p.invalidateQueries({queryKey:["1rm",t,n]}),_(null),H(null),k(null),T(null),O("list"),l({title:"Séance sauvegardée",description:"Bravo pour l'effort !"}))},onError:(s,o)=>{d("error"),setTimeout(()=>d("idle"),3e3),o?.status==="completed"&&(oe(!1),l({title:"Erreur",description:"Impossible d'enregistrer la séance. Réessayez.",variant:"destructive"}))}}),R=ot({mutationFn:s=>Me.updateExerciseNote({athlete_id:n??0,exercise_id:s.exercise_id,notes:s.notes}),onMutate:()=>{d("saving")},onSuccess:()=>{d("saved"),setTimeout(()=>d("idle"),2e3),p.invalidateQueries({queryKey:["1rm",t,n]})},onError:()=>{d("error"),setTimeout(()=>d("idle"),3e3),l({title:"Erreur",description:"Impossible de sauvegarder la note.",variant:"destructive"})}});ot({mutationFn:s=>Me.startStrengthRun(s),onError:()=>{l({title:"Erreur",description:"Impossible de mettre à jour la séance.",variant:"destructive"})}});const he=(s,o)=>{const L=s.items??[],B=tt(o??s.cycle??L.find(a=>a.cycle_type)?.cycle_type),ne=xt(L,B,E);_(s),k({...s,title:s.title,description:s.description,cycle:B,items:ne}),H(null),T(null),j(0),O("reader")},at=(q?.filter(s=>s.session_type==="strength")||[]).filter(s=>s.status!=="completed"),ke=V?at.find(s=>s.id===V.assignment_id)??null:null,Se=V&&!ke?qe?.find(s=>s.id===V.session_id)??null:null,v=(!!ke?.items?.length||!!Se?.items?.length)&&!He,A=at.map(s=>({...s,session:{id:s.session_id,title:s.title,description:s.description,cycle:tt(s.cycle),items:s.items??[]}})),$=[{value:"endurance",label:"Endurance"},{value:"hypertrophie",label:"Hypertrophie"},{value:"force",label:"Force"}],E=u.useMemo(()=>ue?new Map(ue.map(s=>[s.id,s])):new Map,[ue]),I=A.map(s=>{const o=xt(s.items??[],P,E);return{key:`assignment-${s.id}`,title:s.title,description:s.description,type:"assignment",assignedDate:s.assigned_date,session:{id:s.session_id,title:s.title,description:s.description,cycle:tt(s.cycle),items:o},assignment:s,exerciseCount:o.length}}),z=(qe??[]).map(s=>{const o=xt(s.items??[],P,E);return{key:`catalog-${s.id}`,title:s.title,description:s.description,type:"catalog",session:{...s,items:o,cycle:P},exerciseCount:o.length}}),U=re.trim().toLowerCase(),se=[...I,...z].filter(s=>U?`${s.title} ${s.description}`.toLowerCase().includes(U):!0),Z=u.useMemo(()=>f?xt(f.items??[],P,E):[],[f,P,E]),pe=s=>{if((s.items??[]).length===0){l({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}he(s,P),H(null),T(null)},ge=s=>{const o=s.items??[],B=o.filter(a=>a.cycle_type===P).length>0?P:tt(s.cycle??o.find(a=>a.cycle_type)?.cycle_type),ne=xt(o,B,E);if(ne.length===0){l({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}k({...s,cycle:B,items:ne}),_(null),H(null),T(null),j(0),O("reader")},ve=()=>{if(f){if(Z.length===0){l({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}k({...f,cycle:P,items:Z}),j(0),O("focus")}},Ke=()=>{Xn({setActiveSession:k,setActiveAssignment:_,setActiveRunId:H,setActiveRunLogs:T,setActiveRunnerStep:j,setScreenMode:O})},Ze=u.useCallback((s,o)=>{if(!["ArrowUp","ArrowDown","Enter"].includes(s.key))return;if(s.preventDefault(),s.key==="Enter"){const ne=se[o];ne.type==="assignment"?pe(ne.assignment):ge(ne.session);return}let B=o;s.key==="ArrowUp"&&(B=Math.max(0,o-1)),s.key==="ArrowDown"&&(B=Math.min(se.length-1,o+1)),nt(B),setTimeout(()=>{const ne=document.querySelectorAll('[data-session-card="true"]');ne[B]&&ne[B].focus()},0)},[se,pe,ge]);u.useEffect(()=>{if(C!=="reader")return;const s=o=>{o.key==="Escape"&&(o.preventDefault(),O("list"))};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[C]);const ut=ot({mutationFn:s=>Me.deleteStrengthRun(s),onMutate:()=>{d("saving")},onSuccess:s=>{d("saved"),setTimeout(()=>d("idle"),2e3),Ke(),le&&p.setQueryData(["strength_run_in_progress",le],$t(null)),p.invalidateQueries({queryKey:["strength_run_in_progress",le]}),p.invalidateQueries({queryKey:["strength_history"]}),p.invalidateQueries({queryKey:["assignments",t,"strength"]});const o=s?.source==="local"?"Suppression locale : le serveur n'est pas disponible.":void 0;l({title:"Séance supprimée",description:o})},onError:()=>{d("error"),setTimeout(()=>d("idle"),3e3),l({title:"Erreur",description:"Impossible de supprimer la séance en cours.",variant:"destructive"})}});return Re||S?e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_e,{className:"h-8 w-32"}),e.jsx(_e,{className:"h-10 w-10 rounded-full"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_e,{className:"h-10 w-32"}),e.jsx(_e,{className:"h-10 w-32"})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[e.jsx(_e,{className:"h-9 w-28 rounded-full"}),e.jsx(_e,{className:"h-9 w-32 rounded-full"}),e.jsx(_e,{className:"h-9 w-24 rounded-full"})]}),e.jsx(_e,{className:"h-10 w-full rounded-lg"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((s,o)=>e.jsxs(Qe,{className:"overflow-hidden",children:[e.jsx(Ct,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(_e,{className:"h-5 w-48"}),e.jsx(_e,{className:"h-4 w-32"})]}),e.jsx(_e,{className:"h-6 w-20 rounded-full"})]})}),e.jsxs(Rt,{className:"space-y-2",children:[e.jsx(_e,{className:"h-4 w-full"}),e.jsx(_e,{className:"h-4 w-3/4"})]})]},`skeleton-${o}`))})]}):Fe?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(on,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:Fe.message}),e.jsx(F,{onClick:()=>Ve(),className:"mt-4",children:"Réessayer"})]}):e.jsx("div",{className:ye("space-y-4 md:space-y-6",je&&"dark bg-background text-foreground contrast-125",Ce&&"text-lg leading-relaxed [&_.text-xs]:text-sm [&_.text-sm]:text-base"),children:C==="focus"&&f?ue?e.jsx("div",{className:"animate-in fade-in motion-reduce:animate-none",children:e.jsx(Kn,{session:f,exercises:ue,oneRMs:Ne||[],exerciseNotes:rt,onUpdateNote:(s,o)=>R.mutate({exercise_id:s,notes:o}),initialLogs:K,initialStep:ee,isFinishing:N,onStepChange:s=>j(s),onExitFocus:()=>O("reader"),onStart:async()=>{if(w)return;const s=g?.session_id??f?.id??null;if(!s){l({title:"Session manquante",description:"Impossible de démarrer sans session associée.",variant:"destructive"});return}const o={assignment_id:g?.id??null,athlete_id:n??null,athleteName:t??void 0,progress_pct:0,session_id:s,cycle_type:f?.cycle};try{const L=await Je.mutateAsync(o);L?.run_id&&H(L.run_id)}catch{return}},onLogSets:async s=>{w&&(T(o=>[...o??[],...s]),await Promise.all(s.map((o,L)=>de.mutateAsync({run_id:w,exercise_id:o.exercise_id,set_index:o.set_number??L+1,reps:o.reps??null,weight:o.weight??null,athlete_id:n??null,athlete_name:t??null}))))},onProgress:async s=>{w&&await Le.mutateAsync({run_id:w,progress_pct:s,status:"in_progress"})},onFinish:s=>{w&&(oe(!0),Le.mutate({assignment_id:g?.id??void 0,run_id:w,session_id:g?.session_id??f?.id??void 0,athlete_id:n??void 0,date:new Date().toISOString(),progress_pct:100,status:"completed",...s}))}})}):e.jsxs("div",{className:"space-y-4 py-10",children:[e.jsx("div",{className:"mx-auto h-8 w-48 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"mx-auto h-4 w-32 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"space-y-3 pt-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-20 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},s))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Musculation"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(F,{variant:"ghost",size:"sm","aria-label":"Informations sur le calcul du 1RM",onClick:()=>{window.location.hash="#/records?tab=1rm"},className:"text-muted-foreground",children:[e.jsx(st,{className:"mr-2 h-4 w-4"})," Info 1RM"]}),e.jsx(F,{variant:"ghost",size:"icon",onClick:()=>O("settings"),className:"rounded-full border border-muted/50 text-muted-foreground","aria-label":"Paramètres",children:e.jsx(hn,{className:"h-4 w-4"})})]})]}),e.jsxs(Us,{defaultValue:"start",className:"w-full",children:[e.jsxs(Ks,{className:"grid w-full grid-cols-2",children:[e.jsx(Qt,{value:"start",children:"S'entraîner"}),e.jsx(Qt,{value:"history",children:"Historique"})]}),e.jsxs(Yt,{value:"start",className:"space-y-5 pt-4",children:[C==="list"&&fe&&e.jsxs("div",{className:"space-y-5 pt-4",children:[e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3].map(s=>e.jsx("div",{className:"h-10 w-28 rounded-full bg-muted animate-pulse"},s))}),e.jsx("div",{className:"h-12 rounded-2xl bg-muted/30 animate-pulse"}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4].map(s=>e.jsx("div",{className:"rounded-2xl border bg-card p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 shrink-0 rounded-xl bg-muted animate-pulse"}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[e.jsx("div",{className:"h-4 w-3/4 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-1/2 rounded bg-muted animate-pulse"})]}),e.jsx("div",{className:"h-10 w-10 shrink-0 rounded-full bg-muted animate-pulse"})]})},s))})]}),C==="list"&&!fe&&e.jsxs("div",{className:"space-y-5 animate-in fade-in motion-reduce:animate-none",children:[e.jsxs("p",{className:"text-center text-sm text-muted-foreground py-1",children:[se.length," séance",se.length>1?"s":""," disponible",se.length>1?"s":""]}),e.jsx("div",{className:"flex justify-center gap-2",children:$.map(s=>e.jsx("button",{type:"button",onClick:()=>h(tt(s.value)),className:ye("px-5 py-2.5 rounded-full text-sm font-semibold transition-all active:scale-95",P===s.value?"bg-primary text-primary-foreground shadow-md":"bg-muted/50 text-muted-foreground hover:bg-muted"),children:s.label},s.value))}),e.jsxs("div",{className:"relative",children:[e.jsx(ln,{className:"absolute left-4 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground pointer-events-none"}),e.jsx(Dt,{placeholder:"Rechercher une séance...",className:"h-12 rounded-2xl bg-muted/30 pl-11 pr-4 border-0 shadow-sm focus-visible:ring-2",value:re,onChange:s=>ae(s.target.value),"aria-label":"Rechercher une séance"})]}),V&&e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border-2 border-primary/30 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-primary/10 rounded-full blur-2xl -mr-8 -mt-8"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-primary"})]}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-primary",children:He?"Complétée":"En cours"})]}),e.jsx("h3",{className:"text-xl font-bold tracking-tight mb-1",children:ke?.title??"Séance en cours"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Démarrée le ",Nt(new Date(V.started_at||new Date),"dd MMMM",{locale:jt})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs font-semibold mb-1.5",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progression"}),e.jsxs("span",{className:"text-primary",children:[Math.round(V.progress_pct??0),"%"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-primary transition-all duration-500",style:{width:`${V.progress_pct??0}%`}})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{className:"flex-1 h-12 rounded-xl font-semibold",disabled:!v,onClick:()=>{const s=ke??Se;if(!s)return;const o=ke?.items??Se?.items??[],L=tt(ke?.cycle??Se?.cycle??o.find(a=>a.cycle_type)?.cycle_type),B=o.filter(a=>a.cycle_type===L),ne=Cs(B.length?B:o);_(ke??null),k({...s,title:s.title,description:s.description??null,cycle:L,items:ne}),H(V.id),T(V.logs??[]),j(_s(ne,V.logs??[],V.progress_pct)),O("focus")},children:He?"Voir le résumé":"Reprendre"}),!He&&e.jsx(F,{variant:"outline",className:"h-12 w-12 rounded-xl p-0",disabled:ut.isPending,onClick:()=>{!V||!window.confirm("Supprimer la séance en cours ?")||ut.mutate(V.id)},"aria-label":"Supprimer la séance",children:e.jsx(Et,{className:"h-5 w-5"})})]})]})]}),!V&&se.length>0&&e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(st,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Choisir une séance"})]}),se.length>0?e.jsx("div",{className:"space-y-3",children:se.map((s,o)=>{const L=Ie===o||Ie===null&&o===0;return e.jsx("button",{type:"button",tabIndex:L?0:-1,"data-session-card":"true",onKeyDown:B=>Ze(B,o),className:ye("group w-full rounded-2xl border bg-card p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:shadow-md hover:border-primary/30 focus:outline-none",L&&"ring-2 ring-primary"),onClick:()=>{if(s.type==="assignment"){pe(s.assignment);return}ge(s.session)},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:ye("flex h-12 w-12 shrink-0 items-center justify-center rounded-xl",s.type==="assignment"?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"),children:e.jsx(st,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[s.type==="assignment"&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-primary/10 px-2 py-0.5 text-[10px] font-bold uppercase text-primary",children:"Assignée"}),s.type==="assignment"&&s.assignedDate&&e.jsx("span",{className:"text-xs text-muted-foreground",children:Nt(new Date(s.assignedDate),"dd MMM",{locale:jt})})]}),e.jsx("h3",{className:"font-semibold tracking-tight truncate",children:s.title}),e.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:[s.exerciseCount," exercice",s.exerciseCount>1?"s":"",s.description?` · ${s.description}`:""]})]}),e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors group-hover:bg-primary group-hover:text-primary-foreground",children:e.jsx(Xt,{className:"h-4 w-4 ml-0.5"})})]})},s.key)})}):e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-muted",children:e.jsx(st,{className:"h-7 w-7 text-muted-foreground"})}),e.jsx("h3",{className:"font-semibold",children:"Aucune séance"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Essayez un autre mot-clé ou changez de cycle."})]})]}),C==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(F,{variant:"ghost",size:"sm",onClick:()=>O("list"),className:"gap-2",children:[e.jsx(Jt,{className:"h-4 w-4"}),"Retour"]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Préférences"}),e.jsx("h2",{className:"text-2xl font-display font-bold uppercase text-primary",children:"Paramètres"})]})]}),e.jsxs(Qe,{className:"border border-muted/60 shadow-sm",children:[e.jsxs(Ct,{children:[e.jsx(Pt,{className:"text-lg uppercase",children:"Lisibilité & contrastes"}),e.jsx(is,{children:"Ajuste l'écran pour rester lisible en bassin comme en extérieur."})]}),e.jsxs(Rt,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Mode piscine"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Contraste renforcé et lisibilité optimisée."})]}),e.jsx(Bt,{checked:je,onCheckedChange:s=>M(o=>({...o,poolMode:s}))})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Texte grand"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Police plus large pour lire pendant l'effort."})]}),e.jsx(Bt,{checked:Ce,onCheckedChange:s=>M(o=>({...o,largeText:s}))})]})]})]}),e.jsx(Qe,{className:"border border-muted/60 shadow-sm",children:e.jsxs(Rt,{className:"space-y-3 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsx(tn,{className:"h-4 w-4"}),e.jsx("span",{children:"Les préférences sont enregistrées sur cet appareil."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs font-semibold uppercase text-muted-foreground",children:[je&&e.jsx(gt,{variant:"secondary",children:"Mode piscine activé"}),Ce&&e.jsx(gt,{variant:"secondary",children:"Texte grand activé"}),!je&&!Ce&&e.jsx(gt,{variant:"outline",children:"Réglages par défaut"})]})]})})]}),C==="reader"&&f&&e.jsxs("div",{className:"space-y-5 animate-in fade-in motion-reduce:animate-none pb-40",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>O("list"),className:"flex h-10 w-10 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors hover:bg-muted active:scale-95","aria-label":"Retour",children:e.jsx(Jt,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground truncate",children:$.find(s=>s.value===P)?.label}),e.jsx("h1",{className:"text-xl font-bold tracking-tight truncate",children:f.title})]})]}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border border-primary/20 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-primary/10 rounded-full blur-3xl -mr-12 -mt-12"}),e.jsxs("div",{className:"relative space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[g&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-primary/20 px-3 py-1 text-xs font-bold uppercase text-primary",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-primary"}),"Assignée"]}),!g&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:"Catalogue"}),g?.assigned_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Prévue le ",Nt(new Date(g.assigned_date),"dd MMM",{locale:jt})]})]}),f.description&&e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:f.description}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(st,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:Z.length}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Exercices"})]})]}),e.jsx("div",{className:"h-8 w-px bg-border"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(dn,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:$.find(s=>s.value===P)?.label}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Cycle"})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-1",children:[e.jsxs("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:[Z.length," exercice",Z.length>1?"s":""]}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsxs("div",{className:"space-y-2",children:[Z.map((s,o)=>{const L=E.get(s.exercise_id),B=Number(s.percent_1rm),ne=Number.isFinite(B)&&B>0,a=ne?Ne?.find(it=>it.exercise_id===s.exercise_id)?.weight??0:0,y=ne?Math.round(a*(B/100)):0,Y=ne?y>0?`${y} kg (${B}% 1RM)`:`${B}% 1RM`:null,b=s.notes?.trim(),Te=rs(s.sets),De=rs(s.reps),We=Qn(s.rest_seconds);return e.jsxs(Lt,{children:[e.jsx(Hs,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-3 rounded-xl border bg-card px-3 py-3 text-left transition-all active:scale-[0.98] hover:border-primary/50 hover:shadow-sm",children:[e.jsx("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-primary text-xs font-bold text-primary-foreground",children:o+1}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"font-semibold text-sm truncate",children:L?.nom_exercice??s.exercise_name??"Exercice"})}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 text-xs font-medium text-muted-foreground",children:[e.jsxs("span",{className:"font-mono",children:[Te,"×",De]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("span",{className:"font-mono",children:We}),e.jsx(qt,{className:"h-4 w-4 text-muted-foreground/50"})]})]})}),e.jsxs(Ft,{side:"bottom",className:"max-h-[90vh] overflow-y-auto rounded-t-3xl pb-8",children:[e.jsx(Ht,{className:"text-left pb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-primary text-sm font-bold text-primary-foreground",children:o+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(zt,{className:"text-xl leading-tight",children:L?.nom_exercice??s.exercise_name??"Exercice"}),L?.exercise_type&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:L.exercise_type})]})]})}),e.jsxs("div",{className:"space-y-4",children:[L?.illustration_gif&&e.jsx("div",{className:"rounded-xl overflow-hidden bg-muted/20 border aspect-video flex items-center justify-center",children:e.jsx("img",{src:L.illustration_gif,alt:L.nom_exercice??"Exercice",className:"w-full h-full max-h-36 object-contain",loading:"lazy",decoding:"async"})}),L?.description&&e.jsx("div",{className:"text-sm text-muted-foreground leading-relaxed",children:L.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:Te}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Séries"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:De}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Reps"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:Y??"—"}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Charge"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:We}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Repos"})]})]}),b&&e.jsxs("div",{className:"rounded-xl bg-primary/5 border border-primary/20 p-4",children:[e.jsx("div",{className:"text-[10px] uppercase text-primary font-semibold mb-1",children:"Notes coach"}),e.jsx("div",{className:"text-sm text-foreground",children:b})]})]})]})]},`${s.exercise_id}-${o}`)}),Z.length===0&&e.jsx("div",{className:"p-6 border-2 border-dashed rounded-xl text-center text-muted-foreground",children:"Aucun exercice disponible pour cette séance."})]}),e.jsx(os,{saveState:be,children:e.jsxs(F,{className:"flex-1 h-14 rounded-xl font-bold text-base bg-primary hover:bg-primary/90 shadow-lg",onClick:ve,children:[e.jsx(Xt,{className:"h-5 w-5 mr-2"}),"Lancer la séance"]})})]})]}),e.jsxs(Yt,{value:"history",className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(lt,{htmlFor:"strength-history-status",children:"Statut"}),e.jsxs(zs,{value:X,onValueChange:J,children:[e.jsx(Bs,{id:"strength-history-status",children:e.jsx(qs,{placeholder:"Tous"})}),e.jsxs(Vs,{children:[e.jsx(wt,{value:"all",children:"Tous"}),e.jsx(wt,{value:"in_progress",children:"En cours"}),e.jsx(wt,{value:"completed",children:"Terminé"}),e.jsx(wt,{value:"abandoned",children:"Abandonné"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(lt,{htmlFor:"strength-history-from",children:"Du"}),e.jsx(Dt,{id:"strength-history-from",type:"date",value:te,onChange:s=>W(s.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(lt,{htmlFor:"strength-history-to",children:"Au"}),e.jsx(Dt,{id:"strength-history-to",type:"date",value:Q,onChange:s=>we(s.target.value)})]})]}),Ue.map(s=>e.jsx(Qe,{className:"group hover:border-primary/50 transition-colors",children:e.jsxs(Ct,{className:"pb-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Pt,{className:"text-base font-bold uppercase",children:Nt(new Date(s.started_at||s.date||s.created_at||new Date),"dd MMM yyyy",{locale:jt})}),e.jsxs("div",{className:"text-sm font-mono font-bold text-muted-foreground group-hover:text-primary",children:[s.duration??0," min"]})]}),e.jsxs("div",{className:"flex gap-2 text-xs font-bold text-muted-foreground",children:[e.jsxs("span",{children:["Difficulté ",s.feeling??s.rpe??0,"/5"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[s.logs?.length||0," Séries"]})]})]})},s.id)),Ue.length===0&&e.jsx("div",{className:"text-center text-muted-foreground py-10",children:"Aucun historique."}),Pe.hasNextPage&&e.jsx(F,{variant:"outline",size:"sm",className:"w-full",onClick:()=>Pe.fetchNextPage(),disabled:Pe.isFetchingNextPage,children:Pe.isFetchingNextPage?"Chargement...":"Charger plus"})]})]})]})})}export{$t as buildInProgressRunCache,Gn as createInProgressRun,Nr as default,Cs as orderStrengthItems,Xn as resetStrengthRunState};
