import{R as f,T as As,G as Is,H as Os,J as $s,K as Ps,r as d,O as Ls,j as e}from"./vendor-ui-DJQMR4VV.js";import{b as as,u as qe,c as it,d as Fs}from"./vendor-query-BT4y-huw.js";import{c as zt,a as ve,f as qt,D as We,B as U,C as Be,g as vt,h as Bt,l as is,i as pt,L as Je,p as Hs,X as xt,q as zs,d as ge,I as Mt,u as qs,S as je}from"./index-DsTypsnd.js";import{S as Dt}from"./switch-BbwkzCN_.js";import{T as Bs,a as Vs,b as Qt,c as Yt}from"./tabs-DB-Zj8kg.js";import{B as ot}from"./badge-DuLo4dys.js";import{S as At,a as It,b as Ot,c as $t,d as Ks}from"./sheet-CvrvqGmt.js";import{A as Us,a as Ws,b as Qs,c as Ys,d as Xs,e as Gs,f as Js,g as Zs,P as os}from"./alert-dialog-DditK9bJ.js";import{B as ls,C as Pt,I as en}from"./BottomActionBar-ClyEMBDe.js";import{c as st}from"./design-tokens-CGMys_0P.js";import{L as tn}from"./loader-circle-iLuqjbWX.js";import{C as sn}from"./circle-check-Cn4SSv1c.js";import{S as nn}from"./sticky-note-Ctema9aT.js";import{C as Xt}from"./check-B0IZ2B8u.js";import{T as rn}from"./timer-BbQBb2hv.js";import{m as Lt,s as an,l as on,f as ln}from"./animations-BTr26p-C.js";import{S as cn}from"./search-gzm_evMg.js";import{f as yt}from"./fr-CqUxEDd2.js";import{f as bt}from"./vendor-date-cQbdWov0.js";import{C as cs}from"./chevron-left-DMbcN6A-.js";import{S as dn,a as un,b as mn,c as fn,d as mt}from"./select-Bths8zwy.js";import{C as hn}from"./circle-alert-CR4nbKHD.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-Db4xOvcx.js";import"./vendor-supabase-D7B1G6YZ.js";import"./chevron-up-dfr6omrD.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pn=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],xn=zt("calendar",pn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gn=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],vn=zt("pause",gn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yn=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],bn=zt("sliders-horizontal",yn);function wn(t){if(typeof document>"u")return;let s=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",s.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}const ds=f.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),lt=()=>{const t=f.useContext(ds);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};wn(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}`);function jn(){const t=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(t)&&/Mobile/.test(t)||/FxiOS/.test(t))}function Nn(){return Vt(/^Mac/)}function Sn(){return Vt(/^iPhone/)}function Gt(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function _n(){return Vt(/^iPad/)||Nn()&&navigator.maxTouchPoints>1}function us(){return Sn()||_n()}function Vt(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const Cn=24,Rn=typeof window<"u"?d.useLayoutEffect:d.useEffect;function Jt(...t){return(...s)=>{for(let n of t)typeof n=="function"&&n(...s)}}const _t=typeof document<"u"&&window.visualViewport;function Zt(t){let s=window.getComputedStyle(t);return/(auto|scroll)/.test(s.overflow+s.overflowX+s.overflowY)}function ms(t){for(Zt(t)&&(t=t.parentElement);t&&!Zt(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const En=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let ft=0,Ct;function kn(t={}){let{isDisabled:s}=t;Rn(()=>{if(!s)return ft++,ft===1&&us()&&(Ct=Tn()),()=>{ft--,ft===0&&Ct?.()}},[s])}function Tn(){let t,s=0,n=i=>{t=ms(i.target),!(t===document.documentElement&&t===document.body)&&(s=i.changedTouches[0].pageY)},r=i=>{if(!t||t===document.documentElement||t===document.body){i.preventDefault();return}let b=i.changedTouches[0].pageY,k=t.scrollTop,O=t.scrollHeight-t.clientHeight;O!==0&&((k<=0&&b>s||k>=O&&b<s)&&i.preventDefault(),s=b)},o=i=>{let b=i.target;Ft(b)&&b!==document.activeElement&&(i.preventDefault(),b.style.transform="translateY(-2000px)",b.focus(),requestAnimationFrame(()=>{b.style.transform=""}))},l=i=>{let b=i.target;Ft(b)&&(b.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{b.style.transform="",_t&&(_t.height<window.innerHeight?requestAnimationFrame(()=>{es(b)}):_t.addEventListener("resize",()=>es(b),{once:!0}))}))},g=()=>{window.scrollTo(0,0)},h=window.pageXOffset,v=window.pageYOffset,N=Jt(Mn(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let p=Jt(nt(document,"touchstart",n,{passive:!1,capture:!0}),nt(document,"touchmove",r,{passive:!1,capture:!0}),nt(document,"touchend",o,{passive:!1,capture:!0}),nt(document,"focus",l,!0),nt(window,"scroll",g));return()=>{N(),p(),window.scrollTo(h,v)}}function Mn(t,s,n){let r=t.style[s];return t.style[s]=n,()=>{t.style[s]=r}}function nt(t,s,n,r){return t.addEventListener(s,n,r),()=>{t.removeEventListener(s,n,r)}}function es(t){let s=document.scrollingElement||document.documentElement;for(;t&&t!==s;){let n=ms(t);if(n!==document.documentElement&&n!==document.body&&n!==t){let r=n.getBoundingClientRect().top,o=t.getBoundingClientRect().top,l=t.getBoundingClientRect().bottom;const g=n.getBoundingClientRect().bottom+Cn;l>g&&(n.scrollTop+=o-r)}t=n.parentElement}}function Ft(t){return t instanceof HTMLInputElement&&!En.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function Dn(t,s){typeof t=="function"?t(s):t!=null&&(t.current=s)}function An(...t){return s=>t.forEach(n=>Dn(n,s))}function fs(...t){return d.useCallback(An(...t),t)}const hs=new WeakMap;function le(t,s,n=!1){if(!t||!(t instanceof HTMLElement))return;let r={};Object.entries(s).forEach(([o,l])=>{if(o.startsWith("--")){t.style.setProperty(o,l);return}r[o]=t.style[o],t.style[o]=l}),!n&&hs.set(t,r)}function In(t,s){if(!t||!(t instanceof HTMLElement))return;let n=hs.get(t);n&&(t.style[s]=n[s])}const oe=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function ht(t,s){if(!t)return null;const n=window.getComputedStyle(t),r=n.transform||n.webkitTransform||n.mozTransform;let o=r.match(/^matrix3d\((.+)\)$/);return o?parseFloat(o[1].split(", ")[oe(s)?13:12]):(o=r.match(/^matrix\((.+)\)$/),o?parseFloat(o[1].split(", ")[oe(s)?5:4]):null)}function On(t){return 8*(Math.log(t+1)-2)}function Rt(t,s){if(!t)return()=>{};const n=t.style.cssText;return Object.assign(t.style,s),()=>{t.style.cssText=n}}function $n(...t){return(...s)=>{for(const n of t)typeof n=="function"&&n(...s)}}const ee={DURATION:.5,EASE:[.32,.72,0,1]},ps=.4,Pn=.25,Ln=100,xs=8,Ue=16,Ht=26,Et="vaul-dragging";function gs(t){const s=f.useRef(t);return f.useEffect(()=>{s.current=t}),f.useMemo(()=>(...n)=>s.current==null?void 0:s.current.call(s,...n),[])}function Fn({defaultProp:t,onChange:s}){const n=f.useState(t),[r]=n,o=f.useRef(r),l=gs(s);return f.useEffect(()=>{o.current!==r&&(l(r),o.current=r)},[r,o,l]),n}function vs({prop:t,defaultProp:s,onChange:n=()=>{}}){const[r,o]=Fn({defaultProp:s,onChange:n}),l=t!==void 0,g=l?t:r,h=gs(n),v=f.useCallback(N=>{if(l){const i=typeof N=="function"?N(t):N;i!==t&&h(i)}else o(N)},[l,t,o,h]);return[g,v]}function Hn({activeSnapPointProp:t,setActiveSnapPointProp:s,snapPoints:n,drawerRef:r,overlayRef:o,fadeFromIndex:l,onSnapPointChange:g,direction:h="bottom",container:v,snapToSequentialPoint:N}){const[p,i]=vs({prop:t,defaultProp:n?.[0],onChange:s}),[b,k]=f.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);f.useEffect(()=>{function u(){k({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]);const O=f.useMemo(()=>p===n?.[n.length-1]||null,[n,p]),T=f.useMemo(()=>{var u;return(u=n?.findIndex(M=>M===p))!=null?u:null},[n,p]),B=n&&n.length>0&&(l||l===0)&&!Number.isNaN(l)&&n[l]===p||!n,w=f.useMemo(()=>{const u=v?{width:v.getBoundingClientRect().width,height:v.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var M;return(M=n?.map($=>{const S=typeof $=="string";let A=0;if(S&&(A=parseInt($,10)),oe(h)){const y=S?A:b?$*u.height:0;return b?h==="bottom"?u.height-y:-u.height+y:y}const L=S?A:b?$*u.width:0;return b?h==="right"?u.width-L:-u.width+L:L}))!=null?M:[]},[n,b,v]),D=f.useMemo(()=>T!==null?w?.[T]:null,[w,T]),H=f.useCallback(u=>{var M;const $=(M=w?.findIndex(S=>S===u))!=null?M:null;g($),le(r.current,{transition:`transform ${ee.DURATION}s cubic-bezier(${ee.EASE.join(",")})`,transform:oe(h)?`translate3d(0, ${u}px, 0)`:`translate3d(${u}px, 0, 0)`}),w&&$!==w.length-1&&l!==void 0&&$!==l&&$<l?le(o.current,{transition:`opacity ${ee.DURATION}s cubic-bezier(${ee.EASE.join(",")})`,opacity:"0"}):le(o.current,{transition:`opacity ${ee.DURATION}s cubic-bezier(${ee.EASE.join(",")})`,opacity:"1"}),i(n?.[Math.max($,0)])},[r.current,n,w,l,o,i]);f.useEffect(()=>{if(p||t){var u;const M=(u=n?.findIndex($=>$===t||$===p))!=null?u:-1;w&&M!==-1&&typeof w[M]=="number"&&H(w[M])}},[p,t,n,w,H]);function x({draggedDistance:u,closeDrawer:M,velocity:$,dismissible:S}){if(l===void 0)return;const A=h==="bottom"||h==="right"?(D??0)-u:(D??0)+u,L=T===l-1,y=T===0,te=u>0;if(L&&le(o.current,{transition:`opacity ${ee.DURATION}s cubic-bezier(${ee.EASE.join(",")})`}),!N&&$>2&&!te){S?M():H(w[0]);return}if(!N&&$>2&&te&&w&&n){H(w[n.length-1]);return}const V=w?.reduce((P,Y)=>typeof P!="number"||typeof Y!="number"?P:Math.abs(Y-A)<Math.abs(P-A)?Y:P),se=oe(h)?window.innerHeight:window.innerWidth;if($>ps&&Math.abs(u)<se*.4){const P=te?1:-1;if(P>0&&O&&n){H(w[n.length-1]);return}if(y&&P<0&&S&&M(),T===null)return;H(w[T+P]);return}H(V)}function K({draggedDistance:u}){if(D===null)return;const M=h==="bottom"||h==="right"?D-u:D+u;(h==="bottom"||h==="right")&&M<w[w.length-1]||(h==="top"||h==="left")&&M>w[w.length-1]||le(r.current,{transform:oe(h)?`translate3d(0, ${M}px, 0)`:`translate3d(${M}px, 0, 0)`})}function Q(u,M){if(!n||typeof T!="number"||!w||l===void 0)return null;const $=T===l-1;if(T>=l&&M)return 0;if($&&!M)return 1;if(!B&&!$)return null;const A=$?T+1:T-1,L=$?w[A]-w[A-1]:w[A+1]-w[A],y=u/Math.abs(L);return $?1-y:y}return{isLastSnapPoint:O,activeSnapPoint:p,shouldFade:B,getPercentageDragged:Q,setActiveSnapPoint:i,activeSnapPointIndex:T,onRelease:x,onDrag:K,snapPointsOffset:w}}const zn=()=>()=>{};function qn(){const{direction:t,isOpen:s,shouldScaleBackground:n,setBackgroundColorOnScale:r,noBodyStyles:o}=lt(),l=f.useRef(null),g=d.useMemo(()=>document.body.style.backgroundColor,[]);function h(){return(window.innerWidth-Ht)/window.innerWidth}f.useEffect(()=>{if(s&&n){l.current&&clearTimeout(l.current);const v=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!v)return;$n(r&&!o?Rt(document.body,{background:"black"}):zn,Rt(v,{transformOrigin:oe(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${ee.DURATION}s`,transitionTimingFunction:`cubic-bezier(${ee.EASE.join(",")})`}));const N=Rt(v,{borderRadius:`${xs}px`,overflow:"hidden",...oe(t)?{transform:`scale(${h()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${h()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{N(),l.current=window.setTimeout(()=>{g?document.body.style.background=g:document.body.style.removeProperty("background")},ee.DURATION*1e3)}}},[s,n,g])}let rt=null;function Bn({isOpen:t,modal:s,nested:n,hasBeenOpened:r,preventScrollRestoration:o,noBodyStyles:l}){const[g,h]=f.useState(()=>typeof window<"u"?window.location.href:""),v=f.useRef(0),N=f.useCallback(()=>{if(Gt()&&rt===null&&t&&!l){rt={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:i,innerHeight:b}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-v.current}px`,left:`${-i}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const k=b-window.innerHeight;k&&v.current>=b&&(document.body.style.top=`${-(v.current+k)}px`)}),300)}},[t]),p=f.useCallback(()=>{if(Gt()&&rt!==null&&!l){const i=-parseInt(document.body.style.top,10),b=-parseInt(document.body.style.left,10);Object.assign(document.body.style,rt),window.requestAnimationFrame(()=>{if(o&&g!==window.location.href){h(window.location.href);return}window.scrollTo(b,i)}),rt=null}},[g]);return f.useEffect(()=>{function i(){v.current=window.scrollY}return i(),window.addEventListener("scroll",i),()=>{window.removeEventListener("scroll",i)}},[]),f.useEffect(()=>{if(s)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||p()}},[s,p]),f.useEffect(()=>{n||!r||(t?(!window.matchMedia("(display-mode: standalone)").matches&&N(),s||window.setTimeout(()=>{p()},500)):p())},[t,r,g,s,n,N,p]),{restorePositionSetting:p}}function Vn({open:t,onOpenChange:s,children:n,onDrag:r,onRelease:o,snapPoints:l,shouldScaleBackground:g=!1,setBackgroundColorOnScale:h=!0,closeThreshold:v=Pn,scrollLockTimeout:N=Ln,dismissible:p=!0,handleOnly:i=!1,fadeFromIndex:b=l&&l.length-1,activeSnapPoint:k,setActiveSnapPoint:O,fixed:T,modal:B=!0,onClose:w,nested:D,noBodyStyles:H=!1,direction:x="bottom",defaultOpen:K=!1,disablePreventScroll:Q=!0,snapToSequentialPoint:u=!1,preventScrollRestoration:M=!1,repositionInputs:$=!0,onAnimationEnd:S,container:A,autoFocus:L=!1}){var y,te;const[V=!1,se]=vs({defaultProp:K,prop:t,onChange:j=>{s?.(j),!j&&!D&&m(),setTimeout(()=>{S?.(j)},ee.DURATION*1e3),j&&!B&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),j||(document.body.style.pointerEvents="auto")}}),[P,Y]=f.useState(!1),[c,X]=f.useState(!1),[ie,ce]=f.useState(!1),ne=f.useRef(null),Ae=f.useRef(null),de=f.useRef(null),Ve=f.useRef(null),Ee=f.useRef(null),ue=f.useRef(!1),G=f.useRef(null),_e=f.useRef(0),ke=f.useRef(!1),Le=f.useRef(!K),Ke=f.useRef(0),_=f.useRef(null),he=f.useRef(((y=_.current)==null?void 0:y.getBoundingClientRect().height)||0),Te=f.useRef(((te=_.current)==null?void 0:te.getBoundingClientRect().width)||0),ye=f.useRef(0),Ne=f.useCallback(j=>{l&&j===Me.length-1&&(Ae.current=new Date)},[]),{activeSnapPoint:Ze,activeSnapPointIndex:me,setActiveSnapPoint:Fe,onRelease:He,snapPointsOffset:Me,onDrag:Qe,shouldFade:Ye,getPercentageDragged:Xe}=Hn({snapPoints:l,activeSnapPointProp:k,setActiveSnapPointProp:O,drawerRef:_,fadeFromIndex:b,overlayRef:ne,onSnapPointChange:Ne,direction:x,container:A,snapToSequentialPoint:u});kn({isDisabled:!V||c||!B||ie||!P||!$||!Q});const{restorePositionSetting:m}=Bn({isOpen:V,modal:B,nested:D??!1,hasBeenOpened:P,preventScrollRestoration:M,noBodyStyles:H});function C(){return(window.innerWidth-Ht)/window.innerWidth}function fe(j){var z,W;!p&&!l||_.current&&!_.current.contains(j.target)||(he.current=((z=_.current)==null?void 0:z.getBoundingClientRect().height)||0,Te.current=((W=_.current)==null?void 0:W.getBoundingClientRect().width)||0,X(!0),de.current=new Date,us()&&window.addEventListener("touchend",()=>ue.current=!1,{once:!0}),j.target.setPointerCapture(j.pointerId),_e.current=oe(x)?j.pageY:j.pageX)}function pe(j,z){var W;let F=j;const q=(W=window.getSelection())==null?void 0:W.toString(),J=_.current?ht(_.current,x):null,re=new Date;if(F.tagName==="SELECT"||F.hasAttribute("data-vaul-no-drag")||F.closest("[data-vaul-no-drag]"))return!1;if(x==="right"||x==="left")return!0;if(Ae.current&&re.getTime()-Ae.current.getTime()<500)return!1;if(J!==null&&(x==="bottom"?J>0:J<0))return!0;if(q&&q.length>0)return!1;if(Ee.current&&re.getTime()-Ee.current.getTime()<N&&J===0||z)return Ee.current=re,!1;for(;F;){if(F.scrollHeight>F.clientHeight){if(F.scrollTop!==0)return Ee.current=new Date,!1;if(F.getAttribute("role")==="dialog")return!0}F=F.parentNode}return!0}function Z(j){if(_.current&&c){const z=x==="bottom"||x==="right"?1:-1,W=(_e.current-(oe(x)?j.pageY:j.pageX))*z,F=W>0,q=l&&!p&&!F;if(q&&me===0)return;const J=Math.abs(W),re=document.querySelector("[data-vaul-drawer-wrapper]"),Ce=x==="bottom"||x==="top"?he.current:Te.current;let xe=J/Ce;const Re=Xe(J,F);if(Re!==null&&(xe=Re),q&&xe>=1||!ue.current&&!pe(j.target,F))return;if(_.current.classList.add(Et),ue.current=!0,le(_.current,{transition:"none"}),le(ne.current,{transition:"none"}),l&&Qe({draggedDistance:W}),F&&!l){const Se=On(W),Ge=Math.min(Se*-1,0)*z;le(_.current,{transform:oe(x)?`translate3d(0, ${Ge}px, 0)`:`translate3d(${Ge}px, 0, 0)`});return}const De=1-xe;if((Ye||b&&me===b-1)&&(r?.(j,xe),le(ne.current,{opacity:`${De}`,transition:"none"},!0)),re&&ne.current&&g){const Se=Math.min(C()+xe*(1-C()),1),Ge=8-xe*8,et=Math.max(0,14-xe*14);le(re,{borderRadius:`${Ge}px`,transform:oe(x)?`scale(${Se}) translate3d(0, ${et}px, 0)`:`scale(${Se}) translate3d(${et}px, 0, 0)`,transition:"none"},!0)}if(!l){const Se=J*z;le(_.current,{transform:oe(x)?`translate3d(0, ${Se}px, 0)`:`translate3d(${Se}px, 0, 0)`})}}}f.useEffect(()=>{window.requestAnimationFrame(()=>{Le.current=!0})},[]),f.useEffect(()=>{var j;function z(){if(!_.current||!$)return;const W=document.activeElement;if(Ft(W)||ke.current){var F;const q=((F=window.visualViewport)==null?void 0:F.height)||0,J=window.innerHeight;let re=J-q;const Ce=_.current.getBoundingClientRect().height||0,xe=Ce>J*.8;ye.current||(ye.current=Ce);const Re=_.current.getBoundingClientRect().top;if(Math.abs(Ke.current-re)>60&&(ke.current=!ke.current),l&&l.length>0&&Me&&me){const De=Me[me]||0;re+=De}if(Ke.current=re,Ce>q||ke.current){const De=_.current.getBoundingClientRect().height;let Se=De;De>q&&(Se=q-(xe?Re:Ht)),T?_.current.style.height=`${De-Math.max(re,0)}px`:_.current.style.height=`${Math.max(Se,q-Re)}px`}else jn()||(_.current.style.height=`${ye.current}px`);l&&l.length>0&&!ke.current?_.current.style.bottom="0px":_.current.style.bottom=`${Math.max(re,0)}px`}}return(j=window.visualViewport)==null||j.addEventListener("resize",z),()=>{var W;return(W=window.visualViewport)==null?void 0:W.removeEventListener("resize",z)}},[me,l,Me]);function be(j){we(),w?.(),j||se(!1),setTimeout(()=>{l&&Fe(l[0])},ee.DURATION*1e3)}function I(){if(!_.current)return;const j=document.querySelector("[data-vaul-drawer-wrapper]"),z=ht(_.current,x);le(_.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${ee.DURATION}s cubic-bezier(${ee.EASE.join(",")})`}),le(ne.current,{transition:`opacity ${ee.DURATION}s cubic-bezier(${ee.EASE.join(",")})`,opacity:"1"}),g&&z&&z>0&&V&&le(j,{borderRadius:`${xs}px`,overflow:"hidden",...oe(x)?{transform:`scale(${C()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${C()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${ee.DURATION}s`,transitionTimingFunction:`cubic-bezier(${ee.EASE.join(",")})`},!0)}function we(){!c||!_.current||(_.current.classList.remove(Et),ue.current=!1,X(!1),Ve.current=new Date)}function ct(j){if(!c||!_.current)return;_.current.classList.remove(Et),ue.current=!1,X(!1),Ve.current=new Date;const z=ht(_.current,x);if(!j||!pe(j.target,!1)||!z||Number.isNaN(z)||de.current===null)return;const W=Ve.current.getTime()-de.current.getTime(),F=_e.current-(oe(x)?j.pageY:j.pageX),q=Math.abs(F)/W;if(q>.05&&(ce(!0),setTimeout(()=>{ce(!1)},200)),l){He({draggedDistance:F*(x==="bottom"||x==="right"?1:-1),closeDrawer:be,velocity:q,dismissible:p}),o?.(j,!0);return}if(x==="bottom"||x==="right"?F>0:F<0){I(),o?.(j,!0);return}if(q>ps){be(),o?.(j,!1);return}var J;const re=Math.min((J=_.current.getBoundingClientRect().height)!=null?J:0,window.innerHeight);var Ce;const xe=Math.min((Ce=_.current.getBoundingClientRect().width)!=null?Ce:0,window.innerWidth),Re=x==="left"||x==="right";if(Math.abs(z)>=(Re?xe:re)*v){be(),o?.(j,!1);return}o?.(j,!0),I()}f.useEffect(()=>(V&&(le(document.documentElement,{scrollBehavior:"auto"}),Ae.current=new Date),()=>{In(document.documentElement,"scrollBehavior")}),[V]);function wt(j){const z=j?(window.innerWidth-Ue)/window.innerWidth:1,W=j?-Ue:0;G.current&&window.clearTimeout(G.current),le(_.current,{transition:`transform ${ee.DURATION}s cubic-bezier(${ee.EASE.join(",")})`,transform:oe(x)?`scale(${z}) translate3d(0, ${W}px, 0)`:`scale(${z}) translate3d(${W}px, 0, 0)`}),!j&&_.current&&(G.current=setTimeout(()=>{const F=ht(_.current,x);le(_.current,{transition:"none",transform:oe(x)?`translate3d(0, ${F}px, 0)`:`translate3d(${F}px, 0, 0)`})},500))}function dt(j,z){if(z<0)return;const W=(window.innerWidth-Ue)/window.innerWidth,F=W+z*(1-W),q=-Ue+z*Ue;le(_.current,{transform:oe(x)?`scale(${F}) translate3d(0, ${q}px, 0)`:`scale(${F}) translate3d(${q}px, 0, 0)`,transition:"none"})}function ze(j,z){const W=oe(x)?window.innerHeight:window.innerWidth,F=z?(W-Ue)/W:1,q=z?-Ue:0;z&&le(_.current,{transition:`transform ${ee.DURATION}s cubic-bezier(${ee.EASE.join(",")})`,transform:oe(x)?`scale(${F}) translate3d(0, ${q}px, 0)`:`scale(${F}) translate3d(${q}px, 0, 0)`})}return f.useEffect(()=>{B||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[B]),f.createElement(Os,{defaultOpen:K,onOpenChange:j=>{!p&&!j||(j?Y(!0):be(!0),se(j))},open:V},f.createElement(ds.Provider,{value:{activeSnapPoint:Ze,snapPoints:l,setActiveSnapPoint:Fe,drawerRef:_,overlayRef:ne,onOpenChange:s,onPress:fe,onRelease:ct,onDrag:Z,dismissible:p,shouldAnimate:Le,handleOnly:i,isOpen:V,isDragging:c,shouldFade:Ye,closeDrawer:be,onNestedDrag:dt,onNestedOpenChange:wt,onNestedRelease:ze,keyboardIsOpen:ke,modal:B,snapPointsOffset:Me,activeSnapPointIndex:me,direction:x,shouldScaleBackground:g,setBackgroundColorOnScale:h,noBodyStyles:H,container:A,autoFocus:L}},n))}const ys=f.forwardRef(function({...t},s){const{overlayRef:n,snapPoints:r,onRelease:o,shouldFade:l,isOpen:g,modal:h,shouldAnimate:v}=lt(),N=fs(s,n),p=r&&r.length>0;if(!h)return null;const i=f.useCallback(b=>o(b),[o]);return f.createElement(Ls,{onMouseUp:i,ref:N,"data-vaul-overlay":"","data-vaul-snap-points":g&&p?"true":"false","data-vaul-snap-points-overlay":g&&l?"true":"false","data-vaul-animate":v?.current?"true":"false",...t})});ys.displayName="Drawer.Overlay";const bs=f.forwardRef(function({onPointerDownOutside:t,style:s,onOpenAutoFocus:n,...r},o){const{drawerRef:l,onPress:g,onRelease:h,onDrag:v,keyboardIsOpen:N,snapPointsOffset:p,activeSnapPointIndex:i,modal:b,isOpen:k,direction:O,snapPoints:T,container:B,handleOnly:w,shouldAnimate:D,autoFocus:H}=lt(),[x,K]=f.useState(!1),Q=fs(o,l),u=f.useRef(null),M=f.useRef(null),$=f.useRef(!1),S=T&&T.length>0;qn();const A=(y,te,V=0)=>{if($.current)return!0;const se=Math.abs(y.y),P=Math.abs(y.x),Y=P>se,c=["bottom","right"].includes(te)?1:-1;if(te==="left"||te==="right"){if(!(y.x*c<0)&&P>=0&&P<=V)return Y}else if(!(y.y*c<0)&&se>=0&&se<=V)return!Y;return $.current=!0,!0};f.useEffect(()=>{S&&window.requestAnimationFrame(()=>{K(!0)})},[]);function L(y){u.current=null,$.current=!1,h(y)}return f.createElement(Ps,{"data-vaul-drawer-direction":O,"data-vaul-drawer":"","data-vaul-delayed-snap-points":x?"true":"false","data-vaul-snap-points":k&&S?"true":"false","data-vaul-custom-container":B?"true":"false","data-vaul-animate":D?.current?"true":"false",...r,ref:Q,style:p&&p.length>0?{"--snap-point-height":`${p[i??0]}px`,...s}:s,onPointerDown:y=>{w||(r.onPointerDown==null||r.onPointerDown.call(r,y),u.current={x:y.pageX,y:y.pageY},g(y))},onOpenAutoFocus:y=>{n?.(y),H||y.preventDefault()},onPointerDownOutside:y=>{if(t?.(y),!b||y.defaultPrevented){y.preventDefault();return}N.current&&(N.current=!1)},onFocusOutside:y=>{if(!b){y.preventDefault();return}},onPointerMove:y=>{if(M.current=y,w||(r.onPointerMove==null||r.onPointerMove.call(r,y),!u.current))return;const te=y.pageY-u.current.y,V=y.pageX-u.current.x,se=y.pointerType==="touch"?10:2;A({x:V,y:te},O,se)?v(y):(Math.abs(V)>se||Math.abs(te)>se)&&(u.current=null)},onPointerUp:y=>{r.onPointerUp==null||r.onPointerUp.call(r,y),u.current=null,$.current=!1,h(y)},onPointerOut:y=>{r.onPointerOut==null||r.onPointerOut.call(r,y),L(M.current)},onContextMenu:y=>{r.onContextMenu==null||r.onContextMenu.call(r,y),M.current&&L(M.current)}})});bs.displayName="Drawer.Content";const Kn=250,Un=120,Wn=f.forwardRef(function({preventCycle:t=!1,children:s,...n},r){const{closeDrawer:o,isDragging:l,snapPoints:g,activeSnapPoint:h,setActiveSnapPoint:v,dismissible:N,handleOnly:p,isOpen:i,onPress:b,onDrag:k}=lt(),O=f.useRef(null),T=f.useRef(!1);function B(){if(T.current){H();return}window.setTimeout(()=>{w()},Un)}function w(){if(l||t||T.current){H();return}if(H(),!g||g.length===0){N||o();return}if(h===g[g.length-1]&&N){o();return}const K=g.findIndex(u=>u===h);if(K===-1)return;const Q=g[K+1];v(Q)}function D(){O.current=window.setTimeout(()=>{T.current=!0},Kn)}function H(){O.current&&window.clearTimeout(O.current),T.current=!1}return f.createElement("div",{onClick:B,onPointerCancel:H,onPointerDown:x=>{p&&b(x),D()},onPointerMove:x=>{p&&k(x)},ref:r,"data-vaul-drawer-visible":i?"true":"false","data-vaul-handle":"","aria-hidden":"true",...n},f.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},s))});Wn.displayName="Drawer.Handle";function Qn(t){const s=lt(),{container:n=s.container,...r}=t;return f.createElement($s,{container:n,...r})}const Pe={Root:Vn,Content:bs,Overlay:ys,Portal:Qn,Title:As,Description:Is},ws=({shouldScaleBackground:t=!0,...s})=>e.jsx(Pe.Root,{shouldScaleBackground:t,...s});ws.displayName="Drawer";const Yn=Pe.Portal,js=d.forwardRef(({className:t,...s},n)=>e.jsx(Pe.Overlay,{ref:n,className:ve("fixed inset-0 z-50 bg-black/80 motion-reduce:animate-none",t),...s}));js.displayName=Pe.Overlay.displayName;const Ns=d.forwardRef(({className:t,children:s,...n},r)=>e.jsxs(Yn,{children:[e.jsx(js,{}),e.jsxs(Pe.Content,{ref:r,className:ve("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background motion-reduce:animate-none",t),...n,children:[e.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),s]})]}));Ns.displayName="DrawerContent";const Ss=({className:t,...s})=>e.jsx("div",{className:ve("grid gap-1.5 p-4 text-center sm:text-left",t),...s});Ss.displayName="DrawerHeader";const _s=d.forwardRef(({className:t,...s},n)=>e.jsx(Pe.Title,{ref:n,className:ve("text-lg font-semibold leading-none tracking-tight",t),...s}));_s.displayName=Pe.Title.displayName;const Cs=d.forwardRef(({className:t,...s},n)=>e.jsx(Pe.Description,{ref:n,className:ve("text-sm text-muted-foreground",t),...s}));Cs.displayName=Pe.Description.displayName;const Xn=[1,2,3,4,5];function ts({value:t,onChange:s,className:n,disabled:r=!1,size:o="md",ariaLabel:l="Sélecteur d'échelle 1 à 5"}){const g=o==="sm"?"h-10 w-10 text-xs":"h-11 w-11 text-sm";return e.jsx("div",{className:ve("flex items-center gap-2",n),role:"group","aria-label":l,children:Xn.map(h=>{const v=t===h;return e.jsx("button",{type:"button",className:ve("flex items-center justify-center rounded-full border font-semibold transition",g,v?"border-primary bg-primary text-primary-foreground":"border-muted-foreground/30 bg-background text-foreground",r&&"opacity-60"),"aria-pressed":v,disabled:r,onClick:()=>{r||s?.(h)},children:h},h)})})}const Gn=()=>{try{const t=new(window.AudioContext||window.webkitAudioContext),s=t.createOscillator(),n=t.createGain();s.connect(n),n.connect(t.destination),s.frequency.value=880,n.gain.value=.3,s.start(),s.stop(t.currentTime+.25);const r=t.createOscillator(),o=t.createGain();r.connect(o),o.connect(t.destination),r.frequency.value=1100,o.gain.value=.3,r.start(t.currentTime+.35),r.stop(t.currentTime+.6),r.onended=()=>t.close()}catch{}try{navigator.vibrate?.([200,100,200])}catch{}},gt=(t,s)=>{const n=Number(t?.set_index??t?.set_number??t?.setIndex??s);return!Number.isFinite(n)||n<=0?s:n},Rs=(t=[],s,n)=>{if(!t.length)return 0;const r=Array.isArray(s)?s:[];if(r.length>0){const g=new Map;r.forEach((v,N)=>{if(!v?.exercise_id)return;const p=g.get(v.exercise_id)??[];p.push({...v,set_index:gt(v,N+1)}),g.set(v.exercise_id,p)});let h=t.length+1;for(let v=0;v<t.length;v+=1){const N=t[v];if((g.get(N.exercise_id)??[]).length<(N.sets??0)){h=v+1;break}}return h}const o=Number(n??0);if(!Number.isFinite(o)||o<=0)return 0;const l=Math.min(t.length,Math.max(0,Math.round(o/100*t.length)));return Math.min(t.length,l+1)},$e=(t,s)=>{const n=Number(t);return!Number.isFinite(n)||n<=0?"—":s?`${n}${s}`:String(n)};function Jn({session:t,exercises:s,oneRMs:n,onFinish:r,onStart:o,onLogSets:l,onProgress:g,initialLogs:h,isFinishing:v,initialStep:N,onStepChange:p,initialInputOpen:i,initialSeriesOpen:b,onExitFocus:k,exerciseNotes:O,onUpdateNote:T}){const{toast:B}=qt(),w=d.useRef(!1),[D,H]=d.useState(N??0),[x,K]=d.useState([]),[Q,u]=d.useState(0),[M,$]=d.useState(!0),S=d.useRef(Date.now()),A=d.useRef(0),[L,y]=d.useState(0),[te,V]=d.useState(!1),[se,P]=d.useState(!1),Y=d.useRef(0),[c,X]=d.useState(!0),[ie,ce]=d.useState(3),[ne,Ae]=d.useState(3),[de,Ve]=d.useState(""),[Ee,ue]=d.useState(!1),[G,_e]=d.useState(1),[ke,Le]=d.useState(b??!1),[Ke,_]=d.useState(i??!1),[he,Te]=d.useState("weight"),[ye,Ne]=d.useState(""),[Ze,me]=d.useState(!1),[Fe,He]=d.useState(!1),[Me,Qe]=d.useState(!1),[Ye,Xe]=d.useState(!1),[m,C]=d.useState(!1),[fe,pe]=d.useState("");d.useEffect(()=>{if(!M)return;const a=()=>{const E=Math.floor((Date.now()-S.current)/1e3)+A.current;u(E)};a();const R=setInterval(a,1e3),ae=()=>{document.visibilityState==="visible"&&a()};return document.addEventListener("visibilitychange",ae),()=>{clearInterval(R),document.removeEventListener("visibilitychange",ae)}},[M]),d.useEffect(()=>{if(!Fe)return;const a=R=>{R.key==="Escape"&&He(!1)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[Fe]),d.useEffect(()=>{if(!te||se)return;const a=()=>{if(Y.current<=0)return;const E=Math.max(0,Math.ceil((Y.current-Date.now())/1e3));y(E),E<=0&&(Gn(),B({title:"Temps de récupération terminé"}),V(!1),P(!1))};a();const R=setInterval(a,1e3),ae=()=>{document.visibilityState==="visible"&&a()};return document.addEventListener("visibilitychange",ae),()=>{clearInterval(R),document.removeEventListener("visibilitychange",ae)}},[te,se]);const Z=t.items||[],be=D-1,I=D>0&&D<=Z.length?Z[be]:null,we=I?s.find(a=>a.id===I.exercise_id):null,ct=D<Z.length?Z[D]:null,wt=ct?s.find(a=>a.id===ct.exercise_id):null,dt=(()=>{const a=we?.muscle_groups??we?.muscles??we?.muscleGroups??[];return Array.isArray(a)?a:[]})(),ze=I?.rest_seconds??0,j=Z.length?Math.min(100,Math.max(0,Math.round((D-1)/Z.length*100))):0,z=Number(I?.percent_1rm),W=Number.isFinite(z)&&z>0,F=W&&n.find(a=>a.exercise_id===I?.exercise_id)?.weight||0,q=W?Math.round(F*(z/100)):0,[J,re]=d.useState({}),Ce=d.useMemo(()=>{const a=new Map;return x.forEach((R,ae)=>{const E=gt(R,ae+1);R.exercise_id&&a.set(`${R.exercise_id}-${E}`,R)}),a},[x]),xe=I?`${I.exercise_id}-${G}`:null,Re=xe?Ce.get(xe):null,De=Re?.weight??J[G-1]?.weight??q,Se=Re?.reps??J[G-1]?.reps??I?.reps??"",Ge=()=>{if(typeof window>"u")return;const a=[st.status.success,st.chart[2],st.chart[3],st.destructive,st.accent],R=120;for(let ae=0;ae<R;ae+=1){const E=document.createElement("div"),Ie=Math.random()*6+6;E.style.position="fixed",E.style.top="-10px",E.style.left=`${Math.random()*100}vw`,E.style.width=`${Ie}px`,E.style.height=`${Ie*.6}px`,E.style.backgroundColor=a[ae%a.length],E.style.opacity="0.9",E.style.pointerEvents="none",E.style.zIndex="80",E.style.borderRadius="2px",document.body.appendChild(E);const Oe=(Math.random()-.5)*200,tt=1200+Math.random()*800,ut=Math.random()*360;E.animate([{transform:"translate3d(0, 0, 0) rotate(0deg)",opacity:1},{transform:`translate3d(${Oe}px, ${window.innerHeight+200}px, 0) rotate(${ut}deg)`,opacity:0}],{duration:tt,easing:"ease-out"}).onfinish=()=>E.remove()}};d.useEffect(()=>{if(w.current){h&&K(h);return}if(!h){K(E=>E.length?[]:E),re(E=>Object.keys(E).length?{}:E);return}if(K(h),!h.length){re(E=>Object.keys(E).length?{}:E),H(E=>E===0?E:0);return}const a=t.items||[];if(!a.length)return;const R=new Map;h.forEach((E,Ie)=>{if(!E.exercise_id)return;const Oe=R.get(E.exercise_id)??[];Oe.push({...E,set_index:gt(E,Ie+1)}),R.set(E.exercise_id,Oe)});const ae=Rs(a,h);if(ae>0&&ae<=a.length){const E=a[ae-1],Ie=R.get(E.exercise_id)??[],Oe=Ie.reduce((ut,St,Ms)=>{const Ds=gt(St,Ms+1);return ut[Ds-1]={reps:St.reps??void 0,weight:St.weight??void 0},ut},{});re(Oe);const tt=Math.min(E.sets??1,Ie.length+1);_e(tt)}else re({}),_e(1);H(E=>E===ae?E:ae)},[h,t.items]),d.useEffect(()=>{D<=Z.length||Ee||(Ge(),ue(!0))},[D,Z.length,Ee]);const et=a=>{H(a),p?.(a)},Kt=a=>{a<=0||(Y.current=Date.now()+a*1e3,y(a),V(!0),P(!1))},jt=async()=>{window.scrollTo({top:0,behavior:"smooth"});const a=D+1;_e(1),re({}),et(a);const R=Math.round(Math.min(a-1,Z.length)/Z.length*100);try{await g?.(R)}catch{B({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}},ks=async()=>{if(!I)return;if(Re){G>=I.sets?await jt():_e(R=>Math.min(I.sets,R+1));return}const a={exercise_id:I.exercise_id,set_number:G,reps:J[G-1]?.reps||I.reps,weight:J[G-1]?.weight||q};K(R=>[...R,a]),w.current=!0;try{await l?.([a])}catch{B({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}finally{w.current=!1}if(c&&I.rest_seconds>0&&Kt(I.rest_seconds),G>=I.sets){await jt();return}_e(R=>Math.min(I.sets,R+1))},Ut=a=>{Te(a);const R=a==="weight"?J[G-1]?.weight??q??"":J[G-1]?.reps??I?.reps??"";Ne(R?String(R):""),me(!!R),_(!0)},Ts=()=>{if(!I)return;const a=Number(he==="weight"?ye.replace(",","."):ye);Number.isFinite(a)&&(re(R=>({...R,[G-1]:{...R[G-1],[he]:a}})),_(!1))},Nt=a=>{if(Ze){me(!1),Ne(a);return}Ne(R=>a==="."&&R.includes(".")?R:R+a)},Wt=a=>{if(!I)return;Te(a);const R=a==="weight"?J[G-1]?.weight??q??"":J[G-1]?.reps??I?.reps??"";Ne(R?String(R):""),me(!!R)};return D===0?e.jsxs("div",{className:"space-y-6 text-center py-8 animate-in zoom-in duration-300",children:[e.jsx("div",{className:"h-24 w-24 bg-primary/10 rounded-full flex items-center justify-center mx-auto animate-pulse",children:e.jsx(We,{className:"h-10 w-10 text-primary ml-1"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold font-display uppercase",children:t.title}),e.jsx("p",{className:"text-muted-foreground text-lg",children:t.description}),e.jsxs("div",{className:"flex gap-2 justify-center mt-4",children:[e.jsx(ot,{variant:"outline",className:"text-sm px-3 py-1",children:t.cycle}),e.jsxs(ot,{variant:"secondary",className:"text-sm px-3 py-1",children:[Z.length," Exercices"]})]})]}),e.jsx(U,{size:"lg",className:"w-full text-xl h-14 font-bold uppercase tracking-wider shadow-lg hover:scale-[1.02] transition-transform",disabled:Me,onClick:async()=>{Qe(!0);try{await o?.(),et(1)}finally{Qe(!1)}},children:Me?e.jsxs(e.Fragment,{children:[e.jsx(tn,{className:"mr-2 h-5 w-5 animate-spin"}),"CHARGEMENT..."]}):"COMMENCER SÉANCE"})]}):D>Z.length?e.jsx("div",{className:"space-y-6 animate-in fade-in",children:e.jsxs(Be,{className:"border-t-8 border-t-primary shadow-xl",children:[e.jsxs(vt,{className:"text-center pb-2",children:[e.jsx("div",{className:"mx-auto bg-primary/10 p-4 rounded-full w-fit mb-4",children:e.jsx(sn,{className:"h-12 w-12 text-primary"})}),e.jsx(Bt,{className:"text-3xl uppercase font-display italic",children:"Séance Terminée !"}),e.jsxs(is,{className:"text-lg",children:["Durée totale: ",Math.floor(Q/60),"m ",Q%60,"s"]})]}),e.jsxs(pt,{className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Volume"}),e.jsxs("div",{className:"text-2xl font-mono font-bold",children:[x.reduce((a,R)=>a+(Number(R.weight)||0)*(Number(R.reps)||0),0)," kg"]})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Séries"}),e.jsx("div",{className:"text-2xl font-mono font-bold",children:x.length})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Je,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Difficulté de la séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Facile"}),e.jsx("span",{children:"Très dur"})]}),e.jsx(ts,{value:ie,onChange:ce})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Je,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Fatigue fin de séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Frais"}),e.jsx("span",{children:"Épuisé"})]}),e.jsx(ts,{value:ne,onChange:Ae})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Je,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Notes"}),e.jsx("textarea",{placeholder:"Sensations, douleurs...",value:de,onChange:a=>Ve(a.target.value),rows:3,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none"})]})]}),e.jsx(Hs,{children:e.jsx(U,{className:"w-full h-14 text-lg font-bold uppercase",disabled:v,onClick:()=>{v||r({duration:Math.floor(Q/60),feeling:ie,fatigue:ne,comments:de,logs:x})},children:v?"ENREGISTREMENT...":"ENREGISTRER & FERMER"})})]})}):e.jsxs("div",{className:"space-y-6 pb-32",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button","aria-label":"Voir l’animation de l’exercice",onClick:()=>{we?.illustration_gif&&He(!0)},className:"flex h-12 w-12 items-center justify-center overflow-hidden rounded-full border bg-card shadow-sm",children:we?.illustration_gif?e.jsx("img",{src:we.illustration_gif,alt:"",className:"h-full w-full object-cover",loading:"lazy",decoding:"async"}):e.jsx(We,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold",children:["Ex ",D,"/",Z.length]}),e.jsxs("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold",children:["S ",G,"/",$e(I?.sets)]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Séance"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-28 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${j}%`}})}),e.jsxs("div",{className:"text-sm font-semibold",children:[j,"%"]})]}),k?e.jsx(U,{variant:"ghost",size:"icon","aria-label":"Quitter le focus",onClick:()=>{x.length>0?Xe(!0):k()},children:e.jsx(xt,{className:"h-4 w-4"})}):null]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-2xl font-semibold tracking-tight",children:we?.nom_exercice??"Exercice"}),T&&I&&e.jsx(U,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",onClick:()=>{pe(O?.[I.exercise_id]??""),C(!0)},"aria-label":"Notes personnelles",children:e.jsx(nn,{className:ve("h-4 w-4",O?.[I?.exercise_id]?"text-primary":"text-muted-foreground")})})]}),I&&O?.[I.exercise_id]&&e.jsx("p",{className:"mt-1 text-xs italic text-muted-foreground line-clamp-2",children:O[I.exercise_id]}),dt.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:dt.map(a=>e.jsx("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:a},a))})]}),e.jsxs(Be,{className:"rounded-3xl border bg-card p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-base font-semibold",children:"Série en cours"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Dt,{checked:c,onCheckedChange:X}),"Auto repos"]})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border bg-muted/20 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"En cours"}),e.jsxs("div",{className:"mt-2 text-lg font-semibold",children:["Série ",G,"/",$e(I?.sets)," · Objectif"," ",$e(I?.reps)," reps"]}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:"Appuie sur une tuile pour saisir."})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>Ut("weight"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:De||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>Ut("reps"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:Se||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"reps"})]})]})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border bg-muted/10 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Notes"}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:I?.notes||we?.description||"Aucune note spécifique."})]}),e.jsx(U,{type:"button",variant:"outline",className:"mt-4 w-full rounded-2xl",onClick:()=>Le(!0),children:"Voir les séries"})]}),!Ke&&!te?e.jsxs(ls,{className:"bottom-0 z-modal",containerClassName:"gap-3 py-4",children:[e.jsxs(U,{className:"flex-1 min-w-0 h-12 rounded-xl text-sm font-bold shadow-lg active:scale-95 transition-transform",onClick:ks,children:[e.jsx(Xt,{className:"mr-2 h-5 w-5"})," Valider série"]}),e.jsx(U,{type:"button",variant:"outline",className:"h-12 w-12 rounded-xl p-0 active:scale-95 transition-transform",onClick:()=>{ze<=0||Kt(ze)},"aria-label":"Démarrer le repos",children:e.jsx(rn,{className:"h-5 w-5"})}),e.jsx(U,{type:"button",variant:"outline",className:"h-12 w-12 rounded-xl p-0 active:scale-95 transition-transform",onClick:()=>jt(),"aria-label":"Exercice suivant",children:e.jsx(Pt,{className:"h-5 w-5"})})]}):null,te&&e.jsxs("div",{className:"fixed inset-0 z-modal flex flex-col bg-background/95 pb-[env(safe-area-inset-bottom)]",children:[e.jsxs("div",{className:"flex items-start justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Timer"}),e.jsx("div",{className:"text-lg font-semibold",children:"Transition inter-exercice"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Prochain exercice : ",wt?.nom_exercice??"À venir"]})]}),e.jsx(U,{variant:"ghost",size:"icon",onClick:()=>{V(!1),P(!1)},"aria-label":"Fermer le timer de repos",children:e.jsx(xt,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-6 px-6 py-8",children:[e.jsxs(Be,{className:"w-full max-w-sm rounded-3xl border p-6 shadow-sm",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Temps restant"}),e.jsxs("div",{className:"mt-2 text-5xl font-semibold tracking-tight",children:[Math.floor(L/60),":",String(L%60).padStart(2,"0")]}),e.jsx("div",{className:"mt-6 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:ze?`${L/ze*100}%`:"0%"}})}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[e.jsx(U,{variant:"outline",className:"rounded-full",onClick:()=>{Y.current+=15*1e3,y(a=>a+15)},children:"+15s"}),e.jsx(U,{variant:"outline",className:"rounded-full",onClick:()=>{Y.current+=30*1e3,y(a=>a+30)},children:"+30s"}),e.jsx(U,{variant:"outline",className:"rounded-full",onClick:()=>{Y.current=Math.max(Date.now(),Y.current-15*1e3),y(a=>Math.max(0,a-15))},children:"-15s"}),e.jsxs(U,{variant:"outline",className:"ml-auto rounded-full",onClick:()=>{Y.current=Date.now()+ze*1e3,y(ze)},children:[e.jsx(zs,{className:"mr-2 h-4 w-4"}),"Reset"]})]})]}),e.jsxs("div",{className:"flex w-full max-w-sm flex-wrap gap-3",children:[e.jsxs(U,{className:"flex-1 rounded-full py-6 text-base font-semibold",onClick:()=>{se&&(Y.current=Date.now()+L*1e3),P(a=>!a)},children:[e.jsx(vn,{className:"mr-2 h-4 w-4"})," ",se?"Reprendre":"Pause"]}),e.jsxs(U,{variant:"outline",className:"rounded-full px-6 py-6 text-base font-semibold",onClick:()=>{Y.current=0,V(!1),y(0),P(!1)},children:["Passer ",e.jsx(Pt,{className:"ml-2 h-4 w-4"})]})]})]})]}),Fe&&we?.illustration_gif&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:()=>He(!1),children:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button","aria-label":"Fermer",className:"absolute -right-3 -top-3 rounded-full bg-background p-2 shadow",onClick:()=>He(!1),children:e.jsx(xt,{className:"h-4 w-4"})}),e.jsx("img",{src:we.illustration_gif,alt:"",className:"max-h-[80vh] w-auto max-w-[92vw] rounded-2xl",loading:"lazy"})]})})}),e.jsx(At,{open:ke,onOpenChange:Le,children:e.jsxs(It,{side:"bottom",className:"max-h-[80vh] overflow-y-auto",children:[e.jsx(Ot,{children:e.jsx($t,{children:"Aperçu séance"})}),e.jsx("div",{className:"mt-4 space-y-4",children:Z.map((a,R)=>{const ae=s.find(Oe=>Oe.id===a.exercise_id),E=Array.from({length:a.sets}).filter((Oe,tt)=>Ce.get(`${a.exercise_id}-${tt+1}`)).length,Ie=a.sets?Math.round(E/a.sets*100):0;return e.jsxs(Be,{className:"rounded-3xl border bg-muted/10 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:ae?.nom_exercice??a.exercise_name}),e.jsxs("div",{className:"mt-1 text-sm text-muted-foreground",children:[$e(a.sets),"x",$e(a.reps)," ·"," ",a.percent_1rm?`${$e(a.percent_1rm)} 1RM`:"—"]})]}),e.jsxs("div",{className:"rounded-full bg-muted px-3 py-1 text-sm font-semibold",children:[E,"/",$e(a.sets)]})]}),e.jsx("div",{className:"mt-4 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${Ie}%`}})})]},`${a.exercise_id}-${R}`)})})]})}),e.jsx(ws,{open:Ke,onOpenChange:_,children:e.jsx(Ns,{className:"max-h-[90vh]",children:e.jsxs("div",{className:"mx-auto w-full max-w-md px-4 pb-8",children:[e.jsxs(Ss,{className:"pb-2",children:[e.jsx(_s,{className:"text-center",children:he==="weight"?"Charge":"Répétitions"}),e.jsxs(Cs,{className:"text-center",children:["Série ",G,"/",$e(I?.sets)," · Objectif"," ",$e(I?.reps)," reps"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("button",{type:"button",className:ve("rounded-xl border-2 p-4 text-center transition-all",he==="weight"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>Wt("weight"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[he==="weight"?ye||"—":String(J[G-1]?.weight??q??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:ve("rounded-xl border-2 p-4 text-center transition-all",he==="reps"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>Wt("reps"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[he==="reps"?ye||"—":String(J[G-1]?.reps??I?.reps??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"reps"})]})]})]}),he==="weight"&&q>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[q-10,q-5,q,q+5,q+10].filter(a=>a>0).map(a=>e.jsxs(U,{variant:Number(ye)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>Ne(String(a)),children:[a," kg"]},a))})]}),he==="reps"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[6,8,10,12,15,20].map(a=>e.jsx(U,{variant:Number(ye)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>Ne(String(a)),children:a},a))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[[1,2,3,4,5,6,7,8,9].map(a=>e.jsx(U,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>Nt(String(a)),children:a},a)),e.jsx(U,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>Nt("."),children:","}),e.jsx(U,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>Nt("0"),children:"0"}),e.jsx(U,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>{me(!1),Ne(a=>a.slice(0,-1))},children:"⌫"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(U,{variant:"outline",className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:()=>{me(!1),Ne("")},children:"Effacer"}),e.jsxs(U,{className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:Ts,children:[e.jsx(Xt,{className:"mr-2 h-5 w-5"}),"Valider"]})]})]})})}),k&&e.jsx(Us,{open:Ye,onOpenChange:Xe,children:e.jsxs(Ws,{children:[e.jsxs(Qs,{children:[e.jsx(Ys,{children:"Quitter la séance ?"}),e.jsx(Xs,{children:"Les séries enregistrées seront conservées."})]}),e.jsxs(Gs,{children:[e.jsx(Js,{children:"Annuler"}),e.jsx(Zs,{onClick:()=>{Xe(!1),k()},children:"Quitter"})]})]})}),T&&e.jsx(At,{open:m,onOpenChange:a=>{if(!a&&I){const R=fe.trim()||null,ae=O?.[I.exercise_id]??null;R!==ae&&T(I.exercise_id,R)}C(a)},children:e.jsxs(It,{side:"bottom",className:"max-h-[60vh]",children:[e.jsx(Ot,{children:e.jsxs($t,{children:["Notes — ",we?.nom_exercice]})}),e.jsx("textarea",{value:fe,onChange:a=>pe(a.target.value),placeholder:"Réglages machine, repères personnels...",rows:4,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm mt-4 resize-none ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"})]})})]})}const Es=(t=[])=>{if(!t.length)return t;const s=t.map((r,o)=>{const l=Number(r.order_index);return{item:r,index:o,order:Number.isFinite(l)?l:null}});return s.some(r=>r.order!==null)?s.sort((r,o)=>r.order===null&&o.order===null?r.index-o.index:r.order===null?1:o.order===null?-1:r.order===o.order?r.index-o.index:r.order-o.order).map(r=>r.item):t},kt=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance";function Zn({user:t,userId:s,athleteName:n,athleteId:r,athleteKey:o,cycleType:l,searchQuery:g,isLoading:h,setSaveState:v,onCycleChange:N,onSearchChange:p,onStartAssignment:i,onStartCatalog:b,onResumeInProgress:k}){const{toast:O}=qt(),T=as(),[B,w]=d.useState(null),D=[{value:"endurance",label:"Endurance"},{value:"hypertrophie",label:"Hypertrophie"},{value:"force",label:"Force"}],{data:H}=qe({queryKey:["assignments",t,"strength"],queryFn:()=>ge.getAssignments(t,s,{assignmentType:"strength"}),enabled:!!t}),{data:x}=qe({queryKey:["strength_catalog"],queryFn:()=>ge.getStrengthSessions()}),{data:K}=qe({queryKey:["exercises"],queryFn:()=>ge.getExercises()}),u=qe({queryKey:["strength_run_in_progress",o],queryFn:()=>ge.getStrengthHistory(n,{limit:1,offset:0,order:"desc",status:"in_progress",athleteId:r}),enabled:!!n}).data?.runs?.[0]??null,M=u?.status==="completed"||(u?.progress_pct??0)>=100,$=it({mutationFn:c=>ge.deleteStrengthRun(c),onMutate:()=>{v("saving")},onSuccess:c=>{v("saved"),setTimeout(()=>v("idle"),2e3),T.invalidateQueries({queryKey:["strength_run_in_progress",o]}),T.invalidateQueries({queryKey:["strength_history"]}),T.invalidateQueries({queryKey:["assignments",t,"strength"]});const X=c?.source==="local"?"Suppression locale : le serveur n'est pas disponible.":void 0;O({title:"Séance supprimée",description:X})},onError:()=>{v("error"),setTimeout(()=>v("idle"),3e3),O({title:"Erreur",description:"Impossible de supprimer la séance en cours.",variant:"destructive"})}});d.useMemo(()=>K?new Map(K.map(c=>[c.id,c])):new Map,[K]);const S=d.useMemo(()=>H?.filter(c=>c.session_type==="strength")||[],[H]),A=d.useMemo(()=>S.filter(c=>c.status!=="completed"),[S]),L=d.useMemo(()=>u?A.find(c=>c.id===u.assignment_id)??null:null,[u,A]),y=d.useMemo(()=>u&&!L?x?.find(c=>c.id===u.session_id)??null:null,[u,L,x]),te=(!!L?.items?.length||!!y?.items?.length)&&!M,V=d.useMemo(()=>A.map(c=>{const X=(c.items??[]).filter(ie=>"exercise_id"in ie);return{key:`assignment-${c.id}`,title:c.title,description:c.description,type:"assignment",assignedDate:c.assigned_date,session:{id:c.session_id,title:c.title,description:c.description,cycle:kt(c.cycle),items:X},assignment:c,exerciseCount:X.length}}),[A]),se=d.useMemo(()=>(x??[]).map(c=>({key:`catalog-${c.id}`,title:c.title,description:c.description,type:"catalog",session:{...c,cycle:l},exerciseCount:c.items?.length??0})),[x,l]),P=d.useMemo(()=>{const c=g.trim().toLowerCase(),X=[...V,...se];return c?X.filter(ie=>`${ie.title} ${ie.description}`.toLowerCase().includes(c)):X},[V,se,g]),Y=d.useCallback((c,X)=>{if(!["ArrowUp","ArrowDown","Enter"].includes(c.key))return;if(c.preventDefault(),c.key==="Enter"){const ne=P[X];ne.type==="assignment"&&ne.assignment?i(ne.assignment):b(ne.session);return}let ce=X;c.key==="ArrowUp"&&(ce=Math.max(0,X-1)),c.key==="ArrowDown"&&(ce=Math.min(P.length-1,X+1)),w(ce),setTimeout(()=>{const ne=document.querySelectorAll('[data-session-card="true"]');ne[ce]&&ne[ce].focus()},0)},[P,i,b]);return h?e.jsxs("div",{className:"space-y-5 pt-4",children:[e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3].map(c=>e.jsx("div",{className:"h-10 w-28 rounded-full bg-muted animate-pulse"},c))}),e.jsx("div",{className:"h-12 rounded-2xl bg-muted/30 animate-pulse"}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4].map(c=>e.jsx("div",{className:"rounded-2xl border bg-card p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 shrink-0 rounded-xl bg-muted animate-pulse"}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[e.jsx("div",{className:"h-4 w-3/4 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-1/2 rounded bg-muted animate-pulse"})]}),e.jsx("div",{className:"h-10 w-10 shrink-0 rounded-full bg-muted animate-pulse"})]})},c))})]}):e.jsxs("div",{className:"space-y-5 animate-in fade-in motion-reduce:animate-none",children:[e.jsxs("p",{className:"text-center text-sm text-muted-foreground py-1",children:[P.length," séance",P.length>1?"s":""," ","disponible",P.length>1?"s":""]}),e.jsx("div",{className:"flex justify-center gap-2",children:D.map(c=>e.jsx("button",{type:"button",onClick:()=>N(kt(c.value)),className:ve("px-5 py-2.5 rounded-full text-sm font-semibold transition-all active:scale-95",l===c.value?"bg-primary text-primary-foreground shadow-md":"bg-muted/50 text-muted-foreground hover:bg-muted"),children:c.label},c.value))}),e.jsxs("div",{className:"relative",children:[e.jsx(cn,{className:"absolute left-4 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground pointer-events-none"}),e.jsx(Mt,{placeholder:"Rechercher une séance...",className:"h-12 rounded-2xl bg-muted/30 pl-11 pr-4 border-0 shadow-sm focus-visible:ring-2",value:g,onChange:c=>p(c.target.value),"aria-label":"Rechercher une séance"})]}),u&&e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border-2 border-primary/30 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-primary/10 rounded-full blur-2xl -mr-8 -mt-8"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-primary"})]}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-primary",children:M?"Complétée":"En cours"})]}),e.jsx("h3",{className:"text-xl font-bold tracking-tight mb-1",children:L?.title??"Séance en cours"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Démarrée le"," ",bt(new Date(u.started_at||new Date),"dd MMMM",{locale:yt})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs font-semibold mb-1.5",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progression"}),e.jsxs("span",{className:"text-primary",children:[Math.round(u.progress_pct??0),"%"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-primary transition-all duration-500",style:{width:`${u.progress_pct??0}%`}})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{variant:"default",className:"flex-1 h-12 rounded-xl font-semibold",disabled:!te,onClick:()=>{const c=L??y;if(!c)return;const ie=(L?.items??y?.items??[]).filter(de=>"exercise_id"in de),ce=kt(L?.cycle??y?.cycle??ie.find(de=>de.cycle_type)?.cycle_type),ne=ie.filter(de=>de.cycle_type===ce),Ae=Es(ne.length?ne:ie);k({assignment:L??null,session:{...c,title:c.title,description:c.description??null,cycle:ce,items:Ae},runId:u.id,logs:u.logs??[],progressPct:u.progress_pct??0})},children:M?"Voir le résumé":"Reprendre"}),!M&&e.jsx(U,{variant:"outline",className:"h-12 w-12 rounded-xl p-0",disabled:$.isPending,onClick:()=>{!u||!window.confirm("Supprimer la séance en cours ?")||$.mutate(u.id)},"aria-label":"Supprimer la séance",children:e.jsx(xt,{className:"h-5 w-5"})})]})]})]}),!u&&P.length>0&&e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(We,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Choisir une séance"})]}),P.length>0?e.jsx(Lt.div,{className:"space-y-3 motion-reduce:animate-none",variants:an,initial:"hidden",animate:"visible",children:P.map((c,X)=>{const ie=B===X||B===null&&X===0;return e.jsx(Lt.button,{type:"button",tabIndex:ie?0:-1,"data-session-card":"true",onKeyDown:ce=>Y(ce,X),variants:on,className:ve("group w-full rounded-2xl border bg-card p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:shadow-md hover:border-primary/30 focus:outline-none motion-reduce:animate-none",ie&&"ring-2 ring-primary"),onClick:()=>{if(c.type==="assignment"&&c.assignment){i(c.assignment);return}b(c.session)},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:ve("flex h-12 w-12 shrink-0 items-center justify-center rounded-xl",c.type==="assignment"?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"),children:e.jsx(We,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[c.type==="assignment"&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-primary/10 px-2 py-0.5 text-[10px] font-bold uppercase text-primary",children:"Assignée"}),c.type==="assignment"&&c.assignedDate&&e.jsx("span",{className:"text-xs text-muted-foreground",children:bt(new Date(c.assignedDate),"dd MMM",{locale:yt})})]}),e.jsx("h3",{className:"font-semibold tracking-tight truncate",children:c.title}),e.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:[c.exerciseCount," exercice",c.exerciseCount>1?"s":"",c.description?` · ${c.description}`:""]})]}),e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors group-hover:bg-primary group-hover:text-primary-foreground",children:e.jsx(os,{className:"h-4 w-4 ml-0.5"})})]})},c.key)})}):e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-muted",children:e.jsx(We,{className:"h-7 w-7 text-muted-foreground"})}),e.jsx("h3",{className:"font-semibold",children:"Aucune séance"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Essayez un autre mot-clé ou changez de cycle."})]})]})}const ss=t=>{const s=Number(t);return!Number.isFinite(s)||s<=0?"—":String(s)},er=t=>{const s=Number(t);return!Number.isFinite(s)||s<=0?"—":`${s}s`};function tr({session:t,assignment:s,cycleType:n,cycleOptions:r,exercises:o,oneRMs:l,saveState:g,onBack:h,onLaunch:v}){const N=d.useMemo(()=>new Map(o.map(i=>[i.id,i])),[o]),p=t.items??[];return e.jsxs(Lt.div,{className:"space-y-5 pb-40",variants:ln,initial:"hidden",animate:"visible",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:h,className:"flex h-10 w-10 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors hover:bg-muted active:scale-95","aria-label":"Retour",children:e.jsx(cs,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground truncate",children:r.find(i=>i.value===n)?.label}),e.jsx("h1",{className:"text-xl font-bold tracking-tight truncate",children:t.title})]})]}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border border-primary/20 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-primary/10 rounded-full blur-3xl -mr-12 -mt-12"}),e.jsxs("div",{className:"relative space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-primary/20 px-3 py-1 text-xs font-bold uppercase text-primary",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-primary"}),"Assignée"]}),!s&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:"Catalogue"}),s?.assigned_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Prévue le ",bt(new Date(s.assigned_date),"dd MMM",{locale:yt})]})]}),t.description&&e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:t.description}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(We,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:p.length}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Exercices"})]})]}),e.jsx("div",{className:"h-8 w-px bg-border"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(xn,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:r.find(i=>i.value===n)?.label}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Cycle"})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-1",children:[e.jsxs("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:[p.length," exercice",p.length>1?"s":""]}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsxs("div",{className:"space-y-2",children:[p.map((i,b)=>{const k=N.get(i.exercise_id),O=Number(i.percent_1rm),T=Number.isFinite(O)&&O>0,B=T?l?.find(u=>u.exercise_id===i.exercise_id)?.weight??0:0,w=T?Math.round(B*(O/100)):0,D=T?w>0?`${w} kg (${O}% 1RM)`:`${O}% 1RM`:null,H=i.notes?.trim(),x=ss(i.sets),K=ss(i.reps),Q=er(i.rest_seconds);return e.jsxs(At,{children:[e.jsx(Ks,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-3 rounded-xl border bg-card px-3 py-3 text-left transition-all active:scale-[0.98] hover:border-primary/50 hover:shadow-sm",children:[e.jsx("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-primary text-xs font-bold text-primary-foreground",children:b+1}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"font-semibold text-sm truncate",children:k?.nom_exercice??i.exercise_name??"Exercice"})}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 text-xs font-medium text-muted-foreground",children:[e.jsxs("span",{className:"font-mono",children:[x,"×",K]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("span",{className:"font-mono",children:Q}),e.jsx(Pt,{className:"h-4 w-4 text-muted-foreground/50"})]})]})}),e.jsxs(It,{side:"bottom",className:"max-h-[90vh] overflow-y-auto rounded-t-3xl pb-8",children:[e.jsx(Ot,{className:"text-left pb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-primary text-sm font-bold text-primary-foreground",children:b+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx($t,{className:"text-xl leading-tight",children:k?.nom_exercice??i.exercise_name??"Exercice"}),k?.exercise_type&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:k.exercise_type})]})]})}),e.jsxs("div",{className:"space-y-4",children:[k?.illustration_gif&&e.jsx("div",{className:"rounded-xl overflow-hidden bg-muted/20 border aspect-video flex items-center justify-center",children:e.jsx("img",{src:k.illustration_gif,alt:k.nom_exercice??"Exercice",className:"w-full h-full max-h-36 object-contain",loading:"lazy",decoding:"async"})}),k?.description&&e.jsx("div",{className:"text-sm text-muted-foreground leading-relaxed",children:k.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:x}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Séries"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:K}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Reps"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:D??"—"}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Charge"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:Q}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Repos"})]})]}),H&&e.jsxs("div",{className:"rounded-xl bg-primary/5 border border-primary/20 p-4",children:[e.jsx("div",{className:"text-[10px] uppercase text-primary font-semibold mb-1",children:"Notes coach"}),e.jsx("div",{className:"text-sm text-foreground",children:H})]})]})]})]},`${i.exercise_id}-${b}`)}),p.length===0&&e.jsx("div",{className:"p-6 border-2 border-dashed rounded-xl text-center text-muted-foreground",children:"Aucun exercice disponible pour cette séance."})]}),e.jsx(ls,{saveState:g,children:e.jsxs(U,{variant:"default",className:"flex-1 h-14 rounded-xl font-bold text-base shadow-lg",onClick:v,children:[e.jsx(os,{className:"h-5 w-5 mr-2"}),"Lancer la séance"]})})]})}function sr({athleteName:t,athleteId:s,athleteKey:n}){const[r,o]=d.useState("all"),[l,g]=d.useState(""),[h,v]=d.useState(""),N=Fs({queryKey:["strength_history",n,r,l,h],queryFn:({pageParam:i=0})=>ge.getStrengthHistory(t,{athleteId:s,limit:10,offset:i,order:"desc",status:r==="all"?void 0:r,from:l||void 0,to:h||void 0}),enabled:!!t,getNextPageParam:i=>{const b=i.pagination.offset+i.pagination.limit;return b<i.pagination.total?b:void 0},initialPageParam:0}),p=N.data?.pages.flatMap(i=>i.runs)??[];return e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Je,{htmlFor:"strength-history-status",children:"Statut"}),e.jsxs(dn,{value:r,onValueChange:o,children:[e.jsx(un,{id:"strength-history-status",children:e.jsx(mn,{placeholder:"Tous"})}),e.jsxs(fn,{children:[e.jsx(mt,{value:"all",children:"Tous"}),e.jsx(mt,{value:"in_progress",children:"En cours"}),e.jsx(mt,{value:"completed",children:"Terminé"}),e.jsx(mt,{value:"abandoned",children:"Abandonné"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Je,{htmlFor:"strength-history-from",children:"Du"}),e.jsx(Mt,{id:"strength-history-from",type:"date",value:l,onChange:i=>g(i.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Je,{htmlFor:"strength-history-to",children:"Au"}),e.jsx(Mt,{id:"strength-history-to",type:"date",value:h,onChange:i=>v(i.target.value)})]})]}),p.map(i=>e.jsx(Be,{className:"group hover:border-primary/50 transition-colors",children:e.jsxs(vt,{className:"pb-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Bt,{className:"text-base font-bold uppercase",children:bt(new Date(i.started_at||i.date||i.created_at||new Date),"dd MMM yyyy",{locale:yt})}),e.jsxs("div",{className:"text-sm font-mono font-bold text-muted-foreground group-hover:text-primary",children:[i.duration??0," min"]})]}),e.jsxs("div",{className:"flex gap-2 text-xs font-bold text-muted-foreground",children:[e.jsxs("span",{children:["Difficulté ",i.feeling??i.rpe??0,"/5"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[i.logs?.length||0," Séries"]})]})]})},i.id)),p.length===0&&e.jsx("div",{className:"text-center text-muted-foreground py-10",children:"Aucun historique."}),N.hasNextPage&&e.jsx(U,{variant:"outline",size:"sm",className:"w-full",onClick:()=>N.fetchNextPage(),disabled:N.isFetchingNextPage,children:N.isFetchingNextPage?"Chargement...":"Charger plus"})]})}const nr=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance";function rr({athleteKey:t}){const s="strength-preferences",n=d.useMemo(()=>`strength-focus-state-${t??"anonymous"}`,[t]),[r,o]=d.useState(null),[l,g]=d.useState(null),[h,v]=d.useState(null),[N,p]=d.useState(null),[i,b]=d.useState(0),[k,O]=d.useState("list"),[T,B]=d.useState(!1),[w,D]=d.useState("idle"),[H,x]=d.useState({poolMode:!1,largeText:!1}),[K,Q]=d.useState(""),[u,M]=d.useState("endurance");return d.useEffect(()=>{if(typeof window>"u")return;const S=window.localStorage.getItem(s);if(S)try{const A=JSON.parse(S);x(L=>({...L,...A??{}}))}catch{return}},[]),d.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(s,JSON.stringify(H))},[s,H]),d.useEffect(()=>{if(!(typeof document>"u")){if(k==="focus")return document.body.dataset.focusMode="strength",()=>{document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode};document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode}},[k]),d.useEffect(()=>{if(typeof window>"u"||r)return;const S=window.localStorage.getItem(n);if(S)try{const A=JSON.parse(S),L=A?.screenMode==="focus"?"focus":A?.screenMode==="reader"?"reader":null;if(!L||!A?.session)return;o(A.session),g(A.assignment??null),v(typeof A.runId=="number"?A.runId:null),p(Array.isArray(A.runLogs)?A.runLogs:null),b(Number.isFinite(A.runnerStep)?A.runnerStep:0),A.cycleType&&M(nr(A.cycleType)),O(L)}catch{return}},[r,n]),d.useEffect(()=>{if(typeof window>"u")return;if(!(k==="focus"||k==="reader")||!r){window.localStorage.removeItem(n);return}const A={screenMode:k,session:r,assignment:l,runId:h,runLogs:N,runnerStep:i,cycleType:u};window.localStorage.setItem(n,JSON.stringify(A))},[l,h,N,i,r,u,n,k]),{activeSession:r,setActiveSession:o,activeAssignment:l,setActiveAssignment:g,activeRunId:h,setActiveRunId:v,activeRunLogs:N,setActiveRunLogs:p,activeRunnerStep:i,setActiveRunnerStep:b,screenMode:k,setScreenMode:O,isFinishing:T,setIsFinishing:B,saveState:w,setSaveState:D,preferences:H,setPreferences:x,searchQuery:K,setSearchQuery:Q,cycleType:u,setCycleType:M,clearActiveRunState:()=>{o(null),g(null),v(null),p(null),b(0),O("list")}}}const ns=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance",at=t=>{const s=Number(t);return!Number.isFinite(s)||s<=0?null:s},ar=(t,s)=>{if(!t)return{sets:null,reps:null,percent1rm:null,restSeries:null,restExercise:null};const n={endurance:{sets:t.Nb_series_endurance,reps:t.Nb_reps_endurance,percent1rm:t.pct_1rm_endurance,restSeries:t.recup_endurance,restExercise:t.recup_exercices_endurance},hypertrophie:{sets:t.Nb_series_hypertrophie,reps:t.Nb_reps_hypertrophie,percent1rm:t.pct_1rm_hypertrophie,restSeries:t.recup_hypertrophie,restExercise:t.recup_exercices_hypertrophie},force:{sets:t.Nb_series_force,reps:t.Nb_reps_force,percent1rm:t.pct_1rm_force,restSeries:t.recup_force,restExercise:t.recup_exercices_force}}[s];return{sets:at(n.sets),reps:at(n.reps),percent1rm:at(n.percent1rm),restSeries:at(n.restSeries),restExercise:at(n.restExercise)}},ir=(t=[],s)=>{const n=t.filter(o=>o.cycle_type===s),r=n.length?n:t;return Es(r)},Tt=(t=[],s,n)=>ir(t,s).map(r=>{const o=ar(n.get(r.exercise_id),s);return{...r,sets:o.sets??0,reps:o.reps??0,rest_seconds:o.restSeries??0,percent_1rm:o.percent1rm??0}}),or=({runId:t,assignmentId:s,startedAt:n})=>({id:t,assignment_id:s??null,started_at:n,progress_pct:0,status:"in_progress",logs:[]}),rs=t=>({runs:t?[t]:[],pagination:{limit:1,offset:0,total:t?1:0},exercise_summary:[]});function Ir(){const{user:t,userId:s,role:n,selectedAthleteId:r,selectedAthleteName:o}=qs(),{toast:l}=qt(),g=as(),h=(n==="coach"||n==="admin")&&(r!==null||!!o),v=h?o:t,N=h?r:s,p=N??v,{activeSession:i,setActiveSession:b,activeAssignment:k,setActiveAssignment:O,activeRunId:T,setActiveRunId:B,activeRunLogs:w,setActiveRunLogs:D,activeRunnerStep:H,setActiveRunnerStep:x,screenMode:K,setScreenMode:Q,isFinishing:u,setIsFinishing:M,saveState:$,setSaveState:S,preferences:A,setPreferences:L,searchQuery:y,setSearchQuery:te,cycleType:V,setCycleType:se}=rr({athleteKey:p}),{poolMode:P,largeText:Y}=A,c=[{value:"endurance",label:"Endurance"},{value:"hypertrophie",label:"Hypertrophie"},{value:"force",label:"Force"}],{data:X,isLoading:ie,error:ce,refetch:ne}=qe({queryKey:["assignments",t,"strength"],queryFn:()=>ge.getAssignments(t,s,{assignmentType:"strength"}),enabled:!!t}),{data:Ae,isLoading:de,error:Ve,refetch:Ee}=qe({queryKey:["strength_catalog"],queryFn:()=>ge.getStrengthSessions()}),{data:ue,error:G,refetch:_e}=qe({queryKey:["exercises"],queryFn:()=>ge.getExercises()}),ke=ie||de,Le=ce||Ve||G,Ke=()=>{ne(),Ee(),_e()},{data:_}=qe({queryKey:["1rm",t,s],queryFn:()=>ge.get1RM({athleteName:t,athleteId:s}),enabled:!!t}),he=d.useMemo(()=>{const m={};return(_??[]).forEach(C=>{C.notes&&(m[C.exercise_id]=C.notes)}),m},[_]),Te=d.useMemo(()=>ue?new Map(ue.map(m=>[m.id,m])):new Map,[ue]),ye=d.useMemo(()=>i?Tt(i.items??[],V,Te):[],[i,V,Te]),Ne=it({mutationFn:m=>ge.startStrengthRun(m),onMutate:()=>{S("saving")},onSuccess:m=>{if(S("saved"),setTimeout(()=>S("idle"),2e3),m?.run_id&&(B(m.run_id),D(C=>C??[]),p)){const C=or({runId:m.run_id,assignmentId:k?.id??null,startedAt:new Date().toISOString()});g.setQueryData(["strength_run_in_progress",p],rs(C))}g.invalidateQueries({queryKey:["assignments",t,"strength"]}),g.invalidateQueries({queryKey:["strength_run_in_progress",p]}),g.invalidateQueries({queryKey:["strength_history"]})},onError:()=>{S("error"),setTimeout(()=>S("idle"),3e3),l({title:"Erreur",description:"Impossible de démarrer la séance.",variant:"destructive"})}}),Ze=it({mutationFn:m=>ge.logStrengthSet(m),onMutate:()=>{S("saving")},onSuccess:m=>{S("saved"),setTimeout(()=>S("idle"),2e3),m?.one_rm_updated&&(g.invalidateQueries({queryKey:["1rm",t,s]}),l({title:"Nouveau 1RM détecté",description:"Ton record vient d'être mis à jour."}))},onError:()=>{S("error"),setTimeout(()=>S("idle"),3e3),l({title:"Erreur",description:"Impossible d'enregistrer une série.",variant:"destructive"})}}),me=it({mutationFn:m=>ge.updateStrengthRun(m),onMutate:()=>{S("saving")},onSuccess:(m,C)=>{S("saved"),setTimeout(()=>S("idle"),2e3),M(!1),g.invalidateQueries({queryKey:["strength_history"]}),C?.status==="completed"&&(p&&g.setQueryData(["strength_run_in_progress",p],rs(null)),g.invalidateQueries({queryKey:["assignments",t]}),g.invalidateQueries({queryKey:["assignments",t,"strength"]}),g.invalidateQueries({queryKey:["1rm",t,s]}),O(null),B(null),b(null),D(null),Q("list"),l({title:"Séance sauvegardée",description:"Bravo pour l'effort !"}))},onError:(m,C)=>{S("error"),setTimeout(()=>S("idle"),3e3),C?.status==="completed"&&(M(!1),l({title:"Erreur",description:"Impossible d'enregistrer la séance. Réessayez.",variant:"destructive"}))}}),Fe=it({mutationFn:m=>ge.updateExerciseNote({athlete_id:s??0,exercise_id:m.exercise_id,notes:m.notes}),onMutate:()=>{S("saving")},onSuccess:()=>{S("saved"),setTimeout(()=>S("idle"),2e3),g.invalidateQueries({queryKey:["1rm",t,s]})},onError:()=>{S("error"),setTimeout(()=>S("idle"),3e3),l({title:"Erreur",description:"Impossible de sauvegarder la note.",variant:"destructive"})}}),He=(m,C)=>{const fe=m.items??[],pe=ns(C??m.cycle??fe.find(be=>be.cycle_type)?.cycle_type),Z=Tt(fe,pe,Te);O(m),b({...m,title:m.title,description:m.description,cycle:pe,items:Z}),B(null),D(null),x(0),Q("reader")},Me=m=>{if((m.items??[]).length===0){l({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}He(m,V),B(null),D(null)},Qe=m=>{const C=m.items??[],pe=C.filter(be=>be.cycle_type===V).length>0?V:ns(m.cycle??C.find(be=>be.cycle_type)?.cycle_type),Z=Tt(C,pe,Te);if(Z.length===0){l({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}b({...m,cycle:pe,items:Z}),O(null),B(null),D(null),x(0),Q("reader")},Ye=()=>{if(i){if(ye.length===0){l({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}b({...i,cycle:V,items:ye}),x(0),Q("focus")}};return d.useEffect(()=>{if(K!=="reader")return;const m=C=>{C.key==="Escape"&&(C.preventDefault(),Q("list"))};return window.addEventListener("keydown",m),()=>window.removeEventListener("keydown",m)},[K]),ie||de?e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(je,{className:"h-8 w-32"}),e.jsx(je,{className:"h-10 w-10 rounded-full"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(je,{className:"h-10 w-32"}),e.jsx(je,{className:"h-10 w-32"})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[e.jsx(je,{className:"h-9 w-28 rounded-full"}),e.jsx(je,{className:"h-9 w-32 rounded-full"}),e.jsx(je,{className:"h-9 w-24 rounded-full"})]}),e.jsx(je,{className:"h-10 w-full rounded-lg"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((m,C)=>e.jsxs(Be,{className:"overflow-hidden",children:[e.jsx(vt,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(je,{className:"h-5 w-48"}),e.jsx(je,{className:"h-4 w-32"})]}),e.jsx(je,{className:"h-6 w-20 rounded-full"})]})}),e.jsxs(pt,{className:"space-y-2",children:[e.jsx(je,{className:"h-4 w-full"}),e.jsx(je,{className:"h-4 w-3/4"})]})]},`skeleton-${C}`))})]}):Le?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(hn,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:Le.message}),e.jsx(U,{variant:"default",onClick:()=>Ke(),className:"mt-4 h-12 md:h-10",children:"Réessayer"})]}):e.jsx("div",{className:ve("space-y-4 md:space-y-6",P&&"dark bg-background text-foreground contrast-125",Y&&"text-lg leading-relaxed [&_.text-xs]:text-sm [&_.text-sm]:text-base"),children:K==="focus"&&i?ue?e.jsx("div",{className:"animate-in fade-in motion-reduce:animate-none",children:e.jsx(Jn,{session:i,exercises:ue,oneRMs:_||[],exerciseNotes:he,onUpdateNote:(m,C)=>Fe.mutate({exercise_id:m,notes:C}),initialLogs:w,initialStep:H,isFinishing:u,onStepChange:m=>x(m),onExitFocus:()=>Q("reader"),onStart:async()=>{if(T)return;const m=k?.session_id??i?.id??null;if(!m){l({title:"Session manquante",description:"Impossible de démarrer sans session associée.",variant:"destructive"});return}const C={assignment_id:k?.id??null,athlete_id:s??null,athleteName:t??void 0,progress_pct:0,session_id:m,cycle_type:i?.cycle};try{const fe=await Ne.mutateAsync(C);fe?.run_id&&B(fe.run_id)}catch{return}},onLogSets:async m=>{T&&(D(C=>[...C??[],...m]),await Promise.all(m.map((C,fe)=>Ze.mutateAsync({run_id:T,exercise_id:C.exercise_id,set_index:C.set_number??fe+1,reps:C.reps??null,weight:C.weight??null,athlete_id:s??null,athlete_name:t??null}))))},onProgress:async m=>{T&&await me.mutateAsync({run_id:T,progress_pct:m,status:"in_progress"})},onFinish:m=>{T&&(M(!0),me.mutate({assignment_id:k?.id??void 0,run_id:T,session_id:k?.session_id??i?.id??void 0,athlete_id:s??void 0,date:new Date().toISOString(),progress_pct:100,status:"completed",...m}))}})}):e.jsxs("div",{className:"space-y-4 py-10",children:[e.jsx("div",{className:"mx-auto h-8 w-48 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"mx-auto h-4 w-32 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"space-y-3 pt-4",children:[1,2,3].map(m=>e.jsx("div",{className:"h-20 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},m))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Musculation"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(U,{variant:"ghost",size:"sm","aria-label":"Informations sur le calcul du 1RM",onClick:()=>{window.location.hash="#/records?tab=1rm"},className:"text-muted-foreground",children:[e.jsx(We,{className:"mr-2 h-4 w-4"})," Info 1RM"]}),e.jsx(U,{variant:"ghost",size:"icon",onClick:()=>Q("settings"),className:"rounded-full border border-muted/50 text-muted-foreground","aria-label":"Paramètres",children:e.jsx(bn,{className:"h-4 w-4"})})]})]}),e.jsxs(Bs,{defaultValue:"start",className:"w-full",children:[e.jsxs(Vs,{className:"grid w-full grid-cols-2",children:[e.jsx(Qt,{value:"start",children:"S'entraîner"}),e.jsx(Qt,{value:"history",children:"Historique"})]}),e.jsxs(Yt,{value:"start",className:"space-y-5 pt-4",children:[K==="list"&&e.jsx(Zn,{user:t,userId:s,athleteName:v,athleteId:N,athleteKey:p,cycleType:V,searchQuery:y,isLoading:ke,setSaveState:S,onCycleChange:se,onSearchChange:te,onStartAssignment:m=>{m.session_type==="strength"&&Me(m)},onStartCatalog:Qe,onResumeInProgress:({assignment:m,session:C,runId:fe,logs:pe,progressPct:Z})=>{O(m),b(C),B(fe),D(pe),x(Rs(C?.items??[],pe,Z)),Q("focus")}}),K==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(U,{variant:"ghost",size:"sm",onClick:()=>Q("list"),className:"gap-2",children:[e.jsx(cs,{className:"h-4 w-4"}),"Retour"]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Préférences"}),e.jsx("h2",{className:"text-2xl font-display font-bold uppercase text-primary",children:"Paramètres"})]})]}),e.jsxs(Be,{className:"border border-muted/60 shadow-sm",children:[e.jsxs(vt,{children:[e.jsx(Bt,{className:"text-lg uppercase",children:"Lisibilité & contrastes"}),e.jsx(is,{children:"Ajuste l'écran pour rester lisible en bassin comme en extérieur."})]}),e.jsxs(pt,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Mode piscine"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Contraste renforcé et lisibilité optimisée."})]}),e.jsx(Dt,{checked:P,onCheckedChange:m=>L(C=>({...C,poolMode:m}))})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Texte grand"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Police plus large pour lire pendant l'effort."})]}),e.jsx(Dt,{checked:Y,onCheckedChange:m=>L(C=>({...C,largeText:m}))})]})]})]}),e.jsx(Be,{className:"border border-muted/60 shadow-sm",children:e.jsxs(pt,{className:"space-y-3 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsx(en,{className:"h-4 w-4"}),e.jsx("span",{children:"Les préférences sont enregistrées sur cet appareil."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs font-semibold uppercase text-muted-foreground",children:[P&&e.jsx(ot,{variant:"secondary",children:"Mode piscine activé"}),Y&&e.jsx(ot,{variant:"secondary",children:"Texte grand activé"}),!P&&!Y&&e.jsx(ot,{variant:"outline",children:"Réglages par défaut"})]})]})})]}),K==="reader"&&i&&ue&&e.jsx(tr,{session:i,assignment:k,cycleType:V,cycleOptions:c,exercises:ue,oneRMs:_||[],saveState:$,onBack:()=>Q("list"),onLaunch:Ye})]}),e.jsx(Yt,{value:"history",className:"space-y-4 pt-4",children:e.jsx(sr,{athleteName:v,athleteId:N,athleteKey:p})})]})]})})}export{Ir as default};
