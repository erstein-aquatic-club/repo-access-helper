const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/export-records-pdf-BHRln9-P.js","assets/index-4NxNgYqB.js","assets/vendor-query-BiSH4r2z.js","assets/vendor-react-BzrpNAyj.js","assets/vendor-supabase-6k692oZB.js","assets/index-DZKGqAkW.css"])))=>i.map(i=>d[i]);
import{_ as U,k as C,B as M,H as z,a as f}from"./index-4NxNgYqB.js";import{r as u,u as F,j as e}from"./vendor-query-BiSH4r2z.js";import{a as E}from"./api-BYPGA3pp.js";import{S as G,a as J,b as Q,c as X,d as W,C as P}from"./select-BGzZx6nq.js";import{C as Z}from"./circle-alert-CaF6prtI.js";import{C as ee}from"./chevron-down-DPxJtwCl.js";import{C as te}from"./chevron-right-BOyUCCgN.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-6k692oZB.js";import"./index-BknIKlvV.js";import"./index-B4XJ3uYX.js";import"./index-qvJS2CDq.js";import"./check-cSRTxcf-.js";const se=[{key:"25",label:"25m"},{key:"50",label:"50m"}],ae=[{key:"M",label:"G"},{key:"F",label:"F"}],ne=[{key:"ALL",label:"Tous les âges"},{key:"8",label:"≤ 8 ans"},{key:"9",label:"9 ans"},{key:"10",label:"10 ans"},{key:"11",label:"11 ans"},{key:"12",label:"12 ans"},{key:"13",label:"13 ans"},{key:"14",label:"14 ans"},{key:"15",label:"15 ans"},{key:"16",label:"16 ans"},{key:"17",label:"≥ 17 ans"}],le=[{key:"FREE",label:"Nage Libre",events:[{id:"50_FREE",label:"50 NL"},{id:"100_FREE",label:"100 NL"},{id:"200_FREE",label:"200 NL"},{id:"400_FREE",label:"400 NL"},{id:"800_FREE",label:"800 NL"},{id:"1500_FREE",label:"1500 NL"}]},{key:"BACK",label:"Dos",events:[{id:"50_BACK",label:"50 Dos"},{id:"100_BACK",label:"100 Dos"},{id:"200_BACK",label:"200 Dos"}]},{key:"BREAST",label:"Brasse",events:[{id:"50_BREAST",label:"50 Br"},{id:"100_BREAST",label:"100 Br"},{id:"200_BREAST",label:"200 Br"}]},{key:"FLY",label:"Papillon",events:[{id:"50_FLY",label:"50 Pap"},{id:"100_FLY",label:"100 Pap"},{id:"200_FLY",label:"200 Pap"}]},{key:"IM",label:"4 Nages",events:[{id:"100_IM",label:"100 4N"},{id:"200_IM",label:"200 4N"},{id:"400_IM",label:"400 4N"}]}],S=t=>{if(!t&&t!==0)return"-";const n=Math.round(t/10),r=n%100,o=Math.floor(n/100),c=o%60,i=Math.floor(o/60),d=x=>String(x).padStart(2,"0");return i>0?`${i}:${d(c)}.${d(r)}`:`${c}.${d(r)}`},re=t=>{if(!t)return"-";const n=new Date(t);return Number.isNaN(n.getTime())?t:n.toLocaleDateString("fr-FR")},ie=t=>{if(!t)return null;const n=new Date(t);return Number.isNaN(n.getTime())?null:n.toLocaleDateString("fr-FR")+" à "+n.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})},y=t=>t===8?"≤8":t===17?"≥17":String(t);function T({options:t,value:n,onChange:r}){return e.jsx("div",{className:"inline-flex rounded-lg border bg-muted p-0.5",children:t.map(o=>e.jsx("button",{type:"button",onClick:()=>r(o.key),className:f("rounded-md px-3 py-1.5 text-sm font-medium transition-colors",n===o.key?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:o.label},o.key))})}function we(){const[t,n]=u.useState("50"),[r,o]=u.useState("M"),[c,i]=u.useState("17"),[d,x]=u.useState(null),[a,m]=u.useState(null),[p,b]=u.useState(!1),_=c==="ALL"?null:Number(c),v=u.useCallback(s=>{n(s),x(null),m(null)},[]),$=u.useCallback(s=>{o(s),x(null),m(null)},[]),I=u.useCallback(s=>{i(s),x(null),m(null)},[]),{data:R}=F({queryKey:["last-import"],queryFn:()=>E.getImportLogs({limit:1})}),{data:A=[],isLoading:L,error:N,refetch:D}=F({queryKey:["club-records",t,r,c],queryFn:()=>E.getClubRecords({pool_m:Number(t),sex:r,age:_})}),k=u.useMemo(()=>d?_!==null?`${d}__${t}__${r}__${c}`:a:null,[d,_,a,t,r,c]),{data:K,isFetching:O}=F({queryKey:["club-ranking",k],queryFn:()=>{if(!k)return[];const s=k.split("__");return E.getClubRanking({event_code:s[0],pool_m:Number(s[1]),sex:s[2],age:Number(s[3])})},enabled:!!k}),j=u.useMemo(()=>{const s=new Map;for(const l of A){const g=s.get(l.event_code)??[];g.push(l),s.set(l.event_code,g)}for(const l of s.values())l.sort((g,h)=>g.age-h.age);return s},[A]),q=u.useMemo(()=>{const s=new Map;for(const[l,g]of j){let h=g[0];for(const w of g)w.time_ms<h.time_ms&&(h=w);s.set(l,h)}return s},[j]),V=u.useCallback(s=>{x(l=>(m(null),l===s?null:s))},[]),Y=u.useCallback(s=>{const l=`${s.event_code}__${t}__${r}__${s.age}`;m(g=>g===l?null:l)},[t,r]),H=u.useCallback(async()=>{b(!0);try{const s=await E.getClubRecords({}),{exportRecordsPdf:l}=await U(async()=>{const{exportRecordsPdf:g}=await import("./export-records-pdf-BHRln9-P.js").then(h=>h.e);return{exportRecordsPdf:g}},__vite__mapDeps([0,1,2,3,4,5]));await l(s)}catch{}finally{b(!1)}},[]),B=u.useMemo(()=>le.map(s=>({...s,activeEvents:s.events.filter(l=>j.has(l.id))})).filter(s=>s.activeEvents.length>0),[j]);return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"sticky top-0 z-overlay -mx-4 backdrop-blur-md bg-background/90 border-b border-primary/15",children:e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"flex items-center justify-center h-7 w-7 rounded-lg bg-primary text-primary-foreground",children:e.jsx(C,{className:"h-3.5 w-3.5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-display font-bold uppercase italic tracking-tight text-primary",children:"Records du club"}),R?.[0]?.status==="success"&&e.jsxs("p",{className:"text-[10px] text-muted-foreground -mt-0.5",children:["MAJ :"," ",ie(R[0].completed_at??R[0].started_at)??"-"]})]})]}),e.jsxs(M,{variant:"outline",size:"sm",onClick:H,disabled:p,className:"border-primary/20 text-primary hover:bg-primary/5",children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),p?"...":"PDF"]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{options:se,value:t,onChange:v}),e.jsx(T,{options:ae,value:r,onChange:$}),e.jsxs(G,{value:c,onValueChange:I,children:[e.jsx(J,{className:"h-8 flex-1 min-w-0 text-xs",children:e.jsx(Q,{})}),e.jsx(X,{children:ne.map(s=>e.jsx(W,{value:s.key,children:s.label},s.key))})]})]}),L&&e.jsx("div",{className:"space-y-2 pt-2",children:[1,2,3,4,5].map(s=>e.jsx("div",{className:"h-14 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},s))}),N&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(Z,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:N instanceof Error?N.message:"Une erreur s'est produite"}),e.jsx(M,{onClick:()=>D(),className:"mt-4",children:"Réessayer"})]}),!L&&!N&&A.length===0&&e.jsx("p",{className:"py-8 text-center text-sm text-muted-foreground",children:"Aucun record pour ces filtres."}),!L&&!N&&B.length>0&&e.jsx("div",{className:"space-y-5 pb-4",children:B.map(s=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"h-4 w-1 rounded-full bg-primary"}),e.jsx("h2",{className:"text-xs font-display font-bold uppercase tracking-wider text-muted-foreground",children:s.label}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsx("div",{className:"space-y-1.5",children:s.activeEvents.map(l=>{const g=q.get(l.id),h=j.get(l.id)??[],w=d===l.id;return e.jsx(oe,{eventLabel:l.label,bestRecord:g,ageRecords:h,isExpanded:w,isAllAges:_===null,onToggle:()=>V(l.id),onAgeRowTap:Y,expandedAgeKey:a,rankingData:K,rankingLoading:O,pool:t,sex:r},l.id)})})]},s.key))})]})}function oe({eventLabel:t,bestRecord:n,ageRecords:r,isExpanded:o,isAllAges:c,onToggle:i,onAgeRowTap:d,expandedAgeKey:x,rankingData:a,rankingLoading:m,pool:p,sex:b}){return e.jsxs("div",{className:f("rounded-xl border overflow-hidden transition-colors",o?"border-primary/25 shadow-sm":"border-border"),children:[e.jsx("button",{type:"button",onClick:i,className:"w-full text-left px-3.5 py-3 hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-sm font-semibold text-foreground",children:t}),e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"font-mono text-primary font-bold tabular-nums text-[15px] leading-none",children:S(n.time_ms)}),e.jsxs("div",{className:"flex items-center justify-end gap-1 mt-0.5",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground truncate max-w-[120px]",children:n.athlete_name}),c&&e.jsxs("span",{className:"text-[10px] text-muted-foreground/60",children:[y(n.original_age??n.age),"a"]})]})]}),o?e.jsx(P,{className:"h-4 w-4 text-muted-foreground shrink-0"}):e.jsx(ee,{className:"h-4 w-4 text-muted-foreground shrink-0"})]})]})}),o&&e.jsx("div",{className:"border-t border-border",children:c?e.jsx(ce,{records:r,bestTime:n.time_ms,onAgeRowTap:d,expandedAgeKey:x,rankingData:a,rankingLoading:m,pool:p,sex:b}):e.jsx(me,{record:n,eventLabel:t,rankingData:a,rankingLoading:m})})]})}function ce({records:t,bestTime:n,onAgeRowTap:r,expandedAgeKey:o,rankingData:c,rankingLoading:i,pool:d,sex:x}){return e.jsx("div",{className:"divide-y divide-border/50",children:t.map(a=>{const m=a.time_ms===n,p=`${a.event_code}__${d}__${x}__${a.age}`,b=o===p,_=a.original_age!=null&&a.original_age!==a.age,v=a.original_age?y(a.original_age):null;return e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>r(a),className:f("w-full text-left px-3.5 py-2 flex items-center gap-2.5 hover:bg-muted/40 transition-colors",m&&"bg-primary/[0.03]"),children:[e.jsxs("span",{className:f("text-[11px] font-semibold w-7 text-center shrink-0 tabular-nums",m?"text-primary":"text-muted-foreground"),children:[y(a.age),"a"]}),e.jsx("span",{className:f("font-mono tabular-nums text-sm shrink-0",m?"text-primary font-bold":"text-foreground font-medium"),children:S(a.time_ms)}),e.jsxs("span",{className:"text-xs text-muted-foreground flex-1 truncate",children:[a.athlete_name,_&&v&&e.jsxs("span",{className:"ml-1 opacity-70",children:["(",v,"a)"]})]}),e.jsx("span",{className:"text-[10px] text-muted-foreground shrink-0 hidden sm:inline",children:re(a.record_date)}),m&&e.jsx(C,{className:"h-3 w-3 text-rank-gold shrink-0"}),b?e.jsx(P,{className:"h-3 w-3 text-muted-foreground shrink-0"}):e.jsx(te,{className:"h-3 w-3 text-muted-foreground shrink-0"})]}),b&&e.jsx(de,{record:a,rankingData:c,rankingLoading:i})]},a.age)})})}function de({record:t,rankingData:n,rankingLoading:r}){const o=t.original_age!=null&&t.original_age!==t.age,c=u.useMemo(()=>{const i=n??[];return o?[{id:-1,athlete_name:t.athlete_name,swimmer_iuf:t.swimmer_iuf??null,sex:t.sex,pool_m:t.pool_m,event_code:t.event_code,event_label:t.event_label,age:t.original_age??t.age,actual_age:t.original_age??t.age,time_ms:t.time_ms,record_date:t.record_date},...i]:i},[n,t,o]);return e.jsxs("div",{className:"bg-muted/30 px-3.5 py-2 ml-7 border-l-2 border-primary/20",children:[e.jsxs("p",{className:"text-[10px] font-semibold uppercase tracking-wider text-muted-foreground mb-1.5",children:["Classement (",y(t.age)," ans)"]}),r?e.jsx("div",{className:"space-y-1.5",children:[1,2,3].map(i=>e.jsx("div",{className:"h-4 w-full rounded bg-muted animate-pulse motion-reduce:animate-none"},i))}):c.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aucune donnée."}):e.jsx("div",{className:"space-y-0.5",children:c.map((i,d)=>{const x=d===0&&o&&i.id===-1;return e.jsxs("div",{className:f("flex items-center gap-2 text-xs py-0.5",d===0&&"font-semibold text-primary"),children:[e.jsx("span",{className:"w-4 text-center shrink-0 text-[10px]",children:d===0?e.jsx(C,{className:"inline h-3 w-3 text-rank-gold"}):d+1}),e.jsx("span",{className:"font-mono tabular-nums w-14 shrink-0 text-[11px]",children:S(i.time_ms)}),e.jsxs("span",{className:"flex-1 truncate text-[11px]",children:[i.athlete_name,x&&e.jsx("span",{className:"ml-1 text-[9px] font-normal text-muted-foreground",children:"(record)"})]})]},i.id===-1?"record-holder":i.id)})})]})}function me({record:t,eventLabel:n,rankingData:r,rankingLoading:o}){const c=t.original_age!=null&&t.original_age!==t.age,i=t.original_age?y(t.original_age):null,d=y(t.age),x=u.useMemo(()=>{const a=r??[];return c?[{id:-1,athlete_name:t.athlete_name,swimmer_iuf:t.swimmer_iuf??null,sex:t.sex,pool_m:t.pool_m,event_code:t.event_code,event_label:t.event_label,age:t.original_age??t.age,actual_age:t.original_age??t.age,time_ms:t.time_ms,record_date:t.record_date},...a]:a},[r,t,c]);return e.jsxs("div",{className:"bg-muted/20 px-3.5 py-2.5",children:[e.jsxs("p",{className:"text-[10px] font-semibold uppercase tracking-wider text-muted-foreground mb-2",children:["Classement — ",n," (",d," ans)"]}),o?e.jsx("div",{className:"space-y-1.5",children:[1,2,3].map(a=>e.jsx("div",{className:"h-5 w-full rounded bg-muted animate-pulse motion-reduce:animate-none"},a))}):x.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aucune donnée de classement."}):e.jsx("div",{className:"space-y-0.5",children:x.map((a,m)=>{const p=m===0&&c&&a.id===-1;return e.jsxs("div",{className:f("flex items-center gap-2 text-xs py-1 rounded-md px-1",m===0&&"font-semibold text-primary",p&&"bg-primary/5"),children:[e.jsx("span",{className:"w-5 text-center shrink-0",children:m===0?e.jsx(C,{className:"inline h-3 w-3 text-rank-gold"}):m+1}),e.jsx("span",{className:"font-mono tabular-nums w-16 shrink-0",children:S(a.time_ms)}),e.jsxs("span",{className:"flex-1 truncate",children:[a.athlete_name,p&&i&&e.jsxs("span",{className:"ml-1 text-[10px] font-normal text-muted-foreground",children:["(record ",i,"a)"]})]}),e.jsxs("span",{className:"text-muted-foreground shrink-0",children:[a.actual_age??a.age,"a"]})]},a.id===-1?"record-holder":a.id)})})]})}export{we as default};
