import{R as d,T as Tn,L as Dn,G as Mn,H as An,J as In,r as m,O as On,j as e}from"./vendor-ui-C9ymspZo.js";import{b as $n,u as at,d as Pn,c as Ze}from"./vendor-query-kM2vrB_e.js";import{h as ut,k as me,i as sn,D as Xe,B as L,C as Ge,b as Dt,c as Mt,d as rn,f as At,L as et,o as Ln,X as yt,u as Fn,I as _t,g as Ne}from"./index-C8VOHyWq.js";import{S as It,a as Ot,b as $t,c as Pt,d as Hn}from"./sheet-Bgc1zAOg.js";import{S as Lt}from"./switch-DzscAl2P.js";import{S as zn,a as Bn,b as qn,c as Vn,d as ht}from"./select-C0-NW1no.js";import{T as Un,a as Wn,b as Ut,c as Wt}from"./tabs-BXN1m2HQ.js";import{B as dt}from"./badge-uhyZs1Qv.js";import{L as Kn,A as Qn,a as Yn,b as Xn,c as Gn,d as Jn,e as Zn,f as es,g as ts,P as Kt}from"./alert-dialog-C6wssu2o.js";import{S as ns}from"./sticky-note-ToWiTSbf.js";import{C as Qt}from"./check-PdRdi0Pf.js";import{T as ss}from"./timer-CfaghfUl.js";import{C as Ft,I as rs}from"./info-D7SZwamH.js";import{S as as}from"./search-DcLsUune.js";import{C as Yt}from"./chevron-left-CQu0sZJ2.js";import{f as xt}from"./fr-CqUxEDd2.js";import{f as gt}from"./vendor-date-cQbdWov0.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-DSuxWnoS.js";import"./vendor-supabase-B2MyMyC0.js";import"./chevron-up-BS7HXulj.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],os=ut("calendar",is);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],cs=ut("circle-check",ls);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],us=ut("pause",ds);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],fs=ut("rotate-ccw",ms);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],hs=ut("sliders-horizontal",ps);function xs(t){if(typeof document>"u")return;let s=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",s.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}const an=d.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),mt=()=>{const t=d.useContext(an);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};xs(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}`);function gs(){const t=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(t)&&/Mobile/.test(t)||/FxiOS/.test(t))}function vs(){return Bt(/^Mac/)}function bs(){return Bt(/^iPhone/)}function Xt(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function ys(){return Bt(/^iPad/)||vs()&&navigator.maxTouchPoints>1}function on(){return bs()||ys()}function Bt(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const ws=24,js=typeof window<"u"?m.useLayoutEffect:m.useEffect;function Gt(...t){return(...s)=>{for(let r of t)typeof r=="function"&&r(...s)}}const Ct=typeof document<"u"&&window.visualViewport;function Jt(t){let s=window.getComputedStyle(t);return/(auto|scroll)/.test(s.overflow+s.overflowX+s.overflowY)}function ln(t){for(Jt(t)&&(t=t.parentElement);t&&!Jt(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const Ns=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let vt=0,Rt;function Ss(t={}){let{isDisabled:s}=t;js(()=>{if(!s)return vt++,vt===1&&on()&&(Rt=_s()),()=>{vt--,vt===0&&Rt?.()}},[s])}function _s(){let t,s=0,r=_=>{t=ln(_.target),!(t===document.documentElement&&t===document.body)&&(s=_.changedTouches[0].pageY)},o=_=>{if(!t||t===document.documentElement||t===document.body){_.preventDefault();return}let b=_.changedTouches[0].pageY,H=t.scrollTop,q=t.scrollHeight-t.clientHeight;q!==0&&((H<=0&&b>s||H>=q&&b<s)&&_.preventDefault(),s=b)},c=_=>{let b=_.target;Ht(b)&&b!==document.activeElement&&(_.preventDefault(),b.style.transform="translateY(-2000px)",b.focus(),requestAnimationFrame(()=>{b.style.transform=""}))},l=_=>{let b=_.target;Ht(b)&&(b.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{b.style.transform="",Ct&&(Ct.height<window.innerHeight?requestAnimationFrame(()=>{Zt(b)}):Ct.addEventListener("resize",()=>Zt(b),{once:!0}))}))},h=()=>{window.scrollTo(0,0)},x=window.pageXOffset,u=window.pageYOffset,T=Gt(Cs(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let g=Gt(it(document,"touchstart",r,{passive:!1,capture:!0}),it(document,"touchmove",o,{passive:!1,capture:!0}),it(document,"touchend",c,{passive:!1,capture:!0}),it(document,"focus",l,!0),it(window,"scroll",h));return()=>{T(),g(),window.scrollTo(x,u)}}function Cs(t,s,r){let o=t.style[s];return t.style[s]=r,()=>{t.style[s]=o}}function it(t,s,r,o){return t.addEventListener(s,r,o),()=>{t.removeEventListener(s,r,o)}}function Zt(t){let s=document.scrollingElement||document.documentElement;for(;t&&t!==s;){let r=ln(t);if(r!==document.documentElement&&r!==document.body&&r!==t){let o=r.getBoundingClientRect().top,c=t.getBoundingClientRect().top,l=t.getBoundingClientRect().bottom;const h=r.getBoundingClientRect().bottom+ws;l>h&&(r.scrollTop+=c-o)}t=r.parentElement}}function Ht(t){return t instanceof HTMLInputElement&&!Ns.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function Rs(t,s){typeof t=="function"?t(s):t!=null&&(t.current=s)}function Es(...t){return s=>t.forEach(r=>Rs(r,s))}function cn(...t){return m.useCallback(Es(...t),t)}const dn=new WeakMap;function se(t,s,r=!1){if(!t||!(t instanceof HTMLElement))return;let o={};Object.entries(s).forEach(([c,l])=>{if(c.startsWith("--")){t.style.setProperty(c,l);return}o[c]=t.style[c],t.style[c]=l}),!r&&dn.set(t,o)}function ks(t,s){if(!t||!(t instanceof HTMLElement))return;let r=dn.get(t);r&&(t.style[s]=r[s])}const te=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function bt(t,s){if(!t)return null;const r=window.getComputedStyle(t),o=r.transform||r.webkitTransform||r.mozTransform;let c=o.match(/^matrix3d\((.+)\)$/);return c?parseFloat(c[1].split(", ")[te(s)?13:12]):(c=o.match(/^matrix\((.+)\)$/),c?parseFloat(c[1].split(", ")[te(s)?5:4]):null)}function Ts(t){return 8*(Math.log(t+1)-2)}function Et(t,s){if(!t)return()=>{};const r=t.style.cssText;return Object.assign(t.style,s),()=>{t.style.cssText=r}}function Ds(...t){return(...s)=>{for(const r of t)typeof r=="function"&&r(...s)}}const X={DURATION:.5,EASE:[.32,.72,0,1]},un=.4,Ms=.25,As=100,mn=8,Qe=16,zt=26,kt="vaul-dragging";function fn(t){const s=d.useRef(t);return d.useEffect(()=>{s.current=t}),d.useMemo(()=>(...r)=>s.current==null?void 0:s.current.call(s,...r),[])}function Is({defaultProp:t,onChange:s}){const r=d.useState(t),[o]=r,c=d.useRef(o),l=fn(s);return d.useEffect(()=>{c.current!==o&&(l(o),c.current=o)},[o,c,l]),r}function pn({prop:t,defaultProp:s,onChange:r=()=>{}}){const[o,c]=Is({defaultProp:s,onChange:r}),l=t!==void 0,h=l?t:o,x=fn(r),u=d.useCallback(T=>{if(l){const _=typeof T=="function"?T(t):T;_!==t&&x(_)}else c(T)},[l,t,c,x]);return[h,u]}function Os({activeSnapPointProp:t,setActiveSnapPointProp:s,snapPoints:r,drawerRef:o,overlayRef:c,fadeFromIndex:l,onSnapPointChange:h,direction:x="bottom",container:u,snapToSequentialPoint:T}){const[g,_]=pn({prop:t,defaultProp:r?.[0],onChange:s}),[b,H]=d.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);d.useEffect(()=>{function N(){H({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",N),()=>window.removeEventListener("resize",N)},[]);const q=d.useMemo(()=>g===r?.[r.length-1]||null,[r,g]),D=d.useMemo(()=>{var N;return(N=r?.findIndex(A=>A===g))!=null?N:null},[r,g]),G=r&&r.length>0&&(l||l===0)&&!Number.isNaN(l)&&r[l]===g||!r,y=d.useMemo(()=>{const N=u?{width:u.getBoundingClientRect().width,height:u.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var A;return(A=r?.map(I=>{const P=typeof I=="string";let Z=0;if(P&&(Z=parseInt(I,10)),te(x)){const p=P?Z:b?I*N.height:0;return b?x==="bottom"?N.height-p:-N.height+p:p}const z=P?Z:b?I*N.width:0;return b?x==="right"?N.width-z:-N.width+z:z}))!=null?A:[]},[r,b,u]),E=d.useMemo(()=>D!==null?y?.[D]:null,[y,D]),$=d.useCallback(N=>{var A;const I=(A=y?.findIndex(P=>P===N))!=null?A:null;h(I),se(o.current,{transition:`transform ${X.DURATION}s cubic-bezier(${X.EASE.join(",")})`,transform:te(x)?`translate3d(0, ${N}px, 0)`:`translate3d(${N}px, 0, 0)`}),y&&I!==y.length-1&&l!==void 0&&I!==l&&I<l?se(c.current,{transition:`opacity ${X.DURATION}s cubic-bezier(${X.EASE.join(",")})`,opacity:"0"}):se(c.current,{transition:`opacity ${X.DURATION}s cubic-bezier(${X.EASE.join(",")})`,opacity:"1"}),_(r?.[Math.max(I,0)])},[o.current,r,y,l,c,_]);d.useEffect(()=>{if(g||t){var N;const A=(N=r?.findIndex(I=>I===t||I===g))!=null?N:-1;y&&A!==-1&&typeof y[A]=="number"&&$(y[A])}},[g,t,r,y,$]);function w({draggedDistance:N,closeDrawer:A,velocity:I,dismissible:P}){if(l===void 0)return;const Z=x==="bottom"||x==="right"?(E??0)-N:(E??0)+N,z=D===l-1,p=D===0,V=N>0;if(z&&se(c.current,{transition:`opacity ${X.DURATION}s cubic-bezier(${X.EASE.join(",")})`}),!T&&I>2&&!V){P?A():$(y[0]);return}if(!T&&I>2&&V&&y&&r){$(y[r.length-1]);return}const W=y?.reduce((B,K)=>typeof B!="number"||typeof K!="number"?B:Math.abs(K-Z)<Math.abs(B-Z)?K:B),J=te(x)?window.innerHeight:window.innerWidth;if(I>un&&Math.abs(N)<J*.4){const B=V?1:-1;if(B>0&&q&&r){$(y[r.length-1]);return}if(p&&B<0&&P&&A(),D===null)return;$(y[D+B]);return}$(W)}function ne({draggedDistance:N}){if(E===null)return;const A=x==="bottom"||x==="right"?E-N:E+N;(x==="bottom"||x==="right")&&A<y[y.length-1]||(x==="top"||x==="left")&&A>y[y.length-1]||se(o.current,{transform:te(x)?`translate3d(0, ${A}px, 0)`:`translate3d(${A}px, 0, 0)`})}function le(N,A){if(!r||typeof D!="number"||!y||l===void 0)return null;const I=D===l-1;if(D>=l&&A)return 0;if(I&&!A)return 1;if(!G&&!I)return null;const Z=I?D+1:D-1,z=I?y[Z]-y[Z-1]:y[Z+1]-y[Z],p=N/Math.abs(z);return I?1-p:p}return{isLastSnapPoint:q,activeSnapPoint:g,shouldFade:G,getPercentageDragged:le,setActiveSnapPoint:_,activeSnapPointIndex:D,onRelease:w,onDrag:ne,snapPointsOffset:y}}const $s=()=>()=>{};function Ps(){const{direction:t,isOpen:s,shouldScaleBackground:r,setBackgroundColorOnScale:o,noBodyStyles:c}=mt(),l=d.useRef(null),h=m.useMemo(()=>document.body.style.backgroundColor,[]);function x(){return(window.innerWidth-zt)/window.innerWidth}d.useEffect(()=>{if(s&&r){l.current&&clearTimeout(l.current);const u=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!u)return;Ds(o&&!c?Et(document.body,{background:"black"}):$s,Et(u,{transformOrigin:te(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${X.DURATION}s`,transitionTimingFunction:`cubic-bezier(${X.EASE.join(",")})`}));const T=Et(u,{borderRadius:`${mn}px`,overflow:"hidden",...te(t)?{transform:`scale(${x()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${x()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{T(),l.current=window.setTimeout(()=>{h?document.body.style.background=h:document.body.style.removeProperty("background")},X.DURATION*1e3)}}},[s,r,h])}let ot=null;function Ls({isOpen:t,modal:s,nested:r,hasBeenOpened:o,preventScrollRestoration:c,noBodyStyles:l}){const[h,x]=d.useState(()=>typeof window<"u"?window.location.href:""),u=d.useRef(0),T=d.useCallback(()=>{if(Xt()&&ot===null&&t&&!l){ot={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:_,innerHeight:b}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-u.current}px`,left:`${-_}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const H=b-window.innerHeight;H&&u.current>=b&&(document.body.style.top=`${-(u.current+H)}px`)}),300)}},[t]),g=d.useCallback(()=>{if(Xt()&&ot!==null&&!l){const _=-parseInt(document.body.style.top,10),b=-parseInt(document.body.style.left,10);Object.assign(document.body.style,ot),window.requestAnimationFrame(()=>{if(c&&h!==window.location.href){x(window.location.href);return}window.scrollTo(b,_)}),ot=null}},[h]);return d.useEffect(()=>{function _(){u.current=window.scrollY}return _(),window.addEventListener("scroll",_),()=>{window.removeEventListener("scroll",_)}},[]),d.useEffect(()=>{if(s)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||g()}},[s,g]),d.useEffect(()=>{r||!o||(t?(!window.matchMedia("(display-mode: standalone)").matches&&T(),s||window.setTimeout(()=>{g()},500)):g())},[t,o,h,s,r,T,g]),{restorePositionSetting:g}}function Fs({open:t,onOpenChange:s,children:r,onDrag:o,onRelease:c,snapPoints:l,shouldScaleBackground:h=!1,setBackgroundColorOnScale:x=!0,closeThreshold:u=Ms,scrollLockTimeout:T=As,dismissible:g=!0,handleOnly:_=!1,fadeFromIndex:b=l&&l.length-1,activeSnapPoint:H,setActiveSnapPoint:q,fixed:D,modal:G=!0,onClose:y,nested:E,noBodyStyles:$=!1,direction:w="bottom",defaultOpen:ne=!1,disablePreventScroll:le=!0,snapToSequentialPoint:N=!1,preventScrollRestoration:A=!1,repositionInputs:I=!0,onAnimationEnd:P,container:Z,autoFocus:z=!1}){var p,V;const[W=!1,J]=pn({defaultProp:ne,prop:t,onChange:v=>{s?.(v),!v&&!E&&nt(),setTimeout(()=>{P?.(v)},X.DURATION*1e3),v&&!G&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),v||(document.body.style.pointerEvents="auto")}}),[B,K]=d.useState(!1),[ae,Se]=d.useState(!1),[ie,Ee]=d.useState(!1),fe=d.useRef(null),_e=d.useRef(null),He=d.useRef(null),Ue=d.useRef(null),Ce=d.useRef(null),De=d.useRef(!1),F=d.useRef(null),be=d.useRef(0),pe=d.useRef(!1),We=d.useRef(!ne),Re=d.useRef(0),S=d.useRef(null),he=d.useRef(((p=S.current)==null?void 0:p.getBoundingClientRect().height)||0),Q=d.useRef(((V=S.current)==null?void 0:V.getBoundingClientRect().width)||0),ce=d.useRef(0),ye=d.useCallback(v=>{l&&v===Me.length-1&&(_e.current=new Date)},[]),{activeSnapPoint:tt,activeSnapPointIndex:de,setActiveSnapPoint:ze,onRelease:Be,snapPointsOffset:Me,onDrag:Ke,shouldFade:we,getPercentageDragged:ke}=Os({snapPoints:l,activeSnapPointProp:H,setActiveSnapPointProp:q,drawerRef:S,fadeFromIndex:b,overlayRef:fe,onSnapPointChange:ye,direction:w,container:Z,snapToSequentialPoint:N});Ss({isDisabled:!W||ae||!G||ie||!B||!I||!le});const{restorePositionSetting:nt}=Ls({isOpen:W,modal:G,nested:E??!1,hasBeenOpened:B,preventScrollRestoration:A,noBodyStyles:$});function Ae(){return(window.innerWidth-zt)/window.innerWidth}function qe(v){var M,n;!g&&!l||S.current&&!S.current.contains(v.target)||(he.current=((M=S.current)==null?void 0:M.getBoundingClientRect().height)||0,Q.current=((n=S.current)==null?void 0:n.getBoundingClientRect().width)||0,Se(!0),He.current=new Date,on()&&window.addEventListener("touchend",()=>De.current=!1,{once:!0}),v.target.setPointerCapture(v.pointerId),be.current=te(w)?v.pageY:v.pageX)}function xe(v,M){var n;let i=v;const f=(n=window.getSelection())==null?void 0:n.toString(),k=S.current?bt(S.current,w):null,O=new Date;if(i.tagName==="SELECT"||i.hasAttribute("data-vaul-no-drag")||i.closest("[data-vaul-no-drag]"))return!1;if(w==="right"||w==="left")return!0;if(_e.current&&O.getTime()-_e.current.getTime()<500)return!1;if(k!==null&&(w==="bottom"?k>0:k<0))return!0;if(f&&f.length>0)return!1;if(Ce.current&&O.getTime()-Ce.current.getTime()<T&&k===0||M)return Ce.current=O,!1;for(;i;){if(i.scrollHeight>i.clientHeight){if(i.scrollTop!==0)return Ce.current=new Date,!1;if(i.getAttribute("role")==="dialog")return!0}i=i.parentNode}return!0}function re(v){if(S.current&&ae){const M=w==="bottom"||w==="right"?1:-1,n=(be.current-(te(w)?v.pageY:v.pageX))*M,i=n>0,f=l&&!g&&!i;if(f&&de===0)return;const k=Math.abs(n),O=document.querySelector("[data-vaul-drawer-wrapper]"),Y=w==="bottom"||w==="top"?he.current:Q.current;let oe=k/Y;const ge=ke(k,i);if(ge!==null&&(oe=ge),f&&oe>=1||!De.current&&!xe(v.target,i))return;if(S.current.classList.add(kt),De.current=!0,se(S.current,{transition:"none"}),se(fe.current,{transition:"none"}),l&&Ke({draggedDistance:n}),i&&!l){const ue=Ts(n),Oe=Math.min(ue*-1,0)*M;se(S.current,{transform:te(w)?`translate3d(0, ${Oe}px, 0)`:`translate3d(${Oe}px, 0, 0)`});return}const ve=1-oe;if((we||b&&de===b-1)&&(o?.(v,oe),se(fe.current,{opacity:`${ve}`,transition:"none"},!0)),O&&fe.current&&h){const ue=Math.min(Ae()+oe*(1-Ae()),1),Oe=8-oe*8,Ve=Math.max(0,14-oe*14);se(O,{borderRadius:`${Oe}px`,transform:te(w)?`scale(${ue}) translate3d(0, ${Ve}px, 0)`:`scale(${ue}) translate3d(${Ve}px, 0, 0)`,transition:"none"},!0)}if(!l){const ue=k*M;se(S.current,{transform:te(w)?`translate3d(0, ${ue}px, 0)`:`translate3d(${ue}px, 0, 0)`})}}}d.useEffect(()=>{window.requestAnimationFrame(()=>{We.current=!0})},[]),d.useEffect(()=>{var v;function M(){if(!S.current||!I)return;const n=document.activeElement;if(Ht(n)||pe.current){var i;const f=((i=window.visualViewport)==null?void 0:i.height)||0,k=window.innerHeight;let O=k-f;const Y=S.current.getBoundingClientRect().height||0,oe=Y>k*.8;ce.current||(ce.current=Y);const ge=S.current.getBoundingClientRect().top;if(Math.abs(Re.current-O)>60&&(pe.current=!pe.current),l&&l.length>0&&Me&&de){const ve=Me[de]||0;O+=ve}if(Re.current=O,Y>f||pe.current){const ve=S.current.getBoundingClientRect().height;let ue=ve;ve>f&&(ue=f-(oe?ge:zt)),D?S.current.style.height=`${ve-Math.max(O,0)}px`:S.current.style.height=`${Math.max(ue,f-ge)}px`}else gs()||(S.current.style.height=`${ce.current}px`);l&&l.length>0&&!pe.current?S.current.style.bottom="0px":S.current.style.bottom=`${Math.max(O,0)}px`}}return(v=window.visualViewport)==null||v.addEventListener("resize",M),()=>{var n;return(n=window.visualViewport)==null?void 0:n.removeEventListener("resize",M)}},[de,l,Me]);function Ie(v){ee(),y?.(),v||J(!1),setTimeout(()=>{l&&ze(l[0])},X.DURATION*1e3)}function C(){if(!S.current)return;const v=document.querySelector("[data-vaul-drawer-wrapper]"),M=bt(S.current,w);se(S.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${X.DURATION}s cubic-bezier(${X.EASE.join(",")})`}),se(fe.current,{transition:`opacity ${X.DURATION}s cubic-bezier(${X.EASE.join(",")})`,opacity:"1"}),h&&M&&M>0&&W&&se(v,{borderRadius:`${mn}px`,overflow:"hidden",...te(w)?{transform:`scale(${Ae()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Ae()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${X.DURATION}s`,transitionTimingFunction:`cubic-bezier(${X.EASE.join(",")})`},!0)}function ee(){!ae||!S.current||(S.current.classList.remove(kt),De.current=!1,Se(!1),Ue.current=new Date)}function je(v){if(!ae||!S.current)return;S.current.classList.remove(kt),De.current=!1,Se(!1),Ue.current=new Date;const M=bt(S.current,w);if(!v||!xe(v.target,!1)||!M||Number.isNaN(M)||He.current===null)return;const n=Ue.current.getTime()-He.current.getTime(),i=be.current-(te(w)?v.pageY:v.pageX),f=Math.abs(i)/n;if(f>.05&&(Ee(!0),setTimeout(()=>{Ee(!1)},200)),l){Be({draggedDistance:i*(w==="bottom"||w==="right"?1:-1),closeDrawer:Ie,velocity:f,dismissible:g}),c?.(v,!0);return}if(w==="bottom"||w==="right"?i>0:i<0){C(),c?.(v,!0);return}if(f>un){Ie(),c?.(v,!1);return}var k;const O=Math.min((k=S.current.getBoundingClientRect().height)!=null?k:0,window.innerHeight);var Y;const oe=Math.min((Y=S.current.getBoundingClientRect().width)!=null?Y:0,window.innerWidth),ge=w==="left"||w==="right";if(Math.abs(M)>=(ge?oe:O)*u){Ie(),c?.(v,!1);return}c?.(v,!0),C()}d.useEffect(()=>(W&&(se(document.documentElement,{scrollBehavior:"auto"}),_e.current=new Date),()=>{ks(document.documentElement,"scrollBehavior")}),[W]);function st(v){const M=v?(window.innerWidth-Qe)/window.innerWidth:1,n=v?-Qe:0;F.current&&window.clearTimeout(F.current),se(S.current,{transition:`transform ${X.DURATION}s cubic-bezier(${X.EASE.join(",")})`,transform:te(w)?`scale(${M}) translate3d(0, ${n}px, 0)`:`scale(${M}) translate3d(${n}px, 0, 0)`}),!v&&S.current&&(F.current=setTimeout(()=>{const i=bt(S.current,w);se(S.current,{transition:"none",transform:te(w)?`translate3d(0, ${i}px, 0)`:`translate3d(${i}px, 0, 0)`})},500))}function Je(v,M){if(M<0)return;const n=(window.innerWidth-Qe)/window.innerWidth,i=n+M*(1-n),f=-Qe+M*Qe;se(S.current,{transform:te(w)?`scale(${i}) translate3d(0, ${f}px, 0)`:`scale(${i}) translate3d(${f}px, 0, 0)`,transition:"none"})}function Te(v,M){const n=te(w)?window.innerHeight:window.innerWidth,i=M?(n-Qe)/n:1,f=M?-Qe:0;M&&se(S.current,{transition:`transform ${X.DURATION}s cubic-bezier(${X.EASE.join(",")})`,transform:te(w)?`scale(${i}) translate3d(0, ${f}px, 0)`:`scale(${i}) translate3d(${f}px, 0, 0)`})}return d.useEffect(()=>{G||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[G]),d.createElement(Mn,{defaultOpen:ne,onOpenChange:v=>{!g&&!v||(v?K(!0):Ie(!0),J(v))},open:W},d.createElement(an.Provider,{value:{activeSnapPoint:tt,snapPoints:l,setActiveSnapPoint:ze,drawerRef:S,overlayRef:fe,onOpenChange:s,onPress:qe,onRelease:je,onDrag:re,dismissible:g,shouldAnimate:We,handleOnly:_,isOpen:W,isDragging:ae,shouldFade:we,closeDrawer:Ie,onNestedDrag:Je,onNestedOpenChange:st,onNestedRelease:Te,keyboardIsOpen:pe,modal:G,snapPointsOffset:Me,activeSnapPointIndex:de,direction:w,shouldScaleBackground:h,setBackgroundColorOnScale:x,noBodyStyles:$,container:Z,autoFocus:z}},r))}const hn=d.forwardRef(function({...t},s){const{overlayRef:r,snapPoints:o,onRelease:c,shouldFade:l,isOpen:h,modal:x,shouldAnimate:u}=mt(),T=cn(s,r),g=o&&o.length>0;if(!x)return null;const _=d.useCallback(b=>c(b),[c]);return d.createElement(On,{onMouseUp:_,ref:T,"data-vaul-overlay":"","data-vaul-snap-points":h&&g?"true":"false","data-vaul-snap-points-overlay":h&&l?"true":"false","data-vaul-animate":u?.current?"true":"false",...t})});hn.displayName="Drawer.Overlay";const xn=d.forwardRef(function({onPointerDownOutside:t,style:s,onOpenAutoFocus:r,...o},c){const{drawerRef:l,onPress:h,onRelease:x,onDrag:u,keyboardIsOpen:T,snapPointsOffset:g,activeSnapPointIndex:_,modal:b,isOpen:H,direction:q,snapPoints:D,container:G,handleOnly:y,shouldAnimate:E,autoFocus:$}=mt(),[w,ne]=d.useState(!1),le=cn(c,l),N=d.useRef(null),A=d.useRef(null),I=d.useRef(!1),P=D&&D.length>0;Ps();const Z=(p,V,W=0)=>{if(I.current)return!0;const J=Math.abs(p.y),B=Math.abs(p.x),K=B>J,ae=["bottom","right"].includes(V)?1:-1;if(V==="left"||V==="right"){if(!(p.x*ae<0)&&B>=0&&B<=W)return K}else if(!(p.y*ae<0)&&J>=0&&J<=W)return!K;return I.current=!0,!0};d.useEffect(()=>{P&&window.requestAnimationFrame(()=>{ne(!0)})},[]);function z(p){N.current=null,I.current=!1,x(p)}return d.createElement(In,{"data-vaul-drawer-direction":q,"data-vaul-drawer":"","data-vaul-delayed-snap-points":w?"true":"false","data-vaul-snap-points":H&&P?"true":"false","data-vaul-custom-container":G?"true":"false","data-vaul-animate":E?.current?"true":"false",...o,ref:le,style:g&&g.length>0?{"--snap-point-height":`${g[_??0]}px`,...s}:s,onPointerDown:p=>{y||(o.onPointerDown==null||o.onPointerDown.call(o,p),N.current={x:p.pageX,y:p.pageY},h(p))},onOpenAutoFocus:p=>{r?.(p),$||p.preventDefault()},onPointerDownOutside:p=>{if(t?.(p),!b||p.defaultPrevented){p.preventDefault();return}T.current&&(T.current=!1)},onFocusOutside:p=>{if(!b){p.preventDefault();return}},onPointerMove:p=>{if(A.current=p,y||(o.onPointerMove==null||o.onPointerMove.call(o,p),!N.current))return;const V=p.pageY-N.current.y,W=p.pageX-N.current.x,J=p.pointerType==="touch"?10:2;Z({x:W,y:V},q,J)?u(p):(Math.abs(W)>J||Math.abs(V)>J)&&(N.current=null)},onPointerUp:p=>{o.onPointerUp==null||o.onPointerUp.call(o,p),N.current=null,I.current=!1,x(p)},onPointerOut:p=>{o.onPointerOut==null||o.onPointerOut.call(o,p),z(A.current)},onContextMenu:p=>{o.onContextMenu==null||o.onContextMenu.call(o,p),A.current&&z(A.current)}})});xn.displayName="Drawer.Content";const Hs=250,zs=120,Bs=d.forwardRef(function({preventCycle:t=!1,children:s,...r},o){const{closeDrawer:c,isDragging:l,snapPoints:h,activeSnapPoint:x,setActiveSnapPoint:u,dismissible:T,handleOnly:g,isOpen:_,onPress:b,onDrag:H}=mt(),q=d.useRef(null),D=d.useRef(!1);function G(){if(D.current){$();return}window.setTimeout(()=>{y()},zs)}function y(){if(l||t||D.current){$();return}if($(),!h||h.length===0){T||c();return}if(x===h[h.length-1]&&T){c();return}const ne=h.findIndex(N=>N===x);if(ne===-1)return;const le=h[ne+1];u(le)}function E(){q.current=window.setTimeout(()=>{D.current=!0},Hs)}function $(){q.current&&window.clearTimeout(q.current),D.current=!1}return d.createElement("div",{onClick:G,onPointerCancel:$,onPointerDown:w=>{g&&b(w),E()},onPointerMove:w=>{g&&H(w)},ref:o,"data-vaul-drawer-visible":_?"true":"false","data-vaul-handle":"","aria-hidden":"true",...r},d.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},s))});Bs.displayName="Drawer.Handle";function qs(t){const s=mt(),{container:r=s.container,...o}=t;return d.createElement(An,{container:r,...o})}const Fe={Root:Fs,Content:xn,Overlay:hn,Portal:qs,Title:Tn,Description:Dn},gn=({shouldScaleBackground:t=!0,...s})=>e.jsx(Fe.Root,{shouldScaleBackground:t,...s});gn.displayName="Drawer";const Vs=Fe.Portal,vn=m.forwardRef(({className:t,...s},r)=>e.jsx(Fe.Overlay,{ref:r,className:me("fixed inset-0 z-50 bg-black/80",t),...s}));vn.displayName=Fe.Overlay.displayName;const bn=m.forwardRef(({className:t,children:s,...r},o)=>e.jsxs(Vs,{children:[e.jsx(vn,{}),e.jsxs(Fe.Content,{ref:o,className:me("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",t),...r,children:[e.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),s]})]}));bn.displayName="DrawerContent";const yn=({className:t,...s})=>e.jsx("div",{className:me("grid gap-1.5 p-4 text-center sm:text-left",t),...s});yn.displayName="DrawerHeader";const wn=m.forwardRef(({className:t,...s},r)=>e.jsx(Fe.Title,{ref:r,className:me("text-lg font-semibold leading-none tracking-tight",t),...s}));wn.displayName=Fe.Title.displayName;const jn=m.forwardRef(({className:t,...s},r)=>e.jsx(Fe.Description,{ref:r,className:me("text-sm text-muted-foreground",t),...s}));jn.displayName=Fe.Description.displayName;function Nn({children:t,className:s,containerClassName:r}){return e.jsx("div",{role:"region","aria-label":"Actions",className:me("fixed bottom-16 left-0 right-0 z-bar md:bottom-0 md:z-bar",s),children:e.jsx("div",{className:me("mx-auto flex w-full max-w-md items-center justify-between gap-2 border-t bg-background px-4 py-3 shadow-[0_-2px_10px_rgba(0,0,0,0.1)]","md:supports-[padding:env(safe-area-inset-bottom)]:pb-[calc(env(safe-area-inset-bottom)+0.75rem)]",r),children:t})})}const Us=[1,2,3,4,5];function en({value:t,onChange:s,className:r,disabled:o=!1,size:c="md",ariaLabel:l="Sélecteur d'échelle 1 à 5"}){const h=c==="sm"?"h-10 w-10 text-xs":"h-11 w-11 text-sm";return e.jsx("div",{className:me("flex items-center gap-2",r),role:"group","aria-label":l,children:Us.map(x=>{const u=t===x;return e.jsx("button",{type:"button",className:me("flex items-center justify-center rounded-full border font-semibold transition",h,u?"border-primary bg-primary text-primary-foreground":"border-muted-foreground/30 bg-background text-foreground",o&&"opacity-60"),"aria-pressed":u,disabled:o,onClick:()=>{o||s?.(x)},children:x},x)})})}const tn=()=>{try{const t=new(window.AudioContext||window.webkitAudioContext),s=t.createOscillator(),r=t.createGain();s.connect(r),r.connect(t.destination),s.frequency.value=880,r.gain.value=.3,s.start(),s.stop(t.currentTime+.25);const o=t.createOscillator(),c=t.createGain();o.connect(c),c.connect(t.destination),o.frequency.value=1100,c.gain.value=.3,o.start(t.currentTime+.35),o.stop(t.currentTime+.6),o.onended=()=>t.close()}catch{}try{navigator.vibrate?.([200,100,200])}catch{}},wt=(t,s)=>{const r=Number(t?.set_index??t?.set_number??t?.setIndex??s);return!Number.isFinite(r)||r<=0?s:r},Sn=(t=[],s,r)=>{if(!t.length)return 0;const o=Array.isArray(s)?s:[];if(o.length>0){const h=new Map;o.forEach((u,T)=>{if(!u?.exercise_id)return;const g=h.get(u.exercise_id)??[];g.push({...u,set_index:wt(u,T+1)}),h.set(u.exercise_id,g)});let x=t.length+1;for(let u=0;u<t.length;u+=1){const T=t[u];if((h.get(T.exercise_id)??[]).length<(T.sets??0)){x=u+1;break}}return x}const c=Number(r??0);if(!Number.isFinite(c)||c<=0)return 0;const l=Math.min(t.length,Math.max(0,Math.round(c/100*t.length)));return Math.min(t.length,l+1)},Le=(t,s)=>{const r=Number(t);return!Number.isFinite(r)||r<=0?"—":s?`${r}${s}`:String(r)};function Ws({session:t,exercises:s,oneRMs:r,onFinish:o,onStart:c,onLogSets:l,onProgress:h,initialLogs:x,isFinishing:u,initialStep:T,onStepChange:g,initialInputOpen:_,initialSeriesOpen:b,onExitFocus:H,exerciseNotes:q,onUpdateNote:D}){const{toast:G}=sn(),y=m.useRef(!1),[E,$]=m.useState(T??0),[w,ne]=m.useState([]),[le,N]=m.useState(0),[A,I]=m.useState(!0),P=m.useRef(Date.now()),Z=m.useRef(0),[z,p]=m.useState(0),[V,W]=m.useState(!1),[J,B]=m.useState(!1),K=m.useRef(0),[ae,Se]=m.useState(!0),[ie,Ee]=m.useState(3),[fe,_e]=m.useState(3),[He,Ue]=m.useState(""),[Ce,De]=m.useState(!1),[F,be]=m.useState(1),[pe,We]=m.useState(b??!1),[Re,S]=m.useState(_??!1),[he,Q]=m.useState("weight"),[ce,ye]=m.useState(""),[tt,de]=m.useState(!1),[ze,Be]=m.useState(!1),[Me,Ke]=m.useState(!1),[we,ke]=m.useState(!1),[nt,Ae]=m.useState(!1),[qe,xe]=m.useState("");m.useEffect(()=>{if(!A)return;const a=()=>{N(Math.floor((Date.now()-P.current)/1e3)+Z.current)};a();const j=setInterval(a,1e3),U=()=>{document.visibilityState==="visible"&&a()};return document.addEventListener("visibilitychange",U),()=>{clearInterval(j),document.removeEventListener("visibilitychange",U)}},[A]),m.useEffect(()=>{if(!ze)return;const a=j=>{j.key==="Escape"&&Be(!1)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[ze]),m.useEffect(()=>{let a=null;V&&!J&&z>0?a=setInterval(()=>p(U=>U-1),1e3):z===0&&V&&(tn(),G({title:"Temps de récupération terminé"}),W(!1),B(!1));const j=()=>{if(document.visibilityState==="visible"&&V&&!J&&K.current>0){const U=Math.max(0,Math.ceil((K.current-Date.now())/1e3));p(U),U<=0&&(tn(),G({title:"Temps de récupération terminé"}),W(!1),B(!1))}};return document.addEventListener("visibilitychange",j),()=>{a&&clearInterval(a),document.removeEventListener("visibilitychange",j)}},[V,J,z]);const re=t.items||[],Ie=E-1,C=E>0&&E<=re.length?re[Ie]:null,ee=C?s.find(a=>a.id===C.exercise_id):null,je=E<re.length?re[E]:null,st=je?s.find(a=>a.id===je.exercise_id):null,Je=(()=>{const a=ee?.muscle_groups??ee?.muscles??ee?.muscleGroups??[];return Array.isArray(a)?a:[]})(),Te=C?.rest_seconds??0,v=re.length?Math.min(100,Math.max(0,Math.round((E-1)/re.length*100))):0,M=Number(C?.percent_1rm),n=Number.isFinite(M)&&M>0,i=n&&r.find(a=>a.exercise_id===C?.exercise_id)?.weight||0,f=n?Math.round(i*(M/100)):0,[k,O]=m.useState({}),Y=m.useMemo(()=>{const a=new Map;return w.forEach((j,U)=>{const R=wt(j,U+1);j.exercise_id&&a.set(`${j.exercise_id}-${R}`,j)}),a},[w]),oe=C?`${C.exercise_id}-${F}`:null,ge=oe?Y.get(oe):null,ve=ge?.weight??k[F-1]?.weight??f,ue=ge?.reps??k[F-1]?.reps??C?.reps??"",Oe=()=>{if(typeof window>"u")return;const a=["#22c55e","#3b82f6","#f97316","#e11d48","#a855f7"],j=120;for(let U=0;U<j;U+=1){const R=document.createElement("div"),$e=Math.random()*6+6;R.style.position="fixed",R.style.top="-10px",R.style.left=`${Math.random()*100}vw`,R.style.width=`${$e}px`,R.style.height=`${$e*.6}px`,R.style.backgroundColor=a[U%a.length],R.style.opacity="0.9",R.style.pointerEvents="none",R.style.zIndex="9999",R.style.borderRadius="2px",document.body.appendChild(R);const Pe=(Math.random()-.5)*200,rt=1200+Math.random()*800,pt=Math.random()*360;R.animate([{transform:"translate3d(0, 0, 0) rotate(0deg)",opacity:1},{transform:`translate3d(${Pe}px, ${window.innerHeight+200}px, 0) rotate(${pt}deg)`,opacity:0}],{duration:rt,easing:"ease-out"}).onfinish=()=>R.remove()}};m.useEffect(()=>{if(y.current){x&&ne(x);return}if(!x){ne(R=>R.length?[]:R),O(R=>Object.keys(R).length?{}:R);return}if(ne(x),!x.length){O(R=>Object.keys(R).length?{}:R),$(R=>R===0?R:0);return}const a=t.items||[];if(!a.length)return;const j=new Map;x.forEach((R,$e)=>{if(!R.exercise_id)return;const Pe=j.get(R.exercise_id)??[];Pe.push({...R,set_index:wt(R,$e+1)}),j.set(R.exercise_id,Pe)});const U=Sn(a,x);if(U>0&&U<=a.length){const R=a[U-1],$e=j.get(R.exercise_id)??[],Pe=$e.reduce((pt,St,En)=>{const kn=wt(St,En+1);return pt[kn-1]={reps:St.reps??void 0,weight:St.weight??void 0},pt},{});O(Pe);const rt=Math.min(R.sets??1,$e.length+1);be(rt)}else O({}),be(1);$(R=>R===U?R:U)},[x,t.items]),m.useEffect(()=>{E<=re.length||Ce||(Oe(),De(!0))},[E,re.length,Ce]);const Ve=a=>{$(a),g?.(a)},ft=a=>{a<=0||(K.current=Date.now()+a*1e3,p(a),W(!0),B(!1))},jt=async()=>{window.scrollTo({top:0,behavior:"smooth"});const a=E+1;be(1),O({}),Ve(a);const j=Math.round(Math.min(a-1,re.length)/re.length*100);try{await h?.(j)}catch{G({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}},Cn=async()=>{if(!C)return;if(ge){F>=C.sets?await jt():be(j=>Math.min(C.sets,j+1));return}const a={exercise_id:C.exercise_id,set_number:F,reps:k[F-1]?.reps||C.reps,weight:k[F-1]?.weight||f};ne(j=>[...j,a]),y.current=!0;try{await l?.([a])}catch{G({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}finally{y.current=!1}if(ae&&C.rest_seconds>0&&ft(C.rest_seconds),F>=C.sets){await jt();return}be(j=>Math.min(C.sets,j+1))},qt=a=>{Q(a);const j=a==="weight"?k[F-1]?.weight??f??"":k[F-1]?.reps??C?.reps??"";ye(j?String(j):""),de(!!j),S(!0)},Rn=()=>{if(!C)return;const a=Number(he==="weight"?ce.replace(",","."):ce);Number.isFinite(a)&&(O(j=>({...j,[F-1]:{...j[F-1],[he]:a}})),S(!1))},Nt=a=>{if(tt){de(!1),ye(a);return}ye(j=>a==="."&&j.includes(".")?j:j+a)},Vt=a=>{if(!C)return;Q(a);const j=a==="weight"?k[F-1]?.weight??f??"":k[F-1]?.reps??C?.reps??"";ye(j?String(j):""),de(!!j)};return E===0?e.jsxs("div",{className:"space-y-6 text-center py-8 animate-in zoom-in duration-300",children:[e.jsx("div",{className:"h-24 w-24 bg-primary/10 rounded-full flex items-center justify-center mx-auto animate-pulse",children:e.jsx(Xe,{className:"h-10 w-10 text-primary ml-1"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold font-display uppercase",children:t.title}),e.jsx("p",{className:"text-muted-foreground text-lg",children:t.description}),e.jsxs("div",{className:"flex gap-2 justify-center mt-4",children:[e.jsx(dt,{variant:"outline",className:"text-sm px-3 py-1",children:t.cycle}),e.jsxs(dt,{variant:"secondary",className:"text-sm px-3 py-1",children:[re.length," Exercices"]})]})]}),e.jsx(L,{size:"lg",className:"w-full text-xl h-14 font-bold uppercase tracking-wider shadow-lg hover:scale-[1.02] transition-transform",disabled:Me,onClick:async()=>{Ke(!0);try{await c?.(),Ve(1)}finally{Ke(!1)}},children:Me?e.jsxs(e.Fragment,{children:[e.jsx(Kn,{className:"mr-2 h-5 w-5 animate-spin"}),"CHARGEMENT..."]}):"COMMENCER SÉANCE"})]}):E>re.length?e.jsx("div",{className:"space-y-6 animate-in fade-in",children:e.jsxs(Ge,{className:"border-t-8 border-t-primary shadow-xl",children:[e.jsxs(Dt,{className:"text-center pb-2",children:[e.jsx("div",{className:"mx-auto bg-primary/10 p-4 rounded-full w-fit mb-4",children:e.jsx(cs,{className:"h-12 w-12 text-primary"})}),e.jsx(Mt,{className:"text-3xl uppercase font-display italic",children:"Séance Terminée !"}),e.jsxs(rn,{className:"text-lg",children:["Durée totale: ",Math.floor(le/60),"m ",le%60,"s"]})]}),e.jsxs(At,{className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Volume"}),e.jsxs("div",{className:"text-2xl font-mono font-bold",children:[w.reduce((a,j)=>a+(Number(j.weight)||0)*(Number(j.reps)||0),0)," kg"]})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Séries"}),e.jsx("div",{className:"text-2xl font-mono font-bold",children:w.length})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(et,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Difficulté de la séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Facile"}),e.jsx("span",{children:"Très dur"})]}),e.jsx(en,{value:ie,onChange:Ee})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(et,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Fatigue fin de séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Frais"}),e.jsx("span",{children:"Épuisé"})]}),e.jsx(en,{value:fe,onChange:_e})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(et,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Notes"}),e.jsx("textarea",{placeholder:"Sensations, douleurs...",value:He,onChange:a=>Ue(a.target.value),rows:3,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none"})]})]}),e.jsx(Ln,{children:e.jsx(L,{className:"w-full h-14 text-lg font-bold uppercase",disabled:u,onClick:()=>{u||o({duration:Math.floor(le/60),feeling:ie,fatigue:fe,comments:He,logs:w})},children:u?"ENREGISTREMENT...":"ENREGISTRER & FERMER"})})]})}):e.jsxs("div",{className:"space-y-6 pb-32",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button","aria-label":"Voir l’animation de l’exercice",onClick:()=>{ee?.illustration_gif&&Be(!0)},className:"flex h-12 w-12 items-center justify-center overflow-hidden rounded-full border bg-card shadow-sm",children:ee?.illustration_gif?e.jsx("img",{src:ee.illustration_gif,alt:"",className:"h-full w-full object-cover",loading:"lazy",decoding:"async"}):e.jsx(Xe,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold",children:["Ex ",E,"/",re.length]}),e.jsxs("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold",children:["S ",F,"/",Le(C?.sets)]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Séance"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-28 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${v}%`}})}),e.jsxs("div",{className:"text-sm font-semibold",children:[v,"%"]})]}),H?e.jsx(L,{variant:"ghost",size:"icon","aria-label":"Quitter le focus",onClick:()=>{w.length>0?ke(!0):H()},children:e.jsx(yt,{className:"h-4 w-4"})}):null]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-2xl font-semibold tracking-tight",children:ee?.nom_exercice??"Exercice"}),D&&C&&e.jsx(L,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",onClick:()=>{xe(q?.[C.exercise_id]??""),Ae(!0)},"aria-label":"Notes personnelles",children:e.jsx(ns,{className:me("h-4 w-4",q?.[C?.exercise_id]?"text-primary":"text-muted-foreground")})})]}),C&&q?.[C.exercise_id]&&e.jsx("p",{className:"mt-1 text-xs italic text-muted-foreground line-clamp-2",children:q[C.exercise_id]}),Je.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:Je.map(a=>e.jsx("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:a},a))})]}),e.jsxs(Ge,{className:"rounded-3xl border bg-card p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-base font-semibold",children:"Série en cours"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Lt,{checked:ae,onCheckedChange:Se}),"Auto repos"]})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border bg-muted/20 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"En cours"}),e.jsxs("div",{className:"mt-2 text-lg font-semibold",children:["Série ",F,"/",Le(C?.sets)," · Objectif"," ",Le(C?.reps)," reps"]}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:"Appuie sur une tuile pour saisir."})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>qt("weight"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:ve||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>qt("reps"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:ue||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"reps"})]})]})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border bg-muted/10 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Notes"}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:C?.notes||ee?.description||"Aucune note spécifique."})]}),e.jsx(L,{type:"button",variant:"outline",className:"mt-4 w-full rounded-2xl",onClick:()=>We(!0),children:"Voir les séries"})]}),!Re&&!V?e.jsxs(Nn,{className:"bottom-0 z-[60]",containerClassName:"gap-3 py-4",children:[e.jsxs(L,{className:"flex-1 min-w-0 h-12 rounded-xl text-sm font-bold shadow-lg active:scale-95 transition-transform",onClick:Cn,children:[e.jsx(Qt,{className:"mr-2 h-5 w-5"})," Valider série"]}),e.jsx(L,{type:"button",variant:"outline",className:"h-12 w-12 rounded-xl p-0 active:scale-95 transition-transform",onClick:()=>{Te<=0||ft(Te)},"aria-label":"Démarrer le repos",children:e.jsx(ss,{className:"h-5 w-5"})}),e.jsx(L,{type:"button",variant:"outline",className:"h-12 w-12 rounded-xl p-0 active:scale-95 transition-transform",onClick:()=>jt(),"aria-label":"Exercice suivant",children:e.jsx(Ft,{className:"h-5 w-5"})})]}):null,V&&e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-background/95 pb-[env(safe-area-inset-bottom)]",children:[e.jsxs("div",{className:"flex items-start justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Timer"}),e.jsx("div",{className:"text-lg font-semibold",children:"Transition inter-exercice"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Prochain exercice : ",st?.nom_exercice??"À venir"]})]}),e.jsx(L,{variant:"ghost",size:"icon",onClick:()=>{W(!1),B(!1)},"aria-label":"Fermer le timer de repos",children:e.jsx(yt,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-6 px-6 py-8",children:[e.jsxs(Ge,{className:"w-full max-w-sm rounded-3xl border p-6 shadow-sm",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Temps restant"}),e.jsxs("div",{className:"mt-2 text-5xl font-semibold tracking-tight",children:[Math.floor(z/60),":",String(z%60).padStart(2,"0")]}),e.jsx("div",{className:"mt-6 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:Te?`${z/Te*100}%`:"0%"}})}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[e.jsx(L,{variant:"outline",className:"rounded-full",onClick:()=>{K.current+=15*1e3,p(a=>a+15)},children:"+15s"}),e.jsx(L,{variant:"outline",className:"rounded-full",onClick:()=>{K.current+=30*1e3,p(a=>a+30)},children:"+30s"}),e.jsx(L,{variant:"outline",className:"rounded-full",onClick:()=>{K.current=Math.max(Date.now(),K.current-15*1e3),p(a=>Math.max(0,a-15))},children:"-15s"}),e.jsxs(L,{variant:"outline",className:"ml-auto rounded-full",onClick:()=>{K.current=Date.now()+Te*1e3,p(Te)},children:[e.jsx(fs,{className:"mr-2 h-4 w-4"}),"Reset"]})]})]}),e.jsxs("div",{className:"flex w-full max-w-sm flex-wrap gap-3",children:[e.jsxs(L,{className:"flex-1 rounded-full py-6 text-base font-semibold",onClick:()=>{J&&(K.current=Date.now()+z*1e3),B(a=>!a)},children:[e.jsx(us,{className:"mr-2 h-4 w-4"})," ",J?"Reprendre":"Pause"]}),e.jsxs(L,{variant:"outline",className:"rounded-full px-6 py-6 text-base font-semibold",onClick:()=>{K.current=0,W(!1),p(0),B(!1)},children:["Passer ",e.jsx(Ft,{className:"ml-2 h-4 w-4"})]})]})]})]}),ze&&ee?.illustration_gif&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:()=>Be(!1),children:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button","aria-label":"Fermer",className:"absolute -right-3 -top-3 rounded-full bg-background p-2 shadow",onClick:()=>Be(!1),children:e.jsx(yt,{className:"h-4 w-4"})}),e.jsx("img",{src:ee.illustration_gif,alt:"",className:"max-h-[80vh] w-auto max-w-[92vw] rounded-2xl",loading:"lazy"})]})})}),e.jsx(It,{open:pe,onOpenChange:We,children:e.jsxs(Ot,{side:"bottom",className:"max-h-[80vh] overflow-y-auto",children:[e.jsx($t,{children:e.jsx(Pt,{children:"Aperçu séance"})}),e.jsx("div",{className:"mt-4 space-y-4",children:re.map((a,j)=>{const U=s.find(Pe=>Pe.id===a.exercise_id),R=Array.from({length:a.sets}).filter((Pe,rt)=>Y.get(`${a.exercise_id}-${rt+1}`)).length,$e=a.sets?Math.round(R/a.sets*100):0;return e.jsxs(Ge,{className:"rounded-3xl border bg-muted/10 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:U?.nom_exercice??a.exercise_name}),e.jsxs("div",{className:"mt-1 text-sm text-muted-foreground",children:[Le(a.sets),"x",Le(a.reps)," ·"," ",a.percent_1rm?`${Le(a.percent_1rm)} 1RM`:"—"]})]}),e.jsxs("div",{className:"rounded-full bg-muted px-3 py-1 text-sm font-semibold",children:[R,"/",Le(a.sets)]})]}),e.jsx("div",{className:"mt-4 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${$e}%`}})})]},`${a.exercise_id}-${j}`)})})]})}),e.jsx(gn,{open:Re,onOpenChange:S,children:e.jsx(bn,{className:"max-h-[90vh]",children:e.jsxs("div",{className:"mx-auto w-full max-w-md px-4 pb-8",children:[e.jsxs(yn,{className:"pb-2",children:[e.jsx(wn,{className:"text-center",children:he==="weight"?"Charge":"Répétitions"}),e.jsxs(jn,{className:"text-center",children:["Série ",F,"/",Le(C?.sets)," · Objectif"," ",Le(C?.reps)," reps"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("button",{type:"button",className:me("rounded-xl border-2 p-4 text-center transition-all",he==="weight"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>Vt("weight"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[he==="weight"?ce||"—":String(k[F-1]?.weight??f??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:me("rounded-xl border-2 p-4 text-center transition-all",he==="reps"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>Vt("reps"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[he==="reps"?ce||"—":String(k[F-1]?.reps??C?.reps??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"reps"})]})]})]}),he==="weight"&&f>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[f-10,f-5,f,f+5,f+10].filter(a=>a>0).map(a=>e.jsxs(L,{variant:Number(ce)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>ye(String(a)),children:[a," kg"]},a))})]}),he==="reps"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[6,8,10,12,15,20].map(a=>e.jsx(L,{variant:Number(ce)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>ye(String(a)),children:a},a))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[[1,2,3,4,5,6,7,8,9].map(a=>e.jsx(L,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>Nt(String(a)),children:a},a)),e.jsx(L,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>Nt("."),children:","}),e.jsx(L,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>Nt("0"),children:"0"}),e.jsx(L,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>{de(!1),ye(a=>a.slice(0,-1))},children:"⌫"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(L,{variant:"outline",className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:()=>{de(!1),ye("")},children:"Effacer"}),e.jsxs(L,{className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:Rn,children:[e.jsx(Qt,{className:"mr-2 h-5 w-5"}),"Valider"]})]})]})})}),H&&e.jsx(Qn,{open:we,onOpenChange:ke,children:e.jsxs(Yn,{children:[e.jsxs(Xn,{children:[e.jsx(Gn,{children:"Quitter la séance ?"}),e.jsx(Jn,{children:"Les séries enregistrées seront conservées."})]}),e.jsxs(Zn,{children:[e.jsx(es,{children:"Annuler"}),e.jsx(ts,{onClick:()=>{ke(!1),H()},children:"Quitter"})]})]})}),D&&e.jsx(It,{open:nt,onOpenChange:a=>{if(!a&&C){const j=qe.trim()||null,U=q?.[C.exercise_id]??null;j!==U&&D(C.exercise_id,j)}Ae(a)},children:e.jsxs(Ot,{side:"bottom",className:"max-h-[60vh]",children:[e.jsx($t,{children:e.jsxs(Pt,{children:["Notes — ",ee?.nom_exercice]})}),e.jsx("textarea",{value:qe,onChange:a=>xe(a.target.value),placeholder:"Réglages machine, repères personnels...",rows:4,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm mt-4 resize-none ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"})]})})]})}const Ye=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance",lt=t=>{const s=Number(t);return!Number.isFinite(s)||s<=0?null:s},Ks=(t,s)=>{if(!t)return{sets:null,reps:null,percent1rm:null,restSeries:null,restExercise:null};const r={endurance:{sets:t.Nb_series_endurance,reps:t.Nb_reps_endurance,percent1rm:t.pct_1rm_endurance,restSeries:t.recup_endurance,restExercise:t.recup_exercices_endurance},hypertrophie:{sets:t.Nb_series_hypertrophie,reps:t.Nb_reps_hypertrophie,percent1rm:t.pct_1rm_hypertrophie,restSeries:t.recup_hypertrophie,restExercise:t.recup_exercices_hypertrophie},force:{sets:t.Nb_series_force,reps:t.Nb_reps_force,percent1rm:t.pct_1rm_force,restSeries:t.recup_force,restExercise:t.recup_exercices_force}}[s];return{sets:lt(r.sets),reps:lt(r.reps),percent1rm:lt(r.percent1rm),restSeries:lt(r.restSeries),restExercise:lt(r.restExercise)}},ct=(t=[],s,r)=>Ys(t,s).map(o=>{const c=Ks(r.get(o.exercise_id),s);return{...o,sets:c.sets??0,reps:c.reps??0,rest_seconds:c.restSeries??0,percent_1rm:c.percent1rm??0}}),nn=t=>{const s=Number(t);return!Number.isFinite(s)||s<=0?"—":String(s)},Qs=t=>{const s=Number(t);return!Number.isFinite(s)||s<=0?"—":`${s}s`},_n=(t=[])=>{if(!t.length)return t;const s=t.map((o,c)=>{const l=Number(o.order_index);return{item:o,index:c,order:Number.isFinite(l)?l:null}});return s.some(o=>o.order!==null)?s.sort((o,c)=>o.order===null&&c.order===null?o.index-c.index:o.order===null?1:c.order===null?-1:o.order===c.order?o.index-c.index:o.order-c.order).map(o=>o.item):t},Ys=(t=[],s)=>{const r=t.filter(c=>c.cycle_type===s),o=r.length?r:t;return _n(o)},Xs=t=>{t.setActiveSession(null),t.setActiveAssignment(null),t.setActiveRunId(null),t.setActiveRunLogs(null),t.setActiveRunnerStep(0),t.setScreenMode("list")},Gs=({runId:t,assignmentId:s,startedAt:r})=>({id:t,assignment_id:s??null,started_at:r,progress_pct:0,status:"in_progress",logs:[]}),Tt=t=>({runs:t?[t]:[],pagination:{limit:1,offset:0,total:t?1:0},exercise_summary:[]});function br(){const{user:t,userId:s,role:r,selectedAthleteId:o,selectedAthleteName:c}=Fn(),{toast:l}=sn(),h=$n(),x="strength-preferences",[u,T]=m.useState(null),[g,_]=m.useState(null),[b,H]=m.useState(null),[q,D]=m.useState(null),[G,y]=m.useState(0),[E,$]=m.useState("list"),[w,ne]=m.useState(!1),[le,N]=m.useState({poolMode:!1,largeText:!1}),[A,I]=m.useState(""),[P,Z]=m.useState("endurance"),[z,p]=m.useState("all"),[V,W]=m.useState(""),[J,B]=m.useState(""),K=(r==="coach"||r==="admin")&&(o!==null||!!c),ae=K?c:t,Se=K?o:s,ie=Se??ae,Ee=m.useMemo(()=>`strength-focus-state-${ie??"anonymous"}`,[ie]),{poolMode:fe,largeText:_e}=le;m.useEffect(()=>{if(typeof window>"u")return;const n=window.localStorage.getItem(x);if(n)try{const i=JSON.parse(n);N(f=>({...f,...i??{}}))}catch{return}},[]),m.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(x,JSON.stringify(le))},[x,le]),m.useEffect(()=>{if(!(typeof document>"u")){if(E==="focus")return document.body.dataset.focusMode="strength",()=>{document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode};document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode}},[E]),m.useEffect(()=>{if(typeof window>"u"||u)return;const n=window.localStorage.getItem(Ee);if(n)try{const i=JSON.parse(n),f=i?.screenMode==="focus"?"focus":i?.screenMode==="reader"?"reader":null;if(!f||!i?.session)return;T(i.session),_(i.assignment??null),H(typeof i.runId=="number"?i.runId:null),D(Array.isArray(i.runLogs)?i.runLogs:null),y(Number.isFinite(i.runnerStep)?i.runnerStep:0),i.cycleType&&Z(Ye(i.cycleType)),$(f)}catch{return}},[u,Ee]),m.useEffect(()=>{if(typeof window>"u")return;if(!(E==="focus"||E==="reader")||!u){window.localStorage.removeItem(Ee);return}const i={screenMode:E,session:u,assignment:g,runId:b,runLogs:q,runnerStep:G,cycleType:P};window.localStorage.setItem(Ee,JSON.stringify(i))},[g,b,q,G,u,P,Ee,E]);const{data:He,isLoading:Ue}=at({queryKey:["assignments",t,"strength"],queryFn:()=>Ne.getAssignments(t,s,{assignmentType:"strength"}),enabled:!!t}),{data:Ce,isLoading:De}=at({queryKey:["strength_catalog"],queryFn:()=>Ne.getStrengthSessions()}),{data:F}=at({queryKey:["exercises"],queryFn:()=>Ne.getExercises()}),be=Ue||De,{data:pe}=at({queryKey:["1rm",t,s],queryFn:()=>Ne.get1RM({athleteName:t,athleteId:s}),enabled:!!t}),We=m.useMemo(()=>{const n={};return(pe??[]).forEach(i=>{i.notes&&(n[i.exercise_id]=i.notes)}),n},[pe]),Re=Pn({queryKey:["strength_history",ie,z,V,J],queryFn:({pageParam:n=0})=>Ne.getStrengthHistory(ae,{athleteId:Se,limit:10,offset:n,order:"desc",status:z==="all"?void 0:z,from:V||void 0,to:J||void 0}),enabled:!!ae,getNextPageParam:n=>{const i=n.pagination.offset+n.pagination.limit;return i<n.pagination.total?i:void 0},initialPageParam:0}),S=Re.data?.pages.flatMap(n=>n.runs)??[],Q=at({queryKey:["strength_run_in_progress",ie],queryFn:()=>Ne.getStrengthHistory(ae,{limit:1,offset:0,order:"desc",status:"in_progress",athleteId:Se}),enabled:!!ae}).data?.runs?.[0]??null,ce=Q?.status==="completed"||(Q?.progress_pct??0)>=100,ye=Ze({mutationFn:n=>Ne.startStrengthRun(n),onSuccess:n=>{if(n?.run_id&&(H(n.run_id),D(i=>i??[]),ie)){const i=Gs({runId:n.run_id,assignmentId:g?.id??null,startedAt:new Date().toISOString()});h.setQueryData(["strength_run_in_progress",ie],Tt(i))}h.invalidateQueries({queryKey:["assignments",t,"strength"]}),h.invalidateQueries({queryKey:["strength_run_in_progress",ie]}),h.invalidateQueries({queryKey:["strength_history"]})},onError:()=>{l({title:"Erreur",description:"Impossible de démarrer la séance.",variant:"destructive"})}}),tt=Ze({mutationFn:n=>Ne.logStrengthSet(n),onSuccess:n=>{n?.one_rm_updated&&(h.invalidateQueries({queryKey:["1rm",t,s]}),l({title:"Nouveau 1RM détecté",description:"Ton record vient d'être mis à jour."}))},onError:()=>{l({title:"Erreur",description:"Impossible d'enregistrer une série.",variant:"destructive"})}}),de=Ze({mutationFn:n=>Ne.updateStrengthRun(n),onSuccess:(n,i)=>{ne(!1),h.invalidateQueries({queryKey:["strength_history"]}),i?.status==="completed"&&(ie&&h.setQueryData(["strength_run_in_progress",ie],Tt(null)),h.invalidateQueries({queryKey:["assignments",t]}),h.invalidateQueries({queryKey:["assignments",t,"strength"]}),h.invalidateQueries({queryKey:["1rm",t,s]}),_(null),H(null),T(null),D(null),$("list"),l({title:"Séance sauvegardée",description:"Bravo pour l'effort !"}))},onError:(n,i)=>{i?.status==="completed"&&(ne(!1),l({title:"Erreur",description:"Impossible d'enregistrer la séance. Réessayez.",variant:"destructive"}))}}),ze=Ze({mutationFn:n=>Ne.updateExerciseNote({athlete_id:s??0,exercise_id:n.exercise_id,notes:n.notes}),onSuccess:()=>{h.invalidateQueries({queryKey:["1rm",t,s]})},onError:()=>{l({title:"Erreur",description:"Impossible de sauvegarder la note.",variant:"destructive"})}});Ze({mutationFn:n=>Ne.startStrengthRun(n),onError:()=>{l({title:"Erreur",description:"Impossible de mettre à jour la séance.",variant:"destructive"})}});const Be=(n,i)=>{const f=n.items??[],k=Ye(i??n.cycle??f.find(Y=>Y.cycle_type)?.cycle_type),O=ct(f,k,xe);_(n),T({...n,title:n.title,description:n.description,cycle:k,items:O}),H(null),D(null),y(0),$("reader")},Ke=(He?.filter(n=>n.session_type==="strength")||[]).filter(n=>n.status!=="completed"),we=Q?Ke.find(n=>n.id===Q.assignment_id)??null:null,ke=Q&&!we?Ce?.find(n=>n.id===Q.session_id)??null:null,nt=(!!we?.items?.length||!!ke?.items?.length)&&!ce,Ae=Ke.map(n=>({...n,session:{id:n.session_id,title:n.title,description:n.description,cycle:Ye(n.cycle),items:n.items??[]}})),qe=[{value:"endurance",label:"Endurance"},{value:"hypertrophie",label:"Hypertrophie"},{value:"force",label:"Force"}],xe=m.useMemo(()=>F?new Map(F.map(n=>[n.id,n])):new Map,[F]),re=Ae.map(n=>{const i=ct(n.items??[],P,xe);return{key:`assignment-${n.id}`,title:n.title,description:n.description,type:"assignment",assignedDate:n.assigned_date,session:{id:n.session_id,title:n.title,description:n.description,cycle:Ye(n.cycle),items:i},assignment:n,exerciseCount:i.length}}),Ie=(Ce??[]).map(n=>{const i=ct(n.items??[],P,xe);return{key:`catalog-${n.id}`,title:n.title,description:n.description,type:"catalog",session:{...n,items:i,cycle:P},exerciseCount:i.length}}),C=A.trim().toLowerCase(),ee=[...re,...Ie].filter(n=>C?`${n.title} ${n.description}`.toLowerCase().includes(C):!0),je=m.useMemo(()=>u?ct(u.items??[],P,xe):[],[u,P,xe]),st=n=>{if((n.items??[]).length===0){l({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}Be(n,P),H(null),D(null)},Je=n=>{const i=n.items??[],k=i.filter(Y=>Y.cycle_type===P).length>0?P:Ye(n.cycle??i.find(Y=>Y.cycle_type)?.cycle_type),O=ct(i,k,xe);if(O.length===0){l({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}T({...n,cycle:k,items:O}),_(null),H(null),D(null),y(0),$("reader")},Te=()=>{if(u){if(je.length===0){l({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}T({...u,cycle:P,items:je}),y(0),$("focus")}},v=()=>{Xs({setActiveSession:T,setActiveAssignment:_,setActiveRunId:H,setActiveRunLogs:D,setActiveRunnerStep:y,setScreenMode:$})},M=Ze({mutationFn:n=>Ne.deleteStrengthRun(n),onSuccess:n=>{v(),ie&&h.setQueryData(["strength_run_in_progress",ie],Tt(null)),h.invalidateQueries({queryKey:["strength_run_in_progress",ie]}),h.invalidateQueries({queryKey:["strength_history"]}),h.invalidateQueries({queryKey:["assignments",t,"strength"]});const i=n?.source==="local"?"Suppression locale : le serveur n'est pas disponible.":void 0;l({title:"Séance supprimée",description:i})},onError:()=>{l({title:"Erreur",description:"Impossible de supprimer la séance en cours.",variant:"destructive"})}});return e.jsx("div",{className:me("space-y-4 md:space-y-6",fe&&"dark bg-background text-foreground contrast-125",_e&&"text-lg leading-relaxed [&_.text-xs]:text-sm [&_.text-sm]:text-base"),children:E==="focus"&&u?F?e.jsx("div",{className:"animate-in fade-in motion-reduce:animate-none",children:e.jsx(Ws,{session:u,exercises:F,oneRMs:pe||[],exerciseNotes:We,onUpdateNote:(n,i)=>ze.mutate({exercise_id:n,notes:i}),initialLogs:q,initialStep:G,isFinishing:w,onStepChange:n=>y(n),onExitFocus:()=>$("reader"),onStart:async()=>{if(b)return;const n=g?.session_id??u?.id??null;if(!n){l({title:"Session manquante",description:"Impossible de démarrer sans session associée.",variant:"destructive"});return}const i={assignment_id:g?.id??null,athlete_id:s??null,athleteName:t??void 0,progress_pct:0,session_id:n,cycle_type:u?.cycle};try{const f=await ye.mutateAsync(i);f?.run_id&&H(f.run_id)}catch{return}},onLogSets:async n=>{b&&(D(i=>[...i??[],...n]),await Promise.all(n.map((i,f)=>tt.mutateAsync({run_id:b,exercise_id:i.exercise_id,set_index:i.set_number??f+1,reps:i.reps??null,weight:i.weight??null,athlete_id:s??null,athlete_name:t??null}))))},onProgress:async n=>{b&&await de.mutateAsync({run_id:b,progress_pct:n,status:"in_progress"})},onFinish:n=>{b&&(ne(!0),de.mutate({assignment_id:g?.id??void 0,run_id:b,session_id:g?.session_id??u?.id??void 0,athlete_id:s??void 0,date:new Date().toISOString(),progress_pct:100,status:"completed",...n}))}})}):e.jsxs("div",{className:"space-y-4 py-10",children:[e.jsx("div",{className:"mx-auto h-8 w-48 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"mx-auto h-4 w-32 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"space-y-3 pt-4",children:[1,2,3].map(n=>e.jsx("div",{className:"h-20 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},n))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Musculation"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(L,{variant:"ghost",size:"sm","aria-label":"Informations sur le calcul du 1RM",onClick:()=>{window.location.hash="#/records?tab=1rm"},className:"text-muted-foreground",children:[e.jsx(Xe,{className:"mr-2 h-4 w-4"})," Info 1RM"]}),e.jsx(L,{variant:"ghost",size:"icon",onClick:()=>$("settings"),className:"rounded-full border border-muted/50 text-muted-foreground","aria-label":"Paramètres",children:e.jsx(hs,{className:"h-4 w-4"})})]})]}),e.jsxs(Un,{defaultValue:"start",className:"w-full",children:[e.jsxs(Wn,{className:"grid w-full grid-cols-2",children:[e.jsx(Ut,{value:"start",children:"S'entraîner"}),e.jsx(Ut,{value:"history",children:"Historique"})]}),e.jsxs(Wt,{value:"start",className:"space-y-5 pt-4",children:[E==="list"&&be&&e.jsxs("div",{className:"space-y-5 pt-4",children:[e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3].map(n=>e.jsx("div",{className:"h-10 w-28 rounded-full bg-muted animate-pulse"},n))}),e.jsx("div",{className:"h-12 rounded-2xl bg-muted/30 animate-pulse"}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4].map(n=>e.jsx("div",{className:"rounded-2xl border bg-card p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 shrink-0 rounded-xl bg-muted animate-pulse"}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[e.jsx("div",{className:"h-4 w-3/4 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-1/2 rounded bg-muted animate-pulse"})]}),e.jsx("div",{className:"h-10 w-10 shrink-0 rounded-full bg-muted animate-pulse"})]})},n))})]}),E==="list"&&!be&&e.jsxs("div",{className:"space-y-5 animate-in fade-in motion-reduce:animate-none",children:[e.jsxs("p",{className:"text-center text-sm text-muted-foreground py-1",children:[ee.length," séance",ee.length>1?"s":""," disponible",ee.length>1?"s":""]}),e.jsx("div",{className:"flex justify-center gap-2",children:qe.map(n=>e.jsx("button",{type:"button",onClick:()=>Z(Ye(n.value)),className:me("px-5 py-2.5 rounded-full text-sm font-semibold transition-all active:scale-95",P===n.value?"bg-primary text-primary-foreground shadow-md":"bg-muted/50 text-muted-foreground hover:bg-muted"),children:n.label},n.value))}),e.jsxs("div",{className:"relative",children:[e.jsx(as,{className:"absolute left-4 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground pointer-events-none"}),e.jsx(_t,{placeholder:"Rechercher une séance...",className:"h-12 rounded-2xl bg-muted/30 pl-11 pr-4 border-0 shadow-sm focus-visible:ring-2",value:A,onChange:n=>I(n.target.value),"aria-label":"Rechercher une séance"})]}),Q&&e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border-2 border-primary/30 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-primary/10 rounded-full blur-2xl -mr-8 -mt-8"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-primary"})]}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-primary",children:ce?"Complétée":"En cours"})]}),e.jsx("h3",{className:"text-xl font-bold tracking-tight mb-1",children:we?.title??"Séance en cours"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Démarrée le ",gt(new Date(Q.started_at||new Date),"dd MMMM",{locale:xt})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs font-semibold mb-1.5",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progression"}),e.jsxs("span",{className:"text-primary",children:[Math.round(Q.progress_pct??0),"%"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-primary transition-all duration-500",style:{width:`${Q.progress_pct??0}%`}})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{className:"flex-1 h-12 rounded-xl font-semibold",disabled:!nt,onClick:()=>{const n=we??ke;if(!n)return;const i=we?.items??ke?.items??[],f=Ye(we?.cycle??ke?.cycle??i.find(Y=>Y.cycle_type)?.cycle_type),k=i.filter(Y=>Y.cycle_type===f),O=_n(k.length?k:i);_(we??null),T({...n,title:n.title,description:n.description??null,cycle:f,items:O}),H(Q.id),D(Q.logs??[]),y(Sn(O,Q.logs??[],Q.progress_pct)),$("focus")},children:ce?"Voir le résumé":"Reprendre"}),!ce&&e.jsx(L,{variant:"outline",className:"h-12 w-12 rounded-xl p-0",disabled:M.isPending,onClick:()=>{!Q||!window.confirm("Supprimer la séance en cours ?")||M.mutate(Q.id)},"aria-label":"Supprimer la séance",children:e.jsx(yt,{className:"h-5 w-5"})})]})]})]}),!Q&&ee.length>0&&e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(Xe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Choisir une séance"})]}),ee.length>0?e.jsx("div",{className:"space-y-3",children:ee.map(n=>e.jsx("button",{type:"button",className:"group w-full rounded-2xl border bg-card p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:shadow-md hover:border-primary/30",onClick:()=>{if(n.type==="assignment"){st(n.assignment);return}Je(n.session)},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:me("flex h-12 w-12 shrink-0 items-center justify-center rounded-xl",n.type==="assignment"?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"),children:e.jsx(Xe,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[n.type==="assignment"&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-primary/10 px-2 py-0.5 text-[10px] font-bold uppercase text-primary",children:"Assignée"}),n.type==="assignment"&&n.assignedDate&&e.jsx("span",{className:"text-xs text-muted-foreground",children:gt(new Date(n.assignedDate),"dd MMM",{locale:xt})})]}),e.jsx("h3",{className:"font-semibold tracking-tight truncate",children:n.title}),e.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:[n.exerciseCount," exercice",n.exerciseCount>1?"s":"",n.description?` · ${n.description}`:""]})]}),e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors group-hover:bg-primary group-hover:text-primary-foreground",children:e.jsx(Kt,{className:"h-4 w-4 ml-0.5"})})]})},n.key))}):e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-muted",children:e.jsx(Xe,{className:"h-7 w-7 text-muted-foreground"})}),e.jsx("h3",{className:"font-semibold",children:"Aucune séance"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Essayez un autre mot-clé ou changez de cycle."})]})]}),E==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(L,{variant:"ghost",size:"sm",onClick:()=>$("list"),className:"gap-2",children:[e.jsx(Yt,{className:"h-4 w-4"}),"Retour"]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Préférences"}),e.jsx("h2",{className:"text-2xl font-display font-bold uppercase text-primary",children:"Paramètres"})]})]}),e.jsxs(Ge,{className:"border border-muted/60 shadow-sm",children:[e.jsxs(Dt,{children:[e.jsx(Mt,{className:"text-lg uppercase",children:"Lisibilité & contrastes"}),e.jsx(rn,{children:"Ajuste l'écran pour rester lisible en bassin comme en extérieur."})]}),e.jsxs(At,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Mode piscine"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Contraste renforcé et lisibilité optimisée."})]}),e.jsx(Lt,{checked:fe,onCheckedChange:n=>N(i=>({...i,poolMode:n}))})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Texte grand"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Police plus large pour lire pendant l'effort."})]}),e.jsx(Lt,{checked:_e,onCheckedChange:n=>N(i=>({...i,largeText:n}))})]})]})]}),e.jsx(Ge,{className:"border border-muted/60 shadow-sm",children:e.jsxs(At,{className:"space-y-3 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsx(rs,{className:"h-4 w-4"}),e.jsx("span",{children:"Les préférences sont enregistrées sur cet appareil."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs font-semibold uppercase text-muted-foreground",children:[fe&&e.jsx(dt,{variant:"secondary",children:"Mode piscine activé"}),_e&&e.jsx(dt,{variant:"secondary",children:"Texte grand activé"}),!fe&&!_e&&e.jsx(dt,{variant:"outline",children:"Réglages par défaut"})]})]})})]}),E==="reader"&&u&&e.jsxs("div",{className:"space-y-5 animate-in fade-in motion-reduce:animate-none pb-40",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>$("list"),className:"flex h-10 w-10 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors hover:bg-muted active:scale-95","aria-label":"Retour",children:e.jsx(Yt,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground truncate",children:qe.find(n=>n.value===P)?.label}),e.jsx("h1",{className:"text-xl font-bold tracking-tight truncate",children:u.title})]})]}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border border-primary/20 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-primary/10 rounded-full blur-3xl -mr-12 -mt-12"}),e.jsxs("div",{className:"relative space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[g&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-primary/20 px-3 py-1 text-xs font-bold uppercase text-primary",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-primary"}),"Assignée"]}),!g&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:"Catalogue"}),g?.assigned_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Prévue le ",gt(new Date(g.assigned_date),"dd MMM",{locale:xt})]})]}),u.description&&e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:u.description}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(Xe,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:je.length}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Exercices"})]})]}),e.jsx("div",{className:"h-8 w-px bg-border"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(os,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:qe.find(n=>n.value===P)?.label}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Cycle"})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-1",children:[e.jsxs("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:[je.length," exercice",je.length>1?"s":""]}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsxs("div",{className:"space-y-2",children:[je.map((n,i)=>{const f=xe.get(n.exercise_id),k=Number(n.percent_1rm),O=Number.isFinite(k)&&k>0,Y=O?pe?.find(ft=>ft.exercise_id===n.exercise_id)?.weight??0:0,oe=O?Math.round(Y*(k/100)):0,ge=O?oe>0?`${oe} kg (${k}% 1RM)`:`${k}% 1RM`:null,ve=n.notes?.trim(),ue=nn(n.sets),Oe=nn(n.reps),Ve=Qs(n.rest_seconds);return e.jsxs(It,{children:[e.jsx(Hn,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-3 rounded-xl border bg-card px-3 py-3 text-left transition-all active:scale-[0.98] hover:border-primary/50 hover:shadow-sm",children:[e.jsx("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-primary text-xs font-bold text-primary-foreground",children:i+1}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"font-semibold text-sm truncate",children:f?.nom_exercice??n.exercise_name??"Exercice"})}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 text-xs font-medium text-muted-foreground",children:[e.jsxs("span",{className:"font-mono",children:[ue,"×",Oe]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("span",{className:"font-mono",children:Ve}),e.jsx(Ft,{className:"h-4 w-4 text-muted-foreground/50"})]})]})}),e.jsxs(Ot,{side:"bottom",className:"max-h-[90vh] overflow-y-auto rounded-t-3xl pb-8",children:[e.jsx($t,{className:"text-left pb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-primary text-sm font-bold text-primary-foreground",children:i+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(Pt,{className:"text-xl leading-tight",children:f?.nom_exercice??n.exercise_name??"Exercice"}),f?.exercise_type&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:f.exercise_type})]})]})}),e.jsxs("div",{className:"space-y-4",children:[f?.illustration_gif&&e.jsx("div",{className:"rounded-xl overflow-hidden bg-muted/20 border aspect-video flex items-center justify-center",children:e.jsx("img",{src:f.illustration_gif,alt:f.nom_exercice??"Exercice",className:"w-full h-full max-h-36 object-contain",loading:"lazy",decoding:"async"})}),f?.description&&e.jsx("div",{className:"text-sm text-muted-foreground leading-relaxed",children:f.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:ue}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Séries"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:Oe}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Reps"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:ge??"—"}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Charge"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:Ve}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Repos"})]})]}),ve&&e.jsxs("div",{className:"rounded-xl bg-primary/5 border border-primary/20 p-4",children:[e.jsx("div",{className:"text-[10px] uppercase text-primary font-semibold mb-1",children:"Notes coach"}),e.jsx("div",{className:"text-sm text-foreground",children:ve})]})]})]})]},`${n.exercise_id}-${i}`)}),je.length===0&&e.jsx("div",{className:"p-6 border-2 border-dashed rounded-xl text-center text-muted-foreground",children:"Aucun exercice disponible pour cette séance."})]}),e.jsx(Nn,{children:e.jsxs(L,{className:"flex-1 h-14 rounded-xl font-bold text-base bg-primary hover:bg-primary/90 shadow-lg",onClick:Te,children:[e.jsx(Kt,{className:"h-5 w-5 mr-2"}),"Lancer la séance"]})})]})]}),e.jsxs(Wt,{value:"history",className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(et,{htmlFor:"strength-history-status",children:"Statut"}),e.jsxs(zn,{value:z,onValueChange:p,children:[e.jsx(Bn,{id:"strength-history-status",children:e.jsx(qn,{placeholder:"Tous"})}),e.jsxs(Vn,{children:[e.jsx(ht,{value:"all",children:"Tous"}),e.jsx(ht,{value:"in_progress",children:"En cours"}),e.jsx(ht,{value:"completed",children:"Terminé"}),e.jsx(ht,{value:"abandoned",children:"Abandonné"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(et,{htmlFor:"strength-history-from",children:"Du"}),e.jsx(_t,{id:"strength-history-from",type:"date",value:V,onChange:n=>W(n.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(et,{htmlFor:"strength-history-to",children:"Au"}),e.jsx(_t,{id:"strength-history-to",type:"date",value:J,onChange:n=>B(n.target.value)})]})]}),S.map(n=>e.jsx(Ge,{className:"group hover:border-primary/50 transition-colors",children:e.jsxs(Dt,{className:"pb-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Mt,{className:"text-base font-bold uppercase",children:gt(new Date(n.started_at||n.date||n.created_at||new Date),"dd MMM yyyy",{locale:xt})}),e.jsxs("div",{className:"text-sm font-mono font-bold text-muted-foreground group-hover:text-primary",children:[n.duration??0," min"]})]}),e.jsxs("div",{className:"flex gap-2 text-xs font-bold text-muted-foreground",children:[e.jsxs("span",{children:["Difficulté ",n.feeling??n.rpe??0,"/5"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[n.logs?.length||0," Séries"]})]})]})},n.id)),S.length===0&&e.jsx("div",{className:"text-center text-muted-foreground py-10",children:"Aucun historique."}),Re.hasNextPage&&e.jsx(L,{variant:"outline",size:"sm",className:"w-full",onClick:()=>Re.fetchNextPage(),disabled:Re.isFetchingNextPage,children:Re.isFetchingNextPage?"Chargement...":"Charger plus"})]})]})]})})}export{Tt as buildInProgressRunCache,Gs as createInProgressRun,br as default,_n as orderStrengthItems,Xs as resetStrengthRunState};
