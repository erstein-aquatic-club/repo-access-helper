import{r as d,j as e}from"./vendor-ui-C9ymspZo.js";import{b as L,u as E,c as M}from"./vendor-query-kM2vrB_e.js";import{u as T,a as B,i as I,B as j,C as R,f as _,g as N}from"./index-w265yi4m.js";import{B as c}from"./badge-BCwtPf2O.js";import{c as q,a as D,L as $,b as z,S as F}from"./SwimSessionConsultation-BO07B5C-.js";import{S as Q,a as H,b as K,c as O}from"./sheet-Dx4QP8sE.js";import{C as P}from"./chevron-left-CoDb6eqo.js";import{f as U}from"./vendor-date-cQbdWov0.js";import{f as V}from"./fr-CqUxEDd2.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-DSuxWnoS.js";import"./vendor-supabase-B2MyMyC0.js";import"./timer-Dc8NpcZ0.js";const G={assigned:"Assignée",pending:"Assignée",in_progress:"En cours",completed:"Terminée",cancelled:"Annulée"},J=a=>{if(!a)return"-";const l=new Date(a);return Number.isNaN(l.getTime())?a:U(l,"dd MMM",{locale:V})};function de(){const{user:a,userId:l}=T(),[m,u]=B(),[i,x]=d.useState(!0),[s,p]=d.useState(null),{toast:f}=I(),y=L(),g=d.useMemo(()=>{const[,t]=m.split("?");if(!t)return null;const r=new URLSearchParams(t).get("assignmentId"),o=r?Number(r):NaN;return Number.isFinite(o)?o:null},[m]),{data:v,isLoading:w}=E({queryKey:["assignments",a],queryFn:()=>N.getAssignments(a,l),enabled:!!a}),h=v?.filter(t=>t.session_type==="swim")||[],n=g?h.find(t=>t.id===g):h[0],S=q(n?.items??[]),C=d.useMemo(()=>{if(!n?.items)return 0;const t=new Set;return n.items.forEach(b=>{const r=b.raw_payload??{},o=r.block_title||r.section||"Bloc",A=r.block_order??0;t.add(`${A}-${o}`)}),t.size},[n?.items]),k=M({mutationFn:t=>N.assignments_delete(t),onSuccess:()=>{y.invalidateQueries({queryKey:["assignments"]}),f({title:"Séance retirée",description:"La séance a été retirée de votre feed."}),u("/")},onError:()=>{f({title:"Erreur",description:"Impossible de retirer la séance.",variant:"destructive"})}});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>u("/"),"aria-label":"Retour à l'accueil",children:e.jsx(P,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.2em] text-muted-foreground",children:"Séance natation"}),e.jsx("h1",{className:"text-2xl font-display font-bold uppercase",children:"Lecture"})]})]}),n?e.jsx(c,{variant:"secondary",className:"text-xs",children:G[n.status]??"Assignée"}):null]}),e.jsx(R,{className:"border border-border shadow-sm",children:e.jsxs(_,{className:"space-y-4 p-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-lg font-semibold tracking-tight",children:n?.title??"Séance natation"}),n?.description?e.jsx("p",{className:"text-sm text-muted-foreground",children:n.description}):null]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(c,{variant:"outline",className:"text-xs",children:J(n?.assigned_date)}),e.jsxs(c,{variant:"secondary",className:"text-xs",children:[e.jsx(D,{className:"mr-1 h-3.5 w-3.5"})," ",S,"m"]}),e.jsxs(c,{variant:"secondary",className:"text-xs",children:[e.jsx($,{className:"mr-1 h-3.5 w-3.5"})," ",C," blocs"]})]}),n?e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>{window.confirm("Retirer cette séance de votre feed ?")&&k.mutate(n.id)},className:"text-xs text-muted-foreground hover:text-foreground",children:"Retirer de mon feed"}):null,e.jsxs("div",{className:"flex items-center rounded-full border border-border bg-muted p-1 text-xs font-semibold",children:[e.jsx("button",{type:"button","aria-pressed":i,onClick:()=>x(!0),className:`rounded-full px-3 py-1 transition ${i?"bg-primary text-primary-foreground shadow-sm":"text-muted-foreground"}`,children:"Condensé"}),e.jsx("button",{type:"button","aria-pressed":!i,onClick:()=>x(!1),className:`rounded-full px-3 py-1 transition ${i?"text-muted-foreground":"bg-primary text-primary-foreground shadow-sm"}`,children:"Détail"})]})]}),e.jsx(z,{}),w?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Chargement de la séance..."}):n?e.jsx(F,{title:n.title,description:n.description,items:n.items,showHeader:!1,compactMode:i,onExerciseSelect:t=>{p(t)}}):e.jsx("div",{className:"rounded-2xl border border-dashed border-muted/70 bg-muted/30 p-6 text-sm text-muted-foreground",children:"Aucune séance de natation assignée pour le moment."})]})}),e.jsx(Q,{open:!!s,onOpenChange:t=>{t||p(null)},children:e.jsxs(H,{side:"bottom",className:"max-h-[80vh] overflow-y-auto",children:[e.jsx(K,{children:e.jsx(O,{children:"Détails de l'exercice"})}),s?e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-muted-foreground",children:s.blockTitle&&s.blockIndex!==void 0?`Bloc ${s.blockIndex+1}`:"Bloc"}),e.jsx("p",{className:"text-lg font-semibold",children:s.label})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:[s.repetitions?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:[s.repetitions,"x"]}):null,s.distance?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:[s.distance,"m"]}):null,s.rest?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:["Récup ",s.rest,"s"]}):null,s.stroke?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:["Nage : ",s.stroke]}):null,s.strokeType?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:["Type : ",s.strokeType]}):null,s.intensity?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:["Intensité : ",s.intensity]}):null]}),s.modalities?e.jsx("div",{className:"rounded-2xl border bg-muted/10 p-3 text-sm text-muted-foreground",children:s.modalities}):null,s.equipment?.length?e.jsx("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:s.equipment.map(t=>e.jsx("span",{className:"rounded-full border px-2 py-1",children:t},t))}):null]}):null]})})]})}export{de as default};
