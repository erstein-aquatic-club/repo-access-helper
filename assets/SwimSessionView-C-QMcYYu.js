import{r as d,j as e}from"./vendor-ui-C9ymspZo.js";import{b as T,u as B,c as I}from"./vendor-query-kM2vrB_e.js";import{u as R,a as _,j as q,B as x,C as D,g as $,h as v}from"./index-Ckx1yfUE.js";import{B as m}from"./badge-BMs32RqT.js";import{c as z,a as F,L as Q,b as H,S as K}from"./SwimSessionConsultation-C9gD1r3z.js";import{S as O,a as P,b as U,c as V}from"./sheet-Cz8aWamU.js";import{S as u}from"./skeleton-CZirY6KC.js";import{C as G}from"./circle-alert-CAD55kto.js";import{C as J}from"./chevron-left-CwzB7EZ_.js";import{f as W}from"./vendor-date-cQbdWov0.js";import{f as X}from"./fr-CqUxEDd2.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-DSuxWnoS.js";import"./vendor-supabase-B2MyMyC0.js";import"./timer-BfdpVelL.js";const Y={assigned:"Assignée",pending:"Assignée",in_progress:"En cours",completed:"Terminée",cancelled:"Annulée"},Z=n=>{if(!n)return"-";const l=new Date(n);return Number.isNaN(l.getTime())?n:W(l,"dd MMM",{locale:X})};function fe(){const{user:n,userId:l}=R(),[p,f]=_(),[i,h]=d.useState(!0),[s,g]=d.useState(null),{toast:j}=q(),w=T(),N=d.useMemo(()=>{const[,t]=p.split("?");if(!t)return null;const r=new URLSearchParams(t).get("assignmentId"),c=r?Number(r):NaN;return Number.isFinite(c)?c:null},[p]),{data:S,isLoading:C,error:b,refetch:k}=B({queryKey:["assignments",n],queryFn:()=>v.getAssignments(n,l),enabled:!!n}),y=S?.filter(t=>t.session_type==="swim")||[],a=N?y.find(t=>t.id===N):y[0],A=z(a?.items??[]),L=d.useMemo(()=>{if(!a?.items)return 0;const t=new Set;return a.items.forEach(o=>{const r=o.raw_payload??{},c=r.block_title||r.section||"Bloc",M=r.block_order??0;t.add(`${M}-${c}`)}),t.size},[a?.items]),E=I({mutationFn:t=>v.assignments_delete(t),onSuccess:()=>{w.invalidateQueries({queryKey:["assignments"]}),j({title:"Séance retirée",description:"La séance a été retirée de votre feed."}),f("/")},onError:()=>{j({title:"Erreur",description:"Impossible de retirer la séance.",variant:"destructive"})}});return b?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(G,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:b.message}),e.jsx(x,{onClick:()=>k(),className:"mt-4",children:"Réessayer"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>f("/"),"aria-label":"Retour à l'accueil",children:e.jsx(J,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.2em] text-muted-foreground",children:"Séance natation"}),e.jsx("h1",{className:"text-2xl font-display font-bold uppercase",children:"Lecture"})]})]}),a?e.jsx(m,{variant:"secondary",className:"text-xs",children:Y[a.status]??"Assignée"}):null]}),e.jsx(D,{className:"border border-border shadow-sm",children:e.jsxs($,{className:"space-y-4 p-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-lg font-semibold tracking-tight",children:a?.title??"Séance natation"}),a?.description?e.jsx("p",{className:"text-sm text-muted-foreground",children:a.description}):null]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(m,{variant:"outline",className:"text-xs",children:Z(a?.assigned_date)}),e.jsxs(m,{variant:"secondary",className:"text-xs",children:[e.jsx(F,{className:"mr-1 h-3.5 w-3.5"})," ",A,"m"]}),e.jsxs(m,{variant:"secondary",className:"text-xs",children:[e.jsx(Q,{className:"mr-1 h-3.5 w-3.5"})," ",L," blocs"]})]}),a?e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>{window.confirm("Retirer cette séance de votre feed ?")&&E.mutate(a.id)},className:"text-xs text-muted-foreground hover:text-foreground",children:"Retirer de mon feed"}):null,e.jsxs("div",{className:"flex items-center rounded-full border border-border bg-muted p-1 text-xs font-semibold",children:[e.jsx("button",{type:"button","aria-pressed":i,onClick:()=>h(!0),className:`rounded-full px-3 py-1 transition ${i?"bg-primary text-primary-foreground shadow-sm":"text-muted-foreground"}`,children:"Condensé"}),e.jsx("button",{type:"button","aria-pressed":!i,onClick:()=>h(!1),className:`rounded-full px-3 py-1 transition ${i?"text-muted-foreground":"bg-primary text-primary-foreground shadow-sm"}`,children:"Détail"})]})]}),e.jsx(H,{}),C?e.jsxs("div",{className:"space-y-4","aria-live":"polite","aria-busy":"true",children:[e.jsx("div",{className:"sr-only",children:"Chargement de la séance..."}),e.jsx(u,{className:"h-6 w-48"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((t,o)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{className:"h-5 w-32"}),e.jsx(u,{className:"h-4 w-full"}),e.jsx(u,{className:"h-4 w-3/4"})]},`skeleton-${o}`))})]}):a?e.jsx(K,{title:a.title,description:a.description,items:a.items,showHeader:!1,compactMode:i,onExerciseSelect:t=>{g(t)}}):e.jsx("div",{className:"rounded-2xl border border-dashed border-muted/70 bg-muted/30 p-6 text-sm text-muted-foreground",children:"Aucune séance de natation assignée pour le moment."})]})}),e.jsx(O,{open:!!s,onOpenChange:t=>{t||g(null)},children:e.jsxs(P,{side:"bottom",className:"max-h-[80vh] overflow-y-auto",children:[e.jsx(U,{children:e.jsx(V,{children:"Détails de l'exercice"})}),s?e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-muted-foreground",children:s.blockTitle&&s.blockIndex!==void 0?`Bloc ${s.blockIndex+1}`:"Bloc"}),e.jsx("p",{className:"text-lg font-semibold",children:s.label})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:[s.repetitions?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:[s.repetitions,"x"]}):null,s.distance?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:[s.distance,"m"]}):null,s.rest?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:["Récup ",s.rest,"s"]}):null,s.stroke?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:["Nage : ",s.stroke]}):null,s.strokeType?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:["Type : ",s.strokeType]}):null,s.intensity?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:["Intensité : ",s.intensity]}):null]}),s.modalities?e.jsx("div",{className:"rounded-2xl border bg-muted/10 p-3 text-sm text-muted-foreground",children:s.modalities}):null,s.equipment?.length?e.jsx("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:s.equipment.map(t=>e.jsx("span",{className:"rounded-full border px-2 py-1",children:t},t))}):null]}):null]})})]})}export{fe as default};
