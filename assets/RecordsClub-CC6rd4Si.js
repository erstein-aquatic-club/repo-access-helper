import{r as i,j as e}from"./vendor-ui-CDk0TPZB.js";import{u as F}from"./vendor-query-BoCJU2ZS.js";import{C as S,b as w,c as D,f as R,B as I,g as A}from"./index-EzLKQy56.js";import{B as g}from"./badge-D6cHawzI.js";import{S as h,a as j,b as f,c as k,d as y}from"./select-DXDhv7b9.js";import{T as K,a as $,b as Y}from"./tabs-BQgHogz0.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-Cxv39Zhq.js";import"./vendor-supabase-CgI36rMY.js";import"./check-lTi3Xmhc.js";const V=[{key:"M",label:"Garçons"},{key:"F",label:"Filles"}],P=[{key:"25",label:"25 m"},{key:"50",label:"50 m"}],q=[{key:"8",label:"8 ans et -"},{key:"9",label:"9 ans"},{key:"10",label:"10 ans"},{key:"11",label:"11 ans"},{key:"12",label:"12 ans"},{key:"13",label:"13 ans"},{key:"14",label:"14 ans"},{key:"15",label:"15 ans"},{key:"16",label:"16 ans"},{key:"17",label:"17 ans et +"}],G=[{key:"ALL",label:"Toutes catégories"},...q],O=[{key:"ALL",label:"Toutes"},{key:"FREE",label:"Nage libre"},{key:"BACK",label:"Dos"},{key:"BREAST",label:"Brasse"},{key:"FLY",label:"Papillon"},{key:"IM",label:"4 nages"}],B=[{id:"50_FREE",label:"50 m NL",stroke:"FREE"},{id:"100_FREE",label:"100 m NL",stroke:"FREE"},{id:"200_FREE",label:"200 m NL",stroke:"FREE"},{id:"400_FREE",label:"400 m NL",stroke:"FREE"},{id:"800_FREE",label:"800 m NL",stroke:"FREE"},{id:"1500_FREE",label:"1500 m NL",stroke:"FREE"},{id:"50_BACK",label:"50 m Dos",stroke:"BACK"},{id:"100_BACK",label:"100 m Dos",stroke:"BACK"},{id:"200_BACK",label:"200 m Dos",stroke:"BACK"},{id:"50_BREAST",label:"50 m Brasse",stroke:"BREAST"},{id:"100_BREAST",label:"100 m Brasse",stroke:"BREAST"},{id:"200_BREAST",label:"200 m Brasse",stroke:"BREAST"},{id:"50_FLY",label:"50 m Pap",stroke:"FLY"},{id:"100_FLY",label:"100 m Pap",stroke:"FLY"},{id:"200_FLY",label:"200 m Pap",stroke:"FLY"},{id:"200_IM",label:"200 m 4N",stroke:"IM"},{id:"400_IM",label:"400 m 4N",stroke:"IM"}],z=a=>{if(!a&&a!==0)return"-";const t=Math.round(a/10),o=t%100,d=Math.floor(t/100),n=d%60,m=Math.floor(d/60),l=x=>String(x).padStart(2,"0");return m>0?`${m}:${l(n)}.${l(o)}`:`${n}.${l(o)}`},H=a=>{if(!a)return"-";const t=new Date(a);return Number.isNaN(t.getTime())?a:t.toLocaleDateString("fr-FR")},Q=a=>a.replace(/^\d+_/,""),U=(a,t)=>a.event_label||t.get(a.event_code)||a.event_code,X=a=>{if(!a)return null;const t=new Date(a);return Number.isNaN(t.getTime())?null:t.toLocaleDateString("fr-FR")+" à "+t.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})};function ie(){const[a,t]=i.useState("25"),[o,d]=i.useState("M"),[n,m]=i.useState("ALL"),[l,x]=i.useState("ALL"),C=n==="ALL"?null:Number(n),{data:c}=F({queryKey:["last-import"],queryFn:()=>A.getImportLogs({limit:1})}),{data:b=[],isLoading:E,error:N,refetch:T}=F({queryKey:["club-records",a,o,n],queryFn:()=>A.getClubRecords({pool_m:Number(a),sex:o,age:C})}),M=i.useMemo(()=>new Map(B.map(s=>[s.id,s.label])),[]),p=i.useMemo(()=>new Map(B.map((s,r)=>[s.id,r])),[]),v=i.useMemo(()=>[...l==="ALL"?b:b.filter(r=>Q(r.event_code)===l)].sort((r,u)=>{const _=p.get(r.event_code)??999,L=p.get(u.event_code)??999;return _!==L?_-L:r.age!==u.age?r.age-u.age:r.time_ms-u.time_ms}),[b,l,p]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Records du club"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Retrouvez les meilleures performances par épreuve, sexe, bassin et catégorie d'âge."}),c&&c.length>0&&c[0].status==="success"&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Dernière mise à jour : ",X(c[0].completed_at??c[0].started_at)??"-"]})]}),e.jsxs(S,{children:[e.jsx(w,{children:e.jsx(D,{className:"text-base",children:"Filtres rapides"})}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-3 sm:grid-cols-3",children:[e.jsxs(h,{value:a,onValueChange:t,children:[e.jsx(j,{children:e.jsx(f,{placeholder:"Bassin"})}),e.jsx(k,{children:P.map(s=>e.jsx(y,{value:s.key,children:s.label},s.key))})]}),e.jsxs(h,{value:o,onValueChange:d,children:[e.jsx(j,{children:e.jsx(f,{placeholder:"Sexe"})}),e.jsx(k,{children:V.map(s=>e.jsx(y,{value:s.key,children:s.label},s.key))})]}),e.jsxs(h,{value:n,onValueChange:m,children:[e.jsx(j,{children:e.jsx(f,{placeholder:"Catégorie d'âge"})}),e.jsx(k,{children:G.map(s=>e.jsx(y,{value:s.key,children:s.label},s.key))})]})]}),e.jsx(K,{value:l,onValueChange:x,children:e.jsx($,{className:"flex w-full justify-start gap-2 overflow-x-auto",children:O.map(s=>e.jsx(Y,{value:s.key,className:"shrink-0",children:s.label},s.key))})})]})]}),e.jsxs("div",{className:"space-y-3",children:[E&&e.jsx("div",{className:"space-y-3",children:[1,2,3].map(s=>e.jsx("div",{className:"h-24 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},s))}),N&&e.jsxs("div",{className:"rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:[e.jsx("p",{children:"Impossible de charger les records."}),e.jsx(I,{variant:"outline",size:"sm",className:"mt-2",onClick:()=>T(),children:"Réessayer"})]}),!E&&!N&&v.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground",children:"Aucun record disponible pour ces filtres."}),v.map(s=>e.jsx(S,{className:"shadow-sm",children:e.jsxs(R,{className:"flex flex-col gap-3 py-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:U(s,M)}),e.jsx("div",{className:"text-2xl font-semibold text-primary",children:z(s.time_ms)})]}),e.jsxs("div",{className:"text-sm text-muted-foreground sm:text-right",children:[e.jsx("div",{className:"font-semibold text-foreground",children:s.athlete_name}),e.jsx("div",{children:H(s.record_date)})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(g,{variant:"secondary",children:s.sex==="M"?"Garçons":"Filles"}),e.jsxs(g,{variant:"outline",children:[s.pool_m," m"]}),e.jsxs(g,{variant:"outline",children:[s.age," ans"]})]})]})},`${s.event_code}-${s.age}-${s.sex}-${s.pool_m}`))]})]})}export{ie as default};
