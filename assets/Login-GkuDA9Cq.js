import{r as t,j as e}from"./vendor-ui-C9ymspZo.js";import{u as Q,a as fe,C as je,b as ve,e as be,c as ye,d as Ne,f as we,L as o,I as c,B as m,s as v,g as Se}from"./index-C8VOHyWq.js";import{u as Ce}from"./vendor-query-kM2vrB_e.js";import{D as W,a as X,b as J,c as Y,d as Z}from"./dialog-BgN4G3vA.js";import{S as $,a as ee,b as se,c as te,d as D}from"./select-C0-NW1no.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-DSuxWnoS.js";import"./vendor-supabase-B2MyMyC0.js";import"./chevron-up-BS7HXulj.js";import"./check-PdRdi0Pf.js";const Ee=i=>i,Re=i=>{switch(i){case"coach":return"/coach";case"admin":return"/admin";case"comite":return"/comite";default:return"/"}};function qe(){const[i,re]=t.useState(""),[x,ae]=t.useState(""),[L,b]=t.useState(null),[k,A]=t.useState(!1),[l,h]=t.useState(!1),[p,ie]=t.useState(""),[y,P]=t.useState(""),[N,M]=t.useState(""),[w,T]=t.useState(""),[d,S]=t.useState(""),[C,V]=t.useState(""),[q,r]=t.useState(null),[O,E]=t.useState(!1),[ne,R]=t.useState(!1),[oe,g]=t.useState(!1),[F,f]=t.useState(""),[le,z]=t.useState(!1),[U,G]=t.useState(!1),[B,I]=t.useState(null),{loginFromSession:ce,loadUser:de}=Q(),[,ue]=fe(),H=t.useRef(null),_=t.useRef(null),{data:u=[],isLoading:K,isError:me}=Ce({queryKey:["register-groups"],queryFn:()=>Se.getGroups(),enabled:l,retry:2});t.useEffect(()=>{l&&!d&&u.length>0&&S(String(u[0].id))},[u,d,l]),t.useEffect(()=>{Ee(l)&&_.current?.focus()},[l]);const xe=s=>s.includes("Invalid login")?"Identifiant ou mot de passe incorrect.":s.includes("Email not confirmed")?"Veuillez confirmer votre email avant de vous connecter.":s,he=async s=>{s.preventDefault();const n=i.trim();if(n){if(!x.trim()){b("Mot de passe requis."),H.current?.focus();return}A(!0),b(null);try{const{data:a,error:j}=await v.auth.signInWithPassword({email:n,password:x});if(j)throw new Error(xe(j.message));if(!a.session)throw new Error("Session non reçue.");if(ce(a.session),!await de())throw new Error("Impossible de récupérer le profil utilisateur.");const ge=Q.getState().role;ue(Re(ge),{replace:!0})}catch(a){const j=a instanceof Error?a.message:"Connexion impossible.";b(j)}finally{A(!1)}}},pe=async()=>{G(!0),I(null);try{const{error:s}=await v.auth.resetPasswordForEmail(F,{redirectTo:window.location.origin+"/competition/#/reset-password"});if(s)throw s;z(!0)}catch(s){const n=s instanceof Error?s.message:"Erreur lors de l'envoi";I(n)}finally{G(!1)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-[-20%] right-[-10%] w-[600px] h-[600px] bg-primary/10 rounded-full blur-3xl pointer-events-none"}),e.jsxs(je,{className:"w-full max-w-sm relative z-10 shadow-2xl border-t-8 border-t-primary animate-in fade-in zoom-in duration-500 motion-reduce:animate-none",children:[e.jsxs(ve,{className:"text-center pb-2",children:[e.jsx("div",{className:"mx-auto mb-6 h-24 w-24 rounded-full bg-foreground flex items-center justify-center border-4 border-primary shadow-lg",children:e.jsx("img",{src:be,alt:"EAC Logo",loading:"lazy",className:"h-full w-full object-cover rounded-full opacity-90"})}),e.jsxs(ye,{className:"text-3xl font-display italic uppercase tracking-tighter",children:["SUIVI",e.jsx("span",{className:"text-primary",children:"NATATION"})]}),e.jsx(Ne,{className:"uppercase tracking-widest text-xs font-bold",children:"Erstein Aquatic Club"})]}),e.jsx(we,{children:e.jsxs("form",{onSubmit:he,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"login-email",className:"sr-only",children:"Email"}),e.jsx(c,{id:"login-email","aria-label":"Email",placeholder:"Email",type:"email",value:i,onChange:s=>{re(s.target.value),l&&h(!1)},className:"text-center text-lg h-12 border-2 focus-visible:ring-primary",autoFocus:!0}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Saisissez votre email et votre mot de passe."}),e.jsx(o,{htmlFor:"login-password",className:"sr-only",children:"Mot de passe"}),e.jsx(c,{id:"login-password","aria-label":"Mot de passe",placeholder:"Mot de passe",type:"password",value:x,onChange:s=>ae(s.target.value),ref:H,className:"text-center text-lg h-12 border-2 focus-visible:ring-primary"}),L?e.jsx("div",{className:"rounded-lg border border-destructive/20 bg-destructive/10 p-3 text-sm text-destructive text-center",children:L}):null]}),e.jsx(m,{type:"submit",className:"w-full h-12 text-lg font-bold uppercase tracking-wider shadow-md hover:scale-[1.02] transition-transform",disabled:!i.trim()||!x.trim()||k,children:k?"Connexion...":"CONNEXION"}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{h(!0);const s=i.trim();P(s)},className:"text-xs text-muted-foreground underline underline-offset-4 transition-colors hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2",children:"Créer un compte"}),e.jsx("button",{type:"button",className:"text-xs text-muted-foreground hover:text-primary underline",onClick:()=>{g(!0),f(i.trim())},children:"Mot de passe oublié ?"})]})]})})]}),e.jsx(W,{open:l,onOpenChange:s=>{h(s),s||(r(null),M(""),T(""),S(""),V(""),R(!1))},children:e.jsx(X,{className:"sm:max-w-md",children:ne?e.jsxs("div",{className:"text-center space-y-4 py-4",children:[e.jsx("div",{className:"mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-muted",children:e.jsx("span",{className:"text-3xl text-primary",children:"✓"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Compte créé avec succès !"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Un coach ou un administrateur doit valider votre inscription avant votre première connexion."}),e.jsx(m,{className:"w-full",variant:"outline",onClick:()=>{R(!1),h(!1)},children:"Retour à la connexion"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(J,{children:[e.jsx(Y,{children:"Créer un compte"}),e.jsx(Z,{children:"Complétez les informations pour créer votre profil."})]}),e.jsxs("form",{className:"space-y-4",onSubmit:async s=>{if(s.preventDefault(),!p.trim()){r("Ajoutez votre nom.");return}if(!y.trim()){r("Ajoutez votre email.");return}if(!d){r("Sélectionnez un groupe.");return}if(!C){r("Sélectionnez votre sexe.");return}if(!w){r("Ajoutez votre date de naissance.");return}if(!N){r("Choisissez un mot de passe.");return}r(null),E(!0);try{const{data:n,error:a}=await v.auth.signUp({email:y.trim(),password:N,options:{data:{display_name:p.trim(),birthdate:w,group_id:Number(d),sex:C}}});if(a)throw new Error(a.message);if(n.user){await v.auth.signOut(),R(!0),E(!1);return}r("Création impossible.")}catch(n){const a=n instanceof Error?n.message:"Création impossible.";r(a)}finally{E(!1)}},children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"register-name",children:"Nom d'affichage"}),e.jsx(c,{id:"register-name",value:p,onChange:s=>ie(s.target.value),placeholder:"Votre nom",ref:_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"register-email",children:"Email"}),e.jsx(c,{id:"register-email",type:"email",value:y,onChange:s=>P(s.target.value),placeholder:"prenom.nom@email.com",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"register-birthdate",children:"Date de naissance"}),e.jsx(c,{id:"register-birthdate",type:"date",value:w,onChange:s=>T(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"register-sex",children:"Sexe"}),e.jsxs($,{value:C,onValueChange:V,children:[e.jsx(ee,{id:"register-sex",children:e.jsx(se,{placeholder:"Sélectionnez"})}),e.jsxs(te,{children:[e.jsx(D,{value:"M",children:"Garçon"}),e.jsx(D,{value:"F",children:"Fille"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"register-group",children:"Groupe"}),e.jsxs($,{value:d,onValueChange:S,disabled:K||u.length===0,children:[e.jsx(ee,{id:"register-group",children:e.jsx(se,{placeholder:K?"Chargement...":me?"Erreur de chargement":"Sélectionnez un groupe"})}),e.jsx(te,{children:u.map(s=>e.jsx(D,{value:String(s.id),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"register-password",children:"Mot de passe"}),e.jsx(c,{id:"register-password",type:"password",value:N,onChange:s=>M(s.target.value),placeholder:"Choisissez un mot de passe"})]}),q?e.jsx("p",{className:"text-sm text-destructive",children:q}):null,e.jsx(m,{type:"submit",className:"w-full",disabled:O||!p.trim(),children:O?"Création...":"Créer le compte"})]})]})})}),e.jsx(W,{open:oe,onOpenChange:s=>{g(s),s||(I(null),z(!1),f(""))},children:e.jsx(X,{className:"sm:max-w-md",children:le?e.jsxs("div",{className:"text-center space-y-4 py-4",children:[e.jsx("div",{className:"mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-muted",children:e.jsx("span",{className:"text-3xl text-primary",children:"✉"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Email envoyé"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Un email de réinitialisation a été envoyé. Vérifiez votre boîte de réception."}),e.jsx(m,{className:"w-full",variant:"outline",onClick:()=>{g(!1),z(!1),f("")},children:"Retour à la connexion"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(J,{children:[e.jsx(Y,{children:"Réinitialiser le mot de passe"}),e.jsx(Z,{children:"Entrez votre adresse email pour recevoir un lien de réinitialisation."})]}),e.jsxs("form",{className:"space-y-4",onSubmit:s=>{s.preventDefault(),pe()},children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"reset-email",children:"Email"}),e.jsx(c,{id:"reset-email",type:"email",value:F,onChange:s=>f(s.target.value),placeholder:"votre@email.com",required:!0,autoFocus:!0})]}),B?e.jsx("div",{className:"rounded-lg border border-destructive/20 bg-destructive/10 p-3 text-sm text-destructive text-center",children:B}):null,e.jsx(m,{type:"submit",className:"w-full",disabled:!F.trim()||U,children:U?"Envoi...":"Envoyer le lien"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",className:"text-xs text-muted-foreground hover:text-primary underline",onClick:()=>g(!1),children:"Retour à la connexion"})})]})]})})}),e.jsx("div",{className:"absolute bottom-4 text-xs text-muted-foreground opacity-50 uppercase font-bold tracking-widest",children:"EAC Performance Tracking"})]})}export{qe as default};
