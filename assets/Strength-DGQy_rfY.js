import{j as e,r as n}from"./vendor-ui-M0btmmZ9.js";import{b as As,u as he,c as De,d as st}from"./vendor-query-CwV3kFk7.js";import{c as ms,a as fe,f as xs,D as Fe,B as _,C as pe,h as He,j as hs,l as Ds,g as Ke,L as _e,q as tt,X as Ve,r as rt,d as W,I as as,u as nt,S as X}from"./index-BmBHIWp1.js";import{S as is}from"./switch-BLbBHwxt.js";import{T as at,a as it,b as _s,c as ks}from"./tabs-BbooNa54.js";import{B as Te}from"./badge-B_AYIksw.js";import{D as lt,a as ct,b as ot,c as dt,d as ut}from"./drawer-CSC7sRqX.js";import{S as ls,a as cs,b as os,c as ds,d as mt}from"./sheet-BakMD7l5.js";import{A as Ts,a as Fs,b as Ps,c as Ls,d as qs,e as $s,f as zs,g as Os,P as xt}from"./alert-dialog-DwvkuaVn.js";import{B as Ks,I as ht}from"./BottomActionBar-13nCrOuz.js";import{c as Ie}from"./design-tokens-CKgCpdH6.js";import{L as pt}from"./loader-circle-DQrq74JH.js";import{C as ft}from"./circle-check-CXOeL0f5.js";import{S as gt}from"./sticky-note-C57h9i2e.js";import{C as Cs}from"./check-M8PeXL4A.js";import{T as bt}from"./timer-DK1fWMNb.js";import{C as Be}from"./chevron-right-CIS1ZE4o.js";import{s as yt,l as jt,f as vt}from"./animations-CrcLFysI.js";import{S as Nt}from"./search-BLfG7ZBY.js";import{f as Ge}from"./fr-W-h3q7wd.js";import{m as us}from"./proxy-C_NwhSmp.js";import{f as Je}from"./vendor-date-B8Mnp-Vt.js";import{C as Vs}from"./chevron-left-BGXbD1Rr.js";import{S as wt,a as St,b as _t,c as kt,d as Oe}from"./select-CBRDfsBL.js";import{C as Ct}from"./circle-alert-CuXc0JXQ.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-D_WtzBoI.js";import"./vendor-supabase-B7dJFgIA.js";import"./chevron-down-CJrrQWvk.js";import"./chevron-up-BR2yPekd.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Rt=ms("calendar",Mt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],It=ms("pause",Et);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],Dt=ms("sliders-horizontal",At),Tt=[1,2,3,4,5];function Ms({value:s,onChange:a,className:o,disabled:c=!1,size:x="md",ariaLabel:f="Sélecteur d'échelle 1 à 5"}){const y=x==="sm"?"h-10 w-10 text-xs":"h-11 w-11 text-sm";return e.jsx("div",{className:fe("flex items-center gap-2",o),role:"group","aria-label":f,children:Tt.map(j=>{const g=s===j;return e.jsx("button",{type:"button",className:fe("flex items-center justify-center rounded-full border font-semibold transition",y,g?"border-primary bg-primary text-primary-foreground":"border-muted-foreground/30 bg-background text-foreground",c&&"opacity-60"),"aria-pressed":g,disabled:c,onClick:()=>{c||a?.(j)},children:j},j)})})}const Ft=()=>{try{const s=new(window.AudioContext||window.webkitAudioContext),a=s.createOscillator(),o=s.createGain();a.connect(o),o.connect(s.destination),a.frequency.value=880,o.gain.value=.3,a.start(),a.stop(s.currentTime+.25);const c=s.createOscillator(),x=s.createGain();c.connect(x),x.connect(s.destination),c.frequency.value=1100,x.gain.value=.3,c.start(s.currentTime+.35),c.stop(s.currentTime+.6),c.onended=()=>s.close()}catch{}try{navigator.vibrate?.([200,100,200])}catch{}},Qe=(s,a)=>{const o=Number(s?.set_index??s?.set_number??s?.setIndex??a);return!Number.isFinite(o)||o<=0?a:o},Qs=(s=[],a,o)=>{if(!s.length)return 0;const c=Array.isArray(a)?a:[];if(c.length>0){const y=new Map;c.forEach((g,k)=>{if(!g?.exercise_id)return;const N=y.get(g.exercise_id)??[];N.push({...g,set_index:Qe(g,k+1)}),y.set(g.exercise_id,N)});let j=s.length+1;for(let g=0;g<s.length;g+=1){const k=s[g];if((y.get(k.exercise_id)??[]).length<(k.sets??0)){j=g+1;break}}return j}const x=Number(o??0);if(!Number.isFinite(x)||x<=0)return 0;const f=Math.min(s.length,Math.max(0,Math.round(x/100*s.length)));return Math.min(s.length,f+1)},ue=(s,a)=>{const o=Number(s);return!Number.isFinite(o)||o<=0?"—":a?`${o}${a}`:String(o)};function Pt({session:s,exercises:a,oneRMs:o,onFinish:c,onStart:x,onLogSets:f,onProgress:y,initialLogs:j,isFinishing:g,initialStep:k,onStepChange:N,initialInputOpen:l,initialSeriesOpen:M,onExitFocus:b,exerciseNotes:C,onUpdateNote:R}){const{toast:F}=xs(),Y=n.useRef(!1),[w,K]=n.useState(k??0),[I,P]=n.useState([]),[A,Z]=n.useState(0),[G,ge]=n.useState(!0),v=n.useRef(Date.now()),h=n.useRef(0),[$,ae]=n.useState(0),[le,L]=n.useState(!1),[Q,H]=n.useState(!1),J=n.useRef(0),[be,ke]=n.useState(!0),[B,Ce]=n.useState(3),[r,T]=n.useState(3),[q,z]=n.useState(""),[O,se]=n.useState(!1),[S,ye]=n.useState(1),[We,Me]=n.useState(M??!1),[Pe,me]=n.useState(l??!1),[te,je]=n.useState("weight"),[ce,re]=n.useState(""),[Ue,xe]=n.useState(!1),[Re,we]=n.useState(!1),[Le,qe]=n.useState(!1),[Xe,$e]=n.useState(!1),[i,u]=n.useState(!1),[V,U]=n.useState("");n.useEffect(()=>{if(!G)return;const t=()=>{const m=Math.floor((Date.now()-v.current)/1e3)+h.current;Z(m)};t();const d=setInterval(t,1e3),E=()=>{document.visibilityState==="visible"&&t()};return document.addEventListener("visibilitychange",E),()=>{clearInterval(d),document.removeEventListener("visibilitychange",E)}},[G]),n.useEffect(()=>{if(!Re)return;const t=d=>{d.key==="Escape"&&we(!1)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[Re]),n.useEffect(()=>{if(!le||Q)return;const t=()=>{if(J.current<=0)return;const m=Math.max(0,Math.ceil((J.current-Date.now())/1e3));ae(m),m<=0&&(Ft(),F({title:"Temps de récupération terminé"}),L(!1),H(!1))};t();const d=setInterval(t,1e3),E=()=>{document.visibilityState==="visible"&&t()};return document.addEventListener("visibilitychange",E),()=>{clearInterval(d),document.removeEventListener("visibilitychange",E)}},[le,Q]);const D=s.items||[],ve=w-1,p=w>0&&w<=D.length?D[ve]:null,ee=p?a.find(t=>t.id===p.exercise_id):null,ps=w<D.length?D[w]:null,Bs=ps?a.find(t=>t.id===ps.exercise_id):null,fs=(()=>{const t=ee?.muscle_groups??ee?.muscles??ee?.muscleGroups??[];return Array.isArray(t)?t:[]})(),Ne=p?.rest_seconds??0,gs=D.length?Math.min(100,Math.max(0,Math.round((w-1)/D.length*100))):0,Ye=Number(p?.percent_1rm),bs=Number.isFinite(Ye)&&Ye>0,Gs=bs&&o.find(t=>t.exercise_id===p?.exercise_id)?.weight||0,ne=bs?Math.round(Gs*(Ye/100)):0,[ie,Se]=n.useState({}),ys=n.useMemo(()=>{const t=new Map;return I.forEach((d,E)=>{const m=Qe(d,E+1);d.exercise_id&&t.set(`${d.exercise_id}-${m}`,d)}),t},[I]),js=p?`${p.exercise_id}-${S}`:null,Ze=js?ys.get(js):null,Js=Ze?.weight??ie[S-1]?.weight??ne,Ws=Ze?.reps??ie[S-1]?.reps??p?.reps??"",Us=()=>{if(typeof window>"u")return;const t=[Ie.status.success,Ie.chart[2],Ie.chart[3],Ie.destructive,Ie.accent],d=120;for(let E=0;E<d;E+=1){const m=document.createElement("div"),oe=Math.random()*6+6;m.style.position="fixed",m.style.top="-10px",m.style.left=`${Math.random()*100}vw`,m.style.width=`${oe}px`,m.style.height=`${oe*.6}px`,m.style.backgroundColor=t[E%t.length],m.style.opacity="0.9",m.style.pointerEvents="none",m.style.zIndex="80",m.style.borderRadius="2px",document.body.appendChild(m);const de=(Math.random()-.5)*200,Ee=1200+Math.random()*800,ze=Math.random()*360;m.animate([{transform:"translate3d(0, 0, 0) rotate(0deg)",opacity:1},{transform:`translate3d(${de}px, ${window.innerHeight+200}px, 0) rotate(${ze}deg)`,opacity:0}],{duration:Ee,easing:"ease-out"}).onfinish=()=>m.remove()}};n.useEffect(()=>{if(Y.current){j&&P(j);return}if(!j){P(m=>m.length?[]:m),Se(m=>Object.keys(m).length?{}:m);return}if(P(j),!j.length){Se(m=>Object.keys(m).length?{}:m),K(m=>m===0?m:0);return}const t=s.items||[];if(!t.length)return;const d=new Map;j.forEach((m,oe)=>{if(!m.exercise_id)return;const de=d.get(m.exercise_id)??[];de.push({...m,set_index:Qe(m,oe+1)}),d.set(m.exercise_id,de)});const E=Qs(t,j);if(E>0&&E<=t.length){const m=t[E-1],oe=d.get(m.exercise_id)??[],de=oe.reduce((ze,ts,Zs)=>{const et=Qe(ts,Zs+1);return ze[et-1]={reps:ts.reps??void 0,weight:ts.weight??void 0},ze},{});Se(de);const Ee=Math.min(m.sets??1,oe.length+1);ye(Ee)}else Se({}),ye(1);K(m=>m===E?m:E)},[j,s.items]),n.useEffect(()=>{w<=D.length||O||(Us(),se(!0))},[w,D.length,O]);const vs=t=>{K(t),N?.(t)},Ns=t=>{t<=0||(J.current=Date.now()+t*1e3,ae(t),L(!0),H(!1))},es=async()=>{window.scrollTo({top:0,behavior:"smooth"});const t=w+1;ye(1),Se({}),vs(t);const d=Math.round(Math.min(t-1,D.length)/D.length*100);try{await y?.(d)}catch{F({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}},Xs=async()=>{if(!p)return;if(Ze){S>=p.sets?await es():ye(d=>Math.min(p.sets,d+1));return}const t={exercise_id:p.exercise_id,set_number:S,reps:ie[S-1]?.reps||p.reps,weight:ie[S-1]?.weight||ne};P(d=>[...d,t]),Y.current=!0;try{await f?.([t])}catch{F({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}finally{Y.current=!1}if(be&&p.rest_seconds>0&&Ns(p.rest_seconds),S>=p.sets){await es();return}ye(d=>Math.min(p.sets,d+1))},ws=t=>{je(t);const d=t==="weight"?ie[S-1]?.weight??ne??"":ie[S-1]?.reps??p?.reps??"";re(d?String(d):""),xe(!!d),me(!0)},Ys=()=>{if(!p)return;const t=Number(te==="weight"?ce.replace(",","."):ce);Number.isFinite(t)&&(Se(d=>({...d,[S-1]:{...d[S-1],[te]:t}})),me(!1))},ss=t=>{if(Ue){xe(!1),re(t);return}re(d=>t==="."&&d.includes(".")?d:d+t)},Ss=t=>{if(!p)return;je(t);const d=t==="weight"?ie[S-1]?.weight??ne??"":ie[S-1]?.reps??p?.reps??"";re(d?String(d):""),xe(!!d)};return w===0?e.jsxs("div",{className:"space-y-6 text-center py-8 animate-in zoom-in duration-300",children:[e.jsx("div",{className:"h-24 w-24 bg-primary/10 rounded-full flex items-center justify-center mx-auto animate-pulse",children:e.jsx(Fe,{className:"h-10 w-10 text-primary ml-1"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold font-display uppercase",children:s.title}),e.jsx("p",{className:"text-muted-foreground text-lg",children:s.description}),e.jsxs("div",{className:"flex gap-2 justify-center mt-4",children:[e.jsx(Te,{variant:"outline",className:"text-sm px-3 py-1",children:s.cycle}),e.jsxs(Te,{variant:"secondary",className:"text-sm px-3 py-1",children:[D.length," Exercices"]})]})]}),e.jsx(_,{size:"lg",className:"w-full text-xl h-14 font-bold uppercase tracking-wider shadow-lg hover:scale-[1.02] transition-transform",disabled:Le,onClick:async()=>{qe(!0);try{await x?.(),vs(1)}finally{qe(!1)}},children:Le?e.jsxs(e.Fragment,{children:[e.jsx(pt,{className:"mr-2 h-5 w-5 animate-spin"}),"CHARGEMENT..."]}):"COMMENCER SÉANCE"})]}):w>D.length?e.jsx("div",{className:"space-y-6 animate-in fade-in",children:e.jsxs(pe,{className:"border-t-8 border-t-primary shadow-xl",children:[e.jsxs(He,{className:"text-center pb-2",children:[e.jsx("div",{className:"mx-auto bg-primary/10 p-4 rounded-full w-fit mb-4",children:e.jsx(ft,{className:"h-12 w-12 text-primary"})}),e.jsx(hs,{className:"text-3xl uppercase font-display italic",children:"Séance Terminée !"}),e.jsxs(Ds,{className:"text-lg",children:["Durée totale: ",Math.floor(A/60),"m ",A%60,"s"]})]}),e.jsxs(Ke,{className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Volume"}),e.jsxs("div",{className:"text-2xl font-mono font-bold",children:[I.reduce((t,d)=>t+(Number(d.weight)||0)*(Number(d.reps)||0),0).toLocaleString("fr-FR")," kg"]})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Séries"}),e.jsx("div",{className:"text-2xl font-mono font-bold",children:I.length})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(_e,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Difficulté de la séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Facile"}),e.jsx("span",{children:"Très dur"})]}),e.jsx(Ms,{value:B,onChange:Ce})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(_e,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Fatigue fin de séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Frais"}),e.jsx("span",{children:"Épuisé"})]}),e.jsx(Ms,{value:r,onChange:T})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_e,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Notes"}),e.jsx("textarea",{placeholder:"Sensations, douleurs...",value:q,onChange:t=>z(t.target.value),rows:3,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none"})]})]}),e.jsx(tt,{children:e.jsx(_,{className:"w-full h-14 text-lg font-bold uppercase",disabled:g,onClick:()=>{g||c({duration:Math.floor(A/60),feeling:B,fatigue:r,comments:q,logs:I})},children:g?"ENREGISTREMENT...":"ENREGISTRER & FERMER"})})]})}):e.jsxs("div",{className:"space-y-6 pb-44",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button","aria-label":"Voir l'animation de l'exercice",onClick:()=>{ee?.illustration_gif&&we(!0)},className:"flex h-10 w-10 shrink-0 items-center justify-center overflow-hidden rounded-full border bg-card shadow-sm",children:ee?.illustration_gif?e.jsx("img",{src:ee.illustration_gif,alt:"",className:"h-full w-full object-cover",loading:"lazy",decoding:"async"}):e.jsx(Fe,{className:"h-5 w-5 text-muted-foreground"})}),e.jsx("h2",{className:"flex-1 min-w-0 text-lg font-semibold tracking-tight truncate",children:ee?.nom_exercice??"Exercice"}),R&&p&&e.jsx(_,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",onClick:()=>{U(C?.[p.exercise_id]??""),u(!0)},"aria-label":"Notes personnelles",children:e.jsx(gt,{className:fe("h-4 w-4",C?.[p?.exercise_id]?"text-primary":"text-muted-foreground")})}),b&&e.jsx(_,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0","aria-label":"Quitter le focus",onClick:()=>{I.length>0?$e(!0):b()},children:e.jsx(Ve,{className:"h-4 w-4"})})]}),p&&C?.[p.exercise_id]&&e.jsx("p",{className:"text-xs italic text-muted-foreground line-clamp-2 -mt-1",children:C[p.exercise_id]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"rounded-full bg-primary/10 text-primary px-2.5 py-0.5 text-xs font-bold shrink-0",children:["Ex ",w,"/",D.length]}),e.jsxs("span",{className:"rounded-full bg-muted px-2.5 py-0.5 text-xs font-semibold shrink-0",children:["S ",S,"/",ue(p?.sets)]}),e.jsx("div",{className:"flex-1 h-1.5 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary transition-all",style:{width:`${gs}%`}})}),e.jsxs("span",{className:"text-xs font-semibold text-muted-foreground shrink-0",children:[gs,"%"]})]}),fs.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:fs.map(t=>e.jsx("span",{className:"rounded-full bg-muted px-2.5 py-0.5 text-xs font-semibold text-muted-foreground",children:t},t))})]}),e.jsxs(pe,{className:"rounded-3xl border bg-card p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"text-sm font-semibold",children:["Série ",S,"/",ue(p?.sets)," · ",ue(p?.reps)," reps"]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(is,{checked:be,onCheckedChange:ke,className:"scale-90"}),e.jsx("span",{children:"Auto repos"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>ws("weight"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:Js||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>ws("reps"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:Ws||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"reps"})]})]})]})]}),(p?.notes||ee?.description)&&e.jsxs("div",{className:"rounded-2xl border bg-muted/10 px-4 py-3",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground/70 uppercase tracking-wide mb-1",children:"Notes"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:p?.notes||ee?.description})]}),e.jsx(_,{variant:"outline",className:"w-full rounded-2xl",onClick:()=>Me(!0),children:"Voir les séries"}),!Pe&&!le?e.jsxs(Ks,{className:"bottom-0 z-modal",containerClassName:"gap-3 py-4",children:[e.jsxs(_,{className:"flex-1 min-w-0 h-12 rounded-xl text-sm font-bold shadow-lg active:scale-95 transition-transform",onClick:Xs,children:[e.jsx(Cs,{className:"mr-2 h-5 w-5"})," Valider série"]}),e.jsxs(_,{type:"button",variant:"outline",className:"h-12 rounded-xl px-3 flex flex-col items-center justify-center gap-0.5 active:scale-95 transition-transform",onClick:()=>{Ne>0&&Ns(Ne)},disabled:Ne<=0,"aria-label":"Démarrer le repos",children:[e.jsx(bt,{className:"h-4 w-4"}),e.jsx("span",{className:"text-[10px] font-semibold leading-none",children:"Repos"})]}),e.jsxs(_,{type:"button",variant:"outline",className:"h-12 rounded-xl px-3 flex flex-col items-center justify-center gap-0.5 active:scale-95 transition-transform",onClick:()=>es(),"aria-label":"Exercice suivant",children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsx("span",{className:"text-[10px] font-semibold leading-none",children:"Passer"})]})]}):null,le&&e.jsxs("div",{className:"fixed inset-0 z-modal flex flex-col bg-background/95 pb-[env(safe-area-inset-bottom)]",children:[e.jsxs("div",{className:"flex items-start justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Timer"}),e.jsx("div",{className:"text-lg font-semibold",children:"Transition inter-exercice"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Prochain exercice : ",Bs?.nom_exercice??"À venir"]})]}),e.jsx(_,{variant:"ghost",size:"icon",onClick:()=>{L(!1),H(!1)},"aria-label":"Fermer le timer de repos",children:e.jsx(Ve,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-6 px-6 py-8",children:[e.jsxs(pe,{className:"w-full max-w-sm rounded-3xl border p-6 shadow-sm",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Temps restant"}),e.jsxs("div",{className:"mt-2 text-5xl font-semibold tracking-tight",children:[Math.floor($/60),":",String($%60).padStart(2,"0")]}),e.jsx("div",{className:"mt-6 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:Ne?`${$/Ne*100}%`:"0%"}})}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx(_,{variant:"outline",className:"flex-1 h-12 rounded-full text-base font-semibold",onClick:()=>{J.current+=30*1e3,ae(t=>t+30)},children:"+30s"}),e.jsxs(_,{variant:"outline",className:"flex-1 h-12 rounded-full text-base font-semibold",onClick:()=>{J.current=Date.now()+Ne*1e3,ae(Ne)},children:[e.jsx(rt,{className:"mr-2 h-4 w-4"})," Reset"]})]})]}),e.jsxs("div",{className:"flex w-full max-w-sm flex-wrap gap-3",children:[e.jsxs(_,{className:"flex-1 rounded-full py-6 text-base font-semibold",onClick:()=>{Q&&(J.current=Date.now()+$*1e3),H(t=>!t)},children:[e.jsx(It,{className:"mr-2 h-4 w-4"})," ",Q?"Reprendre":"Pause"]}),e.jsxs(_,{variant:"outline",className:"rounded-full px-6 py-6 text-base font-semibold",onClick:()=>{J.current=0,L(!1),ae(0),H(!1)},children:["Passer ",e.jsx(Be,{className:"ml-2 h-4 w-4"})]})]})]})]}),Re&&ee?.illustration_gif&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:()=>we(!1),children:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button","aria-label":"Fermer",className:"absolute -right-3 -top-3 rounded-full bg-background p-2 shadow",onClick:()=>we(!1),children:e.jsx(Ve,{className:"h-4 w-4"})}),e.jsx("img",{src:ee.illustration_gif,alt:"",className:"max-h-[80vh] w-auto max-w-[92vw] rounded-2xl",loading:"lazy"})]})})}),e.jsx(ls,{open:We,onOpenChange:Me,children:e.jsxs(cs,{side:"bottom",className:"max-h-[80vh] overflow-y-auto",children:[e.jsx(os,{children:e.jsx(ds,{children:"Aperçu séance"})}),e.jsx("div",{className:"mt-4 space-y-4",children:D.map((t,d)=>{const E=a.find(de=>de.id===t.exercise_id),m=Array.from({length:t.sets}).filter((de,Ee)=>ys.get(`${t.exercise_id}-${Ee+1}`)).length,oe=t.sets?Math.round(m/t.sets*100):0;return e.jsxs(pe,{className:"rounded-3xl border bg-muted/10 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:E?.nom_exercice??t.exercise_name}),e.jsxs("div",{className:"mt-1 text-sm text-muted-foreground",children:[ue(t.sets),"x",ue(t.reps)," ·"," ",t.percent_1rm?`${ue(t.percent_1rm)} 1RM`:"—"]})]}),e.jsxs("div",{className:"rounded-full bg-muted px-3 py-1 text-sm font-semibold",children:[m,"/",ue(t.sets)]})]}),e.jsx("div",{className:"mt-4 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${oe}%`}})})]},`${t.exercise_id}-${d}`)})})]})}),e.jsx(lt,{open:Pe,onOpenChange:me,children:e.jsx(ct,{className:"max-h-[90vh]",children:e.jsxs("div",{className:"mx-auto w-full max-w-md px-4 pb-8",children:[e.jsxs(ot,{className:"pb-2",children:[e.jsx(dt,{className:"text-center",children:te==="weight"?"Charge":"Répétitions"}),e.jsxs(ut,{className:"text-center",children:["Série ",S,"/",ue(p?.sets)," · Objectif"," ",ue(p?.reps)," reps"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("button",{type:"button",className:fe("rounded-xl border-2 p-4 text-center transition-all",te==="weight"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>Ss("weight"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[te==="weight"?ce||"—":String(ie[S-1]?.weight??ne??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:fe("rounded-xl border-2 p-4 text-center transition-all",te==="reps"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>Ss("reps"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[te==="reps"?ce||"—":String(ie[S-1]?.reps??p?.reps??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"reps"})]})]})]}),te==="weight"&&ne>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[ne-10,ne-5,ne,ne+5,ne+10].filter(t=>t>0).map(t=>e.jsxs(_,{variant:Number(ce)===t?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>re(String(t)),children:[t," kg"]},t))})]}),te==="reps"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[6,8,10,12,15,20].map(t=>e.jsx(_,{variant:Number(ce)===t?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>re(String(t)),children:t},t))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[[1,2,3,4,5,6,7,8,9].map(t=>e.jsx(_,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>ss(String(t)),children:t},t)),e.jsx(_,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>ss("."),children:","}),e.jsx(_,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>ss("0"),children:"0"}),e.jsx(_,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>{xe(!1),re(t=>t.slice(0,-1))},children:"⌫"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(_,{variant:"outline",className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:()=>{xe(!1),re("")},children:"Effacer"}),e.jsxs(_,{className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:Ys,children:[e.jsx(Cs,{className:"mr-2 h-5 w-5"}),"Valider"]})]})]})})}),b&&e.jsx(Ts,{open:Xe,onOpenChange:$e,children:e.jsxs(Fs,{children:[e.jsxs(Ps,{children:[e.jsx(Ls,{children:"Quitter la séance ?"}),e.jsx(qs,{children:"Les séries enregistrées seront conservées."})]}),e.jsxs($s,{children:[e.jsx(zs,{children:"Annuler"}),e.jsx(Os,{onClick:()=>{$e(!1),b()},children:"Quitter"})]})]})}),R&&e.jsx(ls,{open:i,onOpenChange:t=>{if(!t&&p){const d=V.trim()||null,E=C?.[p.exercise_id]??null;d!==E&&R(p.exercise_id,d)}u(t)},children:e.jsxs(cs,{side:"bottom",className:"max-h-[60vh]",children:[e.jsx(os,{children:e.jsxs(ds,{children:["Notes — ",ee?.nom_exercice]})}),e.jsx("textarea",{value:V,onChange:t=>U(t.target.value),placeholder:"Réglages machine, repères personnels...",rows:4,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm mt-4 resize-none ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"})]})})]})}const Hs=(s=[])=>{if(!s.length)return s;const a=s.map((c,x)=>{const f=Number(c.order_index);return{item:c,index:x,order:Number.isFinite(f)?f:null}});return a.some(c=>c.order!==null)?a.sort((c,x)=>c.order===null&&x.order===null?c.index-x.index:c.order===null?1:x.order===null?-1:c.order===x.order?c.index-x.index:c.order-x.order).map(c=>c.item):s},rs=s=>s==="endurance"||s==="hypertrophie"||s==="force"?s:"endurance";function Lt({user:s,userId:a,athleteName:o,athleteId:c,athleteKey:x,cycleType:f,searchQuery:y,isLoading:j,setSaveState:g,onCycleChange:k,onSearchChange:N,onStartAssignment:l,onStartCatalog:M,onResumeInProgress:b}){const{toast:C}=xs(),R=As(),[F,Y]=n.useState(null),[w,K]=n.useState(!1),[I,P]=n.useState(null),A=[{value:"endurance",label:"Endurance"},{value:"hypertrophie",label:"Hypertrophie"},{value:"force",label:"Force"}],{data:Z}=he({queryKey:["assignments",s,"strength"],queryFn:()=>W.getAssignments(s,a,{assignmentType:"strength"}),enabled:!!s}),{data:G}=he({queryKey:["strength_catalog"],queryFn:()=>W.getStrengthSessions()}),{data:ge}=he({queryKey:["exercises"],queryFn:()=>W.getExercises()}),h=he({queryKey:["strength_run_in_progress",x],queryFn:()=>W.getStrengthHistory(o,{limit:1,offset:0,order:"desc",status:"in_progress",athleteId:c}),enabled:!!o}).data?.runs?.[0]??null,$=h?.status==="completed"||(h?.progress_pct??0)>=100,ae=De({mutationFn:r=>W.deleteStrengthRun(r),onMutate:()=>{g("saving")},onSuccess:r=>{g("saved"),setTimeout(()=>g("idle"),2e3),R.invalidateQueries({queryKey:["strength_run_in_progress",x]}),R.invalidateQueries({queryKey:["strength_history"]}),R.invalidateQueries({queryKey:["assignments",s,"strength"]});const T=r?.source==="local"?"Suppression locale : le serveur n'est pas disponible.":void 0;C({title:"Séance supprimée",description:T})},onError:()=>{g("error"),setTimeout(()=>g("idle"),3e3),C({title:"Erreur",description:"Impossible de supprimer la séance en cours.",variant:"destructive"})}});n.useMemo(()=>ge?new Map(ge.map(r=>[r.id,r])):new Map,[ge]);const le=n.useMemo(()=>Z?.filter(r=>r.session_type==="strength")||[],[Z]),L=n.useMemo(()=>le.filter(r=>r.status!=="completed"),[le]),Q=n.useMemo(()=>h?L.find(r=>r.id===h.assignment_id)??null:null,[h,L]),H=n.useMemo(()=>h&&!Q?G?.find(r=>r.id===h.session_id)??null:null,[h,Q,G]),J=(!!Q?.items?.length||!!H?.items?.length)&&!$,be=n.useMemo(()=>L.map(r=>{const T=(r.items??[]).filter(q=>"exercise_id"in q);return{key:`assignment-${r.id}`,title:r.title,description:r.description,type:"assignment",assignedDate:r.assigned_date,session:{id:r.session_id,title:r.title,description:r.description,cycle:rs(r.cycle),items:T},assignment:r,exerciseCount:T.length}}),[L]),ke=n.useMemo(()=>(G??[]).map(r=>({key:`catalog-${r.id}`,title:r.title,description:r.description,type:"catalog",session:{...r,cycle:f},exerciseCount:r.items?.length??0})),[G,f]),B=n.useMemo(()=>{const r=y.trim().toLowerCase(),T=[...be,...ke];return r?T.filter(q=>`${q.title} ${q.description}`.toLowerCase().includes(r)):T},[be,ke,y]),Ce=n.useCallback((r,T)=>{if(!["ArrowUp","ArrowDown","Enter"].includes(r.key))return;if(r.preventDefault(),r.key==="Enter"){const O=B[T];O.type==="assignment"&&O.assignment?l(O.assignment):M(O.session);return}let z=T;r.key==="ArrowUp"&&(z=Math.max(0,T-1)),r.key==="ArrowDown"&&(z=Math.min(B.length-1,T+1)),Y(z),setTimeout(()=>{const O=document.querySelectorAll('[data-session-card="true"]');O[z]&&O[z].focus()},0)},[B,l,M]);return j?e.jsxs("div",{className:"space-y-5 pt-2",children:[e.jsx("div",{className:"rounded-xl bg-muted/40 p-1 flex gap-1",children:[1,2,3].map(r=>e.jsx("div",{className:"flex-1 h-10 rounded-lg bg-muted animate-pulse"},r))}),e.jsx("div",{className:"space-y-2.5",children:[1,2,3,4].map(r=>e.jsx("div",{className:"rounded-xl border bg-card p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 w-3/5 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-2/5 rounded bg-muted animate-pulse"})]})},r))})]}):e.jsxs("div",{className:"space-y-4 animate-in fade-in motion-reduce:animate-none",children:[e.jsxs("div",{children:[e.jsx("div",{className:"rounded-xl bg-muted/40 p-1 flex gap-1",children:A.map(r=>e.jsx("button",{type:"button",onClick:()=>k(rs(r.value)),className:fe("flex-1 py-2.5 rounded-lg text-sm font-semibold transition-all active:scale-[0.97]",f===r.value?"bg-card text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:r.label},r.value))}),e.jsxs("p",{className:"text-center text-[11px] text-muted-foreground mt-2",children:[f==="endurance"&&"Beaucoup de reps, charges légères",f==="hypertrophie"&&"Reps et charges modérées",f==="force"&&"Peu de reps, charges lourdes"]})]}),B.length>4&&e.jsxs("div",{className:"relative",children:[e.jsx(Nt,{className:"absolute left-3.5 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground pointer-events-none"}),e.jsx(as,{placeholder:"Rechercher...",className:"h-10 rounded-xl bg-muted/30 pl-10 pr-4 border-0 text-sm focus-visible:ring-2",value:y,onChange:r=>N(r.target.value),"aria-label":"Rechercher une séance"})]}),h&&e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border-2 border-primary/30 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-primary/10 rounded-full blur-2xl -mr-8 -mt-8"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-primary"})]}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-primary",children:$?"Complétée":"En cours"})]}),e.jsx("h3",{className:"text-xl font-bold tracking-tight mb-1",children:Q?.title??"Séance en cours"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Démarrée le"," ",Je(new Date(h.started_at||new Date),"dd MMMM",{locale:Ge})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs font-semibold mb-1.5",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progression"}),e.jsxs("span",{className:"text-primary",children:[Math.round(h.progress_pct??0),"%"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-primary transition-all duration-500",style:{width:`${h.progress_pct??0}%`}})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{variant:"default",className:"flex-1 h-12 rounded-xl font-semibold",disabled:!J,onClick:()=>{const r=Q??H;if(!r)return;const q=(Q?.items??H?.items??[]).filter(S=>"exercise_id"in S),z=rs(Q?.cycle??H?.cycle??q.find(S=>S.cycle_type)?.cycle_type),O=q.filter(S=>S.cycle_type===z),se=Hs(O.length?O:q);b({assignment:Q??null,session:{...r,title:r.title,description:r.description??null,cycle:z,items:se},runId:h.id,logs:h.logs??[],progressPct:h.progress_pct??0})},children:$?"Voir le résumé":"Reprendre"}),!$&&e.jsx(_,{variant:"outline",className:"h-12 w-12 rounded-xl p-0",disabled:ae.isPending,onClick:()=>{h&&(P(h.id),K(!0))},"aria-label":"Supprimer la séance",children:e.jsx(Ve,{className:"h-5 w-5"})})]})]})]}),B.length>0&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:[B.length," séance",B.length>1?"s":""]}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),B.length>0?e.jsx(us.div,{className:"space-y-2.5 motion-reduce:animate-none",variants:yt,initial:"hidden",animate:"visible",children:B.map((r,T)=>{const q=F===T||F===null&&T===0,z=r.type==="assignment";return e.jsx(us.button,{type:"button",tabIndex:q?0:-1,"data-session-card":"true",onKeyDown:O=>Ce(O,T),variants:jt,className:fe("group w-full rounded-xl border bg-card text-left transition-all active:scale-[0.98] hover:shadow-md focus:outline-none motion-reduce:animate-none overflow-hidden",z&&"border-l-[3px] border-l-primary",q&&"ring-2 ring-primary"),onClick:()=>{if(z&&r.assignment){l(r.assignment);return}M(r.session)},children:e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3.5",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("h3",{className:"font-semibold tracking-tight truncate",children:r.title}),z&&e.jsx("span",{className:"shrink-0 inline-flex items-center rounded-md bg-primary/10 px-1.5 py-0.5 text-[10px] font-bold uppercase text-primary",children:"Coach"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[r.exerciseCount," exercice",r.exerciseCount>1?"s":""]}),z&&r.assignedDate&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-border",children:"·"}),e.jsx("span",{children:Je(new Date(r.assignedDate),"dd MMM",{locale:Ge})})]}),r.description&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-border",children:"·"}),e.jsx("span",{className:"truncate",children:r.description})]})]})]}),e.jsx(Be,{className:"h-5 w-5 shrink-0 text-muted-foreground/40 transition-transform group-hover:translate-x-0.5 group-hover:text-primary"})]})},r.key)})}):e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-14 w-14 items-center justify-center rounded-full bg-muted/60",children:e.jsx(Fe,{className:"h-6 w-6 text-muted-foreground"})}),e.jsx("h3",{className:"font-semibold text-sm",children:"Aucune séance trouvée"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Changez de cycle ou modifiez votre recherche."})]}),e.jsx(Ts,{open:w,onOpenChange:K,children:e.jsxs(Fs,{children:[e.jsxs(Ps,{children:[e.jsx(Ls,{children:"Supprimer la séance ?"}),e.jsx(qs,{children:"Les séries déjà enregistrées seront perdues."})]}),e.jsxs($s,{children:[e.jsx(zs,{children:"Annuler"}),e.jsx(Os,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:()=>{I&&ae.mutate(I),K(!1)},children:"Supprimer"})]})]})})]})}const Rs=s=>{const a=Number(s);return!Number.isFinite(a)||a<=0?"—":String(a)},qt=s=>{const a=Number(s);return!Number.isFinite(a)||a<=0?"—":`${a}s`};function $t({session:s,assignment:a,cycleType:o,cycleOptions:c,exercises:x,oneRMs:f,saveState:y,onBack:j,onLaunch:g}){const k=n.useMemo(()=>new Map(x.map(l=>[l.id,l])),[x]),N=s.items??[];return e.jsxs(us.div,{className:"space-y-5 pb-36",variants:vt,initial:"hidden",animate:"visible",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:j,className:"flex h-10 w-10 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors hover:bg-muted active:scale-95","aria-label":"Retour",children:e.jsx(Vs,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground truncate",children:c.find(l=>l.value===o)?.label}),e.jsx("h1",{className:"text-xl font-bold tracking-tight truncate",children:s.title})]})]}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border border-primary/20 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-primary/10 rounded-full blur-3xl -mr-12 -mt-12"}),e.jsxs("div",{className:"relative space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[a&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-primary/20 px-3 py-1 text-xs font-bold uppercase text-primary",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-primary"}),"Assignée"]}),!a&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:"Catalogue"}),a?.assigned_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Prévue le ",Je(new Date(a.assigned_date),"dd MMM",{locale:Ge})]})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(Fe,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:N.length}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Exercices"})]})]}),e.jsx("div",{className:"h-8 w-px bg-border"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(Rt,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:c.find(l=>l.value===o)?.label}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Cycle"})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-1",children:[e.jsxs("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:[N.length," exercice",N.length>1?"s":""]}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsxs("div",{className:"space-y-2",children:[N.map((l,M)=>{const b=k.get(l.exercise_id),C=Number(l.percent_1rm),R=Number.isFinite(C)&&C>0,F=R?f?.find(Z=>Z.exercise_id===l.exercise_id)?.weight??0:0,Y=R?Math.round(F*(C/100)):0,w=R?Y>0?`${Y} kg (${C}% 1RM)`:`${C}% 1RM`:null,K=l.notes?.trim(),I=Rs(l.sets),P=Rs(l.reps),A=qt(l.rest_seconds);return e.jsxs(ls,{children:[e.jsx(mt,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-3 rounded-xl border bg-card px-3 py-3 text-left transition-all active:scale-[0.98] hover:border-primary/50 hover:shadow-sm",children:[e.jsx("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-primary text-xs font-bold text-primary-foreground",children:M+1}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"font-semibold text-sm truncate",children:b?.nom_exercice??l.exercise_name??"Exercice"})}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 text-xs font-medium text-muted-foreground",children:[e.jsxs("span",{className:"font-mono",children:[I,"×",P]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("span",{className:"font-mono",children:A}),e.jsx(Be,{className:"h-4 w-4 text-muted-foreground/50"})]})]})}),e.jsxs(cs,{side:"bottom",className:"max-h-[90vh] overflow-y-auto rounded-t-3xl pb-8",children:[e.jsx(os,{className:"text-left pb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-primary text-sm font-bold text-primary-foreground",children:M+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(ds,{className:"text-xl leading-tight",children:b?.nom_exercice??l.exercise_name??"Exercice"}),b?.exercise_type&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:b.exercise_type})]})]})}),e.jsxs("div",{className:"space-y-4",children:[b?.illustration_gif&&e.jsx("div",{className:"rounded-xl overflow-hidden bg-muted/20 border aspect-video flex items-center justify-center",children:e.jsx("img",{src:b.illustration_gif,alt:b.nom_exercice??"Exercice",className:"w-full h-full max-h-36 object-contain",loading:"lazy",decoding:"async"})}),b?.description&&e.jsx("div",{className:"text-sm text-muted-foreground leading-relaxed",children:b.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:I}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Séries"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:P}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Reps"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:w??"—"}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Charge"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:A}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Repos"})]})]}),K&&e.jsxs("div",{className:"rounded-xl bg-primary/5 border border-primary/20 p-4",children:[e.jsx("div",{className:"text-[10px] uppercase text-primary font-semibold mb-1",children:"Notes coach"}),e.jsx("div",{className:"text-sm text-foreground",children:K})]})]})]})]},`${l.exercise_id}-${M}`)}),N.length===0&&e.jsx("div",{className:"p-6 border-2 border-dashed rounded-xl text-center text-muted-foreground",children:"Aucun exercice disponible pour cette séance."})]}),e.jsx(Ks,{saveState:y,className:"bottom-0",children:e.jsxs(_,{variant:"default",className:"flex-1 h-14 rounded-xl font-bold text-base shadow-lg",onClick:g,children:[e.jsx(xt,{className:"h-5 w-5 mr-2"}),"Lancer la séance"]})})]})}function zt({athleteName:s,athleteId:a,athleteKey:o}){const[c,x]=n.useState("all"),[f,y]=n.useState(""),[j,g]=n.useState(""),k=st({queryKey:["strength_history",o,c,f,j],queryFn:({pageParam:l=0})=>W.getStrengthHistory(s,{athleteId:a,limit:10,offset:l,order:"desc",status:c==="all"?void 0:c,from:f||void 0,to:j||void 0}),enabled:!!s,getNextPageParam:l=>{const M=l.pagination.offset+l.pagination.limit;return M<l.pagination.total?M:void 0},initialPageParam:0}),N=k.data?.pages.flatMap(l=>l.runs)??[];return e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(_e,{htmlFor:"strength-history-status",children:"Statut"}),e.jsxs(wt,{value:c,onValueChange:x,children:[e.jsx(St,{id:"strength-history-status",children:e.jsx(_t,{placeholder:"Tous"})}),e.jsxs(kt,{children:[e.jsx(Oe,{value:"all",children:"Tous"}),e.jsx(Oe,{value:"in_progress",children:"En cours"}),e.jsx(Oe,{value:"completed",children:"Terminé"}),e.jsx(Oe,{value:"abandoned",children:"Abandonné"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(_e,{htmlFor:"strength-history-from",children:"Du"}),e.jsx(as,{id:"strength-history-from",type:"date",value:f,onChange:l=>y(l.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(_e,{htmlFor:"strength-history-to",children:"Au"}),e.jsx(as,{id:"strength-history-to",type:"date",value:j,onChange:l=>g(l.target.value)})]})]}),N.map(l=>e.jsx(pe,{className:"group hover:border-primary/50 transition-colors",children:e.jsxs(He,{className:"pb-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(hs,{className:"text-base font-bold uppercase",children:Je(new Date(l.started_at||l.date||l.created_at||new Date),"dd MMM yyyy",{locale:Ge})}),e.jsxs("div",{className:"text-sm font-mono font-bold text-muted-foreground group-hover:text-primary",children:[l.duration??0," min"]})]}),e.jsxs("div",{className:"flex gap-2 text-xs font-bold text-muted-foreground",children:[e.jsxs("span",{children:["Difficulté ",l.feeling??l.rpe??0,"/5"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[l.logs?.length||0," Séries"]})]})]})},l.id)),N.length===0&&e.jsx("div",{className:"text-center text-muted-foreground py-10",children:"Aucun historique."}),k.hasNextPage&&e.jsx(_,{variant:"outline",size:"sm",className:"w-full",onClick:()=>k.fetchNextPage(),disabled:k.isFetchingNextPage,children:k.isFetchingNextPage?"Chargement...":"Charger plus"})]})}const Ot=s=>s==="endurance"||s==="hypertrophie"||s==="force"?s:"endurance";function Kt({athleteKey:s}){const a="strength-preferences",o=n.useMemo(()=>`strength-focus-state-${s??"anonymous"}`,[s]),[c,x]=n.useState(null),[f,y]=n.useState(null),[j,g]=n.useState(null),[k,N]=n.useState(null),[l,M]=n.useState(0),[b,C]=n.useState("list"),[R,F]=n.useState(!1),[Y,w]=n.useState("idle"),[K,I]=n.useState({poolMode:!1,largeText:!1}),[P,A]=n.useState(""),[Z,G]=n.useState("endurance");return n.useEffect(()=>{if(typeof window>"u")return;const v=window.localStorage.getItem(a);if(v)try{const h=JSON.parse(v);I($=>({...$,...h??{}}))}catch{return}},[]),n.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(a,JSON.stringify(K))},[a,K]),n.useEffect(()=>{if(!(typeof document>"u")){if(b==="focus")return document.body.dataset.focusMode="strength",()=>{document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode};document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode}},[b]),n.useEffect(()=>{if(typeof window>"u"||c)return;const v=window.localStorage.getItem(o);if(v)try{const h=JSON.parse(v),$=h?.screenMode==="focus"?"focus":h?.screenMode==="reader"?"reader":null;if(!$||!h?.session)return;x(h.session),y(h.assignment??null),g(typeof h.runId=="number"?h.runId:null),N(Array.isArray(h.runLogs)?h.runLogs:null),M(Number.isFinite(h.runnerStep)?h.runnerStep:0),h.cycleType&&G(Ot(h.cycleType)),C($)}catch{return}},[c,o]),n.useEffect(()=>{if(typeof window>"u")return;if(!(b==="focus"||b==="reader")||!c){window.localStorage.removeItem(o);return}const h={screenMode:b,session:c,assignment:f,runId:j,runLogs:k,runnerStep:l,cycleType:Z};window.localStorage.setItem(o,JSON.stringify(h))},[f,j,k,l,c,Z,o,b]),{activeSession:c,setActiveSession:x,activeAssignment:f,setActiveAssignment:y,activeRunId:j,setActiveRunId:g,activeRunLogs:k,setActiveRunLogs:N,activeRunnerStep:l,setActiveRunnerStep:M,screenMode:b,setScreenMode:C,isFinishing:R,setIsFinishing:F,saveState:Y,setSaveState:w,preferences:K,setPreferences:I,searchQuery:P,setSearchQuery:A,cycleType:Z,setCycleType:G,clearActiveRunState:()=>{x(null),y(null),g(null),N(null),M(0),C("list")}}}const Es=s=>s==="endurance"||s==="hypertrophie"||s==="force"?s:"endurance",Ae=s=>{const a=Number(s);return!Number.isFinite(a)||a<=0?null:a},Vt=(s,a)=>{if(!s)return{sets:null,reps:null,percent1rm:null,restSeries:null,restExercise:null};const o={endurance:{sets:s.Nb_series_endurance,reps:s.Nb_reps_endurance,percent1rm:s.pct_1rm_endurance,restSeries:s.recup_endurance,restExercise:s.recup_exercices_endurance},hypertrophie:{sets:s.Nb_series_hypertrophie,reps:s.Nb_reps_hypertrophie,percent1rm:s.pct_1rm_hypertrophie,restSeries:s.recup_hypertrophie,restExercise:s.recup_exercices_hypertrophie},force:{sets:s.Nb_series_force,reps:s.Nb_reps_force,percent1rm:s.pct_1rm_force,restSeries:s.recup_force,restExercise:s.recup_exercices_force}}[a];return{sets:Ae(o.sets),reps:Ae(o.reps),percent1rm:Ae(o.percent1rm),restSeries:Ae(o.restSeries),restExercise:Ae(o.restExercise)}},Qt=(s=[],a)=>{const o=s.filter(x=>x.cycle_type===a),c=o.length?o:s;return Hs(c)},ns=(s=[],a,o)=>Qt(s,a).map(c=>{const x=Vt(o.get(c.exercise_id),a);return{...c,sets:x.sets??0,reps:x.reps??0,rest_seconds:x.restSeries??0,percent_1rm:x.percent1rm??0}}),Ht=({runId:s,assignmentId:a,startedAt:o})=>({id:s,assignment_id:a??null,started_at:o,progress_pct:0,status:"in_progress",logs:[]}),Is=s=>({runs:s?[s]:[],pagination:{limit:1,offset:0,total:s?1:0},exercise_summary:[]});function Nr(){const{user:s,userId:a,role:o,selectedAthleteId:c,selectedAthleteName:x}=nt(),{toast:f}=xs(),y=As(),j=(o==="coach"||o==="admin")&&(c!==null||!!x),g=j?x:s,k=j?c:a,N=k??g,{activeSession:l,setActiveSession:M,activeAssignment:b,setActiveAssignment:C,activeRunId:R,setActiveRunId:F,activeRunLogs:Y,setActiveRunLogs:w,activeRunnerStep:K,setActiveRunnerStep:I,screenMode:P,setScreenMode:A,isFinishing:Z,setIsFinishing:G,saveState:ge,setSaveState:v,preferences:h,setPreferences:$,searchQuery:ae,setSearchQuery:le,cycleType:L,setCycleType:Q}=Kt({athleteKey:N}),{poolMode:H,largeText:J}=h,be=[{value:"endurance",label:"Endurance"},{value:"hypertrophie",label:"Hypertrophie"},{value:"force",label:"Force"}],{data:ke,isLoading:B,error:Ce,refetch:r}=he({queryKey:["assignments",s,"strength"],queryFn:()=>W.getAssignments(s,a,{assignmentType:"strength"}),enabled:!!s}),{data:T,isLoading:q,error:z,refetch:O}=he({queryKey:["strength_catalog"],queryFn:()=>W.getStrengthSessions()}),{data:se,error:S,refetch:ye}=he({queryKey:["exercises"],queryFn:()=>W.getExercises()}),We=B||q,Me=Ce||z||S,Pe=()=>{r(),O(),ye()},{data:me}=he({queryKey:["1rm",s,a],queryFn:()=>W.get1RM({athleteName:s,athleteId:a}),enabled:!!s}),te=n.useMemo(()=>{const i={};return(me??[]).forEach(u=>{u.notes&&(i[u.exercise_id]=u.notes)}),i},[me]),je=n.useMemo(()=>se?new Map(se.map(i=>[i.id,i])):new Map,[se]),ce=n.useMemo(()=>l?ns(l.items??[],L,je):[],[l,L,je]),re=De({mutationFn:i=>W.startStrengthRun(i),onMutate:()=>{v("saving")},onSuccess:i=>{if(v("saved"),setTimeout(()=>v("idle"),2e3),i?.run_id&&(F(i.run_id),w(u=>u??[]),N)){const u=Ht({runId:i.run_id,assignmentId:b?.id??null,startedAt:new Date().toISOString()});y.setQueryData(["strength_run_in_progress",N],Is(u))}y.invalidateQueries({queryKey:["assignments",s,"strength"]}),y.invalidateQueries({queryKey:["strength_run_in_progress",N]}),y.invalidateQueries({queryKey:["strength_history"]})},onError:()=>{v("error"),setTimeout(()=>v("idle"),3e3),f({title:"Erreur",description:"Impossible de démarrer la séance.",variant:"destructive"})}}),Ue=De({mutationFn:i=>W.logStrengthSet(i),onMutate:()=>{v("saving")},onSuccess:i=>{v("saved"),setTimeout(()=>v("idle"),2e3),i?.one_rm_updated&&(y.invalidateQueries({queryKey:["1rm",s,a]}),f({title:"Nouveau 1RM détecté",description:"Ton record vient d'être mis à jour."}))},onError:()=>{v("error"),setTimeout(()=>v("idle"),3e3),f({title:"Erreur",description:"Impossible d'enregistrer une série.",variant:"destructive"})}}),xe=De({mutationFn:i=>W.updateStrengthRun(i),onMutate:()=>{v("saving")},onSuccess:(i,u)=>{v("saved"),setTimeout(()=>v("idle"),2e3),G(!1),y.invalidateQueries({queryKey:["strength_history"]}),u?.status==="completed"&&(N&&y.setQueryData(["strength_run_in_progress",N],Is(null)),y.invalidateQueries({queryKey:["assignments",s]}),y.invalidateQueries({queryKey:["assignments",s,"strength"]}),y.invalidateQueries({queryKey:["1rm",s,a]}),C(null),F(null),M(null),w(null),A("list"),f({title:"Séance sauvegardée",description:"Bravo pour l'effort !"}))},onError:(i,u)=>{v("error"),setTimeout(()=>v("idle"),3e3),u?.status==="completed"&&(G(!1),f({title:"Erreur",description:"Impossible d'enregistrer la séance. Réessayez.",variant:"destructive"}))}}),Re=De({mutationFn:i=>W.updateExerciseNote({athlete_id:a??0,exercise_id:i.exercise_id,notes:i.notes}),onMutate:()=>{v("saving")},onSuccess:()=>{v("saved"),setTimeout(()=>v("idle"),2e3),y.invalidateQueries({queryKey:["1rm",s,a]})},onError:()=>{v("error"),setTimeout(()=>v("idle"),3e3),f({title:"Erreur",description:"Impossible de sauvegarder la note.",variant:"destructive"})}}),we=(i,u)=>{const V=i.items??[],U=Es(u??i.cycle??V.find(ve=>ve.cycle_type)?.cycle_type),D=ns(V,U,je);C(i),M({...i,title:i.title,description:i.description,cycle:U,items:D}),F(null),w(null),I(0),A("reader")},Le=i=>{if((i.items??[]).length===0){f({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}we(i,L),F(null),w(null)},qe=i=>{const u=i.items??[],U=u.filter(ve=>ve.cycle_type===L).length>0?L:Es(i.cycle??u.find(ve=>ve.cycle_type)?.cycle_type),D=ns(u,U,je);if(D.length===0){f({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}M({...i,cycle:U,items:D}),C(null),F(null),w(null),I(0),A("reader")},Xe=async()=>{if(!l)return;if(ce.length===0){f({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}const i={...l,cycle:L,items:ce};if(M(i),!R){const u=b?.session_id??l?.id??null;if(!u){f({title:"Session manquante",description:"Impossible de démarrer sans session associée.",variant:"destructive"});return}try{const V=await re.mutateAsync({assignment_id:b?.id??null,athlete_id:a??null,athleteName:s??void 0,progress_pct:0,session_id:u,cycle_type:i.cycle});V?.run_id&&(F(V.run_id),w(U=>U??[]))}catch{return}}I(1),A("focus")};return n.useEffect(()=>{if(P!=="reader")return;const i=u=>{u.key==="Escape"&&(u.preventDefault(),A("list"))};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[P]),B||q?e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(X,{className:"h-8 w-32"}),e.jsx(X,{className:"h-10 w-10 rounded-full"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(X,{className:"h-10 w-32"}),e.jsx(X,{className:"h-10 w-32"})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[e.jsx(X,{className:"h-9 w-28 rounded-full"}),e.jsx(X,{className:"h-9 w-32 rounded-full"}),e.jsx(X,{className:"h-9 w-24 rounded-full"})]}),e.jsx(X,{className:"h-10 w-full rounded-lg"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((i,u)=>e.jsxs(pe,{className:"overflow-hidden",children:[e.jsx(He,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(X,{className:"h-5 w-48"}),e.jsx(X,{className:"h-4 w-32"})]}),e.jsx(X,{className:"h-6 w-20 rounded-full"})]})}),e.jsxs(Ke,{className:"space-y-2",children:[e.jsx(X,{className:"h-4 w-full"}),e.jsx(X,{className:"h-4 w-3/4"})]})]},`skeleton-${u}`))})]}):Me?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(Ct,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:Me.message}),e.jsx(_,{variant:"default",onClick:()=>Pe(),className:"mt-4 h-12 md:h-10",children:"Réessayer"})]}):e.jsx("div",{className:fe("space-y-4 md:space-y-6",H&&"dark bg-background text-foreground contrast-125",J&&"text-lg leading-relaxed [&_.text-xs]:text-sm [&_.text-sm]:text-base"),children:P==="focus"&&l?se?e.jsx("div",{className:"animate-in fade-in motion-reduce:animate-none",children:e.jsx(Pt,{session:l,exercises:se,oneRMs:me||[],exerciseNotes:te,onUpdateNote:(i,u)=>Re.mutate({exercise_id:i,notes:u}),initialLogs:Y,initialStep:K,isFinishing:Z,onStepChange:i=>I(i),onExitFocus:()=>A("reader"),onStart:async()=>{if(R)return;const i=b?.session_id??l?.id??null;if(!i){f({title:"Session manquante",description:"Impossible de démarrer sans session associée.",variant:"destructive"});return}const u={assignment_id:b?.id??null,athlete_id:a??null,athleteName:s??void 0,progress_pct:0,session_id:i,cycle_type:l?.cycle};try{const V=await re.mutateAsync(u);V?.run_id&&F(V.run_id)}catch{return}},onLogSets:async i=>{R&&(w(u=>[...u??[],...i]),await Promise.all(i.map((u,V)=>Ue.mutateAsync({run_id:R,exercise_id:u.exercise_id,set_index:u.set_number??V+1,reps:u.reps??null,weight:u.weight??null,athlete_id:a??null,athlete_name:s??null}))))},onProgress:async i=>{R&&await xe.mutateAsync({run_id:R,progress_pct:i,status:"in_progress"})},onFinish:i=>{R&&(G(!0),xe.mutate({assignment_id:b?.id??void 0,run_id:R,session_id:b?.session_id??l?.id??void 0,athlete_id:a??void 0,date:new Date().toISOString(),progress_pct:100,status:"completed",...i}))}})}):e.jsxs("div",{className:"space-y-4 py-10",children:[e.jsx("div",{className:"mx-auto h-8 w-48 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"mx-auto h-4 w-32 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"space-y-3 pt-4",children:[1,2,3].map(i=>e.jsx("div",{className:"h-20 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},i))})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sticky top-0 z-overlay -mx-4 backdrop-blur-md bg-background/90 border-b border-primary/15",children:e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"flex items-center justify-center h-7 w-7 rounded-lg bg-primary text-primary-foreground",children:e.jsx(Fe,{className:"h-3.5 w-3.5"})}),e.jsx("h1",{className:"text-lg font-display font-bold uppercase italic tracking-tight text-primary",children:"Séance"})]}),e.jsx("button",{type:"button",onClick:()=>A("settings"),className:"inline-flex items-center justify-center rounded-xl border border-primary/20 bg-primary/5 p-2 transition hover:bg-primary/10","aria-label":"Paramètres",children:e.jsx(Dt,{className:"h-4 w-4 text-primary"})})]})}),e.jsxs(at,{defaultValue:"start",className:"w-full",children:[e.jsxs(it,{className:"grid w-full grid-cols-2",children:[e.jsx(_s,{value:"start",children:"S'entraîner"}),e.jsx(_s,{value:"history",children:"Historique"})]}),e.jsxs(ks,{value:"start",className:"space-y-5 pt-4",children:[P==="list"&&e.jsx(Lt,{user:s,userId:a,athleteName:g,athleteId:k,athleteKey:N,cycleType:L,searchQuery:ae,isLoading:We,setSaveState:v,onCycleChange:Q,onSearchChange:le,onStartAssignment:i=>{i.session_type==="strength"&&Le(i)},onStartCatalog:qe,onResumeInProgress:({assignment:i,session:u,runId:V,logs:U,progressPct:D})=>{C(i),M(u),F(V),w(U),I(Qs(u?.items??[],U,D)),A("focus")}}),P==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>A("list"),className:"inline-flex items-center justify-center rounded-2xl border border-border bg-background p-2 transition hover:bg-muted","aria-label":"Retour",children:e.jsx(Vs,{className:"h-4 w-4"})}),e.jsx("h2",{className:"text-lg font-display font-bold uppercase italic tracking-tight",children:"Paramètres"})]}),e.jsxs(pe,{className:"border border-muted/60 shadow-sm",children:[e.jsxs(He,{children:[e.jsx(hs,{className:"text-lg uppercase",children:"Lisibilité & contrastes"}),e.jsx(Ds,{children:"Ajuste l'écran pour rester lisible en bassin comme en extérieur."})]}),e.jsxs(Ke,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Mode piscine"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Contraste renforcé et lisibilité optimisée."})]}),e.jsx(is,{checked:H,onCheckedChange:i=>$(u=>({...u,poolMode:i}))})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Texte grand"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Police plus large pour lire pendant l'effort."})]}),e.jsx(is,{checked:J,onCheckedChange:i=>$(u=>({...u,largeText:i}))})]})]})]}),e.jsx(pe,{className:"border border-muted/60 shadow-sm",children:e.jsxs(Ke,{className:"space-y-3 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsx(ht,{className:"h-4 w-4"}),e.jsx("span",{children:"Les préférences sont enregistrées sur cet appareil."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs font-semibold uppercase text-muted-foreground",children:[H&&e.jsx(Te,{variant:"secondary",children:"Mode piscine activé"}),J&&e.jsx(Te,{variant:"secondary",children:"Texte grand activé"}),!H&&!J&&e.jsx(Te,{variant:"outline",children:"Réglages par défaut"})]})]})})]}),P==="reader"&&l&&se&&e.jsx($t,{session:l,assignment:b,cycleType:L,cycleOptions:be,exercises:se,oneRMs:me||[],saveState:ge,onBack:()=>A("list"),onLaunch:Xe})]}),e.jsx(ks,{value:"history",className:"space-y-4 pt-4",children:e.jsx(zt,{athleteName:g,athleteId:k,athleteKey:N})})]})]})})}export{Nr as default};
