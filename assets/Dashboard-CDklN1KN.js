import{r as l,j as e,c as ht,u as Ye,d as Ce,a as _e}from"./vendor-query-BiSH4r2z.js";import{a as oe}from"./api-BYPGA3pp.js";import{c as xe,b as Et,W as Ue,X as Oe,F as yt,u as Ft,d as Ot,s as Te,B as Lt}from"./index-4NxNgYqB.js";import{T as je,P as It,C as Be,M as Pt,a as $t,b as Kt}from"./CalendarGrid-BHrvBizy.js";import{A as Me,B as Tt}from"./BottomActionBar-B-Ujuoi_.js";import{a as Bt,s as Rt,l as st}from"./animations-CrcLFysI.js";import{d as nt}from"./design-tokens-CKgCpdH6.js";import{C as Ze}from"./chevron-right-BOyUCCgN.js";import{T as Le}from"./timer-D1WwsrIj.js";import{P as me}from"./plus-BuQH_PXV.js";import{m as ie}from"./proxy-Dh0N-Z8G.js";import{C as qt}from"./chevron-down-DPxJtwCl.js";import{C as We}from"./check-cSRTxcf-.js";import{P as Qt}from"./pencil-CKjYUEuO.js";import{C as zt}from"./circle-alert-CaF6prtI.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-6k692oZB.js";import"./chevron-left-CAZIvbZC.js";import"./loader-circle-e06Q0mVP.js";import"./circle-check-I7kGIk8-.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Xe=xe("activity",Jt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Ge=xe("hash",Ht);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],rt=xe("info",Vt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=[["path",{d:"M5 12h14",key:"1ays0h"}]],Nt=xe("minus",Yt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],it=xe("settings-2",Ut);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Xt=xe("sun",Wt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],ot=xe("user-check",Gt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Ee=xe("user-x",Zt),Re={NL:"",DOS:"",BR:"",PAP:"",QN:""};function at(t){return String(t).padStart(2,"0")}function lt(t){return`${t.getFullYear()}-${at(t.getMonth()+1)}-${at(t.getDate())}`}function ct(t){return new Date(t.getFullYear(),t.getMonth(),1)}function dt(t,s){const n=new Date(t);return n.setDate(n.getDate()+s),n}function qe(t){return(t.getDay()+6)%7}function Ae(t){const s=Number(t);return Number.isFinite(s)?Math.round(s/1e3*100)/100:0}function es(t){const s=Number(t);return Number.isFinite(s)?Math.round(s*1e3):0}function ts(t){return t?String(t).replaceAll(`\r
`,`
`).split(`
`).map(n=>n.trim()).filter(Boolean).flatMap(n=>{const r=n.replace(/^[•\\-–—]\\s*/,"").trim();return r?[r]:[]}):[]}function ss(t){if(!t)return null;const n=String(t).match(/(\\d+(?:[\\.,]\\d+)?)\\s*(km|m)\\b/i);if(!n)return null;const r=Number(String(n[1]).replace(",","."));return Number.isFinite(r)?n[2].toLowerCase()==="m"?Ae(r):r:null}function ns(t,s){const n=t?.slot??t?.session_slot??t?.assigned_slot??t?.time_slot??t?.timeOfDay??t?.slot_key??t?.slotKey,r=String(n||"").toLowerCase();if(r.includes("mat")||r.includes("morning")||r==="am")return"AM";if(r.includes("soir")||r.includes("evening")||r==="pm")return"PM";const p=`${t?.title??""} ${t?.description??""}`.toLowerCase();return p.includes("matin")||p.includes(" am ")||p.includes("(am)")?"AM":p.includes("soir")||p.includes(" pm ")||p.includes("(pm)")?"PM":s===0?"AM":"PM"}function rs(t){const s=t?.assigned_date??t?.date??t?.day??t?.scheduled_for??t?.scheduledAt??null;if(!s)return null;const n=String(s),r=n.length>=10?n.slice(0,10):n;return/\d{4}-\d{2}-\d{2}/.test(r)?r:null}function is(t){if(Array.isArray(t?.items)){let p=0;for(const x of t.items){const f=Number(x?.distance);if(!Number.isFinite(f)||f<=0)continue;const c=x?.raw_payload,g=Number(c?.exercise_repetitions),N=Number(c?.block_repetitions),w=Number.isFinite(g)&&g>0?g:1,A=Number.isFinite(N)&&N>0?N:1;p+=f*w*A}if(p>0)return Ae(p)}const s=t?.distance_meters??t?.distanceMeters??t?.meters??t?.planned_meters??t?.plannedMeters??t?.distance??null;if(s!=null&&Number.isFinite(Number(s))){const p=Number(s);return p>0&&p<=50?p:Ae(p)}const n=t?.km??t?.distance_km??t?.distanceKm??t?.planned_km??t?.plannedKm??null;if(n!=null&&Number.isFinite(Number(n)))return Number(n);const r=ss(`${t?.title??""} ${t?.description??""}`);return r??null}function os(t){if(!Array.isArray(t)||t.length===0)return null;const s={crawl:"NL",dos:"DOS",brasse:"BR",pap:"PAP","4n":"QN"},n={NL:0,DOS:0,BR:0,PAP:0,QN:0};for(const p of t){const x=Number(p?.distance);if(!Number.isFinite(x)||x<=0)continue;const f=p?.raw_payload,c=Number(f?.exercise_repetitions),g=Number(f?.block_repetitions),N=Number.isFinite(c)&&c>0?c:1,w=Number.isFinite(g)&&g>0?g:1,A=x*N*w,T=f?.exercise_stroke??f?.stroke??"crawl",R=s[String(T).toLowerCase()];R?n[R]+=A:n.NL+=A}return Object.values(n).some(p=>p>0)?n:null}function ut(t){const s=Number(t);if(!Number.isFinite(s))return"—";const n=Math.round(s*100)/100,r=String(n);return r.endsWith(".0")?r.slice(0,-2):r}function as(){const t={};for(let s=0;s<7;s++)t[s]={AM:!0,PM:!0};return t}function Qe(t){if(!t)return null;try{return JSON.parse(t)}catch{return null}}function ls({sessions:t,assignments:s,userId:n,user:r}){const p=`swim-dashboard-v2:${n??r??"anon"}`,x=`${p}:presenceDefaults`,f=`${p}:attendanceOverrides`,c=`${p}:stableFields`,[g,N]=l.useState(()=>as()),[w,A]=l.useState({}),[T,R]=l.useState(90);l.useEffect(()=>{if(typeof window>"u")return;const a=Qe(window.localStorage.getItem(x));a&&N(a);const m=Qe(window.localStorage.getItem(f));m&&A(m);const d=Qe(window.localStorage.getItem(c));d?.duration&&Number.isFinite(d.duration)&&d.duration>=30&&d.duration<=240&&R(d.duration)},[x,f,c]),l.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(x,JSON.stringify(g))},[g,x]),l.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(f,JSON.stringify(w))},[w,f]),l.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(c,JSON.stringify({duration:T}))},[T,c]);const h=l.useMemo(()=>new Date,[]),[b,v]=l.useState(()=>ct(new Date)),[o,y]=l.useState(()=>lt(new Date)),[D,P]=l.useState(!1),[B,ae]=l.useState(!1),[fe,be]=l.useState(!1),[se,E]=l.useState(null),[z,$]=l.useState(!1),[q,O]=l.useState(null),[S,U]=l.useState(!1),[le,de]=l.useTransition(),F=l.useMemo(()=>(Array.isArray(s)?s:[]).filter(m=>m?.session_type==="swim"),[s]),J=l.useMemo(()=>{const a=new Map;for(const m of F){const d=rs(m);d&&(a.has(d)||a.set(d,[]),a.get(d).push(m))}for(const[m,d]of a.entries())d.sort((k,M)=>Number(k?.id??0)-Number(M?.id??0)),a.set(m,d);return a},[F]),_=l.useMemo(()=>{const a=Array.isArray(t)?t:[],m={};for(const d of a){const k=String(d?.date??"").slice(0,10),M=d?.slot==="Soir"?"PM":"AM";m[`${k}__${M}`]=d}return m},[t]),W=l.useRef(new Map);l.useEffect(()=>{W.current.clear()},[J]);const H=l.useCallback(a=>{const m=W.current;if(m.has(a))return m.get(a);const d=[{id:`${a}__AM`,iso:a,slotKey:"AM",title:"Séance vide",km:null,details:[],isEmpty:!0},{id:`${a}__PM`,iso:a,slotKey:"PM",title:"Séance vide",km:null,details:[],isEmpty:!0}],k=J.get(a)??[],M=new Set;return k.forEach((C,K)=>{const Y=C,ne=ns(Y,K);if(M.has(ne))return;const re=ne==="AM"?0:1,pe=is(Y),Pe=Array.isArray(Y?.details)?Y.details.map(String):ts(C?.description);d[re]={id:`${a}__${ne}`,iso:a,slotKey:ne,title:String(C?.title??"Séance coach"),km:pe,details:Pe,assignmentId:typeof C?.id=="number"?C.id:Number(C?.id)||void 0,isEmpty:!1},M.add(ne)}),m.set(a,d),d},[J]),ce=l.useCallback((a,m)=>{const d=qe(m),k=!!g?.[d]?.[a.slotKey],M=w[a.id];return M==="present"?{status:"present",expected:!0,expectedByDefault:k}:M==="absent"?{status:"absent",expected:!0,expectedByDefault:k}:k?{status:"present",expected:!0,expectedByDefault:k}:{status:"not_expected",expected:!1,expectedByDefault:k}},[w,g]),ee=l.useMemo(()=>ct(b),[b]),ge=l.useMemo(()=>{const a=qe(ee),m=dt(ee,-a),d=[];for(let k=0;k<42;k++)d.push(dt(m,k));return d},[ee]),ve=l.useMemo(()=>{const a={};for(const m of ge){const d=lt(m),k=H(d);let M=0,C=0;const K=[];for(const Y of k){const ne=ce(Y,m);if(!ne.expected){K.push({slotKey:Y.slotKey,expected:!1,completed:!1,absent:!1});continue}M+=1;const re=!!_[Y.id],pe=ne.status==="absent";re&&(C+=1),K.push({slotKey:Y.slotKey,expected:!0,completed:re,absent:pe})}a[d]={completed:C,total:M,slots:K}}return a},[ge,H,ce,_]),we=l.useMemo(()=>{const[a,m,d]=o.split("-").map(Number);return new Date(a,m-1,d)},[o]),X=l.useMemo(()=>H(o),[H,o]),G=ve[o]||{completed:0,total:2,slots:[{slotKey:"AM",expected:!0,completed:!1,absent:!1},{slotKey:"PM",expected:!0,completed:!1,absent:!1}]},he=l.useMemo(()=>{const a=Array.isArray(t)?t:[];let m=0;for(const d of a){const k=String(d?.date??"").slice(0,10),M=d?.slot==="Soir"?"PM":"AM",C=`${k}__${M}`;if(w[C]==="absent")continue;const K=qe(new Date(k));(g?.[K]?.[M]||w[C]==="present")&&Number.isFinite(Number(d?.distance))&&(m+=Number(d.distance))}return ut(Ae(m))},[t,w,g]),ye=l.useMemo(()=>{const a=X;let m=0;for(const d of a){const k=ce(d,we);if(!k.expected||k.status==="absent")continue;const M=_[d.id];M&&Number.isFinite(Number(M?.distance))&&(m+=Number(M.distance))}return ut(Ae(m))},[X,ce,we,_]),Ne=l.useMemo(()=>se&&_[se]||null,[se,_]),te=l.useMemo(()=>{const a=Ne||{},m=a?.stroke_distances,d=m?{NL:m.NL?String(m.NL):"",DOS:m.DOS?String(m.DOS):"",BR:m.BR?String(m.BR):"",PAP:m.PAP?String(m.PAP):"",QN:m.QN?String(m.QN):""}:Re;return{difficulty:a?.effort??null,fatigue_end:a?.fatigue??a?.feeling??null,performance:a?.performance??a?.feeling??null,engagement:a?.engagement??a?.feeling??null,comment:String(a?.comments??""),distanceMeters:Number.isFinite(Number(a?.distance))?Number(a.distance):null,showStrokeDetail:!!(m&&Object.values(m).some(k=>k&&k>0)),strokes:d,exerciseLogs:[]}},[Ne]),[Z,Q]=l.useState(()=>({difficulty:null,fatigue_end:null,performance:null,engagement:null,comment:"",distanceMeters:null,showStrokeDetail:!1,strokes:Re,exerciseLogs:[]}));return l.useEffect(()=>{const a=X.find(m=>m.id===se);if(a){const m=a.km!=null?es(a.km):5e3;let d=Re;if(a.assignmentId){const M=(s??[]).find(C=>C.id===a.assignmentId);if(M?.items){const C=os(M.items);C&&(d={NL:String(C.NL||""),DOS:String(C.DOS||""),BR:String(C.BR||""),PAP:String(C.PAP||""),QN:String(C.QN||"")})}}const k=Object.values(te.strokes).some(M=>M&&Number(M)>0);Q(M=>({...M,...te,distanceMeters:te.distanceMeters==null?m:te.distanceMeters,strokes:k?te.strokes:d,showStrokeDetail:k||Object.values(d).some(C=>C&&Number(C)>0)}));return}Q(m=>({...m,...te}))},[te,se,X,s]),l.useEffect(()=>{D&&S&&G.total>0&&G.completed>=G.total&&(P(!1),E(null),$(!1),U(!1))},[D,S,G.completed,G.total]),{today:h,monthCursor:b,selectedISO:o,drawerOpen:D,settingsOpen:B,infoOpen:fe,activeSessionId:se,detailsOpen:z,selectedDayIndex:q,isPending:le,presenceDefaults:g,attendanceOverrideBySessionId:w,stableDurationMin:T,draftState:Z,gridDates:ge,completionByISO:ve,selectedDate:we,sessionsForSelectedDay:X,selectedDayStatus:G,globalKm:he,dayKm:ye,logsBySessionId:_,setMonthCursor:v,setSelectedISO:y,setDrawerOpen:P,setSettingsOpen:ae,setInfoOpen:be,setActiveSessionId:E,setDetailsOpen:$,setSelectedDayIndex:O,setPresenceDefaults:N,setAttendanceOverrideBySessionId:A,setStableDurationMin:R,setDraftState:Q,setAutoCloseArmed:U,startTransition:de,getSessionStatus:ce,getSessionsForISO:H}}function ze(...t){return t.filter(Boolean).join(" ")}const mt={NL:"NL",DOS:"Dos",BR:"Brasse",PAP:"Pap",QN:"4N"};function cs({strokes:t,showStrokeDetail:s,disabled:n=!1,onToggle:r,onChange:p}){return e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{type:"button",disabled:n,onClick:r,className:ze("flex w-full items-center justify-between rounded-2xl border px-3 py-2 text-sm font-semibold transition",n?"text-muted-foreground border-border cursor-not-allowed":"text-foreground border-border hover:bg-muted"),children:[e.jsx("span",{children:"Détail par nage"}),e.jsx(Ze,{className:ze("h-4 w-4 transition-transform",s&&"rotate-90")})]}),s&&e.jsx("div",{className:"mt-2 grid grid-cols-5 gap-2",children:Object.keys(mt).map(x=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-center text-xs font-medium text-muted-foreground",children:mt[x]}),e.jsx("input",{type:"number",inputMode:"numeric",min:0,step:100,disabled:n,value:t[x],onChange:f=>p({...t,[x]:f.target.value}),placeholder:"0",className:ze("w-full rounded-xl border px-1 py-2 text-center text-sm outline-none",n?"bg-muted text-muted-foreground":"bg-card text-foreground border-border focus:ring-2 focus:ring-foreground/10")}),e.jsx("div",{className:"text-center text-[10px] text-muted-foreground",children:"m"})]},x))})]})}function Je(...t){return t.filter(Boolean).join(" ")}function ds({exerciseLogs:t,assignmentItems:s,disabled:n=!1,onLogsChange:r}){const[p,x]=l.useState(t.length>0),[f,c]=l.useState(""),g=h=>{const b=h.label||`Exercice ${h.ordre??""}`;t.some(v=>v.source_item_id===h.id)||r([...t,{exercise_label:b,source_item_id:h.id??null,split_times:[],tempo:null,stroke_count:[],notes:null}])},N=()=>{const h=f.trim();h&&(r([...t,{exercise_label:h,source_item_id:null,split_times:[],tempo:null,stroke_count:[],notes:null}]),c(""))},w=h=>{r(t.filter((b,v)=>v!==h))},A=(h,b)=>{r(t.map((v,o)=>o===h?{...v,...b}:v))},R=(Array.isArray(s)?s:[]).filter(h=>h.id!=null&&!t.some(b=>b.source_item_id===h.id));return e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{type:"button",disabled:n,onClick:()=>x(h=>!h),className:Je("flex w-full items-center justify-between rounded-2xl border px-3 py-2 text-sm font-semibold transition",n?"text-muted-foreground border-border cursor-not-allowed":"text-foreground border-border hover:bg-muted"),children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4"}),"Notes techniques",t.length>0&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-primary/10 px-1.5 py-0.5 text-xs font-semibold text-primary",children:t.length})]}),e.jsx(Ze,{className:Je("h-4 w-4 transition-transform",p&&"rotate-90")})]}),p&&!n&&e.jsxs("div",{className:"mt-2 space-y-3",children:[R.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Exercices de la seance"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:R.map(h=>e.jsxs("button",{type:"button",onClick:()=>g(h),className:"inline-flex items-center gap-1 rounded-full border border-border bg-card px-2.5 py-1 text-xs font-medium text-foreground hover:bg-muted transition",children:[e.jsx(me,{className:"h-3 w-3"}),h.label||`Ex. ${h.ordre??""}`]},h.id))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:f,onChange:h=>c(h.target.value),onKeyDown:h=>{h.key==="Enter"&&(h.preventDefault(),N())},placeholder:"Exercice libre (ex: 4x50 max)",className:"flex-1 rounded-xl border border-border bg-card px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-foreground/10"}),e.jsx("button",{type:"button",onClick:N,disabled:!f.trim(),className:Je("rounded-xl border px-3 py-2 text-sm font-semibold transition",f.trim()?"bg-card text-foreground border-border hover:bg-muted":"bg-muted text-muted-foreground border-border cursor-not-allowed"),children:e.jsx(me,{className:"h-4 w-4"})})]}),t.map((h,b)=>e.jsx(us,{log:h,onUpdate:v=>A(b,v),onRemove:()=>w(b)},b))]})]})}function us({log:t,onUpdate:s,onRemove:n}){const[r,p]=l.useState((t.split_times?.length??0)>0),[x,f]=l.useState((t.stroke_count?.length??0)>0),c=t.split_times??[],g=t.stroke_count??[],N=()=>{s({split_times:[...c,{rep:c.length+1,time_seconds:0}]}),p(!0)},w=(b,v)=>{s({split_times:c.map((o,y)=>y===b?{...o,time_seconds:v}:o)})},A=b=>{const v=c.filter((o,y)=>y!==b).map((o,y)=>({...o,rep:y+1}));s({split_times:v}),v.length===0&&p(!1)},T=()=>{s({stroke_count:[...g,{rep:g.length+1,count:0}]}),f(!0)},R=(b,v)=>{s({stroke_count:g.map((o,y)=>y===b?{...o,count:v}:o)})},h=b=>{const v=g.filter((o,y)=>y!==b).map((o,y)=>({...o,rep:y+1}));s({stroke_count:v}),v.length===0&&f(!1)};return e.jsxs("div",{className:"rounded-2xl border border-border bg-card overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-border bg-muted/50",children:[e.jsx("span",{className:"text-sm font-semibold text-foreground truncate",children:t.exercise_label}),e.jsx("button",{type:"button",onClick:n,className:"p-1 rounded-lg text-muted-foreground hover:text-destructive hover:bg-destructive/10 transition","aria-label":"Supprimer",children:e.jsx(je,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground min-w-[80px]",children:[e.jsx(Xe,{className:"h-3.5 w-3.5"}),"Tempo"]}),e.jsx("input",{type:"number",inputMode:"decimal",step:"0.1",min:0,value:t.tempo??"",onChange:b=>s({tempo:b.target.value?Number(b.target.value):null}),placeholder:"coups/min",className:"w-24 rounded-xl border border-border bg-background px-2 py-1.5 text-sm text-center outline-none focus:ring-2 focus:ring-foreground/10"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(Le,{className:"h-3.5 w-3.5"}),"Temps"]}),e.jsxs("button",{type:"button",onClick:N,className:"inline-flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition",children:[e.jsx(me,{className:"h-3 w-3"}),"Rep"]})]}),r&&c.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:c.map((b,v)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-4 text-right",children:b.rep}),e.jsx("input",{type:"number",inputMode:"decimal",step:"0.1",min:0,value:b.time_seconds||"",onChange:o=>w(v,Number(o.target.value)||0),placeholder:"sec",className:"w-16 rounded-lg border border-border bg-background px-1.5 py-1 text-xs text-center outline-none focus:ring-2 focus:ring-foreground/10"}),e.jsx("button",{type:"button",onClick:()=>A(v),className:"p-0.5 text-muted-foreground hover:text-destructive transition","aria-label":`Supprimer rep ${b.rep}`,children:e.jsx(je,{className:"h-3 w-3"})})]},v))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(Ge,{className:"h-3.5 w-3.5"}),"Coups de bras"]}),e.jsxs("button",{type:"button",onClick:T,className:"inline-flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition",children:[e.jsx(me,{className:"h-3 w-3"}),"Rep"]})]}),x&&g.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:g.map((b,v)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-4 text-right",children:b.rep}),e.jsx("input",{type:"number",inputMode:"numeric",min:0,value:b.count||"",onChange:o=>R(v,Number(o.target.value)||0),placeholder:"nb",className:"w-14 rounded-lg border border-border bg-background px-1.5 py-1 text-xs text-center outline-none focus:ring-2 focus:ring-foreground/10"}),e.jsx("button",{type:"button",onClick:()=>h(v),className:"p-0.5 text-muted-foreground hover:text-destructive transition","aria-label":`Supprimer rep ${b.rep}`,children:e.jsx(je,{className:"h-3 w-3"})})]},v))})]}),e.jsx("div",{children:e.jsx("textarea",{value:t.notes??"",onChange:b=>s({notes:b.target.value||null}),placeholder:"Notes libres...",rows:2,className:"w-full resize-none rounded-xl border border-border bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-foreground/10"})})]})]})}function I(...t){return t.filter(Boolean).join(" ")}function ms(t){return t.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}function Ie(t){const s=Number(t);if(!Number.isFinite(s))return"—";const n=Math.round(s*100)/100,r=String(n);return r.endsWith(".0")?r.slice(0,-2):r}function xt(t){const s=Number(t);return Number.isFinite(s)?Math.round(s/1e3*100)/100:0}function xs(t){const s=Number(t);return Number.isFinite(s)?Math.round(s*1e3):0}const He=[{key:"difficulty",label:"Difficulté",mode:"hard"},{key:"fatigue_end",label:"Fatigue fin",mode:"hard"},{key:"performance",label:"Perf perçue",mode:"good"},{key:"engagement",label:"Engagement",mode:"good"}],ps=[{key:"AM",label:"Matin",Icon:Xt},{key:"PM",label:"Soir",Icon:Pt}];function Fe({children:t}){return e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-2 py-0.5 text-xs font-semibold text-muted-foreground",children:t})}function Se({onClick:t,label:s,children:n,tone:r="neutral",disabled:p}){const x={neutral:"bg-background border-border text-foreground hover:bg-muted",dark:"bg-foreground border-foreground text-background hover:opacity-90",sky:"bg-primary/10 border-primary/30 text-primary hover:bg-primary/20"};return e.jsxs("button",{type:"button",onClick:t,disabled:p,className:I("inline-flex items-center justify-center rounded-2xl border p-2 transition",x[r],p&&"opacity-50 cursor-not-allowed hover:bg-background"),"aria-label":s,title:s,children:[n,e.jsx("span",{className:"sr-only",children:s})]})}function fs(t,s){const n=Number(s);return!Number.isFinite(n)||n<1||n>5?"neutral":t==="hard"?{1:"bg-intensity-1 border-intensity-1 text-white",2:"bg-intensity-2 border-intensity-2 text-white",3:"bg-intensity-3 border-intensity-3 text-white",4:"bg-intensity-4 border-intensity-4 text-white",5:"bg-intensity-5 border-intensity-5 text-white"}[n]:{1:"bg-intensity-5 border-intensity-5 text-white",2:"bg-intensity-4 border-intensity-4 text-white",3:"bg-intensity-3 border-intensity-3 text-white",4:"bg-intensity-2 border-intensity-2 text-white",5:"bg-intensity-1 border-intensity-1 text-white"}[n]}function bs({plannedMeters:t,valueMeters:s,onChange:n,disabled:r}){const c=Number.isFinite(Number(s))?Number(s):t,g=c-t;return e.jsxs("div",{className:I("mt-4 rounded-3xl border px-4 py-3",r?"bg-muted border-border":"bg-card border-border"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:I("text-xs font-semibold",r?"text-muted-foreground":"text-foreground"),children:"Ajuster kilométrage"}),g!==0&&e.jsx("div",{className:I("text-xs font-semibold px-2 py-0.5 rounded-full",g>0?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400"),children:g>0?`+${g}m`:`${g}m`})]}),e.jsx("div",{className:"text-center mb-3",children:e.jsxs("div",{className:I("text-xs","text-muted-foreground"),children:["Planifié : ",t,"m (",Ie(xt(t))," km)"]})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("button",{type:"button",disabled:r||c-100<0,onClick:()=>n(c-100),className:I("h-11 w-11 rounded-2xl border flex items-center justify-center transition-colors",r?"bg-muted border-border text-muted-foreground cursor-not-allowed":"bg-card border-border text-foreground hover:bg-muted active:scale-95"),"aria-label":"-100m",children:e.jsx(Nt,{className:"h-5 w-5"})}),e.jsxs("div",{className:"min-w-[140px] text-center",children:[e.jsxs("div",{className:I("text-2xl font-bold",r?"text-muted-foreground":"text-foreground"),children:[c,"m"]}),e.jsxs("div",{className:I("text-sm font-medium mt-0.5",r?"text-muted-foreground":"text-primary"),children:[Ie(xt(c))," km"]})]}),e.jsx("button",{type:"button",disabled:r||c+100>3e4,onClick:()=>n(c+100),className:I("h-11 w-11 rounded-2xl border flex items-center justify-center transition-colors",r?"bg-muted border-border text-muted-foreground cursor-not-allowed":"bg-card border-border text-foreground hover:bg-muted active:scale-95"),"aria-label":"+100m",children:e.jsx(me,{className:"h-5 w-5"})})]})]})}function gs({open:t,selectedDate:s,sessionsForSelectedDay:n,selectedDayStatus:r,dayKm:p,activeSessionId:x,detailsOpen:f,draftState:c,saveState:g,isPending:N,logsBySessionId:w,assignmentItems:A,onClose:T,onDayOffAll:R,onOpenSession:h,onCloseSession:b,onToggleDetails:v,onMarkAbsent:o,onMarkPresent:y,onClearOverride:D,onSaveFeedback:P,onDraftStateChange:B,getSessionStatus:ae}){const[,fe]=Et(),[be,se]=l.useState(!1),E=l.useMemo(()=>x&&n.find(z=>z.id===x)||null,[x,n]);return e.jsx(Me,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(ie.div,{className:"fixed inset-0 z-overlay bg-black/30",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:T}),e.jsx(ie.div,{className:I("fixed z-modal bg-background shadow-2xl","left-0 right-0 bottom-0 top-auto max-h-[calc(100dvh-env(safe-area-inset-top))] h-[88dvh] rounded-t-3xl","sm:right-0 sm:top-0 sm:left-auto sm:bottom-auto sm:h-full sm:w-full sm:max-w-xl sm:rounded-none"),variants:Bt,initial:"hidden",animate:"visible",exit:"exit",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"px-5 pt-3 sm:hidden",children:e.jsx("div",{className:"mx-auto h-1.5 w-12 rounded-full bg-muted"})}),e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b border-primary/15 bg-background px-4 sm:px-5 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2.5 min-w-0",children:[e.jsx("div",{className:"flex items-center justify-center h-7 w-7 rounded-lg bg-primary text-primary-foreground shrink-0",children:e.jsx(Ue,{className:"h-3.5 w-3.5"})}),e.jsx("div",{className:"min-w-0",children:e.jsx("div",{className:"truncate text-sm font-display font-bold uppercase italic tracking-tight text-primary",children:ms(s)})})]}),e.jsx(Se,{onClick:T,label:"Fermer",children:e.jsx(Oe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 sm:p-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2.5",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"text-lg font-bold text-foreground",children:[p," km"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:I("h-1.5 w-1.5 rounded-full",r.total>0&&r.completed>=1?"bg-status-success":"bg-muted-foreground/30")}),e.jsx("span",{className:I("h-1.5 w-1.5 rounded-full",r.total>0&&r.completed>=2?"bg-status-success":"bg-muted-foreground/30")})]})]})}),e.jsx(Se,{onClick:R,label:"OFF (absent journée)",tone:"dark",disabled:N,children:e.jsx(It,{className:"h-5 w-5"})})]}),(()=>{const z=[],$=[];for(const O of n)ae(O,s).status==="not_expected"?$.push(O):z.push(O);const q=O=>{const S=ae(O,s),U=!!w[O.id],le=S.status==="absent",de=S.status==="not_expected",F=le||de,J=S.expected&&!U&&!le,_=U?"bg-status-success-bg border-status-success/30":F?"bg-sky-50 border-sky-200":J?"bg-status-warning-bg border-status-warning/30":"bg-card border-border",W=ps.find(H=>H.key===O.slotKey)?.Icon||Be;return e.jsx("button",{type:"button",onClick:()=>h(O.id),className:I("w-full rounded-3xl border px-3 py-3 text-left transition",_,"hover:shadow-sm"),children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:I("h-10 w-10 rounded-2xl border flex items-center justify-center",U?"border-status-success/30 bg-status-success-bg":F?"border-sky-200 bg-sky-100":J?"border-status-warning/30 bg-status-warning-bg":"border-border bg-muted"),children:e.jsx(W,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:O.title}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[O.isEmpty?e.jsx(Fe,{children:"Vide"}):e.jsxs(Fe,{children:[Ie(O.km)," km"]}),U&&e.jsxs("span",{className:"inline-flex items-center text-emerald-800",children:[e.jsx(We,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Présent"})]}),F&&!U&&e.jsxs("span",{className:"inline-flex items-center text-sky-800",children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Absent"})]}),J&&e.jsxs("span",{className:"inline-flex items-center text-orange-900",children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"En attente"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[de&&e.jsx(Se,{onClick:H=>{H.stopPropagation(),y(O.id)},label:"Je suis venu",disabled:N,children:e.jsx(ot,{className:"h-5 w-5"})}),S.expected&&!U&&!le&&e.jsx(Se,{onClick:H=>{H.stopPropagation(),o(O.id)},label:"Absent",tone:"sky",disabled:N,children:e.jsx(Ee,{className:"h-5 w-5"})})]})]})},O.id)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-4 grid gap-2",children:z.map(q)}),$.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{type:"button",onClick:()=>se(O=>!O),className:"flex w-full items-center gap-2 rounded-2xl px-3 py-2 text-xs font-semibold text-muted-foreground hover:bg-muted transition",children:[e.jsx(qt,{className:I("h-4 w-4 transition-transform",be&&"rotate-180")}),"Autres séances (",$.length,")"]}),e.jsx(Me,{children:be&&e.jsx(ie.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsx("div",{className:"mt-1 grid gap-2",children:$.map(q)})})})]})]})})(),e.jsx(Me,{children:E&&e.jsx(ie.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:8},transition:{duration:nt.normal},className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:(()=>{const z=ae(E,s),$=z.status==="absent",q=z.status==="not_expected",O=!!w[E.id],S=z.expected&&!$,U=$?"Annuler":q?"Je suis venu":"Absent",le=$?()=>D(E.id):q?()=>y(E.id):()=>o(E.id),de=xs(E.km??0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:E.title}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[E.isEmpty?e.jsx(Fe,{children:"Vide"}):e.jsxs(Fe,{children:[Ie(E.km)," km"]}),O?e.jsxs("span",{className:"inline-flex items-center text-emerald-800",children:[e.jsx(We,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Présent"})]}):$||q?e.jsxs("span",{className:"inline-flex items-center text-sky-800",children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Absent"})]}):e.jsxs("span",{className:"inline-flex items-center text-orange-900",children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"En attente"})]})]})]}),e.jsx(Se,{onClick:b,label:"Retour",children:e.jsx(Oe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 p-3",children:[e.jsxs("button",{type:"button",onClick:le,className:I("rounded-2xl px-3 py-3 text-sm font-semibold border transition inline-flex items-center justify-center gap-2",q?"bg-foreground text-background border-foreground hover:opacity-90":"bg-card text-foreground border-border hover:bg-muted"),children:[q?e.jsx(ot,{className:"h-4 w-4"}):e.jsx(Ee,{className:"h-4 w-4"}),U]}),e.jsxs("button",{type:"button",onClick:v,className:"rounded-2xl px-3 py-3 text-sm font-semibold border border-border bg-card hover:bg-muted inline-flex items-center justify-center gap-2",children:[e.jsx(yt,{className:"h-4 w-4"}),"Fiche"]})]}),e.jsx(Me,{children:f&&e.jsxs(ie.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:6},transition:{duration:nt.normal},className:"mx-3 mb-3 rounded-2xl border border-border bg-muted p-3",children:[E.details?.length?e.jsx("ul",{className:"list-disc pl-5 space-y-1 text-sm text-foreground",children:E.details.map((F,J)=>e.jsx("li",{children:F},J))}):e.jsx("div",{className:"text-sm text-muted-foreground",children:E.assignmentId?"Séance coach — détails dans la fiche.":"Aucun détail pour ce créneau."}),E.assignmentId?e.jsx("div",{className:"mt-3",children:e.jsx("button",{type:"button",onClick:()=>fe(`/swim-session?assignmentId=${E.assignmentId}`),className:"w-full rounded-2xl border border-border bg-card px-3 py-2 text-sm font-semibold text-foreground hover:bg-muted",children:"Ouvrir la fiche complète"})}):null]})}),e.jsxs("div",{className:"px-4 pb-4",children:[!S&&e.jsx("div",{className:"mb-3 rounded-2xl bg-sky-50 text-sky-900 px-3 py-2 text-xs",children:$?"Absent: aucun ressenti.":'Non prévu: appuyez "Je suis venu".'}),e.jsxs(ie.div,{className:"space-y-4",variants:Rt,initial:"hidden",animate:"visible",children:[He.map(F=>{const J=c[F.key];return e.jsxs(ie.div,{className:"space-y-2",variants:st,children:[e.jsx("div",{className:I("text-sm font-semibold",S?"text-foreground":"text-muted-foreground"),children:F.label}),e.jsx("div",{className:"flex items-center gap-2",children:[1,2,3,4,5].map(_=>{const W=J===_;return e.jsx("button",{type:"button",disabled:!S,onClick:()=>B({...c,[F.key]:_}),className:I("h-11 w-11 rounded-2xl border text-sm font-semibold transition",S?W?fs(F.mode,_):"bg-card text-foreground border-border hover:bg-muted":"bg-muted text-muted-foreground border-border cursor-not-allowed"),children:_},_)})})]},F.key)}),e.jsxs(ie.div,{className:"space-y-2",variants:st,children:[e.jsx("div",{className:I("text-sm font-semibold",S?"text-foreground":"text-muted-foreground"),children:"Commentaire"}),e.jsx("textarea",{value:c.comment,onChange:F=>B({...c,comment:F.target.value}),disabled:!S,rows:3,placeholder:"Sensations, points techniques…",className:I("w-full resize-none rounded-3xl border px-4 py-3 text-sm outline-none",S?"bg-card text-foreground border-border focus:ring-2 focus:ring-foreground/10":"bg-muted text-muted-foreground border-border")})]})]}),e.jsx(bs,{plannedMeters:de,valueMeters:c.distanceMeters,onChange:F=>B({...c,distanceMeters:F}),disabled:!S}),e.jsx(cs,{strokes:c.strokes,showStrokeDetail:c.showStrokeDetail,disabled:!S,onToggle:()=>B({...c,showStrokeDetail:!c.showStrokeDetail}),onChange:F=>B({...c,strokes:F})}),e.jsx(ds,{exerciseLogs:c.exerciseLogs,assignmentItems:A,disabled:!S,onLogsChange:F=>B({...c,exerciseLogs:F})})]})]})})()},E.id)})]}),E&&(()=>{const z=ae(E,s),$=z.expected&&z.status!=="absent";return e.jsxs(Tt,{saveState:g,position:"static",children:[e.jsx("button",{type:"button",onClick:P,disabled:N||!$||!He.every(q=>Number.isInteger(c[q.key])),className:I("rounded-2xl px-4 py-3 text-sm font-semibold transition flex-1",N||!$?"bg-muted text-muted-foreground cursor-not-allowed":He.every(q=>Number.isInteger(c[q.key]))?"bg-status-success text-white hover:opacity-90":"bg-status-success-bg text-status-success cursor-not-allowed"),children:"Valider"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["→"," km"]})]})})()]})})]})})}function hs(...t){return t.filter(Boolean).join(" ")}function ys(t){try{return new Date(t).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short"})}catch{return t}}function Ns(t){if(!t||!Number.isFinite(t))return"—";if(t<60)return`${t.toFixed(1)}s`;const s=Math.floor(t/60),n=t%60;return`${s}:${n<10?"0":""}${n.toFixed(1)}`}function js({userId:t,expanded:s,onToggle:n}){const r=ht(),{data:p,isLoading:x}=Ye({queryKey:["swim-exercise-logs-history",t],queryFn:()=>oe.getSwimExerciseLogsHistory(t,100),enabled:!!t&&s}),f=Ce({mutationFn:({logId:N,patch:w})=>oe.updateSwimExerciseLog(N,w),onSuccess:()=>{r.invalidateQueries({queryKey:["swim-exercise-logs-history",t]})}}),c=Ce({mutationFn:N=>oe.deleteSwimExerciseLog(N),onSuccess:()=>{r.invalidateQueries({queryKey:["swim-exercise-logs-history",t]})}}),g=_e.useMemo(()=>{if(!p?.length)return[];const N=new Map;for(const w of p){const A=(w.created_at??"").slice(0,10);N.has(A)||N.set(A,[]),N.get(A).push(w)}return Array.from(N.entries()).map(([w,A])=>({date:w,entries:A}))},[p]);return e.jsxs("div",{className:"mt-6",children:[e.jsxs("button",{type:"button",onClick:n,className:"flex w-full items-center justify-between rounded-2xl border border-border px-3 py-2.5 text-sm font-semibold text-foreground hover:bg-muted transition",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(yt,{className:"h-4 w-4"}),"Historique notes techniques"]}),e.jsx(Ze,{className:hs("h-4 w-4 transition-transform",s&&"rotate-90")})]}),s&&e.jsxs("div",{className:"mt-3 space-y-3",children:[x&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"Chargement..."}),!x&&g.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucune note technique enregistree."}),g.map(({date:N,entries:w})=>e.jsxs("div",{className:"rounded-2xl border border-border overflow-hidden",children:[e.jsx("div",{className:"bg-muted/50 px-3 py-2 text-xs font-semibold text-muted-foreground",children:ys(N)}),e.jsx("div",{className:"divide-y divide-border",children:w.map(A=>e.jsx(vs,{log:A,onSave:T=>f.mutate({logId:A.id,patch:T}),onDelete:()=>c.mutate(A.id),saving:f.isPending},A.id))})]},N))]})]})}function vs({log:t,onSave:s,onDelete:n,saving:r}){const[p,x]=l.useState(!1),[f,c]=l.useState({notes:t.notes??"",tempo:t.tempo,split_times:t.split_times,stroke_count:t.stroke_count}),g=()=>{c({notes:t.notes??"",tempo:t.tempo,split_times:[...t.split_times],stroke_count:[...t.stroke_count]}),x(!0)},N=()=>x(!1),w=()=>{s({notes:f.notes.trim()||null,tempo:f.tempo,split_times:f.split_times,stroke_count:f.stroke_count}),x(!1)},A=()=>{c(o=>({...o,split_times:[...o.split_times,{rep:o.split_times.length+1,time_seconds:0}]}))},T=(o,y)=>{c(D=>({...D,split_times:D.split_times.map((P,B)=>B===o?{...P,time_seconds:y}:P)}))},R=o=>{c(y=>({...y,split_times:y.split_times.filter((D,P)=>P!==o).map((D,P)=>({...D,rep:P+1}))}))},h=()=>{c(o=>({...o,stroke_count:[...o.stroke_count,{rep:o.stroke_count.length+1,count:0}]}))},b=(o,y)=>{c(D=>({...D,stroke_count:D.stroke_count.map((P,B)=>B===o?{...P,count:y}:P)}))},v=o=>{c(y=>({...y,stroke_count:y.stroke_count.filter((D,P)=>P!==o).map((D,P)=>({...D,rep:P+1}))}))};return p?e.jsxs("div",{className:"px-3 py-2.5 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold text-foreground",children:t.exercise_label}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:w,disabled:r,className:"p-1.5 rounded-lg text-primary hover:bg-primary/10 transition","aria-label":"Enregistrer",children:e.jsx(We,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:N,className:"p-1.5 rounded-lg text-muted-foreground hover:bg-muted transition","aria-label":"Annuler",children:e.jsx(Oe,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:n,className:"p-1.5 rounded-lg text-muted-foreground hover:text-destructive hover:bg-destructive/10 transition","aria-label":"Supprimer",children:e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground min-w-[80px]",children:[e.jsx(Xe,{className:"h-3.5 w-3.5"}),"Tempo"]}),e.jsx("input",{type:"number",inputMode:"decimal",step:"0.1",min:0,value:f.tempo??"",onChange:o=>c(y=>({...y,tempo:o.target.value?Number(o.target.value):null})),placeholder:"coups/min",className:"w-24 rounded-xl border border-border bg-background px-2 py-1.5 text-sm text-center outline-none focus:ring-2 focus:ring-foreground/10"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(Le,{className:"h-3.5 w-3.5"}),"Temps"]}),e.jsxs("button",{type:"button",onClick:A,className:"inline-flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition",children:[e.jsx(me,{className:"h-3 w-3"}),"Rep"]})]}),f.split_times.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:f.split_times.map((o,y)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-4 text-right",children:o.rep}),e.jsx("input",{type:"number",inputMode:"decimal",step:"0.1",min:0,value:o.time_seconds||"",onChange:D=>T(y,Number(D.target.value)||0),placeholder:"sec",className:"w-16 rounded-lg border border-border bg-background px-1.5 py-1 text-xs text-center outline-none focus:ring-2 focus:ring-foreground/10"}),e.jsx("button",{type:"button",onClick:()=>R(y),className:"p-0.5 text-muted-foreground hover:text-destructive transition",children:e.jsx(je,{className:"h-3 w-3"})})]},y))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(Ge,{className:"h-3.5 w-3.5"}),"Coups de bras"]}),e.jsxs("button",{type:"button",onClick:h,className:"inline-flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition",children:[e.jsx(me,{className:"h-3 w-3"}),"Rep"]})]}),f.stroke_count.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:f.stroke_count.map((o,y)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-4 text-right",children:o.rep}),e.jsx("input",{type:"number",inputMode:"numeric",min:0,value:o.count||"",onChange:D=>b(y,Number(D.target.value)||0),placeholder:"nb",className:"w-14 rounded-lg border border-border bg-background px-1.5 py-1 text-xs text-center outline-none focus:ring-2 focus:ring-foreground/10"}),e.jsx("button",{type:"button",onClick:()=>v(y),className:"p-0.5 text-muted-foreground hover:text-destructive transition",children:e.jsx(je,{className:"h-3 w-3"})})]},y))})]}),e.jsx("textarea",{value:f.notes,onChange:o=>c(y=>({...y,notes:o.target.value})),placeholder:"Notes libres...",rows:2,className:"w-full resize-none rounded-xl border border-border bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-foreground/10"})]}):e.jsxs("div",{className:"px-3 py-2.5 space-y-1.5 group",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:t.exercise_label}),e.jsx("button",{type:"button",onClick:g,className:"p-1.5 rounded-lg text-muted-foreground hover:bg-muted transition","aria-label":"Modifier",children:e.jsx(Qt,{className:"h-3.5 w-3.5"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-xs text-muted-foreground",children:[t.tempo!=null&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Xe,{className:"h-3 w-3"}),t.tempo," c/min"]}),t.split_times.length>0&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Le,{className:"h-3 w-3"}),t.split_times.map(o=>Ns(o.time_seconds)).join(" / ")]}),t.stroke_count.length>0&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Ge,{className:"h-3 w-3"}),t.stroke_count.map(o=>o.count).join(" / ")," cps"]})]}),t.notes&&e.jsx("div",{className:"text-xs text-foreground/70 italic",children:t.notes})]})}const ws=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],ks=[{key:"AM",label:"Matin"},{key:"PM",label:"Soir"}],Ss=[{key:"difficulty",label:"Difficulté",mode:"hard"},{key:"fatigue_end",label:"Fatigue fin",mode:"hard"},{key:"performance",label:"Perf perçue",mode:"good"},{key:"engagement",label:"Engagement",mode:"good"}];function pt(...t){return t.filter(Boolean).join(" ")}function ft(t){return String(t).padStart(2,"0")}function Ve(t){return`${t.getFullYear()}-${ft(t.getMonth()+1)}-${ft(t.getDate())}`}function _s(t){return new Date(t.getFullYear(),t.getMonth(),1)}function Ms(t){const s=String(t).split("__");return{iso:s[0],slotKey:s[1]||""}}function bt(t,s){return Number.isFinite(t)?Math.round(t/s)*s:0}function gt({open:t,title:s,onClose:n,children:r}){return e.jsx(Me,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(ie.div,{className:"fixed inset-0 z-overlay bg-black/30",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n}),e.jsx(ie.div,{className:"fixed inset-0 z-modal flex items-end sm:items-center justify-center p-3 pb-24 sm:p-4 sm:pb-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},children:e.jsxs("div",{className:"w-full max-w-md rounded-3xl border bg-background shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[e.jsx("div",{className:"truncate text-base font-semibold text-foreground",children:s}),e.jsxs("button",{type:"button",onClick:n,className:"inline-flex items-center justify-center rounded-2xl border border-border bg-background p-2 transition hover:bg-muted","aria-label":"Fermer",children:[e.jsx(Oe,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Fermer"})]})]}),e.jsx("div",{className:"p-4",children:r})]})})]})})}function Ys(){const{user:t,userId:s}=Ft(),{toast:n}=Ot(),r=ht(),[p,x]=_e.useState("idle"),[f,c]=_e.useState(!1),[g,N]=_e.useState(null);_e.useEffect(()=>{Te.auth.getSession().then(({data:i})=>{N(i.session?.user?.id??null)})},[t]);const{data:w,isLoading:A,error:T,refetch:R}=Ye({queryKey:["sessions",s??t],queryFn:()=>oe.getSessions(t,s),enabled:!!t}),{data:h,isLoading:b,error:v,refetch:o}=Ye({queryKey:["assignments",t],queryFn:()=>oe.getAssignments(t,s),enabled:!!t}),y=A||b,D=T||v,P=()=>{R(),o()},B=Ce({mutationFn:i=>oe.deleteSession(i),onMutate:()=>{x("saving")},onSuccess:()=>{r.invalidateQueries({queryKey:["sessions"]}),r.invalidateQueries({queryKey:["hall-of-fame"]}),n({title:"Séance supprimée",description:"La saisie a été supprimée."}),x("saved"),setTimeout(()=>x("idle"),2e3)},onError:()=>{n({title:"Erreur",description:"Impossible de supprimer la séance.",variant:"destructive"}),x("error"),setTimeout(()=>x("idle"),3e3)}}),ae=Ce({mutationFn:async i=>{const{_exerciseLogs:u,...j}=i,L=await oe.syncSession({...j,athlete_name:t,athlete_id:s??void 0});if(u&&u.length>0&&L.sessionId)try{const{data:V}=await Te.auth.getSession(),ue=V.session?.user?.id;ue&&await oe.saveSwimExerciseLogs(L.sessionId,ue,u)}catch(V){console.warn("[EAC] Failed to save exercise logs:",V)}return L},onMutate:()=>{x("saving")},onSuccess:()=>{r.invalidateQueries({queryKey:["sessions"]}),r.invalidateQueries({queryKey:["assignments"]}),r.invalidateQueries({queryKey:["hall-of-fame"]}),n({title:"Séance enregistrée",description:"Vos données ont été synchronisées."}),x("saved"),setTimeout(()=>x("idle"),2e3)},onError:()=>{n({title:"Erreur",description:"Impossible d'enregistrer la séance.",variant:"destructive"}),x("error"),setTimeout(()=>x("idle"),3e3)}}),fe=Ce({mutationFn:async i=>{const{_exerciseLogs:u,...j}=i,L=await oe.updateSession(j);if(console.log("[EAC] updateMutation - exerciseLogs:",u),u&&j.id)try{const{data:V}=await Te.auth.getSession(),ue=V.session?.user?.id;console.log("[EAC] updateMutation - authUid:",ue,"sessionId:",j.id),ue?(console.log("[EAC] updateMutation - calling saveSwimExerciseLogs with logs:",u),await oe.saveSwimExerciseLogs(j.id,ue,u),console.log("[EAC] updateMutation - saveSwimExerciseLogs completed successfully")):console.warn("[EAC] updateMutation - No authUid found, skipping exercise logs save")}catch(V){throw console.error("[EAC] Failed to save exercise logs:",V),V}else console.log("[EAC] updateMutation - skipping exercise logs (empty or no session ID)");return L},onMutate:()=>{x("saving")},onSuccess:()=>{r.invalidateQueries({queryKey:["sessions"]}),r.invalidateQueries({queryKey:["hall-of-fame"]}),n({title:"Séance mise à jour",description:"Votre saisie a été mise à jour."}),x("saved"),setTimeout(()=>x("idle"),2e3)},onError:()=>{n({title:"Erreur",description:"Impossible de mettre à jour la séance.",variant:"destructive"}),x("error"),setTimeout(()=>x("idle"),3e3)}}),be=ls({sessions:w,assignments:h,userId:s,user:t}),{today:se,monthCursor:E,selectedISO:z,drawerOpen:$,settingsOpen:q,infoOpen:O,activeSessionId:S,detailsOpen:U,selectedDayIndex:le,isPending:de,presenceDefaults:F,stableDurationMin:J,draftState:_,gridDates:W,completionByISO:H,selectedDate:ce,sessionsForSelectedDay:ee,selectedDayStatus:ge,globalKm:ve,dayKm:we,logsBySessionId:X,setMonthCursor:G,setSelectedISO:he,setDrawerOpen:ye,setSettingsOpen:Ne,setInfoOpen:te,setActiveSessionId:Z,setDetailsOpen:Q,setSelectedDayIndex:a,setPresenceDefaults:m,setAttendanceOverrideBySessionId:d,setStableDurationMin:k,setDraftState:M,setAutoCloseArmed:C,startTransition:K,getSessionStatus:Y}=be,ne=l.useMemo(()=>{if(!S)return[];const i=ee.find(j=>j.id===S);if(!i?.assignmentId)return[];const u=(h??[]).find(j=>j.id===i.assignmentId);return u?.items?u.items.filter(j=>j.label):[]},[S,ee,h]),re=l.useCallback(i=>{he(i),ye(!0),Z(null),Q(!1);const u=H[i]||{completed:0,total:2};C(u.total>0&&u.completed<u.total)},[H,he,ye,Z,Q,C]),pe=l.useCallback(()=>{ye(!1),Z(null),Q(!1),C(!1),a(null)},[ye,Z,Q,C,a]),Pe=l.useCallback(()=>{G(i=>new Date(i.getFullYear(),i.getMonth()-1,1))},[G]),jt=l.useCallback(()=>{G(i=>new Date(i.getFullYear(),i.getMonth()+1,1))},[G]),vt=l.useCallback(()=>{const i=new Date;G(_s(i)),re(Ve(i))},[re,G]),$e=l.useCallback(i=>{Z(i),Q(!1)},[Z,Q]),wt=l.useCallback(i=>{K(()=>{d(j=>({...j,[i]:"absent"}))});const u=X[i];u?.id&&B.mutate(Number(u.id))},[B,X,K,d]),kt=l.useCallback(i=>{K(()=>{d(u=>({...u,[i]:"present"}))})},[K,d]),St=l.useCallback(i=>{K(()=>{d(u=>{const j={...u};return delete j[i],j})})},[K,d]),_t=l.useCallback(()=>{const i=ee.map(u=>Y(u,ce).expected?u.id:null).filter(Boolean);i.length!==0&&(K(()=>{d(u=>{const j={...u};for(const L of i)j[L]="absent";return j}),Z(null),Q(!1)}),i.forEach(u=>{const j=X[u];j?.id&&B.mutate(Number(j.id))}))},[ee,Y,ce,K,X,B,d,Z,Q]),Mt=l.useCallback(()=>{if(!S||!t||!Ss.every(ke=>Number.isInteger(_[ke.key])))return;const{iso:u,slotKey:j}=Ms(S),L=j==="PM"?"Soir":"Matin",V=bt(Number(_.distanceMeters??0),100),ue=bt(Number(J),15),Ke={};for(const[ke,Dt]of Object.entries(_.strokes)){const tt=Number(Dt);tt>0&&(Ke[ke]=tt)}const et={date:u,slot:L,distance:V,duration:ue,effort:Number(_.difficulty),feeling:Number(_.fatigue_end),performance:Number(_.performance),engagement:Number(_.engagement),comments:String(_.comment||"").slice(0,400),athlete_name:t,athlete_id:s??void 0,stroke_distances:Object.keys(Ke).length>0?Ke:null},De=X[S];console.log("[EAC] saveFeedback - draftState.exerciseLogs:",_.exerciseLogs),K(()=>{d(ke=>({...ke,[S]:"present"}))}),De?.id?(console.log("[EAC] saveFeedback - updating existing session:",De.id),fe.mutate({...et,id:De.id,created_at:De.created_at??new Date().toISOString(),_exerciseLogs:_.exerciseLogs.length>0?_.exerciseLogs:[]})):(console.log("[EAC] saveFeedback - creating new session"),ae.mutate({...et,_exerciseLogs:_.exerciseLogs.length>0?_.exerciseLogs:void 0})),Z(null),Q(!1)},[S,t,s,_,J,X,K,fe,ae,d,Z,Q]),Ct=l.useCallback((i,u)=>{m(j=>({...j,[i]:{...j[i],[u]:!j[i][u]}}))},[m]);l.useEffect(()=>{if(!$)return;const i=u=>{if(u.key==="Escape"){u.preventDefault(),pe();return}(u.key==="Enter"||u.key===" ")&&(u.preventDefault(),ee.length>0&&!S&&$e(ee[0].id))};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[$,pe,ee,S,$e]);const At=l.useCallback((i,u)=>{if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"," "].includes(i.key))return;if(i.preventDefault(),i.key==="Enter"||i.key===" "){const V=Ve(W[u]);re(V);return}let L=u;i.key==="ArrowLeft"&&(L=Math.max(0,u-1)),i.key==="ArrowRight"&&(L=Math.min(W.length-1,u+1)),i.key==="ArrowUp"&&(L=Math.max(0,u-7)),i.key==="ArrowDown"&&(L=Math.min(W.length-1,u+7)),a(L),he(Ve(W[L])),setTimeout(()=>{const V=document.querySelectorAll('[data-calendar-cell="true"]');V[L]&&V[L].focus()},0)},[W,re,a,he]);return y?e.jsxs("div",{className:"min-h-screen bg-muted",children:[e.jsx("div",{className:"sm:hidden fixed top-0 left-0 right-0 z-overlay border-b border-primary/15 bg-background/90 backdrop-blur-md",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-3 py-2.5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"h-7 w-7 rounded-lg bg-primary/20 animate-pulse"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"h-4 w-12 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-16 rounded bg-muted animate-pulse"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-9 w-9 rounded-xl bg-primary/5 animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-xl bg-primary/5 animate-pulse"})]})]})}),e.jsx("div",{className:"mx-auto max-w-6xl px-3 sm:px-4 pt-20 pb-5 sm:py-8",children:e.jsxs("div",{className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 sm:px-5 py-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"})]}),e.jsx("div",{className:"h-6 w-32 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"})]}),e.jsx("div",{className:"p-3 sm:p-5",children:e.jsxs("div",{className:"grid grid-cols-7 gap-1.5 sm:gap-2",children:[Array.from({length:7}).map((i,u)=>e.jsx("div",{className:"px-0.5 pb-1 flex justify-center",children:e.jsx("div",{className:"h-3 w-4 rounded bg-muted animate-pulse"})},`wh-${u}`)),Array.from({length:35}).map((i,u)=>e.jsx("div",{className:"aspect-square rounded-2xl bg-muted/50 animate-pulse"},`cs-${u}`))]})})]})})]}):D?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(zt,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:D.message}),e.jsx(Lt,{onClick:()=>P(),className:"mt-4",children:"Réessayer"})]}):e.jsxs("div",{className:"min-h-screen bg-muted",children:[e.jsx("div",{className:"sm:hidden fixed top-0 left-0 right-0 z-overlay border-b border-primary/15 bg-background/90 backdrop-blur-md",children:e.jsxs("div",{className:"px-4 py-2.5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"flex items-center justify-center h-7 w-7 rounded-lg bg-primary text-primary-foreground",children:e.jsx(Ue,{className:"h-3.5 w-3.5"})}),e.jsx("h1",{className:"text-lg font-display font-bold uppercase italic tracking-tight text-primary",children:"Suivi"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-mono font-semibold text-muted-foreground tabular-nums",children:[ve," km"]}),e.jsx("button",{type:"button",onClick:()=>te(!0),className:"inline-flex items-center justify-center rounded-xl border border-primary/20 bg-primary/5 p-2 transition hover:bg-primary/10","aria-label":"Infos",children:e.jsx(rt,{className:"h-5 w-5 text-primary"})}),e.jsx("button",{type:"button",onClick:()=>Ne(!0),className:"inline-flex items-center justify-center rounded-xl border border-primary/20 bg-primary/5 p-2 transition hover:bg-primary/10","aria-label":"Paramètres",children:e.jsx(it,{className:"h-5 w-5 text-primary"})})]})]})}),e.jsxs("div",{className:"mx-auto max-w-6xl px-3 sm:px-4 pt-20 pb-5 sm:py-8",children:[e.jsxs("div",{className:"invisible sm:visible flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"flex items-center justify-center h-7 w-7 rounded-lg bg-primary text-primary-foreground",children:e.jsx(Ue,{className:"h-3.5 w-3.5"})}),e.jsx("h1",{className:"text-lg font-display font-bold uppercase italic tracking-tight text-primary",children:"Suivi"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-mono font-semibold text-muted-foreground tabular-nums",children:[ve," km"]}),e.jsx("button",{type:"button",onClick:()=>te(!0),className:"inline-flex items-center justify-center rounded-xl border border-primary/20 bg-primary/5 p-2 transition hover:bg-primary/10","aria-label":"Infos",children:e.jsx(rt,{className:"h-5 w-5 text-primary"})}),e.jsx("button",{type:"button",onClick:()=>Ne(!0),className:"inline-flex items-center justify-center rounded-xl border border-primary/20 bg-primary/5 p-2 transition hover:bg-primary/10","aria-label":"Paramètres",children:e.jsx(it,{className:"h-5 w-5 text-primary"})})]})]}),e.jsxs("div",{className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:[e.jsx($t,{monthCursor:E,selectedDayStatus:ge,onPrevMonth:Pe,onNextMonth:jt,onJumpToday:vt}),e.jsx(Kt,{monthCursor:E,gridDates:W,completionByISO:H,selectedISO:z,selectedDayIndex:le,today:se,onDayClick:re,onKeyDown:At})]}),g&&e.jsx(js,{userId:g,expanded:f,onToggle:()=>c(i=>!i)}),e.jsx(gt,{open:O,title:"Codes",onClose:()=>te(!1),children:e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-orange-200 bg-orange-50 px-3 py-2",children:[e.jsx("span",{className:"font-semibold",children:"Orange"}),e.jsx("span",{className:"text-foreground",children:"À compléter"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-emerald-200 bg-emerald-50 px-3 py-2",children:[e.jsx("span",{className:"font-semibold",children:"Vert"}),e.jsx("span",{className:"text-foreground",children:"Validé → km"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-sky-200 bg-sky-50 px-3 py-2",children:[e.jsx("span",{className:"font-semibold",children:"Bleu"}),e.jsx("span",{className:"text-foreground",children:"Absent / Non prévu"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Les km comptent uniquement après validation."})]})}),e.jsx(gt,{open:q,title:"Présence",onClose:()=>Ne(!1),children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Toggle hebdo (séances attendues)."}),e.jsxs("div",{className:"overflow-hidden rounded-2xl border border-border bg-card",children:[e.jsxs("div",{className:"grid grid-cols-[1fr_110px_110px] bg-muted border-b border-border px-3 py-2 text-xs font-semibold text-muted-foreground",children:[e.jsx("div",{children:"Jour"}),e.jsx("div",{className:"text-center",children:"Matin"}),e.jsx("div",{className:"text-center",children:"Soir"})]}),ws.map((i,u)=>e.jsxs("div",{className:pt("grid grid-cols-[1fr_110px_110px] items-center px-3 py-2",u!==6&&"border-b border-border"),children:[e.jsx("div",{className:"text-sm font-medium text-foreground",children:i}),ks.map(j=>{const L=!!F?.[u]?.[j.key];return e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",onClick:()=>Ct(u,j.key),className:pt("w-24 rounded-2xl border px-3 py-2 text-sm font-semibold transition",L?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"),"aria-label":`${i} ${j.label}`,children:L?"On":"Off"})},j.key)})]},i))]}),e.jsxs("div",{className:"rounded-2xl border border-border bg-muted px-3 py-2",children:[e.jsx("div",{className:"text-xs font-semibold text-foreground",children:"Durée (valeur par défaut)"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"h-9 w-9 rounded-2xl border border-border bg-card hover:bg-muted flex items-center justify-center",onClick:()=>k(i=>Math.max(30,i-15)),"aria-label":"Diminuer la durée",children:e.jsx(Nt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"text-sm font-semibold text-foreground",children:[J," min"]}),e.jsx("button",{type:"button",className:"h-9 w-9 rounded-2xl border border-border bg-card hover:bg-muted flex items-center justify-center",onClick:()=>k(i=>Math.min(240,i+15)),"aria-label":"Augmenter la durée",children:e.jsx(me,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"mt-1 text-[11px] text-muted-foreground",children:"Durée envoyée au back-end (non affichée dans la maquette)."})]})]})}),e.jsx(gs,{open:$,selectedDate:ce,sessionsForSelectedDay:ee,selectedDayStatus:ge,dayKm:we,activeSessionId:S,detailsOpen:U,draftState:_,saveState:p,isPending:de,logsBySessionId:X,onClose:pe,onDayOffAll:_t,onOpenSession:$e,onCloseSession:()=>{Z(null),Q(!1)},onToggleDetails:()=>Q(i=>!i),onMarkAbsent:wt,onMarkPresent:kt,onClearOverride:St,onSaveFeedback:Mt,onDraftStateChange:M,getSessionStatus:Y,assignmentItems:ne})]})]})}export{Ys as default};
