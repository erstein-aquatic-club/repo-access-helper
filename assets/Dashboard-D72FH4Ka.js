import{r as c,j as e,R as Se}from"./vendor-ui-DJQMR4VV.js";import{u as We,b as $t,c as Pe}from"./vendor-query-BT4y-huw.js";import{c as de,b as It,X as Ue,W as Xe,F as ht,d as xe,u as Lt,f as Pt,s as Ke,B as Kt}from"./index-By6vndWk.js";import{C as Rt}from"./chevron-left-DoZ7YllO.js";import{C as Oe}from"./chevron-right-D1I-GcQ2.js";import{C as Ce}from"./circle-D-fAW11H.js";import{A as Fe,B as Bt,I as tt}from"./BottomActionBar-BQKeeARt.js";import{m as ce,a as Tt,s as qt,l as st}from"./animations-BTr26p-C.js";import{d as nt}from"./design-tokens-CGMys_0P.js";import{T as Ge}from"./timer-hlU1ejqi.js";import{P as Ne,T as Re}from"./trash-2-CpZU162b.js";import{C as rt}from"./check-CkycU_cH.js";import{C as zt}from"./circle-alert-BNLpPs_S.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-Db4xOvcx.js";import"./vendor-supabase-D7B1G6YZ.js";import"./loader-circle-sXnc5l0V.js";import"./circle-check-DneUCeIf.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],yt=de("activity",Qt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Nt=de("hash",Jt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=[["path",{d:"M5 12h14",key:"1ays0h"}]],jt=de("minus",Yt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],vt=de("moon",Ht);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],Wt=de("power",Vt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],ot=de("settings-2",Ut);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Gt=de("sun",Xt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],it=de("user-check",Zt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],De=de("user-x",es),Be={NL:"",DOS:"",BR:"",PAP:"",QN:""};function at(t){return String(t).padStart(2,"0")}function lt(t){return`${t.getFullYear()}-${at(t.getMonth()+1)}-${at(t.getDate())}`}function ct(t){return new Date(t.getFullYear(),t.getMonth(),1)}function dt(t,s){const n=new Date(t);return n.setDate(n.getDate()+s),n}function Te(t){return(t.getDay()+6)%7}function Me(t){const s=Number(t);return Number.isFinite(s)?Math.round(s/1e3*100)/100:0}function ts(t){const s=Number(t);return Number.isFinite(s)?Math.round(s*1e3):0}function ss(t){return t?String(t).replaceAll(`\r
`,`
`).split(`
`).map(n=>n.trim()).filter(Boolean).flatMap(n=>{const r=n.replace(/^[•\\-–—]\\s*/,"").trim();return r?[r]:[]}):[]}function ns(t){if(!t)return null;const n=String(t).match(/(\\d+(?:[\\.,]\\d+)?)\\s*(km|m)\\b/i);if(!n)return null;const r=Number(String(n[1]).replace(",","."));return Number.isFinite(r)?n[2].toLowerCase()==="m"?Me(r):r:null}function rs(t,s){const n=t?.slot??t?.session_slot??t?.assigned_slot??t?.time_slot??t?.timeOfDay??t?.slot_key??t?.slotKey,r=String(n||"").toLowerCase();if(r.includes("mat")||r.includes("morning")||r==="am")return"AM";if(r.includes("soir")||r.includes("evening")||r==="pm")return"PM";const u=`${t?.title??""} ${t?.description??""}`.toLowerCase();return u.includes("matin")||u.includes(" am ")||u.includes("(am)")?"AM":u.includes("soir")||u.includes(" pm ")||u.includes("(pm)")?"PM":s===0?"AM":"PM"}function os(t){const s=t?.assigned_date??t?.date??t?.day??t?.scheduled_for??t?.scheduledAt??null;if(!s)return null;const n=String(s),r=n.length>=10?n.slice(0,10):n;return/\d{4}-\d{2}-\d{2}/.test(r)?r:null}function is(t){if(Array.isArray(t?.items)){let u=0;for(const i of t.items){const g=Number(i?.distance);if(!Number.isFinite(g)||g<=0)continue;const l=i?.raw_payload,x=Number(l?.exercise_repetitions),N=Number(l?.block_repetitions),w=Number.isFinite(x)&&x>0?x:1,_=Number.isFinite(N)&&N>0?N:1;u+=g*w*_}if(u>0)return Me(u)}const s=t?.distance_meters??t?.distanceMeters??t?.meters??t?.planned_meters??t?.plannedMeters??t?.distance??null;if(s!=null&&Number.isFinite(Number(s))){const u=Number(s);return u>0&&u<=50?u:Me(u)}const n=t?.km??t?.distance_km??t?.distanceKm??t?.planned_km??t?.plannedKm??null;if(n!=null&&Number.isFinite(Number(n)))return Number(n);const r=ns(`${t?.title??""} ${t?.description??""}`);return r??null}function as(t){if(!Array.isArray(t)||t.length===0)return null;const s={crawl:"NL",dos:"DOS",brasse:"BR",pap:"PAP","4n":"QN"},n={NL:0,DOS:0,BR:0,PAP:0,QN:0};for(const u of t){const i=Number(u?.distance);if(!Number.isFinite(i)||i<=0)continue;const g=u?.raw_payload,l=Number(g?.exercise_repetitions),x=Number(g?.block_repetitions),N=Number.isFinite(l)&&l>0?l:1,w=Number.isFinite(x)&&x>0?x:1,_=i*N*w,P=g?.exercise_stroke??g?.stroke??"crawl",K=s[String(P).toLowerCase()];K?n[K]+=_:n.NL+=_}return Object.values(n).some(u=>u>0)?n:null}function ut(t){const s=Number(t);if(!Number.isFinite(s))return"—";const n=Math.round(s*100)/100,r=String(n);return r.endsWith(".0")?r.slice(0,-2):r}function ls(){const t={};for(let s=0;s<7;s++)t[s]={AM:!0,PM:!0};return t}function qe(t){if(!t)return null;try{return JSON.parse(t)}catch{return null}}function cs({sessions:t,assignments:s,userId:n,user:r}){const u=`swim-dashboard-v2:${n??r??"anon"}`,i=`${u}:presenceDefaults`,g=`${u}:attendanceOverrides`,l=`${u}:stableFields`,[x,N]=c.useState(()=>ls()),[w,_]=c.useState({}),[P,K]=c.useState(90);c.useEffect(()=>{if(typeof window>"u")return;const a=qe(window.localStorage.getItem(i));a&&N(a);const f=qe(window.localStorage.getItem(g));f&&_(f);const d=qe(window.localStorage.getItem(l));d?.duration&&Number.isFinite(d.duration)&&d.duration>=30&&d.duration<=240&&K(d.duration)},[i,g,l]),c.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(i,JSON.stringify(x))},[x,i]),c.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(g,JSON.stringify(w))},[w,g]),c.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(l,JSON.stringify({duration:P}))},[P,l]);const b=c.useMemo(()=>new Date,[]),[p,h]=c.useState(()=>ct(new Date)),[v,E]=c.useState(()=>lt(new Date)),[Z,ee]=c.useState(!1),[B,q]=c.useState(!1),[be,D]=c.useState(!1),[M,L]=c.useState(null),[O,U]=c.useState(!1),[T,re]=c.useState(null),[$,ue]=c.useState(!1),[C,Y]=c.useTransition(),te=c.useMemo(()=>(Array.isArray(s)?s:[]).filter(f=>f?.session_type==="swim"),[s]),oe=c.useMemo(()=>{const a=new Map;for(const f of te){const d=os(f);d&&(a.has(d)||a.set(d,[]),a.get(d).push(f))}for(const[f,d]of a.entries())d.sort((j,k)=>Number(j?.id??0)-Number(k?.id??0)),a.set(f,d);return a},[te]),A=c.useMemo(()=>{const a=Array.isArray(t)?t:[],f={};for(const d of a){const j=String(d?.date??"").slice(0,10),k=d?.slot==="Soir"?"PM":"AM";f[`${j}__${k}`]=d}return f},[t]),ie=c.useRef(new Map);c.useEffect(()=>{ie.current.clear()},[oe]);const ae=c.useCallback(a=>{const f=ie.current;if(f.has(a))return f.get(a);const d=[{id:`${a}__AM`,iso:a,slotKey:"AM",title:"Séance vide",km:null,details:[],isEmpty:!0},{id:`${a}__PM`,iso:a,slotKey:"PM",title:"Séance vide",km:null,details:[],isEmpty:!0}],j=oe.get(a)??[],k=new Set;return j.forEach((S,R)=>{const J=S,se=rs(J,R);if(k.has(se))return;const ne=se==="AM"?0:1,fe=is(J),$e=Array.isArray(J?.details)?J.details.map(String):ss(S?.description);d[ne]={id:`${a}__${se}`,iso:a,slotKey:se,title:String(S?.title??"Séance coach"),km:fe,details:$e,assignmentId:typeof S?.id=="number"?S.id:Number(S?.id)||void 0,isEmpty:!1},k.add(se)}),f.set(a,d),d},[oe]),le=c.useCallback((a,f)=>{const d=Te(f),j=!!x?.[d]?.[a.slotKey],k=w[a.id];return k==="present"?{status:"present",expected:!0,expectedByDefault:j}:k==="absent"?{status:"absent",expected:!0,expectedByDefault:j}:j?{status:"present",expected:!0,expectedByDefault:j}:{status:"not_expected",expected:!1,expectedByDefault:j}},[w,x]),X=c.useMemo(()=>ct(p),[p]),pe=c.useMemo(()=>{const a=Te(X),f=dt(X,-a),d=[];for(let j=0;j<42;j++)d.push(dt(f,j));return d},[X]),je=c.useMemo(()=>{const a={};for(const f of pe){const d=lt(f),j=ae(d);let k=0,S=0;const R=[];for(const J of j){const se=le(J,f);if(!se.expected){R.push({slotKey:J.slotKey,expected:!1,completed:!1,absent:!1});continue}k+=1;const ne=!!A[J.id],fe=se.status==="absent";ne&&(S+=1),R.push({slotKey:J.slotKey,expected:!0,completed:ne,absent:fe})}a[d]={completed:S,total:k,slots:R}}return a},[pe,ae,le,A]),ve=c.useMemo(()=>{const[a,f,d]=v.split("-").map(Number);return new Date(a,f-1,d)},[v]),H=c.useMemo(()=>ae(v),[ae,v]),V=je[v]||{completed:0,total:2,slots:[{slotKey:"AM",expected:!0,completed:!1,absent:!1},{slotKey:"PM",expected:!0,completed:!1,absent:!1}]},ge=c.useMemo(()=>{const a=Array.isArray(t)?t:[];let f=0;for(const d of a){const j=String(d?.date??"").slice(0,10),k=d?.slot==="Soir"?"PM":"AM",S=`${j}__${k}`;if(w[S]==="absent")continue;const R=Te(new Date(j));(x?.[R]?.[k]||w[S]==="present")&&Number.isFinite(Number(d?.distance))&&(f+=Number(d.distance))}return ut(Me(f))},[t,w,x]),he=c.useMemo(()=>{const a=H;let f=0;for(const d of a){const j=le(d,ve);if(!j.expected||j.status==="absent")continue;const k=A[d.id];k&&Number.isFinite(Number(k?.distance))&&(f+=Number(k.distance))}return ut(Me(f))},[H,le,ve,A]),ye=c.useMemo(()=>M&&A[M]||null,[M,A]),G=c.useMemo(()=>{const a=ye||{},f=a?.stroke_distances,d=f?{NL:f.NL?String(f.NL):"",DOS:f.DOS?String(f.DOS):"",BR:f.BR?String(f.BR):"",PAP:f.PAP?String(f.PAP):"",QN:f.QN?String(f.QN):""}:Be;return{difficulty:a?.effort??null,fatigue_end:a?.fatigue??a?.feeling??null,performance:a?.performance??a?.feeling??null,engagement:a?.engagement??a?.feeling??null,comment:String(a?.comments??""),distanceMeters:Number.isFinite(Number(a?.distance))?Number(a.distance):null,showStrokeDetail:!!(f&&Object.values(f).some(j=>j&&j>0)),strokes:d,exerciseLogs:[]}},[ye]),[W,z]=c.useState(()=>({difficulty:null,fatigue_end:null,performance:null,engagement:null,comment:"",distanceMeters:null,showStrokeDetail:!1,strokes:Be,exerciseLogs:[]}));return c.useEffect(()=>{const a=H.find(f=>f.id===M);if(a){const f=ts(a.km??0);let d=Be;if(a.assignmentId){const k=(s??[]).find(S=>S.id===a.assignmentId);if(k?.items){const S=as(k.items);S&&(d={NL:String(S.NL||""),DOS:String(S.DOS||""),BR:String(S.BR||""),PAP:String(S.PAP||""),QN:String(S.QN||"")})}}const j=Object.values(G.strokes).some(k=>k&&Number(k)>0);z(k=>({...k,...G,distanceMeters:G.distanceMeters==null?f:G.distanceMeters,strokes:j?G.strokes:d,showStrokeDetail:j||Object.values(d).some(S=>S&&Number(S)>0)}));return}z(f=>({...f,...G}))},[G,M,H,s]),c.useEffect(()=>{Z&&$&&V.total>0&&V.completed>=V.total&&(ee(!1),L(null),U(!1),ue(!1))},[Z,$,V.completed,V.total]),{today:b,monthCursor:p,selectedISO:v,drawerOpen:Z,settingsOpen:B,infoOpen:be,activeSessionId:M,detailsOpen:O,selectedDayIndex:T,isPending:C,presenceDefaults:x,attendanceOverrideBySessionId:w,stableDurationMin:P,draftState:W,gridDates:pe,completionByISO:je,selectedDate:ve,sessionsForSelectedDay:H,selectedDayStatus:V,globalKm:ge,dayKm:he,logsBySessionId:A,setMonthCursor:h,setSelectedISO:E,setDrawerOpen:ee,setSettingsOpen:q,setInfoOpen:D,setActiveSessionId:L,setDetailsOpen:U,setSelectedDayIndex:re,setPresenceDefaults:N,setAttendanceOverrideBySessionId:_,setStableDurationMin:K,setDraftState:z,setAutoCloseArmed:ue,startTransition:Y,getSessionStatus:le,getSessionsForISO:ae}}function wt(...t){return t.filter(Boolean).join(" ")}function ds(t){return t.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})}function ze({onClick:t,label:s,children:n,tone:r="neutral",disabled:u}){const i={neutral:"bg-background border-border text-foreground hover:bg-muted",dark:"bg-foreground border-foreground text-background hover:opacity-90",sky:"bg-primary/10 border-primary/30 text-primary hover:bg-primary/20"};return e.jsxs("button",{type:"button",onClick:t,disabled:u,className:wt("inline-flex items-center justify-center rounded-2xl border p-2 transition",i[r],u&&"opacity-50 cursor-not-allowed hover:bg-background"),"aria-label":s,title:s,children:[n,e.jsx("span",{className:"sr-only",children:s})]})}function us({monthCursor:t,selectedDayStatus:s,onPrevMonth:n,onNextMonth:r,onJumpToday:u}){return e.jsxs("div",{className:"flex items-center justify-between px-3 sm:px-5 py-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ze,{onClick:n,label:"Mois précédent",children:e.jsx(Rt,{className:"h-5 w-5"})}),e.jsx(ze,{onClick:r,label:"Mois suivant",children:e.jsx(Oe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"min-w-0 text-center",children:[e.jsx("div",{className:"text-base font-semibold text-foreground capitalize truncate",children:ds(t)}),e.jsx("div",{className:"mt-1 flex items-center justify-center gap-1",children:s.total>0?s.slots.filter(i=>i.expected).map(i=>e.jsx("span",{className:wt("h-1.5 w-1.5 rounded-full",i.completed?"bg-status-success":i.absent?"bg-muted-foreground/15":"bg-muted-foreground/30")},i.slotKey)):e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"repos"})})]}),e.jsx(ze,{onClick:u,label:"Aller à aujourd'hui",tone:"neutral",children:e.jsx(Ce,{className:"h-5 w-5"})})]})}function Qe(...t){return t.filter(Boolean).join(" ")}function ms(t){const s=n=>String(n).padStart(2,"0");return`${t.getFullYear()}-${s(t.getMonth()+1)}-${s(t.getDate())}`}const xs=c.memo(function({date:s,inMonth:n,isToday:r,isSelected:u,isFocused:i,status:g,onClick:l,onKeyDown:x}){const{total:N,slots:w}=g,_=N===0,P=w.filter(q=>q.expected),K=P.length>0&&P.every(q=>q.absent),b=N>0&&g.completed===N&&!K,p=_?"bg-muted/30":b?"bg-status-success/10":"bg-card",h="border-border",v=u?"ring-2 ring-primary/30":"",E=r&&!u?"ring-2 ring-primary/50":"",Z=i?"ring-2 ring-primary":"",ee=w.find(q=>q.slotKey==="AM"),B=w.find(q=>q.slotKey==="PM");return e.jsx("button",{type:"button",onClick:l,onKeyDown:x,tabIndex:i?0:-1,"data-calendar-cell":"true",className:Qe("aspect-square min-w-0 rounded-2xl border p-1 transition",p,h,!n&&"opacity-40","hover:shadow-sm focus:outline-none",v,E,Z),"aria-label":`${ms(s)} — ${_?"Repos":`${g.completed}/${N}`}`,children:e.jsxs("div",{className:"flex h-full flex-col justify-between",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:"text-[12px] font-semibold text-foreground",children:s.getDate()}),e.jsx("div",{className:"h-[14px] w-[14px]"})]}),e.jsx("div",{className:"flex items-center justify-end",children:_?e.jsx(vt,{className:"h-3 w-3 text-muted-foreground/40"}):e.jsx("div",{className:"w-6",children:e.jsxs("div",{className:"flex gap-1",children:[ee?.expected?e.jsx("span",{className:Qe("h-1.5 flex-1 rounded-full",ee.completed?"bg-status-success":ee.absent?"bg-muted-foreground/15":"bg-muted-foreground/30")}):e.jsx("span",{className:"flex-1"}),B?.expected?e.jsx("span",{className:Qe("h-1.5 flex-1 rounded-full",B.completed?"bg-status-success":B.absent?"bg-muted-foreground/15":"bg-muted-foreground/30")}):e.jsx("span",{className:"flex-1"})]})})})]})})}),fs=["L","M","M","J","V","S","D"],bs=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"];function ps(t){const s=n=>String(n).padStart(2,"0");return`${t.getFullYear()}-${s(t.getMonth()+1)}-${s(t.getDate())}`}function gs(t,s){return t.getFullYear()===s.getFullYear()&&t.getMonth()===s.getMonth()&&t.getDate()===s.getDate()}function hs({monthCursor:t,gridDates:s,completionByISO:n,selectedISO:r,selectedDayIndex:u,today:i,onDayClick:g,onKeyDown:l}){return e.jsx("div",{className:"p-3 sm:p-5",children:e.jsxs("div",{className:"grid grid-cols-7 gap-1.5 sm:gap-2",children:[fs.map((x,N)=>e.jsxs("div",{className:"px-0.5 pb-1 text-[10px] font-semibold text-muted-foreground text-center",children:[e.jsx("span",{className:"sm:hidden",children:x}),e.jsx("span",{className:"hidden sm:inline",children:bs[N]})]},x+N)),s.map((x,N)=>{const w=ps(x),_=x.getMonth()===t.getMonth(),P=w===r,K=n[w]||{completed:0,total:2,slots:[{slotKey:"AM",expected:!0,completed:!1,absent:!1},{slotKey:"PM",expected:!0,completed:!1,absent:!1}]},b=gs(x,i),p=u===N||u===null&&b;return e.jsx(xs,{date:x,inMonth:_,isToday:b,isSelected:P,isFocused:p,status:K,onClick:()=>g(w),onKeyDown:h=>l(h,N)},w)})]})})}function Je(...t){return t.filter(Boolean).join(" ")}const mt={NL:"NL",DOS:"Dos",BR:"Brasse",PAP:"Pap",QN:"4N"};function ys({strokes:t,showStrokeDetail:s,disabled:n=!1,onToggle:r,onChange:u}){return e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{type:"button",disabled:n,onClick:r,className:Je("flex w-full items-center justify-between rounded-2xl border px-3 py-2 text-sm font-semibold transition",n?"text-muted-foreground border-border cursor-not-allowed":"text-foreground border-border hover:bg-muted"),children:[e.jsx("span",{children:"Détail par nage"}),e.jsx(Oe,{className:Je("h-4 w-4 transition-transform",s&&"rotate-90")})]}),s&&e.jsx("div",{className:"mt-2 grid grid-cols-5 gap-2",children:Object.keys(mt).map(i=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-center text-xs font-medium text-muted-foreground",children:mt[i]}),e.jsx("input",{type:"number",inputMode:"numeric",min:0,step:100,disabled:n,value:t[i],onChange:g=>u({...t,[i]:g.target.value}),placeholder:"0",className:Je("w-full rounded-xl border px-1 py-2 text-center text-sm outline-none",n?"bg-muted text-muted-foreground":"bg-card text-foreground border-border focus:ring-2 focus:ring-foreground/10")}),e.jsx("div",{className:"text-center text-[10px] text-muted-foreground",children:"m"})]},i))})]})}function Ye(...t){return t.filter(Boolean).join(" ")}function Ns({exerciseLogs:t,assignmentItems:s,disabled:n=!1,onLogsChange:r}){const[u,i]=c.useState(t.length>0),[g,l]=c.useState(""),x=b=>{const p=b.label||`Exercice ${b.ordre??""}`;t.some(h=>h.source_item_id===b.id)||r([...t,{exercise_label:p,source_item_id:b.id??null,split_times:[],tempo:null,stroke_count:[],notes:null}])},N=()=>{const b=g.trim();b&&(r([...t,{exercise_label:b,source_item_id:null,split_times:[],tempo:null,stroke_count:[],notes:null}]),l(""))},w=b=>{r(t.filter((p,h)=>h!==b))},_=(b,p)=>{r(t.map((h,v)=>v===b?{...h,...p}:h))},K=(Array.isArray(s)?s:[]).filter(b=>b.id!=null&&!t.some(p=>p.source_item_id===b.id));return e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{type:"button",disabled:n,onClick:()=>i(b=>!b),className:Ye("flex w-full items-center justify-between rounded-2xl border px-3 py-2 text-sm font-semibold transition",n?"text-muted-foreground border-border cursor-not-allowed":"text-foreground border-border hover:bg-muted"),children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-4 w-4"}),"Notes techniques",t.length>0&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-primary/10 px-1.5 py-0.5 text-xs font-semibold text-primary",children:t.length})]}),e.jsx(Oe,{className:Ye("h-4 w-4 transition-transform",u&&"rotate-90")})]}),u&&!n&&e.jsxs("div",{className:"mt-2 space-y-3",children:[K.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Exercices de la seance"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:K.map(b=>e.jsxs("button",{type:"button",onClick:()=>x(b),className:"inline-flex items-center gap-1 rounded-full border border-border bg-card px-2.5 py-1 text-xs font-medium text-foreground hover:bg-muted transition",children:[e.jsx(Ne,{className:"h-3 w-3"}),b.label||`Ex. ${b.ordre??""}`]},b.id))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:g,onChange:b=>l(b.target.value),onKeyDown:b=>{b.key==="Enter"&&(b.preventDefault(),N())},placeholder:"Exercice libre (ex: 4x50 max)",className:"flex-1 rounded-xl border border-border bg-card px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-foreground/10"}),e.jsx("button",{type:"button",onClick:N,disabled:!g.trim(),className:Ye("rounded-xl border px-3 py-2 text-sm font-semibold transition",g.trim()?"bg-card text-foreground border-border hover:bg-muted":"bg-muted text-muted-foreground border-border cursor-not-allowed"),children:e.jsx(Ne,{className:"h-4 w-4"})})]}),t.map((b,p)=>e.jsx(js,{log:b,onUpdate:h=>_(p,h),onRemove:()=>w(p)},p))]})]})}function js({log:t,onUpdate:s,onRemove:n}){const[r,u]=c.useState((t.split_times?.length??0)>0),[i,g]=c.useState((t.stroke_count?.length??0)>0),l=t.split_times??[],x=t.stroke_count??[],N=()=>{s({split_times:[...l,{rep:l.length+1,time_seconds:0}]}),u(!0)},w=(p,h)=>{s({split_times:l.map((v,E)=>E===p?{...v,time_seconds:h}:v)})},_=p=>{const h=l.filter((v,E)=>E!==p).map((v,E)=>({...v,rep:E+1}));s({split_times:h}),h.length===0&&u(!1)},P=()=>{s({stroke_count:[...x,{rep:x.length+1,count:0}]}),g(!0)},K=(p,h)=>{s({stroke_count:x.map((v,E)=>E===p?{...v,count:h}:v)})},b=p=>{const h=x.filter((v,E)=>E!==p).map((v,E)=>({...v,rep:E+1}));s({stroke_count:h}),h.length===0&&g(!1)};return e.jsxs("div",{className:"rounded-2xl border border-border bg-card overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-border bg-muted/50",children:[e.jsx("span",{className:"text-sm font-semibold text-foreground truncate",children:t.exercise_label}),e.jsx("button",{type:"button",onClick:n,className:"p-1 rounded-lg text-muted-foreground hover:text-destructive hover:bg-destructive/10 transition","aria-label":"Supprimer",children:e.jsx(Re,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground min-w-[80px]",children:[e.jsx(yt,{className:"h-3.5 w-3.5"}),"Tempo"]}),e.jsx("input",{type:"number",inputMode:"decimal",step:"0.1",min:0,value:t.tempo??"",onChange:p=>s({tempo:p.target.value?Number(p.target.value):null}),placeholder:"coups/min",className:"w-24 rounded-xl border border-border bg-background px-2 py-1.5 text-sm text-center outline-none focus:ring-2 focus:ring-foreground/10"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(Ge,{className:"h-3.5 w-3.5"}),"Temps"]}),e.jsxs("button",{type:"button",onClick:N,className:"inline-flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition",children:[e.jsx(Ne,{className:"h-3 w-3"}),"Rep"]})]}),r&&l.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:l.map((p,h)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-4 text-right",children:p.rep}),e.jsx("input",{type:"number",inputMode:"decimal",step:"0.1",min:0,value:p.time_seconds||"",onChange:v=>w(h,Number(v.target.value)||0),placeholder:"sec",className:"w-16 rounded-lg border border-border bg-background px-1.5 py-1 text-xs text-center outline-none focus:ring-2 focus:ring-foreground/10"}),e.jsx("button",{type:"button",onClick:()=>_(h),className:"p-0.5 text-muted-foreground hover:text-destructive transition","aria-label":`Supprimer rep ${p.rep}`,children:e.jsx(Re,{className:"h-3 w-3"})})]},h))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-medium text-muted-foreground",children:[e.jsx(Nt,{className:"h-3.5 w-3.5"}),"Coups de bras"]}),e.jsxs("button",{type:"button",onClick:P,className:"inline-flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition",children:[e.jsx(Ne,{className:"h-3 w-3"}),"Rep"]})]}),i&&x.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:x.map((p,h)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground w-4 text-right",children:p.rep}),e.jsx("input",{type:"number",inputMode:"numeric",min:0,value:p.count||"",onChange:v=>K(h,Number(v.target.value)||0),placeholder:"nb",className:"w-14 rounded-lg border border-border bg-background px-1.5 py-1 text-xs text-center outline-none focus:ring-2 focus:ring-foreground/10"}),e.jsx("button",{type:"button",onClick:()=>b(h),className:"p-0.5 text-muted-foreground hover:text-destructive transition","aria-label":`Supprimer rep ${p.rep}`,children:e.jsx(Re,{className:"h-3 w-3"})})]},h))})]}),e.jsx("div",{children:e.jsx("textarea",{value:t.notes??"",onChange:p=>s({notes:p.target.value||null}),placeholder:"Notes libres...",rows:2,className:"w-full resize-none rounded-xl border border-border bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-foreground/10"})})]})]})}function I(...t){return t.filter(Boolean).join(" ")}function vs(t){return t.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}function Ee(t){const s=Number(t);if(!Number.isFinite(s))return"—";const n=Math.round(s*100)/100,r=String(n);return r.endsWith(".0")?r.slice(0,-2):r}function xt(t){const s=Number(t);return Number.isFinite(s)?Math.round(s/1e3*100)/100:0}function ws(t){const s=Number(t);return Number.isFinite(s)?Math.round(s*1e3):0}const He=[{key:"difficulty",label:"Difficulté",mode:"hard"},{key:"fatigue_end",label:"Fatigue fin",mode:"hard"},{key:"performance",label:"Perf perçue",mode:"good"},{key:"engagement",label:"Engagement",mode:"good"}],ks=[{key:"AM",label:"Matin",Icon:Gt},{key:"PM",label:"Soir",Icon:vt}];function _e({children:t}){return e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-2 py-0.5 text-xs font-semibold text-muted-foreground",children:t})}function ke({onClick:t,label:s,children:n,tone:r="neutral",disabled:u}){const i={neutral:"bg-background border-border text-foreground hover:bg-muted",dark:"bg-foreground border-foreground text-background hover:opacity-90",sky:"bg-primary/10 border-primary/30 text-primary hover:bg-primary/20"};return e.jsxs("button",{type:"button",onClick:t,disabled:u,className:I("inline-flex items-center justify-center rounded-2xl border p-2 transition",i[r],u&&"opacity-50 cursor-not-allowed hover:bg-background"),"aria-label":s,title:s,children:[n,e.jsx("span",{className:"sr-only",children:s})]})}function Ss(t,s){const n=Number(s);return!Number.isFinite(n)||n<1||n>5?"neutral":t==="hard"?{1:"bg-intensity-1 border-intensity-1 text-white",2:"bg-intensity-2 border-intensity-2 text-white",3:"bg-intensity-3 border-intensity-3 text-white",4:"bg-intensity-4 border-intensity-4 text-white",5:"bg-intensity-5 border-intensity-5 text-white"}[n]:{1:"bg-intensity-5 border-intensity-5 text-white",2:"bg-intensity-4 border-intensity-4 text-white",3:"bg-intensity-3 border-intensity-3 text-white",4:"bg-intensity-2 border-intensity-2 text-white",5:"bg-intensity-1 border-intensity-1 text-white"}[n]}function Ms({plannedMeters:t,valueMeters:s,onChange:n,disabled:r}){const l=Number.isFinite(Number(s))?Number(s):t,x=l-t;return e.jsxs("div",{className:I("mt-4 rounded-3xl border px-4 py-3",r?"bg-muted border-border":"bg-card border-border"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:I("text-xs font-semibold",r?"text-muted-foreground":"text-foreground"),children:"Ajuster kilométrage"}),x!==0&&e.jsx("div",{className:I("text-xs font-semibold px-2 py-0.5 rounded-full",x>0?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400"),children:x>0?`+${x}m`:`${x}m`})]}),e.jsx("div",{className:"text-center mb-3",children:e.jsxs("div",{className:I("text-xs","text-muted-foreground"),children:["Planifié : ",t,"m (",Ee(xt(t))," km)"]})}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("button",{type:"button",disabled:r||l-100<0,onClick:()=>n(l-100),className:I("h-11 w-11 rounded-2xl border flex items-center justify-center transition-colors",r?"bg-muted border-border text-muted-foreground cursor-not-allowed":"bg-card border-border text-foreground hover:bg-muted active:scale-95"),"aria-label":"-100m",children:e.jsx(jt,{className:"h-5 w-5"})}),e.jsxs("div",{className:"min-w-[140px] text-center",children:[e.jsxs("div",{className:I("text-2xl font-bold",r?"text-muted-foreground":"text-foreground"),children:[l,"m"]}),e.jsxs("div",{className:I("text-sm font-medium mt-0.5",r?"text-muted-foreground":"text-primary"),children:[Ee(xt(l))," km"]})]}),e.jsx("button",{type:"button",disabled:r||l+100>3e4,onClick:()=>n(l+100),className:I("h-11 w-11 rounded-2xl border flex items-center justify-center transition-colors",r?"bg-muted border-border text-muted-foreground cursor-not-allowed":"bg-card border-border text-foreground hover:bg-muted active:scale-95"),"aria-label":"+100m",children:e.jsx(Ne,{className:"h-5 w-5"})})]})]})}function As({open:t,selectedDate:s,sessionsForSelectedDay:n,selectedDayStatus:r,dayKm:u,activeSessionId:i,detailsOpen:g,draftState:l,saveState:x,isPending:N,logsBySessionId:w,assignmentItems:_,onClose:P,onDayOffAll:K,onOpenSession:b,onCloseSession:p,onToggleDetails:h,onMarkAbsent:v,onMarkPresent:E,onClearOverride:Z,onSaveFeedback:ee,onDraftStateChange:B,getSessionStatus:q}){const[,be]=It(),D=c.useMemo(()=>i&&n.find(M=>M.id===i)||null,[i,n]);return e.jsx(Fe,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(ce.div,{className:"fixed inset-0 z-overlay bg-black/30",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:P}),e.jsx(ce.div,{className:I("fixed z-modal bg-background shadow-2xl","left-0 right-0 bottom-0 top-auto max-h-[calc(100dvh-env(safe-area-inset-top))] h-[88dvh] rounded-t-3xl","sm:right-0 sm:top-0 sm:left-auto sm:bottom-auto sm:h-full sm:w-full sm:max-w-xl sm:rounded-none"),variants:Tt,initial:"hidden",animate:"visible",exit:"exit",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"px-5 pt-3 sm:hidden",children:e.jsx("div",{className:"mx-auto h-1.5 w-12 rounded-full bg-muted"})}),e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b bg-background px-4 sm:px-5 py-3",children:[e.jsx("div",{className:"min-w-0",children:e.jsx("div",{className:"truncate text-base font-semibold text-foreground",children:vs(s)})}),e.jsx(ke,{onClick:P,label:"Fermer",children:e.jsx(Ue,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 sm:p-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-2xl border border-border bg-card flex items-center justify-center",children:e.jsx(Xe,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"text-sm font-semibold text-foreground",children:[u," km"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:I("h-1.5 w-1.5 rounded-full",r.total>0&&r.completed>=1?"bg-status-success":"bg-muted-foreground/30")}),e.jsx("span",{className:I("h-1.5 w-1.5 rounded-full",r.total>0&&r.completed>=2?"bg-status-success":"bg-muted-foreground/30")})]})]})]}),e.jsx(ke,{onClick:K,label:"OFF (absent journée)",tone:"dark",disabled:N,children:e.jsx(Wt,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"mt-4 grid gap-2",children:n.map(M=>{const L=q(M,s),O=!!w[M.id],U=L.status==="absent",T=L.status==="not_expected",re=U||T,$=L.expected&&!O&&!U,ue=O?"bg-status-success-bg border-status-success/30":re?"bg-sky-50 border-sky-200":$?"bg-status-warning-bg border-status-warning/30":"bg-card border-border",C=ks.find(Y=>Y.key===M.slotKey)?.Icon||Ce;return e.jsx("button",{type:"button",onClick:()=>b(M.id),className:I("w-full rounded-3xl border px-3 py-3 text-left transition",ue,"hover:shadow-sm"),children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:I("h-10 w-10 rounded-2xl border flex items-center justify-center",O?"border-status-success/30 bg-status-success-bg":re?"border-sky-200 bg-sky-100":$?"border-status-warning/30 bg-status-warning-bg":"border-border bg-muted"),children:e.jsx(C,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:M.title}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[M.isEmpty?e.jsx(_e,{children:"Vide"}):e.jsxs(_e,{children:[Ee(M.km)," km"]}),O&&e.jsxs("span",{className:"inline-flex items-center text-emerald-800",children:[e.jsx(rt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Présent"})]}),re&&!O&&e.jsxs("span",{className:"inline-flex items-center text-sky-800",children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Absent"})]}),$&&e.jsxs("span",{className:"inline-flex items-center text-orange-900",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"En attente"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[T&&e.jsx(ke,{onClick:Y=>{Y.stopPropagation(),E(M.id)},label:"Je suis venu",disabled:N,children:e.jsx(it,{className:"h-5 w-5"})}),L.expected&&!O&&!U&&e.jsx(ke,{onClick:Y=>{Y.stopPropagation(),v(M.id)},label:"Absent",tone:"sky",disabled:N,children:e.jsx(De,{className:"h-5 w-5"})})]})]})},M.id)})}),e.jsx(Fe,{children:D&&e.jsx(ce.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:8},transition:{duration:nt.normal},className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:(()=>{const M=q(D,s),L=M.status==="absent",O=M.status==="not_expected",U=!!w[D.id],T=M.expected&&!L,re=L?"Annuler":O?"Je suis venu":"Absent",$=L?()=>Z(D.id):O?()=>E(D.id):()=>v(D.id),ue=ws(D.km??0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:D.title}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[D.isEmpty?e.jsx(_e,{children:"Vide"}):e.jsxs(_e,{children:[Ee(D.km)," km"]}),U?e.jsxs("span",{className:"inline-flex items-center text-emerald-800",children:[e.jsx(rt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Présent"})]}):L||O?e.jsxs("span",{className:"inline-flex items-center text-sky-800",children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Absent"})]}):e.jsxs("span",{className:"inline-flex items-center text-orange-900",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"En attente"})]})]})]}),e.jsx(ke,{onClick:p,label:"Retour",children:e.jsx(Ue,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 p-3",children:[e.jsxs("button",{type:"button",onClick:$,className:I("rounded-2xl px-3 py-3 text-sm font-semibold border transition inline-flex items-center justify-center gap-2",O?"bg-foreground text-background border-foreground hover:opacity-90":"bg-card text-foreground border-border hover:bg-muted"),children:[O?e.jsx(it,{className:"h-4 w-4"}):e.jsx(De,{className:"h-4 w-4"}),re]}),e.jsxs("button",{type:"button",onClick:h,className:"rounded-2xl px-3 py-3 text-sm font-semibold border border-border bg-card hover:bg-muted inline-flex items-center justify-center gap-2",children:[e.jsx(ht,{className:"h-4 w-4"}),"Fiche"]})]}),e.jsx(Fe,{children:g&&e.jsxs(ce.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:6},transition:{duration:nt.normal},className:"mx-3 mb-3 rounded-2xl border border-border bg-muted p-3",children:[D.details?.length?e.jsx("ul",{className:"list-disc pl-5 space-y-1 text-sm text-foreground",children:D.details.map((C,Y)=>e.jsx("li",{children:C},Y))}):e.jsx("div",{className:"text-sm text-muted-foreground",children:D.assignmentId?"Séance coach — détails dans la fiche.":"Aucun détail pour ce créneau."}),D.assignmentId?e.jsx("div",{className:"mt-3",children:e.jsx("button",{type:"button",onClick:()=>be(`/swim-session?assignmentId=${D.assignmentId}`),className:"w-full rounded-2xl border border-border bg-card px-3 py-2 text-sm font-semibold text-foreground hover:bg-muted",children:"Ouvrir la fiche complète"})}):null]})}),e.jsxs("div",{className:"px-4 pb-4",children:[!T&&e.jsx("div",{className:"mb-3 rounded-2xl bg-sky-50 text-sky-900 px-3 py-2 text-xs",children:L?"Absent: aucun ressenti.":'Non prévu: appuyez "Je suis venu".'}),e.jsxs(ce.div,{className:"space-y-4",variants:qt,initial:"hidden",animate:"visible",children:[He.map(C=>{const Y=l[C.key];return e.jsxs(ce.div,{className:"space-y-2",variants:st,children:[e.jsx("div",{className:I("text-sm font-semibold",T?"text-foreground":"text-muted-foreground"),children:C.label}),e.jsx("div",{className:"flex items-center gap-2",children:[1,2,3,4,5].map(te=>{const oe=Y===te;return e.jsx("button",{type:"button",disabled:!T,onClick:()=>B({...l,[C.key]:te}),className:I("h-11 w-11 rounded-2xl border text-sm font-semibold transition",T?oe?Ss(C.mode,te):"bg-card text-foreground border-border hover:bg-muted":"bg-muted text-muted-foreground border-border cursor-not-allowed"),children:te},te)})})]},C.key)}),e.jsxs(ce.div,{className:"space-y-2",variants:st,children:[e.jsx("div",{className:I("text-sm font-semibold",T?"text-foreground":"text-muted-foreground"),children:"Commentaire"}),e.jsx("textarea",{value:l.comment,onChange:C=>B({...l,comment:C.target.value}),disabled:!T,rows:3,placeholder:"Sensations, points techniques…",className:I("w-full resize-none rounded-3xl border px-4 py-3 text-sm outline-none",T?"bg-card text-foreground border-border focus:ring-2 focus:ring-foreground/10":"bg-muted text-muted-foreground border-border")})]})]}),e.jsx(Ms,{plannedMeters:ue,valueMeters:l.distanceMeters,onChange:C=>B({...l,distanceMeters:C}),disabled:!T}),e.jsx(ys,{strokes:l.strokes,showStrokeDetail:l.showStrokeDetail,disabled:!T,onToggle:()=>B({...l,showStrokeDetail:!l.showStrokeDetail}),onChange:C=>B({...l,strokes:C})}),e.jsx(Ns,{exerciseLogs:l.exerciseLogs,assignmentItems:_,disabled:!T,onLogsChange:C=>B({...l,exerciseLogs:C})})]})]})})()},D.id)})]}),D&&(()=>{const M=q(D,s),L=M.expected&&M.status!=="absent";return e.jsxs(Bt,{saveState:x,position:"static",children:[e.jsx("button",{type:"button",onClick:ee,disabled:N||!L||!He.every(O=>Number.isInteger(l[O.key])),className:I("rounded-2xl px-4 py-3 text-sm font-semibold transition flex-1",N||!L?"bg-muted text-muted-foreground cursor-not-allowed":He.every(O=>Number.isInteger(l[O.key]))?"bg-status-success text-white hover:opacity-90":"bg-status-success-bg text-status-success cursor-not-allowed"),children:"Valider"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["→"," km"]})]})})()]})})]})})}function Ds(...t){return t.filter(Boolean).join(" ")}function _s(t){try{return new Date(t).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short"})}catch{return t}}function Cs(t){if(!t||!Number.isFinite(t))return"—";if(t<60)return`${t.toFixed(1)}s`;const s=Math.floor(t/60),n=t%60;return`${s}:${n<10?"0":""}${n.toFixed(1)}`}function Fs({userId:t,expanded:s,onToggle:n}){const{data:r,isLoading:u}=We({queryKey:["swim-exercise-logs-history",t],queryFn:()=>xe.getSwimExerciseLogsHistory(t,100),enabled:!!t&&s}),i=Se.useMemo(()=>{if(!r?.length)return[];const g=new Map;for(const l of r){const x=(l.created_at??"").slice(0,10);g.has(x)||g.set(x,[]),g.get(x).push(l)}return Array.from(g.entries()).map(([l,x])=>({date:l,entries:x}))},[r]);return e.jsxs("div",{className:"mt-6",children:[e.jsxs("button",{type:"button",onClick:n,className:"flex w-full items-center justify-between rounded-2xl border border-border px-3 py-2.5 text-sm font-semibold text-foreground hover:bg-muted transition",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ht,{className:"h-4 w-4"}),"Historique notes techniques"]}),e.jsx(Oe,{className:Ds("h-4 w-4 transition-transform",s&&"rotate-90")})]}),s&&e.jsxs("div",{className:"mt-3 space-y-3",children:[u&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"Chargement..."}),!u&&i.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucune note technique enregistree."}),i.map(({date:g,entries:l})=>e.jsxs("div",{className:"rounded-2xl border border-border overflow-hidden",children:[e.jsx("div",{className:"bg-muted/50 px-3 py-2 text-xs font-semibold text-muted-foreground",children:_s(g)}),e.jsx("div",{className:"divide-y divide-border",children:l.map(x=>e.jsx(Es,{log:x},x.id))})]},g))]})]})}function Es({log:t}){return e.jsxs("div",{className:"px-3 py-2.5 space-y-1.5",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:t.exercise_label}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-xs text-muted-foreground",children:[t.tempo!=null&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(yt,{className:"h-3 w-3"}),t.tempo," c/min"]}),t.split_times.length>0&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Ge,{className:"h-3 w-3"}),t.split_times.map(s=>Cs(s.time_seconds)).join(" / ")]}),t.stroke_count.length>0&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Nt,{className:"h-3 w-3"}),t.stroke_count.map(s=>s.count).join(" / ")," cps"]})]}),t.notes&&e.jsx("div",{className:"text-xs text-foreground/70 italic",children:t.notes})]})}const Os=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],$s=[{key:"AM",label:"Matin"},{key:"PM",label:"Soir"}],Is=[{key:"difficulty",label:"Difficulté",mode:"hard"},{key:"fatigue_end",label:"Fatigue fin",mode:"hard"},{key:"performance",label:"Perf perçue",mode:"good"},{key:"engagement",label:"Engagement",mode:"good"}];function ft(...t){return t.filter(Boolean).join(" ")}function bt(t){return String(t).padStart(2,"0")}function Ve(t){return`${t.getFullYear()}-${bt(t.getMonth()+1)}-${bt(t.getDate())}`}function Ls(t){return new Date(t.getFullYear(),t.getMonth(),1)}function Ps(t){const s=String(t).split("__");return{iso:s[0],slotKey:s[1]||""}}function pt(t,s){return Number.isFinite(t)?Math.round(t/s)*s:0}function gt({open:t,title:s,onClose:n,children:r}){return e.jsx(Fe,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(ce.div,{className:"fixed inset-0 z-overlay bg-black/30",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n}),e.jsx(ce.div,{className:"fixed inset-0 z-modal flex items-end sm:items-center justify-center p-3 pb-24 sm:p-4 sm:pb-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},children:e.jsxs("div",{className:"w-full max-w-md rounded-3xl border bg-background shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[e.jsx("div",{className:"truncate text-base font-semibold text-foreground",children:s}),e.jsxs("button",{type:"button",onClick:n,className:"inline-flex items-center justify-center rounded-2xl border border-border bg-background p-2 transition hover:bg-muted","aria-label":"Fermer",children:[e.jsx(Ue,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Fermer"})]})]}),e.jsx("div",{className:"p-4",children:r})]})})]})})}function sn(){const{user:t,userId:s}=Lt(),{toast:n}=Pt(),r=$t(),[u,i]=Se.useState("idle"),[g,l]=Se.useState(!1),[x,N]=Se.useState(null);Se.useEffect(()=>{Ke.auth.getSession().then(({data:o})=>{N(o.session?.user?.id??null)})},[t]);const{data:w,isLoading:_,error:P,refetch:K}=We({queryKey:["sessions",s??t],queryFn:()=>xe.getSessions(t,s),enabled:!!t}),{data:b,isLoading:p,error:h,refetch:v}=We({queryKey:["assignments",t],queryFn:()=>xe.getAssignments(t,s),enabled:!!t}),E=_||p,Z=P||h,ee=()=>{K(),v()},B=Pe({mutationFn:o=>xe.deleteSession(o),onMutate:()=>{i("saving")},onSuccess:()=>{r.invalidateQueries({queryKey:["sessions"]}),n({title:"Séance supprimée",description:"La saisie a été supprimée."}),i("saved"),setTimeout(()=>i("idle"),2e3)},onError:()=>{n({title:"Erreur",description:"Impossible de supprimer la séance.",variant:"destructive"}),i("error"),setTimeout(()=>i("idle"),3e3)}}),q=Pe({mutationFn:async o=>{const{_exerciseLogs:m,...y}=o,F=await xe.syncSession({...y,athlete_name:t,athlete_id:s??void 0});if(m&&m.length>0&&F.sessionId)try{const{data:Q}=await Ke.auth.getSession(),me=Q.session?.user?.id;me&&await xe.saveSwimExerciseLogs(F.sessionId,me,m)}catch(Q){console.warn("[EAC] Failed to save exercise logs:",Q)}return F},onMutate:()=>{i("saving")},onSuccess:()=>{r.invalidateQueries({queryKey:["sessions"]}),r.invalidateQueries({queryKey:["assignments"]}),n({title:"Séance enregistrée",description:"Vos données ont été synchronisées."}),i("saved"),setTimeout(()=>i("idle"),2e3)},onError:()=>{n({title:"Erreur",description:"Impossible d'enregistrer la séance.",variant:"destructive"}),i("error"),setTimeout(()=>i("idle"),3e3)}}),be=Pe({mutationFn:async o=>{const{_exerciseLogs:m,...y}=o,F=await xe.updateSession(y);if(console.log("[EAC] updateMutation - exerciseLogs:",m),m&&y.id)try{const{data:Q}=await Ke.auth.getSession(),me=Q.session?.user?.id;console.log("[EAC] updateMutation - authUid:",me,"sessionId:",y.id),me?(console.log("[EAC] updateMutation - calling saveSwimExerciseLogs with logs:",m),await xe.saveSwimExerciseLogs(y.id,me,m),console.log("[EAC] updateMutation - saveSwimExerciseLogs completed successfully")):console.warn("[EAC] updateMutation - No authUid found, skipping exercise logs save")}catch(Q){throw console.error("[EAC] Failed to save exercise logs:",Q),Q}else console.log("[EAC] updateMutation - skipping exercise logs (empty or no session ID)");return F},onMutate:()=>{i("saving")},onSuccess:()=>{r.invalidateQueries({queryKey:["sessions"]}),n({title:"Séance mise à jour",description:"Votre saisie a été mise à jour."}),i("saved"),setTimeout(()=>i("idle"),2e3)},onError:()=>{n({title:"Erreur",description:"Impossible de mettre à jour la séance.",variant:"destructive"}),i("error"),setTimeout(()=>i("idle"),3e3)}}),D=cs({sessions:w,assignments:b,userId:s,user:t}),{today:M,monthCursor:L,selectedISO:O,drawerOpen:U,settingsOpen:T,infoOpen:re,activeSessionId:$,detailsOpen:ue,selectedDayIndex:C,isPending:Y,presenceDefaults:te,stableDurationMin:oe,draftState:A,gridDates:ie,completionByISO:ae,selectedDate:le,sessionsForSelectedDay:X,selectedDayStatus:pe,globalKm:je,dayKm:ve,logsBySessionId:H,setMonthCursor:V,setSelectedISO:ge,setDrawerOpen:he,setSettingsOpen:ye,setInfoOpen:G,setActiveSessionId:W,setDetailsOpen:z,setSelectedDayIndex:a,setPresenceDefaults:f,setAttendanceOverrideBySessionId:d,setStableDurationMin:j,setDraftState:k,setAutoCloseArmed:S,startTransition:R,getSessionStatus:J}=D,se=c.useMemo(()=>{if(!$)return[];const o=X.find(y=>y.id===$);if(!o?.assignmentId)return[];const m=(b??[]).find(y=>y.id===o.assignmentId);return m?.items?m.items.filter(y=>y.label):[]},[$,X,b]),ne=c.useCallback(o=>{ge(o),he(!0),W(null),z(!1);const m=ae[o]||{completed:0,total:2};S(m.total>0&&m.completed<m.total)},[ae,ge,he,W,z,S]),fe=c.useCallback(()=>{he(!1),W(null),z(!1),S(!1),a(null)},[he,W,z,S,a]),$e=c.useCallback(()=>{V(o=>new Date(o.getFullYear(),o.getMonth()-1,1))},[V]),kt=c.useCallback(()=>{V(o=>new Date(o.getFullYear(),o.getMonth()+1,1))},[V]),St=c.useCallback(()=>{const o=new Date;V(Ls(o)),ne(Ve(o))},[ne,V]),Ie=c.useCallback(o=>{W(o),z(!1)},[W,z]),Mt=c.useCallback(o=>{R(()=>{d(y=>({...y,[o]:"absent"}))});const m=H[o];m?.id&&B.mutate(Number(m.id))},[B,H,R,d]),At=c.useCallback(o=>{R(()=>{d(m=>({...m,[o]:"present"}))})},[R,d]),Dt=c.useCallback(o=>{R(()=>{d(m=>{const y={...m};return delete y[o],y})})},[R,d]),_t=c.useCallback(()=>{const o=X.map(m=>J(m,le).expected?m.id:null).filter(Boolean);o.length!==0&&(R(()=>{d(m=>{const y={...m};for(const F of o)y[F]="absent";return y}),W(null),z(!1)}),o.forEach(m=>{const y=H[m];y?.id&&B.mutate(Number(y.id))}))},[X,J,le,R,H,B,d,W,z]),Ct=c.useCallback(()=>{if(!$||!t||!Is.every(we=>Number.isInteger(A[we.key])))return;const{iso:m,slotKey:y}=Ps($),F=y==="PM"?"Soir":"Matin",Q=pt(Number(A.distanceMeters??0),100),me=pt(Number(oe),15),Le={};for(const[we,Ot]of Object.entries(A.strokes)){const et=Number(Ot);et>0&&(Le[we]=et)}const Ze={date:m,slot:F,distance:Q,duration:me,effort:Number(A.difficulty),feeling:Number(A.fatigue_end),performance:Number(A.performance),engagement:Number(A.engagement),comments:String(A.comment||"").slice(0,400),athlete_name:t,athlete_id:s??void 0,stroke_distances:Object.keys(Le).length>0?Le:null},Ae=H[$];console.log("[EAC] saveFeedback - draftState.exerciseLogs:",A.exerciseLogs),R(()=>{d(we=>({...we,[$]:"present"}))}),Ae?.id?(console.log("[EAC] saveFeedback - updating existing session:",Ae.id),be.mutate({...Ze,id:Ae.id,created_at:Ae.created_at??new Date().toISOString(),_exerciseLogs:A.exerciseLogs.length>0?A.exerciseLogs:[]})):(console.log("[EAC] saveFeedback - creating new session"),q.mutate({...Ze,_exerciseLogs:A.exerciseLogs.length>0?A.exerciseLogs:void 0})),W(null),z(!1)},[$,t,s,A,oe,H,R,be,q,d,W,z]),Ft=c.useCallback((o,m)=>{f(y=>({...y,[o]:{...y[o],[m]:!y[o][m]}}))},[f]);c.useEffect(()=>{if(!U)return;const o=m=>{if(m.key==="Escape"){m.preventDefault(),fe();return}(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),X.length>0&&!$&&Ie(X[0].id))};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[U,fe,X,$,Ie]);const Et=c.useCallback((o,m)=>{if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"," "].includes(o.key))return;if(o.preventDefault(),o.key==="Enter"||o.key===" "){const Q=Ve(ie[m]);ne(Q);return}let F=m;o.key==="ArrowLeft"&&(F=Math.max(0,m-1)),o.key==="ArrowRight"&&(F=Math.min(ie.length-1,m+1)),o.key==="ArrowUp"&&(F=Math.max(0,m-7)),o.key==="ArrowDown"&&(F=Math.min(ie.length-1,m+7)),a(F),ge(Ve(ie[F])),setTimeout(()=>{const Q=document.querySelectorAll('[data-calendar-cell="true"]');Q[F]&&Q[F].focus()},0)},[ie,ne,a,ge]);return E?e.jsxs("div",{className:"min-h-screen bg-muted",children:[e.jsx("div",{className:"sm:hidden fixed top-0 left-0 right-0 z-overlay border-b border-border bg-card/90 backdrop-blur",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-3 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-2xl bg-muted animate-pulse"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"h-4 w-12 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-16 rounded bg-muted animate-pulse"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"})]})]})}),e.jsx("div",{className:"mx-auto max-w-6xl px-3 sm:px-4 pt-20 pb-5 sm:py-8",children:e.jsxs("div",{className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 sm:px-5 py-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"})]}),e.jsx("div",{className:"h-6 w-32 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"})]}),e.jsx("div",{className:"p-3 sm:p-5",children:e.jsxs("div",{className:"grid grid-cols-7 gap-1.5 sm:gap-2",children:[Array.from({length:7}).map((o,m)=>e.jsx("div",{className:"px-0.5 pb-1 flex justify-center",children:e.jsx("div",{className:"h-3 w-4 rounded bg-muted animate-pulse"})},`wh-${m}`)),Array.from({length:35}).map((o,m)=>e.jsx("div",{className:"aspect-square rounded-2xl bg-muted/50 animate-pulse"},`cs-${m}`))]})})]})})]}):Z?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(zt,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:Z.message}),e.jsx(Kt,{onClick:()=>ee(),className:"mt-4",children:"Réessayer"})]}):e.jsxs("div",{className:"min-h-screen bg-muted",children:[e.jsx("div",{className:"sm:hidden fixed top-0 left-0 right-0 z-overlay border-b border-border bg-card/90 backdrop-blur",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-3 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-2xl bg-card border border-border flex items-center justify-center",children:e.jsx(Xe,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:"Suivi"}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[je," km"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>G(!0),className:"inline-flex items-center justify-center rounded-2xl border border-border bg-background p-2 transition hover:bg-muted","aria-label":"Infos",children:e.jsx(tt,{className:"h-5 w-5"})}),e.jsx("button",{type:"button",onClick:()=>ye(!0),className:"inline-flex items-center justify-center rounded-2xl border border-border bg-background p-2 transition hover:bg-muted","aria-label":"Paramètres",children:e.jsx(ot,{className:"h-5 w-5"})})]})]})}),e.jsxs("div",{className:"mx-auto max-w-6xl px-3 sm:px-4 pt-20 pb-5 sm:py-8",children:[e.jsxs("div",{className:"invisible sm:visible flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-2xl bg-card border border-border flex items-center justify-center",children:e.jsx(Xe,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:"Suivi"}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[je," km"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>G(!0),className:"inline-flex items-center justify-center rounded-2xl border border-border bg-background p-2 transition hover:bg-muted","aria-label":"Infos",children:e.jsx(tt,{className:"h-5 w-5"})}),e.jsx("button",{type:"button",onClick:()=>ye(!0),className:"inline-flex items-center justify-center rounded-2xl border border-border bg-background p-2 transition hover:bg-muted","aria-label":"Paramètres",children:e.jsx(ot,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:[e.jsx(us,{monthCursor:L,selectedDayStatus:pe,onPrevMonth:$e,onNextMonth:kt,onJumpToday:St}),e.jsx(hs,{monthCursor:L,gridDates:ie,completionByISO:ae,selectedISO:O,selectedDayIndex:C,today:M,onDayClick:ne,onKeyDown:Et})]}),x&&e.jsx(Fs,{userId:x,expanded:g,onToggle:()=>l(o=>!o)}),e.jsx(gt,{open:re,title:"Codes",onClose:()=>G(!1),children:e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-orange-200 bg-orange-50 px-3 py-2",children:[e.jsx("span",{className:"font-semibold",children:"Orange"}),e.jsx("span",{className:"text-foreground",children:"À compléter"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-emerald-200 bg-emerald-50 px-3 py-2",children:[e.jsx("span",{className:"font-semibold",children:"Vert"}),e.jsx("span",{className:"text-foreground",children:"Validé → km"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-sky-200 bg-sky-50 px-3 py-2",children:[e.jsx("span",{className:"font-semibold",children:"Bleu"}),e.jsx("span",{className:"text-foreground",children:"Absent / Non prévu"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Les km comptent uniquement après validation."})]})}),e.jsx(gt,{open:T,title:"Présence",onClose:()=>ye(!1),children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Toggle hebdo (séances attendues)."}),e.jsxs("div",{className:"overflow-hidden rounded-2xl border border-border bg-card",children:[e.jsxs("div",{className:"grid grid-cols-[1fr_110px_110px] bg-muted border-b border-border px-3 py-2 text-xs font-semibold text-muted-foreground",children:[e.jsx("div",{children:"Jour"}),e.jsx("div",{className:"text-center",children:"Matin"}),e.jsx("div",{className:"text-center",children:"Soir"})]}),Os.map((o,m)=>e.jsxs("div",{className:ft("grid grid-cols-[1fr_110px_110px] items-center px-3 py-2",m!==6&&"border-b border-border"),children:[e.jsx("div",{className:"text-sm font-medium text-foreground",children:o}),$s.map(y=>{const F=!!te?.[m]?.[y.key];return e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",onClick:()=>Ft(m,y.key),className:ft("w-24 rounded-2xl border px-3 py-2 text-sm font-semibold transition",F?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"),"aria-label":`${o} ${y.label}`,children:F?"On":"Off"})},y.key)})]},o))]}),e.jsxs("div",{className:"rounded-2xl border border-border bg-muted px-3 py-2",children:[e.jsx("div",{className:"text-xs font-semibold text-foreground",children:"Durée (valeur par défaut)"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"h-9 w-9 rounded-2xl border border-border bg-card hover:bg-muted flex items-center justify-center",onClick:()=>j(o=>Math.max(30,o-15)),"aria-label":"Diminuer la durée",children:e.jsx(jt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"text-sm font-semibold text-foreground",children:[oe," min"]}),e.jsx("button",{type:"button",className:"h-9 w-9 rounded-2xl border border-border bg-card hover:bg-muted flex items-center justify-center",onClick:()=>j(o=>Math.min(240,o+15)),"aria-label":"Augmenter la durée",children:e.jsx(Ne,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"mt-1 text-[11px] text-muted-foreground",children:"Durée envoyée au back-end (non affichée dans la maquette)."})]})]})}),e.jsx(As,{open:U,selectedDate:le,sessionsForSelectedDay:X,selectedDayStatus:pe,dayKm:ve,activeSessionId:$,detailsOpen:ue,draftState:A,saveState:u,isPending:Y,logsBySessionId:H,onClose:fe,onDayOffAll:_t,onOpenSession:Ie,onCloseSession:()=>{W(null),z(!1)},onToggleDetails:()=>z(o=>!o),onMarkAbsent:Mt,onMarkPresent:At,onClearOverride:Dt,onSaveFeedback:Ct,onDraftStateChange:k,getSessionStatus:J,assignmentItems:se})]})]})}export{sn as default};
