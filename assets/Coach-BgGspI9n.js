const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StrengthCatalog-Cp8MS_7G.js","assets/vendor-query-BiSH4r2z.js","assets/vendor-react-BzrpNAyj.js","assets/index-DM4CjKze.js","assets/vendor-supabase-6k692oZB.js","assets/index-QT_HaRlP.css","assets/index-Bn2TEnxG.js","assets/index-11dT94-G.js","assets/index-BHLGN2cH.js","assets/select-6RhpdKRM.js","assets/index-BGA8KrKv.js","assets/chevron-down-DUX-tWPj.js","assets/check-DhPVODY9.js","assets/CalendarGrid-BsCgVKil.js","assets/chevron-left-DFoUJUOj.js","assets/chevron-right-BUbbVcXk.js","assets/textarea-x5iUz16x.js","assets/dialog-CIOud82M.js","assets/index-CAkCWzu2.js","assets/checkbox-VraSwje0.js","assets/alert-dialog-DLh3NAbB.js","assets/tabs-YGMsea5Y.js","assets/SessionListView-CiHLgxE2.js","assets/save-Dh-Z5hNd.js","assets/circle-alert-OXa28naT.js","assets/trash-2-rKkGBz_U.js","assets/drawer-C1exYx_9.js","assets/search-X96s5k3F.js","assets/plus-cmSfHOK1.js","assets/loader-circle-BqJ8_5w2.js","assets/pen-yMwM5zrU.js","assets/badge-Y_r8eGp9.js","assets/toggle-group-BHc3C2Bn.js","assets/arrow-left-CkvMwQG8.js","assets/sheet-cq1jIS1d.js","assets/SwimCatalog-BfE8nhk6.js","assets/SwimSessionConsultation-CeZhjUu2.js","assets/timer-ChXQl8mF.js","assets/format-B9mPVj_w.js"])))=>i.map(i=>d[i]);
import{c as ce,B as T,m as es,n as ss,o as Pe,R as ts,p as ns,q as ke,P as Ae,A as De,r as Re,t as as,v as rs,w as os,x as is,a as ls,f as he,d as F,C as te,i as ne,k as ae,y as re,h as oe,L as z,I as me,M as xe,W as Oe,D as Fe,u as Ne,b as cs,U as pe,z as Ce,E as ds,l as us,_ as Ie}from"./index-DM4CjKze.js";import{j as e,r as o,R as ms,d as fe,u as Y,c as ps}from"./vendor-query-BiSH4r2z.js";import{B as ge}from"./badge-Y_r8eGp9.js";import{T as Te,a as ee}from"./toggle-group-BHc3C2Bn.js";import{A as gs}from"./arrow-left-CkvMwQG8.js";import{C as hs}from"./checkbox-VraSwje0.js";import{h as xs,R as fs,u as vs,F as js}from"./index-BGA8KrKv.js";import{u as ys}from"./index-BHLGN2cH.js";import{S as B,a as q,b as G,c as K,d as R}from"./select-6RhpdKRM.js";import{C as bs}from"./chevron-down-DUX-tWPj.js";import{T as Ns}from"./textarea-x5iUz16x.js";import{a as Cs,b as ws}from"./CalendarGrid-BsCgVKil.js";import{S as Ss,a as _s,b as Ms,c as Ps,d as ks}from"./sheet-cq1jIS1d.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],le=ce("bell",As);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],Rs=ce("calendar-days",Ds);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=[["path",{d:"M16 19h6",key:"xwg31i"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M19 16v6",key:"tddt3s"}],["path",{d:"M21 12.598V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8.5",key:"1glfrc"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}]],Fs=ce("calendar-plus",Os);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],Ts=ce("heart-pulse",Is),Q=({title:s,description:n,onBack:i,actions:r})=>e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(T,{variant:"ghost",size:"sm",className:"-ml-2",onClick:i,children:[e.jsx(gs,{className:"mr-2 h-4 w-4"}),"Retour à l'accueil"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:s}),n?e.jsx("p",{className:"text-sm text-muted-foreground",children:n}):null]}),r?e.jsx("div",{className:"flex items-center gap-2",children:r}):null]});function se(s,n,{checkForDefaultPrevented:i=!0}={}){return function(a){if(s?.(a),i===!1||!a.defaultPrevented)return n?.(a)}}function Es(s){const n=$s(s),i=o.forwardRef((r,a)=>{const{children:l,...c}=r,d=o.Children.toArray(l),y=d.find(Ls);if(y){const b=y.props.children,x=d.map(f=>f===y?o.Children.count(b)>1?o.Children.only(null):o.isValidElement(b)?b.props.children:null:f);return e.jsx(n,{...c,ref:a,children:o.isValidElement(b)?o.cloneElement(b,void 0,x):null})}return e.jsx(n,{...c,ref:a,children:l})});return i.displayName=`${s}.Slot`,i}function $s(s){const n=o.forwardRef((i,r)=>{const{children:a,...l}=i;if(o.isValidElement(a)){const c=Bs(a),d=Vs(l,a.props);return a.type!==o.Fragment&&(d.ref=r?es(r,c):c),o.cloneElement(a,d)}return o.Children.count(a)>1?o.Children.only(null):null});return n.displayName=`${s}.SlotClone`,n}var zs=Symbol("radix.slottable");function Ls(s){return o.isValidElement(s)&&typeof s.type=="function"&&"__radixId"in s.type&&s.type.__radixId===zs}function Vs(s,n){const i={...n};for(const r in n){const a=s[r],l=n[r];/^on[A-Z]/.test(r)?a&&l?i[r]=(...d)=>{const y=l(...d);return a(...d),y}:a&&(i[r]=a):r==="style"?i[r]={...a,...l}:r==="className"&&(i[r]=[a,l].filter(Boolean).join(" "))}return{...s,...i}}function Bs(s){let n=Object.getOwnPropertyDescriptor(s.props,"ref")?.get,i=n&&"isReactWarning"in n&&n.isReactWarning;return i?s.ref:(n=Object.getOwnPropertyDescriptor(s,"ref")?.get,i=n&&"isReactWarning"in n&&n.isReactWarning,i?s.props.ref:s.props.ref||s.ref)}var qs=ms[" useInsertionEffect ".trim().toString()]||ss;function Gs({prop:s,defaultProp:n,onChange:i=()=>{},caller:r}){const[a,l,c]=Ks({defaultProp:n,onChange:i}),d=s!==void 0,y=d?s:a;{const x=o.useRef(s!==void 0);o.useEffect(()=>{const f=x.current;f!==d&&console.warn(`${r} is changing from ${f?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),x.current=d},[d,r])}const b=o.useCallback(x=>{if(d){const f=Hs(x)?x(s):x;f!==s&&c.current?.(f)}else l(x)},[d,s,l,c]);return[y,b]}function Ks({defaultProp:s,onChange:n}){const[i,r]=o.useState(s),a=o.useRef(i),l=o.useRef(n);return qs(()=>{l.current=n},[n]),o.useEffect(()=>{a.current!==i&&(l.current?.(i),a.current=i)},[i,a]),[i,r,l]}function Hs(s){return typeof s=="function"}var de="Popover",[Ee]=ns(de,[Pe]),ie=Pe(),[Us,H]=Ee(de),$e=s=>{const{__scopePopover:n,children:i,open:r,defaultOpen:a,onOpenChange:l,modal:c=!1}=s,d=ie(n),y=o.useRef(null),[b,x]=o.useState(!1),[f,v]=Gs({prop:r,defaultProp:a??!1,onChange:l,caller:de});return e.jsx(ts,{...d,children:e.jsx(Us,{scope:n,contentId:ys(),triggerRef:y,open:f,onOpenChange:v,onOpenToggle:o.useCallback(()=>v(N=>!N),[v]),hasCustomAnchor:b,onCustomAnchorAdd:o.useCallback(()=>x(!0),[]),onCustomAnchorRemove:o.useCallback(()=>x(!1),[]),modal:c,children:i})})};$e.displayName=de;var ze="PopoverAnchor",Ws=o.forwardRef((s,n)=>{const{__scopePopover:i,...r}=s,a=H(ze,i),l=ie(i),{onCustomAnchorAdd:c,onCustomAnchorRemove:d}=a;return o.useEffect(()=>(c(),()=>d()),[c,d]),e.jsx(De,{...l,...r,ref:n})});Ws.displayName=ze;var Le="PopoverTrigger",Ve=o.forwardRef((s,n)=>{const{__scopePopover:i,...r}=s,a=H(Le,i),l=ie(i),c=ke(n,a.triggerRef),d=e.jsx(Ae.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":He(a.open),...r,ref:c,onClick:se(s.onClick,a.onOpenToggle)});return a.hasCustomAnchor?d:e.jsx(De,{asChild:!0,...l,children:d})});Ve.displayName=Le;var ve="PopoverPortal",[Ys,Qs]=Ee(ve,{forceMount:void 0}),Be=s=>{const{__scopePopover:n,forceMount:i,children:r,container:a}=s,l=H(ve,n);return e.jsx(Ys,{scope:n,forceMount:i,children:e.jsx(Re,{present:i||l.open,children:e.jsx(as,{asChild:!0,container:a,children:r})})})};Be.displayName=ve;var J="PopoverContent",qe=o.forwardRef((s,n)=>{const i=Qs(J,s.__scopePopover),{forceMount:r=i.forceMount,...a}=s,l=H(J,s.__scopePopover);return e.jsx(Re,{present:r||l.open,children:l.modal?e.jsx(Zs,{...a,ref:n}):e.jsx(Xs,{...a,ref:n})})});qe.displayName=J;var Js=Es("PopoverContent.RemoveScroll"),Zs=o.forwardRef((s,n)=>{const i=H(J,s.__scopePopover),r=o.useRef(null),a=ke(n,r),l=o.useRef(!1);return o.useEffect(()=>{const c=r.current;if(c)return xs(c)},[]),e.jsx(fs,{as:Js,allowPinchZoom:!0,children:e.jsx(Ge,{...s,ref:a,trapFocus:i.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:se(s.onCloseAutoFocus,c=>{c.preventDefault(),l.current||i.triggerRef.current?.focus()}),onPointerDownOutside:se(s.onPointerDownOutside,c=>{const d=c.detail.originalEvent,y=d.button===0&&d.ctrlKey===!0,b=d.button===2||y;l.current=b},{checkForDefaultPrevented:!1}),onFocusOutside:se(s.onFocusOutside,c=>c.preventDefault(),{checkForDefaultPrevented:!1})})})}),Xs=o.forwardRef((s,n)=>{const i=H(J,s.__scopePopover),r=o.useRef(!1),a=o.useRef(!1);return e.jsx(Ge,{...s,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:l=>{s.onCloseAutoFocus?.(l),l.defaultPrevented||(r.current||i.triggerRef.current?.focus(),l.preventDefault()),r.current=!1,a.current=!1},onInteractOutside:l=>{s.onInteractOutside?.(l),l.defaultPrevented||(r.current=!0,l.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const c=l.target;i.triggerRef.current?.contains(c)&&l.preventDefault(),l.detail.originalEvent.type==="focusin"&&a.current&&l.preventDefault()}})}),Ge=o.forwardRef((s,n)=>{const{__scopePopover:i,trapFocus:r,onOpenAutoFocus:a,onCloseAutoFocus:l,disableOutsidePointerEvents:c,onEscapeKeyDown:d,onPointerDownOutside:y,onFocusOutside:b,onInteractOutside:x,...f}=s,v=H(J,i),N=ie(i);return vs(),e.jsx(js,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:a,onUnmountAutoFocus:l,children:e.jsx(rs,{asChild:!0,disableOutsidePointerEvents:c,onInteractOutside:x,onEscapeKeyDown:d,onPointerDownOutside:y,onFocusOutside:b,onDismiss:()=>v.onOpenChange(!1),children:e.jsx(os,{"data-state":He(v.open),role:"dialog",id:v.contentId,...N,...f,ref:n,style:{...f.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Ke="PopoverClose",et=o.forwardRef((s,n)=>{const{__scopePopover:i,...r}=s,a=H(Ke,i);return e.jsx(Ae.button,{type:"button",...r,ref:n,onClick:se(s.onClick,()=>a.onOpenChange(!1))})});et.displayName=Ke;var st="PopoverArrow",tt=o.forwardRef((s,n)=>{const{__scopePopover:i,...r}=s,a=ie(i);return e.jsx(is,{...a,...r,ref:n})});tt.displayName=st;function He(s){return s?"open":"closed"}var nt=$e,at=Ve,rt=Be,Ue=qe;const ot=nt,it=at,We=o.forwardRef(({className:s,align:n="center",sideOffset:i=4,...r},a)=>e.jsx(rt,{children:e.jsx(Ue,{ref:a,align:n,sideOffset:i,className:ls("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",s),...r})}));We.displayName=Ue.displayName;const lt=({onBack:s,swimSessions:n,strengthSessions:i,athletes:r,groups:a})=>{const{toast:l}=he(),[c,d]=o.useState({session_type:"swim",session_id:"",assigned_date:new Date().toISOString().split("T")[0],assigned_slot:"morning"}),[y,b]=o.useState(!1),[x,f]=o.useState("user"),[v,N]=o.useState(""),[p,k]=o.useState([]),u=t=>{const h=typeof t=="number"?t:Number(t);return Number.isFinite(h)&&h>0?h:null},M=o.useMemo(()=>r.map(t=>({value:t.id?`id:${t.id}`:`name:${t.display_name}`,label:t.group_label?`${t.display_name} · ${t.group_label}`:t.display_name,id:t.id,name:t.display_name})),[r]),S=o.useMemo(()=>new Map(M.map(t=>[t.value,t])),[M]),E=o.useMemo(()=>a.map(t=>{const h=u(t.id);return h?{...t,gid:h}:null}).filter(t=>!!t),[a]),A=o.useMemo(()=>E.filter(t=>p.includes(t.gid)),[E,p]),U=o.useMemo(()=>{if(A.length===0)return"Choisir des groupes";const t=A.slice(0,2).map(g=>g.name).join(", "),h=A.length>2?` +${A.length-2}`:"";return`${t}${h}`},[A]),$=fe({mutationFn:async t=>F.assignments_create(t),onSuccess:()=>{l({title:"Séance assignée & notifiée"})},onError:t=>{const h="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",g=t instanceof Error?t.message:typeof t=="string"?t:h;let w=g;const C=g.match(/HTTP \d+:\s*(\{.*\})/);if(C)try{w=JSON.parse(C[1])?.error||h}catch{w=h}l({title:"Erreur d'assignation",description:w})}}),W=async()=>{const t=Number(c.session_id);if(!Number.isInteger(t)||t<=0){l({title:"Séance invalide",description:"Sélectionnez une séance valide."});return}if(x==="group"){if(p.length===0){l({title:"Groupe manquant",description:"Sélectionnez au moins un groupe."});return}b(!0);try{const m={assignment_type:c.session_type,session_id:t,scheduled_date:c.assigned_date,scheduled_slot:c.assigned_slot},P=Array.from(new Set(p));await Promise.all(P.map(j=>F.assignments_create({...m,target_group_id:j}))),l({title:"Séance assignée & notifiée"})}catch(m){const P="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",j=m instanceof Error?m.message:typeof m=="string"?m:P;let D=j;const O=j.match(/HTTP \d+:\s*(\{.*\})/);if(O)try{D=JSON.parse(O[1])?.error||P}catch{D=P}l({title:"Erreur d'assignation",description:D})}finally{b(!1)}return}const h=v.trim();if(!h){l({title:"Nageur manquant",description:"Sélectionnez un nageur."});return}const g=S.get(h),w=g?.id??(Number.isFinite(Number(h))&&Number(h)>0?Number(h):void 0);if(!Number.isFinite(w)||Number(w)<=0){l({title:"Nageur invalide",description:"Sélectionnez un nageur avec un identifiant valide."});return}const C=g?.name??h.replace(/^name:/,"");$.mutate({assignment_type:c.session_type,session_id:t,target_athlete:C,target_user_id:w,scheduled_date:c.assigned_date,scheduled_slot:c.assigned_slot})},L=!c.session_id||(x==="group"?p.length===0:!v.trim())||$.isPending||y;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(Q,{title:"Assigner une séance",description:"Planifiez une séance pour un nageur ou un ou plusieurs groupes.",onBack:s}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(te,{className:"border-l-4 border-l-primary",children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Séance"}),e.jsx(re,{children:"Choisissez le type et la séance à envoyer."})]}),e.jsxs(oe,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Type"}),e.jsxs(B,{value:c.session_type,onValueChange:t=>d({...c,session_type:t,session_id:""}),children:[e.jsx(q,{children:e.jsx(G,{})}),e.jsxs(K,{children:[e.jsx(R,{value:"swim",children:"Natation"}),e.jsx(R,{value:"strength",children:"Musculation"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Séance"}),e.jsxs(B,{value:c.session_id,onValueChange:t=>d({...c,session_id:t}),children:[e.jsx(q,{children:e.jsx(G,{placeholder:"Choisir..."})}),e.jsx(K,{children:c.session_type==="swim"?n?.map(t=>e.jsx(R,{value:t.id.toString(),children:t.name},t.id)):i?.map(t=>e.jsx(R,{value:t.id.toString(),children:t.title},t.id))})]})]})]})]}),e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Cible & planification"}),e.jsx(re,{children:"Définissez le destinataire, la date et le créneau."})]}),e.jsxs(oe,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Cible"}),e.jsxs(B,{value:x,onValueChange:t=>{f(t),N(""),k([])},children:[e.jsx(q,{children:e.jsx(G,{})}),e.jsxs(K,{children:[e.jsx(R,{value:"user",children:"Nageur"}),e.jsx(R,{value:"group",children:"Groupe(s)"})]})]})]}),x==="user"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Nageur"}),M.length>0?e.jsxs(B,{value:v,onValueChange:N,children:[e.jsx(q,{children:e.jsx(G,{placeholder:"Choisir un nageur"})}),e.jsx(K,{children:M.map(t=>e.jsx(R,{value:t.value,children:t.label},t.value))})]}):e.jsx(me,{value:v,onChange:t=>N(t.target.value),placeholder:"ex: Camille"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Groupes"}),a.length>0?e.jsxs(ot,{children:[e.jsx(it,{asChild:!0,children:e.jsxs(T,{type:"button",variant:"outline",className:"w-full justify-between","aria-label":"Sélection des groupes",children:[e.jsx("span",{className:"truncate",children:U}),e.jsx(bs,{className:"ml-2 h-4 w-4 opacity-50"})]})}),e.jsxs(We,{className:"w-[--radix-popover-trigger-width] p-2",align:"start",children:[e.jsx("div",{className:"max-h-64 overflow-auto",children:e.jsx("div",{className:"space-y-1",children:E.map(t=>{const h=p.includes(t.gid);return e.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 hover:bg-muted",children:[e.jsx(hs,{checked:h,onCheckedChange:g=>{const w=g===!0;k(C=>w?C.includes(t.gid)?C:[...C,t.gid]:C.filter(m=>m!==t.gid))}}),e.jsx("span",{className:"text-sm",children:t.name})]},t.gid)})})}),p.length>0?e.jsx(T,{type:"button",variant:"ghost",size:"sm",className:"mt-2 w-full",onClick:()=>k([]),children:"Tout désélectionner"}):null]})]}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"Aucun groupe disponible."}),p.length>0?e.jsxs("div",{className:"text-xs text-muted-foreground",children:[p.length," groupe",p.length>1?"s":""," sélectionné",p.length>1?"s":"","."]}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Date"}),e.jsx(me,{type:"date",value:c.assigned_date,onChange:t=>d({...c,assigned_date:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Créneau"}),e.jsxs(B,{value:c.assigned_slot,onValueChange:t=>d({...c,assigned_slot:t}),children:[e.jsx(q,{children:e.jsx(G,{placeholder:"Choisir..."})}),e.jsxs(K,{children:[e.jsx(R,{value:"morning",children:"Matin"}),e.jsx(R,{value:"evening",children:"Soir"})]})]})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(T,{className:"w-full sm:w-auto",onClick:W,disabled:L,children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),$.isPending||y?"Assignation...":"Assigner & notifier"]})})]})},ct=({onBack:s,athletes:n,groups:i,athletesLoading:r})=>{const{toast:a}=he(),[l,c]=o.useState(""),[d,y]=o.useState("Message Coach"),[b,x]=o.useState(""),f=o.useMemo(()=>n.filter(u=>u.id).map(u=>({value:`user:${u.id}`,label:u.group_label?`${u.display_name} · ${u.group_label}`:u.display_name,id:u.id})),[n]),v=o.useMemo(()=>i.map(u=>({value:`group:${u.id}`,label:u.name,id:u.id})),[i]),N=o.useMemo(()=>new Map([...f,...v].map(u=>[u.value,u])),[f,v]),p=fe({mutationFn:u=>F.notifications_send({...u,type:"message"}),onSuccess:()=>{a({title:"Message envoyé"}),c("")}}),k=()=>{if(!d.trim()||!l.trim()){a({title:"Message incomplet",description:"Ajoutez un titre et un contenu."});return}if(!b){a({title:"Destinataire manquant",description:"Sélectionnez un nageur ou un groupe."});return}const u=N.get(b);if(!u?.id){a({title:"Destinataire invalide",description:"Sélectionnez un destinataire valide."});return}if(b.startsWith("group:")){p.mutate({title:d,body:l,targets:[{target_group_id:u.id}]});return}p.mutate({title:d,body:l,targets:[{target_user_id:u.id}]})};return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(Q,{title:"Messagerie rapide",description:"Envoyez un message ciblé à vos nageurs.",onBack:s}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(te,{className:"border-l-4 border-l-primary",children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Destinataire"}),e.jsx(re,{children:"Sélectionnez un nageur ou un groupe à prévenir."})]}),e.jsx(oe,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Destinataire"}),e.jsxs(B,{value:b,onValueChange:x,children:[e.jsx(q,{children:e.jsx(G,{placeholder:r?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(K,{children:[v.length?e.jsxs(e.Fragment,{children:[e.jsx(R,{value:"section-group",disabled:!0,children:"Groupes"}),v.map(u=>e.jsx(R,{value:u.value,children:u.label},u.value))]}):null,f.length?e.jsxs(e.Fragment,{children:[e.jsx(R,{value:"section-athlete",disabled:!0,children:"Nageurs"}),f.map(u=>e.jsx(R,{value:u.value,children:u.label},u.value))]}):null]})]})]})})]}),e.jsxs(te,{children:[e.jsxs(ne,{children:[e.jsx(ae,{children:"Contenu"}),e.jsx(re,{children:"Rédigez votre message en quelques lignes."})]}),e.jsxs(oe,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"msg-title",children:"Titre"}),e.jsx(me,{id:"msg-title",value:d,onChange:u=>y(u.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"msg-body",children:"Message"}),e.jsx(Ns,{id:"msg-body",placeholder:"Message...",value:l,onChange:u=>c(u.target.value),rows:5,maxLength:500}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[l.length,"/500"]})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(T,{className:"w-full sm:w-auto",onClick:k,disabled:p.isPending,children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),p.isPending?"Envoi...":"Envoyer"]})})]})};function we(s){return String(s).padStart(2,"0")}function X(s){return`${s.getFullYear()}-${we(s.getMonth()+1)}-${we(s.getDate())}`}function ue(s){return new Date(s.getFullYear(),s.getMonth(),1)}function Se(s,n){const i=new Date(s);return i.setDate(i.getDate()+n),i}function dt(s){return(s.getDay()+6)%7}function _e(s){if(!s)return"AM";const n=s.toLowerCase();return n==="evening"||n.includes("soir")||n==="pm"?"PM":"AM"}function ut({groupId:s,userId:n,enabled:i}){const r=o.useMemo(()=>new Date,[]),[a,l]=o.useState(()=>ue(new Date)),[c,d]=o.useState(()=>X(new Date)),[y,b]=o.useState(null),[x,f]=o.useState(!1),v=o.useMemo(()=>ue(a),[a]),N=o.useMemo(()=>{const g=dt(v),w=Se(v,-g),C=[];for(let m=0;m<42;m++)C.push(Se(w,m));return C},[v]),p=o.useMemo(()=>{const g=X(N[0]),w=X(N[N.length-1]);return{from:g,to:w}},[N]),k=!!(s||n),{data:u=[],isLoading:M}=Y({queryKey:["coach-calendar-assignments",s,n,p.from,p.to],queryFn:()=>F.getCoachAssignments({groupId:s??null,userId:n??null,from:p.from,to:p.to}),enabled:k}),S=o.useMemo(()=>{const g=new Map;for(const w of u){const C=w.scheduledDate?.slice(0,10);C&&(g.has(C)||g.set(C,[]),g.get(C).push(w))}return g},[u]),E=o.useMemo(()=>{const g={};for(const w of N){const C=X(w),m=S.get(C)??[],P=m.some(I=>_e(I.scheduledSlot)==="AM"),j=m.some(I=>_e(I.scheduledSlot)==="PM"),D=(P?1:0)+(j?1:0),O=[{slotKey:"AM",expected:P,completed:P,absent:!1},{slotKey:"PM",expected:j,completed:j,absent:!1}];g[C]={completed:D,total:D,slots:O}}return g},[N,S]),A=o.useMemo(()=>{const[g,w,C]=c.split("-").map(Number);return new Date(g,w-1,C)},[c]),U=o.useMemo(()=>S.get(c)??[],[S,c]),$=E[c]??{completed:0,total:0,slots:[{slotKey:"AM",expected:!1,completed:!1,absent:!1},{slotKey:"PM",expected:!1,completed:!1,absent:!1}]},W=o.useCallback(()=>{l(g=>new Date(g.getFullYear(),g.getMonth()-1,1))},[]),L=o.useCallback(()=>{l(g=>new Date(g.getFullYear(),g.getMonth()+1,1))},[]),t=o.useCallback(()=>{l(ue(new Date)),d(X(new Date))},[]),h=o.useCallback(g=>{d(g),f(!0)},[]);return{today:r,monthCursor:a,selectedISO:c,selectedDayIndex:y,drawerOpen:x,gridDates:N,completionByISO:E,selectedDate:A,selectedDayStatus:$,assignmentsForSelectedDay:U,isLoading:M,hasFilter:k,setSelectedISO:d,setSelectedDayIndex:b,setDrawerOpen:f,prevMonth:W,nextMonth:L,jumpToday:t,openDay:h}}function mt(s){if(!s)return"—";const n=s.toLowerCase();return n==="morning"||n.includes("mat")||n==="am"?"Matin":n==="evening"||n.includes("soir")||n==="pm"?"Soir":s}function pt(s){switch(s){case"assigned":return"Assigné";case"in_progress":return"En cours";case"completed":return"Terminé";default:return s}}function gt(s){switch(s){case"completed":return"default";case"in_progress":return"secondary";default:return"outline"}}function ht(s){const[n,i,r]=s.split("-").map(Number);return new Date(n,i-1,r).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})}function xt({onBack:s,onAssign:n,athletes:i,groups:r}){const[a,l]=o.useState("group"),[c,d]=o.useState(""),[y,b]=o.useState(""),x=a==="group"&&c?Number(c):null,f=a==="user"&&y?Number(y):null,{today:v,monthCursor:N,selectedISO:p,selectedDayIndex:k,drawerOpen:u,gridDates:M,completionByISO:S,selectedDayStatus:E,assignmentsForSelectedDay:A,hasFilter:U,setSelectedISO:$,setSelectedDayIndex:W,setDrawerOpen:L,prevMonth:t,nextMonth:h,jumpToday:g,openDay:w}=ut({groupId:x,userId:f,enabled:!0}),C=(m,P)=>{let j=P;if(m.key==="ArrowLeft"&&(j=Math.max(0,P-1)),m.key==="ArrowRight"&&(j=Math.min(M.length-1,P+1)),m.key==="ArrowUp"&&(j=Math.max(0,P-7)),m.key==="ArrowDown"&&(j=Math.min(M.length-1,P+7)),j!==P){m.preventDefault(),W(j);const D=Z=>String(Z).padStart(2,"0"),O=M[j],I=`${O.getFullYear()}-${D(O.getMonth()+1)}-${D(O.getDate())}`;$(I)}if(m.key==="Enter"||m.key===" "){m.preventDefault();const D=Z=>String(Z).padStart(2,"0"),O=M[P],I=`${O.getFullYear()}-${D(O.getMonth()+1)}-${D(O.getDate())}`;w(I)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(Q,{title:"Calendrier",description:"Vue mensuelle des assignations",onBack:s}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs(Te,{type:"single",value:a,onValueChange:m=>{(m==="group"||m==="user")&&l(m)},className:"shrink-0",children:[e.jsx(ee,{value:"group",className:"text-xs px-3",children:"Groupe"}),e.jsx(ee,{value:"user",className:"text-xs px-3",children:"Nageur"})]}),a==="group"?e.jsxs(B,{value:c,onValueChange:d,children:[e.jsx(q,{className:"w-full sm:w-56",children:e.jsx(G,{placeholder:"Choisir un groupe"})}),e.jsx(K,{children:r.map(m=>e.jsx(R,{value:String(m.id),children:m.name},String(m.id)))})]}):e.jsxs(B,{value:y,onValueChange:b,children:[e.jsx(q,{className:"w-full sm:w-56",children:e.jsx(G,{placeholder:"Choisir un nageur"})}),e.jsx(K,{children:i.filter(m=>m.id!=null).map(m=>e.jsxs(R,{value:String(m.id),children:[m.display_name,m.group_label?` · ${m.group_label}`:""]},String(m.id)))})]})]}),U?e.jsxs("div",{className:"rounded-2xl border bg-card shadow-sm",children:[e.jsx(Cs,{monthCursor:N,selectedDayStatus:E,onPrevMonth:t,onNextMonth:h,onJumpToday:g}),e.jsx(ws,{monthCursor:N,gridDates:M,completionByISO:S,selectedISO:p,selectedDayIndex:k,today:v,onDayClick:w,onKeyDown:C})]}):e.jsx("div",{className:"py-12 text-center text-sm text-muted-foreground",children:"S\\u00e9lectionnez un groupe ou un nageur pour afficher le calendrier."}),e.jsx(Ss,{open:u,onOpenChange:L,children:e.jsxs(_s,{side:"bottom",className:"max-h-[70vh] overflow-y-auto rounded-t-2xl",children:[e.jsxs(Ms,{className:"pb-3",children:[e.jsxs(Ps,{className:"capitalize text-left",children:[ht(p),A.length>0&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-muted-foreground",children:["(",A.length," assignation",A.length!==1?"s":"",")"]})]}),e.jsx(ks,{className:"sr-only",children:"D\\u00e9tail des assignations pour cette journ\\u00e9e"})]}),A.length===0?e.jsx("p",{className:"py-6 text-center text-sm text-muted-foreground",children:"Aucune assignation ce jour."}):e.jsx("div",{className:"space-y-2",children:A.map(m=>e.jsx(ft,{assignment:m},m.id))}),e.jsx("div",{className:"pt-4",children:e.jsxs(T,{className:"w-full",onClick:()=>n(p),children:[e.jsx(Fs,{className:"mr-2 h-4 w-4"}),"Assigner une s\\u00e9ance"]})})]})})]})}function ft({assignment:s}){const n=s.type==="swim";return e.jsxs("div",{className:"flex items-start gap-3 rounded-xl border p-3",children:[e.jsx("div",{className:"mt-0.5",children:n?e.jsx(Oe,{className:"h-4 w-4 text-blue-500"}):e.jsx(Fe,{className:"h-4 w-4 text-orange-500"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:s.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 mt-1",children:[e.jsx(ge,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:n?"Nage":"Muscu"}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:mt(s.scheduledSlot)}),e.jsx(ge,{variant:gt(s.status),className:"text-[10px] px-1.5 py-0",children:pt(s.status)})]})]})]})}const vt=o.lazy(()=>Ie(()=>import("./StrengthCatalog-Cp8MS_7G.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34]))),jt=o.lazy(()=>Ie(()=>import("./SwimCatalog-BfE8nhk6.js"),__vite__mapDeps([35,1,2,3,4,5,17,18,8,10,20,15,36,31,37,22,11,14,23,24,25,16,9,7,12,28,38,27]))),yt=({onNavigate:s,onOpenRecordsAdmin:n,onOpenRecordsClub:i,athletes:r,athletesLoading:a,upcomingBirthdays:l,birthdaysLoading:c,kpiLoading:d,kpiPeriod:y,onKpiPeriodChange:b,fatigueAlerts:x,mostLoadedAthlete:f,swimSessionCount:v,strengthSessionCount:N})=>{const p=new Date().getHours(),k=p<12?"Bonjour":p<18?"Bon après-midi":"Bonsoir",u=new Date().toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}),M=x.length>0;return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold uppercase italic",children:[k,", ",e.jsx("span",{className:"text-primary",children:"Coach"})]}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:u})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Signaux · ",y,"j"]}),e.jsxs(Te,{type:"single",size:"sm",variant:"outline",value:String(y),onValueChange:S=>{S&&b(Number(S))},children:[e.jsx(ee,{value:"7",className:"h-7 px-2 text-xs","aria-label":"7 jours",children:"7j"}),e.jsx(ee,{value:"30",className:"h-7 px-2 text-xs","aria-label":"30 jours",children:"30j"}),e.jsx(ee,{value:"365",className:"h-7 px-2 text-xs","aria-label":"1 an",children:"1an"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:`rounded-xl border p-3 ${M?"border-destructive/30 bg-destructive/5":"bg-muted/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Fatigue 5/5"}),e.jsx(Ts,{className:`h-3.5 w-3.5 ${M?"text-destructive":"text-muted-foreground"}`})]}),e.jsx("p",{className:"text-xl font-bold tabular-nums",children:d?"–":x.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground truncate",children:d?"Chargement…":M?x.slice(0,2).map(S=>S.athleteName.split(" ")[0]).join(", "):"Aucune alerte"})]}),e.jsxs("div",{className:"rounded-xl border bg-muted/30 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Plus chargé"}),e.jsx(pe,{className:"h-3.5 w-3.5 text-muted-foreground"})]}),e.jsx("p",{className:"text-xl font-bold truncate",children:d?"–":f?.athleteName?.split(" ")[0]??"–"}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:d?"Calcul…":f?`Charge ${Math.round(f.loadScore)}`:"Pas de données"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>s("assignments"),className:"flex items-center gap-1.5 rounded-full bg-primary text-primary-foreground px-4 py-2 text-sm font-semibold active:opacity-80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(le,{className:"h-3.5 w-3.5"}),"Assigner"]}),e.jsxs("button",{type:"button",onClick:()=>s("messaging"),className:"flex items-center gap-1.5 rounded-full border px-4 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(xe,{className:"h-3.5 w-3.5"}),"Message"]}),e.jsxs("button",{type:"button",onClick:()=>s("calendar"),className:"flex items-center gap-1.5 rounded-full border px-4 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Rs,{className:"h-3.5 w-3.5"}),"Calendrier"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>s("swim"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Oe,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:v!=null?`${v} séance${v!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>s("strength"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Fe,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Musculation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:N!=null?`${N} séance${N!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>s("swimmers"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(pe,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Nageurs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a?"Chargement…":`${r.length} nageur${r.length!==1?"s":""}`})]}),e.jsxs("button",{type:"button",onClick:n,className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(us,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Records club"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Import & administration"})]})]}),e.jsx("button",{type:"button",onClick:i,className:"w-full text-center text-sm text-primary font-semibold py-1 active:opacity-70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring rounded",children:"Voir les records du club"}),!c&&l&&l.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Anniversaires"}),e.jsx("div",{className:"space-y-1.5",children:l.slice(0,3).map(S=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:S.display_name}),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:bt(S.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-bold text-primary",children:["J-",S.days_until]})]},S.id))})]}):null]})},bt=s=>{if(!s)return"-";const n=new Date(s);return Number.isNaN(n.getTime())?s:n.toLocaleDateString("fr-FR")},Me=s=>s.toISOString().split("T")[0],Nt=s=>new Date(s.completed_at||s.started_at||s.date||s.created_at||0).getTime(),Ct=s=>{if(!s.length)return null;const n=s.reduce((r,a)=>r+a,0)/s.length,i=Math.min(5,Math.max(1,Math.round(n/10*5)));return{average:n,rating:i}};function wt(){const s=Ne(t=>t.role),n=Ne(t=>t.setSelectedAthlete),[,i]=cs(),[r,a]=o.useState("home"),[l,c]=o.useState(7),d=s==="coach"||s==="admin",y=r==="home"||r==="assignments",b=r==="home"||r==="assignments"||r==="messaging"||r==="swimmers"||r==="calendar",x=r==="assignments"||r==="messaging"||r==="calendar",f=r==="home"||r==="swimmers",{data:v}=Y({queryKey:["swim_catalog"],queryFn:()=>F.getSwimCatalog(),enabled:d&&y}),{data:N}=Y({queryKey:["strength_catalog"],queryFn:()=>F.getStrengthSessions(),enabled:d&&y}),{data:p=[],isLoading:k}=Y({queryKey:["athletes"],queryFn:()=>F.getAthletes(),enabled:d&&b}),u=o.useMemo(()=>p.slice(0,5),[p]),{data:M=[]}=Y({queryKey:["groups"],queryFn:()=>F.getGroups(),enabled:d&&x}),S=Y({queryKey:["upcoming-birthdays"],queryFn:()=>F.getUpcomingBirthdays({days:30}),enabled:d&&f}),E=S.data,A=Y({queryKey:["coach-kpis",l,u.map(t=>t.id??t.display_name)],enabled:d&&r==="home"&&u.length>0,queryFn:async()=>{const t=l,h=new Date;h.setDate(h.getDate()-t);const g=Me(h),w=Me(new Date),C=await Promise.all(u.map(async j=>{const[D,O]=await Promise.all([F.getSessions(j.display_name,j.id),F.getStrengthHistory(j.display_name,{athleteId:j.id,limit:50,from:g,to:w})]),I=D.filter(_=>new Date(_.date).getTime()>=h.getTime()),Z=I.map(_=>_.fatigue??_.feeling).filter(_=>Number.isFinite(_)),Ye=I.reduce((_,V)=>_+(Number(V.duration)||0)*(Number(V.effort)||0),0),je=(O?.runs??[]).filter(_=>Nt(_)>=h.getTime()),Qe=je.map(_=>_.fatigue??_.feeling??_.rpe).filter(_=>Number.isFinite(Number(_))).map(_=>Number(_)),Je=je.reduce((_,V)=>{const ye=Number(V.feeling??V.rpe??0),be=Number(V.duration??0);if(be>0&&ye>0)return _+be*ye;const Xe=Array.isArray(V.logs)?V.logs.length:0;return _+Xe*5},0),Ze=Ct([...Z,...Qe]);return{athleteName:j.display_name,loadScore:Ye+Je,fatigueRating:Ze}})),m=C.filter(j=>j.fatigueRating?.rating===5).map(j=>({athleteName:j.athleteName,rating:j.fatigueRating?.rating??0})),P=C.filter(j=>j.loadScore>0).sort((j,D)=>D.loadScore-j.loadScore)[0];return{fatigueAlerts:m,mostLoadedAthlete:P??null}}}),U=t=>{n({id:t.id??null,name:t.display_name}),i("/progress")},{toast:$}=he(),W=ps(),L=fe({mutationFn:async t=>{const h=await F.importSingleSwimmer(t.iuf,t.name);return await F.recalculateClubRecords(),h},onSuccess:t=>{$({title:"Import terminé",description:`${t.total_found} trouvées, ${t.new_imported} nouvelles.`}),W.invalidateQueries({queryKey:["club-records"]})},onError:t=>{$({title:"Erreur import",description:t.message,variant:"destructive"})}});return d?e.jsxs("div",{className:"space-y-6",children:[r==="home"?e.jsx(yt,{onNavigate:a,onOpenRecordsAdmin:()=>i("/records-admin"),onOpenRecordsClub:()=>i("/records-club"),athletes:p,athletesLoading:k,upcomingBirthdays:E,birthdaysLoading:S.isLoading,kpiLoading:A.isLoading,kpiPeriod:l,onKpiPeriodChange:c,fatigueAlerts:A.data?.fatigueAlerts??[],mostLoadedAthlete:A.data?.mostLoadedAthlete??null,swimSessionCount:v?.length,strengthSessionCount:N?.length}):null,r==="assignments"?e.jsx(lt,{onBack:()=>a("home"),swimSessions:v,strengthSessions:N,athletes:p,groups:M}):null,r==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Q,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>a("home"),actions:e.jsxs(T,{variant:"outline",onClick:()=>a("assignments"),children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(o.Suspense,{fallback:e.jsx(Ce,{}),children:e.jsx(jt,{})})]}):null,r==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Q,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>a("home"),actions:e.jsxs(T,{variant:"outline",onClick:()=>a("assignments"),children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(o.Suspense,{fallback:e.jsx(Ce,{}),children:e.jsx(vt,{})})]}):null,r==="swimmers"?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Q,{title:"Nageurs",description:k?"Chargement…":`${p.length} nageur${p.length!==1?"s":""} inscrit${p.length!==1?"s":""}`,onBack:()=>a("home"),actions:e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>a("messaging"),children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Message"]})}),k?e.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(t=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-8 w-16 rounded bg-muted"})]})},t))}):p.length?e.jsx("div",{className:"space-y-2",children:p.map(t=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border bg-card p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:t.display_name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[t.group_label?e.jsx(ge,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:t.group_label}):null,t.ffn_iuf?e.jsx("span",{className:"text-[10px] font-mono text-muted-foreground",children:t.ffn_iuf}):null]})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[t.ffn_iuf?e.jsx(T,{size:"icon",variant:"ghost",className:"h-8 w-8",disabled:L.isPending,onClick:()=>L.mutate({iuf:t.ffn_iuf,name:t.display_name}),title:"Importer performances FFN",children:e.jsx(ds,{className:"h-4 w-4"})}):null,e.jsx(T,{size:"sm",variant:"outline",onClick:()=>U(t),children:"Fiche"})]})]},t.id??t.display_name))}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Aucun nageur disponible."})]}):null,r==="messaging"?e.jsx(ct,{onBack:()=>a("home"),athletes:p,groups:M,athletesLoading:k}):null,r==="calendar"?e.jsx(xt,{onBack:()=>a("home"),onAssign:t=>{a("assignments")},athletes:p,groups:M}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(te,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(ne,{children:[e.jsxs(ae,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(pe,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(re,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(oe,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}const zt=Object.freeze(Object.defineProperty({__proto__:null,default:wt},Symbol.toStringTag,{value:"Module"}));export{zt as C,ot as P,it as a,We as b};
