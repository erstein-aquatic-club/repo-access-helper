import{r as u,b as ys,h as Ns,m as Te,n as bs,j as e,d as qe,o as _s,l as Q,u as de,I as ws,t as Ss,E as Cs}from"./vendor-ui-DJQMR4VV.js";import{b as Es,u as ye,c as M}from"./vendor-query-BT4y-huw.js";import{c as Ge,a as q,C as Rs,L as g,I as E,f as ks,d as F,B as P,S as Z,D as Ne,s as be}from"./index-Dyae1WSo.js";import{u as Ds,S as ee,a as se,b as te,c as re,d as I}from"./select-D6RXW32l.js";import{C as Fs}from"./circle-GZRIf-yD.js";import{T as V}from"./textarea-CzJAa6oU.js";import{D as ae,a as ne,b as ie,c as le}from"./dialog-DjPZW-Ir.js";import{C as _e}from"./checkbox-BsW9afca.js";import{A as we,a as Se,b as Ce,c as Ee,d as Re,e as ke,f as De,g as Fe}from"./alert-dialog-CsqA_DN1.js";import{T as Is,a as As,b as Ms,c as Ps}from"./tabs-rO4tL8ZK.js";import{A as $s,a as Ls,F as Ts,S as qs,b as Gs}from"./SessionListView-D4MgI1Av.js";import{C as Os}from"./chevron-up-DYGqpyYs.js";import{T as Oe,P as z}from"./trash-2-Br0HBeec.js";import{L as Ie}from"./loader-circle-BdxmrW54.js";import{C as Us}from"./circle-alert-CJjyTAV2.js";import{S as Ks}from"./search-BdFXoBi_.js";import{P as Bs}from"./pen-C1u8Y4VY.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-Db4xOvcx.js";import"./vendor-supabase-D7B1G6YZ.js";import"./check-C_sojMmi.js";import"./chevron-left-Yt11NKF_.js";import"./save-CxueBLCZ.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],zs=Ge("funnel",Vs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Ae=Ge("upload",Qs);function ce(t,r,{checkForDefaultPrevented:a=!0}={}){return function(n){if(t?.(n),a===!1||!n.defaultPrevented)return r?.(n)}}var Ws=ys[" useInsertionEffect ".trim().toString()]||Ns;function Hs({prop:t,defaultProp:r,onChange:a=()=>{},caller:l}){const[n,i,f]=Xs({defaultProp:r,onChange:a}),x=t!==void 0,j=x?t:n;{const d=u.useRef(t!==void 0);u.useEffect(()=>{const h=d.current;h!==x&&console.warn(`${l} is changing from ${h?"controlled":"uncontrolled"} to ${x?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=x},[x,l])}const m=u.useCallback(d=>{if(x){const h=Ys(d)?d(t):d;h!==t&&f.current?.(h)}else i(d)},[x,t,i,f]);return[j,m]}function Xs({defaultProp:t,onChange:r}){const[a,l]=u.useState(t),n=u.useRef(a),i=u.useRef(r);return Ws(()=>{i.current=r},[r]),u.useEffect(()=>{n.current!==a&&(i.current?.(a),n.current=a)},[a,n]),[a,l,i]}function Ys(t){return typeof t=="function"}var ue="Radio",[Js,Ue]=qe(ue),[Zs,et]=Js(ue),Ke=u.forwardRef((t,r)=>{const{__scopeRadio:a,name:l,checked:n=!1,required:i,disabled:f,value:x="on",onCheck:j,form:m,...d}=t,[h,N]=u.useState(null),v=de(r,k=>N(k)),b=u.useRef(!1),o=h?m||!!h.closest("form"):!0;return e.jsxs(Zs,{scope:a,checked:n,disabled:f,children:[e.jsx(Q.button,{type:"button",role:"radio","aria-checked":n,"data-state":Qe(n),"data-disabled":f?"":void 0,disabled:f,value:x,...d,ref:v,onClick:ce(t.onClick,k=>{n||j?.(),o&&(b.current=k.isPropagationStopped(),b.current||k.stopPropagation())})}),o&&e.jsx(ze,{control:h,bubbles:!b.current,name:l,value:x,checked:n,required:i,disabled:f,form:m,style:{transform:"translateX(-100%)"}})]})});Ke.displayName=ue;var Be="RadioIndicator",Ve=u.forwardRef((t,r)=>{const{__scopeRadio:a,forceMount:l,...n}=t,i=et(Be,a);return e.jsx(Ss,{present:l||i.checked,children:e.jsx(Q.span,{"data-state":Qe(i.checked),"data-disabled":i.disabled?"":void 0,...n,ref:r})})});Ve.displayName=Be;var st="RadioBubbleInput",ze=u.forwardRef(({__scopeRadio:t,control:r,checked:a,bubbles:l=!0,...n},i)=>{const f=u.useRef(null),x=de(f,i),j=Ds(a),m=Cs(r);return u.useEffect(()=>{const d=f.current;if(!d)return;const h=window.HTMLInputElement.prototype,v=Object.getOwnPropertyDescriptor(h,"checked").set;if(j!==a&&v){const b=new Event("click",{bubbles:l});v.call(d,a),d.dispatchEvent(b)}},[j,a,l]),e.jsx(Q.input,{type:"radio","aria-hidden":!0,defaultChecked:a,...n,tabIndex:-1,ref:x,style:{...n.style,...m,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});ze.displayName=st;function Qe(t){return t?"checked":"unchecked"}var tt=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],W="RadioGroup",[rt]=qe(W,[Te,Ue]),We=Te(),He=Ue(),[at,nt]=rt(W),Xe=u.forwardRef((t,r)=>{const{__scopeRadioGroup:a,name:l,defaultValue:n,value:i,required:f=!1,disabled:x=!1,orientation:j,dir:m,loop:d=!0,onValueChange:h,...N}=t,v=We(a),b=bs(m),[o,k]=Hs({prop:i,defaultProp:n??null,onChange:h,caller:W});return e.jsx(at,{scope:a,name:l,required:f,disabled:x,value:o,onValueChange:k,children:e.jsx(_s,{asChild:!0,...v,orientation:j,dir:b,loop:d,children:e.jsx(Q.div,{role:"radiogroup","aria-required":f,"aria-orientation":j,"data-disabled":x?"":void 0,dir:b,...N,ref:r})})})});Xe.displayName=W;var Ye="RadioGroupItem",Je=u.forwardRef((t,r)=>{const{__scopeRadioGroup:a,disabled:l,...n}=t,i=nt(Ye,a),f=i.disabled||l,x=We(a),j=He(a),m=u.useRef(null),d=de(r,m),h=i.value===n.value,N=u.useRef(!1);return u.useEffect(()=>{const v=o=>{tt.includes(o.key)&&(N.current=!0)},b=()=>N.current=!1;return document.addEventListener("keydown",v),document.addEventListener("keyup",b),()=>{document.removeEventListener("keydown",v),document.removeEventListener("keyup",b)}},[]),e.jsx(ws,{asChild:!0,...x,focusable:!f,active:h,children:e.jsx(Ke,{disabled:f,required:i.required,checked:h,...j,...n,name:i.name,ref:d,onCheck:()=>i.onValueChange(n.value),onKeyDown:ce(v=>{v.key==="Enter"&&v.preventDefault()}),onFocus:ce(n.onFocus,()=>{N.current&&m.current?.click()})})})});Je.displayName=Ye;var it="RadioGroupIndicator",Ze=u.forwardRef((t,r)=>{const{__scopeRadioGroup:a,...l}=t,n=He(a);return e.jsx(Ve,{...n,...l,ref:r})});Ze.displayName=it;var es=Xe,ss=Je,lt=Ze;const ts=u.forwardRef(({className:t,...r},a)=>e.jsx(es,{className:q("grid gap-2",t),...r,ref:a}));ts.displayName=es.displayName;const oe=u.forwardRef(({className:t,...r},a)=>e.jsx(ss,{ref:a,className:q("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),...r,children:e.jsx(lt,{className:"flex items-center justify-center",children:e.jsx(Fs,{className:"h-3.5 w-3.5 fill-primary"})})}));oe.displayName=ss.displayName;function ct({exercise:t,exercises:r,exerciseFilter:a,index:l,totalItems:n,onChange:i,onDelete:f,onMoveUp:x,onMoveDown:j}){const[m,d]=u.useState(!1),h=r.filter(o=>a==="all"?!0:o.exercise_type===a),N=r.find(o=>o.id===t.exercise_id),v=N?.nom_exercice??"Exercice",b=N?.exercise_type==="warmup";return e.jsxs(Rs,{className:q("rounded-2xl border-border transition-all",m&&"ring-1 ring-primary/20"),children:[e.jsxs("button",{type:"button",className:"flex w-full items-center gap-3 p-3 text-left",onClick:()=>d(!m),children:[e.jsx("span",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-muted text-xs font-bold text-muted-foreground",children:l+1}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"truncate text-sm font-semibold",children:v}),b&&e.jsx("span",{className:"shrink-0 rounded-full bg-amber-100 px-2 py-0.5 text-[10px] font-semibold text-amber-800",children:"Échauf."})]}),e.jsxs("div",{className:"mt-0.5 text-xs text-muted-foreground",children:[t.sets,"×",t.reps,t.percent_1rm?` @ ${t.percent_1rm}% 1RM`:"",t.rest_seconds?` · ${t.rest_seconds}s repos`:""]})]}),e.jsx(Os,{className:q("h-4 w-4 shrink-0 text-muted-foreground transition-transform",m&&"rotate-180")})]}),m&&e.jsxs("div",{className:"border-t border-border px-3 pb-3 pt-3 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(g,{className:"text-xs",children:"Séries"}),e.jsx(E,{type:"number",inputMode:"numeric",value:t.sets===0?"":t.sets,onChange:o=>i("sets",o.target.value===""?0:Number(o.target.value)),className:"rounded-xl h-10"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(g,{className:"text-xs",children:"Reps"}),e.jsx(E,{type:"number",inputMode:"numeric",value:t.reps===0?"":t.reps,onChange:o=>i("reps",o.target.value===""?0:Number(o.target.value)),className:"rounded-xl h-10"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(g,{className:"text-xs",children:"% 1RM"}),e.jsx(E,{type:"number",inputMode:"numeric",value:t.percent_1rm===0?"":t.percent_1rm,onChange:o=>i("percent_1rm",o.target.value===""?0:Number(o.target.value)),className:"rounded-xl h-10"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(g,{className:"text-xs",children:"Repos (s)"}),e.jsx(E,{type:"number",inputMode:"numeric",value:t.rest_seconds===0?"":t.rest_seconds,onChange:o=>i("rest_seconds",o.target.value===""?0:Number(o.target.value)),className:"rounded-xl h-10"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(g,{className:"text-xs",children:"Exercice"}),e.jsxs(ee,{value:t.exercise_id.toString(),onValueChange:o=>i("exercise_id",parseInt(o)),children:[e.jsx(se,{className:"rounded-xl",children:e.jsx(te,{})}),e.jsx(re,{children:h.length?h.map(o=>e.jsxs(I,{value:o.id.toString(),children:[o.nom_exercice,o.exercise_type==="warmup"?" · Échauffement":""]},o.id)):e.jsx(I,{value:"no-exercise",disabled:!0,children:"Aucun exercice disponible"})})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(g,{className:"text-xs",children:"Notes"}),e.jsx(V,{value:t.notes??"",onChange:o=>i("notes",o.target.value||null),placeholder:"Notes optionnelles...",className:"rounded-xl min-h-[60px]"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:o=>{o.stopPropagation(),x()},disabled:l===0,className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-30","aria-label":"Monter",children:e.jsx($s,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:o=>{o.stopPropagation(),j()},disabled:l===n-1,className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-30","aria-label":"Descendre",children:e.jsx(Ls,{className:"h-4 w-4"})})]}),e.jsxs("button",{type:"button",onClick:o=>{o.stopPropagation(),f()},className:"inline-flex h-9 items-center gap-2 rounded-full px-3 text-xs font-medium text-destructive hover:bg-destructive/10",children:[e.jsx(Oe,{className:"h-3.5 w-3.5"}),"Supprimer"]})]})]})]})}const ot=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance";function dt({session:t,exercises:r,editingSessionId:a,onSessionChange:l,onSave:n,onCancel:i,onAddItem:f,onUpdateItem:x,onRemoveItem:j,onReorderItems:m,onExerciseDialogOpen:d,isSaving:h}){const[N,v]=u.useState("all"),[b,o]=u.useState(!1),k=new Map(r.map(p=>[p.id,p])),H=t.items.reduce((p,w)=>p+(w.sets||0),0),X=p=>{p>0&&m(p,p-1)},G=p=>{p<t.items.length-1&&m(p,p+1)},$=()=>{o(!0)};return e.jsxs("div",{className:"space-y-4 animate-in slide-in-from-bottom-4",children:[e.jsx(Ts,{isEditing:!!a,isSaving:h,onSave:n,onCancel:i,onPreview:$}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(qs,{name:t.title,onNameChange:p=>l({...t,title:p}),showDuration:!1,showTotalDistance:!1,additionalFields:e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Cycle"}),e.jsx("div",{className:"mt-1",children:e.jsxs(ee,{value:t.cycle,onValueChange:p=>l({...t,cycle:ot(p)}),children:[e.jsx(se,{className:"rounded-2xl",children:e.jsx(te,{})}),e.jsxs(re,{children:[e.jsx(I,{value:"endurance",children:"Endurance"}),e.jsx(I,{value:"hypertrophie",children:"Hypertrophie"}),e.jsx(I,{value:"force",children:"Force"})]})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Séries totales"}),e.jsx("div",{className:"mt-1 rounded-2xl border border-border bg-muted px-3 py-2 text-sm font-semibold",children:H})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Description"}),e.jsx("div",{className:"mt-1",children:e.jsx(V,{value:t.description,onChange:p=>l({...t,description:p.target.value}),placeholder:"Description optionnelle...",className:"rounded-2xl min-h-[60px]"})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-semibold",children:["Exercices (",t.items.length,")"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(ee,{value:N,onValueChange:p=>v(p),children:[e.jsxs(se,{className:"h-8 w-auto gap-1 rounded-full border-dashed text-xs",children:[e.jsx(zs,{className:"h-3 w-3"}),e.jsx(te,{})]}),e.jsxs(re,{children:[e.jsx(I,{value:"all",children:"Tous"}),e.jsx(I,{value:"strength",children:"Travail"}),e.jsx(I,{value:"warmup",children:"Échauf."})]})]})})]}),e.jsx("div",{className:"space-y-2",children:t.items.map((p,w)=>e.jsx(ct,{exercise:p,exercises:r,exerciseFilter:N,index:w,totalItems:t.items.length,onChange:(L,O)=>x(w,L,O),onDelete:()=>j(w),onMoveUp:()=>X(w),onMoveDown:()=>G(w)},`${p.exercise_id}-${w}`))}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:f,className:"inline-flex items-center gap-2 rounded-full bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(z,{className:"h-4 w-4"})," Ajouter un exercice"]}),e.jsxs("button",{type:"button",onClick:d,className:"inline-flex items-center gap-2 rounded-full border border-border px-4 py-2 text-xs font-semibold hover:bg-muted",children:[e.jsx(z,{className:"h-4 w-4"})," Nouvel exercice"]})]})]}),e.jsx(ae,{open:b,onOpenChange:o,children:e.jsxs(ne,{className:"sm:max-w-3xl",children:[e.jsx(ie,{children:e.jsx(le,{children:"Aperçu de la séance"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-lg font-semibold",children:t.title||"Sans titre"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description||"—"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cycle : ",t.cycle]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Exercices"}),e.jsx("div",{className:"space-y-2",children:t.items.slice().sort((p,w)=>(p.order_index??0)-(w.order_index??0)).map((p,w)=>{const L=k.get(p.exercise_id);return e.jsxs("div",{className:"rounded-xl border px-3 py-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("span",{className:"font-medium",children:[w+1,". ",L?.nom_exercice??"Exercice"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:L?.exercise_type==="warmup"?"Échauffement":"Travail"})]}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[p.sets," séries • ",p.reps," reps • ",p.percent_1rm,"% 1RM •"," ",p.rest_seconds,"s"]})]},`${p.exercise_id}-${w}`)})})]})]})]})})]})}const Me=[{key:"endurance",label:"Endurance",fieldSuffix:"endurance"},{key:"hypertrophie",label:"Hypertrophie",fieldSuffix:"hypertrophie"},{key:"force",label:"Force",fieldSuffix:"force"}],ut=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance",Pe=({exercise:t,onChange:r,disabled:a=!1})=>e.jsxs(Is,{defaultValue:"endurance",className:"w-full",children:[e.jsx(As,{className:"grid w-full grid-cols-3",children:Me.map(l=>e.jsx(Ms,{value:l.key,children:l.label},l.key))}),Me.map(l=>{const n=`pct_1rm_${l.fieldSuffix}`,i=`Nb_series_${l.fieldSuffix}`,f=`Nb_reps_${l.fieldSuffix}`,x=`recup_${l.fieldSuffix}`,j=`recup_exercices_${l.fieldSuffix}`;return e.jsxs(Ps,{value:l.key,className:`space-y-3 rounded-lg border p-3 ${a?"opacity-60":""}`,children:[e.jsx("p",{className:"text-sm font-semibold",children:l.label}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"% 1RM"}),e.jsx(E,{type:"number",value:t[n]??"",disabled:a,onChange:m=>r({[n]:m.target.value===""?null:Number(m.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Nb séries"}),e.jsx(E,{type:"number",value:t[i]??"",disabled:a,onChange:m=>r({[i]:m.target.value===""?null:Number(m.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Nb reps"}),e.jsx(E,{type:"number",value:t[f]??"",disabled:a,onChange:m=>r({[f]:m.target.value===""?null:Number(m.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Récup. séries (s)"}),e.jsx(E,{type:"number",value:t[x]??"",disabled:a,onChange:m=>r({[x]:m.target.value===""?null:Number(m.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Récup. exercices (s)"}),e.jsx(E,{type:"number",value:t[j]??"",disabled:a,onChange:m=>r({[j]:m.target.value===""?null:Number(m.target.value)})})]})]})]},l.key)})]}),mt={pct_1rm_endurance:60,pct_1rm_hypertrophie:75,pct_1rm_force:85,Nb_series_endurance:4,Nb_series_hypertrophie:3,Nb_series_force:3,Nb_reps_endurance:16,Nb_reps_hypertrophie:8,Nb_reps_force:3,recup_endurance:120,recup_hypertrophie:200,recup_force:300,recup_exercices_endurance:300,recup_exercices_hypertrophie:400,recup_exercices_force:500},B=t=>{const r=Number(t);return Number.isFinite(r)?r:0},$e=(t,r,a,l)=>{const n=r==="force"?"force":r==="hypertrophie"?"hypertrophie":"endurance",i=`Nb_series_${n}`,f=`Nb_reps_${n}`,x=`pct_1rm_${n}`,j=`recup_${n}`;return{exercise_id:t.id,order_index:a,sets:B(t[i]),reps:B(t[f]),rest_seconds:B(t[j]),percent_1rm:B(t[x]),cycle_type:r,notes:l?.notes??""}},pt=()=>({nom_exercice:"",description:null,illustration_gif:null,exercise_type:"strength",warmup_reps:null,warmup_duration:null,...mt}),Le=({exercise:t,warmupMode:r,onChange:a,onWarmupModeChange:l,idPrefix:n})=>e.jsxs("div",{className:"space-y-3 rounded-lg border p-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Paramètres d'échauffement"}),e.jsxs(ts,{value:r,onValueChange:i=>{l(i==="duration"?"duration":"reps"),a(i==="duration"?{warmup_reps:null,warmup_duration:t.warmup_duration??0}:{warmup_duration:null,warmup_reps:t.warmup_reps??0})},className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{value:"reps",id:`${n}-warmup-reps`}),e.jsx(g,{htmlFor:`${n}-warmup-reps`,children:"Nombre de répétitions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{value:"duration",id:`${n}-warmup-duration`}),e.jsx(g,{htmlFor:`${n}-warmup-duration`,children:"Durée (secondes)"})]})]}),r==="duration"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Durée (s)"}),e.jsx(E,{type:"number",value:t.warmup_duration??"",onChange:i=>a({warmup_duration:i.target.value===""?null:Number(i.target.value)})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Nombre de répétitions"}),e.jsx(E,{type:"number",value:t.warmup_reps??"",onChange:i=>a({warmup_reps:i.target.value===""?null:Number(i.target.value)})})]})]});function Tt(){const{toast:t}=ks(),r=Es(),[a,l]=u.useState(!1),[n,i]=u.useState(null),[f,x]=u.useState(!1),[j,m]=u.useState(!1),[d,h]=u.useState(null),[N,v]=u.useState(null),[b,o]=u.useState(null),[k,H]=u.useState("reps"),[X,G]=u.useState("reps"),[$,p]=u.useState(!1),[w,L]=u.useState(""),O=async(s,c)=>{if(s.size>10485760){t({title:"Fichier trop volumineux",description:"La taille maximale est de 10 Mo.",variant:"destructive"});return}p(!0);try{const y=s.name.split(".").pop()??"gif",C=`exercises/${Date.now()}-${Math.random().toString(36).slice(2)}.${y}`,{error:K}=await be.storage.from("exercise-gifs").upload(C,s,{upsert:!1});if(K)throw K;const{data:vs}=be.storage.from("exercise-gifs").getPublicUrl(C);c(vs.publicUrl),t({title:"Image uploadée"})}catch(y){const C=y instanceof Error?y.message:"Réessayez.";t({title:"Erreur d'upload",description:C,variant:"destructive"})}finally{p(!1)}},[R,D]=u.useState({title:"",description:"",cycle:"endurance",items:[]}),[S,A]=u.useState({...pt()});u.useEffect(()=>{d&&G(d.warmup_duration!=null?"duration":"reps")},[d]);const{data:T,isLoading:rs,error:Y,refetch:as}=ye({queryKey:["exercises"],queryFn:()=>F.getExercises()}),{data:U,isLoading:ns,error:is,refetch:xt}=ye({queryKey:["strength_catalog"],queryFn:()=>F.getStrengthSessions()}),ls=u.useMemo(()=>{if(!U)return[];if(!w.trim())return U;const s=w.toLowerCase();return U.filter(c=>c.title?.toLowerCase().includes(s))},[U,w]),cs=M({mutationFn:s=>F.createExercise(s),onSuccess:()=>{r.invalidateQueries({queryKey:["exercises"]}),x(!1),t({title:"Exercice ajouté"})}}),me=M({mutationFn:s=>F.createStrengthSession(s),onSuccess:()=>{r.invalidateQueries({queryKey:["strength_catalog"]}),l(!1),D({title:"",description:"",cycle:"endurance",items:[]}),t({title:"Séance créée avec succès"})}}),os=M({mutationFn:s=>F.updateExercise(s),onSuccess:()=>{r.invalidateQueries({queryKey:["exercises"]}),r.invalidateQueries({queryKey:["strength_catalog"]}),m(!1),h(null),t({title:"Exercice mis à jour"})}}),ds=M({mutationFn:s=>F.deleteExercise(s),onSuccess:()=>{r.invalidateQueries({queryKey:["exercises"]}),r.invalidateQueries({queryKey:["strength_catalog"]}),o(null),t({title:"Exercice supprimé"})}}),pe=M({mutationFn:s=>F.deleteStrengthSession(s),onSuccess:()=>{r.invalidateQueries({queryKey:["strength_catalog"]}),v(null),t({title:"Séance supprimée"})}}),xe=M({mutationFn:s=>F.updateStrengthSession(s),onSuccess:()=>{r.invalidateQueries({queryKey:["strength_catalog"]}),l(!1),i(null),D({title:"",description:"",cycle:"endurance",items:[]}),t({title:"Séance mise à jour"})}}),us=M({mutationFn:s=>F.persistStrengthSessionOrder(s)}),ms=()=>{l(!1),i(null),D({title:"",description:"",cycle:"endurance",items:[]})},he=s=>{i(s.id),D({title:s.title??"",description:s.description??"",cycle:ut(s.cycle),items:s.items?.map(c=>({exercise_id:c.exercise_id,order_index:c.order_index??0,sets:c.sets,reps:c.reps,rest_seconds:c.rest_seconds,percent_1rm:c.percent_1rm,cycle_type:c.cycle_type,notes:c.notes??""}))??[]}),l(!0)},ps=s=>{h(s),m(!0)},xs=()=>{const s={...R,items:J(R.items)};n?xe.mutate({...s,id:n}):me.mutate(s)},J=s=>s.map((c,_)=>({...c,order_index:_})),hs=()=>{const s=T?.[0];D(c=>({...c,items:[...c.items,s?$e(s,c.cycle,c.items.length):{exercise_id:1,order_index:c.items.length,sets:0,reps:0,rest_seconds:0,percent_1rm:0}]}))},fs=(s,c,_)=>{const y=[...R.items];if(c==="exercise_id"){const C=T?.find(K=>K.id===_);C?y[s]=$e(C,R.cycle,y[s].order_index??s,y[s]):y[s]={...y[s],exercise_id:Number(_)}}else y[s]={...y[s],[c]:_};D({...R,items:y})},gs=s=>{const c=J(R.items.filter((_,y)=>y!==s));D({...R,items:c})},js=(s,c)=>{if(s===c)return;const _=[...R.items],[y]=_.splice(s,1);_.splice(c,0,y);const C=J(_);D({...R,items:C}),n&&us.mutate({id:n,title:R.title,description:R.description,cycle:R.cycle,items:C})},fe=e.jsx(ae,{open:j,onOpenChange:m,children:e.jsxs(ne,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(ie,{children:e.jsx(le,{children:"Modifier l'exercice"})}),d&&e.jsxs("div",{className:"space-y-4",children:[d.exercise_type==="warmup"?e.jsx(Le,{exercise:d,warmupMode:X,onChange:s=>h(c=>c&&{...c,...s}),onWarmupModeChange:G,idPrefix:"edit"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Nom"}),e.jsx(E,{value:d.nom_exercice,onChange:s=>h({...d,nom_exercice:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Description"}),e.jsx(V,{value:d.description??"",onChange:s=>h({...d,description:s.target.value===""?null:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Illustration (GIF)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{value:d.illustration_gif??"",onChange:s=>h({...d,illustration_gif:s.target.value===""?null:s.target.value}),placeholder:"https://...",className:"flex-1"}),e.jsx(P,{type:"button",variant:"outline",size:"icon",disabled:$,onClick:()=>{const s=document.createElement("input");s.type="file",s.accept="image/*,.gif",s.onchange=c=>{const _=c.target.files?.[0];_&&O(_,y=>h(C=>C&&{...C,illustration_gif:y}))},s.click()},"aria-label":"Uploader une image",children:$?e.jsx(Ie,{className:"h-4 w-4 animate-spin"}):e.jsx(Ae,{className:"h-4 w-4"})})]}),d.illustration_gif&&e.jsx("img",{src:d.illustration_gif,alt:"Aperçu",className:"mt-2 h-20 w-20 rounded-lg object-cover border"})]}),d.exercise_type!=="warmup"?e.jsx(Pe,{exercise:d,onChange:s=>h(c=>c&&{...c,...s})}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{id:"warmup-flag-edit",checked:d.exercise_type==="warmup",onCheckedChange:s=>h({...d,exercise_type:s===!0?"warmup":"strength"})}),e.jsx(g,{htmlFor:"warmup-flag-edit",children:"Exercice d'échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(P,{variant:"outline",onClick:()=>{m(!1),h(null)},className:"h-10",children:"Annuler"}),e.jsx(P,{variant:"default",onClick:()=>{d?.id&&os.mutate(d)},disabled:!d.nom_exercice.trim(),className:"h-10",children:"Enregistrer"})]})]})]})}),ge=e.jsx(ae,{open:f,onOpenChange:x,children:e.jsxs(ne,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(ie,{children:e.jsx(le,{children:"Créer un exercice"})}),e.jsxs("div",{className:"space-y-4",children:[S.exercise_type==="warmup"?e.jsx(Le,{exercise:S,warmupMode:k,onChange:s=>A(c=>({...c,...s})),onWarmupModeChange:H,idPrefix:"create"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Nom"}),e.jsx(E,{value:S.nom_exercice,onChange:s=>A({...S,nom_exercice:s.target.value}),placeholder:"ex: Rotations Élastique"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Description"}),e.jsx(V,{value:S.description??"",onChange:s=>A({...S,description:s.target.value===""?null:s.target.value}),placeholder:"Détails, consignes..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Illustration (GIF)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{value:S.illustration_gif??"",onChange:s=>A({...S,illustration_gif:s.target.value===""?null:s.target.value}),placeholder:"https://...",className:"flex-1"}),e.jsx(P,{type:"button",variant:"outline",size:"icon",disabled:$,onClick:()=>{const s=document.createElement("input");s.type="file",s.accept="image/*,.gif",s.onchange=c=>{const _=c.target.files?.[0];_&&O(_,y=>A(C=>({...C,illustration_gif:y})))},s.click()},"aria-label":"Uploader une image",children:$?e.jsx(Ie,{className:"h-4 w-4 animate-spin"}):e.jsx(Ae,{className:"h-4 w-4"})})]}),S.illustration_gif&&e.jsx("img",{src:S.illustration_gif,alt:"Aperçu",className:"mt-2 h-20 w-20 rounded-lg object-cover border"})]}),S.exercise_type!=="warmup"?e.jsx(Pe,{exercise:S,onChange:s=>A(c=>({...c,...s}))}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{id:"warmup-flag",checked:S.exercise_type==="warmup",onCheckedChange:s=>A({...S,exercise_type:s===!0?"warmup":"strength"})}),e.jsx(g,{htmlFor:"warmup-flag",children:"Exercice d'échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(P,{variant:"outline",onClick:()=>x(!1),className:"h-10",children:"Annuler"}),e.jsx(P,{variant:"default",onClick:()=>cs.mutate(S),disabled:!S.nom_exercice.trim(),className:"h-10",children:"Enregistrer"})]})]})]})}),je=e.jsx(we,{open:!!N,onOpenChange:s=>{s||v(null)},children:e.jsxs(Se,{children:[e.jsxs(Ce,{children:[e.jsx(Ee,{children:"Supprimer la séance ?"}),e.jsxs(Re,{children:['Cette action est définitive. La séance "',N?.title,'" sera supprimée.']})]}),e.jsxs(ke,{children:[e.jsx(De,{children:"Annuler"}),e.jsx(Fe,{onClick:()=>{N?.id&&pe.mutate(N.id)},children:"Supprimer"})]})]})}),ve=e.jsx(we,{open:!!b,onOpenChange:s=>{s||o(null)},children:e.jsxs(Se,{children:[e.jsxs(Ce,{children:[e.jsx(Ee,{children:"Supprimer l'exercice ?"}),e.jsxs(Re,{children:[`Cette action est définitive. L'exercice "`,b?.nom_exercice,'" sera supprimé.']})]}),e.jsxs(ke,{children:[e.jsx(De,{children:"Annuler"}),e.jsx(Fe,{onClick:()=>{b?.id&&ds.mutate(b.id)},children:"Supprimer"})]})]})});return a?e.jsxs(e.Fragment,{children:[ge,fe,je,ve,e.jsx(dt,{session:R,exercises:T??[],editingSessionId:n,onSessionChange:D,onSave:xs,onCancel:ms,onAddItem:hs,onUpdateItem:fs,onRemoveItem:gs,onReorderItems:js,onExerciseDialogOpen:()=>x(!0),isSaving:me.isPending||xe.isPending})]}):rs?e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(Z,{className:"h-7 w-64"}),e.jsx(Z,{className:"h-10 w-full rounded-2xl"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:4}).map((s,c)=>e.jsx(Z,{className:"h-20 w-full rounded-2xl"},c))})]}):Y?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(Us,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:Y instanceof Error?Y.message:"Une erreur s'est produite"}),e.jsx(P,{variant:"default",onClick:()=>as(),className:"mt-4 h-12 md:h-10",children:"Réessayer"})]}):e.jsxs("div",{children:[ge,fe,je,ve,e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:"Musculation"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Catalogue"})]}),e.jsxs("button",{type:"button",onClick:()=>{i(null),D({title:"",description:"",cycle:"endurance",items:[]}),l(!0)},className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(z,{className:"h-4 w-4"})," Nouvelle"]})]}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-border bg-card px-3 py-2",children:[e.jsx(Ks,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{className:"w-full bg-transparent text-sm outline-none placeholder:text-muted-foreground",placeholder:"Rechercher une séance",value:w,onChange:s=>L(s.target.value)})]}),e.jsx(Gs,{sessions:ls,isLoading:ns,error:is,renderTitle:s=>s.title??"Sans titre",renderMetrics:s=>{const c=s.items?.length??0,_=s.cycle==="force"?"bg-red-100 text-red-800":s.cycle==="hypertrophie"?"bg-violet-100 text-violet-800":"bg-blue-100 text-blue-800";return e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Ne,{className:"h-3.5 w-3.5"}),c," exo",c>1?"s":""]}),e.jsx("span",{className:q("rounded-full px-2 py-0.5 text-[10px] font-semibold",_),children:s.cycle})]})},onPreview:s=>he(s),onEdit:s=>he(s),onDelete:s=>v(s),canDelete:()=>!0,isDeleting:pe.isPending}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-semibold",children:["Exercices (",T?.length??0,")"]}),e.jsxs("button",{type:"button",onClick:()=>x(!0),className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-2 text-xs font-semibold hover:bg-muted",children:[e.jsx(z,{className:"h-4 w-4"})," Ajouter"]})]}),e.jsx("div",{className:"space-y-1",children:T?.map(s=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl px-3 py-2 hover:bg-muted/50",children:[s.illustration_gif?e.jsx("img",{src:s.illustration_gif,alt:s.nom_exercice,className:"h-10 w-10 shrink-0 rounded-lg object-cover",loading:"lazy",decoding:"async"}):e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-muted",children:e.jsx(Ne,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"truncate text-sm font-medium",children:s.nom_exercice}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.exercise_type==="warmup"?"Échauffement":"Séries de travail"})]}),e.jsxs("div",{className:"flex shrink-0 items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>ps(s),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Modifier",children:e.jsx(Bs,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>o(s),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer",children:e.jsx(Oe,{className:"h-4 w-4"})})]})]},s.id))})]})]})]})}export{$e as createStrengthItemFromExercise,Tt as default};
