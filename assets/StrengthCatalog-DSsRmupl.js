import{r as o,R as Lt,j as e,c as Xr,u as _e,d as X}from"./vendor-query-BiSH4r2z.js";import{a as V}from"./api-R6k1jfwT.js";import{c as tt,r as Kt,v as rt,t as U,y as ve,x as st,z as Yr,a as W,K as fe,D as nt,C as Jr,L as I,I as G,Q as Gt,V as es,Z as Vt,M as ts,O as rs,a0 as ss,a1 as ns,d as as,B as oe,S as Oe,s as jt}from"./index-C8Ys7NvK.js";import{c as Ut,R as os,I as ls}from"./index-CDyVNzIM.js";import{u as is,a as le}from"./index-BRt7zf33.js";import{u as cs,S as $e,a as Te,b as qe,c as Le,d as te,h as ds,R as us,e as ms,F as ps}from"./select-DsJlP3hw.js";import{C as fs,T as at}from"./CalendarGrid-DkXeLh3U.js";import{T as Se}from"./textarea-CHxrzSZL.js";import{D as Ee,a as Re,b as Be,c as Qe}from"./dialog-Ckkd2TFJ.js";import{C as yt}from"./checkbox-CG8znl5P.js";import{A as bt,a as Nt,b as wt,c as _t,d as Ct,e as St,f as Et,g as Rt}from"./alert-dialog-DCuo1LOp.js";import{T as zt,a as Bt,b as We,c as He}from"./tabs-vpxpkbm_.js";import{A as xs,a as hs,F as gs,S as vs,b as js,c as ys,d as kt}from"./SessionListView-Da30hUDw.js";import{D as bs,a as Ns,b as ws,c as _s}from"./drawer-BNjlGAtd.js";import{R as Cs,P as Ss,O as Es,C as Rs}from"./index-Bbul7mm2.js";import{S as Qt}from"./search-y-Cl9q0T.js";import{C as Wt}from"./chevron-down-BgKZKOjT.js";import{C as ks}from"./check-B-52Crui.js";import{P as ke}from"./plus-18SafJ2Z.js";import{C as Ps}from"./chevron-right-DHyXPqbv.js";import{P as Ds}from"./pencil-BQ197gW_.js";import{L as Pt}from"./loader-circle-D0udGttj.js";import{C as Is}from"./circle-alert-Cg7m_XSV.js";import{P as Fs}from"./pen-Cq3M-XMD.js";import"./vendor-react-BzrpNAyj.js";import"./swim-CkD6PybV.js";import"./vendor-supabase-6k692oZB.js";import"./chevron-up-Ct0_XNME.js";import"./chevron-left-DMUmdAzT.js";import"./play-CeVqPcKx.js";import"./save-Ww2aBx5r.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],Ms=tt("ellipsis",As);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],$s=tt("funnel",Os);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Dt=tt("upload",Ts);function Ze(t,s,{checkForDefaultPrevented:r=!0}={}){return function(a){if(t?.(a),r===!1||!a.defaultPrevented)return s?.(a)}}var qs=Lt[" useInsertionEffect ".trim().toString()]||Kt;function Ls({prop:t,defaultProp:s,onChange:r=()=>{},caller:i}){const[a,l,u]=Ks({defaultProp:s,onChange:r}),d=t!==void 0,h=d?t:a;{const p=o.useRef(t!==void 0);o.useEffect(()=>{const x=p.current;x!==d&&console.warn(`${i} is changing from ${x?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),p.current=d},[d,i])}const c=o.useCallback(p=>{if(d){const x=Gs(p)?p(t):p;x!==t&&u.current?.(x)}else l(p)},[d,t,l,u]);return[h,c]}function Ks({defaultProp:t,onChange:s}){const[r,i]=o.useState(t),a=o.useRef(r),l=o.useRef(s);return qs(()=>{l.current=s},[s]),o.useEffect(()=>{a.current!==r&&(l.current?.(r),a.current=r)},[r,a]),[r,i,l]}function Gs(t){return typeof t=="function"}var ot="Radio",[Vs,Ht]=rt(ot),[Us,zs]=Vs(ot),Zt=o.forwardRef((t,s)=>{const{__scopeRadio:r,name:i,checked:a=!1,required:l,disabled:u,value:d="on",onCheck:h,form:c,...p}=t,[x,b]=o.useState(null),v=ve(s,F=>b(F)),w=o.useRef(!1),D=x?c||!!x.closest("form"):!0;return e.jsxs(Us,{scope:r,checked:a,disabled:u,children:[e.jsx(U.button,{type:"button",role:"radio","aria-checked":a,"data-state":er(a),"data-disabled":u?"":void 0,disabled:u,value:d,...p,ref:v,onClick:Ze(t.onClick,F=>{a||h?.(),D&&(w.current=F.isPropagationStopped(),w.current||F.stopPropagation())})}),D&&e.jsx(Jt,{control:x,bubbles:!w.current,name:i,value:d,checked:a,required:l,disabled:u,form:c,style:{transform:"translateX(-100%)"}})]})});Zt.displayName=ot;var Xt="RadioIndicator",Yt=o.forwardRef((t,s)=>{const{__scopeRadio:r,forceMount:i,...a}=t,l=zs(Xt,r);return e.jsx(st,{present:i||l.checked,children:e.jsx(U.span,{"data-state":er(l.checked),"data-disabled":l.disabled?"":void 0,...a,ref:s})})});Yt.displayName=Xt;var Bs="RadioBubbleInput",Jt=o.forwardRef(({__scopeRadio:t,control:s,checked:r,bubbles:i=!0,...a},l)=>{const u=o.useRef(null),d=ve(u,l),h=cs(r),c=Yr(s);return o.useEffect(()=>{const p=u.current;if(!p)return;const x=window.HTMLInputElement.prototype,v=Object.getOwnPropertyDescriptor(x,"checked").set;if(h!==r&&v){const w=new Event("click",{bubbles:i});v.call(p,r),p.dispatchEvent(w)}},[h,r,i]),e.jsx(U.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...a,tabIndex:-1,ref:d,style:{...a.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Jt.displayName=Bs;function er(t){return t?"checked":"unchecked"}var Qs=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Pe="RadioGroup",[Ws]=rt(Pe,[Ut,Ht]),tr=Ut(),rr=Ht(),[Hs,Zs]=Ws(Pe),sr=o.forwardRef((t,s)=>{const{__scopeRadioGroup:r,name:i,defaultValue:a,value:l,required:u=!1,disabled:d=!1,orientation:h,dir:c,loop:p=!0,onValueChange:x,...b}=t,v=tr(r),w=is(c),[D,F]=Ls({prop:l,defaultProp:a??null,onChange:x,caller:Pe});return e.jsx(Hs,{scope:r,name:i,required:u,disabled:d,value:D,onValueChange:F,children:e.jsx(os,{asChild:!0,...v,orientation:h,dir:w,loop:p,children:e.jsx(U.div,{role:"radiogroup","aria-required":u,"aria-orientation":h,"data-disabled":d?"":void 0,dir:w,...b,ref:s})})})});sr.displayName=Pe;var nr="RadioGroupItem",ar=o.forwardRef((t,s)=>{const{__scopeRadioGroup:r,disabled:i,...a}=t,l=Zs(nr,r),u=l.disabled||i,d=tr(r),h=rr(r),c=o.useRef(null),p=ve(s,c),x=l.value===a.value,b=o.useRef(!1);return o.useEffect(()=>{const v=D=>{Qs.includes(D.key)&&(b.current=!0)},w=()=>b.current=!1;return document.addEventListener("keydown",v),document.addEventListener("keyup",w),()=>{document.removeEventListener("keydown",v),document.removeEventListener("keyup",w)}},[]),e.jsx(ls,{asChild:!0,...d,focusable:!u,active:x,children:e.jsx(Zt,{disabled:u,required:l.required,checked:x,...h,...a,name:l.name,ref:p,onCheck:()=>l.onValueChange(a.value),onKeyDown:Ze(v=>{v.key==="Enter"&&v.preventDefault()}),onFocus:Ze(a.onFocus,()=>{b.current&&c.current?.click()})})})});ar.displayName=nr;var Xs="RadioGroupIndicator",or=o.forwardRef((t,s)=>{const{__scopeRadioGroup:r,...i}=t,a=rr(r);return e.jsx(Yt,{...a,...i,ref:s})});or.displayName=Xs;var lr=sr,ir=ar,Ys=or;const cr=o.forwardRef(({className:t,...s},r)=>e.jsx(lr,{className:W("grid gap-2",t),...s,ref:r}));cr.displayName=lr.displayName;const Xe=o.forwardRef(({className:t,...s},r)=>e.jsx(ir,{ref:r,className:W("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:e.jsx(Ys,{className:"flex items-center justify-center",children:e.jsx(fs,{className:"h-3.5 w-3.5 fill-primary"})})}));Xe.displayName=ir.displayName;var It=1,Js=.9,en=.8,tn=.17,Ke=.1,Ge=.999,rn=.9999,sn=.99,nn=/[\\\/_+.#"@\[\(\{&]/,an=/[\\\/_+.#"@\[\(\{&]/g,on=/[\s-]/,dr=/[\s-]/g;function Ye(t,s,r,i,a,l,u){if(l===s.length)return a===t.length?It:sn;var d=`${a},${l}`;if(u[d]!==void 0)return u[d];for(var h=i.charAt(l),c=r.indexOf(h,a),p=0,x,b,v,w;c>=0;)x=Ye(t,s,r,i,c+1,l+1,u),x>p&&(c===a?x*=It:nn.test(t.charAt(c-1))?(x*=en,v=t.slice(a,c-1).match(an),v&&a>0&&(x*=Math.pow(Ge,v.length))):on.test(t.charAt(c-1))?(x*=Js,w=t.slice(a,c-1).match(dr),w&&a>0&&(x*=Math.pow(Ge,w.length))):(x*=tn,a>0&&(x*=Math.pow(Ge,c-a))),t.charAt(c)!==s.charAt(l)&&(x*=rn)),(x<Ke&&r.charAt(c-1)===i.charAt(l+1)||i.charAt(l+1)===i.charAt(l)&&r.charAt(c-1)!==i.charAt(l))&&(b=Ye(t,s,r,i,c+1,l+2,u),b*Ke>x&&(x=b*Ke)),x>p&&(p=x),c=r.indexOf(h,c+1);return u[d]=p,p}function Ft(t){return t.toLowerCase().replace(dr," ")}function ln(t,s,r){return t=r&&r.length>0?`${t+" "+r.join(" ")}`:t,Ye(t,s,Ft(t),Ft(s),0,0,{})}var he='[cmdk-group=""]',Ve='[cmdk-group-items=""]',cn='[cmdk-group-heading=""]',ur='[cmdk-item=""]',At=`${ur}:not([aria-disabled="true"])`,Je="cmdk-item-select",me="data-value",dn=(t,s,r)=>ln(t,s,r),mr=o.createContext(void 0),je=()=>o.useContext(mr),pr=o.createContext(void 0),lt=()=>o.useContext(pr),fr=o.createContext(void 0),xr=o.forwardRef((t,s)=>{let r=pe(()=>{var m,N;return{search:"",value:(N=(m=t.value)!=null?m:t.defaultValue)!=null?N:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),i=pe(()=>new Set),a=pe(()=>new Map),l=pe(()=>new Map),u=pe(()=>new Set),d=hr(t),{label:h,children:c,value:p,onValueChange:x,filter:b,shouldFilter:v,loop:w,disablePointerSelection:D=!1,vimBindings:F=!0,...S}=t,_=le(),ne=le(),Y=le(),B=o.useRef(null),R=bn();ie(()=>{if(p!==void 0){let m=p.trim();r.current.value=m,$.emit()}},[p]),ie(()=>{R(6,T)},[]);let $=o.useMemo(()=>({subscribe:m=>(u.current.add(m),()=>u.current.delete(m)),snapshot:()=>r.current,setState:(m,N,C)=>{var g,E,P,L;if(!Object.is(r.current[m],N)){if(r.current[m]=N,m==="search")ee(),A(),R(1,H);else if(m==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let K=document.getElementById(Y);K?K.focus():(g=document.getElementById(_))==null||g.focus()}if(R(7,()=>{var K;r.current.selectedItemId=(K=q())==null?void 0:K.id,$.emit()}),C||R(5,T),((E=d.current)==null?void 0:E.value)!==void 0){let K=N??"";(L=(P=d.current).onValueChange)==null||L.call(P,K);return}}$.emit()}},emit:()=>{u.current.forEach(m=>m())}}),[]),J=o.useMemo(()=>({value:(m,N,C)=>{var g;N!==((g=l.current.get(m))==null?void 0:g.value)&&(l.current.set(m,{value:N,keywords:C}),r.current.filtered.items.set(m,y(N,C)),R(2,()=>{A(),$.emit()}))},item:(m,N)=>(i.current.add(m),N&&(a.current.has(N)?a.current.get(N).add(m):a.current.set(N,new Set([m]))),R(3,()=>{ee(),A(),r.current.value||H(),$.emit()}),()=>{l.current.delete(m),i.current.delete(m),r.current.filtered.items.delete(m);let C=q();R(4,()=>{ee(),C?.getAttribute("id")===m&&H(),$.emit()})}),group:m=>(a.current.has(m)||a.current.set(m,new Set),()=>{l.current.delete(m),a.current.delete(m)}),filter:()=>d.current.shouldFilter,label:h||t["aria-label"],getDisablePointerSelection:()=>d.current.disablePointerSelection,listId:_,inputId:Y,labelId:ne,listInnerRef:B}),[]);function y(m,N){var C,g;let E=(g=(C=d.current)==null?void 0:C.filter)!=null?g:dn;return m?E(m,r.current.search,N):0}function A(){if(!r.current.search||d.current.shouldFilter===!1)return;let m=r.current.filtered.items,N=[];r.current.filtered.groups.forEach(g=>{let E=a.current.get(g),P=0;E.forEach(L=>{let K=m.get(L);P=Math.max(K,P)}),N.push([g,P])});let C=B.current;M().sort((g,E)=>{var P,L;let K=g.getAttribute("id"),de=E.getAttribute("id");return((P=m.get(de))!=null?P:0)-((L=m.get(K))!=null?L:0)}).forEach(g=>{let E=g.closest(Ve);E?E.appendChild(g.parentElement===E?g:g.closest(`${Ve} > *`)):C.appendChild(g.parentElement===C?g:g.closest(`${Ve} > *`))}),N.sort((g,E)=>E[1]-g[1]).forEach(g=>{var E;let P=(E=B.current)==null?void 0:E.querySelector(`${he}[${me}="${encodeURIComponent(g[0])}"]`);P?.parentElement.appendChild(P)})}function H(){let m=M().find(C=>C.getAttribute("aria-disabled")!=="true"),N=m?.getAttribute(me);$.setState("value",N||void 0)}function ee(){var m,N,C,g;if(!r.current.search||d.current.shouldFilter===!1){r.current.filtered.count=i.current.size;return}r.current.filtered.groups=new Set;let E=0;for(let P of i.current){let L=(N=(m=l.current.get(P))==null?void 0:m.value)!=null?N:"",K=(g=(C=l.current.get(P))==null?void 0:C.keywords)!=null?g:[],de=y(L,K);r.current.filtered.items.set(P,de),de>0&&E++}for(let[P,L]of a.current)for(let K of L)if(r.current.filtered.items.get(K)>0){r.current.filtered.groups.add(P);break}r.current.filtered.count=E}function T(){var m,N,C;let g=q();g&&(((m=g.parentElement)==null?void 0:m.firstChild)===g&&((C=(N=g.closest(he))==null?void 0:N.querySelector(cn))==null||C.scrollIntoView({block:"nearest"})),g.scrollIntoView({block:"nearest"}))}function q(){var m;return(m=B.current)==null?void 0:m.querySelector(`${ur}[aria-selected="true"]`)}function M(){var m;return Array.from(((m=B.current)==null?void 0:m.querySelectorAll(At))||[])}function Z(m){let N=M()[m];N&&$.setState("value",N.getAttribute(me))}function Q(m){var N;let C=q(),g=M(),E=g.findIndex(L=>L===C),P=g[E+m];(N=d.current)!=null&&N.loop&&(P=E+m<0?g[g.length-1]:E+m===g.length?g[0]:g[E+m]),P&&$.setState("value",P.getAttribute(me))}function be(m){let N=q(),C=N?.closest(he),g;for(;C&&!g;)C=m>0?jn(C,he):yn(C,he),g=C?.querySelector(At);g?$.setState("value",g.getAttribute(me)):Q(m)}let ce=()=>Z(M().length-1),Ne=m=>{m.preventDefault(),m.metaKey?ce():m.altKey?be(1):Q(1)},ae=m=>{m.preventDefault(),m.metaKey?Z(0):m.altKey?be(-1):Q(-1)};return o.createElement(U.div,{ref:s,tabIndex:-1,...S,"cmdk-root":"",onKeyDown:m=>{var N;(N=S.onKeyDown)==null||N.call(S,m);let C=m.nativeEvent.isComposing||m.keyCode===229;if(!(m.defaultPrevented||C))switch(m.key){case"n":case"j":{F&&m.ctrlKey&&Ne(m);break}case"ArrowDown":{Ne(m);break}case"p":case"k":{F&&m.ctrlKey&&ae(m);break}case"ArrowUp":{ae(m);break}case"Home":{m.preventDefault(),Z(0);break}case"End":{m.preventDefault(),ce();break}case"Enter":{m.preventDefault();let g=q();if(g){let E=new Event(Je);g.dispatchEvent(E)}}}}},o.createElement("label",{"cmdk-label":"",htmlFor:J.inputId,id:J.labelId,style:wn},h),De(t,m=>o.createElement(pr.Provider,{value:$},o.createElement(mr.Provider,{value:J},m))))}),un=o.forwardRef((t,s)=>{var r,i;let a=le(),l=o.useRef(null),u=o.useContext(fr),d=je(),h=hr(t),c=(i=(r=h.current)==null?void 0:r.forceMount)!=null?i:u?.forceMount;ie(()=>{if(!c)return d.item(a,u?.id)},[c]);let p=gr(a,l,[t.value,t.children,l],t.keywords),x=lt(),b=re(R=>R.value&&R.value===p.current),v=re(R=>c||d.filter()===!1?!0:R.search?R.filtered.items.get(a)>0:!0);o.useEffect(()=>{let R=l.current;if(!(!R||t.disabled))return R.addEventListener(Je,w),()=>R.removeEventListener(Je,w)},[v,t.onSelect,t.disabled]);function w(){var R,$;D(),($=(R=h.current).onSelect)==null||$.call(R,p.current)}function D(){x.setState("value",p.current,!0)}if(!v)return null;let{disabled:F,value:S,onSelect:_,forceMount:ne,keywords:Y,...B}=t;return o.createElement(U.div,{ref:fe(l,s),...B,id:a,"cmdk-item":"",role:"option","aria-disabled":!!F,"aria-selected":!!b,"data-disabled":!!F,"data-selected":!!b,onPointerMove:F||d.getDisablePointerSelection()?void 0:D,onClick:F?void 0:w},t.children)}),mn=o.forwardRef((t,s)=>{let{heading:r,children:i,forceMount:a,...l}=t,u=le(),d=o.useRef(null),h=o.useRef(null),c=le(),p=je(),x=re(v=>a||p.filter()===!1?!0:v.search?v.filtered.groups.has(u):!0);ie(()=>p.group(u),[]),gr(u,d,[t.value,t.heading,h]);let b=o.useMemo(()=>({id:u,forceMount:a}),[a]);return o.createElement(U.div,{ref:fe(d,s),...l,"cmdk-group":"",role:"presentation",hidden:x?void 0:!0},r&&o.createElement("div",{ref:h,"cmdk-group-heading":"","aria-hidden":!0,id:c},r),De(t,v=>o.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":r?c:void 0},o.createElement(fr.Provider,{value:b},v))))}),pn=o.forwardRef((t,s)=>{let{alwaysRender:r,...i}=t,a=o.useRef(null),l=re(u=>!u.search);return!r&&!l?null:o.createElement(U.div,{ref:fe(a,s),...i,"cmdk-separator":"",role:"separator"})}),fn=o.forwardRef((t,s)=>{let{onValueChange:r,...i}=t,a=t.value!=null,l=lt(),u=re(c=>c.search),d=re(c=>c.selectedItemId),h=je();return o.useEffect(()=>{t.value!=null&&l.setState("search",t.value)},[t.value]),o.createElement(U.input,{ref:s,...i,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":h.listId,"aria-labelledby":h.labelId,"aria-activedescendant":d,id:h.inputId,type:"text",value:a?t.value:u,onChange:c=>{a||l.setState("search",c.target.value),r?.(c.target.value)}})}),xn=o.forwardRef((t,s)=>{let{children:r,label:i="Suggestions",...a}=t,l=o.useRef(null),u=o.useRef(null),d=re(c=>c.selectedItemId),h=je();return o.useEffect(()=>{if(u.current&&l.current){let c=u.current,p=l.current,x,b=new ResizeObserver(()=>{x=requestAnimationFrame(()=>{let v=c.offsetHeight;p.style.setProperty("--cmdk-list-height",v.toFixed(1)+"px")})});return b.observe(c),()=>{cancelAnimationFrame(x),b.unobserve(c)}}},[]),o.createElement(U.div,{ref:fe(l,s),...a,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":d,"aria-label":i,id:h.listId},De(t,c=>o.createElement("div",{ref:fe(u,h.listInnerRef),"cmdk-list-sizer":""},c)))}),hn=o.forwardRef((t,s)=>{let{open:r,onOpenChange:i,overlayClassName:a,contentClassName:l,container:u,...d}=t;return o.createElement(Cs,{open:r,onOpenChange:i},o.createElement(Ss,{container:u},o.createElement(Es,{"cmdk-overlay":"",className:a}),o.createElement(Rs,{"aria-label":t.label,"cmdk-dialog":"",className:l},o.createElement(xr,{ref:s,...d}))))}),gn=o.forwardRef((t,s)=>re(r=>r.filtered.count===0)?o.createElement(U.div,{ref:s,...t,"cmdk-empty":"",role:"presentation"}):null),vn=o.forwardRef((t,s)=>{let{progress:r,children:i,label:a="Loading...",...l}=t;return o.createElement(U.div,{ref:s,...l,"cmdk-loading":"",role:"progressbar","aria-valuenow":r,"aria-valuemin":0,"aria-valuemax":100,"aria-label":a},De(t,u=>o.createElement("div",{"aria-hidden":!0},u)))}),z=Object.assign(xr,{List:xn,Item:un,Input:fn,Group:mn,Separator:pn,Dialog:hn,Empty:gn,Loading:vn});function jn(t,s){let r=t.nextElementSibling;for(;r;){if(r.matches(s))return r;r=r.nextElementSibling}}function yn(t,s){let r=t.previousElementSibling;for(;r;){if(r.matches(s))return r;r=r.previousElementSibling}}function hr(t){let s=o.useRef(t);return ie(()=>{s.current=t}),s}var ie=typeof window>"u"?o.useEffect:o.useLayoutEffect;function pe(t){let s=o.useRef();return s.current===void 0&&(s.current=t()),s}function re(t){let s=lt(),r=()=>t(s.snapshot());return o.useSyncExternalStore(s.subscribe,r,r)}function gr(t,s,r,i=[]){let a=o.useRef(),l=je();return ie(()=>{var u;let d=(()=>{var c;for(let p of r){if(typeof p=="string")return p.trim();if(typeof p=="object"&&"current"in p)return p.current?(c=p.current.textContent)==null?void 0:c.trim():a.current}})(),h=i.map(c=>c.trim());l.value(t,d,h),(u=s.current)==null||u.setAttribute(me,d),a.current=d}),a}var bn=()=>{let[t,s]=o.useState(),r=pe(()=>new Map);return ie(()=>{r.current.forEach(i=>i()),r.current=new Map},[t]),(i,a)=>{r.current.set(i,a),s({})}};function Nn(t){let s=t.type;return typeof s=="function"?s(t.props):"render"in s?s.render(t.props):t}function De({asChild:t,children:s},r){return t&&o.isValidElement(s)?o.cloneElement(Nn(s),{ref:s.ref},r(s.props.children)):r(s)}var wn={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const vr=o.forwardRef(({className:t,...s},r)=>e.jsx(z,{ref:r,className:W("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",t),...s}));vr.displayName=z.displayName;const jr=o.forwardRef(({className:t,...s},r)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(Qt,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(z.Input,{ref:r,className:W("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",t),...s})]}));jr.displayName=z.Input.displayName;const yr=o.forwardRef(({className:t,...s},r)=>e.jsx(z.List,{ref:r,className:W("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...s}));yr.displayName=z.List.displayName;const br=o.forwardRef((t,s)=>e.jsx(z.Empty,{ref:s,className:"py-6 text-center text-sm",...t}));br.displayName=z.Empty.displayName;const et=o.forwardRef(({className:t,...s},r)=>e.jsx(z.Group,{ref:r,className:W("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",t),...s}));et.displayName=z.Group.displayName;const _n=o.forwardRef(({className:t,...s},r)=>e.jsx(z.Separator,{ref:r,className:W("-mx-1 h-px bg-border",t),...s}));_n.displayName=z.Separator.displayName;const Nr=o.forwardRef(({className:t,...s},r)=>e.jsx(z.Item,{ref:r,className:W("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t),...s}));Nr.displayName=z.Item.displayName;function Cn({exercises:t,selectedId:s,onSelect:r}){const[i,a]=o.useState(!1),l=t.find(c=>c.id===s),u=t.filter(c=>c.exercise_type!=="warmup"),d=t.filter(c=>c.exercise_type==="warmup"),h=c=>{r(c),a(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",onClick:()=>a(!0),className:"flex w-full items-center gap-2 rounded-xl border border-input bg-background px-3 py-2 text-sm hover:bg-accent/50",children:[l?.illustration_gif?e.jsx("img",{src:l.illustration_gif,alt:"",className:"h-7 w-7 shrink-0 rounded-md object-cover"}):e.jsx("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-md bg-muted",children:e.jsx(nt,{className:"h-3.5 w-3.5 text-muted-foreground"})}),e.jsx("span",{className:"min-w-0 flex-1 truncate text-left font-medium",children:l?.nom_exercice??"Choisir un exercice"}),e.jsx(Wt,{className:"h-4 w-4 shrink-0 text-muted-foreground"})]}),e.jsx(bs,{open:i,onOpenChange:a,children:e.jsxs(Ns,{className:"max-h-[85vh]",children:[e.jsx(ws,{className:"pb-0",children:e.jsx(_s,{children:"Choisir un exercice"})}),e.jsxs(vr,{className:"mt-2",shouldFilter:!0,children:[e.jsx(jr,{placeholder:"Rechercher...",className:"h-12"}),e.jsxs(yr,{className:"max-h-[60vh] px-1 pb-safe",children:[e.jsx(br,{children:"Aucun exercice trouvé"}),u.length>0&&e.jsx(et,{heading:"Travail",children:u.map(c=>e.jsx(Mt,{exercise:c,isSelected:c.id===s,onSelect:()=>h(c.id)},c.id))}),d.length>0&&e.jsx(et,{heading:"Échauffement",children:d.map(c=>e.jsx(Mt,{exercise:c,isSelected:c.id===s,onSelect:()=>h(c.id)},c.id))})]})]})]})})]})}function Mt({exercise:t,isSelected:s,onSelect:r}){return e.jsxs(Nr,{value:t.nom_exercice,onSelect:r,className:"flex items-center gap-3 rounded-xl px-2 py-2.5",children:[t.illustration_gif?e.jsx("img",{src:t.illustration_gif,alt:"",className:"h-9 w-9 shrink-0 rounded-lg object-cover",loading:"lazy",decoding:"async"}):e.jsx("div",{className:"flex h-9 w-9 shrink-0 items-center justify-center rounded-lg bg-muted",children:e.jsx(nt,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx("span",{className:"min-w-0 flex-1 truncate text-sm font-medium",children:t.nom_exercice}),s&&e.jsx(ks,{className:"h-4 w-4 shrink-0 text-primary"})]})}function Sn({exercise:t,exercises:s,exerciseFilter:r,index:i,totalItems:a,onChange:l,onDelete:u,onMoveUp:d,onMoveDown:h}){const[c,p]=o.useState(!1),[x,b]=o.useState(!1),v=s.filter(_=>r==="all"?!0:_.exercise_type===r),w=s.find(_=>_.id===t.exercise_id),D=w?.nom_exercice??"Exercice",F=w?.exercise_type==="warmup",S=w?.illustration_gif;return e.jsxs(e.Fragment,{children:[e.jsxs(Jr,{className:W("rounded-2xl border-border transition-all",c&&"ring-1 ring-primary/20"),children:[e.jsxs("button",{type:"button",className:"flex w-full items-center gap-3 p-3 text-left",onClick:()=>p(!c),children:[e.jsx("span",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-muted text-xs font-bold text-muted-foreground",children:i+1}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"truncate text-sm font-semibold",children:D}),F&&e.jsx("span",{className:"shrink-0 rounded-full bg-amber-100 px-2 py-0.5 text-[10px] font-semibold text-amber-800",children:"Échauf."})]}),e.jsxs("div",{className:"mt-0.5 text-xs text-muted-foreground",children:[t.sets,"×",t.reps,t.percent_1rm?` @ ${t.percent_1rm}% 1RM`:"",t.rest_seconds?` · ${t.rest_seconds}s repos`:""]})]}),S&&e.jsx("button",{type:"button",className:"shrink-0 rounded-lg overflow-hidden border border-border bg-muted",onClick:_=>{_.stopPropagation(),b(!0)},children:e.jsx("img",{src:S,alt:D,className:"h-9 w-9 object-cover"})}),e.jsx(Wt,{className:W("h-4 w-4 shrink-0 text-muted-foreground transition-transform",c&&"rotate-180")})]}),c&&e.jsxs("div",{className:"border-t border-border px-3 pb-3 pt-3 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(I,{className:"text-xs",children:"Séries"}),e.jsx(G,{type:"number",inputMode:"numeric",value:t.sets===0?"":t.sets,onChange:_=>l("sets",_.target.value===""?0:Number(_.target.value)),className:"rounded-xl h-10"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(I,{className:"text-xs",children:"Reps"}),e.jsx(G,{type:"number",inputMode:"numeric",value:t.reps===0?"":t.reps,onChange:_=>l("reps",_.target.value===""?0:Number(_.target.value)),className:"rounded-xl h-10"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(I,{className:"text-xs",children:"% 1RM"}),e.jsx(G,{type:"number",inputMode:"numeric",value:t.percent_1rm===0?"":t.percent_1rm,onChange:_=>l("percent_1rm",_.target.value===""?0:Number(_.target.value)),className:"rounded-xl h-10"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(I,{className:"text-xs",children:"Repos (s)"}),e.jsx(G,{type:"number",inputMode:"numeric",value:t.rest_seconds===0?"":t.rest_seconds,onChange:_=>l("rest_seconds",_.target.value===""?0:Number(_.target.value)),className:"rounded-xl h-10"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(I,{className:"text-xs",children:"Exercice"}),e.jsx(Cn,{exercises:v,selectedId:t.exercise_id,onSelect:_=>l("exercise_id",_)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(I,{className:"text-xs",children:"Notes"}),e.jsx(Se,{value:t.notes??"",onChange:_=>l("notes",_.target.value||null),placeholder:"Notes optionnelles...",className:"rounded-xl min-h-[60px]"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:_=>{_.stopPropagation(),d()},disabled:i===0,className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-30","aria-label":"Monter",children:e.jsx(xs,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:_=>{_.stopPropagation(),h()},disabled:i===a-1,className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-30","aria-label":"Descendre",children:e.jsx(hs,{className:"h-4 w-4"})})]}),e.jsxs("button",{type:"button",onClick:_=>{_.stopPropagation(),u()},className:"inline-flex h-9 items-center gap-2 rounded-full px-3 text-xs font-medium text-destructive hover:bg-destructive/10",children:[e.jsx(at,{className:"h-3.5 w-3.5"}),"Supprimer"]})]})]})]}),S&&e.jsx(Ee,{open:x,onOpenChange:b,children:e.jsx(Re,{className:"sm:max-w-md p-2",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("img",{src:S,alt:D,className:"w-full max-h-[70vh] object-contain rounded-lg"}),e.jsx("p",{className:"text-sm font-medium text-center",children:D})]})})})]})}const En=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance";function Rn({session:t,exercises:s,editingSessionId:r,folders:i,onSessionChange:a,onCycleChange:l,onSave:u,onCancel:d,onAddItem:h,onUpdateItem:c,onRemoveItem:p,onReorderItems:x,onExerciseDialogOpen:b,isSaving:v}){const[w,D]=o.useState("all"),[F,S]=o.useState(!1),[_,ne]=o.useState(!1),Y=new Map(s.map(y=>[y.id,y])),B=t.items.reduce((y,A)=>y+(A.sets||0),0),R=y=>{y>0&&x(y,y-1)},$=y=>{y<t.items.length-1&&x(y,y+1)},J=()=>{S(!0)};return e.jsxs("div",{className:"space-y-4 animate-in slide-in-from-bottom-4",children:[e.jsx(gs,{isEditing:!!r,isSaving:v,onSave:u,onCancel:d,onPreview:J}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(vs,{name:t.title,onNameChange:y=>a({...t,title:y}),showDuration:!1,showTotalDistance:!1,collapsible:!0,collapsed:_,onToggleCollapse:()=>ne(!_),collapsedSummary:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"font-medium text-foreground",children:t.title||"Sans titre"}),e.jsx("span",{children:"·"}),e.jsx("span",{className:"capitalize",children:t.cycle}),e.jsx("span",{children:"·"}),e.jsxs("span",{children:[B," séries"]})]}),additionalFields:e.jsxs(e.Fragment,{children:[i&&i.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Dossier"}),e.jsx("div",{className:"mt-1",children:e.jsxs($e,{value:t.folder_id?.toString()??"none",onValueChange:y=>a({...t,folder_id:y==="none"?null:parseInt(y)}),children:[e.jsx(Te,{className:"rounded-2xl",children:e.jsx(qe,{})}),e.jsxs(Le,{children:[e.jsx(te,{value:"none",children:"Aucun"}),i.map(y=>e.jsx(te,{value:y.id.toString(),children:y.name},y.id))]})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Cycle"}),e.jsx("div",{className:"mt-1",children:e.jsxs($e,{value:t.cycle,onValueChange:y=>l(En(y)),children:[e.jsx(Te,{className:"rounded-2xl",children:e.jsx(qe,{})}),e.jsxs(Le,{children:[e.jsx(te,{value:"endurance",children:"Endurance"}),e.jsx(te,{value:"hypertrophie",children:"Hypertrophie"}),e.jsx(te,{value:"force",children:"Force"})]})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Séries totales"}),e.jsx("div",{className:"mt-1 rounded-2xl border border-border bg-muted px-3 py-2 text-sm font-semibold",children:B})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Description"}),e.jsx("div",{className:"mt-1",children:e.jsx(Se,{value:t.description,onChange:y=>a({...t,description:y.target.value}),placeholder:"Description optionnelle...",className:"rounded-2xl min-h-[60px]"})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm font-semibold",children:["Exercices (",t.items.length,")"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs($e,{value:w,onValueChange:y=>D(y),children:[e.jsxs(Te,{className:"h-8 w-auto gap-1 rounded-full border-dashed text-xs",children:[e.jsx($s,{className:"h-3 w-3"}),e.jsx(qe,{})]}),e.jsxs(Le,{children:[e.jsx(te,{value:"all",children:"Tous"}),e.jsx(te,{value:"strength",children:"Travail"}),e.jsx(te,{value:"warmup",children:"Échauf."})]})]})})]}),e.jsx("div",{className:"space-y-2",children:t.items.map((y,A)=>e.jsx(Sn,{exercise:y,exercises:s,exerciseFilter:w,index:A,totalItems:t.items.length,onChange:(H,ee)=>c(A,H,ee),onDelete:()=>p(A),onMoveUp:()=>R(A),onMoveDown:()=>$(A)},`${y.exercise_id}-${A}`))}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:h,className:"inline-flex items-center gap-2 rounded-full bg-primary px-4 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(ke,{className:"h-4 w-4"})," Ajouter un exercice"]}),e.jsxs("button",{type:"button",onClick:b,className:"inline-flex items-center gap-2 rounded-full border border-border px-4 py-2 text-xs font-semibold hover:bg-muted",children:[e.jsx(ke,{className:"h-4 w-4"})," Nouvel exercice"]})]})]}),e.jsx(Ee,{open:F,onOpenChange:S,children:e.jsxs(Re,{className:"sm:max-w-3xl",children:[e.jsx(Be,{children:e.jsx(Qe,{children:"Aperçu de la séance"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-lg font-semibold",children:t.title||"Sans titre"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description||"—"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cycle : ",t.cycle]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Exercices"}),e.jsx("div",{className:"space-y-2",children:t.items.slice().sort((y,A)=>(y.order_index??0)-(A.order_index??0)).map((y,A)=>{const H=Y.get(y.exercise_id);return e.jsxs("div",{className:"rounded-xl border px-3 py-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("span",{className:"font-medium",children:[A+1,". ",H?.nom_exercice??"Exercice"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:H?.exercise_type==="warmup"?"Échauffement":"Travail"})]}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[y.sets," séries • ",y.reps," reps • ",y.percent_1rm,"% 1RM •"," ",y.rest_seconds,"s"]})]},`${y.exercise_id}-${A}`)})})]})]})]})})]})}function ge(t,s,{checkForDefaultPrevented:r=!0}={}){return function(a){if(t?.(a),r===!1||!a.defaultPrevented)return s?.(a)}}function kn(t){const s=Pn(t),r=o.forwardRef((i,a)=>{const{children:l,...u}=i,d=o.Children.toArray(l),h=d.find(In);if(h){const c=h.props.children,p=d.map(x=>x===h?o.Children.count(c)>1?o.Children.only(null):o.isValidElement(c)?c.props.children:null:x);return e.jsx(s,{...u,ref:a,children:o.isValidElement(c)?o.cloneElement(c,void 0,p):null})}return e.jsx(s,{...u,ref:a,children:l})});return r.displayName=`${t}.Slot`,r}function Pn(t){const s=o.forwardRef((r,i)=>{const{children:a,...l}=r;if(o.isValidElement(a)){const u=An(a),d=Fn(l,a.props);return a.type!==o.Fragment&&(d.ref=i?fe(i,u):u),o.cloneElement(a,d)}return o.Children.count(a)>1?o.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var Dn=Symbol("radix.slottable");function In(t){return o.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Dn}function Fn(t,s){const r={...s};for(const i in s){const a=t[i],l=s[i];/^on[A-Z]/.test(i)?a&&l?r[i]=(...d)=>{const h=l(...d);return a(...d),h}:a&&(r[i]=a):i==="style"?r[i]={...a,...l}:i==="className"&&(r[i]=[a,l].filter(Boolean).join(" "))}return{...t,...r}}function An(t){let s=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=s&&"isReactWarning"in s&&s.isReactWarning;return r?t.ref:(s=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=s&&"isReactWarning"in s&&s.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var Mn=Lt[" useInsertionEffect ".trim().toString()]||Kt;function On({prop:t,defaultProp:s,onChange:r=()=>{},caller:i}){const[a,l,u]=$n({defaultProp:s,onChange:r}),d=t!==void 0,h=d?t:a;{const p=o.useRef(t!==void 0);o.useEffect(()=>{const x=p.current;x!==d&&console.warn(`${i} is changing from ${x?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),p.current=d},[d,i])}const c=o.useCallback(p=>{if(d){const x=Tn(p)?p(t):p;x!==t&&u.current?.(x)}else l(p)},[d,t,l,u]);return[h,c]}function $n({defaultProp:t,onChange:s}){const[r,i]=o.useState(t),a=o.useRef(r),l=o.useRef(s);return Mn(()=>{l.current=s},[s]),o.useEffect(()=>{a.current!==r&&(l.current?.(r),a.current=r)},[r,a]),[r,i,l]}function Tn(t){return typeof t=="function"}var Ie="Popover",[wr]=rt(Ie,[Gt]),ye=Gt(),[qn,se]=wr(Ie),_r=t=>{const{__scopePopover:s,children:r,open:i,defaultOpen:a,onOpenChange:l,modal:u=!1}=t,d=ye(s),h=o.useRef(null),[c,p]=o.useState(!1),[x,b]=On({prop:i,defaultProp:a??!1,onChange:l,caller:Ie});return e.jsx(es,{...d,children:e.jsx(qn,{scope:s,contentId:le(),triggerRef:h,open:x,onOpenChange:b,onOpenToggle:o.useCallback(()=>b(v=>!v),[b]),hasCustomAnchor:c,onCustomAnchorAdd:o.useCallback(()=>p(!0),[]),onCustomAnchorRemove:o.useCallback(()=>p(!1),[]),modal:u,children:r})})};_r.displayName=Ie;var Cr="PopoverAnchor",Ln=o.forwardRef((t,s)=>{const{__scopePopover:r,...i}=t,a=se(Cr,r),l=ye(r),{onCustomAnchorAdd:u,onCustomAnchorRemove:d}=a;return o.useEffect(()=>(u(),()=>d()),[u,d]),e.jsx(Vt,{...l,...i,ref:s})});Ln.displayName=Cr;var Sr="PopoverTrigger",Er=o.forwardRef((t,s)=>{const{__scopePopover:r,...i}=t,a=se(Sr,r),l=ye(r),u=ve(s,a.triggerRef),d=e.jsx(U.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":Ir(a.open),...i,ref:u,onClick:ge(t.onClick,a.onOpenToggle)});return a.hasCustomAnchor?d:e.jsx(Vt,{asChild:!0,...l,children:d})});Er.displayName=Sr;var it="PopoverPortal",[Kn,Gn]=wr(it,{forceMount:void 0}),Rr=t=>{const{__scopePopover:s,forceMount:r,children:i,container:a}=t,l=se(it,s);return e.jsx(Kn,{scope:s,forceMount:r,children:e.jsx(st,{present:r||l.open,children:e.jsx(ts,{asChild:!0,container:a,children:i})})})};Rr.displayName=it;var xe="PopoverContent",kr=o.forwardRef((t,s)=>{const r=Gn(xe,t.__scopePopover),{forceMount:i=r.forceMount,...a}=t,l=se(xe,t.__scopePopover);return e.jsx(st,{present:i||l.open,children:l.modal?e.jsx(Un,{...a,ref:s}):e.jsx(zn,{...a,ref:s})})});kr.displayName=xe;var Vn=kn("PopoverContent.RemoveScroll"),Un=o.forwardRef((t,s)=>{const r=se(xe,t.__scopePopover),i=o.useRef(null),a=ve(s,i),l=o.useRef(!1);return o.useEffect(()=>{const u=i.current;if(u)return ds(u)},[]),e.jsx(us,{as:Vn,allowPinchZoom:!0,children:e.jsx(Pr,{...t,ref:a,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ge(t.onCloseAutoFocus,u=>{u.preventDefault(),l.current||r.triggerRef.current?.focus()}),onPointerDownOutside:ge(t.onPointerDownOutside,u=>{const d=u.detail.originalEvent,h=d.button===0&&d.ctrlKey===!0,c=d.button===2||h;l.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:ge(t.onFocusOutside,u=>u.preventDefault(),{checkForDefaultPrevented:!1})})})}),zn=o.forwardRef((t,s)=>{const r=se(xe,t.__scopePopover),i=o.useRef(!1),a=o.useRef(!1);return e.jsx(Pr,{...t,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:l=>{t.onCloseAutoFocus?.(l),l.defaultPrevented||(i.current||r.triggerRef.current?.focus(),l.preventDefault()),i.current=!1,a.current=!1},onInteractOutside:l=>{t.onInteractOutside?.(l),l.defaultPrevented||(i.current=!0,l.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const u=l.target;r.triggerRef.current?.contains(u)&&l.preventDefault(),l.detail.originalEvent.type==="focusin"&&a.current&&l.preventDefault()}})}),Pr=o.forwardRef((t,s)=>{const{__scopePopover:r,trapFocus:i,onOpenAutoFocus:a,onCloseAutoFocus:l,disableOutsidePointerEvents:u,onEscapeKeyDown:d,onPointerDownOutside:h,onFocusOutside:c,onInteractOutside:p,...x}=t,b=se(xe,r),v=ye(r);return ms(),e.jsx(ps,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:a,onUnmountAutoFocus:l,children:e.jsx(rs,{asChild:!0,disableOutsidePointerEvents:u,onInteractOutside:p,onEscapeKeyDown:d,onPointerDownOutside:h,onFocusOutside:c,onDismiss:()=>b.onOpenChange(!1),children:e.jsx(ss,{"data-state":Ir(b.open),role:"dialog",id:b.contentId,...v,...x,ref:s,style:{...x.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Dr="PopoverClose",Bn=o.forwardRef((t,s)=>{const{__scopePopover:r,...i}=t,a=se(Dr,r);return e.jsx(U.button,{type:"button",...i,ref:s,onClick:ge(t.onClick,()=>a.onOpenChange(!1))})});Bn.displayName=Dr;var Qn="PopoverArrow",Wn=o.forwardRef((t,s)=>{const{__scopePopover:r,...i}=t,a=ye(r);return e.jsx(ns,{...a,...i,ref:s})});Wn.displayName=Qn;function Ir(t){return t?"open":"closed"}var Hn=_r,Zn=Er,Xn=Rr,Fr=kr;const Ar=Hn,Mr=Zn,ct=o.forwardRef(({className:t,align:s="center",sideOffset:r=4,...i},a)=>e.jsx(Xn,{children:e.jsx(Fr,{ref:a,align:s,sideOffset:r,className:W("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",t),...i})}));ct.displayName=Fr.displayName;function Ot({name:t,count:s,children:r,onRename:i,onDelete:a,defaultOpen:l=!1}){const[u,d]=o.useState(l),[h,c]=o.useState(!1),[p,x]=o.useState(t),[b,v]=o.useState(!1),w=o.useRef(null);o.useEffect(()=>{h&&(w.current?.focus(),w.current?.select())},[h]);const D=()=>{const S=p.trim();S&&S!==t?i(S):x(t),c(!1)},F=()=>{x(t),c(!1)};return e.jsxs("div",{children:[e.jsxs("div",{className:W("flex items-center gap-1 rounded-xl px-2 py-1.5 cursor-pointer select-none hover:bg-muted/50"),onClick:()=>{h||d(S=>!S)},children:[e.jsx(Ps,{className:W("h-4 w-4 shrink-0 text-muted-foreground transition-transform",u&&"rotate-90")}),h?e.jsx(G,{ref:w,className:"h-7 text-sm rounded-lg flex-1",value:p,onChange:S=>x(S.target.value),onClick:S=>S.stopPropagation(),onKeyDown:S=>{S.stopPropagation(),S.key==="Enter"&&D(),S.key==="Escape"&&F()},onBlur:D}):e.jsx("span",{className:"text-sm font-semibold truncate",children:t}),!h&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",s,")"]}),e.jsx("div",{className:"flex-1"}),e.jsxs(Ar,{open:b,onOpenChange:v,children:[e.jsx(Mr,{asChild:!0,children:e.jsx("button",{className:"h-7 w-7 shrink-0 inline-flex items-center justify-center rounded-full hover:bg-muted",onClick:S=>{S.stopPropagation()},children:e.jsx(Ms,{className:"h-4 w-4 text-muted-foreground"})})}),e.jsxs(ct,{align:"end",className:"w-40 p-1",onClick:S=>S.stopPropagation(),children:[e.jsxs("button",{className:"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-muted",onClick:()=>{v(!1),x(t),c(!0)},children:[e.jsx(Ds,{className:"h-4 w-4"}),"Rename"]}),e.jsxs("button",{className:"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm text-destructive hover:bg-muted",onClick:()=>{v(!1),a()},children:[e.jsx(at,{className:"h-4 w-4"}),"Delete"]})]})]})]}),u&&e.jsx("div",{className:"ml-4",children:r})]})}function Ue({folders:t,currentFolderId:s,onMove:r,children:i}){const[a,l]=o.useState(!1);function u(d){r(d),l(!1)}return e.jsxs(Ar,{open:a,onOpenChange:l,children:[e.jsx(Mr,{asChild:!0,children:i??e.jsx("button",{className:"flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Déplacer",title:"Déplacer vers un dossier",children:e.jsx(js,{className:"h-4 w-4"})})}),e.jsxs(ct,{className:"w-44 p-1",align:"end",children:[e.jsx("button",{className:"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-muted",style:{fontWeight:s?void 0:"bold"},onClick:()=>u(null),children:"Aucun dossier"}),t.map(d=>e.jsx("button",{className:"flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-sm hover:bg-muted",style:{fontWeight:s===d.id?"bold":void 0},onClick:()=>u(d.id),children:d.name},d.id))]})]})}const $t=[{key:"endurance",label:"Endurance",fieldSuffix:"endurance"},{key:"hypertrophie",label:"Hypertrophie",fieldSuffix:"hypertrophie"},{key:"force",label:"Force",fieldSuffix:"force"}],Yn=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance",Tt=({exercise:t,onChange:s,disabled:r=!1})=>e.jsxs(zt,{defaultValue:"endurance",className:"w-full",children:[e.jsx(Bt,{className:"grid w-full grid-cols-3",children:$t.map(i=>e.jsx(We,{value:i.key,children:i.label},i.key))}),$t.map(i=>{const a=`pct_1rm_${i.fieldSuffix}`,l=`Nb_series_${i.fieldSuffix}`,u=`Nb_reps_${i.fieldSuffix}`,d=`recup_${i.fieldSuffix}`,h=`recup_exercices_${i.fieldSuffix}`;return e.jsxs(He,{value:i.key,className:`space-y-3 rounded-lg border p-3 ${r?"opacity-60":""}`,children:[e.jsx("p",{className:"text-sm font-semibold",children:i.label}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"% 1RM"}),e.jsx(G,{type:"number",value:t[a]??"",disabled:r,onChange:c=>s({[a]:c.target.value===""?null:Number(c.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Nb séries"}),e.jsx(G,{type:"number",value:t[l]??"",disabled:r,onChange:c=>s({[l]:c.target.value===""?null:Number(c.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Nb reps"}),e.jsx(G,{type:"number",value:t[u]??"",disabled:r,onChange:c=>s({[u]:c.target.value===""?null:Number(c.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Récup. séries (s)"}),e.jsx(G,{type:"number",value:t[d]??"",disabled:r,onChange:c=>s({[d]:c.target.value===""?null:Number(c.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Récup. exercices (s)"}),e.jsx(G,{type:"number",value:t[h]??"",disabled:r,onChange:c=>s({[h]:c.target.value===""?null:Number(c.target.value)})})]})]})]},i.key)})]}),Jn={pct_1rm_endurance:60,pct_1rm_hypertrophie:75,pct_1rm_force:85,Nb_series_endurance:4,Nb_series_hypertrophie:3,Nb_series_force:3,Nb_reps_endurance:16,Nb_reps_hypertrophie:8,Nb_reps_force:3,recup_endurance:120,recup_hypertrophie:200,recup_force:300,recup_exercices_endurance:300,recup_exercices_hypertrophie:400,recup_exercices_force:500},Ce=t=>{const s=Number(t);return Number.isFinite(s)?s:0},ze=(t,s,r,i)=>{const a=s==="force"?"force":s==="hypertrophie"?"hypertrophie":"endurance",l=`Nb_series_${a}`,u=`Nb_reps_${a}`,d=`pct_1rm_${a}`,h=`recup_${a}`;return{exercise_id:t.id,order_index:r,sets:Ce(t[l]),reps:Ce(t[u]),rest_seconds:Ce(t[h]),percent_1rm:Ce(t[d]),cycle_type:s,notes:i?.notes??""}},ea=()=>({nom_exercice:"",description:null,illustration_gif:null,exercise_type:"strength",warmup_reps:null,warmup_duration:null,...Jn}),qt=({exercise:t,warmupMode:s,onChange:r,onWarmupModeChange:i,idPrefix:a})=>e.jsxs("div",{className:"space-y-3 rounded-lg border p-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Paramètres d'échauffement"}),e.jsxs(cr,{value:s,onValueChange:l=>{i(l==="duration"?"duration":"reps"),r(l==="duration"?{warmup_reps:null,warmup_duration:t.warmup_duration??0}:{warmup_duration:null,warmup_reps:t.warmup_reps??0})},className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Xe,{value:"reps",id:`${a}-warmup-reps`}),e.jsx(I,{htmlFor:`${a}-warmup-reps`,children:"Nombre de répétitions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Xe,{value:"duration",id:`${a}-warmup-duration`}),e.jsx(I,{htmlFor:`${a}-warmup-duration`,children:"Durée (secondes)"})]})]}),s==="duration"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Durée (s)"}),e.jsx(G,{type:"number",value:t.warmup_duration??"",onChange:l=>r({warmup_duration:l.target.value===""?null:Number(l.target.value)})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Nombre de répétitions"}),e.jsx(G,{type:"number",value:t.warmup_reps??"",onChange:l=>r({warmup_reps:l.target.value===""?null:Number(l.target.value)})})]})]});function Ia(){const{toast:t}=as(),s=Xr(),[r,i]=o.useState(!1),[a,l]=o.useState(null),[u,d]=o.useState(!1),[h,c]=o.useState(!1),[p,x]=o.useState(null),[b,v]=o.useState(null),[w,D]=o.useState(null),[F,S]=o.useState("reps"),[_,ne]=o.useState("reps"),[Y,B]=o.useState(!1),[R,$]=o.useState(""),[J,y]=o.useState("sessions"),[A,H]=o.useState(null),ee=async(n,f)=>{if(n.size>10485760){t({title:"Fichier trop volumineux",description:"La taille maximale est de 10 Mo.",variant:"destructive"});return}B(!0);try{const k=n.name.split(".").pop()??"gif",O=`exercises/${Date.now()}-${Math.random().toString(36).slice(2)}.${k}`,{error:ue}=await jt.storage.from("exercise-gifs").upload(O,n,{upsert:!1});if(ue)throw ue;const{data:Zr}=jt.storage.from("exercise-gifs").getPublicUrl(O);f(Zr.publicUrl),t({title:"Image uploadée"})}catch(k){const O=k instanceof Error?k.message:"Réessayez.";t({title:"Erreur d'upload",description:O,variant:"destructive"})}finally{B(!1)}},[T,q]=o.useState({title:"",description:"",cycle:"endurance",items:[],folder_id:null}),[M,Z]=o.useState({...ea()});o.useEffect(()=>{p&&ne(p.warmup_duration!=null?"duration":"reps")},[p]);const{data:Q,isLoading:be,error:ce,refetch:Ne}=_e({queryKey:["exercises"],queryFn:()=>V.getExercises()}),{data:ae,isLoading:m,error:N,refetch:C}=_e({queryKey:["strength_catalog"],queryFn:()=>V.getStrengthSessions()}),{data:g}=_e({queryKey:["strength_folders","session"],queryFn:()=>V.getStrengthFolders("session")}),{data:E}=_e({queryKey:["strength_folders","exercise"],queryFn:()=>V.getStrengthFolders("exercise")}),P=n=>{const f=n.items?.reduce((j,k)=>j+(k.sets||0),0)??0;return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"capitalize",children:n.cycle}),e.jsx("span",{children:"·"}),e.jsxs("span",{children:[n.items?.length??0," exos"]}),e.jsx("span",{children:"·"}),e.jsxs("span",{children:[f," séries"]})]})},L=o.useMemo(()=>{if(!ae)return[];if(!R.trim())return ae;const n=R.toLowerCase();return ae.filter(f=>f.title?.toLowerCase().includes(n))},[ae,R]),K=L.filter(n=>!n.folder_id),de=o.useMemo(()=>{const n=new Map;for(const f of L)if(f.folder_id){const j=n.get(f.folder_id)??[];j.push(f),n.set(f.folder_id,j)}return n},[L]),Or=o.useMemo(()=>(Q??[]).filter(n=>!n.folder_id),[Q]),$r=o.useMemo(()=>{const n=new Map;for(const f of Q??[])if(f.folder_id){const j=n.get(f.folder_id)??[];j.push(f),n.set(f.folder_id,j)}return n},[Q]),Tr=X({mutationFn:n=>V.createExercise(n),onSuccess:()=>{s.invalidateQueries({queryKey:["exercises"]}),d(!1),t({title:"Exercice ajouté"})}}),dt=X({mutationFn:n=>V.createStrengthSession(n),onSuccess:()=>{s.invalidateQueries({queryKey:["strength_catalog"]}),i(!1),q({title:"",description:"",cycle:"endurance",items:[],folder_id:null}),t({title:"Séance créée avec succès"})}}),qr=X({mutationFn:n=>V.updateExercise(n),onSuccess:()=>{s.invalidateQueries({queryKey:["exercises"]}),s.invalidateQueries({queryKey:["strength_catalog"]}),c(!1),x(null),t({title:"Exercice mis à jour"})}}),Lr=X({mutationFn:n=>V.deleteExercise(n),onSuccess:()=>{s.invalidateQueries({queryKey:["exercises"]}),s.invalidateQueries({queryKey:["strength_catalog"]}),D(null),t({title:"Exercice supprimé"})}}),Fe=X({mutationFn:n=>V.deleteStrengthSession(n),onSuccess:()=>{s.invalidateQueries({queryKey:["strength_catalog"]}),v(null),t({title:"Séance supprimée"})}}),ut=X({mutationFn:n=>V.updateStrengthSession(n),onSuccess:()=>{s.invalidateQueries({queryKey:["strength_catalog"]}),i(!1),l(null),q({title:"",description:"",cycle:"endurance",items:[],folder_id:null}),t({title:"Séance mise à jour"})}}),Kr=X({mutationFn:n=>V.persistStrengthSessionOrder(n)}),Gr=X({mutationFn:({name:n,type:f})=>V.createStrengthFolder(n,f),onSuccess:()=>{s.invalidateQueries({queryKey:["strength_folders"]}),t({title:"Dossier créé"})}}),mt=X({mutationFn:({id:n,name:f})=>V.renameStrengthFolder(n,f),onSuccess:()=>{s.invalidateQueries({queryKey:["strength_folders"]}),t({title:"Dossier renommé"})}}),pt=X({mutationFn:n=>V.deleteStrengthFolder(n),onSuccess:()=>{s.invalidateQueries({queryKey:["strength_folders"]}),s.invalidateQueries({queryKey:["strength_catalog"]}),s.invalidateQueries({queryKey:["exercises"]}),t({title:"Dossier supprimé"})}}),Ae=X({mutationFn:({itemId:n,folderId:f,table:j})=>V.moveToFolder(n,f,j),onSuccess:()=>{s.invalidateQueries({queryKey:["strength_catalog"]}),s.invalidateQueries({queryKey:["exercises"]}),t({title:"Déplacé"})}}),Vr=()=>{i(!1),l(null),q({title:"",description:"",cycle:"endurance",items:[],folder_id:null})},we=n=>{l(n.id),q({title:n.title??"",description:n.description??"",cycle:Yn(n.cycle),items:n.items?.map(f=>({exercise_id:f.exercise_id,order_index:f.order_index??0,sets:f.sets,reps:f.reps,rest_seconds:f.rest_seconds,percent_1rm:f.percent_1rm,cycle_type:f.cycle_type,notes:f.notes??""}))??[],folder_id:n.folder_id??null}),i(!0)},Ur=n=>{x(n),c(!0)},zr=()=>{const n={...T,items:Me(T.items)};a?ut.mutate({...n,id:a}):dt.mutate(n)},Me=n=>n.map((f,j)=>({...f,order_index:j})),Br=()=>{const n=Q?.[0];q(f=>({...f,items:[...f.items,n?ze(n,f.cycle,f.items.length):{exercise_id:1,order_index:f.items.length,sets:0,reps:0,rest_seconds:0,percent_1rm:0}]}))},Qr=(n,f,j)=>{const k=[...T.items];if(f==="exercise_id"){const O=Q?.find(ue=>ue.id===j);O?k[n]=ze(O,T.cycle,k[n].order_index??n,k[n]):k[n]={...k[n],exercise_id:Number(j)}}else k[n]={...k[n],[f]:j};q({...T,items:k})},Wr=n=>{const f=Me(T.items.filter((j,k)=>k!==n));q({...T,items:f})},Hr=(n,f)=>{if(n===f)return;const j=[...T.items],[k]=j.splice(n,1);j.splice(f,0,k);const O=Me(j);q({...T,items:O}),a&&Kr.mutate({id:a,title:T.title,description:T.description,cycle:T.cycle,items:O})},ft=e.jsx(Ee,{open:h,onOpenChange:c,children:e.jsxs(Re,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(Be,{children:e.jsx(Qe,{children:"Modifier l'exercice"})}),p&&e.jsxs("div",{className:"space-y-4",children:[p.exercise_type==="warmup"?e.jsx(qt,{exercise:p,warmupMode:_,onChange:n=>x(f=>f&&{...f,...n}),onWarmupModeChange:ne,idPrefix:"edit"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Nom"}),e.jsx(G,{value:p.nom_exercice,onChange:n=>x({...p,nom_exercice:n.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Description"}),e.jsx(Se,{value:p.description??"",onChange:n=>x({...p,description:n.target.value===""?null:n.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Illustration (GIF)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{value:p.illustration_gif??"",onChange:n=>x({...p,illustration_gif:n.target.value===""?null:n.target.value}),placeholder:"https://...",className:"flex-1"}),e.jsx(oe,{type:"button",variant:"outline",size:"icon",disabled:Y,onClick:()=>{const n=document.createElement("input");n.type="file",n.accept="image/*,.gif",n.onchange=f=>{const j=f.target.files?.[0];j&&ee(j,k=>x(O=>O&&{...O,illustration_gif:k}))},n.click()},"aria-label":"Uploader une image",children:Y?e.jsx(Pt,{className:"h-4 w-4 animate-spin"}):e.jsx(Dt,{className:"h-4 w-4"})})]}),p.illustration_gif&&e.jsx("img",{src:p.illustration_gif,alt:"Aperçu",className:"mt-2 h-20 w-20 rounded-lg object-cover border"})]}),p.exercise_type!=="warmup"?e.jsx(Tt,{exercise:p,onChange:n=>x(f=>f&&{...f,...n})}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yt,{id:"warmup-flag-edit",checked:p.exercise_type==="warmup",onCheckedChange:n=>x({...p,exercise_type:n===!0?"warmup":"strength"})}),e.jsx(I,{htmlFor:"warmup-flag-edit",children:"Exercice d'échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(oe,{variant:"outline",onClick:()=>{c(!1),x(null)},className:"h-10",children:"Annuler"}),e.jsx(oe,{variant:"default",onClick:()=>{p?.id&&qr.mutate(p)},disabled:!p.nom_exercice.trim(),className:"h-10",children:"Enregistrer"})]})]})]})}),xt=e.jsx(Ee,{open:u,onOpenChange:d,children:e.jsxs(Re,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(Be,{children:e.jsx(Qe,{children:"Créer un exercice"})}),e.jsxs("div",{className:"space-y-4",children:[M.exercise_type==="warmup"?e.jsx(qt,{exercise:M,warmupMode:F,onChange:n=>Z(f=>({...f,...n})),onWarmupModeChange:S,idPrefix:"create"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Nom"}),e.jsx(G,{value:M.nom_exercice,onChange:n=>Z({...M,nom_exercice:n.target.value}),placeholder:"ex: Rotations Élastique"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Description"}),e.jsx(Se,{value:M.description??"",onChange:n=>Z({...M,description:n.target.value===""?null:n.target.value}),placeholder:"Détails, consignes..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Illustration (GIF)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{value:M.illustration_gif??"",onChange:n=>Z({...M,illustration_gif:n.target.value===""?null:n.target.value}),placeholder:"https://...",className:"flex-1"}),e.jsx(oe,{type:"button",variant:"outline",size:"icon",disabled:Y,onClick:()=>{const n=document.createElement("input");n.type="file",n.accept="image/*,.gif",n.onchange=f=>{const j=f.target.files?.[0];j&&ee(j,k=>Z(O=>({...O,illustration_gif:k})))},n.click()},"aria-label":"Uploader une image",children:Y?e.jsx(Pt,{className:"h-4 w-4 animate-spin"}):e.jsx(Dt,{className:"h-4 w-4"})})]}),M.illustration_gif&&e.jsx("img",{src:M.illustration_gif,alt:"Aperçu",className:"mt-2 h-20 w-20 rounded-lg object-cover border"})]}),M.exercise_type!=="warmup"?e.jsx(Tt,{exercise:M,onChange:n=>Z(f=>({...f,...n}))}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yt,{id:"warmup-flag",checked:M.exercise_type==="warmup",onCheckedChange:n=>Z({...M,exercise_type:n===!0?"warmup":"strength"})}),e.jsx(I,{htmlFor:"warmup-flag",children:"Exercice d'échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(oe,{variant:"outline",onClick:()=>d(!1),className:"h-10",children:"Annuler"}),e.jsx(oe,{variant:"default",onClick:()=>Tr.mutate(M),disabled:!M.nom_exercice.trim(),className:"h-10",children:"Enregistrer"})]})]})]})}),ht=e.jsx(bt,{open:!!b,onOpenChange:n=>{n||v(null)},children:e.jsxs(Nt,{children:[e.jsxs(wt,{children:[e.jsx(_t,{children:"Supprimer la séance ?"}),e.jsxs(Ct,{children:['Cette action est définitive. La séance "',b?.title,'" sera supprimée.']})]}),e.jsxs(St,{children:[e.jsx(Et,{children:"Annuler"}),e.jsx(Rt,{onClick:()=>{b?.id&&Fe.mutate(b.id)},children:"Supprimer"})]})]})}),gt=e.jsx(bt,{open:!!w,onOpenChange:n=>{n||D(null)},children:e.jsxs(Nt,{children:[e.jsxs(wt,{children:[e.jsx(_t,{children:"Supprimer l'exercice ?"}),e.jsxs(Ct,{children:[`Cette action est définitive. L'exercice "`,w?.nom_exercice,'" sera supprimé.']})]}),e.jsxs(St,{children:[e.jsx(Et,{children:"Annuler"}),e.jsx(Rt,{onClick:()=>{w?.id&&Lr.mutate(w.id)},children:"Supprimer"})]})]})});if(r)return e.jsxs(e.Fragment,{children:[xt,ft,ht,gt,e.jsx(Rn,{session:T,exercises:Q??[],editingSessionId:a,folders:g,onSessionChange:q,onCycleChange:n=>{const f=T.items.map((j,k)=>{const O=Q?.find(ue=>ue.id===j.exercise_id);return O?ze(O,n,k,j):{...j,cycle_type:n}});q({...T,cycle:n,items:f})},onSave:zr,onCancel:Vr,onAddItem:Br,onUpdateItem:Qr,onRemoveItem:Wr,onReorderItems:Hr,onExerciseDialogOpen:()=>d(!0),isSaving:dt.isPending||ut.isPending})]});if(be)return e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(Oe,{className:"h-7 w-64"}),e.jsx(Oe,{className:"h-10 w-full rounded-2xl"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:4}).map((n,f)=>e.jsx(Oe,{className:"h-20 w-full rounded-2xl"},f))})]});if(ce)return e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(Is,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:ce instanceof Error?ce.message:"Une erreur s'est produite"}),e.jsx(oe,{variant:"default",onClick:()=>Ne(),className:"mt-4 h-12 md:h-10",children:"Réessayer"})]});const vt=n=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl px-3 py-2 hover:bg-muted/50",children:[n.illustration_gif?e.jsx("button",{type:"button",className:"shrink-0 rounded-lg overflow-hidden border border-border bg-muted",onClick:()=>H({url:n.illustration_gif,name:n.nom_exercice}),children:e.jsx("img",{src:n.illustration_gif,alt:n.nom_exercice,className:"h-10 w-10 object-cover",loading:"lazy",decoding:"async"})}):e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-muted",children:e.jsx(nt,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"truncate text-sm font-medium",children:n.nom_exercice}),e.jsx("div",{className:"text-xs text-muted-foreground",children:n.exercise_type==="warmup"?"Échauffement":"Séries de travail"})]}),e.jsxs("div",{className:"flex shrink-0 items-center gap-1",children:[e.jsx(Ue,{folders:E??[],currentFolderId:n.folder_id,onMove:f=>Ae.mutate({itemId:n.id,folderId:f,table:"dim_exercices"})}),e.jsx("button",{type:"button",onClick:()=>Ur(n),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Modifier",children:e.jsx(Fs,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>D(n),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer",children:e.jsx(at,{className:"h-4 w-4"})})]})]},n.id);return e.jsxs("div",{children:[xt,ft,ht,gt,A&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 flex items-center justify-center p-4",onClick:()=>H(null),children:e.jsxs("div",{className:"relative max-w-md w-full",onClick:n=>n.stopPropagation(),children:[e.jsx("img",{src:A.url,alt:A.name,className:"w-full max-h-[80vh] object-contain rounded-2xl"}),e.jsx("p",{className:"mt-2 text-sm font-medium text-center text-white",children:A.name})]})}),e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:"Musculation"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Catalogue"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>{const n=prompt("Nom du dossier");n?.trim()&&Gr.mutate({name:n.trim(),type:J==="sessions"?"session":"exercise"})},className:"inline-flex items-center gap-2 rounded-full border border-border px-3 py-2 text-xs font-semibold hover:bg-muted",children:[e.jsx(ys,{className:"h-4 w-4"})," Dossier"]}),J==="sessions"?e.jsxs("button",{type:"button",onClick:()=>{l(null),q({title:"",description:"",cycle:"endurance",items:[],folder_id:null}),i(!0)},className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(ke,{className:"h-4 w-4"})," Nouvelle"]}):e.jsxs("button",{type:"button",onClick:()=>d(!0),className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(ke,{className:"h-4 w-4"})," Ajouter"]})]})]}),e.jsx("div",{className:"p-4 space-y-4",children:e.jsxs(zt,{value:J,onValueChange:n=>y(n),children:[e.jsxs(Bt,{className:"grid w-full grid-cols-2",children:[e.jsx(We,{value:"sessions",children:"Séances"}),e.jsxs(We,{value:"exercises",children:["Exercices (",Q?.length??0,")"]})]}),e.jsxs(He,{value:"sessions",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-border bg-card px-3 py-2",children:[e.jsx(Qt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{className:"w-full bg-transparent text-sm outline-none placeholder:text-muted-foreground",placeholder:"Rechercher une séance",value:R,onChange:n=>$(n.target.value)})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(kt,{sessions:K,isLoading:m,error:N,renderTitle:n=>n.title??"Sans titre",renderMetrics:P,renderExtraActions:n=>e.jsx(Ue,{folders:g??[],currentFolderId:n.folder_id,onMove:f=>Ae.mutate({itemId:n.id,folderId:f,table:"strength_sessions"})}),onPreview:n=>we(n),onEdit:n=>we(n),onDelete:n=>v(n),canDelete:()=>!0,isDeleting:Fe.isPending}),g?.map(n=>{const f=de.get(n.id)??[];return e.jsx(Ot,{name:n.name,count:f.length,onRename:j=>mt.mutate({id:n.id,name:j}),onDelete:()=>pt.mutate(n.id),children:f.length>0?e.jsx(kt,{sessions:f,renderTitle:j=>j.title??"Sans titre",renderMetrics:P,renderExtraActions:j=>e.jsx(Ue,{folders:g??[],currentFolderId:j.folder_id,onMove:k=>Ae.mutate({itemId:j.id,folderId:k,table:"strength_sessions"})}),onPreview:j=>we(j),onEdit:j=>we(j),onDelete:j=>v(j),canDelete:()=>!0,isDeleting:Fe.isPending}):e.jsx("div",{className:"rounded-xl border border-dashed border-border px-3 py-4 text-center text-xs text-muted-foreground",children:"Dossier vide"})},n.id)})]})]}),e.jsxs(He,{value:"exercises",className:"space-y-3 mt-4",children:[e.jsx("div",{className:"space-y-1",children:Or.map(vt)}),E?.map(n=>{const f=$r.get(n.id)??[];return e.jsx(Ot,{name:n.name,count:f.length,onRename:j=>mt.mutate({id:n.id,name:j}),onDelete:()=>pt.mutate(n.id),children:f.length>0?e.jsx("div",{className:"space-y-1",children:f.map(vt)}):e.jsx("div",{className:"rounded-xl border border-dashed border-border px-3 py-4 text-center text-xs text-muted-foreground",children:"Dossier vide"})},n.id)})]})]})})]})}export{ze as createStrengthItemFromExercise,Ia as default};
