import{r as l,j as e,g as ce,h as M}from"./vendor-ui-CMUPCwTD.js";import{c as z,j as de,f as R,u as le,d as ue,L as me,b as y}from"./index-BDGnhHrZ.js";import{b as pe,u as B,c as A}from"./vendor-query-WtxIVPOV.js";import{C as _,a as F,d as P,e as fe,b as E,c as I}from"./card-BVRwMXiB.js";import{L as x}from"./label-DtR69dMf.js";import{I as w}from"./input-DqGwk8UO.js";import{T as he}from"./textarea-DDUgdUXD.js";import{B as N}from"./button-BuXE02p3.js";import{c as xe}from"./index-Bm0RG47H.js";import{S as ve,a as ge,b as je,c as Ne,d as be}from"./select-Ci-_VFAs.js";import{P as Se,S as we}from"./save-DjQpJund.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Ce=z("log-out",ye);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Fe=z("refresh-cw",_e);function Pe(s,r=[]){let n=[];function o(a,c){const d=l.createContext(c);d.displayName=a+"Context";const m=n.length;n=[...n,c];const f=h=>{const{scope:b,children:S,...j}=h,p=b?.[s]?.[m]||d,g=l.useMemo(()=>j,Object.values(j));return e.jsx(p.Provider,{value:g,children:S})};f.displayName=a+"Provider";function v(h,b){const S=b?.[s]?.[m]||d,j=l.useContext(S);if(j)return j;if(c!==void 0)return c;throw new Error(`\`${h}\` must be used within \`${a}\``)}return[f,v]}const i=()=>{const a=n.map(c=>l.createContext(c));return function(d){const m=d?.[s]||a;return l.useMemo(()=>({[`__scope${s}`]:{...d,[s]:m}}),[d,m])}};return i.scopeName=s,[o,Le(i,...r)]}function Le(...s){const r=s[0];if(s.length===1)return r;const n=()=>{const o=s.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(a){const c=o.reduce((d,{useScope:m,scopeName:f})=>{const h=m(a)[`__scope${f}`];return{...d,...h}},{});return l.useMemo(()=>({[`__scope${r.scopeName}`]:c}),[c])}};return n.scopeName=r.scopeName,n}var Ae=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],k=Ae.reduce((s,r)=>{const n=xe(`Primitive.${r}`),o=l.forwardRef((i,a)=>{const{asChild:c,...d}=i,m=c?n:r;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(m,{...d,ref:a})});return o.displayName=`Primitive.${r}`,{...s,[r]:o}},{});function Ee(){return de.useSyncExternalStore(Ie,()=>!0,()=>!1)}function Ie(){return()=>{}}var $="Avatar",[Me]=Pe($),[Re,D]=Me($),O=l.forwardRef((s,r)=>{const{__scopeAvatar:n,...o}=s,[i,a]=l.useState("idle");return e.jsx(Re,{scope:n,imageLoadingStatus:i,onImageLoadingStatusChange:a,children:e.jsx(k.span,{...o,ref:r})})});O.displayName=$;var K="AvatarImage",V=l.forwardRef((s,r)=>{const{__scopeAvatar:n,src:o,onLoadingStatusChange:i=()=>{},...a}=s,c=D(K,n),d=ke(o,a),m=ce(f=>{i(f),c.onImageLoadingStatusChange(f)});return M(()=>{d!=="idle"&&m(d)},[d,m]),d==="loaded"?e.jsx(k.img,{...a,ref:r,src:o}):null});V.displayName=K;var G="AvatarFallback",Q=l.forwardRef((s,r)=>{const{__scopeAvatar:n,delayMs:o,...i}=s,a=D(G,n),[c,d]=l.useState(o===void 0);return l.useEffect(()=>{if(o!==void 0){const m=window.setTimeout(()=>d(!0),o);return()=>window.clearTimeout(m)}},[o]),c&&a.imageLoadingStatus!=="loaded"?e.jsx(k.span,{...i,ref:r}):null});Q.displayName=G;function H(s,r){return s?r?(s.src!==r&&(s.src=r),s.complete&&s.naturalWidth>0?"loaded":"loading"):"error":"idle"}function ke(s,{referrerPolicy:r,crossOrigin:n}){const o=Ee(),i=l.useRef(null),a=o?(i.current||(i.current=new window.Image),i.current):null,[c,d]=l.useState(()=>H(a,s));return M(()=>{d(H(a,s))},[a,s]),M(()=>{const m=h=>()=>{d(h)};if(!a)return;const f=m("loaded"),v=m("error");return a.addEventListener("load",f),a.addEventListener("error",v),r&&(a.referrerPolicy=r),typeof n=="string"&&(a.crossOrigin=n),()=>{a.removeEventListener("load",f),a.removeEventListener("error",v)}},[a,n,r]),c}var W=O,J=V,X=Q;const Y=l.forwardRef(({className:s,...r},n)=>e.jsx(W,{ref:n,className:R("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...r}));Y.displayName=W.displayName;const Z=l.forwardRef(({className:s,...r},n)=>e.jsx(J,{ref:n,className:R("aspect-square h-full w-full",s),...r}));Z.displayName=J.displayName;const ee=l.forwardRef(({className:s,...r},n)=>e.jsx(X,{ref:n,className:R("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...r}));ee.displayName=X.displayName;const se=s=>s!=="coach"&&s!=="admin"&&s!=="comite",te=s=>{switch(s){case"coach":return"Entraineur EAC";case"admin":return"Admin";case"comite":return"Comité";default:return"Nageur"}};function $e(s){if(!s)return"-";const r=new Date(s);return Number.isNaN(r.getTime())?s:r.toLocaleDateString("fr-FR")}function qe(){const{user:s,userId:r,logout:n,role:o}=le(),{toast:i}=ue(),a=pe(),c=se(o),d=o==="athlete"||o==="coach"||o==="admin",m=te(o),[f,v]=l.useState(!1),[h,b]=l.useState(""),[S,j]=l.useState(""),[p,g]=l.useState({group_id:"",objectives:"",bio:"",avatar_url:"",birthdate:"",ffn_iuf:""}),{data:u}=B({queryKey:["profile",s,r],queryFn:()=>y.getProfile({displayName:s,userId:r}),enabled:!!s}),{data:q=[],isLoading:T}=B({queryKey:["profile-groups"],queryFn:()=>y.getGroups(),enabled:!!s}),re=l.useMemo(()=>{const t=u?.avatar_url;return t||(s?`https://api.dicebear.com/7.x/initials/svg?seed=${encodeURIComponent(s)}`:"")},[u,s]),L=A({mutationFn:t=>y.updateProfile({userId:r,profile:{group_id:t.group_id?Number(t.group_id):null,birthdate:t.birthdate||null,objectives:t.objectives,bio:t.bio,avatar_url:t.avatar_url,ffn_iuf:(t.ffn_iuf||"").trim()||null}}),onSuccess:()=>{a.invalidateQueries({queryKey:["profile"]}),v(!1),i({title:"Profil mis à jour"})},onError:t=>{i({title:"Mise à jour impossible",description:String(t?.message||t),variant:"destructive"})}}),U=A({mutationFn:t=>y.authPasswordUpdate(t),onSuccess:()=>{b(""),j(""),i({title:"Mot de passe mis à jour"})},onError:t=>{i({title:"Mise à jour impossible",description:String(t?.message||t),variant:"destructive"})}}),C=A({mutationFn:async()=>{const t=String(u?.ffn_iuf??"").trim();if(!t)throw new Error("IUF FFN manquant. Ajoutez-le dans votre profil.");return y.syncFfnSwimRecords({athleteId:r??void 0,athleteName:s??void 0,iuf:t})},onSuccess:t=>{a.invalidateQueries({queryKey:["swim-records"]}),i({title:"Records FFN importés",description:`${t?.inserted??0} ajouté(s), ${t?.updated??0} mis à jour, ${t?.skipped??0} inchangé(s)`})},onError:t=>{i({title:"Import FFN impossible",description:String(t?.message||t),variant:"destructive"})}}),ae=()=>{g({group_id:u?.group_id?String(u.group_id):"",objectives:u?.objectives||"",bio:u?.bio||"",avatar_url:u?.avatar_url||"",birthdate:u?.birthdate?String(u.birthdate).split("T")[0]:"",ffn_iuf:u?.ffn_iuf?String(u.ffn_iuf):""}),v(!0)},ne=()=>L.mutate(p),ie=()=>{if(!h||h.length<6){i({title:"Mot de passe invalide",description:"Minimum 6 caractères.",variant:"destructive"});return}if(h!==S){i({title:"Mot de passe invalide",description:"Les mots de passe ne correspondent pas.",variant:"destructive"});return}U.mutate({password:h})},oe=q.find(t=>t.id===u?.group_id)?.name||u?.group_label||"Non défini";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Profil"}),e.jsxs(_,{children:[e.jsxs(F,{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(Y,{className:"h-16 w-16",children:[e.jsx(Z,{src:re,alt:s||"Profil"}),e.jsx(ee,{children:(s||"?").slice(0,2).toUpperCase()})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xl font-semibold truncate",children:s}),e.jsx("p",{className:"text-sm text-muted-foreground uppercase font-bold tracking-wider",children:m})]})]}),!f&&e.jsx(N,{variant:"ghost",size:"icon",className:"absolute top-4 right-4",onClick:ae,"aria-label":"Modifier le profil",children:e.jsx(Se,{className:"h-4 w-4"})})]}),e.jsx(P,{className:"space-y-4",children:f?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"Groupe"}),e.jsxs(ve,{value:p.group_id,onValueChange:t=>g({...p,group_id:t}),disabled:T,children:[e.jsx(ge,{children:e.jsx(je,{placeholder:T?"Chargement...":"Choisir un groupe"})}),e.jsx(Ne,{children:q.map(t=>e.jsx(be,{value:String(t.id),children:t.name},t.id))})]})]}),c?e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"IUF FFN"}),e.jsx(w,{value:p.ffn_iuf,onChange:t=>g({...p,ffn_iuf:t.target.value}),placeholder:"879576",inputMode:"numeric"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Identifiant unique FFN (utilisé pour importer vos records compétition)."})]}):null,e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"Objectifs"}),e.jsx(w,{value:p.objectives,onChange:t=>g({...p,objectives:t.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"Bio"}),e.jsx(he,{value:p.bio,onChange:t=>g({...p,bio:t.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"Avatar (URL)"}),e.jsx(w,{value:p.avatar_url,onChange:t=>g({...p,avatar_url:t.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"Date de naissance"}),e.jsx(w,{type:"date",value:p.birthdate,onChange:t=>g({...p,birthdate:t.target.value})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{onClick:ne,disabled:L.isPending,className:"w-full",children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Enregistrer"]}),e.jsx(N,{variant:"outline",onClick:()=>v(!1),disabled:L.isPending,children:"Annuler"})]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx(x,{className:"text-xs text-muted-foreground uppercase",children:"Groupe"}),e.jsx("div",{className:"font-medium",children:oe})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-xs text-muted-foreground uppercase",children:"Date de naissance"}),e.jsx("div",{className:"font-medium",children:$e(u?.birthdate??null)})]}),c?e.jsxs("div",{children:[e.jsx(x,{className:"text-xs text-muted-foreground uppercase",children:"IUF FFN"}),e.jsx("div",{className:"font-medium",children:String(u?.ffn_iuf??"")||"Non renseigné"})]}):null,e.jsxs("div",{className:c?"":"col-span-2",children:[e.jsx(x,{className:"text-xs text-muted-foreground uppercase",children:"Objectifs"}),e.jsx("div",{className:"font-medium",children:u?.objectives||"Aucun objectif défini."})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(x,{className:"text-xs text-muted-foreground uppercase",children:"Bio"}),e.jsx("div",{className:"font-medium",children:u?.bio||"Non renseignée."})]})]})}),e.jsx(fe,{className:"flex justify-end",children:e.jsxs(N,{variant:"outline",onClick:n,className:"gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),"Se déconnecter"]})})]}),c?e.jsxs(_,{children:[e.jsxs(F,{children:[e.jsx(E,{children:"FFN"}),e.jsx(I,{children:"Importer vos records compétition depuis Extranat."})]}),e.jsxs(P,{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["IUF enregistré : ",e.jsx("span",{className:"font-medium text-foreground",children:String(u?.ffn_iuf??"")||"—"})]}),e.jsxs(N,{className:"w-full gap-2",onClick:()=>C.mutate(),disabled:C.isPending||!String(u?.ffn_iuf??"").trim(),children:[e.jsx(Fe,{className:["h-4 w-4",C.isPending?"animate-spin":""].join(" ")}),C.isPending?"Import en cours...":"Récupérer records depuis FFN"]}),String(u?.ffn_iuf??"").trim()?null:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ajoutez votre IUF FFN dans le profil (bouton crayon) pour activer l’import."})]})]}):null,d?e.jsxs(_,{children:[e.jsxs(F,{children:[e.jsx(E,{children:"Mot de passe"}),e.jsx(I,{children:"Modifiez votre mot de passe."})]}),e.jsxs(P,{className:"space-y-3",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"Nouveau mot de passe"}),e.jsx(w,{type:"password",value:h,onChange:t=>b(t.target.value),placeholder:"••••••••"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"Confirmer"}),e.jsx(w,{type:"password",value:S,onChange:t=>j(t.target.value),placeholder:"••••••••"})]}),e.jsx(N,{className:"w-full",onClick:ie,disabled:U.isPending,children:"Mettre à jour le mot de passe"})]})]}):null,c?e.jsxs(_,{children:[e.jsxs(F,{children:[e.jsx(E,{children:"Records"}),e.jsx(I,{children:"Consultez vos records de natation et musculation."})]}),e.jsx(P,{children:e.jsx(me,{href:"/records",children:e.jsx(N,{asChild:!0,children:e.jsx("a",{children:"Voir mes records"})})})})]}):null]})}const We=Object.freeze(Object.defineProperty({__proto__:null,default:qe,getRoleLabel:te,shouldShowRecords:se},Symbol.toStringTag,{value:"Module"}));export{We as P,Fe as R,se as s};
