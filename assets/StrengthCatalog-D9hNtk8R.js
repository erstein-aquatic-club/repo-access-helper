import{r as u,b as _s,h as bs,m as Le,n as ws,j as e,d as Oe,o as Ss,l as Q,u as ue,I as Cs,t as Es,E as Rs}from"./vendor-ui-DJQMR4VV.js";import{b as Ds,u as ye,c as $}from"./vendor-query-BT4y-huw.js";import{c as Te,a as me,C as T,L as g,I as C,g as J,h as qe,i as q,B as D,f as ks,d as F,S as R,l as Is,s as Ne}from"./index-CTSBy5ex.js";import{u as Fs,S as Z,a as ee,b as se,c as re,d as A}from"./select-CZLv4-gW.js";import{C as As}from"./circle-DLF3AS1I.js";import{T as te}from"./textarea-D7EmXjXY.js";import{D as ae,a as ie,b as ne,c as ce}from"./dialog-B412R0t9.js";import{C as _e}from"./checkbox-YZs5ihOY.js";import{A as be,a as we,b as Se,c as Ce,d as Ee,e as Re,f as De,g as ke}from"./alert-dialog-lFXDIKox.js";import{T as Ps,a as $s,b as Ms,c as Gs}from"./tabs-o775_k2O.js";import{T as le,F as Ls,G as Os}from"./FormActions-CosipRaa.js";import{P as V}from"./plus-BYrmyYkS.js";import{L as Ie}from"./loader-circle-BbnkgNen.js";import{C as Ts}from"./circle-alert-DOURnK4b.js";import{P as Fe}from"./pen-BC9DbhqB.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-Db4xOvcx.js";import"./vendor-supabase-D7B1G6YZ.js";import"./chevron-up-DkCgwysZ.js";import"./check-C5YVkh5w.js";import"./chevron-left-XVXE7Pan.js";import"./save-BQN-HF6A.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],zs=Te("funnel",qs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Ae=Te("upload",Us);function oe(r,a,{checkForDefaultPrevented:t=!0}={}){return function(i){if(r?.(i),t===!1||!i.defaultPrevented)return a?.(i)}}var Ks=_s[" useInsertionEffect ".trim().toString()]||bs;function Bs({prop:r,defaultProp:a,onChange:t=()=>{},caller:n}){const[i,l,j]=Vs({defaultProp:a,onChange:t}),p=r!==void 0,o=p?r:i;{const d=u.useRef(r!==void 0);u.useEffect(()=>{const f=d.current;f!==p&&console.warn(`${n} is changing from ${f?"controlled":"uncontrolled"} to ${p?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=p},[p,n])}const x=u.useCallback(d=>{if(p){const f=Qs(d)?d(r):d;f!==r&&j.current?.(f)}else l(d)},[p,r,l,j]);return[o,x]}function Vs({defaultProp:r,onChange:a}){const[t,n]=u.useState(r),i=u.useRef(t),l=u.useRef(a);return Ks(()=>{l.current=a},[a]),u.useEffect(()=>{i.current!==t&&(l.current?.(t),i.current=t)},[t,i]),[t,n,l]}function Qs(r){return typeof r=="function"}var pe="Radio",[Hs,ze]=Oe(pe),[Ws,Xs]=Hs(pe),Ue=u.forwardRef((r,a)=>{const{__scopeRadio:t,name:n,checked:i=!1,required:l,disabled:j,value:p="on",onCheck:o,form:x,...d}=r,[f,_]=u.useState(null),N=ue(a,I=>_(I)),v=u.useRef(!1),k=f?x||!!f.closest("form"):!0;return e.jsxs(Ws,{scope:t,checked:i,disabled:j,children:[e.jsx(Q.button,{type:"button",role:"radio","aria-checked":i,"data-state":Qe(i),"data-disabled":j?"":void 0,disabled:j,value:p,...d,ref:N,onClick:oe(r.onClick,I=>{i||o?.(),k&&(v.current=I.isPropagationStopped(),v.current||I.stopPropagation())})}),k&&e.jsx(Ve,{control:f,bubbles:!v.current,name:n,value:p,checked:i,required:l,disabled:j,form:x,style:{transform:"translateX(-100%)"}})]})});Ue.displayName=pe;var Ke="RadioIndicator",Be=u.forwardRef((r,a)=>{const{__scopeRadio:t,forceMount:n,...i}=r,l=Xs(Ke,t);return e.jsx(Es,{present:n||l.checked,children:e.jsx(Q.span,{"data-state":Qe(l.checked),"data-disabled":l.disabled?"":void 0,...i,ref:a})})});Be.displayName=Ke;var Ys="RadioBubbleInput",Ve=u.forwardRef(({__scopeRadio:r,control:a,checked:t,bubbles:n=!0,...i},l)=>{const j=u.useRef(null),p=ue(j,l),o=Fs(t),x=Rs(a);return u.useEffect(()=>{const d=j.current;if(!d)return;const f=window.HTMLInputElement.prototype,N=Object.getOwnPropertyDescriptor(f,"checked").set;if(o!==t&&N){const v=new Event("click",{bubbles:n});N.call(d,t),d.dispatchEvent(v)}},[o,t,n]),e.jsx(Q.input,{type:"radio","aria-hidden":!0,defaultChecked:t,...i,tabIndex:-1,ref:p,style:{...i.style,...x,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Ve.displayName=Ys;function Qe(r){return r?"checked":"unchecked"}var Js=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],H="RadioGroup",[Zs]=Oe(H,[Le,ze]),He=Le(),We=ze(),[er,sr]=Zs(H),Xe=u.forwardRef((r,a)=>{const{__scopeRadioGroup:t,name:n,defaultValue:i,value:l,required:j=!1,disabled:p=!1,orientation:o,dir:x,loop:d=!0,onValueChange:f,..._}=r,N=He(t),v=ws(x),[k,I]=Bs({prop:l,defaultProp:i??null,onChange:f,caller:H});return e.jsx(er,{scope:t,name:n,required:j,disabled:p,value:k,onValueChange:I,children:e.jsx(Ss,{asChild:!0,...N,orientation:o,dir:v,loop:d,children:e.jsx(Q.div,{role:"radiogroup","aria-required":j,"aria-orientation":o,"data-disabled":p?"":void 0,dir:v,..._,ref:a})})})});Xe.displayName=H;var Ye="RadioGroupItem",Je=u.forwardRef((r,a)=>{const{__scopeRadioGroup:t,disabled:n,...i}=r,l=sr(Ye,t),j=l.disabled||n,p=He(t),o=We(t),x=u.useRef(null),d=ue(a,x),f=l.value===i.value,_=u.useRef(!1);return u.useEffect(()=>{const N=k=>{Js.includes(k.key)&&(_.current=!0)},v=()=>_.current=!1;return document.addEventListener("keydown",N),document.addEventListener("keyup",v),()=>{document.removeEventListener("keydown",N),document.removeEventListener("keyup",v)}},[]),e.jsx(Cs,{asChild:!0,...p,focusable:!j,active:f,children:e.jsx(Ue,{disabled:j,required:l.required,checked:f,...o,...i,name:l.name,ref:d,onCheck:()=>l.onValueChange(i.value),onKeyDown:oe(N=>{N.key==="Enter"&&N.preventDefault()}),onFocus:oe(i.onFocus,()=>{_.current&&x.current?.click()})})})});Je.displayName=Ye;var rr="RadioGroupIndicator",Ze=u.forwardRef((r,a)=>{const{__scopeRadioGroup:t,...n}=r,i=We(t);return e.jsx(Be,{...i,...n,ref:a})});Ze.displayName=rr;var es=Xe,ss=Je,tr=Ze;const rs=u.forwardRef(({className:r,...a},t)=>e.jsx(es,{className:me("grid gap-2",r),...a,ref:t}));rs.displayName=es.displayName;const de=u.forwardRef(({className:r,...a},t)=>e.jsx(ss,{ref:t,className:me("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",r),...a,children:e.jsx(tr,{className:"flex items-center justify-center",children:e.jsx(As,{className:"h-3.5 w-3.5 fill-primary"})})}));de.displayName=ss.displayName;function ar({exercise:r,exercises:a,exerciseFilter:t,onChange:n,onDelete:i,showDelete:l=!0}){const j=new Set,p=a.filter(o=>t==="all"||j.has(o.id)?!0:o.exercise_type===t);return e.jsxs(T,{className:"relative",children:[l&&e.jsx("button",{type:"button",onClick:i,className:"absolute top-2 right-2 inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer l'exercice",children:e.jsx(le,{className:"h-4 w-4"})}),e.jsxs("div",{className:"pt-6 px-4 pb-4 grid md:grid-cols-12 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-3 space-y-2",children:[e.jsx(g,{children:"Exercice"}),e.jsxs(Z,{value:r.exercise_id.toString(),onValueChange:o=>n("exercise_id",parseInt(o)),children:[e.jsx(ee,{children:e.jsx(se,{})}),e.jsx(re,{children:p.length?p.map(o=>e.jsxs(A,{value:o.id.toString(),children:[o.nom_exercice,o.exercise_type==="warmup"?" • Échauffement":""]},o.id)):e.jsx(A,{value:"no-exercise",disabled:!0,children:"Aucun exercice disponible"})})]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(g,{children:"Séries"}),e.jsx(C,{type:"number",value:r.sets===0?"":r.sets,onChange:o=>n("sets",o.target.value===""?0:Number(o.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(g,{children:"Reps"}),e.jsx(C,{type:"number",value:r.reps===0?"":r.reps,onChange:o=>n("reps",o.target.value===""?0:Number(o.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(g,{children:"% 1RM"}),e.jsx(C,{type:"number",value:r.percent_1rm===0?"":r.percent_1rm,onChange:o=>n("percent_1rm",o.target.value===""?0:Number(o.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(g,{children:"Repos (s)"}),e.jsx(C,{type:"number",value:r.rest_seconds===0?"":r.rest_seconds,onChange:o=>n("rest_seconds",o.target.value===""?0:Number(o.target.value))})]})]})]})}const ir=r=>r==="endurance"||r==="hypertrophie"||r==="force"?r:"endurance";function nr({session:r,exercises:a,editingSessionId:t,onSessionChange:n,onSave:i,onCancel:l,onAddItem:j,onUpdateItem:p,onRemoveItem:o,onReorderItems:x,onExerciseDialogOpen:d,isSaving:f}){const[_,N]=u.useState("all"),[v,k]=u.useState(null),[I,z]=u.useState(!1),[M,G]=u.useState(null),[L,P]=u.useState(null),U=new Map(a.map(m=>[m.id,m])),E=()=>{k({id:t??0,title:r.title,description:r.description,cycle:r.cycle,items:r.items}),z(!0)};return e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-bottom-4",children:[e.jsx(Ls,{isEditing:!!t,isSaving:f,onSave:i,onCancel:l,onPreview:E}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs(T,{children:[e.jsx(J,{children:e.jsx(qe,{children:"Informations Générales"})}),e.jsxs(q,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Titre"}),e.jsx(C,{value:r.title,onChange:m=>n({...r,title:m.target.value}),placeholder:"ex: Full Body A"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Cycle"}),e.jsxs(Z,{value:r.cycle,onValueChange:m=>n({...r,cycle:ir(m)}),children:[e.jsx(ee,{children:e.jsx(se,{})}),e.jsxs(re,{children:[e.jsx(A,{value:"endurance",children:"Endurance"}),e.jsx(A,{value:"hypertrophie",children:"Hypertrophie"}),e.jsx(A,{value:"force",children:"Force"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Description"}),e.jsx(te,{value:r.description,onChange:m=>n({...r,description:m.target.value})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold",children:"Exercices"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(D,{size:"sm",variant:"outline",onClick:d,className:"h-10",children:[e.jsx(V,{className:"mr-2 h-4 w-4"})," Nouvel exercice"]}),e.jsxs(D,{size:"sm",variant:"default",onClick:j,className:"h-10",children:[e.jsx(V,{className:"mr-2 h-4 w-4"})," Ajouter"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-[220px_1fr] items-end",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(zs,{className:"h-4 w-4"})," Filtre exercices"]}),e.jsxs(Z,{value:_,onValueChange:m=>N(m),children:[e.jsx(ee,{children:e.jsx(se,{})}),e.jsxs(re,{children:[e.jsx(A,{value:"all",children:"Tous"}),e.jsx(A,{value:"strength",children:"Séries de travail"}),e.jsx(A,{value:"warmup",children:"Échauffement"})]})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Les exercices marqués warmup sont affichés dans les séances avec le badge « Échauffement »."})]}),r.items.map((m,h)=>e.jsx("div",{className:me("relative transition-all",L===h&&M!==null&&M!==h&&"ring-2 ring-primary bg-accent/30"),onDragOver:b=>b.preventDefault(),onDragEnter:()=>P(h),onDragLeave:()=>P(b=>b===h?null:b),onDrop:()=>{M!==null&&(x(M,h),G(null),P(null))},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("button",{type:"button",className:"mt-6 cursor-grab rounded-md border p-1 text-muted-foreground hover:text-foreground",draggable:!0,onDragStart:()=>G(h),onDragEnd:()=>{G(null),P(null)},"aria-label":"Réordonner",children:e.jsx(Os,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex-1",children:e.jsx(ar,{exercise:m,exercises:a,exerciseFilter:_,onChange:(b,O)=>p(h,b,O),onDelete:()=>o(h),showDelete:!0})})]})},`${m.exercise_id}-${h}`))]})]}),e.jsx(ae,{open:I,onOpenChange:m=>{z(m),m||k(null)},children:e.jsxs(ie,{className:"sm:max-w-3xl",children:[e.jsx(ne,{children:e.jsx(ce,{children:"Détails de la séance"})}),v&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-lg font-semibold",children:v.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:v.description||"—"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cycle : ",v.cycle]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Exercices"}),e.jsx("div",{className:"space-y-2",children:(v.items??[]).slice().sort((m,h)=>(m.order_index??0)-(h.order_index??0)).map((m,h)=>{const b=U.get(m.exercise_id);return e.jsxs("div",{className:"rounded-md border px-3 py-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("span",{className:"font-medium",children:[h+1,". ",b?.nom_exercice??"Exercice"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:b?.exercise_type==="warmup"?"Échauffement":"Travail"})]}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[m.sets," séries • ",m.reps," reps • ",m.percent_1rm,"% 1RM •"," ",m.rest_seconds,"s"]})]},`${m.exercise_id}-${h}`)})})]})]})]})})]})}const Pe=[{key:"endurance",label:"Endurance",fieldSuffix:"endurance"},{key:"hypertrophie",label:"Hypertrophie",fieldSuffix:"hypertrophie"},{key:"force",label:"Force",fieldSuffix:"force"}],cr=r=>r==="endurance"||r==="hypertrophie"||r==="force"?r:"endurance",$e=({exercise:r,onChange:a,disabled:t=!1})=>e.jsxs(Ps,{defaultValue:"endurance",className:"w-full",children:[e.jsx($s,{className:"grid w-full grid-cols-3",children:Pe.map(n=>e.jsx(Ms,{value:n.key,children:n.label},n.key))}),Pe.map(n=>{const i=`pct_1rm_${n.fieldSuffix}`,l=`Nb_series_${n.fieldSuffix}`,j=`Nb_reps_${n.fieldSuffix}`,p=`recup_${n.fieldSuffix}`,o=`recup_exercices_${n.fieldSuffix}`;return e.jsxs(Gs,{value:n.key,className:`space-y-3 rounded-lg border p-3 ${t?"opacity-60":""}`,children:[e.jsx("p",{className:"text-sm font-semibold",children:n.label}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"% 1RM"}),e.jsx(C,{type:"number",value:r[i]??"",disabled:t,onChange:x=>a({[i]:x.target.value===""?null:Number(x.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Nb séries"}),e.jsx(C,{type:"number",value:r[l]??"",disabled:t,onChange:x=>a({[l]:x.target.value===""?null:Number(x.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Nb reps"}),e.jsx(C,{type:"number",value:r[j]??"",disabled:t,onChange:x=>a({[j]:x.target.value===""?null:Number(x.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Récup. séries (s)"}),e.jsx(C,{type:"number",value:r[p]??"",disabled:t,onChange:x=>a({[p]:x.target.value===""?null:Number(x.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Récup. exercices (s)"}),e.jsx(C,{type:"number",value:r[o]??"",disabled:t,onChange:x=>a({[o]:x.target.value===""?null:Number(x.target.value)})})]})]})]},n.key)})]}),lr={pct_1rm_endurance:60,pct_1rm_hypertrophie:75,pct_1rm_force:85,Nb_series_endurance:4,Nb_series_hypertrophie:3,Nb_series_force:3,Nb_reps_endurance:16,Nb_reps_hypertrophie:8,Nb_reps_force:3,recup_endurance:120,recup_hypertrophie:200,recup_force:300,recup_exercices_endurance:300,recup_exercices_hypertrophie:400,recup_exercices_force:500},B=r=>{const a=Number(r);return Number.isFinite(a)?a:0},Me=(r,a,t,n)=>{const i=a==="force"?"force":a==="hypertrophie"?"hypertrophie":"endurance",l=`Nb_series_${i}`,j=`Nb_reps_${i}`,p=`pct_1rm_${i}`,o=`recup_${i}`;return{exercise_id:r.id,order_index:t,sets:B(r[l]),reps:B(r[j]),rest_seconds:B(r[o]),percent_1rm:B(r[p]),cycle_type:a,notes:n?.notes??""}},or=()=>({nom_exercice:"",description:null,illustration_gif:null,exercise_type:"strength",warmup_reps:null,warmup_duration:null,...lr}),Ge=({exercise:r,warmupMode:a,onChange:t,onWarmupModeChange:n,idPrefix:i})=>e.jsxs("div",{className:"space-y-3 rounded-lg border p-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Paramètres d'échauffement"}),e.jsxs(rs,{value:a,onValueChange:l=>{n(l==="duration"?"duration":"reps"),t(l==="duration"?{warmup_reps:null,warmup_duration:r.warmup_duration??0}:{warmup_duration:null,warmup_reps:r.warmup_reps??0})},className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(de,{value:"reps",id:`${i}-warmup-reps`}),e.jsx(g,{htmlFor:`${i}-warmup-reps`,children:"Nombre de répétitions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(de,{value:"duration",id:`${i}-warmup-duration`}),e.jsx(g,{htmlFor:`${i}-warmup-duration`,children:"Durée (secondes)"})]})]}),a==="duration"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Durée (s)"}),e.jsx(C,{type:"number",value:r.warmup_duration??"",onChange:l=>t({warmup_duration:l.target.value===""?null:Number(l.target.value)})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Nombre de répétitions"}),e.jsx(C,{type:"number",value:r.warmup_reps??"",onChange:l=>t({warmup_reps:l.target.value===""?null:Number(l.target.value)})})]})]});function Ar(){const{toast:r}=ks(),a=Ds(),[t,n]=u.useState(!1),[i,l]=u.useState(null),[j,p]=u.useState(!1),[o,x]=u.useState(!1),[d,f]=u.useState(null),[_,N]=u.useState(null),[v,k]=u.useState(null),[I,z]=u.useState("reps"),[M,G]=u.useState("reps"),[L,P]=u.useState(!1),U=async(s,c)=>{if(s.size>10485760){r({title:"Fichier trop volumineux",description:"La taille maximale est de 10 Mo.",variant:"destructive"});return}P(!0);try{const y=s.name.split(".").pop()??"gif",S=`exercises/${Date.now()}-${Math.random().toString(36).slice(2)}.${y}`,{error:K}=await Ne.storage.from("exercise-gifs").upload(S,s,{upsert:!1});if(K)throw K;const{data:Ns}=Ne.storage.from("exercise-gifs").getPublicUrl(S);c(Ns.publicUrl),r({title:"Image uploadée"})}catch(y){const S=y instanceof Error?y.message:"Réessayez.";r({title:"Erreur d'upload",description:S,variant:"destructive"})}finally{P(!1)}},[E,m]=u.useState({title:"",description:"",cycle:"endurance",items:[]}),[h,b]=u.useState({...or()});u.useEffect(()=>{d&&G(d.warmup_duration!=null?"duration":"reps")},[d]);const{data:O,isLoading:ts,error:W,refetch:as}=ye({queryKey:["exercises"],queryFn:()=>F.getExercises()}),{data:is,isLoading:ns,error:X,refetch:cs}=ye({queryKey:["strength_catalog"],queryFn:()=>F.getStrengthSessions()}),ls=$({mutationFn:s=>F.createExercise(s),onSuccess:()=>{a.invalidateQueries({queryKey:["exercises"]}),p(!1),r({title:"Exercice ajouté"})}}),xe=$({mutationFn:s=>F.createStrengthSession(s),onSuccess:()=>{a.invalidateQueries({queryKey:["strength_catalog"]}),n(!1),m({title:"",description:"",cycle:"endurance",items:[]}),r({title:"Séance créée avec succès"})}}),os=$({mutationFn:s=>F.updateExercise(s),onSuccess:()=>{a.invalidateQueries({queryKey:["exercises"]}),a.invalidateQueries({queryKey:["strength_catalog"]}),x(!1),f(null),r({title:"Exercice mis à jour"})}}),ds=$({mutationFn:s=>F.deleteExercise(s),onSuccess:()=>{a.invalidateQueries({queryKey:["exercises"]}),a.invalidateQueries({queryKey:["strength_catalog"]}),k(null),r({title:"Exercice supprimé"})}}),us=$({mutationFn:s=>F.deleteStrengthSession(s),onSuccess:()=>{a.invalidateQueries({queryKey:["strength_catalog"]}),N(null),r({title:"Séance supprimée"})}}),he=$({mutationFn:s=>F.updateStrengthSession(s),onSuccess:()=>{a.invalidateQueries({queryKey:["strength_catalog"]}),n(!1),l(null),m({title:"",description:"",cycle:"endurance",items:[]}),r({title:"Séance mise à jour"})}}),ms=$({mutationFn:s=>F.persistStrengthSessionOrder(s)}),ps=()=>{n(!1),l(null),m({title:"",description:"",cycle:"endurance",items:[]})},xs=s=>{l(s.id),m({title:s.title??"",description:s.description??"",cycle:cr(s.cycle),items:s.items?.map(c=>({exercise_id:c.exercise_id,order_index:c.order_index??0,sets:c.sets,reps:c.reps,rest_seconds:c.rest_seconds,percent_1rm:c.percent_1rm,cycle_type:c.cycle_type,notes:c.notes??""}))??[]}),n(!0)},hs=s=>{f(s),x(!0)},fs=()=>{const s={...E,items:Y(E.items)};i?he.mutate({...s,id:i}):xe.mutate(s)},Y=s=>s.map((c,w)=>({...c,order_index:w})),js=()=>{const s=O?.[0];m(c=>({...c,items:[...c.items,s?Me(s,c.cycle,c.items.length):{exercise_id:1,order_index:c.items.length,sets:0,reps:0,rest_seconds:0,percent_1rm:0}]}))},gs=(s,c,w)=>{const y=[...E.items];if(c==="exercise_id"){const S=O?.find(K=>K.id===w);S?y[s]=Me(S,E.cycle,y[s].order_index??s,y[s]):y[s]={...y[s],exercise_id:Number(w)}}else y[s]={...y[s],[c]:w};m({...E,items:y})},vs=s=>{const c=Y(E.items.filter((w,y)=>y!==s));m({...E,items:c})},ys=(s,c)=>{if(s===c)return;const w=[...E.items],[y]=w.splice(s,1);w.splice(c,0,y);const S=Y(w);m({...E,items:S}),i&&ms.mutate({id:i,title:E.title,description:E.description,cycle:E.cycle,items:S})},fe=e.jsx(ae,{open:o,onOpenChange:x,children:e.jsxs(ie,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(ne,{children:e.jsx(ce,{children:"Modifier l'exercice"})}),d&&e.jsxs("div",{className:"space-y-4",children:[d.exercise_type==="warmup"?e.jsx(Ge,{exercise:d,warmupMode:M,onChange:s=>f(c=>c&&{...c,...s}),onWarmupModeChange:G,idPrefix:"edit"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Nom"}),e.jsx(C,{value:d.nom_exercice,onChange:s=>f({...d,nom_exercice:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Description"}),e.jsx(te,{value:d.description??"",onChange:s=>f({...d,description:s.target.value===""?null:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Illustration (GIF)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{value:d.illustration_gif??"",onChange:s=>f({...d,illustration_gif:s.target.value===""?null:s.target.value}),placeholder:"https://...",className:"flex-1"}),e.jsx(D,{type:"button",variant:"outline",size:"icon",disabled:L,onClick:()=>{const s=document.createElement("input");s.type="file",s.accept="image/*,.gif",s.onchange=c=>{const w=c.target.files?.[0];w&&U(w,y=>f(S=>S&&{...S,illustration_gif:y}))},s.click()},"aria-label":"Uploader une image",children:L?e.jsx(Ie,{className:"h-4 w-4 animate-spin"}):e.jsx(Ae,{className:"h-4 w-4"})})]}),d.illustration_gif&&e.jsx("img",{src:d.illustration_gif,alt:"Aperçu",className:"mt-2 h-20 w-20 rounded-lg object-cover border"})]}),d.exercise_type!=="warmup"?e.jsx($e,{exercise:d,onChange:s=>f(c=>c&&{...c,...s})}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{id:"warmup-flag-edit",checked:d.exercise_type==="warmup",onCheckedChange:s=>f({...d,exercise_type:s===!0?"warmup":"strength"})}),e.jsx(g,{htmlFor:"warmup-flag-edit",children:"Exercice d'échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(D,{variant:"outline",onClick:()=>{x(!1),f(null)},className:"h-10",children:"Annuler"}),e.jsx(D,{variant:"default",onClick:()=>{d?.id&&os.mutate(d)},disabled:!d.nom_exercice.trim(),className:"h-10",children:"Enregistrer"})]})]})]})}),je=e.jsx(ae,{open:j,onOpenChange:p,children:e.jsxs(ie,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(ne,{children:e.jsx(ce,{children:"Créer un exercice"})}),e.jsxs("div",{className:"space-y-4",children:[h.exercise_type==="warmup"?e.jsx(Ge,{exercise:h,warmupMode:I,onChange:s=>b(c=>({...c,...s})),onWarmupModeChange:z,idPrefix:"create"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Nom"}),e.jsx(C,{value:h.nom_exercice,onChange:s=>b({...h,nom_exercice:s.target.value}),placeholder:"ex: Rotations Élastique"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Description"}),e.jsx(te,{value:h.description??"",onChange:s=>b({...h,description:s.target.value===""?null:s.target.value}),placeholder:"Détails, consignes..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Illustration (GIF)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{value:h.illustration_gif??"",onChange:s=>b({...h,illustration_gif:s.target.value===""?null:s.target.value}),placeholder:"https://...",className:"flex-1"}),e.jsx(D,{type:"button",variant:"outline",size:"icon",disabled:L,onClick:()=>{const s=document.createElement("input");s.type="file",s.accept="image/*,.gif",s.onchange=c=>{const w=c.target.files?.[0];w&&U(w,y=>b(S=>({...S,illustration_gif:y})))},s.click()},"aria-label":"Uploader une image",children:L?e.jsx(Ie,{className:"h-4 w-4 animate-spin"}):e.jsx(Ae,{className:"h-4 w-4"})})]}),h.illustration_gif&&e.jsx("img",{src:h.illustration_gif,alt:"Aperçu",className:"mt-2 h-20 w-20 rounded-lg object-cover border"})]}),h.exercise_type!=="warmup"?e.jsx($e,{exercise:h,onChange:s=>b(c=>({...c,...s}))}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{id:"warmup-flag",checked:h.exercise_type==="warmup",onCheckedChange:s=>b({...h,exercise_type:s===!0?"warmup":"strength"})}),e.jsx(g,{htmlFor:"warmup-flag",children:"Exercice d'échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(D,{variant:"outline",onClick:()=>p(!1),className:"h-10",children:"Annuler"}),e.jsx(D,{variant:"default",onClick:()=>ls.mutate(h),disabled:!h.nom_exercice.trim(),className:"h-10",children:"Enregistrer"})]})]})]})}),ge=e.jsx(be,{open:!!_,onOpenChange:s=>{s||N(null)},children:e.jsxs(we,{children:[e.jsxs(Se,{children:[e.jsx(Ce,{children:"Supprimer la séance ?"}),e.jsxs(Ee,{children:['Cette action est définitive. La séance "',_?.title,'" sera supprimée.']})]}),e.jsxs(Re,{children:[e.jsx(De,{children:"Annuler"}),e.jsx(ke,{onClick:()=>{_?.id&&us.mutate(_.id)},children:"Supprimer"})]})]})}),ve=e.jsx(be,{open:!!v,onOpenChange:s=>{s||k(null)},children:e.jsxs(we,{children:[e.jsxs(Se,{children:[e.jsx(Ce,{children:"Supprimer l'exercice ?"}),e.jsxs(Ee,{children:[`Cette action est définitive. L'exercice "`,v?.nom_exercice,'" sera supprimé.']})]}),e.jsxs(Re,{children:[e.jsx(De,{children:"Annuler"}),e.jsx(ke,{onClick:()=>{v?.id&&ds.mutate(v.id)},children:"Supprimer"})]})]})});return ts||ns?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(R,{className:"h-7 w-64"}),e.jsx(R,{className:"h-10 w-24"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(R,{className:"h-6 w-48"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:Array.from({length:4}).map((s,c)=>e.jsxs(T,{children:[e.jsxs(J,{children:[e.jsx(R,{className:"h-6 w-3/4"}),e.jsx(R,{className:"h-4 w-1/2 mt-2"})]}),e.jsx(q,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-10 w-10"}),e.jsx(R,{className:"h-10 w-10"}),e.jsx(R,{className:"h-10 w-10"})]})})]},`skeleton-session-${c}`))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(R,{className:"h-6 w-48"}),e.jsx(R,{className:"h-10 w-48"})]}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:Array.from({length:6}).map((s,c)=>e.jsx(T,{children:e.jsxs(q,{className:"flex flex-col gap-3 py-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(R,{className:"h-14 w-14 rounded-md"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{className:"h-5 w-32"}),e.jsx(R,{className:"h-4 w-24"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{className:"h-10 w-10"}),e.jsx(R,{className:"h-10 w-10"})]})]})},`skeleton-exercise-${c}`))})]})]}):W||X?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(Ts,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:W instanceof Error?W.message:X instanceof Error?X.message:"Une erreur s'est produite"}),e.jsx(D,{variant:"default",onClick:()=>{as(),cs()},className:"mt-4 h-12 md:h-10",children:"Réessayer"})]}):t?e.jsxs(e.Fragment,{children:[je,fe,ge,ve,e.jsx(nr,{session:E,exercises:O??[],editingSessionId:i,onSessionChange:m,onSave:fs,onCancel:ps,onAddItem:js,onUpdateItem:gs,onRemoveItem:vs,onReorderItems:ys,onExerciseDialogOpen:()=>p(!0),isSaving:xe.isPending||he.isPending})]}):e.jsxs("div",{className:"space-y-4",children:[je,fe,ge,ve,e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Catalogue Séances Musculation"}),e.jsxs(D,{variant:"default",onClick:()=>{l(null),m({title:"",description:"",cycle:"endurance",items:[]}),n(!0)},className:"h-10",children:[e.jsx(V,{className:"mr-2 h-4 w-4"})," Créer"]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:is?.map(s=>e.jsxs(T,{children:[e.jsxs(J,{children:[e.jsx(qe,{children:s.title}),e.jsxs(Is,{children:[s.items?.length||0," exercices • ",s.cycle]})]}),e.jsx(q,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{variant:"outline",size:"icon","aria-label":"Modifier",onClick:()=>xs(s),children:e.jsx(Fe,{className:"h-4 w-4"})}),e.jsx(D,{variant:"destructive",size:"icon","aria-label":"Supprimer",onClick:()=>N(s),children:e.jsx(le,{className:"h-4 w-4"})})]})})]},s.id))}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Catalogue Exercices"}),e.jsxs(D,{variant:"outline",onClick:()=>p(!0),className:"h-10",children:[e.jsx(V,{className:"mr-2 h-4 w-4"})," Ajouter un exercice"]})]}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:O?.map(s=>e.jsx(T,{children:e.jsxs(q,{className:"flex flex-col gap-3 py-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.illustration_gif?e.jsx("img",{src:s.illustration_gif,alt:`Illustration ${s.nom_exercice}`,className:"h-14 w-14 rounded-md object-cover",loading:"lazy",decoding:"async"}):null,e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.nom_exercice}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.exercise_type==="warmup"?"Échauffement":"Séries de travail"})]})]}),e.jsxs("div",{className:"flex w-full gap-2 sm:w-auto",children:[e.jsx(D,{variant:"outline",size:"icon","aria-label":"Modifier",onClick:()=>hs(s),children:e.jsx(Fe,{className:"h-4 w-4"})}),e.jsx(D,{variant:"destructive",size:"icon","aria-label":"Supprimer",onClick:()=>k(s),children:e.jsx(le,{className:"h-4 w-4"})})]})]})},s.id))})]})]})}export{Me as createStrengthItemFromExercise,Ar as default};
