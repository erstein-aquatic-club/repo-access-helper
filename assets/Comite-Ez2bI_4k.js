import{b as I,j as e}from"./vendor-ui-DJQMR4VV.js";import{u as k,R,n as _,C as l,i as n,g as u,h as x,L as D,d as f,o as H}from"./index-DaHPugKm.js";import{u as j}from"./vendor-query-BT4y-huw.js";import{S as K,a as O,b as V,c as z,d as q}from"./select-D9wKUzyw.js";import{C as P}from"./checkbox-UygF7D02.js";import{c as Q,f as a,g as B}from"./timesheetHelpers--iRq8jT1.js";import{f as G}from"./vendor-date-cQbdWov0.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-Db4xOvcx.js";import"./vendor-supabase-D7B1G6YZ.js";import"./chevron-up-DJpjFLvS.js";import"./check-BFnEVKsm.js";const E=o=>{if(!o)return"—";const d=new Date(o);return Number.isNaN(d.getTime())?"—":G(d,"HH:mm")};function ie(){const{useMemo:o,useState:d}=I,g=typeof window>"u"?k.getState().role:k(s=>s.role),h=g==="comite"||g==="admin",[p,A]=d("all"),[c,F]=d(!1),{data:L=[]}=j({queryKey:["timesheet-coaches"],queryFn:()=>f.listTimesheetCoaches(),enabled:h}),b=p==="all"?void 0:Number(p),{data:m=[],error:v}=j({queryKey:["timesheet-shifts",b??"all"],queryFn:()=>f.listTimesheetShifts({coachId:b}),enabled:h}),{data:y,error:N}=j({queryKey:["capabilities","timesheet"],queryFn:()=>f.getCapabilities(),enabled:H.hasSupabase}),i=Q(m),T=o(()=>c?m.filter(s=>s.is_travel):m,[m,c]),C=o(()=>{const s=new Map;return T.forEach(r=>{const t=r.shift_date||r.start_time.split("T")[0];s.has(t)||s.set(t,[]),s.get(t)?.push(r)}),Array.from(s.entries()).sort(([r],[t])=>r<t?1:-1)},[T]);if(!h)return typeof window>"u"?null:e.jsx(R,{to:"/"});const w=N?_(N,"Impossible de vérifier le module de pointage.").message:y?.mode==="supabase"&&!y.timesheet.available?"Pointage heures indisponible (tables manquantes côté D1).":null,S=v?_(v,"Impossible de charger les shifts.").message:null;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Comité"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Tableau de bord shifts"})]}),w?e.jsx(l,{className:"border-dashed",children:e.jsx(n,{className:"py-4 text-sm text-muted-foreground",children:w})}):null,S?e.jsx(l,{className:"border-destructive/40",children:e.jsx(n,{className:"py-4 text-sm text-destructive",children:S})}):null,e.jsxs(l,{children:[e.jsx(u,{children:e.jsx(x,{children:"Filtrer par coach"})}),e.jsx(n,{children:e.jsxs(K,{value:p,onValueChange:A,children:[e.jsx(O,{className:"w-full md:w-80",children:e.jsx(V,{placeholder:"Tous les coachs"})}),e.jsxs(z,{children:[e.jsx(q,{value:"all",children:"Tous les coachs"}),L.map(s=>e.jsx(q,{value:String(s.id),children:s.display_name},s.id))]})]})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(l,{children:[e.jsx(u,{children:e.jsx(x,{children:"Totals semaine"})}),e.jsxs(n,{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Travail: ",a(i.week.workMinutes)]}),e.jsxs("div",{children:["Trajet: ",a(i.week.travelMinutes)]}),e.jsxs("div",{className:"font-semibold text-foreground",children:["Total: ",a(i.week.totalMinutes)]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Les shifts en cours ne sont pas comptabilisés."})]})]}),e.jsxs(l,{children:[e.jsx(u,{children:e.jsx(x,{children:"Totals mois"})}),e.jsxs(n,{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Travail: ",a(i.month.workMinutes)]}),e.jsxs("div",{children:["Trajet: ",a(i.month.travelMinutes)]}),e.jsxs("div",{className:"font-semibold text-foreground",children:["Total: ",a(i.month.totalMinutes)]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Les shifts en cours ne sont pas comptabilisés."})]})]})]}),e.jsxs(l,{children:[e.jsx(u,{children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx(x,{children:"Shifts enregistrés"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(P,{id:"shift-travel-filter",checked:c,onCheckedChange:s=>F(s===!0)}),e.jsx(D,{htmlFor:"shift-travel-filter",children:"Trajet uniquement"})]})]})}),e.jsx(n,{className:"space-y-4",children:C.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:c?"Aucun trajet disponible.":"Aucun shift disponible."}):C.map(([s,r])=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:s}),e.jsx("div",{className:"space-y-2",children:r.map(t=>{const M=B(t);return e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 rounded-lg border border-border/60 bg-muted/30 px-3 py-2 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium text-foreground",children:[E(t.start_time)," →"," ",t.end_time?E(t.end_time):"En cours · non comptabilisé"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.coach_name||"Coach"," · ",t.location||"Lieu non précisé"," ·"," ",t.is_travel?"Trajet":"Travail"]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:M!==null?a(M):"En cours"})]},t.id)})})]},s))})]})]})}export{ie as default};
