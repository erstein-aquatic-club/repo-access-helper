import{r as s,j as e}from"./vendor-ui-CMUPCwTD.js";import{u as V,a as K,e as Q,s as q,b as W}from"./index-BDGnhHrZ.js";import{u as X}from"./vendor-query-WtxIVPOV.js";import{B as M}from"./button-BuXE02p3.js";import{I as c}from"./input-DqGwk8UO.js";import{C as J,a as Y,b as Z,c as $,d as ee}from"./card-BVRwMXiB.js";import{D as re,a as se,b as te,c as ae,d as ie}from"./dialog-HXVQqKt4.js";import{L as l}from"./label-DtR69dMf.js";import{S as oe,a as ne,b as le,c as ce,d as de}from"./select-Ci-_VFAs.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BHfjz9SJ.js";import"./vendor-supabase-CrvtPqJM.js";import"./index-Bm0RG47H.js";import"./check-CsaGej-t.js";const ue=i=>i,me=i=>{switch(i){case"coach":return"/coach";case"admin":return"/admin";case"comite":return"/comite";default:return"/"}};function Re(){const[i,P]=s.useState(""),[p,B]=s.useState(""),[w,f]=s.useState(null),[N,C]=s.useState(!1),[n,g]=s.useState(!1),[h,G]=s.useState(""),[x,S]=s.useState(""),[b,E]=s.useState(""),[j,I]=s.useState(""),[d,v]=s.useState(""),[R,a]=s.useState(null),[z,y]=s.useState(!1),{loginFromSession:D,loadUser:F}=V(),[,A]=K(),L=s.useRef(null),k=s.useRef(null),{data:u=[],isLoading:T,isError:O}=X({queryKey:["register-groups"],queryFn:()=>W.getGroups(),enabled:n,retry:2});s.useEffect(()=>{n&&!d&&u.length>0&&v(String(u[0].id))},[u,d,n]),s.useEffect(()=>{ue(n)&&k.current?.focus()},[n]);const U=r=>r.includes("Invalid login")?"Identifiant ou mot de passe incorrect.":r.includes("Email not confirmed")?"Veuillez confirmer votre email avant de vous connecter.":r,H=async r=>{r.preventDefault();const o=i.trim();if(o){if(!p.trim()){f("Mot de passe requis."),L.current?.focus();return}C(!0),f(null);try{const{data:t,error:m}=await q.auth.signInWithPassword({email:o,password:p});if(m)throw new Error(U(m.message));if(!t.session)throw new Error("Session non reçue.");if(D(t.session),!await F())throw new Error("Impossible de récupérer le profil utilisateur.");const _=V.getState().role;A(me(_),{replace:!0})}catch(t){const m=t instanceof Error?t.message:"Connexion impossible.";f(m)}finally{C(!1)}}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-[-20%] right-[-10%] w-[600px] h-[600px] bg-primary/10 rounded-full blur-3xl pointer-events-none"}),e.jsxs(J,{className:"w-full max-w-sm relative z-10 shadow-2xl border-t-8 border-t-primary animate-in fade-in zoom-in duration-500 motion-reduce:animate-none",children:[e.jsxs(Y,{className:"text-center pb-2",children:[e.jsx("div",{className:"mx-auto mb-6 h-24 w-24 rounded-full bg-foreground flex items-center justify-center border-4 border-primary shadow-lg",children:e.jsx("img",{src:Q,alt:"EAC Logo",className:"h-full w-full object-cover rounded-full opacity-90"})}),e.jsxs(Z,{className:"text-3xl font-display italic uppercase tracking-tighter",children:["SUIVI",e.jsx("span",{className:"text-primary",children:"NATATION"})]}),e.jsx($,{className:"uppercase tracking-widest text-xs font-bold",children:"Erstein Aquatic Club"})]}),e.jsx(ee,{children:e.jsxs("form",{onSubmit:H,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"login-email",className:"sr-only",children:"Email"}),e.jsx(c,{id:"login-email","aria-label":"Email",placeholder:"Email",type:"email",value:i,onChange:r=>{P(r.target.value),n&&g(!1)},className:"text-center text-lg h-12 border-2 focus-visible:ring-primary",autoFocus:!0}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Saisissez votre email et votre mot de passe."}),e.jsx(l,{htmlFor:"login-password",className:"sr-only",children:"Mot de passe"}),e.jsx(c,{id:"login-password","aria-label":"Mot de passe",placeholder:"Mot de passe",type:"password",value:p,onChange:r=>B(r.target.value),ref:L,className:"text-center text-lg h-12 border-2 focus-visible:ring-primary"}),w?e.jsx("div",{className:"rounded-lg border border-destructive/20 bg-destructive/10 p-3 text-sm text-destructive text-center",children:w}):null]}),e.jsx(M,{type:"submit",className:"w-full h-12 text-lg font-bold uppercase tracking-wider shadow-md hover:scale-[1.02] transition-transform",disabled:!i.trim()||!p.trim()||N,children:N?"Connexion...":"CONNEXION"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",onClick:()=>{g(!0);const r=i.trim();S(r)},className:"text-xs text-muted-foreground underline underline-offset-4 transition-colors hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2",children:"Créer un compte"})})]})})]}),e.jsx(re,{open:n,onOpenChange:r=>{g(r),r||(a(null),E(""),I(""),v(""))},children:e.jsxs(se,{className:"sm:max-w-md",children:[e.jsxs(te,{children:[e.jsx(ae,{children:"Créer un compte"}),e.jsx(ie,{children:"Complétez les informations pour créer votre profil."})]}),e.jsxs("form",{className:"space-y-4",onSubmit:async r=>{if(r.preventDefault(),!h.trim()){a("Ajoutez votre nom.");return}if(!x.trim()){a("Ajoutez votre email.");return}if(!d){a("Sélectionnez un groupe.");return}if(!j){a("Ajoutez votre date de naissance.");return}if(!b){a("Choisissez un mot de passe.");return}a(null),y(!0);try{const{data:o,error:t}=await q.auth.signUp({email:x.trim(),password:b,options:{data:{display_name:h.trim(),birthdate:j,group_id:Number(d)}}});if(t)throw new Error(t.message);if(!o.session){a("Compte créé. Vérifiez votre email pour confirmer votre inscription."),y(!1);return}if(D(o.session),!await F())throw new Error("Impossible de récupérer le profil utilisateur.");g(!1),A("/",{replace:!0})}catch(o){const t=o instanceof Error?o.message:"Création impossible.";a(t)}finally{y(!1)}},children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"register-name",children:"Nom d'affichage"}),e.jsx(c,{id:"register-name",value:h,onChange:r=>G(r.target.value),placeholder:"Votre nom",ref:k})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"register-email",children:"Email"}),e.jsx(c,{id:"register-email",type:"email",value:x,onChange:r=>S(r.target.value),placeholder:"prenom.nom@email.com",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"register-birthdate",children:"Date de naissance"}),e.jsx(c,{id:"register-birthdate",type:"date",value:j,onChange:r=>I(r.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Groupe"}),e.jsxs(oe,{value:d,onValueChange:v,disabled:T||u.length===0,children:[e.jsx(ne,{children:e.jsx(le,{placeholder:T?"Chargement...":O?"Erreur de chargement":"Sélectionnez un groupe"})}),e.jsx(ce,{children:u.map(r=>e.jsx(de,{value:String(r.id),children:r.name},r.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"register-password",children:"Mot de passe"}),e.jsx(c,{id:"register-password",type:"password",value:b,onChange:r=>E(r.target.value),placeholder:"Choisissez un mot de passe"})]}),R?e.jsx("p",{className:"text-sm text-destructive",children:R}):null,e.jsx(M,{type:"submit",className:"w-full",disabled:z||!h.trim(),children:z?"Création...":"Créer le compte"})]})]})}),e.jsx("div",{className:"absolute bottom-4 text-xs text-muted-foreground opacity-50 uppercase font-bold tracking-widest",children:"EAC Performance Tracking"})]})}export{Re as default};
