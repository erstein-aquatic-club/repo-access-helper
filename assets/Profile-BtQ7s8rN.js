import{r as d,j as e,g as pe,h as k}from"./vendor-ui-C9ymspZo.js";import{h as fe,r as xe,t as he,k as M,u as je,i as ge,C,b as _,f as F,B as b,L as j,I as y,o as ve,c as E,d as I,j as Ne,g as P}from"./index-CMwkteNF.js";import{b as be,u as H,c as R}from"./vendor-query-kM2vrB_e.js";import{T as we}from"./textarea-zH7tUr7L.js";import{S as Se,a as ye,b as Ce,c as _e,d as Fe}from"./select-DnkUOUCr.js";import{S as f}from"./skeleton-BPWQVQTV.js";import{C as Pe}from"./circle-alert-CxTvPpY0.js";import{P as Le,S as Ae}from"./save-C0duJB2F.js";import{R as Ee}from"./refresh-cw-C0J1CQAC.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-DSuxWnoS.js";import"./vendor-supabase-B2MyMyC0.js";import"./chevron-up-BonayVPE.js";import"./check-BrYunlGc.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Re=fe("log-out",Ie);function ke(s,t=[]){let i=[];function o(a,c){const l=d.createContext(c);l.displayName=a+"Context";const m=i.length;i=[...i,c];const x=h=>{const{scope:w,children:S,...N}=h,p=w?.[s]?.[m]||l,v=d.useMemo(()=>N,Object.values(N));return e.jsx(p.Provider,{value:v,children:S})};x.displayName=a+"Provider";function g(h,w){const S=w?.[s]?.[m]||l,N=d.useContext(S);if(N)return N;if(c!==void 0)return c;throw new Error(`\`${h}\` must be used within \`${a}\``)}return[x,g]}const n=()=>{const a=i.map(c=>d.createContext(c));return function(l){const m=l?.[s]||a;return d.useMemo(()=>({[`__scope${s}`]:{...l,[s]:m}}),[l,m])}};return n.scopeName=s,[o,Me(n,...t)]}function Me(...s){const t=s[0];if(s.length===1)return t;const i=()=>{const o=s.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(a){const c=o.reduce((l,{useScope:m,scopeName:x})=>{const h=m(a)[`__scope${x}`];return{...l,...h}},{});return d.useMemo(()=>({[`__scope${t.scopeName}`]:c}),[c])}};return i.scopeName=t.scopeName,i}var $e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],$=$e.reduce((s,t)=>{const i=xe(`Primitive.${t}`),o=d.forwardRef((n,a)=>{const{asChild:c,...l}=n,m=c?i:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(m,{...l,ref:a})});return o.displayName=`Primitive.${t}`,{...s,[t]:o}},{});function Ue(){return he.useSyncExternalStore(qe,()=>!0,()=>!1)}function qe(){return()=>{}}var U="Avatar",[Te]=ke(U),[Be,G]=Te(U),K=d.forwardRef((s,t)=>{const{__scopeAvatar:i,...o}=s,[n,a]=d.useState("idle");return e.jsx(Be,{scope:i,imageLoadingStatus:n,onImageLoadingStatusChange:a,children:e.jsx($.span,{...o,ref:t})})});K.displayName=U;var V="AvatarImage",O=d.forwardRef((s,t)=>{const{__scopeAvatar:i,src:o,onLoadingStatusChange:n=()=>{},...a}=s,c=G(V,i),l=De(o,a),m=pe(x=>{n(x),c.onImageLoadingStatusChange(x)});return k(()=>{l!=="idle"&&m(l)},[l,m]),l==="loaded"?e.jsx($.img,{...a,ref:t,src:o}):null});O.displayName=V;var Q="AvatarFallback",W=d.forwardRef((s,t)=>{const{__scopeAvatar:i,delayMs:o,...n}=s,a=G(Q,i),[c,l]=d.useState(o===void 0);return d.useEffect(()=>{if(o!==void 0){const m=window.setTimeout(()=>l(!0),o);return()=>window.clearTimeout(m)}},[o]),c&&a.imageLoadingStatus!=="loaded"?e.jsx($.span,{...n,ref:t}):null});W.displayName=Q;function z(s,t){return s?t?(s.src!==t&&(s.src=t),s.complete&&s.naturalWidth>0?"loaded":"loading"):"error":"idle"}function De(s,{referrerPolicy:t,crossOrigin:i}){const o=Ue(),n=d.useRef(null),a=o?(n.current||(n.current=new window.Image),n.current):null,[c,l]=d.useState(()=>z(a,s));return k(()=>{l(z(a,s))},[a,s]),k(()=>{const m=h=>()=>{l(h)};if(!a)return;const x=m("loaded"),g=m("error");return a.addEventListener("load",x),a.addEventListener("error",g),t&&(a.referrerPolicy=t),typeof i=="string"&&(a.crossOrigin=i),()=>{a.removeEventListener("load",x),a.removeEventListener("error",g)}},[a,i,t]),c}var J=K,X=O,Y=W;const Z=d.forwardRef(({className:s,...t},i)=>e.jsx(J,{ref:i,className:M("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...t}));Z.displayName=J.displayName;const ee=d.forwardRef(({className:s,...t},i)=>e.jsx(X,{ref:i,className:M("aspect-square h-full w-full",s),...t}));ee.displayName=X.displayName;const se=d.forwardRef(({className:s,...t},i)=>e.jsx(Y,{ref:i,className:M("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...t}));se.displayName=Y.displayName;const He=s=>s!=="coach"&&s!=="admin"&&s!=="comite",ze=s=>{switch(s){case"coach":return"Entraineur EAC";case"admin":return"Admin";case"comite":return"Comité";default:return"Nageur"}};function Ge(s){if(!s)return"-";const t=new Date(s);return Number.isNaN(t.getTime())?s:t.toLocaleDateString("fr-FR")}function is(){const{user:s,userId:t,logout:i,role:o}=je(),{toast:n}=ge(),a=be(),c=He(o),l=o==="athlete"||o==="coach"||o==="admin",m=ze(o),[x,g]=d.useState(!1),[h,w]=d.useState(""),[S,N]=d.useState(""),[p,v]=d.useState({group_id:"",objectives:"",bio:"",avatar_url:"",birthdate:"",ffn_iuf:""}),{data:u,isLoading:re,error:te,refetch:ae}=H({queryKey:["profile",s,t],queryFn:()=>P.getProfile({displayName:s,userId:t}),enabled:!!s}),{data:q=[],isLoading:T,error:ie,refetch:ne}=H({queryKey:["profile-groups"],queryFn:()=>P.getGroups(),enabled:!!s}),B=te||ie,oe=()=>{ae(),ne()},ce=d.useMemo(()=>{const r=u?.avatar_url;return r||(s?`https://api.dicebear.com/7.x/initials/svg?seed=${encodeURIComponent(s)}`:"")},[u,s]),A=R({mutationFn:r=>P.updateProfile({userId:t,profile:{group_id:r.group_id?Number(r.group_id):null,birthdate:r.birthdate||null,objectives:r.objectives,bio:r.bio,avatar_url:r.avatar_url,ffn_iuf:(r.ffn_iuf||"").trim()||null}}),onSuccess:()=>{a.invalidateQueries({queryKey:["profile"]}),g(!1),n({title:"Profil mis à jour"})},onError:r=>{n({title:"Mise à jour impossible",description:String(r?.message||r),variant:"destructive"})}}),D=R({mutationFn:r=>P.authPasswordUpdate(r),onSuccess:()=>{w(""),N(""),n({title:"Mot de passe mis à jour"})},onError:r=>{n({title:"Mise à jour impossible",description:String(r?.message||r),variant:"destructive"})}}),L=R({mutationFn:async()=>{const r=String(u?.ffn_iuf??"").trim();if(!r)throw new Error("IUF FFN manquant. Ajoutez-le dans votre profil.");return P.syncFfnSwimRecords({athleteId:t??void 0,athleteName:s??void 0,iuf:r})},onSuccess:r=>{a.invalidateQueries({queryKey:["swim-records"]}),n({title:"Records FFN importés",description:`${r?.inserted??0} ajouté(s), ${r?.updated??0} mis à jour, ${r?.skipped??0} inchangé(s)`})},onError:r=>{n({title:"Import FFN impossible",description:String(r?.message||r),variant:"destructive"})}}),le=()=>{v({group_id:u?.group_id?String(u.group_id):"",objectives:u?.objectives||"",bio:u?.bio||"",avatar_url:u?.avatar_url||"",birthdate:u?.birthdate?String(u.birthdate).split("T")[0]:"",ffn_iuf:u?.ffn_iuf?String(u.ffn_iuf):""}),g(!0)},de=()=>A.mutate(p),ue=()=>{if(!h||h.length<6){n({title:"Mot de passe invalide",description:"Minimum 6 caractères.",variant:"destructive"});return}if(h!==S){n({title:"Mot de passe invalide",description:"Les mots de passe ne correspondent pas.",variant:"destructive"});return}D.mutate({password:h})},me=q.find(r=>r.id===u?.group_id)?.name||u?.group_label||"Non défini";return re?e.jsxs("div",{className:"space-y-6",children:[e.jsx(f,{className:"h-10 w-32"}),e.jsxs(C,{children:[e.jsx(_,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(f,{className:"h-16 w-16 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{className:"h-6 w-32"}),e.jsx(f,{className:"h-4 w-24"})]})]})}),e.jsx(F,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{className:"h-4 w-16"}),e.jsx(f,{className:"h-5 w-24"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{className:"h-4 w-24"}),e.jsx(f,{className:"h-5 w-20"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{className:"h-4 w-20"}),e.jsx(f,{className:"h-5 w-28"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{className:"h-4 w-16"}),e.jsx(f,{className:"h-5 w-32"})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(f,{className:"h-4 w-12"}),e.jsx(f,{className:"h-12 w-full"})]})]})})]})]}):B?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(Pe,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:B.message}),e.jsx(b,{onClick:()=>oe(),className:"mt-4",children:"Réessayer"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Profil"}),e.jsxs(C,{children:[e.jsxs(_,{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(Z,{className:"h-16 w-16",children:[e.jsx(ee,{src:ce,alt:s||"Profil"}),e.jsx(se,{children:(s||"?").slice(0,2).toUpperCase()})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xl font-semibold truncate",children:s}),e.jsx("p",{className:"text-sm text-muted-foreground uppercase font-bold tracking-wider",children:m})]})]}),!x&&e.jsx(b,{variant:"ghost",size:"icon",className:"absolute top-4 right-4",onClick:le,"aria-label":"Modifier le profil",children:e.jsx(Le,{className:"h-4 w-4"})})]}),e.jsx(F,{className:"space-y-4",children:x?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{children:"Groupe"}),e.jsxs(Se,{value:p.group_id,onValueChange:r=>v({...p,group_id:r}),disabled:T,children:[e.jsx(ye,{children:e.jsx(Ce,{placeholder:T?"Chargement...":"Choisir un groupe"})}),e.jsx(_e,{children:q.map(r=>e.jsx(Fe,{value:String(r.id),children:r.name},r.id))})]})]}),c?e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{children:"IUF FFN"}),e.jsx(y,{value:p.ffn_iuf,onChange:r=>v({...p,ffn_iuf:r.target.value}),placeholder:"879576",inputMode:"numeric"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Identifiant unique FFN (utilisé pour importer vos records compétition)."})]}):null,e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{children:"Objectifs"}),e.jsx(y,{value:p.objectives,onChange:r=>v({...p,objectives:r.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{children:"Bio"}),e.jsx(we,{value:p.bio,onChange:r=>v({...p,bio:r.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{children:"Avatar (URL)"}),e.jsx(y,{value:p.avatar_url,onChange:r=>v({...p,avatar_url:r.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{children:"Date de naissance"}),e.jsx(y,{type:"date",value:p.birthdate,onChange:r=>v({...p,birthdate:r.target.value})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{onClick:de,disabled:A.isPending,className:"w-full",children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),"Enregistrer"]}),e.jsx(b,{variant:"outline",onClick:()=>g(!1),disabled:A.isPending,children:"Annuler"})]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx(j,{className:"text-xs text-muted-foreground uppercase",children:"Groupe"}),e.jsx("div",{className:"font-medium",children:me})]}),e.jsxs("div",{children:[e.jsx(j,{className:"text-xs text-muted-foreground uppercase",children:"Date de naissance"}),e.jsx("div",{className:"font-medium",children:Ge(u?.birthdate??null)})]}),c?e.jsxs("div",{children:[e.jsx(j,{className:"text-xs text-muted-foreground uppercase",children:"IUF FFN"}),e.jsx("div",{className:"font-medium",children:String(u?.ffn_iuf??"")||"Non renseigné"})]}):null,e.jsxs("div",{className:c?"":"col-span-2",children:[e.jsx(j,{className:"text-xs text-muted-foreground uppercase",children:"Objectifs"}),e.jsx("div",{className:"font-medium",children:u?.objectives||"Aucun objectif défini."})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(j,{className:"text-xs text-muted-foreground uppercase",children:"Bio"}),e.jsx("div",{className:"font-medium",children:u?.bio||"Non renseignée."})]})]})}),e.jsx(ve,{className:"flex justify-end",children:e.jsxs(b,{variant:"outline",onClick:i,className:"gap-2",children:[e.jsx(Re,{className:"h-4 w-4"}),"Se déconnecter"]})})]}),c?e.jsxs(C,{children:[e.jsxs(_,{children:[e.jsx(E,{children:"FFN"}),e.jsx(I,{children:"Importer vos records compétition depuis Extranat."})]}),e.jsxs(F,{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["IUF enregistré : ",e.jsx("span",{className:"font-medium text-foreground",children:String(u?.ffn_iuf??"")||"—"})]}),e.jsxs(b,{className:"w-full gap-2",onClick:()=>L.mutate(),disabled:L.isPending||!String(u?.ffn_iuf??"").trim(),children:[e.jsx(Ee,{className:["h-4 w-4",L.isPending?"animate-spin":""].join(" ")}),L.isPending?"Import en cours...":"Récupérer records depuis FFN"]}),String(u?.ffn_iuf??"").trim()?null:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ajoutez votre IUF FFN dans le profil (bouton crayon) pour activer l’import."})]})]}):null,l?e.jsxs(C,{children:[e.jsxs(_,{children:[e.jsx(E,{children:"Mot de passe"}),e.jsx(I,{children:"Modifiez votre mot de passe."})]}),e.jsxs(F,{className:"space-y-3",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{children:"Nouveau mot de passe"}),e.jsx(y,{type:"password",value:h,onChange:r=>w(r.target.value),placeholder:"••••••••"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(j,{children:"Confirmer"}),e.jsx(y,{type:"password",value:S,onChange:r=>N(r.target.value),placeholder:"••••••••"})]}),e.jsx(b,{className:"w-full",onClick:ue,disabled:D.isPending,children:"Mettre à jour le mot de passe"})]})]}):null,c?e.jsxs(C,{children:[e.jsxs(_,{children:[e.jsx(E,{children:"Records"}),e.jsx(I,{children:"Consultez vos records de natation et musculation."})]}),e.jsx(F,{children:e.jsx(Ne,{href:"/records",children:e.jsx(b,{asChild:!0,children:e.jsx("a",{children:"Voir mes records"})})})})]}):null]})}export{is as default,ze as getRoleLabel,He as shouldShowRecords};
