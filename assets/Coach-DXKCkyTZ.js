const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StrengthCatalog-XbLVsuGv.js","assets/vendor-query-BiSH4r2z.js","assets/vendor-react-BzrpNAyj.js","assets/api-CFuaNslW.js","assets/index-DPr5u6nH.js","assets/vendor-supabase-6k692oZB.js","assets/index-BRMnPGUj.css","assets/index-D6pHXUde.js","assets/index-C_q2iuFQ.js","assets/index-CIe4j-wy.js","assets/select-dZ9RoDal.js","assets/index-DFYKZZ72.js","assets/chevron-down-dKzR1nNt.js","assets/check-DS9hr70L.js","assets/CalendarGrid-DS0en1tO.js","assets/chevron-left-BFYZ6m-n.js","assets/chevron-right-8l17NyjX.js","assets/textarea-BrqDZ6Y7.js","assets/dialog-Btpczrwg.js","assets/index-NXNp0fzN.js","assets/checkbox-Daxwnc1_.js","assets/alert-dialog-B1VZuDDu.js","assets/tabs-B6Xdk0Ml.js","assets/SessionListView-CPUs00Zo.js","assets/circle-alert-AYQFgFc5.js","assets/pencil-DwRQFVVP.js","assets/drawer-BLwMcg0O.js","assets/search-DSYYEeHj.js","assets/plus-BBgqH3N8.js","assets/loader-circle-D0vjbK1N.js","assets/pen-Ct_Q0iSX.js","assets/badge-EgvwRMXF.js","assets/toggle-group-BP7RxdxD.js","assets/sheet-9bKNCI3a.js","assets/SwimCatalog-7QXSM_8C.js","assets/SwimSessionTimeline-DEyhRDzD.js","assets/eye-vFB89TqR.js","assets/clock-h6lnaitq.js","assets/format-B9mPVj_w.js","assets/timer-DfT_g0Dh.js"])))=>i.map(i=>d[i]);
import{c as ne,B as T,l as ss,m as ts,n as De,R as ns,o as as,p as Re,P as Oe,A as Ie,q as Fe,r as rs,t as os,v as is,w as ls,a as cs,d as be,C as le,h as ce,j as de,x as ue,g as me,L as Q,I as je,W as Ee,D as Te,y as ds,u as _e,b as us,U as ye,z as ke,E as ms,k as ps,_ as $e}from"./index-DPr5u6nH.js";import{j as e,r as o,R as hs,d as he,u as Z,c as ze}from"./vendor-query-BiSH4r2z.js";import{a as I}from"./api-CFuaNslW.js";import{B as gs}from"./badge-EgvwRMXF.js";import{T as Le,a as oe}from"./toggle-group-BP7RxdxD.js";import{C as xs}from"./checkbox-Daxwnc1_.js";import{h as fs,R as vs,u as js,F as ys}from"./index-DFYKZZ72.js";import{u as bs}from"./index-CIe4j-wy.js";import{S as B,a as K,b as G,c as H,d as A}from"./select-dZ9RoDal.js";import{C as Ns}from"./chevron-down-dKzR1nNt.js";import{a as Cs,b as Ss,T as ws}from"./CalendarGrid-DS0en1tO.js";import{S as _s,a as ks,b as Ps,c as Ms,d as As}from"./sheet-9bKNCI3a.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Rs=ne("arrow-left",Ds);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],ge=ne("bell",Os);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],Fs=ne("calendar-days",Is);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Ts=ne("external-link",Es);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],zs=ne("heart-pulse",$s);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Ne=ne("mail",Ls),se=({title:s,description:r,onBack:i,actions:n})=>e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(T,{variant:"ghost",size:"sm",className:"-ml-2",onClick:i,children:[e.jsx(Rs,{className:"mr-2 h-4 w-4"}),"Retour à l'accueil"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:s}),r?e.jsx("p",{className:"text-sm text-muted-foreground",children:r}):null]}),n?e.jsx("div",{className:"flex items-center gap-2",children:n}):null]});function ie(s,r,{checkForDefaultPrevented:i=!0}={}){return function(a){if(s?.(a),i===!1||!a.defaultPrevented)return r?.(a)}}function qs(s){const r=Vs(s),i=o.forwardRef((n,a)=>{const{children:l,...u}=n,c=o.Children.toArray(l),b=c.find(Ks);if(b){const v=b.props.children,g=c.map(f=>f===b?o.Children.count(v)>1?o.Children.only(null):o.isValidElement(v)?v.props.children:null:f);return e.jsx(r,{...u,ref:a,children:o.isValidElement(v)?o.cloneElement(v,void 0,g):null})}return e.jsx(r,{...u,ref:a,children:l})});return i.displayName=`${s}.Slot`,i}function Vs(s){const r=o.forwardRef((i,n)=>{const{children:a,...l}=i;if(o.isValidElement(a)){const u=Hs(a),c=Gs(l,a.props);return a.type!==o.Fragment&&(c.ref=n?ss(n,u):u),o.cloneElement(a,c)}return o.Children.count(a)>1?o.Children.only(null):null});return r.displayName=`${s}.SlotClone`,r}var Bs=Symbol("radix.slottable");function Ks(s){return o.isValidElement(s)&&typeof s.type=="function"&&"__radixId"in s.type&&s.type.__radixId===Bs}function Gs(s,r){const i={...r};for(const n in r){const a=s[n],l=r[n];/^on[A-Z]/.test(n)?a&&l?i[n]=(...c)=>{const b=l(...c);return a(...c),b}:a&&(i[n]=a):n==="style"?i[n]={...a,...l}:n==="className"&&(i[n]=[a,l].filter(Boolean).join(" "))}return{...s,...i}}function Hs(s){let r=Object.getOwnPropertyDescriptor(s.props,"ref")?.get,i=r&&"isReactWarning"in r&&r.isReactWarning;return i?s.ref:(r=Object.getOwnPropertyDescriptor(s,"ref")?.get,i=r&&"isReactWarning"in r&&r.isReactWarning,i?s.props.ref:s.props.ref||s.ref)}var Us=hs[" useInsertionEffect ".trim().toString()]||ts;function Ws({prop:s,defaultProp:r,onChange:i=()=>{},caller:n}){const[a,l,u]=Qs({defaultProp:r,onChange:i}),c=s!==void 0,b=c?s:a;{const g=o.useRef(s!==void 0);o.useEffect(()=>{const f=g.current;f!==c&&console.warn(`${n} is changing from ${f?"controlled":"uncontrolled"} to ${c?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),g.current=c},[c,n])}const v=o.useCallback(g=>{if(c){const f=Ys(g)?g(s):g;f!==s&&u.current?.(f)}else l(g)},[c,s,l,u]);return[b,v]}function Qs({defaultProp:s,onChange:r}){const[i,n]=o.useState(s),a=o.useRef(i),l=o.useRef(r);return Us(()=>{l.current=r},[r]),o.useEffect(()=>{a.current!==i&&(l.current?.(i),a.current=i)},[i,a]),[i,n,l]}function Ys(s){return typeof s=="function"}var xe="Popover",[qe]=as(xe,[De]),pe=De(),[Js,Y]=qe(xe),Ve=s=>{const{__scopePopover:r,children:i,open:n,defaultOpen:a,onOpenChange:l,modal:u=!1}=s,c=pe(r),b=o.useRef(null),[v,g]=o.useState(!1),[f,j]=Ws({prop:n,defaultProp:a??!1,onChange:l,caller:xe});return e.jsx(ns,{...c,children:e.jsx(Js,{scope:r,contentId:bs(),triggerRef:b,open:f,onOpenChange:j,onOpenToggle:o.useCallback(()=>j(m=>!m),[j]),hasCustomAnchor:v,onCustomAnchorAdd:o.useCallback(()=>g(!0),[]),onCustomAnchorRemove:o.useCallback(()=>g(!1),[]),modal:u,children:i})})};Ve.displayName=xe;var Be="PopoverAnchor",Zs=o.forwardRef((s,r)=>{const{__scopePopover:i,...n}=s,a=Y(Be,i),l=pe(i),{onCustomAnchorAdd:u,onCustomAnchorRemove:c}=a;return o.useEffect(()=>(u(),()=>c()),[u,c]),e.jsx(Ie,{...l,...n,ref:r})});Zs.displayName=Be;var Ke="PopoverTrigger",Ge=o.forwardRef((s,r)=>{const{__scopePopover:i,...n}=s,a=Y(Ke,i),l=pe(i),u=Re(r,a.triggerRef),c=e.jsx(Oe.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":Ye(a.open),...n,ref:u,onClick:ie(s.onClick,a.onOpenToggle)});return a.hasCustomAnchor?c:e.jsx(Ie,{asChild:!0,...l,children:c})});Ge.displayName=Ke;var Ce="PopoverPortal",[Xs,et]=qe(Ce,{forceMount:void 0}),He=s=>{const{__scopePopover:r,forceMount:i,children:n,container:a}=s,l=Y(Ce,r);return e.jsx(Xs,{scope:r,forceMount:i,children:e.jsx(Fe,{present:i||l.open,children:e.jsx(rs,{asChild:!0,container:a,children:n})})})};He.displayName=Ce;var te="PopoverContent",Ue=o.forwardRef((s,r)=>{const i=et(te,s.__scopePopover),{forceMount:n=i.forceMount,...a}=s,l=Y(te,s.__scopePopover);return e.jsx(Fe,{present:n||l.open,children:l.modal?e.jsx(tt,{...a,ref:r}):e.jsx(nt,{...a,ref:r})})});Ue.displayName=te;var st=qs("PopoverContent.RemoveScroll"),tt=o.forwardRef((s,r)=>{const i=Y(te,s.__scopePopover),n=o.useRef(null),a=Re(r,n),l=o.useRef(!1);return o.useEffect(()=>{const u=n.current;if(u)return fs(u)},[]),e.jsx(vs,{as:st,allowPinchZoom:!0,children:e.jsx(We,{...s,ref:a,trapFocus:i.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ie(s.onCloseAutoFocus,u=>{u.preventDefault(),l.current||i.triggerRef.current?.focus()}),onPointerDownOutside:ie(s.onPointerDownOutside,u=>{const c=u.detail.originalEvent,b=c.button===0&&c.ctrlKey===!0,v=c.button===2||b;l.current=v},{checkForDefaultPrevented:!1}),onFocusOutside:ie(s.onFocusOutside,u=>u.preventDefault(),{checkForDefaultPrevented:!1})})})}),nt=o.forwardRef((s,r)=>{const i=Y(te,s.__scopePopover),n=o.useRef(!1),a=o.useRef(!1);return e.jsx(We,{...s,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:l=>{s.onCloseAutoFocus?.(l),l.defaultPrevented||(n.current||i.triggerRef.current?.focus(),l.preventDefault()),n.current=!1,a.current=!1},onInteractOutside:l=>{s.onInteractOutside?.(l),l.defaultPrevented||(n.current=!0,l.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const u=l.target;i.triggerRef.current?.contains(u)&&l.preventDefault(),l.detail.originalEvent.type==="focusin"&&a.current&&l.preventDefault()}})}),We=o.forwardRef((s,r)=>{const{__scopePopover:i,trapFocus:n,onOpenAutoFocus:a,onCloseAutoFocus:l,disableOutsidePointerEvents:u,onEscapeKeyDown:c,onPointerDownOutside:b,onFocusOutside:v,onInteractOutside:g,...f}=s,j=Y(te,i),m=pe(i);return js(),e.jsx(ys,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:a,onUnmountAutoFocus:l,children:e.jsx(os,{asChild:!0,disableOutsidePointerEvents:u,onInteractOutside:g,onEscapeKeyDown:c,onPointerDownOutside:b,onFocusOutside:v,onDismiss:()=>j.onOpenChange(!1),children:e.jsx(is,{"data-state":Ye(j.open),role:"dialog",id:j.contentId,...m,...f,ref:r,style:{...f.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Qe="PopoverClose",at=o.forwardRef((s,r)=>{const{__scopePopover:i,...n}=s,a=Y(Qe,i);return e.jsx(Oe.button,{type:"button",...n,ref:r,onClick:ie(s.onClick,()=>a.onOpenChange(!1))})});at.displayName=Qe;var rt="PopoverArrow",ot=o.forwardRef((s,r)=>{const{__scopePopover:i,...n}=s,a=pe(i);return e.jsx(ls,{...a,...n,ref:r})});ot.displayName=rt;function Ye(s){return s?"open":"closed"}var it=Ve,lt=Ge,ct=He,Je=Ue;const dt=it,ut=lt,Ze=o.forwardRef(({className:s,align:r="center",sideOffset:i=4,...n},a)=>e.jsx(ct,{children:e.jsx(Je,{ref:a,align:r,sideOffset:i,className:cs("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",s),...n})}));Ze.displayName=Je.displayName;const mt=({onBack:s,swimSessions:r,strengthSessions:i,athletes:n,groups:a})=>{const{toast:l}=be(),[u,c]=o.useState({session_type:"swim",session_id:"",assigned_date:new Date().toISOString().split("T")[0],assigned_slot:"morning"}),[b,v]=o.useState(!1),[g,f]=o.useState("user"),[j,m]=o.useState(""),[d,C]=o.useState([]),E=t=>{const y=typeof t=="number"?t:Number(t);return Number.isFinite(y)&&y>0?y:null},M=o.useMemo(()=>n.map(t=>({value:t.id?`id:${t.id}`:`name:${t.display_name}`,label:t.group_label?`${t.display_name} · ${t.group_label}`:t.display_name,id:t.id,name:t.display_name})),[n]),w=o.useMemo(()=>new Map(M.map(t=>[t.value,t])),[M]),$=o.useMemo(()=>a.map(t=>{const y=E(t.id);return y?{...t,gid:y}:null}).filter(t=>!!t),[a]),F=o.useMemo(()=>$.filter(t=>d.includes(t.gid)),[$,d]),V=o.useMemo(()=>{if(F.length===0)return"Choisir des groupes";const t=F.slice(0,2).map(D=>D.name).join(", "),y=F.length>2?` +${F.length-2}`:"";return`${t}${y}`},[F]),z=he({mutationFn:async t=>I.assignments_create(t),onSuccess:()=>{l({title:"Séance assignée & notifiée"})},onError:t=>{const y="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",D=t instanceof Error?t.message:typeof t=="string"?t:y;let R=D;const h=D.match(/HTTP \d+:\s*(\{.*\})/);if(h)try{R=JSON.parse(h[1])?.error||y}catch{R=y}l({title:"Erreur d'assignation",description:R})}}),J=async()=>{const t=Number(u.session_id);if(!Number.isInteger(t)||t<=0){l({title:"Séance invalide",description:"Sélectionnez une séance valide."});return}if(g==="group"){if(d.length===0){l({title:"Groupe manquant",description:"Sélectionnez au moins un groupe."});return}v(!0);try{const N={assignment_type:u.session_type,session_id:t,scheduled_date:u.assigned_date,scheduled_slot:u.assigned_slot},S=Array.from(new Set(d));await Promise.all(S.map(x=>I.assignments_create({...N,target_group_id:x}))),l({title:"Séance assignée & notifiée"})}catch(N){const S="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",x=N instanceof Error?N.message:typeof N=="string"?N:S;let k=x;const L=x.match(/HTTP \d+:\s*(\{.*\})/);if(L)try{k=JSON.parse(L[1])?.error||S}catch{k=S}l({title:"Erreur d'assignation",description:k})}finally{v(!1)}return}const y=j.trim();if(!y){l({title:"Nageur manquant",description:"Sélectionnez un nageur."});return}const D=w.get(y),R=D?.id??(Number.isFinite(Number(y))&&Number(y)>0?Number(y):void 0);if(!Number.isFinite(R)||Number(R)<=0){l({title:"Nageur invalide",description:"Sélectionnez un nageur avec un identifiant valide."});return}const h=D?.name??y.replace(/^name:/,"");z.mutate({assignment_type:u.session_type,session_id:t,target_athlete:h,target_user_id:R,scheduled_date:u.assigned_date,scheduled_slot:u.assigned_slot})},U=!u.session_id||(g==="group"?d.length===0:!j.trim())||z.isPending||b;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(se,{title:"Assigner une séance",description:"Planifiez une séance pour un nageur ou un ou plusieurs groupes.",onBack:s}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(le,{className:"border-l-4 border-l-primary",children:[e.jsxs(ce,{children:[e.jsx(de,{children:"Séance"}),e.jsx(ue,{children:"Choisissez le type et la séance à envoyer."})]}),e.jsxs(me,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Type"}),e.jsxs(B,{value:u.session_type,onValueChange:t=>c({...u,session_type:t,session_id:""}),children:[e.jsx(K,{children:e.jsx(G,{})}),e.jsxs(H,{children:[e.jsx(A,{value:"swim",children:"Natation"}),e.jsx(A,{value:"strength",children:"Musculation"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Séance"}),e.jsxs(B,{value:u.session_id,onValueChange:t=>c({...u,session_id:t}),children:[e.jsx(K,{children:e.jsx(G,{placeholder:"Choisir..."})}),e.jsx(H,{children:u.session_type==="swim"?r?.map(t=>e.jsx(A,{value:t.id.toString(),children:t.name},t.id)):i?.map(t=>e.jsx(A,{value:t.id.toString(),children:t.title},t.id))})]})]})]})]}),e.jsxs(le,{children:[e.jsxs(ce,{children:[e.jsx(de,{children:"Cible & planification"}),e.jsx(ue,{children:"Définissez le destinataire, la date et le créneau."})]}),e.jsxs(me,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Cible"}),e.jsxs(B,{value:g,onValueChange:t=>{f(t),m(""),C([])},children:[e.jsx(K,{children:e.jsx(G,{})}),e.jsxs(H,{children:[e.jsx(A,{value:"user",children:"Nageur"}),e.jsx(A,{value:"group",children:"Groupe(s)"})]})]})]}),g==="user"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Nageur"}),M.length>0?e.jsxs(B,{value:j,onValueChange:m,children:[e.jsx(K,{children:e.jsx(G,{placeholder:"Choisir un nageur"})}),e.jsx(H,{children:M.map(t=>e.jsx(A,{value:t.value,children:t.label},t.value))})]}):e.jsx(je,{value:j,onChange:t=>m(t.target.value),placeholder:"ex: Camille"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Groupes"}),a.length>0?e.jsxs(dt,{children:[e.jsx(ut,{asChild:!0,children:e.jsxs(T,{type:"button",variant:"outline",className:"w-full justify-between","aria-label":"Sélection des groupes",children:[e.jsx("span",{className:"truncate",children:V}),e.jsx(Ns,{className:"ml-2 h-4 w-4 opacity-50"})]})}),e.jsxs(Ze,{className:"w-[--radix-popover-trigger-width] p-2",align:"start",children:[e.jsx("div",{className:"max-h-64 overflow-auto",children:e.jsx("div",{className:"space-y-1",children:$.map(t=>{const y=d.includes(t.gid);return e.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 hover:bg-muted",children:[e.jsx(xs,{checked:y,onCheckedChange:D=>{const R=D===!0;C(h=>R?h.includes(t.gid)?h:[...h,t.gid]:h.filter(N=>N!==t.gid))}}),e.jsx("span",{className:"text-sm",children:t.name})]},t.gid)})})}),d.length>0?e.jsx(T,{type:"button",variant:"ghost",size:"sm",className:"mt-2 w-full",onClick:()=>C([]),children:"Tout désélectionner"}):null]})]}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"Aucun groupe disponible."}),d.length>0?e.jsxs("div",{className:"text-xs text-muted-foreground",children:[d.length," groupe",d.length>1?"s":""," sélectionné",d.length>1?"s":"","."]}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Date"}),e.jsx(je,{type:"date",value:u.assigned_date,onChange:t=>c({...u,assigned_date:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Créneau"}),e.jsxs(B,{value:u.assigned_slot,onValueChange:t=>c({...u,assigned_slot:t}),children:[e.jsx(K,{children:e.jsx(G,{placeholder:"Choisir..."})}),e.jsxs(H,{children:[e.jsx(A,{value:"morning",children:"Matin"}),e.jsx(A,{value:"evening",children:"Soir"})]})]})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(T,{className:"w-full sm:w-auto",onClick:J,disabled:U,children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),z.isPending||b?"Assignation...":"Assigner & notifier"]})})]})},pt=({onBack:s,athletes:r,groups:i,athletesLoading:n})=>{const{toast:a}=be(),[l,u]=o.useState(""),[c,b]=o.useState(""),v=o.useMemo(()=>r.filter(d=>d.id&&d.email).map(d=>({value:`user:${d.id}`,label:d.group_label?`${d.display_name} · ${d.group_label}`:d.display_name,email:d.email})),[r]),g=o.useMemo(()=>i.map(d=>({value:`group:${d.id}`,label:d.name,id:d.id})),[i]),f=()=>{if(!c)return[];if(c.startsWith("user:")){const d=v.find(C=>C.value===c);return d?[d.email]:[]}if(c.startsWith("group:")){const d=Number(c.split(":")[1]);return r.filter(C=>C.group_id===d&&C.email).map(C=>C.email)}return[]},j=()=>{const d=f();if(!d.length){a({title:"Aucune adresse email",description:"Aucun nageur avec une adresse email dans cette sélection."});return}const C=new URLSearchParams;C.set("bcc",d.join(",")),l.trim()&&C.set("subject",l.trim()),window.location.href=`mailto:?${C.toString()}`},m=f();return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(se,{title:"Contacter par email",description:"Ouvre votre application mail avec les destinataires en CCI.",onBack:s}),e.jsxs(le,{className:"border-l-4 border-l-primary",children:[e.jsxs(ce,{children:[e.jsx(de,{children:"Destinataire"}),e.jsx(ue,{children:"Sélectionnez un nageur ou un groupe."})]}),e.jsxs(me,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Destinataire"}),e.jsxs(B,{value:c,onValueChange:b,children:[e.jsx(K,{children:e.jsx(G,{placeholder:n?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(H,{children:[g.length?e.jsxs(e.Fragment,{children:[e.jsx(A,{value:"section-group",disabled:!0,children:"Groupes"}),g.map(d=>e.jsx(A,{value:d.value,children:d.label},d.value))]}):null,v.length?e.jsxs(e.Fragment,{children:[e.jsx(A,{value:"section-athlete",disabled:!0,children:"Nageurs"}),v.map(d=>e.jsx(A,{value:d.value,children:d.label},d.value))]}):null]})]})]}),c&&m.length>0?e.jsxs("p",{className:"text-xs text-muted-foreground",children:[m.length," adresse",m.length>1?"s":""," email",m.length>1?" (envoi en CCI)":""]}):null,c&&m.length===0?e.jsx("p",{className:"text-xs text-destructive",children:"Aucune adresse email disponible pour cette sélection."}):null]})]}),e.jsxs(le,{children:[e.jsxs(ce,{children:[e.jsx(de,{children:"Objet"}),e.jsx(ue,{children:"Optionnel — pré-rempli dans votre application mail."})]}),e.jsx(me,{children:e.jsx(je,{value:l,onChange:d=>u(d.target.value),placeholder:"Objet du mail…"})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(T,{className:"w-full sm:w-auto",onClick:j,disabled:!c||m.length===0,children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Ouvrir dans l'app mail",e.jsx(Ts,{className:"ml-2 h-3 w-3"})]})})]})};function Pe(s){return String(s).padStart(2,"0")}function ee(s){return`${s.getFullYear()}-${Pe(s.getMonth()+1)}-${Pe(s.getDate())}`}function fe(s){return new Date(s.getFullYear(),s.getMonth(),1)}function Me(s,r){const i=new Date(s);return i.setDate(i.getDate()+r),i}function ht(s){return(s.getDay()+6)%7}function ve(s){if(!s)return"AM";const r=s.toLowerCase();return r==="evening"||r.includes("soir")||r==="pm"?"PM":"AM"}const gt=[{key:"swim-morning",label:"Nage — Matin",type:"swim",scheduledSlot:"morning"},{key:"swim-evening",label:"Nage — Soir",type:"swim",scheduledSlot:"evening"},{key:"strength",label:"Musculation",type:"strength",scheduledSlot:null}];function xt({groupId:s,userId:r,enabled:i}){const n=o.useMemo(()=>new Date,[]),[a,l]=o.useState(()=>fe(new Date)),[u,c]=o.useState(()=>ee(new Date)),[b,v]=o.useState(null),[g,f]=o.useState(!1),j=o.useMemo(()=>fe(a),[a]),m=o.useMemo(()=>{const h=ht(j),N=Me(j,-h),S=[];for(let x=0;x<42;x++)S.push(Me(N,x));return S},[j]),d=o.useMemo(()=>{const h=ee(m[0]),N=ee(m[m.length-1]);return{from:h,to:N}},[m]),C=!!(s||r),{data:E=[],isLoading:M}=Z({queryKey:["coach-calendar-assignments",s,r,d.from,d.to],queryFn:()=>I.getCoachAssignments({groupId:s??null,userId:r??null,from:d.from,to:d.to}),enabled:C}),w=o.useMemo(()=>{const h=new Map;for(const N of E){const S=N.scheduledDate?.slice(0,10);S&&(h.has(S)||h.set(S,[]),h.get(S).push(N))}return h},[E]),$=o.useMemo(()=>{const h={};for(const N of m){const S=ee(N),x=w.get(S)??[],k=x.some(O=>ve(O.scheduledSlot)==="AM"),L=x.some(O=>ve(O.scheduledSlot)==="PM"),p=(k?1:0)+(L?1:0),P=[{slotKey:"AM",expected:k,completed:k,absent:!1},{slotKey:"PM",expected:L,completed:L,absent:!1}];h[S]={completed:p,total:p,slots:P}}return h},[m,w]),F=o.useMemo(()=>{const[h,N,S]=u.split("-").map(Number);return new Date(h,N-1,S)},[u]),V=o.useMemo(()=>w.get(u)??[],[w,u]),z=o.useMemo(()=>{const h=V;return gt.map(N=>{const S=h.find(x=>N.type!==x.type?!1:N.type==="swim"?ve(x.scheduledSlot)===(N.scheduledSlot==="morning"?"AM":"PM"):!0);return{...N,assignment:S??null}})},[V]),J=o.useMemo(()=>{const h={};for(const N of m){const S=ee(N),x=w.get(S)??[];h[S]=x.some(k=>k.type==="strength")}return h},[m,w]),U=$[u]??{completed:0,total:0,slots:[{slotKey:"AM",expected:!1,completed:!1,absent:!1},{slotKey:"PM",expected:!1,completed:!1,absent:!1}]},t=o.useCallback(()=>{l(h=>new Date(h.getFullYear(),h.getMonth()-1,1))},[]),y=o.useCallback(()=>{l(h=>new Date(h.getFullYear(),h.getMonth()+1,1))},[]),D=o.useCallback(()=>{l(fe(new Date)),c(ee(new Date))},[]),R=o.useCallback(h=>{c(h),f(!0)},[]);return{today:n,monthCursor:a,selectedISO:u,selectedDayIndex:b,drawerOpen:g,gridDates:m,completionByISO:$,selectedDate:F,selectedDayStatus:U,assignmentsForSelectedDay:V,slotsForSelectedDay:z,hasStrengthByISO:J,isLoading:M,hasFilter:C,setSelectedISO:c,setSelectedDayIndex:v,setDrawerOpen:f,prevMonth:t,nextMonth:y,jumpToday:D,openDay:R}}function ft(s){const[r,i,n]=s.split("-").map(Number);return new Date(r,i-1,n).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})}function vt({onBack:s,athletes:r,groups:i,swimSessions:n,strengthSessions:a}){const[l,u]=o.useState("group"),[c,b]=o.useState(""),[v,g]=o.useState(""),f=l==="group"&&c?Number(c):null,j=l==="user"&&v?Number(v):null,{today:m,monthCursor:d,selectedISO:C,selectedDayIndex:E,drawerOpen:M,gridDates:w,completionByISO:$,selectedDayStatus:F,slotsForSelectedDay:V,hasStrengthByISO:z,hasFilter:J,setSelectedISO:U,setSelectedDayIndex:t,setDrawerOpen:y,prevMonth:D,nextMonth:R,jumpToday:h,openDay:N}=xt({groupId:f,userId:j,enabled:!0}),S=ze(),x=he({mutationFn:p=>I.assignments_create(p),onSuccess:()=>{S.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),k=he({mutationFn:p=>I.assignments_delete(p),onSuccess:()=>{S.invalidateQueries({queryKey:["coach-calendar-assignments"]})}}),L=(p,P)=>{let O=P;if(p.key==="ArrowLeft"&&(O=Math.max(0,P-1)),p.key==="ArrowRight"&&(O=Math.min(w.length-1,P+1)),p.key==="ArrowUp"&&(O=Math.max(0,P-7)),p.key==="ArrowDown"&&(O=Math.min(w.length-1,P+7)),O!==P){p.preventDefault(),t(O);const X=re=>String(re).padStart(2,"0"),q=w[O],ae=`${q.getFullYear()}-${X(q.getMonth()+1)}-${X(q.getDate())}`;U(ae)}if(p.key==="Enter"||p.key===" "){p.preventDefault();const X=re=>String(re).padStart(2,"0"),q=w[P],ae=`${q.getFullYear()}-${X(q.getMonth()+1)}-${X(q.getDate())}`;N(ae)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(se,{title:"Calendrier",description:"Vue mensuelle des assignations",onBack:s}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs(Le,{type:"single",value:l,onValueChange:p=>{(p==="group"||p==="user")&&u(p)},className:"shrink-0",children:[e.jsx(oe,{value:"group",className:"text-xs px-3",children:"Groupe"}),e.jsx(oe,{value:"user",className:"text-xs px-3",children:"Nageur"})]}),l==="group"?e.jsxs(B,{value:c,onValueChange:b,children:[e.jsx(K,{className:"w-full sm:w-56",children:e.jsx(G,{placeholder:"Choisir un groupe"})}),e.jsx(H,{children:i.map(p=>e.jsx(A,{value:String(p.id),children:p.name},String(p.id)))})]}):e.jsxs(B,{value:v,onValueChange:g,children:[e.jsx(K,{className:"w-full sm:w-56",children:e.jsx(G,{placeholder:"Choisir un nageur"})}),e.jsx(H,{children:r.filter(p=>p.id!=null).map(p=>e.jsxs(A,{value:String(p.id),children:[p.display_name,p.group_label?` · ${p.group_label}`:""]},String(p.id)))})]})]}),J?e.jsxs("div",{className:"rounded-2xl border bg-card shadow-sm",children:[e.jsx(Cs,{monthCursor:d,selectedDayStatus:F,onPrevMonth:D,onNextMonth:R,onJumpToday:h}),e.jsx(Ss,{monthCursor:d,gridDates:w,completionByISO:$,strengthByISO:z,selectedISO:C,selectedDayIndex:E,today:m,onDayClick:N,onKeyDown:L})]}):e.jsx("div",{className:"py-12 text-center text-sm text-muted-foreground",children:"Sélectionnez un groupe ou un nageur pour afficher le calendrier."}),e.jsx(_s,{open:M,onOpenChange:y,children:e.jsxs(ks,{side:"bottom",className:"max-h-[70vh] overflow-y-auto rounded-t-2xl",children:[e.jsxs(Ps,{className:"pb-3",children:[e.jsx(Ms,{className:"capitalize text-left",children:ft(C)}),e.jsx(As,{className:"sr-only",children:"Gérer les assignations pour cette journée"})]}),e.jsx("div",{className:"space-y-3",children:V.map(p=>e.jsx(jt,{slot:p,swimSessions:n,strengthSessions:a,onAssign:P=>{x.mutate({assignment_type:p.type,session_id:P,scheduled_date:C,scheduled_slot:p.scheduledSlot??void 0,target_group_id:f,target_user_id:j})},onDelete:P=>{k.mutate(P)},onReplace:(P,O)=>{k.mutate(P,{onSuccess:()=>{x.mutate({assignment_type:p.type,session_id:O,scheduled_date:C,scheduled_slot:p.scheduledSlot??void 0,target_group_id:f,target_user_id:j})}})},isPending:x.isPending||k.isPending},p.key))})]})})]})}function jt({slot:s,swimSessions:r,strengthSessions:i,onAssign:n,onDelete:a,onReplace:l,isPending:u}){const[c,b]=o.useState(!1),v=s.type==="swim",g=v?(r??[]).map(m=>({id:m.id,label:m.name})):(i??[]).map(m=>({id:m.id,label:m.title})),f=s.assignment!==null,j=m=>{const d=Number(m);d&&(f&&c?(l(s.assignment.id,d),b(!1)):n(d))};return e.jsxs("div",{className:"rounded-xl border p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[v?e.jsx(Ee,{className:"h-4 w-4 text-blue-500 shrink-0"}):e.jsx(Te,{className:"h-4 w-4 text-orange-500 shrink-0"}),e.jsx("span",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:s.label})]}),f&&!c?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-semibold truncate flex-1",children:s.assignment.title}),e.jsx(T,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0",disabled:u,onClick:()=>b(!0),title:"Changer",children:e.jsx(ds,{className:"h-3.5 w-3.5"})}),e.jsx(T,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 shrink-0 text-destructive hover:text-destructive",disabled:u,onClick:()=>a(s.assignment.id),title:"Supprimer",children:e.jsx(ws,{className:"h-3.5 w-3.5"})})]}):e.jsxs(B,{value:"",onValueChange:j,disabled:u||g.length===0,children:[e.jsx(K,{className:"h-9 text-xs",children:e.jsx(G,{placeholder:c?"Choisir le remplacement":"Choisir une séance"})}),e.jsx(H,{children:g.map(m=>e.jsx(A,{value:String(m.id),children:m.label},m.id))})]}),c?e.jsx("button",{type:"button",className:"text-xs text-muted-foreground hover:text-foreground",onClick:()=>b(!1),children:"Annuler"}):null]})}const yt=o.lazy(()=>$e(()=>import("./StrengthCatalog-XbLVsuGv.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33]))),bt=o.lazy(()=>$e(()=>import("./SwimCatalog-7QXSM_8C.js"),__vite__mapDeps([34,1,2,3,4,5,6,18,19,9,11,21,16,35,36,12,37,23,15,17,24,25,14,10,8,13,28,38,27,39]))),Nt=({onNavigate:s,onOpenRecordsAdmin:r,onOpenRecordsClub:i,athletes:n,athletesLoading:a,upcomingBirthdays:l,birthdaysLoading:u,kpiLoading:c,kpiPeriod:b,onKpiPeriodChange:v,fatigueAlerts:g,mostLoadedAthlete:f,swimSessionCount:j,strengthSessionCount:m})=>{const d=new Date().getHours(),C=d<12?"Bonjour":d<18?"Bon après-midi":"Bonsoir",E=new Date().toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}),M=g.length>0;return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold uppercase italic",children:[C,", ",e.jsx("span",{className:"text-primary",children:"Coach"})]}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:E})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Signaux · ",b,"j"]}),e.jsxs(Le,{type:"single",size:"sm",variant:"outline",value:String(b),onValueChange:w=>{w&&v(Number(w))},children:[e.jsx(oe,{value:"7",className:"h-7 px-2 text-xs","aria-label":"7 jours",children:"7j"}),e.jsx(oe,{value:"30",className:"h-7 px-2 text-xs","aria-label":"30 jours",children:"30j"}),e.jsx(oe,{value:"365",className:"h-7 px-2 text-xs","aria-label":"1 an",children:"1an"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:`rounded-xl border p-3 ${M?"border-destructive/30 bg-destructive/5":"bg-muted/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Fatigue 5/5"}),e.jsx(zs,{className:`h-3.5 w-3.5 ${M?"text-destructive":"text-muted-foreground"}`})]}),e.jsx("p",{className:"text-xl font-bold tabular-nums",children:c?"–":g.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground truncate",children:c?"Chargement…":M?g.slice(0,2).map(w=>w.athleteName.split(" ")[0]).join(", "):"Aucune alerte"})]}),e.jsxs("div",{className:"rounded-xl border bg-muted/30 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Plus chargé"}),e.jsx(ye,{className:"h-3.5 w-3.5 text-muted-foreground"})]}),e.jsx("p",{className:"text-xl font-bold truncate",children:c?"–":f?.athleteName?.split(" ")[0]??"–"}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:c?"Calcul…":f?`Charge ${Math.round(f.loadScore)}`:"Pas de données"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>s("assignments"),className:"flex items-center gap-1.5 rounded-full bg-primary text-primary-foreground px-4 py-2 text-sm font-semibold active:opacity-80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(ge,{className:"h-3.5 w-3.5"}),"Assigner"]}),e.jsxs("button",{type:"button",onClick:()=>s("messaging"),className:"flex items-center gap-1.5 rounded-full border px-4 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Ne,{className:"h-3.5 w-3.5"}),"Email"]}),e.jsxs("button",{type:"button",onClick:()=>s("calendar"),className:"flex items-center gap-1.5 rounded-full border px-4 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Fs,{className:"h-3.5 w-3.5"}),"Calendrier"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>s("swim"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Ee,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:j!=null?`${j} séance${j!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>s("strength"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Te,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Musculation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:m!=null?`${m} séance${m!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>s("swimmers"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ye,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Nageurs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a?"Chargement…":`${n.length} nageur${n.length!==1?"s":""}`})]}),e.jsxs("button",{type:"button",onClick:r,className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ps,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Records club"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Import & administration"})]})]}),e.jsx("button",{type:"button",onClick:i,className:"w-full text-center text-sm text-primary font-semibold py-1 active:opacity-70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring rounded",children:"Voir les records du club"}),!u&&l&&l.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Anniversaires"}),e.jsx("div",{className:"space-y-1.5",children:l.slice(0,3).map(w=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:w.display_name}),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:Ct(w.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-bold text-primary",children:["J-",w.days_until]})]},w.id))})]}):null]})},Ct=s=>{if(!s)return"-";const r=new Date(s);return Number.isNaN(r.getTime())?s:r.toLocaleDateString("fr-FR")},Ae=s=>s.toISOString().split("T")[0],St=s=>new Date(s.completed_at||s.started_at||s.date||s.created_at||0).getTime(),wt=s=>{if(!s.length)return null;const r=s.reduce((n,a)=>n+a,0)/s.length,i=Math.min(5,Math.max(1,Math.round(r/10*5)));return{average:r,rating:i}};function _t(){const s=_e(t=>t.role),r=_e(t=>t.setSelectedAthlete),[,i]=us(),[n,a]=o.useState("home"),[l,u]=o.useState(7),c=s==="coach"||s==="admin",b=n==="home"||n==="assignments"||n==="calendar",v=n==="home"||n==="assignments"||n==="messaging"||n==="swimmers"||n==="calendar",g=n==="assignments"||n==="messaging"||n==="calendar",f=n==="home"||n==="swimmers",{data:j}=Z({queryKey:["swim_catalog"],queryFn:()=>I.getSwimCatalog(),enabled:c&&b}),{data:m}=Z({queryKey:["strength_catalog"],queryFn:()=>I.getStrengthSessions(),enabled:c&&b}),{data:d=[],isLoading:C}=Z({queryKey:["athletes"],queryFn:()=>I.getAthletes(),enabled:c&&v}),E=o.useMemo(()=>d.slice(0,5),[d]),{data:M=[]}=Z({queryKey:["groups"],queryFn:()=>I.getGroups(),enabled:c&&g}),w=Z({queryKey:["upcoming-birthdays"],queryFn:()=>I.getUpcomingBirthdays({days:30}),enabled:c&&f}),$=w.data,F=Z({queryKey:["coach-kpis",l,E.map(t=>t.id??t.display_name)],enabled:c&&n==="home"&&E.length>0,queryFn:async()=>{const t=l,y=new Date;y.setDate(y.getDate()-t);const D=Ae(y),R=Ae(new Date),h=await Promise.all(E.map(async x=>{const[k,L]=await Promise.all([I.getSessions(x.display_name,x.id),I.getStrengthHistory(x.display_name,{athleteId:x.id,limit:50,from:D,to:R})]),p=k.filter(_=>new Date(_.date).getTime()>=y.getTime()),P=p.map(_=>_.fatigue??_.feeling).filter(_=>Number.isFinite(_)),O=p.reduce((_,W)=>_+(Number(W.duration)||0)*(Number(W.effort)||0),0),q=(L?.runs??[]).filter(_=>St(_)>=y.getTime()),ae=q.map(_=>_.fatigue??_.feeling??_.rpe).filter(_=>Number.isFinite(Number(_))).map(_=>Number(_)),re=q.reduce((_,W)=>{const Se=Number(W.feeling??W.rpe??0),we=Number(W.duration??0);if(we>0&&Se>0)return _+we*Se;const es=Array.isArray(W.logs)?W.logs.length:0;return _+es*5},0),Xe=wt([...P,...ae]);return{athleteName:x.display_name,loadScore:O+re,fatigueRating:Xe}})),N=h.filter(x=>x.fatigueRating?.rating===5).map(x=>({athleteName:x.athleteName,rating:x.fatigueRating?.rating??0})),S=h.filter(x=>x.loadScore>0).sort((x,k)=>k.loadScore-x.loadScore)[0];return{fatigueAlerts:N,mostLoadedAthlete:S??null}}}),V=t=>{r({id:t.id??null,name:t.display_name}),i("/progress")},{toast:z}=be(),J=ze(),U=he({mutationFn:async t=>{const y=await I.importSingleSwimmer(t.iuf,t.name);return await I.recalculateClubRecords(),y},onSuccess:t=>{z({title:"Import terminé",description:`${t.total_found} trouvées, ${t.new_imported} nouvelles.`}),J.invalidateQueries({queryKey:["club-records"]})},onError:t=>{z({title:"Erreur import",description:t.message,variant:"destructive"})}});return c?e.jsxs("div",{className:"space-y-6",children:[n==="home"?e.jsx(Nt,{onNavigate:a,onOpenRecordsAdmin:()=>i("/records-admin"),onOpenRecordsClub:()=>i("/records-club"),athletes:d,athletesLoading:C,upcomingBirthdays:$,birthdaysLoading:w.isLoading,kpiLoading:F.isLoading,kpiPeriod:l,onKpiPeriodChange:u,fatigueAlerts:F.data?.fatigueAlerts??[],mostLoadedAthlete:F.data?.mostLoadedAthlete??null,swimSessionCount:j?.length,strengthSessionCount:m?.length}):null,n==="assignments"?e.jsx(mt,{onBack:()=>a("home"),swimSessions:j,strengthSessions:m,athletes:d,groups:M}):null,n==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(se,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>a("home"),actions:e.jsxs(T,{variant:"outline",onClick:()=>a("assignments"),children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(o.Suspense,{fallback:e.jsx(ke,{}),children:e.jsx(bt,{})})]}):null,n==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(se,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>a("home"),actions:e.jsxs(T,{variant:"outline",onClick:()=>a("assignments"),children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(o.Suspense,{fallback:e.jsx(ke,{}),children:e.jsx(yt,{})})]}):null,n==="swimmers"?e.jsxs("div",{className:"space-y-4",children:[e.jsx(se,{title:"Nageurs",description:C?"Chargement…":`${d.length} nageur${d.length!==1?"s":""} inscrit${d.length!==1?"s":""}`,onBack:()=>a("home"),actions:e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>a("messaging"),children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Email"]})}),C?e.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(t=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-8 w-16 rounded bg-muted"})]})},t))}):d.length?e.jsx("div",{className:"space-y-2",children:d.map(t=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border bg-card p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:t.display_name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[t.group_label?e.jsx(gs,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:t.group_label}):null,t.ffn_iuf?e.jsx("span",{className:"text-[10px] font-mono text-muted-foreground",children:t.ffn_iuf}):null]})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[t.ffn_iuf?e.jsx(T,{size:"icon",variant:"ghost",className:"h-8 w-8",disabled:U.isPending,onClick:()=>U.mutate({iuf:t.ffn_iuf,name:t.display_name}),title:"Importer performances FFN",children:e.jsx(ms,{className:"h-4 w-4"})}):null,e.jsx(T,{size:"sm",variant:"outline",onClick:()=>V(t),children:"Fiche"})]})]},t.id??t.display_name))}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Aucun nageur disponible."})]}):null,n==="messaging"?e.jsx(pt,{onBack:()=>a("home"),athletes:d,groups:M,athletesLoading:C}):null,n==="calendar"?e.jsx(vt,{onBack:()=>a("home"),athletes:d,groups:M,swimSessions:j,strengthSessions:m}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(le,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(ce,{children:[e.jsxs(de,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(ye,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(ue,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(me,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}const zt=Object.freeze(Object.defineProperty({__proto__:null,default:_t},Symbol.toStringTag,{value:"Module"}));export{zt as C,dt as P,ut as a,Ze as b};
