import{R as d,T as vn,L as yn,G as bn,H as wn,J as jn,r as m,O as Nn,j as e}from"./vendor-ui-CDk0TPZB.js";import{b as Sn,u as tt,d as _n,c as nt}from"./vendor-query-aL7hzhW6.js";import{h as Je,j as ge,i as qt,D as Ke,B as L,C as Qe,b as St,c as _t,d as Vt,f as Ct,n as Cn,X as ht,u as Rn,g as _e}from"./index-DkY2h0px.js";import{I as vt}from"./input-Dyipb55u.js";import{L as Ge}from"./label-CqV2Lp4b.js";import{S as Ut,a as Wt,b as Kt,c as Qt,d as En}from"./sheet-BxcB67dc.js";import{S as Rt}from"./switch-ITSi9eu6.js";import{S as kn,a as Tn,b as Dn,c as Mn,d as dt}from"./select-BhyF-CVR.js";import{T as An,a as In,b as Mt,c as At}from"./tabs-CEIQb0sF.js";import{B as ot}from"./badge-CQUSkGsT.js";import{A as On,a as $n,b as Pn,c as Fn,d as Ln,e as Hn,f as zn,g as Bn,P as It}from"./alert-dialog-BRafJguC.js";import{C as Ot}from"./check-DxsCHFcs.js";import{T as qn}from"./timer-v05TvBGV.js";import{C as Et,I as Vn}from"./info-B47APWDY.js";import{S as Un}from"./search-C_M-8eZk.js";import{C as $t}from"./chevron-left-HmQUMaia.js";import{f as ut}from"./fr-CqUxEDd2.js";import{f as mt}from"./vendor-date-cQbdWov0.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-bGfQb4ap.js";import"./vendor-supabase-CgI36rMY.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wn=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Kn=Je("calendar",Wn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qn=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Yn=Je("circle-check",Qn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xn=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Gn=Je("loader-circle",Xn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jn=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],Zn=Je("pause",Jn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],tr=Je("rotate-ccw",er);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nr=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],rr=Je("sliders-horizontal",nr);function sr(t){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",r.appendChild(s),s.styleSheet?s.styleSheet.cssText=t:s.appendChild(document.createTextNode(t))}const Yt=d.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),lt=()=>{const t=d.useContext(Yt);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};sr(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}`);function ar(){const t=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(t)&&/Mobile/.test(t)||/FxiOS/.test(t))}function ir(){return Dt(/^Mac/)}function or(){return Dt(/^iPhone/)}function Pt(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function lr(){return Dt(/^iPad/)||ir()&&navigator.maxTouchPoints>1}function Xt(){return or()||lr()}function Dt(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const cr=24,dr=typeof window<"u"?m.useLayoutEffect:m.useEffect;function Ft(...t){return(...r)=>{for(let s of t)typeof s=="function"&&s(...r)}}const yt=typeof document<"u"&&window.visualViewport;function Lt(t){let r=window.getComputedStyle(t);return/(auto|scroll)/.test(r.overflow+r.overflowX+r.overflowY)}function Gt(t){for(Lt(t)&&(t=t.parentElement);t&&!Lt(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const ur=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let ft=0,bt;function mr(t={}){let{isDisabled:r}=t;dr(()=>{if(!r)return ft++,ft===1&&Xt()&&(bt=fr()),()=>{ft--,ft===0&&bt?.()}},[r])}function fr(){let t,r=0,s=S=>{t=Gt(S.target),!(t===document.documentElement&&t===document.body)&&(r=S.changedTouches[0].pageY)},i=S=>{if(!t||t===document.documentElement||t===document.body){S.preventDefault();return}let b=S.changedTouches[0].pageY,H=t.scrollTop,Y=t.scrollHeight-t.clientHeight;Y!==0&&((H<=0&&b>r||H>=Y&&b<r)&&S.preventDefault(),r=b)},l=S=>{let b=S.target;kt(b)&&b!==document.activeElement&&(S.preventDefault(),b.style.transform="translateY(-2000px)",b.focus(),requestAnimationFrame(()=>{b.style.transform=""}))},o=S=>{let b=S.target;kt(b)&&(b.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{b.style.transform="",yt&&(yt.height<window.innerHeight?requestAnimationFrame(()=>{Ht(b)}):yt.addEventListener("resize",()=>Ht(b),{once:!0}))}))},p=()=>{window.scrollTo(0,0)},f=window.pageXOffset,u=window.pageYOffset,E=Ft(pr(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let g=Ft(rt(document,"touchstart",s,{passive:!1,capture:!0}),rt(document,"touchmove",i,{passive:!1,capture:!0}),rt(document,"touchend",l,{passive:!1,capture:!0}),rt(document,"focus",o,!0),rt(window,"scroll",p));return()=>{E(),g(),window.scrollTo(f,u)}}function pr(t,r,s){let i=t.style[r];return t.style[r]=s,()=>{t.style[r]=i}}function rt(t,r,s,i){return t.addEventListener(r,s,i),()=>{t.removeEventListener(r,s,i)}}function Ht(t){let r=document.scrollingElement||document.documentElement;for(;t&&t!==r;){let s=Gt(t);if(s!==document.documentElement&&s!==document.body&&s!==t){let i=s.getBoundingClientRect().top,l=t.getBoundingClientRect().top,o=t.getBoundingClientRect().bottom;const p=s.getBoundingClientRect().bottom+cr;o>p&&(s.scrollTop+=l-i)}t=s.parentElement}}function kt(t){return t instanceof HTMLInputElement&&!ur.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function hr(t,r){typeof t=="function"?t(r):t!=null&&(t.current=r)}function xr(...t){return r=>t.forEach(s=>hr(s,r))}function Jt(...t){return m.useCallback(xr(...t),t)}const Zt=new WeakMap;function ae(t,r,s=!1){if(!t||!(t instanceof HTMLElement))return;let i={};Object.entries(r).forEach(([l,o])=>{if(l.startsWith("--")){t.style.setProperty(l,o);return}i[l]=t.style[l],t.style[l]=o}),!s&&Zt.set(t,i)}function gr(t,r){if(!t||!(t instanceof HTMLElement))return;let s=Zt.get(t);s&&(t.style[r]=s[r])}const ee=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function pt(t,r){if(!t)return null;const s=window.getComputedStyle(t),i=s.transform||s.webkitTransform||s.mozTransform;let l=i.match(/^matrix3d\((.+)\)$/);return l?parseFloat(l[1].split(", ")[ee(r)?13:12]):(l=i.match(/^matrix\((.+)\)$/),l?parseFloat(l[1].split(", ")[ee(r)?5:4]):null)}function vr(t){return 8*(Math.log(t+1)-2)}function wt(t,r){if(!t)return()=>{};const s=t.style.cssText;return Object.assign(t.style,r),()=>{t.style.cssText=s}}function yr(...t){return(...r)=>{for(const s of t)typeof s=="function"&&s(...r)}}const Q={DURATION:.5,EASE:[.32,.72,0,1]},en=.4,br=.25,wr=100,tn=8,Ue=16,Tt=26,jt="vaul-dragging";function nn(t){const r=d.useRef(t);return d.useEffect(()=>{r.current=t}),d.useMemo(()=>(...s)=>r.current==null?void 0:r.current.call(r,...s),[])}function jr({defaultProp:t,onChange:r}){const s=d.useState(t),[i]=s,l=d.useRef(i),o=nn(r);return d.useEffect(()=>{l.current!==i&&(o(i),l.current=i)},[i,l,o]),s}function rn({prop:t,defaultProp:r,onChange:s=()=>{}}){const[i,l]=jr({defaultProp:r,onChange:s}),o=t!==void 0,p=o?t:i,f=nn(s),u=d.useCallback(E=>{if(o){const S=typeof E=="function"?E(t):E;S!==t&&f(S)}else l(E)},[o,t,l,f]);return[p,u]}function Nr({activeSnapPointProp:t,setActiveSnapPointProp:r,snapPoints:s,drawerRef:i,overlayRef:l,fadeFromIndex:o,onSnapPointChange:p,direction:f="bottom",container:u,snapToSequentialPoint:E}){const[g,S]=rn({prop:t,defaultProp:s?.[0],onChange:r}),[b,H]=d.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);d.useEffect(()=>{function C(){H({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",C),()=>window.removeEventListener("resize",C)},[]);const Y=d.useMemo(()=>g===s?.[s.length-1]||null,[s,g]),D=d.useMemo(()=>{var C;return(C=s?.findIndex(y=>y===g))!=null?C:null},[s,g]),P=s&&s.length>0&&(o||o===0)&&!Number.isNaN(o)&&s[o]===g||!s,w=d.useMemo(()=>{const C=u?{width:u.getBoundingClientRect().width,height:u.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var y;return(y=s?.map(R=>{const B=typeof R=="string";let U=0;if(B&&(U=parseInt(R,10)),ee(f)){const h=B?U:b?R*C.height:0;return b?f==="bottom"?C.height-h:-C.height+h:h}const X=B?U:b?R*C.width:0;return b?f==="right"?C.width-X:-C.width+X:X}))!=null?y:[]},[s,b,u]),M=d.useMemo(()=>D!==null?w?.[D]:null,[w,D]),A=d.useCallback(C=>{var y;const R=(y=w?.findIndex(B=>B===C))!=null?y:null;p(R),ae(i.current,{transition:`transform ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`,transform:ee(f)?`translate3d(0, ${C}px, 0)`:`translate3d(${C}px, 0, 0)`}),w&&R!==w.length-1&&o!==void 0&&R!==o&&R<o?ae(l.current,{transition:`opacity ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`,opacity:"0"}):ae(l.current,{transition:`opacity ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`,opacity:"1"}),S(s?.[Math.max(R,0)])},[i.current,s,w,o,l,S]);d.useEffect(()=>{if(g||t){var C;const y=(C=s?.findIndex(R=>R===t||R===g))!=null?C:-1;w&&y!==-1&&typeof w[y]=="number"&&A(w[y])}},[g,t,s,w,A]);function j({draggedDistance:C,closeDrawer:y,velocity:R,dismissible:B}){if(o===void 0)return;const U=f==="bottom"||f==="right"?(M??0)-C:(M??0)+C,X=D===o-1,h=D===0,G=C>0;if(X&&ae(l.current,{transition:`opacity ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`}),!E&&R>2&&!G){B?y():A(w[0]);return}if(!E&&R>2&&G&&w&&s){A(w[s.length-1]);return}const te=w?.reduce((V,de)=>typeof V!="number"||typeof de!="number"?V:Math.abs(de-U)<Math.abs(V-U)?de:V),ie=ee(f)?window.innerHeight:window.innerWidth;if(R>en&&Math.abs(C)<ie*.4){const V=G?1:-1;if(V>0&&Y&&s){A(w[s.length-1]);return}if(h&&V<0&&B&&y(),D===null)return;A(w[D+V]);return}A(te)}function ce({draggedDistance:C}){if(M===null)return;const y=f==="bottom"||f==="right"?M-C:M+C;(f==="bottom"||f==="right")&&y<w[w.length-1]||(f==="top"||f==="left")&&y>w[w.length-1]||ae(i.current,{transform:ee(f)?`translate3d(0, ${y}px, 0)`:`translate3d(${y}px, 0, 0)`})}function ve(C,y){if(!s||typeof D!="number"||!w||o===void 0)return null;const R=D===o-1;if(D>=o&&y)return 0;if(R&&!y)return 1;if(!P&&!R)return null;const U=R?D+1:D-1,X=R?w[U]-w[U-1]:w[U+1]-w[U],h=C/Math.abs(X);return R?1-h:h}return{isLastSnapPoint:Y,activeSnapPoint:g,shouldFade:P,getPercentageDragged:ve,setActiveSnapPoint:S,activeSnapPointIndex:D,onRelease:j,onDrag:ce,snapPointsOffset:w}}const Sr=()=>()=>{};function _r(){const{direction:t,isOpen:r,shouldScaleBackground:s,setBackgroundColorOnScale:i,noBodyStyles:l}=lt(),o=d.useRef(null),p=m.useMemo(()=>document.body.style.backgroundColor,[]);function f(){return(window.innerWidth-Tt)/window.innerWidth}d.useEffect(()=>{if(r&&s){o.current&&clearTimeout(o.current);const u=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!u)return;yr(i&&!l?wt(document.body,{background:"black"}):Sr,wt(u,{transformOrigin:ee(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${Q.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Q.EASE.join(",")})`}));const E=wt(u,{borderRadius:`${tn}px`,overflow:"hidden",...ee(t)?{transform:`scale(${f()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${f()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{E(),o.current=window.setTimeout(()=>{p?document.body.style.background=p:document.body.style.removeProperty("background")},Q.DURATION*1e3)}}},[r,s,p])}let st=null;function Cr({isOpen:t,modal:r,nested:s,hasBeenOpened:i,preventScrollRestoration:l,noBodyStyles:o}){const[p,f]=d.useState(()=>typeof window<"u"?window.location.href:""),u=d.useRef(0),E=d.useCallback(()=>{if(Pt()&&st===null&&t&&!o){st={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:S,innerHeight:b}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-u.current}px`,left:`${-S}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const H=b-window.innerHeight;H&&u.current>=b&&(document.body.style.top=`${-(u.current+H)}px`)}),300)}},[t]),g=d.useCallback(()=>{if(Pt()&&st!==null&&!o){const S=-parseInt(document.body.style.top,10),b=-parseInt(document.body.style.left,10);Object.assign(document.body.style,st),window.requestAnimationFrame(()=>{if(l&&p!==window.location.href){f(window.location.href);return}window.scrollTo(b,S)}),st=null}},[p]);return d.useEffect(()=>{function S(){u.current=window.scrollY}return S(),window.addEventListener("scroll",S),()=>{window.removeEventListener("scroll",S)}},[]),d.useEffect(()=>{if(r)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||g()}},[r,g]),d.useEffect(()=>{s||!i||(t?(!window.matchMedia("(display-mode: standalone)").matches&&E(),r||window.setTimeout(()=>{g()},500)):g())},[t,i,p,r,s,E,g]),{restorePositionSetting:g}}function Rr({open:t,onOpenChange:r,children:s,onDrag:i,onRelease:l,snapPoints:o,shouldScaleBackground:p=!1,setBackgroundColorOnScale:f=!0,closeThreshold:u=br,scrollLockTimeout:E=wr,dismissible:g=!0,handleOnly:S=!1,fadeFromIndex:b=o&&o.length-1,activeSnapPoint:H,setActiveSnapPoint:Y,fixed:D,modal:P=!0,onClose:w,nested:M,noBodyStyles:A=!1,direction:j="bottom",defaultOpen:ce=!1,disablePreventScroll:ve=!0,snapToSequentialPoint:C=!1,preventScrollRestoration:y=!1,repositionInputs:R=!0,onAnimationEnd:B,container:U,autoFocus:X=!1}){var h,G;const[te=!1,ie]=rn({defaultProp:ce,prop:t,onChange:v=>{r?.(v),!v&&!M&&me(),setTimeout(()=>{B?.(v)},Q.DURATION*1e3),v&&!P&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),v||(document.body.style.pointerEvents="auto")}}),[V,de]=d.useState(!1),[W,pe]=d.useState(!1),[Pe,Ce]=d.useState(!1),Re=d.useRef(null),q=d.useRef(null),ue=d.useRef(null),Fe=d.useRef(null),he=d.useRef(null),we=d.useRef(!1),Le=d.useRef(null),F=d.useRef(0),xe=d.useRef(!1),je=d.useRef(!ce),be=d.useRef(0),N=d.useRef(null),Te=d.useRef(((h=N.current)==null?void 0:h.getBoundingClientRect().height)||0),Ye=d.useRef(((G=N.current)==null?void 0:G.getBoundingClientRect().width)||0),De=d.useRef(0),ye=d.useCallback(v=>{o&&v===oe.length-1&&(q.current=new Date)},[]),{activeSnapPoint:ze,activeSnapPointIndex:K,setActiveSnapPoint:He,onRelease:k,snapPointsOffset:oe,onDrag:Xe,shouldFade:Be,getPercentageDragged:Ne}=Nr({snapPoints:o,activeSnapPointProp:H,setActiveSnapPointProp:Y,drawerRef:N,fadeFromIndex:b,overlayRef:Re,onSnapPointChange:ye,direction:j,container:U,snapToSequentialPoint:C});mr({isDisabled:!te||W||!P||Pe||!V||!R||!ve});const{restorePositionSetting:me}=Cr({isOpen:te,modal:P,nested:M??!1,hasBeenOpened:V,preventScrollRestoration:y,noBodyStyles:A});function Me(){return(window.innerWidth-Tt)/window.innerWidth}function qe(v){var I,O;!g&&!o||N.current&&!N.current.contains(v.target)||(Te.current=((I=N.current)==null?void 0:I.getBoundingClientRect().height)||0,Ye.current=((O=N.current)==null?void 0:O.getBoundingClientRect().width)||0,pe(!0),ue.current=new Date,Xt()&&window.addEventListener("touchend",()=>we.current=!1,{once:!0}),v.target.setPointerCapture(v.pointerId),F.current=ee(j)?v.pageY:v.pageX)}function Ve(v,I){var O;let T=v;const z=(O=window.getSelection())==null?void 0:O.toString(),re=N.current?pt(N.current,j):null,Z=new Date;if(T.tagName==="SELECT"||T.hasAttribute("data-vaul-no-drag")||T.closest("[data-vaul-no-drag]"))return!1;if(j==="right"||j==="left")return!0;if(q.current&&Z.getTime()-q.current.getTime()<500)return!1;if(re!==null&&(j==="bottom"?re>0:re<0))return!0;if(z&&z.length>0)return!1;if(he.current&&Z.getTime()-he.current.getTime()<E&&re===0||I)return he.current=Z,!1;for(;T;){if(T.scrollHeight>T.clientHeight){if(T.scrollTop!==0)return he.current=new Date,!1;if(T.getAttribute("role")==="dialog")return!0}T=T.parentNode}return!0}function Ze(v){if(N.current&&W){const I=j==="bottom"||j==="right"?1:-1,O=(F.current-(ee(j)?v.pageY:v.pageX))*I,T=O>0,z=o&&!g&&!T;if(z&&K===0)return;const re=Math.abs(O),Z=document.querySelector("[data-vaul-drawer-wrapper]"),Ee=j==="bottom"||j==="top"?Te.current:Ye.current;let fe=re/Ee;const ke=Ne(re,T);if(ke!==null&&(fe=ke),z&&fe>=1||!we.current&&!Ve(v.target,T))return;if(N.current.classList.add(jt),we.current=!0,ae(N.current,{transition:"none"}),ae(Re.current,{transition:"none"}),o&&Xe({draggedDistance:O}),T&&!o){const x=vr(O),se=Math.min(x*-1,0)*I;ae(N.current,{transform:ee(j)?`translate3d(0, ${se}px, 0)`:`translate3d(${se}px, 0, 0)`});return}const a=1-fe;if((Be||b&&K===b-1)&&(i?.(v,fe),ae(Re.current,{opacity:`${a}`,transition:"none"},!0)),Z&&Re.current&&p){const x=Math.min(Me()+fe*(1-Me()),1),se=8-fe*8,_=Math.max(0,14-fe*14);ae(Z,{borderRadius:`${se}px`,transform:ee(j)?`scale(${x}) translate3d(0, ${_}px, 0)`:`scale(${x}) translate3d(${_}px, 0, 0)`,transition:"none"},!0)}if(!o){const x=re*I;ae(N.current,{transform:ee(j)?`translate3d(0, ${x}px, 0)`:`translate3d(${x}px, 0, 0)`})}}}d.useEffect(()=>{window.requestAnimationFrame(()=>{je.current=!0})},[]),d.useEffect(()=>{var v;function I(){if(!N.current||!R)return;const O=document.activeElement;if(kt(O)||xe.current){var T;const z=((T=window.visualViewport)==null?void 0:T.height)||0,re=window.innerHeight;let Z=re-z;const Ee=N.current.getBoundingClientRect().height||0,fe=Ee>re*.8;De.current||(De.current=Ee);const ke=N.current.getBoundingClientRect().top;if(Math.abs(be.current-Z)>60&&(xe.current=!xe.current),o&&o.length>0&&oe&&K){const a=oe[K]||0;Z+=a}if(be.current=Z,Ee>z||xe.current){const a=N.current.getBoundingClientRect().height;let x=a;a>z&&(x=z-(fe?ke:Tt)),D?N.current.style.height=`${a-Math.max(Z,0)}px`:N.current.style.height=`${Math.max(x,z-ke)}px`}else ar()||(N.current.style.height=`${De.current}px`);o&&o.length>0&&!xe.current?N.current.style.bottom="0px":N.current.style.bottom=`${Math.max(Z,0)}px`}}return(v=window.visualViewport)==null||v.addEventListener("resize",I),()=>{var O;return(O=window.visualViewport)==null?void 0:O.removeEventListener("resize",I)}},[K,o,oe]);function J(v){c(),w?.(),v||ie(!1),setTimeout(()=>{o&&He(o[0])},Q.DURATION*1e3)}function n(){if(!N.current)return;const v=document.querySelector("[data-vaul-drawer-wrapper]"),I=pt(N.current,j);ae(N.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`}),ae(Re.current,{transition:`opacity ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`,opacity:"1"}),p&&I&&I>0&&te&&ae(v,{borderRadius:`${tn}px`,overflow:"hidden",...ee(j)?{transform:`scale(${Me()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Me()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${Q.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Q.EASE.join(",")})`},!0)}function c(){!W||!N.current||(N.current.classList.remove(jt),we.current=!1,pe(!1),Fe.current=new Date)}function $(v){if(!W||!N.current)return;N.current.classList.remove(jt),we.current=!1,pe(!1),Fe.current=new Date;const I=pt(N.current,j);if(!v||!Ve(v.target,!1)||!I||Number.isNaN(I)||ue.current===null)return;const O=Fe.current.getTime()-ue.current.getTime(),T=F.current-(ee(j)?v.pageY:v.pageX),z=Math.abs(T)/O;if(z>.05&&(Ce(!0),setTimeout(()=>{Ce(!1)},200)),o){k({draggedDistance:T*(j==="bottom"||j==="right"?1:-1),closeDrawer:J,velocity:z,dismissible:g}),l?.(v,!0);return}if(j==="bottom"||j==="right"?T>0:T<0){n(),l?.(v,!0);return}if(z>en){J(),l?.(v,!1);return}var re;const Z=Math.min((re=N.current.getBoundingClientRect().height)!=null?re:0,window.innerHeight);var Ee;const fe=Math.min((Ee=N.current.getBoundingClientRect().width)!=null?Ee:0,window.innerWidth),ke=j==="left"||j==="right";if(Math.abs(I)>=(ke?fe:Z)*u){J(),l?.(v,!1);return}l?.(v,!0),n()}d.useEffect(()=>(te&&(ae(document.documentElement,{scrollBehavior:"auto"}),q.current=new Date),()=>{gr(document.documentElement,"scrollBehavior")}),[te]);function ne(v){const I=v?(window.innerWidth-Ue)/window.innerWidth:1,O=v?-Ue:0;Le.current&&window.clearTimeout(Le.current),ae(N.current,{transition:`transform ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`,transform:ee(j)?`scale(${I}) translate3d(0, ${O}px, 0)`:`scale(${I}) translate3d(${O}px, 0, 0)`}),!v&&N.current&&(Le.current=setTimeout(()=>{const T=pt(N.current,j);ae(N.current,{transition:"none",transform:ee(j)?`translate3d(0, ${T}px, 0)`:`translate3d(${T}px, 0, 0)`})},500))}function le(v,I){if(I<0)return;const O=(window.innerWidth-Ue)/window.innerWidth,T=O+I*(1-O),z=-Ue+I*Ue;ae(N.current,{transform:ee(j)?`scale(${T}) translate3d(0, ${z}px, 0)`:`scale(${T}) translate3d(${z}px, 0, 0)`,transition:"none"})}function Se(v,I){const O=ee(j)?window.innerHeight:window.innerWidth,T=I?(O-Ue)/O:1,z=I?-Ue:0;I&&ae(N.current,{transition:`transform ${Q.DURATION}s cubic-bezier(${Q.EASE.join(",")})`,transform:ee(j)?`scale(${T}) translate3d(0, ${z}px, 0)`:`scale(${T}) translate3d(${z}px, 0, 0)`})}return d.useEffect(()=>{P||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[P]),d.createElement(bn,{defaultOpen:ce,onOpenChange:v=>{!g&&!v||(v?de(!0):J(!0),ie(v))},open:te},d.createElement(Yt.Provider,{value:{activeSnapPoint:ze,snapPoints:o,setActiveSnapPoint:He,drawerRef:N,overlayRef:Re,onOpenChange:r,onPress:qe,onRelease:$,onDrag:Ze,dismissible:g,shouldAnimate:je,handleOnly:S,isOpen:te,isDragging:W,shouldFade:Be,closeDrawer:J,onNestedDrag:le,onNestedOpenChange:ne,onNestedRelease:Se,keyboardIsOpen:xe,modal:P,snapPointsOffset:oe,activeSnapPointIndex:K,direction:j,shouldScaleBackground:p,setBackgroundColorOnScale:f,noBodyStyles:A,container:U,autoFocus:X}},s))}const sn=d.forwardRef(function({...t},r){const{overlayRef:s,snapPoints:i,onRelease:l,shouldFade:o,isOpen:p,modal:f,shouldAnimate:u}=lt(),E=Jt(r,s),g=i&&i.length>0;if(!f)return null;const S=d.useCallback(b=>l(b),[l]);return d.createElement(Nn,{onMouseUp:S,ref:E,"data-vaul-overlay":"","data-vaul-snap-points":p&&g?"true":"false","data-vaul-snap-points-overlay":p&&o?"true":"false","data-vaul-animate":u?.current?"true":"false",...t})});sn.displayName="Drawer.Overlay";const an=d.forwardRef(function({onPointerDownOutside:t,style:r,onOpenAutoFocus:s,...i},l){const{drawerRef:o,onPress:p,onRelease:f,onDrag:u,keyboardIsOpen:E,snapPointsOffset:g,activeSnapPointIndex:S,modal:b,isOpen:H,direction:Y,snapPoints:D,container:P,handleOnly:w,shouldAnimate:M,autoFocus:A}=lt(),[j,ce]=d.useState(!1),ve=Jt(l,o),C=d.useRef(null),y=d.useRef(null),R=d.useRef(!1),B=D&&D.length>0;_r();const U=(h,G,te=0)=>{if(R.current)return!0;const ie=Math.abs(h.y),V=Math.abs(h.x),de=V>ie,W=["bottom","right"].includes(G)?1:-1;if(G==="left"||G==="right"){if(!(h.x*W<0)&&V>=0&&V<=te)return de}else if(!(h.y*W<0)&&ie>=0&&ie<=te)return!de;return R.current=!0,!0};d.useEffect(()=>{B&&window.requestAnimationFrame(()=>{ce(!0)})},[]);function X(h){C.current=null,R.current=!1,f(h)}return d.createElement(jn,{"data-vaul-drawer-direction":Y,"data-vaul-drawer":"","data-vaul-delayed-snap-points":j?"true":"false","data-vaul-snap-points":H&&B?"true":"false","data-vaul-custom-container":P?"true":"false","data-vaul-animate":M?.current?"true":"false",...i,ref:ve,style:g&&g.length>0?{"--snap-point-height":`${g[S??0]}px`,...r}:r,onPointerDown:h=>{w||(i.onPointerDown==null||i.onPointerDown.call(i,h),C.current={x:h.pageX,y:h.pageY},p(h))},onOpenAutoFocus:h=>{s?.(h),A||h.preventDefault()},onPointerDownOutside:h=>{if(t?.(h),!b||h.defaultPrevented){h.preventDefault();return}E.current&&(E.current=!1)},onFocusOutside:h=>{if(!b){h.preventDefault();return}},onPointerMove:h=>{if(y.current=h,w||(i.onPointerMove==null||i.onPointerMove.call(i,h),!C.current))return;const G=h.pageY-C.current.y,te=h.pageX-C.current.x,ie=h.pointerType==="touch"?10:2;U({x:te,y:G},Y,ie)?u(h):(Math.abs(te)>ie||Math.abs(G)>ie)&&(C.current=null)},onPointerUp:h=>{i.onPointerUp==null||i.onPointerUp.call(i,h),C.current=null,R.current=!1,f(h)},onPointerOut:h=>{i.onPointerOut==null||i.onPointerOut.call(i,h),X(y.current)},onContextMenu:h=>{i.onContextMenu==null||i.onContextMenu.call(i,h),y.current&&X(y.current)}})});an.displayName="Drawer.Content";const Er=250,kr=120,Tr=d.forwardRef(function({preventCycle:t=!1,children:r,...s},i){const{closeDrawer:l,isDragging:o,snapPoints:p,activeSnapPoint:f,setActiveSnapPoint:u,dismissible:E,handleOnly:g,isOpen:S,onPress:b,onDrag:H}=lt(),Y=d.useRef(null),D=d.useRef(!1);function P(){if(D.current){A();return}window.setTimeout(()=>{w()},kr)}function w(){if(o||t||D.current){A();return}if(A(),!p||p.length===0){E||l();return}if(f===p[p.length-1]&&E){l();return}const ce=p.findIndex(C=>C===f);if(ce===-1)return;const ve=p[ce+1];u(ve)}function M(){Y.current=window.setTimeout(()=>{D.current=!0},Er)}function A(){Y.current&&window.clearTimeout(Y.current),D.current=!1}return d.createElement("div",{onClick:P,onPointerCancel:A,onPointerDown:j=>{g&&b(j),M()},onPointerMove:j=>{g&&H(j)},ref:i,"data-vaul-drawer-visible":S?"true":"false","data-vaul-handle":"","aria-hidden":"true",...s},d.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},r))});Tr.displayName="Drawer.Handle";function Dr(t){const r=lt(),{container:s=r.container,...i}=t;return d.createElement(wn,{container:s,...i})}const $e={Root:Rr,Content:an,Overlay:sn,Portal:Dr,Title:vn,Description:yn},on=({shouldScaleBackground:t=!0,...r})=>e.jsx($e.Root,{shouldScaleBackground:t,...r});on.displayName="Drawer";const Mr=$e.Portal,ln=m.forwardRef(({className:t,...r},s)=>e.jsx($e.Overlay,{ref:s,className:ge("fixed inset-0 z-50 bg-black/80",t),...r}));ln.displayName=$e.Overlay.displayName;const cn=m.forwardRef(({className:t,children:r,...s},i)=>e.jsxs(Mr,{children:[e.jsx(ln,{}),e.jsxs($e.Content,{ref:i,className:ge("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",t),...s,children:[e.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),r]})]}));cn.displayName="DrawerContent";const dn=({className:t,...r})=>e.jsx("div",{className:ge("grid gap-1.5 p-4 text-center sm:text-left",t),...r});dn.displayName="DrawerHeader";const un=m.forwardRef(({className:t,...r},s)=>e.jsx($e.Title,{ref:s,className:ge("text-lg font-semibold leading-none tracking-tight",t),...r}));un.displayName=$e.Title.displayName;const mn=m.forwardRef(({className:t,...r},s)=>e.jsx($e.Description,{ref:s,className:ge("text-sm text-muted-foreground",t),...r}));mn.displayName=$e.Description.displayName;function fn({children:t,className:r,containerClassName:s}){return e.jsx("div",{role:"region","aria-label":"Actions",className:ge("fixed bottom-16 left-0 right-0 z-bar md:bottom-0 md:z-bar",r),children:e.jsx("div",{className:ge("mx-auto flex w-full max-w-md items-center justify-between gap-2 border-t bg-background px-4 py-3 shadow-[0_-2px_10px_rgba(0,0,0,0.1)]","md:supports-[padding:env(safe-area-inset-bottom)]:pb-[calc(env(safe-area-inset-bottom)+0.75rem)]",s),children:t})})}const Ar=[1,2,3,4,5];function zt({value:t,onChange:r,className:s,disabled:i=!1,size:l="md",ariaLabel:o="Sélecteur d'échelle 1 à 5"}){const p=l==="sm"?"h-10 w-10 text-xs":"h-11 w-11 text-sm";return e.jsx("div",{className:ge("flex items-center gap-2",s),role:"group","aria-label":o,children:Ar.map(f=>{const u=t===f;return e.jsx("button",{type:"button",className:ge("flex items-center justify-center rounded-full border font-semibold transition",p,u?"border-primary bg-primary text-primary-foreground":"border-muted-foreground/30 bg-background text-foreground",i&&"opacity-60"),"aria-pressed":u,disabled:i,onClick:()=>{i||r?.(f)},children:f},f)})})}const xt=(t,r)=>{const s=Number(t?.set_index??t?.set_number??t?.setIndex??r);return!Number.isFinite(s)||s<=0?r:s},pn=(t=[],r,s)=>{if(!t.length)return 0;const i=Array.isArray(r)?r:[];if(i.length>0){const p=new Map;i.forEach((u,E)=>{if(!u?.exercise_id)return;const g=p.get(u.exercise_id)??[];g.push({...u,set_index:xt(u,E+1)}),p.set(u.exercise_id,g)});let f=t.length+1;for(let u=0;u<t.length;u+=1){const E=t[u];if((p.get(E.exercise_id)??[]).length<(E.sets??0)){f=u+1;break}}return f}const l=Number(s??0);if(!Number.isFinite(l)||l<=0)return 0;const o=Math.min(t.length,Math.max(0,Math.round(l/100*t.length)));return Math.min(t.length,o+1)},Oe=(t,r)=>{const s=Number(t);return!Number.isFinite(s)||s<=0?"—":r?`${s}${r}`:String(s)};function Ir({session:t,exercises:r,oneRMs:s,onFinish:i,onStart:l,onLogSets:o,onProgress:p,initialLogs:f,isFinishing:u,initialStep:E,onStepChange:g,initialInputOpen:S,initialSeriesOpen:b,onExitFocus:H}){const{toast:Y}=qt(),D=m.useRef(!1),[P,w]=m.useState(E??0),[M,A]=m.useState([]),[j,ce]=m.useState(0),[ve,C]=m.useState(!0),[y,R]=m.useState(0),[B,U]=m.useState(!1),[X,h]=m.useState(!1),[G,te]=m.useState(!0),[ie,V]=m.useState(3),[de,W]=m.useState(3),[pe,Pe]=m.useState(""),[Ce,Re]=m.useState(!1),[q,ue]=m.useState(1),[Fe,he]=m.useState(b??!1),[we,Le]=m.useState(S??!1),[F,xe]=m.useState("weight"),[je,be]=m.useState(""),[N,Te]=m.useState(!1),[Ye,De]=m.useState(!1),[ye,ze]=m.useState(!1);m.useEffect(()=>{let a=null;return ve&&(a=setInterval(()=>ce(x=>x+1),1e3)),()=>{a&&clearInterval(a)}},[ve]),m.useEffect(()=>{if(!N)return;const a=x=>{x.key==="Escape"&&Te(!1)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[N]),m.useEffect(()=>{let a=null;return B&&!X&&y>0?a=setInterval(()=>R(x=>x-1),1e3):y===0&&B&&(U(!1),h(!1)),()=>{a&&clearInterval(a)}},[B,X,y]);const K=t.items||[],He=P-1,k=P>0&&P<=K.length?K[He]:null,oe=k?r.find(a=>a.id===k.exercise_id):null,Xe=P<K.length?K[P]:null,Be=Xe?r.find(a=>a.id===Xe.exercise_id):null,Ne=(()=>{const a=oe?.muscle_groups??oe?.muscles??oe?.muscleGroups??[];return Array.isArray(a)?a:[]})(),me=k?.rest_seconds??0,Me=K.length?Math.min(100,Math.max(0,Math.round((P-1)/K.length*100))):0,qe=Number(k?.percent_1rm),Ve=Number.isFinite(qe)&&qe>0,Ze=Ve&&s.find(a=>a.exercise_id===k?.exercise_id)?.weight||0,J=Ve?Math.round(Ze*(qe/100)):0,[n,c]=m.useState({}),$=m.useMemo(()=>{const a=new Map;return M.forEach((x,se)=>{const _=xt(x,se+1);x.exercise_id&&a.set(`${x.exercise_id}-${_}`,x)}),a},[M]),ne=k?`${k.exercise_id}-${q}`:null,le=ne?$.get(ne):null,Se=le?.weight??n[q-1]?.weight??J,v=le?.reps??n[q-1]?.reps??k?.reps??"",I=()=>{if(typeof window>"u")return;const a=["#22c55e","#3b82f6","#f97316","#e11d48","#a855f7"],x=120;for(let se=0;se<x;se+=1){const _=document.createElement("div"),Ae=Math.random()*6+6;_.style.position="fixed",_.style.top="-10px",_.style.left=`${Math.random()*100}vw`,_.style.width=`${Ae}px`,_.style.height=`${Ae*.6}px`,_.style.backgroundColor=a[se%a.length],_.style.opacity="0.9",_.style.pointerEvents="none",_.style.zIndex="9999",_.style.borderRadius="2px",document.body.appendChild(_);const Ie=(Math.random()-.5)*200,et=1200+Math.random()*800,ct=Math.random()*360;_.animate([{transform:"translate3d(0, 0, 0) rotate(0deg)",opacity:1},{transform:`translate3d(${Ie}px, ${window.innerHeight+200}px, 0) rotate(${ct}deg)`,opacity:0}],{duration:et,easing:"ease-out"}).onfinish=()=>_.remove()}};m.useEffect(()=>{if(D.current){f&&A(f);return}if(!f){A(_=>_.length?[]:_),c(_=>Object.keys(_).length?{}:_);return}if(A(f),!f.length){c(_=>Object.keys(_).length?{}:_),w(_=>_===0?_:0);return}const a=t.items||[];if(!a.length)return;const x=new Map;f.forEach((_,Ae)=>{if(!_.exercise_id)return;const Ie=x.get(_.exercise_id)??[];Ie.push({..._,set_index:xt(_,Ae+1)}),x.set(_.exercise_id,Ie)});const se=pn(a,f);if(se>0&&se<=a.length){const _=a[se-1],Ae=x.get(_.exercise_id)??[],Ie=Ae.reduce((ct,gt,xn)=>{const gn=xt(gt,xn+1);return ct[gn-1]={reps:gt.reps??void 0,weight:gt.weight??void 0},ct},{});c(Ie);const et=Math.min(_.sets??1,Ae.length+1);ue(et)}else c({}),ue(1);w(_=>_===se?_:se)},[f,t.items]),m.useEffect(()=>{P<=K.length||Ce||(I(),Re(!0))},[P,K.length,Ce]);const O=a=>{w(a),g?.(a)},T=a=>{a<=0||(R(a),U(!0),h(!1))},z=async()=>{window.scrollTo({top:0,behavior:"smooth"});const a=P+1;ue(1),c({}),O(a);const x=Math.round(Math.min(a-1,K.length)/K.length*100);try{await p?.(x)}catch{Y({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}},re=async()=>{if(!k)return;if(le){q>=k.sets?await z():ue(x=>Math.min(k.sets,x+1));return}const a={exercise_id:k.exercise_id,set_number:q,reps:n[q-1]?.reps||k.reps,weight:n[q-1]?.weight||J};A(x=>[...x,a]),D.current=!0;try{await o?.([a])}catch{Y({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}finally{D.current=!1}if(G&&k.rest_seconds>0&&T(k.rest_seconds),q>=k.sets){await z();return}ue(x=>Math.min(k.sets,x+1))},Z=a=>{xe(a);const x=a==="weight"?n[q-1]?.weight??J??"":n[q-1]?.reps??k?.reps??"";be(x?String(x):""),Le(!0)},Ee=()=>{if(!k)return;const a=Number(F==="weight"?je.replace(",","."):je);Number.isFinite(a)&&(c(x=>({...x,[q-1]:{...x[q-1],[F]:a}})),Le(!1))},fe=a=>{be(x=>a==="."&&x.includes(".")?x:x+a)},ke=a=>{if(!k)return;xe(a);const x=a==="weight"?n[q-1]?.weight??J??"":n[q-1]?.reps??k?.reps??"";be(x?String(x):"")};return P===0?e.jsxs("div",{className:"space-y-6 text-center py-8 animate-in zoom-in duration-300",children:[e.jsx("div",{className:"h-24 w-24 bg-primary/10 rounded-full flex items-center justify-center mx-auto animate-pulse",children:e.jsx(Ke,{className:"h-10 w-10 text-primary ml-1"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold font-display uppercase",children:t.title}),e.jsx("p",{className:"text-muted-foreground text-lg",children:t.description}),e.jsxs("div",{className:"flex gap-2 justify-center mt-4",children:[e.jsx(ot,{variant:"outline",className:"text-sm px-3 py-1",children:t.cycle}),e.jsxs(ot,{variant:"secondary",className:"text-sm px-3 py-1",children:[K.length," Exercices"]})]})]}),e.jsx(L,{size:"lg",className:"w-full text-xl h-14 font-bold uppercase tracking-wider shadow-lg hover:scale-[1.02] transition-transform",disabled:Ye,onClick:async()=>{De(!0);try{await l?.(),O(1)}finally{De(!1)}},children:Ye?e.jsxs(e.Fragment,{children:[e.jsx(Gn,{className:"mr-2 h-5 w-5 animate-spin"}),"CHARGEMENT..."]}):"COMMENCER SÉANCE"})]}):P>K.length?e.jsx("div",{className:"space-y-6 animate-in fade-in",children:e.jsxs(Qe,{className:"border-t-8 border-t-primary shadow-xl",children:[e.jsxs(St,{className:"text-center pb-2",children:[e.jsx("div",{className:"mx-auto bg-primary/10 p-4 rounded-full w-fit mb-4",children:e.jsx(Yn,{className:"h-12 w-12 text-primary"})}),e.jsx(_t,{className:"text-3xl uppercase font-display italic",children:"Séance Terminée !"}),e.jsxs(Vt,{className:"text-lg",children:["Durée totale: ",Math.floor(j/60),"m ",j%60,"s"]})]}),e.jsxs(Ct,{className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Volume"}),e.jsxs("div",{className:"text-2xl font-mono font-bold",children:[M.reduce((a,x)=>a+(Number(x.weight)||0)*(Number(x.reps)||0),0)," kg"]})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Séries"}),e.jsx("div",{className:"text-2xl font-mono font-bold",children:M.length})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Ge,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Difficulté de la séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Facile"}),e.jsx("span",{children:"Très dur"})]}),e.jsx(zt,{value:ie,onChange:V})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Ge,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Fatigue fin de séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Frais"}),e.jsx("span",{children:"Épuisé"})]}),e.jsx(zt,{value:de,onChange:W})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ge,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Notes"}),e.jsx("textarea",{placeholder:"Sensations, douleurs...",value:pe,onChange:a=>Pe(a.target.value),rows:3,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none"})]})]}),e.jsx(Cn,{children:e.jsx(L,{className:"w-full h-14 text-lg font-bold uppercase",disabled:u,onClick:()=>{u||i({duration:Math.floor(j/60),feeling:ie,fatigue:de,comments:pe,logs:M})},children:u?"ENREGISTREMENT...":"ENREGISTRER & FERMER"})})]})}):e.jsxs("div",{className:"space-y-6 pb-32",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button","aria-label":"Voir l’animation de l’exercice",onClick:()=>{oe?.illustration_gif&&Te(!0)},className:"flex h-12 w-12 items-center justify-center overflow-hidden rounded-full border bg-card shadow-sm",children:oe?.illustration_gif?e.jsx("img",{src:oe.illustration_gif,alt:"",className:"h-full w-full object-cover",loading:"lazy",decoding:"async"}):e.jsx(Ke,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold",children:["Ex ",P,"/",K.length]}),e.jsxs("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold",children:["S ",q,"/",Oe(k?.sets)]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Séance"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-28 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${Me}%`}})}),e.jsxs("div",{className:"text-sm font-semibold",children:[Me,"%"]})]}),H?e.jsx(L,{variant:"ghost",size:"icon","aria-label":"Quitter le focus",onClick:()=>{M.length>0?ze(!0):H()},children:e.jsx(ht,{className:"h-4 w-4"})}):null]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold tracking-tight",children:oe?.nom_exercice??"Exercice"}),Ne.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:Ne.map(a=>e.jsx("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:a},a))})]}),e.jsxs(Qe,{className:"rounded-3xl border bg-card p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-base font-semibold",children:"Série en cours"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Rt,{checked:G,onCheckedChange:te}),"Auto repos"]})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border bg-muted/20 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"En cours"}),e.jsxs("div",{className:"mt-2 text-lg font-semibold",children:["Série ",q,"/",Oe(k?.sets)," · Objectif"," ",Oe(k?.reps)," reps"]}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:"Appuie sur une tuile pour saisir."})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>Z("weight"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:Se||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>Z("reps"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:v||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"reps"})]})]})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border bg-muted/10 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Notes"}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:k?.notes||oe?.description||"Aucune note spécifique."})]}),e.jsx(L,{type:"button",variant:"outline",className:"mt-4 w-full rounded-2xl",onClick:()=>he(!0),children:"Voir les séries"})]}),!we&&!B?e.jsxs(fn,{className:"bottom-0 z-[60]",containerClassName:"gap-3 py-4",children:[e.jsxs(L,{className:"flex-1 min-w-0 h-12 rounded-xl text-sm font-bold shadow-lg active:scale-95 transition-transform",onClick:re,children:[e.jsx(Ot,{className:"mr-2 h-5 w-5"})," Valider série"]}),e.jsx(L,{type:"button",variant:"outline",className:"h-12 w-12 rounded-xl p-0 active:scale-95 transition-transform",onClick:()=>{me<=0||T(me)},"aria-label":"Démarrer le repos",children:e.jsx(qn,{className:"h-5 w-5"})}),e.jsx(L,{type:"button",variant:"outline",className:"h-12 w-12 rounded-xl p-0 active:scale-95 transition-transform",onClick:()=>z(),"aria-label":"Exercice suivant",children:e.jsx(Et,{className:"h-5 w-5"})})]}):null,B&&e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-background/95 pb-[env(safe-area-inset-bottom)]",children:[e.jsxs("div",{className:"flex items-start justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Timer"}),e.jsx("div",{className:"text-lg font-semibold",children:"Transition inter-exercice"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Prochain exercice : ",Be?.nom_exercice??"À venir"]})]}),e.jsx(L,{variant:"ghost",size:"icon",onClick:()=>{U(!1),h(!1)},"aria-label":"Fermer le timer de repos",children:e.jsx(ht,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-6 px-6 py-8",children:[e.jsxs(Qe,{className:"w-full max-w-sm rounded-3xl border p-6 shadow-sm",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Temps restant"}),e.jsxs("div",{className:"mt-2 text-5xl font-semibold tracking-tight",children:[Math.floor(y/60),":",String(y%60).padStart(2,"0")]}),e.jsx("div",{className:"mt-6 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:me?`${y/me*100}%`:"0%"}})}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[e.jsx(L,{variant:"outline",className:"rounded-full",onClick:()=>R(a=>a+15),children:"+15s"}),e.jsx(L,{variant:"outline",className:"rounded-full",onClick:()=>R(a=>a+30),children:"+30s"}),e.jsx(L,{variant:"outline",className:"rounded-full",onClick:()=>R(a=>Math.max(0,a-15)),children:"-15s"}),e.jsxs(L,{variant:"outline",className:"ml-auto rounded-full",onClick:()=>R(me),children:[e.jsx(tr,{className:"mr-2 h-4 w-4"}),"Reset"]})]})]}),e.jsxs("div",{className:"flex w-full max-w-sm flex-wrap gap-3",children:[e.jsxs(L,{className:"flex-1 rounded-full py-6 text-base font-semibold",onClick:()=>h(a=>!a),children:[e.jsx(Zn,{className:"mr-2 h-4 w-4"})," ",X?"Reprendre":"Pause"]}),e.jsxs(L,{variant:"outline",className:"rounded-full px-6 py-6 text-base font-semibold",onClick:()=>{U(!1),R(0),h(!1)},children:["Passer ",e.jsx(Et,{className:"ml-2 h-4 w-4"})]})]})]})]}),N&&oe?.illustration_gif&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:()=>Te(!1),children:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button","aria-label":"Fermer",className:"absolute -right-3 -top-3 rounded-full bg-background p-2 shadow",onClick:()=>Te(!1),children:e.jsx(ht,{className:"h-4 w-4"})}),e.jsx("img",{src:oe.illustration_gif,alt:"",className:"max-h-[80vh] w-auto max-w-[92vw] rounded-2xl",loading:"lazy"})]})})}),e.jsx(Ut,{open:Fe,onOpenChange:he,children:e.jsxs(Wt,{side:"bottom",className:"max-h-[80vh] overflow-y-auto",children:[e.jsx(Kt,{children:e.jsx(Qt,{children:"Aperçu séance"})}),e.jsx("div",{className:"mt-4 space-y-4",children:K.map((a,x)=>{const se=r.find(Ie=>Ie.id===a.exercise_id),_=Array.from({length:a.sets}).filter((Ie,et)=>$.get(`${a.exercise_id}-${et+1}`)).length,Ae=a.sets?Math.round(_/a.sets*100):0;return e.jsxs(Qe,{className:"rounded-3xl border bg-muted/10 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:se?.nom_exercice??a.exercise_name}),e.jsxs("div",{className:"mt-1 text-sm text-muted-foreground",children:[Oe(a.sets),"x",Oe(a.reps)," ·"," ",a.percent_1rm?`${Oe(a.percent_1rm)} 1RM`:"—"]})]}),e.jsxs("div",{className:"rounded-full bg-muted px-3 py-1 text-sm font-semibold",children:[_,"/",Oe(a.sets)]})]}),e.jsx("div",{className:"mt-4 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${Ae}%`}})})]},`${a.exercise_id}-${x}`)})})]})}),e.jsx(on,{open:we,onOpenChange:Le,children:e.jsx(cn,{className:"max-h-[90vh]",children:e.jsxs("div",{className:"mx-auto w-full max-w-md px-4 pb-8",children:[e.jsxs(dn,{className:"pb-2",children:[e.jsx(un,{className:"text-center",children:F==="weight"?"Charge":"Répétitions"}),e.jsxs(mn,{className:"text-center",children:["Série ",q,"/",Oe(k?.sets)," · Objectif"," ",Oe(k?.reps)," reps"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("button",{type:"button",className:ge("rounded-xl border-2 p-4 text-center transition-all",F==="weight"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>ke("weight"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[F==="weight"?je||"—":String(n[q-1]?.weight??J??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:ge("rounded-xl border-2 p-4 text-center transition-all",F==="reps"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>ke("reps"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[F==="reps"?je||"—":String(n[q-1]?.reps??k?.reps??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"reps"})]})]})]}),F==="weight"&&J>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[J-10,J-5,J,J+5,J+10].filter(a=>a>0).map(a=>e.jsxs(L,{variant:Number(je)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>be(String(a)),children:[a," kg"]},a))})]}),F==="reps"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[6,8,10,12,15,20].map(a=>e.jsx(L,{variant:Number(je)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>be(String(a)),children:a},a))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[[1,2,3,4,5,6,7,8,9].map(a=>e.jsx(L,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>fe(String(a)),children:a},a)),e.jsx(L,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>fe("."),children:","}),e.jsx(L,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>fe("0"),children:"0"}),e.jsx(L,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>be(a=>a.slice(0,-1)),children:"⌫"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(L,{variant:"outline",className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:()=>be(""),children:"Effacer"}),e.jsxs(L,{className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:Ee,children:[e.jsx(Ot,{className:"mr-2 h-5 w-5"}),"Valider"]})]})]})})}),H&&e.jsx(On,{open:ye,onOpenChange:ze,children:e.jsxs($n,{children:[e.jsxs(Pn,{children:[e.jsx(Fn,{children:"Quitter la séance ?"}),e.jsx(Ln,{children:"Les séries enregistrées seront conservées."})]}),e.jsxs(Hn,{children:[e.jsx(zn,{children:"Annuler"}),e.jsx(Bn,{onClick:()=>{ze(!1),H()},children:"Quitter"})]})]})})]})}const We=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance",at=t=>{const r=Number(t);return!Number.isFinite(r)||r<=0?null:r},Or=(t,r)=>{if(!t)return{sets:null,reps:null,percent1rm:null,restSeries:null,restExercise:null};const s={endurance:{sets:t.Nb_series_endurance,reps:t.Nb_reps_endurance,percent1rm:t.pct_1rm_endurance,restSeries:t.recup_endurance,restExercise:t.recup_exercices_endurance},hypertrophie:{sets:t.Nb_series_hypertrophie,reps:t.Nb_reps_hypertrophie,percent1rm:t.pct_1rm_hypertrophie,restSeries:t.recup_hypertrophie,restExercise:t.recup_exercices_hypertrophie},force:{sets:t.Nb_series_force,reps:t.Nb_reps_force,percent1rm:t.pct_1rm_force,restSeries:t.recup_force,restExercise:t.recup_exercices_force}}[r];return{sets:at(s.sets),reps:at(s.reps),percent1rm:at(s.percent1rm),restSeries:at(s.restSeries),restExercise:at(s.restExercise)}},it=(t=[],r,s)=>Pr(t,r).map(i=>{const l=Or(s.get(i.exercise_id),r);return{...i,sets:l.sets??0,reps:l.reps??0,rest_seconds:l.restSeries??0,percent_1rm:l.percent1rm??0}}),Bt=t=>{const r=Number(t);return!Number.isFinite(r)||r<=0?"—":String(r)},$r=t=>{const r=Number(t);return!Number.isFinite(r)||r<=0?"—":`${r}s`},hn=(t=[])=>{if(!t.length)return t;const r=t.map((i,l)=>{const o=Number(i.order_index);return{item:i,index:l,order:Number.isFinite(o)?o:null}});return r.some(i=>i.order!==null)?r.sort((i,l)=>i.order===null&&l.order===null?i.index-l.index:i.order===null?1:l.order===null?-1:i.order===l.order?i.index-l.index:i.order-l.order).map(i=>i.item):t},Pr=(t=[],r)=>{const s=t.filter(l=>l.cycle_type===r),i=s.length?s:t;return hn(i)},Fr=t=>{t.setActiveSession(null),t.setActiveAssignment(null),t.setActiveRunId(null),t.setActiveRunLogs(null),t.setActiveRunnerStep(0),t.setScreenMode("list")},Lr=({runId:t,assignmentId:r,startedAt:s})=>({id:t,assignment_id:r??null,started_at:s,progress_pct:0,status:"in_progress",logs:[]}),Nt=t=>({runs:t?[t]:[],pagination:{limit:1,offset:0,total:t?1:0},exercise_summary:[]});function os(){const{user:t,userId:r,role:s,selectedAthleteId:i,selectedAthleteName:l}=Rn(),{toast:o}=qt(),p=Sn(),f="strength-preferences",[u,E]=m.useState(null),[g,S]=m.useState(null),[b,H]=m.useState(null),[Y,D]=m.useState(null),[P,w]=m.useState(0),[M,A]=m.useState("list"),[j,ce]=m.useState({poolMode:!1,largeText:!1}),[ve,C]=m.useState(""),[y,R]=m.useState("endurance"),[B,U]=m.useState("all"),[X,h]=m.useState(""),[G,te]=m.useState(""),ie=(s==="coach"||s==="admin")&&(i!==null||!!l),V=ie?l:t,de=ie?i:r,W=de??V,pe=m.useMemo(()=>`strength-focus-state-${W??"anonymous"}`,[W]),{poolMode:Pe,largeText:Ce}=j;m.useEffect(()=>{if(typeof window>"u")return;const n=window.localStorage.getItem(f);if(n)try{const c=JSON.parse(n);ce($=>({...$,...c??{}}))}catch{return}},[]),m.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(f,JSON.stringify(j))},[f,j]),m.useEffect(()=>{if(!(typeof document>"u")){if(M==="focus")return document.body.dataset.focusMode="strength",()=>{document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode};document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode}},[M]),m.useEffect(()=>{if(typeof window>"u"||u)return;const n=window.localStorage.getItem(pe);if(n)try{const c=JSON.parse(n),$=c?.screenMode==="focus"?"focus":c?.screenMode==="reader"?"reader":null;if(!$||!c?.session)return;E(c.session),S(c.assignment??null),H(typeof c.runId=="number"?c.runId:null),D(Array.isArray(c.runLogs)?c.runLogs:null),w(Number.isFinite(c.runnerStep)?c.runnerStep:0),c.cycleType&&R(We(c.cycleType)),A($)}catch{return}},[u,pe]),m.useEffect(()=>{if(typeof window>"u")return;if(!(M==="focus"||M==="reader")||!u){window.localStorage.removeItem(pe);return}const c={screenMode:M,session:u,assignment:g,runId:b,runLogs:Y,runnerStep:P,cycleType:y};window.localStorage.setItem(pe,JSON.stringify(c))},[g,b,Y,P,u,y,pe,M]);const{data:Re}=tt({queryKey:["assignments",t,"strength"],queryFn:()=>_e.getAssignments(t,r,{assignmentType:"strength"}),enabled:!!t}),{data:q}=tt({queryKey:["strength_catalog"],queryFn:()=>_e.getStrengthSessions()}),{data:ue}=tt({queryKey:["exercises"],queryFn:()=>_e.getExercises()}),{data:Fe}=tt({queryKey:["1rm",t,r],queryFn:()=>_e.get1RM({athleteName:t,athleteId:r}),enabled:!!t}),he=_n({queryKey:["strength_history",W,B,X,G],queryFn:({pageParam:n=0})=>_e.getStrengthHistory(V,{athleteId:de,limit:10,offset:n,order:"desc",status:B==="all"?void 0:B,from:X||void 0,to:G||void 0}),enabled:!!V,getNextPageParam:n=>{const c=n.pagination.offset+n.pagination.limit;return c<n.pagination.total?c:void 0},initialPageParam:0}),we=he.data?.pages.flatMap(n=>n.runs)??[],F=tt({queryKey:["strength_run_in_progress",W],queryFn:()=>_e.getStrengthHistory(V,{limit:1,offset:0,order:"desc",status:"in_progress",athleteId:de}),enabled:!!V}).data?.runs?.[0]??null,xe=F?.status==="completed"||(F?.progress_pct??0)>=100,je=nt({mutationFn:n=>_e.startStrengthRun(n),onSuccess:n=>{if(n?.run_id&&(H(n.run_id),D(c=>c??[]),W)){const c=Lr({runId:n.run_id,assignmentId:g?.id??null,startedAt:new Date().toISOString()});p.setQueryData(["strength_run_in_progress",W],Nt(c))}p.invalidateQueries({queryKey:["assignments",t,"strength"]}),p.invalidateQueries({queryKey:["strength_run_in_progress",W]}),p.invalidateQueries({queryKey:["strength_history"]})},onError:()=>{o({title:"Erreur",description:"Impossible de démarrer la séance.",variant:"destructive"})}}),be=nt({mutationFn:n=>_e.logStrengthSet(n),onSuccess:n=>{n?.one_rm_updated&&(p.invalidateQueries({queryKey:["1rm",t,r]}),o({title:"Nouveau 1RM détecté",description:"Ton record vient d'être mis à jour."}))},onError:()=>{o({title:"Erreur",description:"Impossible d'enregistrer une série.",variant:"destructive"})}}),N=nt({mutationFn:n=>_e.updateStrengthRun(n),onSuccess:(n,c)=>{p.invalidateQueries({queryKey:["strength_history"]}),c?.status==="completed"&&(W&&p.setQueryData(["strength_run_in_progress",W],Nt(null)),p.invalidateQueries({queryKey:["assignments",t]}),p.invalidateQueries({queryKey:["assignments",t,"strength"]}),p.invalidateQueries({queryKey:["1rm",t,r]}),S(null),H(null),E(null),D(null),A("list"),o({title:"Séance sauvegardée",description:"Bravo pour l'effort !"}))}});nt({mutationFn:n=>_e.startStrengthRun(n),onError:()=>{o({title:"Erreur",description:"Impossible de mettre à jour la séance.",variant:"destructive"})}});const Te=(n,c)=>{const $=n.items??[],ne=We(c??n.cycle??$.find(Se=>Se.cycle_type)?.cycle_type),le=it($,ne,k);S(n),E({...n,title:n.title,description:n.description,cycle:ne,items:le}),H(null),D(null),w(0),A("reader")},De=(Re?.filter(n=>n.session_type==="strength")||[]).filter(n=>n.status!=="completed"),ye=F?De.find(n=>n.id===F.assignment_id):null,ze=!!ye?.items?.length&&!xe,K=De.map(n=>({...n,session:{id:n.session_id,title:n.title,description:n.description,cycle:We(n.cycle),items:n.items??[]}})),He=[{value:"endurance",label:"Endurance"},{value:"hypertrophie",label:"Hypertrophie"},{value:"force",label:"Force"}],k=m.useMemo(()=>ue?new Map(ue.map(n=>[n.id,n])):new Map,[ue]),oe=K.map(n=>{const c=it(n.items??[],y,k);return{key:`assignment-${n.id}`,title:n.title,description:n.description,type:"assignment",assignedDate:n.assigned_date,session:{id:n.session_id,title:n.title,description:n.description,cycle:We(n.cycle),items:c},assignment:n,exerciseCount:c.length}}),Xe=(q??[]).map(n=>{const c=it(n.items??[],y,k);return{key:`catalog-${n.id}`,title:n.title,description:n.description,type:"catalog",session:{...n,items:c,cycle:y},exerciseCount:c.length}}),Be=ve.trim().toLowerCase(),Ne=[...oe,...Xe].filter(n=>Be?`${n.title} ${n.description}`.toLowerCase().includes(Be):!0),me=m.useMemo(()=>u?it(u.items??[],y,k):[],[u,y,k]),Me=n=>{if((n.items??[]).length===0){o({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}Te(n,y),H(null),D(null)},qe=n=>{const c=n.items??[],ne=c.filter(Se=>Se.cycle_type===y).length>0?y:We(n.cycle??c.find(Se=>Se.cycle_type)?.cycle_type),le=it(c,ne,k);if(le.length===0){o({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}E({...n,cycle:ne,items:le}),S(null),H(null),D(null),w(0),A("reader")},Ve=()=>{if(u){if(me.length===0){o({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}E({...u,cycle:y,items:me}),w(0),A("focus")}},Ze=()=>{Fr({setActiveSession:E,setActiveAssignment:S,setActiveRunId:H,setActiveRunLogs:D,setActiveRunnerStep:w,setScreenMode:A})},J=nt({mutationFn:n=>_e.deleteStrengthRun(n),onSuccess:n=>{Ze(),W&&p.setQueryData(["strength_run_in_progress",W],Nt(null)),p.invalidateQueries({queryKey:["strength_run_in_progress",W]}),p.invalidateQueries({queryKey:["strength_history"]}),p.invalidateQueries({queryKey:["assignments",t,"strength"]});const c=n?.source==="local"?"Suppression locale : le serveur n'est pas disponible.":void 0;o({title:"Séance supprimée",description:c})},onError:()=>{o({title:"Erreur",description:"Impossible de supprimer la séance en cours.",variant:"destructive"})}});return e.jsx("div",{className:ge("space-y-4 md:space-y-6",Pe&&"dark bg-background text-foreground contrast-125",Ce&&"text-lg leading-relaxed [&_.text-xs]:text-sm [&_.text-sm]:text-base"),children:M==="focus"&&u?ue?e.jsx("div",{className:"animate-in fade-in motion-reduce:animate-none",children:e.jsx(Ir,{session:u,exercises:ue,oneRMs:Fe||[],initialLogs:Y,initialStep:P,isFinishing:N.isPending,onStepChange:n=>w(n),onExitFocus:()=>A("reader"),onStart:async()=>{if(b)return;const n=g?.session_id??u?.id??null;if(!n){o({title:"Session manquante",description:"Impossible de démarrer sans session associée.",variant:"destructive"});return}const c={assignment_id:g?.id??null,athlete_id:r??null,athleteName:t??void 0,progress_pct:0,session_id:n,cycle_type:u?.cycle};try{const $=await je.mutateAsync(c);$?.run_id&&H($.run_id)}catch{return}},onLogSets:async n=>{b&&(D(c=>[...c??[],...n]),await Promise.all(n.map((c,$)=>be.mutateAsync({run_id:b,exercise_id:c.exercise_id,set_index:c.set_number??$+1,reps:c.reps??null,weight:c.weight??null,athlete_id:r??null,athlete_name:t??null}))))},onProgress:async n=>{b&&await N.mutateAsync({run_id:b,progress_pct:n,status:"in_progress"})},onFinish:n=>{b&&N.mutate({assignment_id:g?.id??void 0,run_id:b,session_id:g?.session_id??u?.id??void 0,athlete_id:r??void 0,date:new Date().toISOString(),progress_pct:100,status:"completed",...n})}})}):e.jsxs("div",{className:"space-y-4 py-10",children:[e.jsx("div",{className:"mx-auto h-8 w-48 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"mx-auto h-4 w-32 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"space-y-3 pt-4",children:[1,2,3].map(n=>e.jsx("div",{className:"h-20 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},n))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Musculation"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(L,{variant:"ghost",size:"sm","aria-label":"Informations sur le calcul du 1RM",onClick:()=>o({title:"Info",description:"Le 1RM est calculé automatiquement."}),className:"text-muted-foreground",children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"})," Info 1RM"]}),e.jsx(L,{variant:"ghost",size:"icon",onClick:()=>A("settings"),className:"rounded-full border border-muted/50 text-muted-foreground","aria-label":"Paramètres",children:e.jsx(rr,{className:"h-4 w-4"})})]})]}),e.jsxs(An,{defaultValue:"start",className:"w-full",children:[e.jsxs(In,{className:"grid w-full grid-cols-2",children:[e.jsx(Mt,{value:"start",children:"S'entraîner"}),e.jsx(Mt,{value:"history",children:"Historique"})]}),e.jsxs(At,{value:"start",className:"space-y-5 pt-4",children:[M==="list"&&e.jsxs("div",{className:"space-y-5 animate-in fade-in motion-reduce:animate-none",children:[e.jsxs("p",{className:"text-center text-sm text-muted-foreground py-1",children:[Ne.length," séance",Ne.length>1?"s":""," disponible",Ne.length>1?"s":""]}),e.jsx("div",{className:"flex justify-center gap-2",children:He.map(n=>e.jsx("button",{type:"button",onClick:()=>R(We(n.value)),className:ge("px-5 py-2.5 rounded-full text-sm font-semibold transition-all active:scale-95",y===n.value?"bg-primary text-primary-foreground shadow-md":"bg-muted/50 text-muted-foreground hover:bg-muted"),children:n.label},n.value))}),e.jsxs("div",{className:"relative",children:[e.jsx(Un,{className:"absolute left-4 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground pointer-events-none"}),e.jsx(vt,{placeholder:"Rechercher une séance...",className:"h-12 rounded-2xl bg-muted/30 pl-11 pr-4 border-0 shadow-sm focus-visible:ring-2",value:ve,onChange:n=>C(n.target.value),"aria-label":"Rechercher une séance"})]}),F&&e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border-2 border-primary/30 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-primary/10 rounded-full blur-2xl -mr-8 -mt-8"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-primary"})]}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-primary",children:xe?"Complétée":"En cours"})]}),e.jsx("h3",{className:"text-xl font-bold tracking-tight mb-1",children:ye?.title??"Séance en cours"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Démarrée le ",mt(new Date(F.started_at||new Date),"dd MMMM",{locale:ut})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs font-semibold mb-1.5",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progression"}),e.jsxs("span",{className:"text-primary",children:[Math.round(F.progress_pct??0),"%"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-primary transition-all duration-500",style:{width:`${F.progress_pct??0}%`}})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{className:"flex-1 h-12 rounded-xl font-semibold",disabled:!ze,onClick:()=>{if(!ye)return;const n=ye.items??[],c=We(ye.cycle??n.find(le=>le.cycle_type)?.cycle_type),$=n.filter(le=>le.cycle_type===c),ne=hn($.length?$:n);S(ye),E({...ye,title:ye.title,description:ye.description,cycle:c,items:ne}),H(F.id),D(F.logs??[]),w(pn(ne,F.logs??[],F.progress_pct)),A("focus")},children:xe?"Voir le résumé":"Reprendre"}),!xe&&e.jsx(L,{variant:"outline",className:"h-12 w-12 rounded-xl p-0",disabled:J.isPending,onClick:()=>{!F||!window.confirm("Supprimer la séance en cours ?")||J.mutate(F.id)},"aria-label":"Supprimer la séance",children:e.jsx(ht,{className:"h-5 w-5"})})]})]})]}),!F&&Ne.length>0&&e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(Ke,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Choisir une séance"})]}),Ne.length>0?e.jsx("div",{className:"space-y-3",children:Ne.map(n=>e.jsx("button",{type:"button",className:"group w-full rounded-2xl border bg-card p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:shadow-md hover:border-primary/30",onClick:()=>{if(n.type==="assignment"){Me(n.assignment);return}qe(n.session)},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:ge("flex h-12 w-12 shrink-0 items-center justify-center rounded-xl",n.type==="assignment"?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"),children:e.jsx(Ke,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[n.type==="assignment"&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-primary/10 px-2 py-0.5 text-[10px] font-bold uppercase text-primary",children:"Assignée"}),n.type==="assignment"&&n.assignedDate&&e.jsx("span",{className:"text-xs text-muted-foreground",children:mt(new Date(n.assignedDate),"dd MMM",{locale:ut})})]}),e.jsx("h3",{className:"font-semibold tracking-tight truncate",children:n.title}),e.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:[n.exerciseCount," exercice",n.exerciseCount>1?"s":"",n.description?` · ${n.description}`:""]})]}),e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors group-hover:bg-primary group-hover:text-primary-foreground",children:e.jsx(It,{className:"h-4 w-4 ml-0.5"})})]})},n.key))}):e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-muted",children:e.jsx(Ke,{className:"h-7 w-7 text-muted-foreground"})}),e.jsx("h3",{className:"font-semibold",children:"Aucune séance"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Essayez un autre mot-clé ou changez de cycle."})]})]}),M==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(L,{variant:"ghost",size:"sm",onClick:()=>A("list"),className:"gap-2",children:[e.jsx($t,{className:"h-4 w-4"}),"Retour"]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Préférences"}),e.jsx("h2",{className:"text-2xl font-display font-bold uppercase text-primary",children:"Paramètres"})]})]}),e.jsxs(Qe,{className:"border border-muted/60 shadow-sm",children:[e.jsxs(St,{children:[e.jsx(_t,{className:"text-lg uppercase",children:"Lisibilité & contrastes"}),e.jsx(Vt,{children:"Ajuste l'écran pour rester lisible en bassin comme en extérieur."})]}),e.jsxs(Ct,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Mode piscine"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Contraste renforcé et lisibilité optimisée."})]}),e.jsx(Rt,{checked:Pe,onCheckedChange:n=>ce(c=>({...c,poolMode:n}))})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Texte grand"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Police plus large pour lire pendant l'effort."})]}),e.jsx(Rt,{checked:Ce,onCheckedChange:n=>ce(c=>({...c,largeText:n}))})]})]})]}),e.jsx(Qe,{className:"border border-muted/60 shadow-sm",children:e.jsxs(Ct,{className:"space-y-3 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsx(Vn,{className:"h-4 w-4"}),e.jsx("span",{children:"Les préférences sont enregistrées sur cet appareil."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs font-semibold uppercase text-muted-foreground",children:[Pe&&e.jsx(ot,{variant:"secondary",children:"Mode piscine activé"}),Ce&&e.jsx(ot,{variant:"secondary",children:"Texte grand activé"}),!Pe&&!Ce&&e.jsx(ot,{variant:"outline",children:"Réglages par défaut"})]})]})})]}),M==="reader"&&u&&e.jsxs("div",{className:"space-y-5 animate-in fade-in motion-reduce:animate-none pb-40",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>A("list"),className:"flex h-10 w-10 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors hover:bg-muted active:scale-95","aria-label":"Retour",children:e.jsx($t,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground truncate",children:He.find(n=>n.value===y)?.label}),e.jsx("h1",{className:"text-xl font-bold tracking-tight truncate",children:u.title})]})]}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border border-primary/20 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-primary/10 rounded-full blur-3xl -mr-12 -mt-12"}),e.jsxs("div",{className:"relative space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[g&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-primary/20 px-3 py-1 text-xs font-bold uppercase text-primary",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-primary"}),"Assignée"]}),!g&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:"Catalogue"}),g?.assigned_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Prévue le ",mt(new Date(g.assigned_date),"dd MMM",{locale:ut})]})]}),u.description&&e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:u.description}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(Ke,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:me.length}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Exercices"})]})]}),e.jsx("div",{className:"h-8 w-px bg-border"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(Kn,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:He.find(n=>n.value===y)?.label}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Cycle"})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-1",children:[e.jsxs("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:[me.length," exercice",me.length>1?"s":""]}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsxs("div",{className:"space-y-2",children:[me.map((n,c)=>{const $=k.get(n.exercise_id),ne=Number(n.percent_1rm),le=Number.isFinite(ne)&&ne>0,Se=le?Fe?.find(Z=>Z.exercise_id===n.exercise_id)?.weight??0:0,v=le?Math.round(Se*(ne/100)):0,I=le?v>0?`${v} kg (${ne}% 1RM)`:`${ne}% 1RM`:null,O=n.notes?.trim(),T=Bt(n.sets),z=Bt(n.reps),re=$r(n.rest_seconds);return e.jsxs(Ut,{children:[e.jsx(En,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-3 rounded-xl border bg-card px-3 py-3 text-left transition-all active:scale-[0.98] hover:border-primary/50 hover:shadow-sm",children:[e.jsx("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-primary text-xs font-bold text-primary-foreground",children:c+1}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"font-semibold text-sm truncate",children:$?.nom_exercice??n.exercise_name??"Exercice"})}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 text-xs font-medium text-muted-foreground",children:[e.jsxs("span",{className:"font-mono",children:[T,"×",z]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("span",{className:"font-mono",children:re}),e.jsx(Et,{className:"h-4 w-4 text-muted-foreground/50"})]})]})}),e.jsxs(Wt,{side:"bottom",className:"max-h-[90vh] overflow-y-auto rounded-t-3xl pb-8",children:[e.jsx(Kt,{className:"text-left pb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-primary text-sm font-bold text-primary-foreground",children:c+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(Qt,{className:"text-xl leading-tight",children:$?.nom_exercice??n.exercise_name??"Exercice"}),$?.exercise_type&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:$.exercise_type})]})]})}),e.jsxs("div",{className:"space-y-4",children:[$?.illustration_gif&&e.jsx("div",{className:"rounded-xl overflow-hidden bg-muted/20 border aspect-video flex items-center justify-center",children:e.jsx("img",{src:$.illustration_gif,alt:$.nom_exercice??"Exercice",className:"w-full h-full max-h-36 object-contain",loading:"lazy",decoding:"async"})}),$?.description&&e.jsx("div",{className:"text-sm text-muted-foreground leading-relaxed",children:$.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:T}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Séries"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:z}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Reps"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:I??"—"}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Charge"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:re}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Repos"})]})]}),O&&e.jsxs("div",{className:"rounded-xl bg-primary/5 border border-primary/20 p-4",children:[e.jsx("div",{className:"text-[10px] uppercase text-primary font-semibold mb-1",children:"Notes coach"}),e.jsx("div",{className:"text-sm text-foreground",children:O})]})]})]})]},`${n.exercise_id}-${c}`)}),me.length===0&&e.jsx("div",{className:"p-6 border-2 border-dashed rounded-xl text-center text-muted-foreground",children:"Aucun exercice disponible pour cette séance."})]}),e.jsx(fn,{children:e.jsxs(L,{className:"flex-1 h-14 rounded-xl font-bold text-base bg-primary hover:bg-primary/90 shadow-lg",onClick:Ve,children:[e.jsx(It,{className:"h-5 w-5 mr-2"}),"Lancer la séance"]})})]})]}),e.jsxs(At,{value:"history",className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Ge,{htmlFor:"strength-history-status",children:"Statut"}),e.jsxs(kn,{value:B,onValueChange:U,children:[e.jsx(Tn,{id:"strength-history-status",children:e.jsx(Dn,{placeholder:"Tous"})}),e.jsxs(Mn,{children:[e.jsx(dt,{value:"all",children:"Tous"}),e.jsx(dt,{value:"in_progress",children:"En cours"}),e.jsx(dt,{value:"completed",children:"Terminé"}),e.jsx(dt,{value:"abandoned",children:"Abandonné"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Ge,{htmlFor:"strength-history-from",children:"Du"}),e.jsx(vt,{id:"strength-history-from",type:"date",value:X,onChange:n=>h(n.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Ge,{htmlFor:"strength-history-to",children:"Au"}),e.jsx(vt,{id:"strength-history-to",type:"date",value:G,onChange:n=>te(n.target.value)})]})]}),we.map(n=>e.jsx(Qe,{className:"group hover:border-primary/50 transition-colors",children:e.jsxs(St,{className:"pb-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(_t,{className:"text-base font-bold uppercase",children:mt(new Date(n.started_at||n.date||n.created_at||new Date),"dd MMM yyyy",{locale:ut})}),e.jsxs("div",{className:"text-sm font-mono font-bold text-muted-foreground group-hover:text-primary",children:[n.duration??0," min"]})]}),e.jsxs("div",{className:"flex gap-2 text-xs font-bold text-muted-foreground",children:[e.jsxs("span",{children:["Difficulté ",n.feeling??n.rpe??0,"/5"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[n.logs?.length||0," Séries"]})]})]})},n.id)),we.length===0&&e.jsx("div",{className:"text-center text-muted-foreground py-10",children:"Aucun historique."}),he.hasNextPage&&e.jsx(L,{variant:"outline",size:"sm",className:"w-full",onClick:()=>he.fetchNextPage(),disabled:he.isFetchingNextPage,children:he.isFetchingNextPage?"Chargement...":"Charger plus"})]})]})]})})}export{Nt as buildInProgressRunCache,Lr as createInProgressRun,os as default,hn as orderStrengthItems,Fr as resetStrengthRunState};
