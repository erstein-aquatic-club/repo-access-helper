import{r as v,j as e}from"./vendor-ui-M0btmmZ9.js";import{u as ee,d as Ye}from"./vendor-query-CwV3kFk7.js";import{u as Ue,C as pe,g as je,B as Xe,T as Je,d as z}from"./index-Dd2k2fWK.js";import{T as Ze,a as et,b as te,c as I,d as tt,e as _}from"./table-FTU6MudJ.js";import{T as st,a as at,b as ve,c as ye}from"./tabs-5adjH8Rk.js";import{T as Ne,a as b}from"./toggle-group-mefZOwp_.js";import{C as nt,a as rt,b as it}from"./collapsible-CWtne18x.js";import{s as Le}from"./score-CwBbkHfb.js";import{g as ot}from"./design-tokens-CKgCpdH6.js";import{b as F}from"./animations-CrcLFysI.js";import{s as lt,a as K,e as dt,f as S}from"./vendor-date-B8Mnp-Vt.js";import{m as L}from"./proxy-C_NwhSmp.js";import{R as w,A as be,X as $,T as C,a as Se,P as ct,b as ut,C as mt,L as we,B as Ce,Y as se,d as ae,e as xt,f as gt}from"./vendor-charts-D_WtzBoI.js";import{T as ft}from"./trending-down-MAWQXoiO.js";import{C as ht}from"./chevron-down-CuPUPRYs.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-B7dJFgIA.js";function G({label:x,value:c,max:m,invert:i=!1}){const g=c!==null?Math.min(100,c/m*100):0,h=Le(c??null,{invert:i})??"hsl(var(--muted-foreground))";return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-28 shrink-0 text-xs text-muted-foreground truncate",children:x}),e.jsx("div",{className:"relative h-2 flex-1 rounded-full bg-muted overflow-hidden",children:e.jsx(L.div,{className:"absolute inset-y-0 left-0 rounded-full",style:{backgroundColor:h},initial:{width:0},animate:{width:`${g}%`},transition:{duration:.6,ease:"easeOut"}})}),e.jsx("span",{className:"w-10 text-right text-sm font-mono font-semibold tabular-nums",children:c!==null?c.toFixed(1):"-"})]})}function De({value:x,unit:c,label:m,trend:i,trendLabel:g}){return e.jsxs(L.div,{className:"flex flex-col items-center gap-1 py-4",variants:F,initial:"hidden",animate:"visible",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-4xl font-mono font-bold tracking-tight",children:x}),c&&e.jsx("span",{className:"text-lg font-mono text-muted-foreground",children:c})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:m}),i!=null&&e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-medium ${i>=0?"bg-emerald-500/10 text-emerald-600":"bg-red-500/10 text-red-600"}`,children:[i>=0?e.jsx(Je,{className:"h-3 w-3"}):e.jsx(ft,{className:"h-3 w-3"}),i>=0?"+":"",i.toFixed(0),"%",g?` ${g}`:""]})]})}function D({value:x,label:c,colored:m,colorValue:i,invert:g}){const h="rounded-full px-3 py-1 text-sm font-mono";if(m&&i!==null&&i!==void 0){const u=Le(i,{invert:g})??"hsl(var(--muted-foreground))";return e.jsx("span",{className:h,style:{backgroundColor:u,color:ot(u)},children:x})}return e.jsxs("span",{className:`${h} bg-muted text-muted-foreground`,children:[x,c?` ${c}`:""]})}function ne(){return e.jsx("div",{className:"space-y-3 animate-pulse motion-reduce:animate-none",children:e.jsx("div",{className:"h-[180px] w-full rounded-xl bg-muted"})})}function re({title:x,children:c}){const[m,i]=v.useState(!1);return e.jsxs(nt,{open:m,onOpenChange:i,children:[e.jsxs(rt,{className:"flex w-full items-center justify-between rounded-lg bg-muted/50 px-4 py-3 text-sm font-semibold hover:bg-muted transition-colors",children:[x,e.jsx(ht,{className:`h-4 w-4 text-muted-foreground transition-transform duration-200 ${m?"rotate-180":""}`})]}),e.jsx(it,{className:"pt-4 animate-in fade-in slide-in-from-top-2 motion-reduce:animate-none",children:c})]})}const Q={borderRadius:"8px",border:"none",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"};function Kt(){const{user:x,userId:c,role:m,selectedAthleteId:i,selectedAthleteName:g}=Ue(),h=(m==="coach"||m==="admin")&&(i!==null||!!g),u=h?g:x,T=h?i:c,O=T??u,[W]=v.useState("all"),[ie]=v.useState(""),[oe]=v.useState(""),[y,Te]=v.useState(30),[A,Ae]=v.useState(30),{data:N,isLoading:Pe}=ee({queryKey:["sessions",O],queryFn:()=>z.getSessions(u,T),enabled:!!u}),P=Ye({queryKey:["strength_history",O,"progress",W,ie,oe],queryFn:({pageParam:t=0})=>z.getStrengthHistory(u,{athleteId:T,limit:10,offset:t,order:"desc",status:W==="all"?void 0:W,from:ie||void 0,to:oe||void 0}),enabled:!!u,getNextPageParam:t=>{const s=t.pagination.offset+t.pagination.limit;return s<t.pagination.total?s:void 0},initialPageParam:0}),le=P.data?.pages.flatMap(t=>t.runs)??[],V=lt(K(new Date,A)).toISOString(),E=dt(new Date).toISOString(),{data:de,isLoading:ke}=ee({queryKey:["strength_history_summary",O,"progress",A,V,E],queryFn:()=>z.getStrengthHistory(u,{athleteId:T,limit:200,order:"desc",from:V,to:E}),enabled:!!u}),{data:Me,isLoading:Re}=ee({queryKey:["strength_history_aggregate",O,"progress",A,V,E],queryFn:()=>z.getStrengthHistoryAggregate(u,{athleteId:T,period:"day",limit:200,order:"asc",from:V,to:E}),enabled:!!u}),ce=ke||Re,Y=de?.runs??[],_e=de?.exercise_summary??[],p=Me?.periods??[],Ke=t=>{if(!N)return[];const s=K(new Date,t),o=N.filter(a=>new Date(a.date)>=s).reverse(),l=new Map;return o.forEach(a=>{const n=S(new Date(a.date),"dd/MM");l.has(n)||l.set(n,{date:n,distance:0,effort:0,rpe:0,performance:0,engagement:0,fatigue:0,count:0,rpeCount:0,performanceCount:0,engagementCount:0,fatigueCount:0});const r=l.get(n);r.distance+=a.distance,r.effort+=a.effort,r.count+=1,a.rpe!==null&&a.rpe!==void 0&&(r.rpe+=a.rpe,r.rpeCount+=1),a.performance!==null&&a.performance!==void 0&&(r.performance+=a.performance,r.performanceCount+=1),a.engagement!==null&&a.engagement!==void 0&&(r.engagement+=a.engagement,r.engagementCount+=1),a.fatigue!==null&&a.fatigue!==void 0&&(r.fatigue+=a.fatigue,r.fatigueCount+=1)}),Array.from(l.values()).map(a=>({...a,effort:Math.round(a.effort/a.count*10)/10,rpe:a.rpeCount?Math.round(a.rpe/a.rpeCount*10)/10:null,performance:a.performanceCount?Math.round(a.performance/a.performanceCount*10)/10:null,engagement:a.engagementCount?Math.round(a.engagement/a.engagementCount*10)/10:null,fatigue:a.fatigueCount?Math.round(a.fatigue/a.fatigueCount*10)/10:null}))},k=N?N.filter(t=>new Date(t.date)>=K(new Date,y)):[],M=k.length,d=k.reduce((t,s)=>(t.distance+=s.distance,t.duration+=s.duration,s.rpe!==null&&s.rpe!==void 0&&(t.rpeSum+=s.rpe,t.rpeCount+=1),s.performance!==null&&s.performance!==void 0&&(t.performanceSum+=s.performance,t.performanceCount+=1),s.engagement!==null&&s.engagement!==void 0&&(t.engagementSum+=s.engagement,t.engagementCount+=1),s.fatigue!==null&&s.fatigue!==void 0&&(t.fatigueSum+=s.fatigue,t.fatigueCount+=1),t),{distance:0,duration:0,rpeSum:0,rpeCount:0,performanceSum:0,performanceCount:0,engagementSum:0,engagementCount:0,fatigueSum:0,fatigueCount:0}),$e=d.rpeCount?d.rpeSum/d.rpeCount:null,Fe=d.performanceCount?d.performanceSum/d.performanceCount:null,Oe=d.engagementCount?d.engagementSum/d.engagementCount:null,Ve=d.fatigueCount?d.fatigueSum/d.fatigueCount:null,Ee=M?d.duration/M:0,Be=M?d.distance/M:0,ue=Ke(y),He=N?((t,s,o,l)=>{const a=new Date,n=K(a,o*2),r=K(a,o),R=s.filter(j=>{const f=new Date(j.date);return f>=n&&f<r}).reduce((j,f)=>j+(f.distance??0),0);return R===0?null:(t-R)/R*100})(d.distance,N,y):null,U=["NL","DOS","BR","PAP","QN"],me={NL:"NL",DOS:"Dos",BR:"Brasse",PAP:"Pap",QN:"4N"},xe={NL:"hsl(210, 80%, 55%)",DOS:"hsl(160, 60%, 45%)",BR:"hsl(35, 85%, 55%)",PAP:"hsl(280, 60%, 55%)",QN:"hsl(340, 70%, 55%)"},B=v.useMemo(()=>{if(!k.length)return{pie:[],daily:[],hasData:!1};const t={NL:0,DOS:0,BR:0,PAP:0,QN:0};let s=!1;const o=new Map;for(const n of k){const r=n.stroke_distances;if(!r)continue;const q=S(new Date(n.date),"dd/MM");o.has(q)||o.set(q,{NL:0,DOS:0,BR:0,PAP:0,QN:0});const R=o.get(q);for(const j of U){const f=r[j];f&&f>0&&(t[j]+=f,R[j]+=f,s=!0)}}const l=U.filter(n=>t[n]>0).map(n=>({name:me[n],value:t[n],fill:xe[n]})),a=Array.from(o.entries()).map(([n,r])=>({date:n,...r}));return{pie:l,daily:a,hasData:s}},[k]),X=t=>{const o=(Array.isArray(t?.logs)?t.logs:[]).map(n=>n?.rpe!==null&&n?.rpe!==void 0?Number(n.rpe):null).filter(n=>n!==null&&Number.isFinite(n));if(o.length>0)return o.reduce((n,r)=>n+r,0)/o.length;const l=t?.feeling??t?.rpe??null,a=l!=null?Number(l):null;return a!==null&&Number.isFinite(a)?a:null},qe=t=>t==null||Number.isNaN(t)?"-":t.toFixed(1),ge=[...Y].sort((t,s)=>{const o=new Date(t.started_at||t.date||t.created_at||0).getTime(),l=new Date(s.started_at||s.date||s.created_at||0).getTime();return o-l}).map(t=>({date:S(new Date(t.started_at||t.date||t.created_at||new Date),"dd/MM"),feeling:X(t)})),fe=p.map(t=>({date:t.period,label:S(new Date(t.period),"dd/MM"),tonnage:Math.round(t.tonnage??0),volume:Math.round(t.volume??0)})),ze=p.reduce((t,s)=>t+(s.tonnage??0),0),Ie=p.reduce((t,s)=>t+(s.volume??0),0),Ge=Y.length,J=Y.map(t=>X(t)).filter(t=>t!==null&&Number.isFinite(t)),H=J.length?J.reduce((t,s)=>t+s,0)/J.length:null,Z=[..._e].map(t=>({exerciseId:Number(t.exercise_id),name:t.exercise_name||`Exercice ${t.exercise_id}`,totalSets:Number(t.total_sets??0),totalReps:Number(t.total_reps??0),totalVolume:Number(t.total_volume??0),maxWeight:t.max_weight!==null&&t.max_weight!==void 0?Number(t.max_weight):null,lastPerformedAt:t.last_performed_at??null})).sort((t,s)=>s.totalVolume-t.totalVolume),Qe=(()=>{if(!p.length)return null;const t=Math.floor(p.length/2);if(t===0)return null;const s=p.slice(0,t).reduce((l,a)=>l+(a.tonnage??0),0),o=p.slice(t).reduce((l,a)=>l+(a.tonnage??0),0);return s===0?null:(o-s)/s*100})(),he=Z.slice(0,8),We=t=>{if(!t)return"-";const s=new Date(t);return Number.isNaN(s.getTime())?"-":S(s,"dd/MM/yyyy")};return e.jsxs("div",{className:"space-y-8 pb-8",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Progression"}),e.jsxs(st,{defaultValue:"swim",className:"w-full",children:[e.jsxs(at,{className:"grid w-full max-w-[280px] grid-cols-2",children:[e.jsx(ve,{value:"swim",children:"Natation"}),e.jsx(ve,{value:"strength",children:"Musculation"})]}),e.jsxs(ye,{value:"swim",className:"space-y-8 mt-6",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(Ne,{type:"single",size:"sm",variant:"outline",value:String(y),onValueChange:t=>t&&Te(Number(t)),className:"gap-1",children:[e.jsx(b,{value:"7",className:"h-8 px-3 text-xs",children:"7j"}),e.jsx(b,{value:"30",className:"h-8 px-3 text-xs",children:"30j"}),e.jsx(b,{value:"365",className:"h-8 px-3 text-xs",children:"1 an"})]})}),e.jsx(De,{value:d.distance.toLocaleString(),unit:"m",label:`volume sur ${y} jours`,trend:He,trendLabel:"vs période préc."}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[e.jsx(D,{value:`${M} séances`}),e.jsx(D,{value:`${Math.round(Be).toLocaleString()}m moy`}),e.jsx(D,{value:`${Math.round(Ee)}min moy`})]}),e.jsx(L.div,{variants:F,initial:"hidden",animate:"visible",children:e.jsx(pe,{className:"border-0 shadow-none bg-transparent",children:e.jsx(je,{className:"p-0 h-[200px] w-full",children:Pe?e.jsx(ne,{}):ue.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground",children:"Aucune donnée disponible."}):e.jsx(w,{width:"100%",height:"100%",children:e.jsxs(be,{data:ue,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"swimVolumeGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"hsl(var(--primary))",stopOpacity:.3}),e.jsx("stop",{offset:"100%",stopColor:"hsl(var(--primary))",stopOpacity:0})]})}),e.jsx($,{dataKey:"date",fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(C,{contentStyle:Q,formatter:t=>[`${t.toLocaleString()}m`,"Volume"]}),e.jsx(Se,{type:"monotone",dataKey:"distance",stroke:"hsl(var(--primary))",strokeWidth:2,fill:"url(#swimVolumeGradient)",dot:!1,activeDot:{r:5,strokeWidth:2}})]})})})})}),e.jsxs(L.div,{className:"space-y-3",variants:F,initial:"hidden",animate:"visible",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Ressentis moyens"}),e.jsx(G,{label:"Difficulté",value:$e,max:5,invert:!0}),e.jsx(G,{label:"Performance",value:Fe,max:5}),e.jsx(G,{label:"Engagement",value:Oe,max:5}),e.jsx(G,{label:"Fatigue",value:Ve,max:5,invert:!0})]}),B.hasData&&e.jsx(re,{title:`Répartition par nage (${y}j)`,children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx("div",{className:"h-[280px] w-full",children:e.jsx(w,{width:"100%",height:"100%",children:e.jsxs(ct,{children:[e.jsx(ut,{data:B.pie,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:90,label:({name:t,percent:s})=>`${t} ${(s*100).toFixed(0)}%`,children:B.pie.map((t,s)=>e.jsx(mt,{fill:t.fill},`pie-${s}`))}),e.jsx(C,{formatter:t=>[`${t.toLocaleString()}m`,"Distance"]}),e.jsx(we,{})]})})}),e.jsx("div",{className:"h-[280px] w-full",children:e.jsx(w,{width:"100%",height:"100%",children:e.jsxs(Ce,{data:B.daily,children:[e.jsx($,{dataKey:"date",fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(se,{fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(C,{}),U.map(t=>e.jsx(ae,{dataKey:t,stackId:"strokes",name:me[t],fill:xe[t],radius:0},t)),e.jsx(we,{})]})})})]})})]}),e.jsxs(ye,{value:"strength",className:"space-y-8 mt-6",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(Ne,{type:"single",size:"sm",variant:"outline",value:String(A),onValueChange:t=>t&&Ae(Number(t)),className:"gap-1",children:[e.jsx(b,{value:"7",className:"h-8 px-3 text-xs",children:"7j"}),e.jsx(b,{value:"30",className:"h-8 px-3 text-xs",children:"30j"}),e.jsx(b,{value:"365",className:"h-8 px-3 text-xs",children:"1 an"})]})}),e.jsx(De,{value:Math.round(ze).toLocaleString(),unit:"kg",label:`tonnage sur ${A} jours`,trend:Qe,trendLabel:"tendance"}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[e.jsx(D,{value:`${Ge} séances`}),e.jsx(D,{value:`${Math.round(Ie).toLocaleString()} reps`}),e.jsx(D,{value:`RPE ${H!==null?H.toFixed(1):"-"}/10`,colored:!0,colorValue:H!==null?H/2:null,invert:!0})]}),e.jsx(L.div,{variants:F,initial:"hidden",animate:"visible",children:e.jsx(pe,{className:"border-0 shadow-none bg-transparent",children:e.jsx(je,{className:"p-0 h-[200px] w-full",children:ce?e.jsx(ne,{}):fe.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground",children:"Aucune donnée disponible."}):e.jsx(w,{width:"100%",height:"100%",children:e.jsxs(xt,{data:fe,children:[e.jsx($,{dataKey:"label",fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(C,{contentStyle:Q}),e.jsx(ae,{dataKey:"tonnage",name:"Tonnage (kg)",fill:"hsl(var(--primary))",radius:[4,4,0,0],opacity:.7}),e.jsx(gt,{type:"monotone",dataKey:"volume",name:"Volume (reps)",stroke:"hsl(var(--accent))",strokeWidth:2,dot:!1})]})})})})}),e.jsxs(L.div,{variants:F,initial:"hidden",animate:"visible",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-3",children:"Ressenti par séance"}),e.jsx("div",{className:"h-[180px] w-full",children:ce?e.jsx(ne,{}):ge.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground",children:"Aucune donnée disponible."}):e.jsx(w,{width:"100%",height:"100%",children:e.jsxs(be,{data:ge,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"strengthFeelingGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"hsl(var(--foreground))",stopOpacity:.15}),e.jsx("stop",{offset:"100%",stopColor:"hsl(var(--foreground))",stopOpacity:0})]})}),e.jsx($,{dataKey:"date",fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(se,{domain:[0,10],hide:!0}),e.jsx(C,{contentStyle:Q,formatter:t=>[t!==null?t.toFixed(1):"-","RPE"]}),e.jsx(Se,{type:"monotone",dataKey:"feeling",stroke:"hsl(var(--foreground))",strokeWidth:2,fill:"url(#strengthFeelingGradient)",dot:{r:4,fill:"hsl(var(--background))",stroke:"hsl(var(--foreground))",strokeWidth:2},activeDot:{r:6}})]})})})]}),e.jsx(re,{title:"Détail par exercice",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[220px] w-full",children:he.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground",children:"Aucun exercice enregistré."}):e.jsx(w,{width:"100%",height:"100%",children:e.jsxs(Ce,{data:he,layout:"vertical",children:[e.jsx($,{type:"number",fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(se,{type:"category",dataKey:"name",fontSize:10,tickLine:!1,axisLine:!1,width:100}),e.jsx(C,{contentStyle:Q,formatter:t=>[`${t.toLocaleString()} kg`,"Volume"]}),e.jsx(ae,{dataKey:"totalVolume",fill:"hsl(var(--primary))",radius:[0,4,4,0]})]})})}),e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs(Ze,{children:[e.jsx(et,{children:e.jsxs(te,{children:[e.jsx(I,{children:"Exercice"}),e.jsx(I,{className:"text-right",children:"Volume"}),e.jsx(I,{className:"text-right",children:"Max"}),e.jsx(I,{className:"text-right",children:"Dernier"})]})}),e.jsx(tt,{children:Z.length===0?e.jsx(te,{children:e.jsx(_,{colSpan:4,className:"text-center text-sm text-muted-foreground",children:"Aucun exercice enregistré."})}):Z.map(t=>e.jsxs(te,{children:[e.jsx(_,{className:"font-medium text-sm",children:t.name}),e.jsxs(_,{className:"text-right font-mono text-sm",children:[t.totalVolume.toLocaleString()," kg"]}),e.jsx(_,{className:"text-right font-mono text-sm",children:t.maxWeight!==null?`${t.maxWeight} kg`:"-"}),e.jsx(_,{className:"text-right text-xs text-muted-foreground",children:We(t.lastPerformedAt)})]},t.exerciseId))})]})})]})}),e.jsx(re,{title:"Historique récent",children:e.jsxs("div",{className:"space-y-3",children:[le.length===0&&e.jsx("div",{className:"text-center text-sm text-muted-foreground py-6",children:"Aucun historique disponible."}),le.map(t=>e.jsxs("div",{className:"flex items-center justify-between border-b border-border/40 pb-2 last:border-b-0 last:pb-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:S(new Date(t.started_at||t.date||t.created_at||new Date),"dd/MM/yyyy")}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t.status||"Séance"})]}),e.jsxs("div",{className:"text-sm font-mono font-semibold",children:[qe(X(t)),"/10"]})]},t.id)),P.hasNextPage&&e.jsx(Xe,{variant:"outline",size:"sm",className:"w-full",onClick:()=>P.fetchNextPage(),disabled:P.isFetchingNextPage,children:P.isFetchingNextPage?"Chargement...":"Charger plus"})]})})]})]})]})}export{G as ProgressBar,Kt as default};
