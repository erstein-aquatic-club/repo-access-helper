import{l as pe,r as l,m as rs,n as ns,o as et,j as e,p as Ue,P as he,q as _e,s as ys,t as yr,v as br,w as $,x as Nr,y as st,z as wr,A as _r,E as Cr,F as Sr,G as Ar,H as Rr,I as tt,O as kr,J as Dr,K as rt,M as as,N as nt,a as me,Q as ie,U as Te,V as $e,X as ms,Y as ps,Z as R,_ as I,B as A,C as z,g as W,h as Q,i as H,S as le,b as oe,d as ce,e as de,f as L,$ as xe,a0 as Y,k as B,u as Xe,a1 as Er,R as ue,a2 as Pr,a3 as Mr,a4 as at,a5 as Tr,a6 as $r,a7 as it,a8 as Fr,a9 as Vr,aa as Ir,ab as Or,ac as qr,ad as zr,ae as Gr,af as Lr,ag as Br,ah as is,ai as Kr,aj as Ye,W as Es,D as Hr,T as Wr}from"./index-DqxBy9a5.js";import{d as ls,R as lt,I as ot,T as Ur,a as Qr,b as Jr,c as Xr}from"./tabs-DWvja1RP.js";import{T as Fe}from"./textarea-DAeIa66o.js";import{C as fs}from"./checkbox-b1J-JRiM.js";import{S as Ze,P as Ps}from"./save-BRIS4vk0.js";import{c as ct,R as Yr,i as Ms,g as Zr,S as Ts,a as en,L as sn}from"./SwimSessionConsultation-CWCbOw8o.js";import{f as tn}from"./format-B9mPVj_w.js";import{P as $s}from"./play-BYIUu9LO.js";import{S as rn}from"./search-DjwwSfRc.js";import{T as nn}from"./timer-ClNiKhM8.js";import{T as an,a as ln,b as Fs,c as xs,d as on,e as hs}from"./table-CD3Q3imF.js";import{B as cn}from"./badge-CiNZkEw9.js";import{A as dn}from"./arrow-left-AyLXC9Wt.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const un=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],mn=pe("archive",un);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pn=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],Vs=pe("arrow-down",pn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xn=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],Is=pe("arrow-up",xn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hn=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],Oe=pe("bell",hn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gn=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],fn=pe("eye",gn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jn=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],vn=pe("funnel",jn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yn=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],dt=pe("grip-vertical",yn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bn=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],Os=pe("heart-pulse",bn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nn=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],wn=pe("pencil",Nn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _n=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],je=pe("trash-2",_n);function js(s,t,{checkForDefaultPrevented:r=!0}={}){return function(n){if(s?.(n),r===!1||!n.defaultPrevented)return t?.(n)}}var Cn=rs[" useInsertionEffect ".trim().toString()]||ns;function Sn({prop:s,defaultProp:t,onChange:r=()=>{},caller:a}){const[n,i,o]=An({defaultProp:t,onChange:r}),d=s!==void 0,f=d?s:n;{const x=l.useRef(s!==void 0);l.useEffect(()=>{const p=x.current;p!==d&&console.warn(`${a} is changing from ${p?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),x.current=d},[d,a])}const m=l.useCallback(x=>{if(d){const p=Rn(x)?x(s):x;p!==s&&o.current?.(p)}else i(x)},[d,s,i,o]);return[f,m]}function An({defaultProp:s,onChange:t}){const[r,a]=l.useState(s),n=l.useRef(r),i=l.useRef(t);return Cn(()=>{i.current=t},[t]),l.useEffect(()=>{n.current!==r&&(i.current?.(r),n.current=r)},[r,n]),[r,a,i]}function Rn(s){return typeof s=="function"}var bs="Radio",[kn,ut]=Ue(bs),[Dn,En]=kn(bs),mt=l.forwardRef((s,t)=>{const{__scopeRadio:r,name:a,checked:n=!1,required:i,disabled:o,value:d="on",onCheck:f,form:m,...x}=s,[p,g]=l.useState(null),_=_e(t,y=>g(y)),N=l.useRef(!1),O=p?m||!!p.closest("form"):!0;return e.jsxs(Dn,{scope:r,checked:n,disabled:o,children:[e.jsx(he.button,{type:"button",role:"radio","aria-checked":n,"data-state":gt(n),"data-disabled":o?"":void 0,disabled:o,value:d,...x,ref:_,onClick:js(s.onClick,y=>{n||f?.(),O&&(N.current=y.isPropagationStopped(),N.current||y.stopPropagation())})}),O&&e.jsx(ht,{control:p,bubbles:!N.current,name:a,value:d,checked:n,required:i,disabled:o,form:m,style:{transform:"translateX(-100%)"}})]})});mt.displayName=bs;var pt="RadioIndicator",xt=l.forwardRef((s,t)=>{const{__scopeRadio:r,forceMount:a,...n}=s,i=En(pt,r);return e.jsx(ys,{present:a||i.checked,children:e.jsx(he.span,{"data-state":gt(i.checked),"data-disabled":i.disabled?"":void 0,...n,ref:t})})});xt.displayName=pt;var Pn="RadioBubbleInput",ht=l.forwardRef(({__scopeRadio:s,control:t,checked:r,bubbles:a=!0,...n},i)=>{const o=l.useRef(null),d=_e(o,i),f=yr(r),m=br(t);return l.useEffect(()=>{const x=o.current;if(!x)return;const p=window.HTMLInputElement.prototype,_=Object.getOwnPropertyDescriptor(p,"checked").set;if(f!==r&&_){const N=new Event("click",{bubbles:a});_.call(x,r),x.dispatchEvent(N)}},[f,r,a]),e.jsx(he.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...n,tabIndex:-1,ref:d,style:{...n.style,...m,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});ht.displayName=Pn;function gt(s){return s?"checked":"unchecked"}var Mn=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],os="RadioGroup",[Tn]=Ue(os,[ls,ut]),ft=ls(),jt=ut(),[$n,Fn]=Tn(os),vt=l.forwardRef((s,t)=>{const{__scopeRadioGroup:r,name:a,defaultValue:n,value:i,required:o=!1,disabled:d=!1,orientation:f,dir:m,loop:x=!0,onValueChange:p,...g}=s,_=ft(r),N=et(m),[O,y]=Sn({prop:i,defaultProp:n??null,onChange:p,caller:os});return e.jsx($n,{scope:r,name:a,required:o,disabled:d,value:O,onValueChange:y,children:e.jsx(lt,{asChild:!0,..._,orientation:f,dir:N,loop:x,children:e.jsx(he.div,{role:"radiogroup","aria-required":o,"aria-orientation":f,"data-disabled":d?"":void 0,dir:N,...g,ref:t})})})});vt.displayName=os;var yt="RadioGroupItem",bt=l.forwardRef((s,t)=>{const{__scopeRadioGroup:r,disabled:a,...n}=s,i=Fn(yt,r),o=i.disabled||a,d=ft(r),f=jt(r),m=l.useRef(null),x=_e(t,m),p=i.value===n.value,g=l.useRef(!1);return l.useEffect(()=>{const _=O=>{Mn.includes(O.key)&&(g.current=!0)},N=()=>g.current=!1;return document.addEventListener("keydown",_),document.addEventListener("keyup",N),()=>{document.removeEventListener("keydown",_),document.removeEventListener("keyup",N)}},[]),e.jsx(ot,{asChild:!0,...d,focusable:!o,active:p,children:e.jsx(mt,{disabled:o,required:i.required,checked:p,...f,...n,name:i.name,ref:x,onCheck:()=>i.onValueChange(n.value),onKeyDown:js(_=>{_.key==="Enter"&&_.preventDefault()}),onFocus:js(n.onFocus,()=>{g.current&&m.current?.click()})})})});bt.displayName=yt;var Vn="RadioGroupIndicator",Nt=l.forwardRef((s,t)=>{const{__scopeRadioGroup:r,...a}=s,n=jt(r);return e.jsx(xt,{...n,...a,ref:t})});Nt.displayName=Vn;var wt=vt,_t=bt,In=Nt;const Ct=l.forwardRef(({className:s,...t},r)=>e.jsx(wt,{className:$("grid gap-2",s),...t,ref:r}));Ct.displayName=wt.displayName;const vs=l.forwardRef(({className:s,...t},r)=>e.jsx(_t,{ref:r,className:$("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(In,{className:"flex items-center justify-center",children:e.jsx(Nr,{className:"h-3.5 w-3.5 fill-primary"})})}));vs.displayName=_t.displayName;function St(s){l.useEffect(()=>{if(!s)return;const t=r=>{r.preventDefault()};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[s])}function On(s,t,{checkForDefaultPrevented:r=!0}={}){return function(n){if(s?.(n),r===!1||!n.defaultPrevented)return t?.(n)}}var qn=Symbol("radix.slottable");function zn(s){const t=({children:r})=>e.jsx(e.Fragment,{children:r});return t.displayName=`${s}.Slottable`,t.__radixId=qn,t}var At="AlertDialog",[Gn]=Ue(At,[st]),ge=st(),Rt=s=>{const{__scopeAlertDialog:t,...r}=s,a=ge(t);return e.jsx(wr,{...a,...r,modal:!0})};Rt.displayName=At;var Ln="AlertDialogTrigger",Bn=l.forwardRef((s,t)=>{const{__scopeAlertDialog:r,...a}=s,n=ge(r);return e.jsx(Dr,{...n,...a,ref:t})});Bn.displayName=Ln;var Kn="AlertDialogPortal",kt=s=>{const{__scopeAlertDialog:t,...r}=s,a=ge(t);return e.jsx(_r,{...a,...r})};kt.displayName=Kn;var Hn="AlertDialogOverlay",Dt=l.forwardRef((s,t)=>{const{__scopeAlertDialog:r,...a}=s,n=ge(r);return e.jsx(kr,{...n,...a,ref:t})});Dt.displayName=Hn;var Re="AlertDialogContent",[Wn,Un]=Gn(Re),Qn=zn("AlertDialogContent"),Et=l.forwardRef((s,t)=>{const{__scopeAlertDialog:r,children:a,...n}=s,i=ge(r),o=l.useRef(null),d=_e(t,o),f=l.useRef(null);return e.jsx(Cr,{contentName:Re,titleName:Pt,docsSlug:"alert-dialog",children:e.jsx(Wn,{scope:r,cancelRef:f,children:e.jsxs(Sr,{role:"alertdialog",...i,...n,ref:d,onOpenAutoFocus:On(n.onOpenAutoFocus,m=>{m.preventDefault(),f.current?.focus({preventScroll:!0})}),onPointerDownOutside:m=>m.preventDefault(),onInteractOutside:m=>m.preventDefault(),children:[e.jsx(Qn,{children:a}),e.jsx(Xn,{contentRef:o})]})})})});Et.displayName=Re;var Pt="AlertDialogTitle",Mt=l.forwardRef((s,t)=>{const{__scopeAlertDialog:r,...a}=s,n=ge(r);return e.jsx(Ar,{...n,...a,ref:t})});Mt.displayName=Pt;var Tt="AlertDialogDescription",$t=l.forwardRef((s,t)=>{const{__scopeAlertDialog:r,...a}=s,n=ge(r);return e.jsx(Rr,{...n,...a,ref:t})});$t.displayName=Tt;var Jn="AlertDialogAction",Ft=l.forwardRef((s,t)=>{const{__scopeAlertDialog:r,...a}=s,n=ge(r);return e.jsx(tt,{...n,...a,ref:t})});Ft.displayName=Jn;var Vt="AlertDialogCancel",It=l.forwardRef((s,t)=>{const{__scopeAlertDialog:r,...a}=s,{cancelRef:n}=Un(Vt,r),i=ge(r),o=_e(t,n);return e.jsx(tt,{...i,...a,ref:o})});It.displayName=Vt;var Xn=({contentRef:s})=>{const t=`\`${Re}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Re}\` by passing a \`${Tt}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Re}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return l.useEffect(()=>{document.getElementById(s.current?.getAttribute("aria-describedby"))||console.warn(t)},[t,s]),null},Yn=Rt,Zn=kt,Ot=Dt,qt=Et,zt=Ft,Gt=It,Lt=Mt,Bt=$t;const ss=Yn,ea=Zn,Kt=l.forwardRef(({className:s,...t},r)=>e.jsx(Ot,{className:$("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:r}));Kt.displayName=Ot.displayName;const qe=l.forwardRef(({className:s,...t},r)=>e.jsxs(ea,{children:[e.jsx(Kt,{}),e.jsx(qt,{ref:r,className:$("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t})]}));qe.displayName=qt.displayName;const ze=({className:s,...t})=>e.jsx("div",{className:$("flex flex-col space-y-2 text-center sm:text-left",s),...t});ze.displayName="AlertDialogHeader";const Ge=({className:s,...t})=>e.jsx("div",{className:$("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});Ge.displayName="AlertDialogFooter";const Le=l.forwardRef(({className:s,...t},r)=>e.jsx(Lt,{ref:r,className:$("text-lg font-semibold",s),...t}));Le.displayName=Lt.displayName;const Be=l.forwardRef(({className:s,...t},r)=>e.jsx(Bt,{ref:r,className:$("text-sm text-muted-foreground",s),...t}));Be.displayName=Bt.displayName;const Ke=l.forwardRef(({className:s,...t},r)=>e.jsx(zt,{ref:r,className:$(rt(),s),...t}));Ke.displayName=zt.displayName;const He=l.forwardRef(({className:s,...t},r)=>e.jsx(Gt,{ref:r,className:$(rt({variant:"outline"}),"mt-2 sm:mt-0",s),...t}));He.displayName=Gt.displayName;const qs=[{key:"endurance",label:"Endurance",fieldSuffix:"endurance"},{key:"hypertrophie",label:"Hypertrophie",fieldSuffix:"hypertrophie"},{key:"force",label:"Force",fieldSuffix:"force"}],zs=s=>s==="endurance"||s==="hypertrophie"||s==="force"?s:"endurance",Gs=({exercise:s,onChange:t,disabled:r=!1})=>e.jsxs(Ur,{defaultValue:"endurance",className:"w-full",children:[e.jsx(Qr,{className:"grid w-full grid-cols-3",children:qs.map(a=>e.jsx(Jr,{value:a.key,children:a.label},a.key))}),qs.map(a=>{const n=`pct_1rm_${a.fieldSuffix}`,i=`Nb_series_${a.fieldSuffix}`,o=`Nb_reps_${a.fieldSuffix}`,d=`recup_${a.fieldSuffix}`,f=`recup_exercices_${a.fieldSuffix}`;return e.jsxs(Xr,{value:a.key,className:`space-y-3 rounded-lg border p-3 ${r?"opacity-60":""}`,children:[e.jsx("p",{className:"text-sm font-semibold",children:a.label}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"% 1RM"}),e.jsx(I,{type:"number",value:s[n]??"",disabled:r,onChange:m=>t({[n]:m.target.value===""?null:Number(m.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Nb séries"}),e.jsx(I,{type:"number",value:s[i]??"",disabled:r,onChange:m=>t({[i]:m.target.value===""?null:Number(m.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Nb reps"}),e.jsx(I,{type:"number",value:s[o]??"",disabled:r,onChange:m=>t({[o]:m.target.value===""?null:Number(m.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Récup. séries (s)"}),e.jsx(I,{type:"number",value:s[d]??"",disabled:r,onChange:m=>t({[d]:m.target.value===""?null:Number(m.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Récup. exercices (s)"}),e.jsx(I,{type:"number",value:s[f]??"",disabled:r,onChange:m=>t({[f]:m.target.value===""?null:Number(m.target.value)})})]})]})]},a.key)})]}),sa={pct_1rm_endurance:60,pct_1rm_hypertrophie:75,pct_1rm_force:85,Nb_series_endurance:4,Nb_series_hypertrophie:3,Nb_series_force:3,Nb_reps_endurance:16,Nb_reps_hypertrophie:8,Nb_reps_force:3,recup_endurance:120,recup_hypertrophie:200,recup_force:300,recup_exercices_endurance:300,recup_exercices_hypertrophie:400,recup_exercices_force:500},Je=s=>{const t=Number(s);return Number.isFinite(t)?t:0},Ls=(s,t,r,a)=>{const n=t==="force"?"force":t==="hypertrophie"?"hypertrophie":"endurance",i=`Nb_series_${n}`,o=`Nb_reps_${n}`,d=`pct_1rm_${n}`,f=`recup_${n}`;return{exercise_id:s.id,order_index:r,sets:Je(s[i]),reps:Je(s[o]),rest_seconds:Je(s[f]),percent_1rm:Je(s[d]),cycle_type:t,notes:a?.notes??""}},ta=()=>({nom_exercice:"",description:null,illustration_gif:null,exercise_type:"strength",warmup_reps:null,warmup_duration:null,...sa}),Bs=({exercise:s,warmupMode:t,onChange:r,onWarmupModeChange:a,idPrefix:n})=>e.jsxs("div",{className:"space-y-3 rounded-lg border p-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Paramètres d’échauffement"}),e.jsxs(Ct,{value:t,onValueChange:i=>{a(i==="duration"?"duration":"reps"),r(i==="duration"?{warmup_reps:null,warmup_duration:s.warmup_duration??0}:{warmup_duration:null,warmup_reps:s.warmup_reps??0})},className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(vs,{value:"reps",id:`${n}-warmup-reps`}),e.jsx(R,{htmlFor:`${n}-warmup-reps`,children:"Nombre de répétitions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(vs,{value:"duration",id:`${n}-warmup-duration`}),e.jsx(R,{htmlFor:`${n}-warmup-duration`,children:"Durée (secondes)"})]})]}),t==="duration"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Durée (s)"}),e.jsx(I,{type:"number",value:s.warmup_duration??"",onChange:i=>r({warmup_duration:i.target.value===""?null:Number(i.target.value)})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Nombre de répétitions"}),e.jsx(I,{type:"number",value:s.warmup_reps??"",onChange:i=>r({warmup_reps:i.target.value===""?null:Number(i.target.value)})})]})]});function ra(){const{toast:s}=as(),t=nt(),[r,a]=l.useState(!1),[n,i]=l.useState(null);St(r||n!==null);const[o,d]=l.useState("all"),[f,m]=l.useState(!1),[x,p]=l.useState(!1),[g,_]=l.useState(null),[N,O]=l.useState(null),[y,se]=l.useState(!1),[Z,w]=l.useState(null),[P,ae]=l.useState(null),[k,ee]=l.useState(null),[be,h]=l.useState(null),[M,J]=l.useState("reps"),[U,E]=l.useState("reps"),[C,q]=l.useState({title:"",description:"",cycle:"endurance",items:[]}),[F,X]=l.useState({...ta()});l.useEffect(()=>{g&&E(g.warmup_duration!=null?"duration":"reps")},[g]);const{data:K,isLoading:De}=me({queryKey:["exercises"],queryFn:()=>B.getExercises()}),{data:Ce,isLoading:Se}=me({queryKey:["strength_catalog"],queryFn:()=>B.getStrengthSessions()}),Ae=l.useMemo(()=>new Map((K??[]).map(c=>[c.id,c])),[K]),Ee=ie({mutationFn:c=>B.createExercise(c),onSuccess:()=>{t.invalidateQueries({queryKey:["exercises"]}),m(!1),s({title:"Exercice ajouté"})}}),V=ie({mutationFn:c=>B.createStrengthSession(c),onSuccess:()=>{t.invalidateQueries({queryKey:["strength_catalog"]}),a(!1),q({title:"",description:"",cycle:"endurance",items:[]}),s({title:"Séance créée avec succès"})}}),te=ie({mutationFn:c=>B.updateExercise(c),onSuccess:()=>{t.invalidateQueries({queryKey:["exercises"]}),t.invalidateQueries({queryKey:["strength_catalog"]}),p(!1),_(null),s({title:"Exercice mis à jour"})}}),Ne=ie({mutationFn:c=>B.deleteExercise(c),onSuccess:()=>{t.invalidateQueries({queryKey:["exercises"]}),t.invalidateQueries({queryKey:["strength_catalog"]}),ae(null),s({title:"Exercice supprimé"})}}),we=ie({mutationFn:c=>B.deleteStrengthSession(c),onSuccess:()=>{t.invalidateQueries({queryKey:["strength_catalog"]}),w(null),s({title:"Séance supprimée"})}}),u=ie({mutationFn:c=>B.updateStrengthSession(c),onSuccess:()=>{t.invalidateQueries({queryKey:["strength_catalog"]}),a(!1),i(null),q({title:"",description:"",cycle:"endurance",items:[]}),s({title:"Séance mise à jour"})}}),j=ie({mutationFn:c=>B.persistStrengthSessionOrder(c)}),b=()=>{a(!1),i(null),q({title:"",description:"",cycle:"endurance",items:[]})},T=c=>{i(c.id),q({title:c.title??"",description:c.description??"",cycle:zs(c.cycle),items:c.items?.map(v=>({exercise_id:v.exercise_id,order_index:v.order_index??v.ordre??0,sets:v.sets,reps:v.reps,rest_seconds:v.rest_seconds,percent_1rm:v.percent_1rm,cycle_type:v.cycle_type,notes:v.notes??""}))??[]}),a(!0)},G=c=>{_(c),p(!0)},re=()=>{const c={...C,items:D(C.items)};n?u.mutate({...c,id:n}):V.mutate(c)},D=c=>c.map((v,S)=>({...v,order_index:S})),Pe=()=>{const c=K?.[0];q(v=>({...v,items:[...v.items,c?Ls(c,v.cycle,v.items.length):{exercise_id:1,order_index:v.items.length,sets:0,reps:0,rest_seconds:0,percent_1rm:0}]}))},fe=(c,v,S)=>{const ne=[...C.items];if(v==="exercise_id"){const Me=K?.find(vr=>vr.id===S);Me?ne[c]=Ls(Me,C.cycle,ne[c].order_index??c,ne[c]):ne[c]={...ne[c],exercise_id:S}}else ne[c]={...ne[c],[v]:S};q({...C,items:ne})},ds=c=>{const v=D(C.items.filter((S,ne)=>ne!==c));q({...C,items:v})},us=(c,v)=>{if(c===v)return;const S=[...C.items],[ne]=S.splice(c,1);S.splice(v,0,ne);const Me=D(S);q({...C,items:Me}),n&&j.mutate({id:n,title:C.title,description:C.description,cycle:C.cycle,items:Me})},jr=new Set(C.items.map(c=>c.exercise_id)),Cs=K?.filter(c=>o==="all"||jr.has(c.id)?!0:c.exercise_type===o)??[],Ss=e.jsx(Te,{open:x,onOpenChange:p,children:e.jsxs($e,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(ms,{children:e.jsx(ps,{children:"Modifier l’exercice"})}),g&&e.jsxs("div",{className:"space-y-4",children:[g.exercise_type==="warmup"?e.jsx(Bs,{exercise:g,warmupMode:U,onChange:c=>_(v=>v&&{...v,...c}),onWarmupModeChange:E,idPrefix:"edit"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Nom"}),e.jsx(I,{value:g.nom_exercice,onChange:c=>_({...g,nom_exercice:c.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Description"}),e.jsx(Fe,{value:g.description??"",onChange:c=>_({...g,description:c.target.value===""?null:c.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Illustration (GIF)"}),e.jsx(I,{value:g.illustration_gif??"",onChange:c=>_({...g,illustration_gif:c.target.value===""?null:c.target.value}),placeholder:"https://..."})]}),g.exercise_type!=="warmup"?e.jsx(Gs,{exercise:g,onChange:c=>_(v=>v&&{...v,...c})}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fs,{id:"warmup-flag-edit",checked:g.exercise_type==="warmup",onCheckedChange:c=>_({...g,exercise_type:c===!0?"warmup":"strength"})}),e.jsx(R,{htmlFor:"warmup-flag-edit",children:"Exercice d’échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(A,{variant:"outline",onClick:()=>{p(!1),_(null)},children:"Annuler"}),e.jsxs(A,{onClick:()=>{g?.id&&te.mutate(g)},disabled:!g.nom_exercice.trim(),children:[e.jsx(Ze,{className:"mr-2 h-4 w-4"})," Enregistrer"]})]})]})]})}),As=e.jsx(Te,{open:f,onOpenChange:m,children:e.jsxs($e,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(ms,{children:e.jsx(ps,{children:"Créer un exercice"})}),e.jsxs("div",{className:"space-y-4",children:[F.exercise_type==="warmup"?e.jsx(Bs,{exercise:F,warmupMode:M,onChange:c=>X(v=>({...v,...c})),onWarmupModeChange:J,idPrefix:"create"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Nom"}),e.jsx(I,{value:F.nom_exercice,onChange:c=>X({...F,nom_exercice:c.target.value}),placeholder:"ex: Rotations Élastique"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Description"}),e.jsx(Fe,{value:F.description??"",onChange:c=>X({...F,description:c.target.value===""?null:c.target.value}),placeholder:"Détails, consignes..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Illustration (GIF)"}),e.jsx(I,{value:F.illustration_gif??"",onChange:c=>X({...F,illustration_gif:c.target.value===""?null:c.target.value}),placeholder:"https://..."})]}),F.exercise_type!=="warmup"?e.jsx(Gs,{exercise:F,onChange:c=>X(v=>({...v,...c}))}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fs,{id:"warmup-flag",checked:F.exercise_type==="warmup",onCheckedChange:c=>X({...F,exercise_type:c===!0?"warmup":"strength"})}),e.jsx(R,{htmlFor:"warmup-flag",children:"Exercice d’échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(A,{variant:"outline",onClick:()=>m(!1),children:"Annuler"}),e.jsxs(A,{onClick:()=>Ee.mutate(F),disabled:!F.nom_exercice.trim(),children:[e.jsx(Ze,{className:"mr-2 h-4 w-4"})," Enregistrer"]})]})]})]})}),Rs=e.jsx(Te,{open:y,onOpenChange:c=>{se(c),c||O(null)},children:e.jsxs($e,{className:"sm:max-w-3xl",children:[e.jsx(ms,{children:e.jsx(ps,{children:"Détails de la séance"})}),N&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-lg font-semibold",children:N.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:N.description||"—"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cycle : ",N.cycle]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Exercices"}),e.jsx("div",{className:"space-y-2",children:(N.items??[]).slice().sort((c,v)=>(c.order_index??0)-(v.order_index??0)).map((c,v)=>{const S=Ae.get(c.exercise_id);return e.jsxs("div",{className:"rounded-md border px-3 py-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("span",{className:"font-medium",children:[v+1,". ",S?.nom_exercice??c.exercise_name??"Exercice"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:S?.exercise_type==="warmup"||c.category==="warmup"?"Échauffement":"Travail"})]}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[c.sets," séries • ",c.reps," reps • ",c.percent_1rm,"% 1RM • ",c.rest_seconds,"s"]})]},`${c.exercise_id}-${v}`)})})]})]})]})}),ks=e.jsx(ss,{open:!!Z,onOpenChange:c=>{c||w(null)},children:e.jsxs(qe,{children:[e.jsxs(ze,{children:[e.jsx(Le,{children:"Supprimer la séance ?"}),e.jsxs(Be,{children:['Cette action est définitive. La séance "',Z?.title,'" sera supprimée.']})]}),e.jsxs(Ge,{children:[e.jsx(He,{children:"Annuler"}),e.jsx(Ke,{onClick:()=>{Z?.id&&we.mutate(Z.id)},children:"Supprimer"})]})]})}),Ds=e.jsx(ss,{open:!!P,onOpenChange:c=>{c||ae(null)},children:e.jsxs(qe,{children:[e.jsxs(ze,{children:[e.jsx(Le,{children:"Supprimer l’exercice ?"}),e.jsxs(Be,{children:['Cette action est définitive. L’exercice "',P?.nom_exercice,'" sera supprimé.']})]}),e.jsxs(Ge,{children:[e.jsx(He,{children:"Annuler"}),e.jsx(Ke,{onClick:()=>{P?.id&&Ne.mutate(P.id)},children:"Supprimer"})]})]})});return r?e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-bottom-4 motion-reduce:animate-none",children:[As,Ss,Rs,ks,Ds,e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold uppercase",children:n?"Modifier Séance Muscu":"Nouvelle Séance Muscu"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{variant:"outline",onClick:b,children:"Annuler"}),e.jsxs(A,{onClick:re,children:[e.jsx(Ze,{className:"mr-2 h-4 w-4"})," Enregistrer"]})]})]}),e.jsxs(z,{children:[e.jsx(W,{children:e.jsx(Q,{children:"Informations Générales"})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Titre"}),e.jsx(I,{value:C.title,onChange:c=>q({...C,title:c.target.value}),placeholder:"ex: Full Body A"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Cycle"}),e.jsxs(le,{value:C.cycle,onValueChange:c=>q({...C,cycle:zs(c)}),children:[e.jsx(oe,{children:e.jsx(ce,{})}),e.jsxs(de,{children:[e.jsx(L,{value:"endurance",children:"Endurance"}),e.jsx(L,{value:"hypertrophie",children:"Hypertrophie"}),e.jsx(L,{value:"force",children:"Force"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Description"}),e.jsx(Fe,{value:C.description,onChange:c=>q({...C,description:c.target.value})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold",children:"Exercices"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(A,{size:"sm",variant:"outline",onClick:()=>m(!0),children:[e.jsx(xe,{className:"mr-2 h-4 w-4"})," Nouvel exercice"]}),e.jsxs(A,{size:"sm",onClick:Pe,children:[e.jsx(xe,{className:"mr-2 h-4 w-4"})," Ajouter"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-[220px_1fr] items-end",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(vn,{className:"h-4 w-4"})," Filtre exercices"]}),e.jsxs(le,{value:o,onValueChange:c=>d(c),children:[e.jsx(oe,{children:e.jsx(ce,{})}),e.jsxs(de,{children:[e.jsx(L,{value:"all",children:"Tous"}),e.jsx(L,{value:"strength",children:"Séries de travail"}),e.jsx(L,{value:"warmup",children:"Échauffement"})]})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Les exercices marqués warmup sont affichés dans les séances avec le badge « Échauffement »."})]}),C.items.map((c,v)=>e.jsxs(z,{className:$("relative transition-colors",be===v&&k!==null&&k!==v?"ring-2 ring-primary bg-primary/5":""),onDragOver:S=>{S.preventDefault(),h(v)},onDragLeave:()=>h(S=>S===v?null:S),onDrop:()=>{k!==null&&(us(k,v),ee(null),h(null))},children:[e.jsx(A,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 text-destructive",onClick:()=>ds(v),"aria-label":"Supprimer l'exercice",children:e.jsx(je,{className:"h-4 w-4"})}),e.jsxs(H,{className:"pt-6 grid md:grid-cols-12 gap-4 items-end",children:[e.jsx("div",{className:"md:col-span-1 flex items-center justify-center",children:e.jsx("button",{type:"button",className:"cursor-grab rounded-md border p-1 text-muted-foreground hover:text-foreground",draggable:!0,onDragStart:()=>ee(v),onDragEnd:()=>{ee(null),h(null)},"aria-label":"Réordonner",children:e.jsx(dt,{className:"h-4 w-4"})})}),e.jsxs("div",{className:"md:col-span-3 space-y-2",children:[e.jsx(R,{children:"Exercice"}),e.jsxs(le,{value:c.exercise_id.toString(),onValueChange:S=>fe(v,"exercise_id",parseInt(S)),children:[e.jsx(oe,{children:e.jsx(ce,{})}),e.jsx(de,{children:Cs.length?Cs.map(S=>e.jsxs(L,{value:S.id.toString(),children:[S.nom_exercice,S.exercise_type==="warmup"?" • Échauffement":""]},S.id)):e.jsx(L,{value:"no-exercise",disabled:!0,children:"Aucun exercice disponible"})})]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(R,{children:"Séries"}),e.jsx(I,{type:"number",value:c.sets===0?"":c.sets,onChange:S=>fe(v,"sets",S.target.value===""?0:Number(S.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(R,{children:"Reps"}),e.jsx(I,{type:"number",value:c.reps===0?"":c.reps,onChange:S=>fe(v,"reps",S.target.value===""?0:Number(S.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(R,{children:"% 1RM"}),e.jsx(I,{type:"number",value:c.percent_1rm===0?"":c.percent_1rm,onChange:S=>fe(v,"percent_1rm",S.target.value===""?0:Number(S.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(R,{children:"Repos (s)"}),e.jsx(I,{type:"number",value:c.rest_seconds===0?"":c.rest_seconds,onChange:S=>fe(v,"rest_seconds",S.target.value===""?0:Number(S.target.value))})]})]})]},`${c.exercise_id}-${v}`))]})]}):e.jsxs("div",{className:"space-y-4",children:[As,Ss,Rs,ks,Ds,e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Catalogue Séances Musculation"}),e.jsxs(A,{onClick:()=>{i(null),q({title:"",description:"",cycle:"endurance",items:[]}),a(!0)},children:[e.jsx(xe,{className:"mr-2 h-4 w-4"})," Créer"]})]}),Se?e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:[1,2,3,4].map(c=>e.jsxs(z,{children:[e.jsxs(W,{children:[e.jsx("div",{className:"h-5 w-3/4 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"mt-2 h-4 w-1/2 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"})]}),e.jsx(H,{children:e.jsx("div",{className:"h-9 w-32 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"})})]},c))}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:Ce?.map(c=>e.jsxs(z,{children:[e.jsxs(W,{children:[e.jsx(Q,{children:c.title}),e.jsxs(Y,{children:[c.items?.length||0," exercices • ",c.cycle]})]}),e.jsx(H,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{variant:"outline",size:"icon","aria-label":"Voir détails",onClick:()=>{O(c),se(!0)},children:e.jsx(fn,{className:"h-4 w-4"})}),e.jsx(A,{variant:"secondary",size:"icon","aria-label":"Modifier",onClick:()=>T(c),children:e.jsx(Ps,{className:"h-4 w-4"})}),e.jsx(A,{variant:"destructive",size:"icon","aria-label":"Supprimer",onClick:()=>w(c),children:e.jsx(je,{className:"h-4 w-4"})})]})})]},c.id))}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Catalogue Exercices"}),e.jsxs(A,{variant:"outline",onClick:()=>m(!0),children:[e.jsx(xe,{className:"mr-2 h-4 w-4"})," Ajouter un exercice"]})]}),De?e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:[1,2,3,4,5,6].map(c=>e.jsx(z,{children:e.jsxs(W,{children:[e.jsx("div",{className:"h-5 w-2/3 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"mt-2 h-4 w-1/3 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"})]})},c))}):e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:K?.map(c=>e.jsx(z,{children:e.jsxs(H,{className:"flex flex-col gap-3 py-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[c.illustration_gif?e.jsx("img",{src:c.illustration_gif,alt:`Illustration ${c.nom_exercice}`,className:"h-14 w-14 rounded-md object-cover",loading:"lazy"}):null,e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:c.nom_exercice}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c.exercise_type==="warmup"?"Échauffement":"Séries de travail"})]})]}),e.jsxs("div",{className:"flex w-full gap-2 sm:w-auto",children:[e.jsx(A,{variant:"outline",size:"icon","aria-label":"Modifier",onClick:()=>G(c),children:e.jsx(Ps,{className:"h-4 w-4"})}),e.jsx(A,{variant:"destructive",size:"icon","aria-label":"Supprimer",onClick:()=>ae(c),children:e.jsx(je,{className:"h-4 w-4"})})]})]})},c.id))})]})]})}const Ks=["V0","V1","V2","V3","Max"],na={V0:"bg-emerald-500",V1:"bg-green-500",V2:"bg-yellow-500",V3:"bg-orange-500",Max:"bg-red-600"},Hs={souple:"V0",facile:"V0",relache:"V0",relâché:"V0"},aa=s=>{if(!s)return"V0";const t=s.trim();if(!t)return"V0";const r=t.toLowerCase();if(Hs[r])return Hs[r];const a=t.toUpperCase();if(a==="MAX")return"Max";if(a.startsWith("V")){const n=a.replace("V","V");return n==="V4"||n==="V5"?"Max":n}return t};function ia({value:s,onChange:t,className:r,ariaLabel:a="Sélection d'intensité"}){const n=aa(s),i=Ks.includes(n)?n:"Max";return e.jsx("div",{role:"radiogroup","aria-label":a,className:$("flex flex-wrap items-center gap-2",r),children:Ks.map(o=>{const d=i===o;return e.jsxs("button",{type:"button",role:"radio","aria-checked":d,"aria-label":`Intensité ${o==="Max"?"MAX":o}`,onClick:()=>t(o),className:$("flex flex-col items-center gap-1 rounded-full px-2 py-1 text-[10px] font-semibold text-muted-foreground transition","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",d?"text-foreground":"hover:text-foreground"),children:[e.jsx("span",{className:$("h-3 w-3 rounded-full",d?na[o]??"bg-primary":"bg-muted")}),e.jsx("span",{children:o==="Max"?"MAX":o})]},o)})})}function Ws(s){return`Séance du ${tn(s,"dd/MM/yyyy")} - Soir - Matin`}const Us={souple:"V0",facile:"V0",relache:"V0",relâché:"V0"},la=["V0","V1","V2","V3","Max"],We=s=>{if(!s)return"V0";const t=s.trim();if(!t)return"V0";const r=t.toLowerCase();if(Us[r])return Us[r];const a=t.toUpperCase();if(a==="MAX")return"Max";if(a.startsWith("V")){const n=Number.parseInt(a.slice(1),10);if(Number.isFinite(n)&&n>=4)return"Max";if(la.includes(a))return a}return t},Qs=s=>s==="Max"?"MAX":s,gs=s=>{let t=0;return s.flatMap((r,a)=>r.exercises.map((n,i)=>{const o={block_title:r.title,block_description:r.description||null,block_order:a,block_repetitions:r.repetitions??null,block_modalities:r.modalities||null,block_equipment:r.equipment??[],exercise_repetitions:n.repetitions??null,exercise_rest:n.rest??null,exercise_stroke:n.stroke||null,exercise_stroke_type:n.strokeType||null,exercise_intensity:n.intensity?We(n.intensity):null,exercise_modalities:n.modalities||null,exercise_equipment:n.equipment??[],exercise_order:i},d=n.repetitions&&n.distance?`${n.repetitions}x${n.distance}m`:n.distance?`${n.distance}m`:null;return{ordre:t++,label:d,distance:n.distance??null,duration:null,intensity:n.intensity?We(n.intensity):null,notes:n.modalities||null,raw_payload:o}}))},oa=(s=[])=>{const t=new Map;return s.forEach(r=>{const a=r.raw_payload??{},n=a.block_title||a.section||"Bloc",i=Number(a.block_order??0),o=`${i}-${n}`,d=a.block_equipment??a.equipment??[],f=(Array.isArray(d)?d:String(d).split(",")).map(g=>String(g)).map(g=>Js(g)).filter(Boolean);t.has(o)||t.set(o,{title:n,repetitions:a.block_repetitions??null,description:a.block_description??"",modalities:a.block_modalities??a.modalities??"",equipment:f,exercises:[],order:Number.isFinite(i)?i:0,exerciseOrder:new Map});const m=t.get(o),x=Number(a.exercise_order??r.ordre??m.exercises.length),p=We(a.exercise_intensity??r.intensity??"V1");m.exerciseOrder.set(x,{repetitions:a.exercise_repetitions??null,distance:r.distance??null,rest:a.exercise_rest??null,stroke:a.exercise_stroke??a.stroke??"crawl",strokeType:a.exercise_stroke_type??a.stroke_type??"nc",intensity:p,modalities:a.exercise_modalities??r.notes??"",equipment:Array.isArray(a.exercise_equipment)?a.exercise_equipment.map(g=>Js(g)):[]})}),Array.from(t.values()).sort((r,a)=>r.order-a.order).map(r=>({title:r.title,repetitions:r.repetitions,description:r.description,modalities:r.modalities,equipment:r.equipment,exercises:Array.from(r.exerciseOrder.entries()).sort(([a],[n])=>a-n).map(([,a])=>a)}))},ca=s=>s?s.length>48?`${s.slice(0,45).trim()}…`:s:"",Js=s=>{const t=s.trim().toLowerCase();return t&&(t.startsWith("plaquette")?"plaquettes":t.startsWith("palm")?"palmes":t.startsWith("tuba")?"tuba":t.startsWith("pull")?"pull":t.startsWith("elas")?"elastique":t)},da=(s=[])=>new Set(s.map(r=>{const a=r.raw_payload;return a?.block_title||a?.section||"Bloc"})).size,ua=s=>{const t=ct(s.items??[]),a=s.items?.some(i=>i.duration!=null)??!1?s.items?.reduce((i,o)=>i+(o.duration??0),0)??0:null,n=da(s.items??[]);return{totalDistance:t,totalDuration:a,blockCount:n}},Xs="swim_catalog_archived_ids",ma=(s,t)=>t===null?!1:!t.some(r=>r.session_type==="swim"&&r.session_id===s);function pa(){const{toast:s}=as(),t=nt(),{userId:r,role:a}=Xe(),[n,i]=l.useState(!1);St(n);const[o,d]=l.useState(null),[f,m]=l.useState(null),[x,p]=l.useState(null),[g,_]=l.useState(""),[N,O]=l.useState("compact"),[y,se]=l.useState(new Set),Z=()=>({id:null,name:Ws(new Date),description:"",estimatedDuration:0,blocks:[]}),[w,P]=l.useState(Z),{data:ae,isLoading:k}=me({queryKey:["swim_catalog"],queryFn:()=>B.getSwimCatalog()}),{data:ee,isError:be}=me({queryKey:["coach-assignments"],queryFn:()=>B.getAssignmentsForCoach(),enabled:a==="coach"||a==="admin"});l.useEffect(()=>{if(typeof window>"u")return;const u=window.localStorage.getItem(Xs);if(u)try{const j=JSON.parse(u);Array.isArray(j)&&se(new Set(j.map(b=>Number(b)).filter(b=>Number.isFinite(b))))}catch{return}},[]),l.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Xs,JSON.stringify(Array.from(y.values())))},[y]);const M=l.useMemo(()=>{const u=g.trim().toLowerCase();return u?(ae??[]).filter(j=>j.name.toLowerCase().includes(u)):ae??[]},[ae,g]).filter(u=>!y.has(u.id)),J=ie({mutationFn:u=>B.createSwimSession(u),onSuccess:(u,j)=>{t.invalidateQueries({queryKey:["swim_catalog"]}),i(!1),P(Z()),s({title:j?.id?"Séance natation mise à jour":"Séance natation créée"})}}),U=ie({mutationFn:u=>B.deleteSwimSession(u),onSuccess:()=>{t.invalidateQueries({queryKey:["swim_catalog"]}),m(null),s({title:"Séance supprimée"})},onError:()=>{s({title:"Suppression impossible",description:"Cette séance est utilisée dans une assignation.",variant:"destructive"})}}),E=()=>{P(u=>({...u,blocks:[...u.blocks,{title:"Nouveau bloc",repetitions:1,description:"",modalities:"",equipment:[],exercises:[{repetitions:4,distance:50,rest:null,stroke:"crawl",strokeType:"nc",intensity:"V2",modalities:"",equipment:[]}]}]}))},C=(u,j,b)=>{const T=[...w.blocks];T[u]={...T[u],[j]:b},P({...w,blocks:T})},q=u=>{const j=w.blocks.filter((b,T)=>T!==u);P({...w,blocks:j})},F=(u,j)=>{const b=j==="up"?u-1:u+1;if(b<0||b>=w.blocks.length)return;const T=[...w.blocks],[G]=T.splice(u,1);T.splice(b,0,G),P({...w,blocks:T})},X=u=>{const j=[...w.blocks];j[u].exercises.push({repetitions:4,distance:50,rest:null,stroke:"crawl",strokeType:"nc",intensity:"V2",modalities:"",equipment:[]}),P({...w,blocks:j})},K=(u,j,b,T)=>{const G=[...w.blocks],re=[...G[u].exercises];re[j]={...re[j],[b]:T},G[u]={...G[u],exercises:re},P({...w,blocks:G})},De=(u,j)=>{const b=[...w.blocks];b[u].exercises=b[u].exercises.filter((T,G)=>G!==j),P({...w,blocks:b})},Ce=[{value:"palmes",label:"Palmes"},{value:"tuba",label:"Tuba"},{value:"plaquettes",label:"Plaquettes"},{value:"pull",label:"Pull"},{value:"elastique",label:"Élastique"}],Se=[{value:"pap",label:"Papillon"},{value:"dos",label:"Dos"},{value:"brasse",label:"Brasse"},{value:"crawl",label:"Crawl"},{value:"4n",label:"4 nages"},{value:"spe",label:"Spé"}],Ae=[{value:"nc",label:"NC"},{value:"educ",label:"Educ"},{value:"jambes",label:"Jambes"}];Se.reduce((u,j)=>(u[j.value]=j.label,u),{});const Ee=Ae.reduce((u,j)=>(u[j.value]=j.label,u),{});w.id;const V=l.useMemo(()=>ct(gs(w.blocks)),[w.blocks]),te={nc:"bg-sky-100 text-sky-900 ring-sky-200",educ:"bg-violet-100 text-violet-900 ring-violet-200",jambes:"bg-teal-100 text-teal-900 ring-teal-200"},Ne={V0:"text-emerald-800",V1:"text-lime-800",V2:"text-yellow-800",V3:"text-orange-800",Max:"text-red-900"},we={V0:"ring-emerald-200",V1:"ring-lime-200",V2:"ring-yellow-200",V3:"ring-orange-200",Max:"ring-red-300"};return n?e.jsxs("div",{className:"animate-in slide-in-from-bottom-4 motion-reduce:animate-none",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{i(!1),P(Z())},className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Retour",children:e.jsx(Er,{className:"h-4 w-4"})}),e.jsx("div",{className:"text-base font-semibold",children:"Édition"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>d({id:w.id??Date.now(),name:w.name,description:w.description,created_by:r??null,items:gs(w.blocks)}),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Aperçu nageur",title:"Aperçu nageur",children:e.jsx($s,{className:"h-4 w-4"})}),e.jsxs("button",{type:"button",onClick:()=>{if(!w.name.trim()){s({title:"Titre requis",description:"Ajoutez un nom de séance avant d'enregistrer.",variant:"destructive"});return}J.mutate({id:w.id??void 0,name:w.name,description:w.description,estimated_duration:w.estimatedDuration||null,items:gs(w.blocks),created_by:r})},className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(Ze,{className:"h-4 w-4"})," Sauver"]})]})]}),e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(z,{className:"rounded-2xl border-border",children:e.jsxs("div",{className:"space-y-3 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Infos séance"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Nom"}),e.jsx("div",{className:"mt-1",children:e.jsx(I,{value:w.name,onChange:u=>P({...w,name:u.target.value}),placeholder:"Nom de la séance",className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Durée estimée (min)"}),e.jsx("div",{className:"mt-1",children:e.jsx(I,{type:"number",min:0,value:w.estimatedDuration||"",onChange:u=>P({...w,estimatedDuration:u.target.value===""?0:Number(u.target.value)}),placeholder:"55",className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Distance totale"}),e.jsxs("div",{className:"mt-1 rounded-2xl border border-border bg-muted px-3 py-2 text-sm font-semibold",children:[V,"m"]})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Vue coach"}),e.jsxs("div",{className:"inline-flex rounded-full border border-border bg-card p-1 text-xs font-semibold",children:[e.jsx("button",{type:"button",onClick:()=>O("compact"),className:$("rounded-full px-3 py-1",N==="compact"?"bg-primary text-primary-foreground":"text-muted-foreground"),children:"Condensé"}),e.jsx("button",{type:"button",onClick:()=>O("detailed"),className:$("rounded-full px-3 py-1",N==="detailed"?"bg-primary text-primary-foreground":"text-muted-foreground"),children:"Détail"})]})]}),N==="compact"?e.jsx(z,{className:"rounded-2xl border-border",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:"Plan (ultra compact)"}),e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Manipule les blocs vite. Passe en “Détail” pour éditer."})]}),e.jsxs(A,{variant:"secondary",size:"sm",onClick:E,className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(xe,{className:"h-4 w-4"})," Bloc"]})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[w.blocks.map((u,j)=>e.jsx("div",{className:"rounded-2xl border border-border bg-card px-3 py-2",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-primary px-2 py-0.5 text-[11px] font-semibold text-primary-foreground",children:[e.jsx(Yr,{className:"inline h-3 w-3"})," ",u.repetitions??1,"x"]}),e.jsx("div",{className:"truncate text-xs font-semibold",children:u.title?u.title:`Bloc ${j+1}`}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:["· ",u.exercises.length," ex"]})]}),e.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[u.exercises.slice(0,4).map((b,T)=>{const G=We(b.intensity),re=Ee[b.strokeType]??b.strokeType;return e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted px-2 py-0.5 text-[11px] font-semibold text-muted-foreground",title:b.modalities?ca(b.modalities):"",children:[b.repetitions&&b.distance?`${b.repetitions}x`:"",b.distance?`${b.distance}m`:"—",e.jsx("span",{className:$("ml-1 inline-flex items-center rounded-full px-2 py-0.5 ring-1",te[b.strokeType]??"bg-muted text-muted-foreground ring-border"),children:re}),e.jsxs("span",{className:$("ml-1 inline-flex items-center gap-1 rounded-full bg-card px-2 py-0.5 ring-1",we[G],Ne[G]),children:[e.jsx("span",{className:$("h-2 w-2 rounded-full",Ms[G]??"bg-muted")}),Qs(G)]})]},`${j}-${T}`)}),u.exercises.length>4?e.jsxs("span",{className:"text-[11px] text-muted-foreground",children:["+",u.exercises.length-4]}):null]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>F(j,"up"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Monter",title:"Monter",disabled:j===0,children:e.jsx(Is,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>F(j,"down"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Descendre",title:"Descendre",disabled:j===w.blocks.length-1,children:e.jsx(Vs,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>q(j),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer bloc",title:"Supprimer bloc",children:e.jsx(je,{className:"h-4 w-4"})})]})]})},j)),w.blocks.length?null:e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-muted px-3 py-6 text-center text-sm text-muted-foreground",children:"Aucun bloc. Ajoute un bloc pour commencer."})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Édition détaillée"}),e.jsxs(A,{variant:"secondary",size:"sm",onClick:E,className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(xe,{className:"h-4 w-4"})," Ajouter bloc"]})]}),e.jsx("div",{className:"space-y-4",children:w.blocks.map((u,j)=>e.jsx(z,{className:"rounded-2xl border-border",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"mt-1 inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-muted text-muted-foreground",children:e.jsx(dt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Titre bloc"}),e.jsx(I,{value:u.title,onChange:b=>C(j,"title",b.target.value),placeholder:`Bloc ${j+1}`,className:"rounded-2xl"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>F(j,"up"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Monter",title:"Monter",disabled:j===0,children:e.jsx(Is,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>F(j,"down"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Descendre",title:"Descendre",disabled:j===w.blocks.length-1,children:e.jsx(Vs,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>q(j),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer bloc",title:"Supprimer bloc",children:e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Répétitions du bloc"}),e.jsx("div",{className:"mt-1",children:e.jsx(I,{type:"number",min:1,value:u.repetitions??"",onChange:b=>C(j,"repetitions",b.target.value===""?null:Number(b.target.value)),placeholder:"1",className:"rounded-2xl"})})]}),e.jsx("div",{className:"flex items-end justify-end",children:e.jsxs(A,{variant:"secondary",size:"sm",onClick:()=>X(j),className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(xe,{className:"h-4 w-4"})," Exercice"]})})]}),e.jsx("div",{className:"mt-4 space-y-3",children:u.exercises.map((b,T)=>{const G=We(b.intensity),re=b.modalities??"";return e.jsx("div",{className:"rounded-2xl border border-border bg-card p-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"grid flex-1 grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Répétitions"}),e.jsx("div",{className:"mt-1",children:e.jsx(I,{type:"number",min:1,value:b.repetitions??"",onChange:D=>K(j,T,"repetitions",D.target.value===""?null:Number(D.target.value)),className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Distance (m)"}),e.jsx("div",{className:"mt-1",children:e.jsx(I,{type:"number",min:0,value:b.distance??"",onChange:D=>K(j,T,"distance",D.target.value===""?null:Number(D.target.value)),className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Nage"}),e.jsx("div",{className:"mt-1",children:e.jsxs(le,{value:b.stroke,onValueChange:D=>K(j,T,"stroke",D),children:[e.jsx(oe,{className:"rounded-2xl",children:e.jsx(ce,{})}),e.jsx(de,{children:Se.map(D=>e.jsx(L,{value:D.value,children:D.label},D.value))})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Type"}),e.jsx("div",{className:"mt-1",children:e.jsxs(le,{value:b.strokeType,onValueChange:D=>K(j,T,"strokeType",D),children:[e.jsx(oe,{className:"rounded-2xl",children:e.jsx(ce,{})}),e.jsx(de,{children:Ae.map(D=>e.jsx(L,{value:D.value,children:D.label},D.value))})]})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Intensité (clic sur points)"}),e.jsxs("span",{className:$("inline-flex items-center gap-2 rounded-full bg-card px-2.5 py-1 text-xs font-semibold ring-1",we[G],Ne[G]),children:[e.jsx("span",{className:$("h-2 w-2 rounded-full",Ms[G]??"bg-muted")}),Qs(G)]})]}),e.jsx("div",{className:"mt-2 flex items-center justify-between gap-2",children:e.jsx(ia,{value:b.intensity,onChange:D=>K(j,T,"intensity",D)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Équipements"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:Ce.map(D=>{const Pe=b.equipment.includes(D.value),fe=Zr(D.value);return e.jsxs("button",{type:"button",onClick:()=>{const ds=Pe?b.equipment.filter(us=>us!==D.value):[...b.equipment,D.value];K(j,T,"equipment",ds)},className:$("inline-flex items-center gap-2 rounded-full border px-3 py-2 text-xs font-semibold",Pe?"border-primary bg-primary text-primary-foreground":"border-border bg-card text-muted-foreground hover:bg-muted"),children:[e.jsx("span",{className:$("inline-flex h-7 w-7 items-center justify-center rounded-full",Pe?"bg-white/10":"bg-muted"),children:fe?e.jsx("img",{src:fe,alt:"",className:"h-4 w-4","aria-hidden":"true",loading:"lazy"}):null}),D.label]},D.value)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Modalités"}),e.jsx("div",{className:"mt-1",children:e.jsx(Fe,{value:re,onChange:D=>K(j,T,"modalities",D.target.value),placeholder:"Une modalité par ligne",rows:3,className:"rounded-2xl"})})]})]}),e.jsx("button",{type:"button",onClick:()=>De(j,T),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer exercice",title:"Supprimer exercice",children:e.jsx(je,{className:"h-4 w-4"})})]})},T)})}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs(A,{variant:"secondary",size:"sm",onClick:()=>X(j),className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(xe,{className:"h-4 w-4"})," Ajouter exercice"]}),e.jsxs(A,{variant:"destructive",size:"sm",onClick:()=>q(j),className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(je,{className:"h-4 w-4"})," Supprimer bloc"]})]})]})},j))})]}),e.jsx("div",{className:"h-8"})]}),e.jsx(Te,{open:!!o,onOpenChange:u=>{u||d(null)},children:e.jsx($e,{className:"max-w-4xl",children:e.jsx(Ts,{title:o?.name??"",description:o?.description??void 0,items:o?.items})})})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:"Coach"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Création"})]}),e.jsxs("button",{type:"button",onClick:()=>{P(Z()),O("compact"),i(!0)},className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(xe,{className:"h-4 w-4"})," Nouvelle"]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-border bg-card px-3 py-2",children:[e.jsx(rn,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{className:"w-full bg-transparent text-sm outline-none placeholder:text-muted-foreground",placeholder:"Rechercher une séance",value:g,onChange:u=>_(u.target.value)})]}),be&&e.jsx("div",{className:"mt-4 rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:"Impossible de charger les assignations."}),k&&e.jsx("div",{className:"mt-4 space-y-4",children:[1,2,3].map(u=>e.jsx("div",{className:"h-24 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},u))}),e.jsx("div",{className:"mt-4 space-y-3",children:M.map(u=>{const{totalDistance:j,totalDuration:b,blockCount:T}=ua(u),G=ma(u.id,ee??null),re=!G||U.isPending;return e.jsx(z,{className:"rounded-2xl border-border",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold tracking-tight",children:u.name}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(en,{className:"h-3.5 w-3.5"}),j,"m"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(nn,{className:"h-3.5 w-3.5"}),"~",b??"—"," min"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(sn,{className:"h-3.5 w-3.5"}),T]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>d(u),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Aperçu nageur",title:"Aperçu nageur",children:e.jsx($s,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>{P({id:u.id??null,name:u.name??Ws(new Date),description:u.description??"",estimatedDuration:Number(u.estimated_duration??0),blocks:oa(u.items??[])}),O("compact"),i(!0)},className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Modifier",title:"Modifier",children:e.jsx(wn,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>p(u),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Archiver",title:"Archiver",children:e.jsx(mn,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>{re||m(u)},className:$("inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted",re&&"cursor-not-allowed text-muted-foreground"),"aria-label":"Supprimer",title:ee===null?"Suppression désactivée":G?"Supprimer":"Séance déjà assignée",children:e.jsx(je,{className:"h-4 w-4"})})]})]})})},u.id)})}),e.jsx("div",{className:"h-8"})]}),e.jsx(Te,{open:!!o,onOpenChange:u=>{u||d(null)},children:e.jsx($e,{className:"max-w-4xl",children:e.jsx(Ts,{title:o?.name??"",description:o?.description??void 0,items:o?.items})})}),e.jsx(ss,{open:!!x,onOpenChange:u=>{u||p(null)},children:e.jsxs(qe,{children:[e.jsxs(ze,{children:[e.jsx(Le,{children:"Archiver la séance ?"}),e.jsx(Be,{children:"La séance sera masquée du catalogue (sans suppression)."})]}),e.jsxs(Ge,{children:[e.jsx(He,{children:"Annuler"}),e.jsx(Ke,{onClick:()=>{x&&(se(u=>new Set([...Array.from(u),x.id])),p(null),s({title:"Séance archivée"}))},children:"Archiver"})]})]})}),e.jsx(ss,{open:!!f,onOpenChange:u=>{u||m(null)},children:e.jsxs(qe,{children:[e.jsxs(ze,{children:[e.jsx(Le,{children:"Supprimer la séance ?"}),e.jsx(Be,{children:"Cette action est définitive. La séance sera supprimée du catalogue."})]}),e.jsxs(Ge,{children:[e.jsx(He,{children:"Annuler"}),e.jsx(Ke,{onClick:()=>{f&&U.mutate(f.id)},children:"Supprimer"})]})]})})]})}function xa(s,t,{checkForDefaultPrevented:r=!0}={}){return function(n){if(s?.(n),r===!1||!n.defaultPrevented)return t?.(n)}}var ha=rs[" useInsertionEffect ".trim().toString()]||ns;function ga({prop:s,defaultProp:t,onChange:r=()=>{},caller:a}){const[n,i,o]=fa({defaultProp:t,onChange:r}),d=s!==void 0,f=d?s:n;{const x=l.useRef(s!==void 0);l.useEffect(()=>{const p=x.current;p!==d&&console.warn(`${a} is changing from ${p?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),x.current=d},[d,a])}const m=l.useCallback(x=>{if(d){const p=ja(x)?x(s):x;p!==s&&o.current?.(p)}else i(x)},[d,s,i,o]);return[f,m]}function fa({defaultProp:s,onChange:t}){const[r,a]=l.useState(s),n=l.useRef(r),i=l.useRef(t);return ha(()=>{i.current=t},[t]),l.useEffect(()=>{n.current!==r&&(i.current?.(r),n.current=r)},[r,n]),[r,a,i]}function ja(s){return typeof s=="function"}var Ht="Toggle",Ns=l.forwardRef((s,t)=>{const{pressed:r,defaultPressed:a,onPressedChange:n,...i}=s,[o,d]=ga({prop:r,onChange:n,defaultProp:a??!1,caller:Ht});return e.jsx(he.button,{type:"button","aria-pressed":o,"data-state":o?"on":"off","data-disabled":s.disabled?"":void 0,...i,ref:t,onClick:xa(s.onClick,()=>{s.disabled||d(!o)})})});Ns.displayName=Ht;var Wt=Ns,va=rs[" useInsertionEffect ".trim().toString()]||ns;function Ut({prop:s,defaultProp:t,onChange:r=()=>{},caller:a}){const[n,i,o]=ya({defaultProp:t,onChange:r}),d=s!==void 0,f=d?s:n;{const x=l.useRef(s!==void 0);l.useEffect(()=>{const p=x.current;p!==d&&console.warn(`${a} is changing from ${p?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),x.current=d},[d,a])}const m=l.useCallback(x=>{if(d){const p=ba(x)?x(s):x;p!==s&&o.current?.(p)}else i(x)},[d,s,i,o]);return[f,m]}function ya({defaultProp:s,onChange:t}){const[r,a]=l.useState(s),n=l.useRef(r),i=l.useRef(t);return va(()=>{i.current=t},[t]),l.useEffect(()=>{n.current!==r&&(i.current?.(r),n.current=r)},[r,n]),[r,a,i]}function ba(s){return typeof s=="function"}var ve="ToggleGroup",[Qt]=Ue(ve,[ls]),Jt=ls(),ws=ue.forwardRef((s,t)=>{const{type:r,...a}=s;if(r==="single"){const n=a;return e.jsx(Na,{...n,ref:t})}if(r==="multiple"){const n=a;return e.jsx(wa,{...n,ref:t})}throw new Error(`Missing prop \`type\` expected on \`${ve}\``)});ws.displayName=ve;var[Xt,Yt]=Qt(ve),Na=ue.forwardRef((s,t)=>{const{value:r,defaultValue:a,onValueChange:n=()=>{},...i}=s,[o,d]=Ut({prop:r,defaultProp:a??"",onChange:n,caller:ve});return e.jsx(Xt,{scope:s.__scopeToggleGroup,type:"single",value:ue.useMemo(()=>o?[o]:[],[o]),onItemActivate:d,onItemDeactivate:ue.useCallback(()=>d(""),[d]),children:e.jsx(Zt,{...i,ref:t})})}),wa=ue.forwardRef((s,t)=>{const{value:r,defaultValue:a,onValueChange:n=()=>{},...i}=s,[o,d]=Ut({prop:r,defaultProp:a??[],onChange:n,caller:ve}),f=ue.useCallback(x=>d((p=[])=>[...p,x]),[d]),m=ue.useCallback(x=>d((p=[])=>p.filter(g=>g!==x)),[d]);return e.jsx(Xt,{scope:s.__scopeToggleGroup,type:"multiple",value:o,onItemActivate:f,onItemDeactivate:m,children:e.jsx(Zt,{...i,ref:t})})});ws.displayName=ve;var[_a,Ca]=Qt(ve),Zt=ue.forwardRef((s,t)=>{const{__scopeToggleGroup:r,disabled:a=!1,rovingFocus:n=!0,orientation:i,dir:o,loop:d=!0,...f}=s,m=Jt(r),x=et(o),p={role:"group",dir:x,...f};return e.jsx(_a,{scope:r,rovingFocus:n,disabled:a,children:n?e.jsx(lt,{asChild:!0,...m,orientation:i,dir:x,loop:d,children:e.jsx(he.div,{...p,ref:t})}):e.jsx(he.div,{...p,ref:t})})}),ts="ToggleGroupItem",er=ue.forwardRef((s,t)=>{const r=Yt(ts,s.__scopeToggleGroup),a=Ca(ts,s.__scopeToggleGroup),n=Jt(s.__scopeToggleGroup),i=r.value.includes(s.value),o=a.disabled||s.disabled,d={...s,pressed:i,disabled:o},f=ue.useRef(null);return a.rovingFocus?e.jsx(ot,{asChild:!0,...n,focusable:!o,active:i,ref:f,children:e.jsx(Ys,{...d,ref:t})}):e.jsx(Ys,{...d,ref:t})});er.displayName=ts;var Ys=ue.forwardRef((s,t)=>{const{__scopeToggleGroup:r,value:a,...n}=s,i=Yt(ts,r),o={role:"radio","aria-checked":s.pressed,"aria-pressed":void 0},d=i.type==="single"?o:void 0;return e.jsx(Ns,{...d,...n,ref:t,onPressedChange:f=>{f?i.onItemActivate(a):i.onItemDeactivate(a)}})}),sr=ws,tr=er;const rr=Pr("inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-2 min-w-9",sm:"h-8 px-1.5 min-w-8",lg:"h-10 px-2.5 min-w-10"}},defaultVariants:{variant:"default",size:"default"}}),Sa=l.forwardRef(({className:s,variant:t,size:r,...a},n)=>e.jsx(Wt,{ref:n,className:$(rr({variant:t,size:r,className:s})),...a}));Sa.displayName=Wt.displayName;const nr=l.createContext({size:"default",variant:"default"}),ar=l.forwardRef(({className:s,variant:t,size:r,children:a,...n},i)=>e.jsx(sr,{ref:i,className:$("flex items-center justify-center gap-1",s),...n,children:e.jsx(nr.Provider,{value:{variant:t,size:r},children:a})}));ar.displayName=sr.displayName;const es=l.forwardRef(({className:s,children:t,variant:r,size:a,...n},i)=>{const o=l.useContext(nr);return e.jsx(tr,{ref:i,className:$(rr({variant:o.variant||r,size:o.size||a}),s),...n,children:t})});es.displayName=tr.displayName;const Ve=({title:s,description:t,onBack:r,actions:a})=>e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(A,{variant:"ghost",size:"sm",className:"-ml-2",onClick:r,children:[e.jsx(dn,{className:"mr-2 h-4 w-4"}),"Retour à l'accueil"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:s}),t?e.jsx("p",{className:"text-sm text-muted-foreground",children:t}):null]}),a?e.jsx("div",{className:"flex items-center gap-2",children:a}):null]});function Ie(s,t,{checkForDefaultPrevented:r=!0}={}){return function(n){if(s?.(n),r===!1||!n.defaultPrevented)return t?.(n)}}function Aa(s){const t=Ra(s),r=l.forwardRef((a,n)=>{const{children:i,...o}=a,d=l.Children.toArray(i),f=d.find(Da);if(f){const m=f.props.children,x=d.map(p=>p===f?l.Children.count(m)>1?l.Children.only(null):l.isValidElement(m)?m.props.children:null:p);return e.jsx(t,{...o,ref:n,children:l.isValidElement(m)?l.cloneElement(m,void 0,x):null})}return e.jsx(t,{...o,ref:n,children:i})});return r.displayName=`${s}.Slot`,r}function Ra(s){const t=l.forwardRef((r,a)=>{const{children:n,...i}=r;if(l.isValidElement(n)){const o=Pa(n),d=Ea(i,n.props);return n.type!==l.Fragment&&(d.ref=a?Mr(a,o):o),l.cloneElement(n,d)}return l.Children.count(n)>1?l.Children.only(null):null});return t.displayName=`${s}.SlotClone`,t}var ka=Symbol("radix.slottable");function Da(s){return l.isValidElement(s)&&typeof s.type=="function"&&"__radixId"in s.type&&s.type.__radixId===ka}function Ea(s,t){const r={...t};for(const a in t){const n=s[a],i=t[a];/^on[A-Z]/.test(a)?n&&i?r[a]=(...d)=>{const f=i(...d);return n(...d),f}:n&&(r[a]=n):a==="style"?r[a]={...n,...i}:a==="className"&&(r[a]=[n,i].filter(Boolean).join(" "))}return{...s,...r}}function Pa(s){let t=Object.getOwnPropertyDescriptor(s.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?s.ref:(t=Object.getOwnPropertyDescriptor(s,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?s.props.ref:s.props.ref||s.ref)}var Ma=rs[" useInsertionEffect ".trim().toString()]||ns;function Ta({prop:s,defaultProp:t,onChange:r=()=>{},caller:a}){const[n,i,o]=$a({defaultProp:t,onChange:r}),d=s!==void 0,f=d?s:n;{const x=l.useRef(s!==void 0);l.useEffect(()=>{const p=x.current;p!==d&&console.warn(`${a} is changing from ${p?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),x.current=d},[d,a])}const m=l.useCallback(x=>{if(d){const p=Fa(x)?x(s):x;p!==s&&o.current?.(p)}else i(x)},[d,s,i,o]);return[f,m]}function $a({defaultProp:s,onChange:t}){const[r,a]=l.useState(s),n=l.useRef(r),i=l.useRef(t);return Ma(()=>{i.current=t},[t]),l.useEffect(()=>{n.current!==r&&(i.current?.(r),n.current=r)},[r,n]),[r,a,i]}function Fa(s){return typeof s=="function"}var cs="Popover",[ir]=Ue(cs,[at]),Qe=at(),[Va,ye]=ir(cs),lr=s=>{const{__scopePopover:t,children:r,open:a,defaultOpen:n,onOpenChange:i,modal:o=!1}=s,d=Qe(t),f=l.useRef(null),[m,x]=l.useState(!1),[p,g]=Ta({prop:a,defaultProp:n??!1,onChange:i,caller:cs});return e.jsx(Tr,{...d,children:e.jsx(Va,{scope:t,contentId:$r(),triggerRef:f,open:p,onOpenChange:g,onOpenToggle:l.useCallback(()=>g(_=>!_),[g]),hasCustomAnchor:m,onCustomAnchorAdd:l.useCallback(()=>x(!0),[]),onCustomAnchorRemove:l.useCallback(()=>x(!1),[]),modal:o,children:r})})};lr.displayName=cs;var or="PopoverAnchor",Ia=l.forwardRef((s,t)=>{const{__scopePopover:r,...a}=s,n=ye(or,r),i=Qe(r),{onCustomAnchorAdd:o,onCustomAnchorRemove:d}=n;return l.useEffect(()=>(o(),()=>d()),[o,d]),e.jsx(it,{...i,...a,ref:t})});Ia.displayName=or;var cr="PopoverTrigger",dr=l.forwardRef((s,t)=>{const{__scopePopover:r,...a}=s,n=ye(cr,r),i=Qe(r),o=_e(t,n.triggerRef),d=e.jsx(he.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":hr(n.open),...a,ref:o,onClick:Ie(s.onClick,n.onOpenToggle)});return n.hasCustomAnchor?d:e.jsx(it,{asChild:!0,...i,children:d})});dr.displayName=cr;var _s="PopoverPortal",[Oa,qa]=ir(_s,{forceMount:void 0}),ur=s=>{const{__scopePopover:t,forceMount:r,children:a,container:n}=s,i=ye(_s,t);return e.jsx(Oa,{scope:t,forceMount:r,children:e.jsx(ys,{present:r||i.open,children:e.jsx(Fr,{asChild:!0,container:n,children:a})})})};ur.displayName=_s;var ke="PopoverContent",mr=l.forwardRef((s,t)=>{const r=qa(ke,s.__scopePopover),{forceMount:a=r.forceMount,...n}=s,i=ye(ke,s.__scopePopover);return e.jsx(ys,{present:a||i.open,children:i.modal?e.jsx(Ga,{...n,ref:t}):e.jsx(La,{...n,ref:t})})});mr.displayName=ke;var za=Aa("PopoverContent.RemoveScroll"),Ga=l.forwardRef((s,t)=>{const r=ye(ke,s.__scopePopover),a=l.useRef(null),n=_e(t,a),i=l.useRef(!1);return l.useEffect(()=>{const o=a.current;if(o)return Vr(o)},[]),e.jsx(Ir,{as:za,allowPinchZoom:!0,children:e.jsx(pr,{...s,ref:n,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ie(s.onCloseAutoFocus,o=>{o.preventDefault(),i.current||r.triggerRef.current?.focus()}),onPointerDownOutside:Ie(s.onPointerDownOutside,o=>{const d=o.detail.originalEvent,f=d.button===0&&d.ctrlKey===!0,m=d.button===2||f;i.current=m},{checkForDefaultPrevented:!1}),onFocusOutside:Ie(s.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),La=l.forwardRef((s,t)=>{const r=ye(ke,s.__scopePopover),a=l.useRef(!1),n=l.useRef(!1);return e.jsx(pr,{...s,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{s.onCloseAutoFocus?.(i),i.defaultPrevented||(a.current||r.triggerRef.current?.focus(),i.preventDefault()),a.current=!1,n.current=!1},onInteractOutside:i=>{s.onInteractOutside?.(i),i.defaultPrevented||(a.current=!0,i.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const o=i.target;r.triggerRef.current?.contains(o)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&n.current&&i.preventDefault()}})}),pr=l.forwardRef((s,t)=>{const{__scopePopover:r,trapFocus:a,onOpenAutoFocus:n,onCloseAutoFocus:i,disableOutsidePointerEvents:o,onEscapeKeyDown:d,onPointerDownOutside:f,onFocusOutside:m,onInteractOutside:x,...p}=s,g=ye(ke,r),_=Qe(r);return Or(),e.jsx(qr,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:n,onUnmountAutoFocus:i,children:e.jsx(zr,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:x,onEscapeKeyDown:d,onPointerDownOutside:f,onFocusOutside:m,onDismiss:()=>g.onOpenChange(!1),children:e.jsx(Gr,{"data-state":hr(g.open),role:"dialog",id:g.contentId,..._,...p,ref:t,style:{...p.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),xr="PopoverClose",Ba=l.forwardRef((s,t)=>{const{__scopePopover:r,...a}=s,n=ye(xr,r);return e.jsx(he.button,{type:"button",...a,ref:t,onClick:Ie(s.onClick,()=>n.onOpenChange(!1))})});Ba.displayName=xr;var Ka="PopoverArrow",Ha=l.forwardRef((s,t)=>{const{__scopePopover:r,...a}=s,n=Qe(r);return e.jsx(Lr,{...n,...a,ref:t})});Ha.displayName=Ka;function hr(s){return s?"open":"closed"}var Wa=lr,Ua=dr,Qa=ur,gr=mr;const Ja=Wa,Xa=Ua,fr=l.forwardRef(({className:s,align:t="center",sideOffset:r=4,...a},n)=>e.jsx(Qa,{children:e.jsx(gr,{ref:n,align:t,sideOffset:r,className:$("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",s),...a})}));fr.displayName=gr.displayName;const Ya=({onBack:s,swimSessions:t,strengthSessions:r,athletes:a,groups:n})=>{const{toast:i}=as(),[o,d]=l.useState({session_type:"swim",session_id:"",assigned_date:new Date().toISOString().split("T")[0],assigned_slot:"morning"}),[f,m]=l.useState(!1),[x,p]=l.useState("user"),[g,_]=l.useState(""),[N,O]=l.useState([]),y=h=>{const M=typeof h=="number"?h:Number(h);return Number.isFinite(M)&&M>0?M:null},se=l.useMemo(()=>a.map(h=>({value:h.id?`id:${h.id}`:`name:${h.display_name}`,label:h.group_label?`${h.display_name} · ${h.group_label}`:h.display_name,id:h.id,name:h.display_name})),[a]),Z=l.useMemo(()=>new Map(se.map(h=>[h.value,h])),[se]),w=l.useMemo(()=>n.map(h=>{const M=y(h.id);return M?{...h,gid:M}:null}).filter(h=>!!h),[n]),P=l.useMemo(()=>w.filter(h=>N.includes(h.gid)),[w,N]),ae=l.useMemo(()=>{if(P.length===0)return"Choisir des groupes";const h=P.slice(0,2).map(J=>J.name).join(", "),M=P.length>2?` +${P.length-2}`:"";return`${h}${M}`},[P]),k=ie({mutationFn:async h=>B.assignments_create(h),onSuccess:()=>{i({title:"Séance assignée & notifiée"})},onError:h=>{const M="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",J=h instanceof Error?h.message:typeof h=="string"?h:M;let U=J;const E=J.match(/HTTP \d+:\s*(\{.*\})/);if(E)try{U=JSON.parse(E[1])?.error||M}catch{U=M}i({title:"Erreur d'assignation",description:U})}}),ee=async()=>{const h=Number(o.session_id);if(!Number.isInteger(h)||h<=0){i({title:"Séance invalide",description:"Sélectionnez une séance valide."});return}if(x==="group"){if(N.length===0){i({title:"Groupe manquant",description:"Sélectionnez au moins un groupe."});return}m(!0);try{const C={assignment_type:o.session_type,session_id:h,scheduled_date:o.assigned_date,scheduled_slot:o.assigned_slot},q=Array.from(new Set(N));await Promise.all(q.map(F=>B.assignments_create({...C,target_group_id:F}))),i({title:"Séance assignée & notifiée"})}catch(C){const q="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",F=C instanceof Error?C.message:typeof C=="string"?C:q;let X=F;const K=F.match(/HTTP \d+:\s*(\{.*\})/);if(K)try{X=JSON.parse(K[1])?.error||q}catch{X=q}i({title:"Erreur d'assignation",description:X})}finally{m(!1)}return}const M=g.trim();if(!M){i({title:"Nageur manquant",description:"Sélectionnez un nageur."});return}const J=Z.get(M),U=J?.id??(Number.isFinite(Number(M))&&Number(M)>0?Number(M):void 0);if(!Number.isFinite(U)||Number(U)<=0){i({title:"Nageur invalide",description:"Sélectionnez un nageur avec un identifiant valide."});return}const E=J?.name??M.replace(/^name:/,"");k.mutate({assignment_type:o.session_type,session_id:h,target_athlete:E,target_user_id:U,scheduled_date:o.assigned_date,scheduled_slot:o.assigned_slot})},be=!o.session_id||(x==="group"?N.length===0:!g.trim())||k.isPending||f;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(Ve,{title:"Assigner une séance",description:"Planifiez une séance pour un nageur ou un ou plusieurs groupes.",onBack:s}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(z,{className:"border-l-4 border-l-primary",children:[e.jsxs(W,{children:[e.jsx(Q,{children:"Séance"}),e.jsx(Y,{children:"Choisissez le type et la séance à envoyer."})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Type"}),e.jsxs(le,{value:o.session_type,onValueChange:h=>d({...o,session_type:h,session_id:""}),children:[e.jsx(oe,{children:e.jsx(ce,{})}),e.jsxs(de,{children:[e.jsx(L,{value:"swim",children:"Natation"}),e.jsx(L,{value:"strength",children:"Musculation"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Séance"}),e.jsxs(le,{value:o.session_id,onValueChange:h=>d({...o,session_id:h}),children:[e.jsx(oe,{children:e.jsx(ce,{placeholder:"Choisir..."})}),e.jsx(de,{children:o.session_type==="swim"?t?.map(h=>e.jsx(L,{value:h.id.toString(),children:h.name},h.id)):r?.map(h=>e.jsx(L,{value:h.id.toString(),children:h.title},h.id))})]})]})]})]}),e.jsxs(z,{children:[e.jsxs(W,{children:[e.jsx(Q,{children:"Cible & planification"}),e.jsx(Y,{children:"Définissez le destinataire, la date et le créneau."})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Cible"}),e.jsxs(le,{value:x,onValueChange:h=>{p(h),_(""),O([])},children:[e.jsx(oe,{children:e.jsx(ce,{})}),e.jsxs(de,{children:[e.jsx(L,{value:"user",children:"Nageur"}),e.jsx(L,{value:"group",children:"Groupe(s)"})]})]})]}),x==="user"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Nageur"}),se.length>0?e.jsxs(le,{value:g,onValueChange:_,children:[e.jsx(oe,{children:e.jsx(ce,{placeholder:"Choisir un nageur"})}),e.jsx(de,{children:se.map(h=>e.jsx(L,{value:h.value,children:h.label},h.value))})]}):e.jsx(I,{value:g,onChange:h=>_(h.target.value),placeholder:"ex: Camille"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Groupes"}),n.length>0?e.jsxs(Ja,{children:[e.jsx(Xa,{asChild:!0,children:e.jsxs(A,{type:"button",variant:"outline",className:"w-full justify-between","aria-label":"Sélection des groupes",children:[e.jsx("span",{className:"truncate",children:ae}),e.jsx(Br,{className:"ml-2 h-4 w-4 opacity-50"})]})}),e.jsxs(fr,{className:"w-[--radix-popover-trigger-width] p-2",align:"start",children:[e.jsx("div",{className:"max-h-64 overflow-auto",children:e.jsx("div",{className:"space-y-1",children:w.map(h=>{const M=N.includes(h.gid);return e.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 hover:bg-muted",children:[e.jsx(fs,{checked:M,onCheckedChange:J=>{const U=J===!0;O(E=>U?E.includes(h.gid)?E:[...E,h.gid]:E.filter(C=>C!==h.gid))}}),e.jsx("span",{className:"text-sm",children:h.name})]},h.gid)})})}),N.length>0?e.jsx(A,{type:"button",variant:"ghost",size:"sm",className:"mt-2 w-full",onClick:()=>O([]),children:"Tout désélectionner"}):null]})]}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"Aucun groupe disponible."}),N.length>0?e.jsxs("div",{className:"text-xs text-muted-foreground",children:[N.length," groupe",N.length>1?"s":""," sélectionné",N.length>1?"s":"","."]}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Date"}),e.jsx(I,{type:"date",value:o.assigned_date,onChange:h=>d({...o,assigned_date:h.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Créneau"}),e.jsxs(le,{value:o.assigned_slot,onValueChange:h=>d({...o,assigned_slot:h}),children:[e.jsx(oe,{children:e.jsx(ce,{placeholder:"Choisir..."})}),e.jsxs(de,{children:[e.jsx(L,{value:"morning",children:"Matin"}),e.jsx(L,{value:"evening",children:"Soir"})]})]})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(A,{className:"w-full sm:w-auto",onClick:ee,disabled:be,children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),k.isPending||f?"Assignation...":"Assigner & notifier"]})})]})},Za=({onBack:s,athletes:t,groups:r,athletesLoading:a})=>{const{toast:n}=as(),[i,o]=l.useState(""),[d,f]=l.useState("Message Coach"),[m,x]=l.useState(""),p=l.useMemo(()=>t.filter(y=>y.id).map(y=>({value:`user:${y.id}`,label:y.group_label?`${y.display_name} · ${y.group_label}`:y.display_name,id:y.id})),[t]),g=l.useMemo(()=>r.map(y=>({value:`group:${y.id}`,label:y.name,id:y.id})),[r]),_=l.useMemo(()=>new Map([...p,...g].map(y=>[y.value,y])),[p,g]),N=ie({mutationFn:y=>B.notifications_send({...y,type:"message"}),onSuccess:()=>{n({title:"Message envoyé"}),o("")}}),O=()=>{if(!d.trim()||!i.trim()){n({title:"Message incomplet",description:"Ajoutez un titre et un contenu."});return}if(!m){n({title:"Destinataire manquant",description:"Sélectionnez un nageur ou un groupe."});return}const y=_.get(m);if(!y?.id){n({title:"Destinataire invalide",description:"Sélectionnez un destinataire valide."});return}if(m.startsWith("group:")){N.mutate({title:d,body:i,targets:[{target_group_id:y.id}]});return}N.mutate({title:d,body:i,targets:[{target_user_id:y.id}]})};return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(Ve,{title:"Messagerie rapide",description:"Envoyez un message ciblé à vos nageurs.",onBack:s}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(z,{className:"border-l-4 border-l-primary",children:[e.jsxs(W,{children:[e.jsx(Q,{children:"Destinataire"}),e.jsx(Y,{children:"Sélectionnez un nageur ou un groupe à prévenir."})]}),e.jsx(H,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:"Destinataire"}),e.jsxs(le,{value:m,onValueChange:x,children:[e.jsx(oe,{children:e.jsx(ce,{placeholder:a?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(de,{children:[g.length?e.jsxs(e.Fragment,{children:[e.jsx(L,{value:"section-group",disabled:!0,children:"Groupes"}),g.map(y=>e.jsx(L,{value:y.value,children:y.label},y.value))]}):null,p.length?e.jsxs(e.Fragment,{children:[e.jsx(L,{value:"section-athlete",disabled:!0,children:"Nageurs"}),p.map(y=>e.jsx(L,{value:y.value,children:y.label},y.value))]}):null]})]})]})})]}),e.jsxs(z,{children:[e.jsxs(W,{children:[e.jsx(Q,{children:"Contenu"}),e.jsx(Y,{children:"Rédigez votre message en quelques lignes."})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"msg-title",children:"Titre"}),e.jsx(I,{id:"msg-title",value:d,onChange:y=>f(y.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"msg-body",children:"Message"}),e.jsx(Fe,{id:"msg-body",placeholder:"Message...",value:i,onChange:y=>o(y.target.value),rows:5,maxLength:500}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[i.length,"/500"]})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(A,{className:"w-full sm:w-auto",onClick:O,disabled:N.isPending,children:[e.jsx(is,{className:"mr-2 h-4 w-4"}),N.isPending?"Envoi...":"Envoyer"]})})]})},ei=({onNavigate:s})=>e.jsxs(z,{className:"border-l-4 border-l-primary",children:[e.jsxs(W,{children:[e.jsx(Q,{children:"Actions rapides"}),e.jsx(Y,{children:"Accélérez vos tâches les plus fréquentes."})]}),e.jsxs(H,{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs(A,{className:"justify-start",variant:"outline",onClick:()=>s("assignments"),children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),"Assigner une séance"]}),e.jsxs(A,{className:"justify-start",variant:"outline",onClick:()=>s("messaging"),children:[e.jsx(is,{className:"mr-2 h-4 w-4"}),"Message rapide"]})]})]}),si=({onNavigate:s,onOpenRecordsAdmin:t,athletes:r,athletesLoading:a,upcomingBirthdays:n,birthdaysLoading:i,kpiLoading:o,kpiPeriod:d,onKpiPeriodChange:f,fatigueAlerts:m,mostLoadedAthlete:x})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Espace Coach"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Votre tableau de bord pour gérer les séances, les nageurs et la communication."})]}),e.jsxs("div",{className:"space-y-3 sm:hidden",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-[0.2em] text-muted-foreground",children:"Par où commencer"})}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("button",{type:"button",onClick:()=>s("swim"),className:"rounded-xl border bg-white p-4 text-left shadow-sm transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Créer une séance natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Structurer un nouveau plan."})]}),e.jsx(Es,{className:"h-5 w-5 text-primary"})]})}),e.jsx("button",{type:"button",onClick:()=>s("assignments"),className:"rounded-xl border bg-white p-4 text-left shadow-sm transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Assigner une séance"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Envoyer une séance à un nageur."})]}),e.jsx(Oe,{className:"h-5 w-5 text-primary"})]})}),e.jsx("button",{type:"button",onClick:()=>s("messaging"),className:"rounded-xl border bg-white p-4 text-left shadow-sm transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Envoyer un message"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Relancer ou féliciter un nageur."})]}),e.jsx(is,{className:"h-5 w-5 text-primary"})]})})]})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsx(ei,{onNavigate:s})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(z,{className:"shadow-sm",children:[e.jsxs(W,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"h-5 w-5 text-primary"}),"Natation"]}),e.jsx(Y,{children:"Consultez et créez des séances natation."})]}),e.jsx(H,{children:e.jsx(A,{className:"w-full",onClick:()=>s("swim"),children:"Accéder à la bibliothèque"})})]}),e.jsxs(z,{className:"shadow-sm",children:[e.jsxs(W,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(Hr,{className:"h-5 w-5 text-primary"}),"Musculation"]}),e.jsx(Y,{children:"Préparez les plans muscu et les suivis."})]}),e.jsx(H,{children:e.jsx(A,{className:"w-full",onClick:()=>s("strength"),children:"Accéder à la bibliothèque"})})]}),e.jsxs(z,{className:"shadow-sm",children:[e.jsxs(W,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"h-5 w-5 text-primary"}),"Mes nageurs"]}),e.jsx(Y,{children:"Accédez aux fiches individuelles et aux groupes."})]}),e.jsx(H,{children:e.jsx(A,{className:"w-full",onClick:()=>s("swimmers"),children:"Voir les nageurs"})})]}),e.jsxs(z,{className:"shadow-sm",children:[e.jsxs(W,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(Wr,{className:"h-5 w-5 text-primary"}),"Records club"]}),e.jsx(Y,{children:"Importer les performances FFN et reconstruire les records."})]}),e.jsx(H,{children:e.jsx(A,{className:"w-full",variant:"outline",onClick:t,children:"Administration des records"})})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(z,{className:"sm:hidden bg-primary text-primary-foreground",children:[e.jsxs(W,{className:"space-y-1",children:[e.jsx(Q,{className:"text-base",children:"Indicateurs clés"}),e.jsx(Y,{className:"text-primary-foreground/70",children:"Synthèse rapide pour aujourd'hui."})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-primary-foreground/10 bg-primary-foreground/5 p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-primary-foreground/70",children:"Fatigue 5/5"}),e.jsx("p",{className:"text-2xl font-semibold",children:o?"…":m.length}),e.jsx("p",{className:"text-xs text-primary-foreground/70",children:o?"Chargement...":m.length?m.slice(0,2).map(p=>p.athleteName).join(", "):"Aucune alerte"})]}),e.jsx(Os,{className:"h-5 w-5 text-primary-foreground/70"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-primary-foreground/10 bg-primary-foreground/5 p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-primary-foreground/70",children:"Nageur le plus chargé"}),e.jsx("p",{className:"text-lg font-semibold",children:o?"…":x?.athleteName??"-"}),e.jsx("p",{className:"text-xs text-primary-foreground/70",children:o?"Calcul en cours":x?`Charge ${Math.round(x.loadScore)}`:"Pas de données récentes"})]}),e.jsx(Ye,{className:"h-5 w-5 text-primary-foreground/70"})]})]})]}),e.jsxs(z,{className:"hidden sm:block",children:[e.jsx(W,{className:"space-y-2",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Q,{children:"Signaux clés"}),e.jsx(Y,{children:"Vue d'ensemble rapide de votre groupe."})]}),e.jsxs(ar,{type:"single",size:"sm",variant:"outline",value:String(d),onValueChange:p=>{p&&f(Number(p))},children:[e.jsx(es,{value:"7","aria-label":"Période 7 jours","aria-pressed":d===7,children:"7j"}),e.jsx(es,{value:"30","aria-label":"Période 30 jours","aria-pressed":d===30,children:"30j"}),e.jsx(es,{value:"365","aria-label":"Période 365 jours","aria-pressed":d===365,children:"365j"})]})]})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border bg-muted/30 p-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Fatigue 5/5 (",d,"j)"]}),e.jsx("p",{className:"text-xl font-semibold",children:o?"…":m.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o?"Chargement...":m.length?m.slice(0,2).map(p=>p.athleteName).join(", "):"Aucune alerte"})]}),e.jsx(Os,{className:"h-5 w-5 text-muted-foreground"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border bg-muted/30 p-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Nageur le plus chargé (",d,"j)"]}),e.jsx("p",{className:"text-xl font-semibold",children:o?"…":x?.athleteName??"-"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o?"Calcul en cours":x?`Charge ${Math.round(x.loadScore)}`:"Pas de données récentes"})]}),e.jsx(Ye,{className:"h-5 w-5 text-muted-foreground"})]})]})]}),e.jsxs(z,{children:[e.jsxs(W,{children:[e.jsx(Q,{children:"Anniversaires à venir"}),e.jsx(Y,{children:"Les 30 prochains jours."})]}),e.jsxs(H,{className:"space-y-3",children:[i?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Chargement..."}):n&&n.length>0?n.slice(0,3).map(p=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:p.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:ti(p.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-semibold text-primary",children:["J-",p.days_until]})]},p.id)):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun anniversaire dans les 30 prochains jours."}),e.jsx(A,{variant:"outline",className:"w-full",onClick:()=>s("swimmers"),children:"Voir tous les nageurs"})]})]})]})]}),ti=s=>{if(!s)return"-";const t=new Date(s);return Number.isNaN(t.getTime())?s:t.toLocaleDateString("fr-FR")},Zs=s=>s.toISOString().split("T")[0],ri=s=>new Date(s.completed_at||s.started_at||s.date||s.created_at||0).getTime(),ni=s=>{if(!s.length)return null;const t=s.reduce((a,n)=>a+n,0)/s.length,r=Math.min(5,Math.max(1,Math.round(t/10*5)));return{average:t,rating:r}};function ji(){const s=Xe(k=>k.role);Xe(k=>k.selectedAthleteId);const t=Xe(k=>k.setSelectedAthlete),[,r]=Kr(),[a,n]=l.useState("home"),[i,o]=l.useState(7),d=s==="coach"||s==="admin",f=a==="assignments",m=a==="home"||a==="assignments"||a==="messaging"||a==="swimmers",x=a==="assignments"||a==="messaging",p=a==="home"||a==="swimmers",{data:g}=me({queryKey:["swim_catalog"],queryFn:()=>B.getSwimCatalog(),enabled:d&&f}),{data:_}=me({queryKey:["strength_catalog"],queryFn:()=>B.getStrengthSessions(),enabled:d&&f}),{data:N=[],isLoading:O}=me({queryKey:["athletes"],queryFn:()=>B.getAthletes(),enabled:d&&m}),y=l.useMemo(()=>N.slice(0,5),[N]),{data:se=[]}=me({queryKey:["groups"],queryFn:()=>B.getGroups(),enabled:d&&x}),Z=me({queryKey:["upcoming-birthdays"],queryFn:()=>B.getUpcomingBirthdays({days:30}),enabled:d&&p}),w=Z.data,P=me({queryKey:["coach-kpis",i,y.map(k=>k.id??k.display_name)],enabled:d&&a==="home"&&y.length>0,queryFn:async()=>{const k=i,ee=new Date;ee.setDate(ee.getDate()-k);const be=Zs(ee),h=Zs(new Date),M=await Promise.all(y.map(async E=>{const[C,q]=await Promise.all([B.getSessions(E.display_name,E.id),B.getStrengthHistory(E.display_name,{athleteId:E.id,limit:50,from:be,to:h})]),F=C.filter(V=>new Date(V.date).getTime()>=ee.getTime()),X=F.map(V=>V.fatigue??V.feeling).filter(V=>Number.isFinite(V)),K=F.reduce((V,te)=>V+(Number(te.duration)||0)*(Number(te.effort)||0),0),Ce=(q?.runs??[]).filter(V=>ri(V)>=ee.getTime()),Se=Ce.map(V=>V.fatigue??V.feeling??V.rpe).filter(V=>Number.isFinite(Number(V))).map(V=>Number(V)),Ae=Ce.reduce((V,te)=>{const Ne=Number(te.feeling??te.rpe??0),we=Number(te.duration??0);if(we>0&&Ne>0)return V+we*Ne;const u=Array.isArray(te.logs)?te.logs.length:0;return V+u*5},0),Ee=ni([...X,...Se]);return{athleteName:E.display_name,loadScore:K+Ae,fatigueRating:Ee}})),J=M.filter(E=>E.fatigueRating?.rating===5).map(E=>({athleteName:E.athleteName,rating:E.fatigueRating?.rating??0})),U=M.filter(E=>E.loadScore>0).sort((E,C)=>C.loadScore-E.loadScore)[0];return{fatigueAlerts:J,mostLoadedAthlete:U??null}}}),ae=k=>{t({id:k.id??null,name:k.display_name}),r("/progress")};return d?e.jsxs("div",{className:"space-y-6",children:[a==="home"?e.jsx(si,{onNavigate:n,onOpenRecordsAdmin:()=>r("/records-admin"),athletes:N,athletesLoading:O,upcomingBirthdays:w,birthdaysLoading:Z.isLoading,kpiLoading:P.isLoading,kpiPeriod:i,onKpiPeriodChange:o,fatigueAlerts:P.data?.fatigueAlerts??[],mostLoadedAthlete:P.data?.mostLoadedAthlete??null}):null,a==="assignments"?e.jsx(Ya,{onBack:()=>n("home"),swimSessions:g,strengthSessions:_,athletes:N,groups:se}):null,a==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ve,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>n("home"),actions:e.jsxs(A,{variant:"outline",onClick:()=>n("assignments"),children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(pa,{})]}):null,a==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ve,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>n("home"),actions:e.jsxs(A,{variant:"outline",onClick:()=>n("assignments"),children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(ra,{})]}):null,a==="swimmers"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ve,{title:"Nageurs",description:"Accédez aux fiches individuelles des nageurs.",onBack:()=>n("home"),actions:e.jsxs(A,{variant:"outline",onClick:()=>n("messaging"),children:[e.jsx(is,{className:"mr-2 h-4 w-4"}),"Message rapide"]})}),e.jsxs(z,{children:[e.jsxs(W,{children:[e.jsx(Q,{children:"Suivi des Nageurs"}),e.jsx(Y,{children:"Accédez aux fiches individuelles des nageurs."})]}),e.jsx(H,{children:O?e.jsx("div",{className:"space-y-3 p-2",children:[1,2,3,4,5].map(k=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-1/3 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"h-4 w-1/4 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"ml-auto h-8 w-16 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"})]},k))}):N.length?e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs(an,{children:[e.jsx(ln,{children:e.jsxs(Fs,{children:[e.jsx(xs,{children:"Nageur"}),e.jsx(xs,{children:"Groupe"}),e.jsx(xs,{className:"text-right",children:"Fiche"})]})}),e.jsx(on,{children:N.map(k=>e.jsxs(Fs,{children:[e.jsx(hs,{className:"font-medium",children:k.display_name}),e.jsx(hs,{children:k.group_label?e.jsx(cn,{variant:"secondary",children:k.group_label}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"Sans groupe"})}),e.jsx(hs,{className:"text-right",children:e.jsx(A,{size:"sm",variant:"outline",onClick:()=>ae(k),children:"Voir la fiche"})})]},k.id??k.display_name))})]})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun nageur disponible."})})]})]}):null,a==="messaging"?e.jsx(Za,{onBack:()=>n("home"),athletes:N,groups:se,athletesLoading:O}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(z,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(W,{children:[e.jsxs(Q,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(Ye,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(Y,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(H,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}export{ji as default};
