import{r as l,b as as,h as is,l as ls,m as Xs,j as e,d as Ue,n as Ys,o as he,u as we,I as Zs,p as ys,q as hr,s as et,t as fr,v as gr,W as jr,w as vr,T as yr,D as br,x as st,O as Nr,y as wr,R as de,c as _r,z as tt,A as Cr,B as Sr,E as rt,F as Ar,G as Rr,H as kr,J as Dr,K as Er,L as Pr,M as Mr,N as Tr}from"./vendor-ui-CMUPCwTD.js";import{c as pe,f as V,d as os,b as z,u as Ze,g as $r,M as cs,a as Fr,U as es,W as Rs,D as Vr,T as Or}from"./index-BDGnhHrZ.js";import{b as nt,u as me,c as ae}from"./vendor-query-WtxIVPOV.js";import{C as L,a as U,b as Q,d as W,c as J}from"./card-BVRwMXiB.js";import{b as at,B as S}from"./button-BuXE02p3.js";import{I}from"./input-DqGwk8UO.js";import{L as A}from"./label-DtR69dMf.js";import{u as Ir,S as ie,a as le,b as oe,c as ce,d as G,C as qr}from"./select-Ci-_VFAs.js";import{C as zr,P as xe}from"./plus-CEO8Bonx.js";import{T as Te}from"./textarea-DDUgdUXD.js";import{D as $e,a as Fe,b as ms,c as ps}from"./dialog-HXVQqKt4.js";import{C as gs}from"./checkbox-JWB_zlmb.js";import{T as Gr,a as Lr,b as Br,c as Kr}from"./tabs-eC7QLSed.js";import{S as ss,P as ks}from"./save-DjQpJund.js";import{c as it,R as Wr,i as Ds,g as Hr,S as Es,a as Ur,L as Qr}from"./SwimSessionConsultation-c9WFmQlv.js";import{f as Jr}from"./vendor-date-cQbdWov0.js";import{C as Xr}from"./chevron-left-DsUiL92j.js";import{P as Ps}from"./play-C8_UhknI.js";import{S as Yr}from"./search-DAAY4s2-.js";import{T as Zr}from"./timer-CnzacCB5.js";import{T as en,a as sn,b as Ms,c as xs,d as tn,e as hs}from"./table-Bu1b63OG.js";import{B as rn}from"./badge-BPZGxebf.js";import{A as nn}from"./arrow-left-ISfSBAMg.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BHfjz9SJ.js";import"./vendor-supabase-CrvtPqJM.js";import"./index-Bm0RG47H.js";import"./check-CsaGej-t.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const an=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],ln=pe("archive",an);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const on=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],Ts=pe("arrow-down",on);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cn=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],$s=pe("arrow-up",cn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dn=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],Ie=pe("bell",dn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const un=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],mn=pe("eye",un);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pn=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],xn=pe("funnel",pn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hn=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],lt=pe("grip-vertical",hn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fn=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],Fs=pe("heart-pulse",fn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gn=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],jn=pe("pencil",gn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vn=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ge=pe("trash-2",vn);function js(s,t,{checkForDefaultPrevented:r=!0}={}){return function(n){if(s?.(n),r===!1||!n.defaultPrevented)return t?.(n)}}var yn=as[" useInsertionEffect ".trim().toString()]||is;function bn({prop:s,defaultProp:t,onChange:r=()=>{},caller:a}){const[n,i,o]=Nn({defaultProp:t,onChange:r}),d=s!==void 0,g=d?s:n;{const x=l.useRef(s!==void 0);l.useEffect(()=>{const p=x.current;p!==d&&console.warn(`${a} is changing from ${p?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),x.current=d},[d,a])}const m=l.useCallback(x=>{if(d){const p=wn(x)?x(s):x;p!==s&&o.current?.(p)}else i(x)},[d,s,i,o]);return[g,m]}function Nn({defaultProp:s,onChange:t}){const[r,a]=l.useState(s),n=l.useRef(r),i=l.useRef(t);return yn(()=>{i.current=t},[t]),l.useEffect(()=>{n.current!==r&&(i.current?.(r),n.current=r)},[r,n]),[r,a,i]}function wn(s){return typeof s=="function"}var bs="Radio",[_n,ot]=Ue(bs),[Cn,Sn]=_n(bs),ct=l.forwardRef((s,t)=>{const{__scopeRadio:r,name:a,checked:n=!1,required:i,disabled:o,value:d="on",onCheck:g,form:m,...x}=s,[p,f]=l.useState(null),_=we(t,v=>f(v)),N=l.useRef(!1),q=p?m||!!p.closest("form"):!0;return e.jsxs(Cn,{scope:r,checked:n,disabled:o,children:[e.jsx(he.button,{type:"button",role:"radio","aria-checked":n,"data-state":pt(n),"data-disabled":o?"":void 0,disabled:o,value:d,...x,ref:_,onClick:js(s.onClick,v=>{n||g?.(),q&&(N.current=v.isPropagationStopped(),N.current||v.stopPropagation())})}),q&&e.jsx(mt,{control:p,bubbles:!N.current,name:a,value:d,checked:n,required:i,disabled:o,form:m,style:{transform:"translateX(-100%)"}})]})});ct.displayName=bs;var dt="RadioIndicator",ut=l.forwardRef((s,t)=>{const{__scopeRadio:r,forceMount:a,...n}=s,i=Sn(dt,r);return e.jsx(ys,{present:a||i.checked,children:e.jsx(he.span,{"data-state":pt(i.checked),"data-disabled":i.disabled?"":void 0,...n,ref:t})})});ut.displayName=dt;var An="RadioBubbleInput",mt=l.forwardRef(({__scopeRadio:s,control:t,checked:r,bubbles:a=!0,...n},i)=>{const o=l.useRef(null),d=we(o,i),g=Ir(r),m=hr(t);return l.useEffect(()=>{const x=o.current;if(!x)return;const p=window.HTMLInputElement.prototype,_=Object.getOwnPropertyDescriptor(p,"checked").set;if(g!==r&&_){const N=new Event("click",{bubbles:a});_.call(x,r),x.dispatchEvent(N)}},[g,r,a]),e.jsx(he.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...n,tabIndex:-1,ref:d,style:{...n.style,...m,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});mt.displayName=An;function pt(s){return s?"checked":"unchecked"}var Rn=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ds="RadioGroup",[kn]=Ue(ds,[ls,ot]),xt=ls(),ht=ot(),[Dn,En]=kn(ds),ft=l.forwardRef((s,t)=>{const{__scopeRadioGroup:r,name:a,defaultValue:n,value:i,required:o=!1,disabled:d=!1,orientation:g,dir:m,loop:x=!0,onValueChange:p,...f}=s,_=xt(r),N=Xs(m),[q,v]=bn({prop:i,defaultProp:n??null,onChange:p,caller:ds});return e.jsx(Dn,{scope:r,name:a,required:o,disabled:d,value:q,onValueChange:v,children:e.jsx(Ys,{asChild:!0,..._,orientation:g,dir:N,loop:x,children:e.jsx(he.div,{role:"radiogroup","aria-required":o,"aria-orientation":g,"data-disabled":d?"":void 0,dir:N,...f,ref:t})})})});ft.displayName=ds;var gt="RadioGroupItem",jt=l.forwardRef((s,t)=>{const{__scopeRadioGroup:r,disabled:a,...n}=s,i=En(gt,r),o=i.disabled||a,d=xt(r),g=ht(r),m=l.useRef(null),x=we(t,m),p=i.value===n.value,f=l.useRef(!1);return l.useEffect(()=>{const _=q=>{Rn.includes(q.key)&&(f.current=!0)},N=()=>f.current=!1;return document.addEventListener("keydown",_),document.addEventListener("keyup",N),()=>{document.removeEventListener("keydown",_),document.removeEventListener("keyup",N)}},[]),e.jsx(Zs,{asChild:!0,...d,focusable:!o,active:p,children:e.jsx(ct,{disabled:o,required:i.required,checked:p,...g,...n,name:i.name,ref:x,onCheck:()=>i.onValueChange(n.value),onKeyDown:js(_=>{_.key==="Enter"&&_.preventDefault()}),onFocus:js(n.onFocus,()=>{f.current&&m.current?.click()})})})});jt.displayName=gt;var Pn="RadioGroupIndicator",vt=l.forwardRef((s,t)=>{const{__scopeRadioGroup:r,...a}=s,n=ht(r);return e.jsx(ut,{...n,...a,ref:t})});vt.displayName=Pn;var yt=ft,bt=jt,Mn=vt;const Nt=l.forwardRef(({className:s,...t},r)=>e.jsx(yt,{className:V("grid gap-2",s),...t,ref:r}));Nt.displayName=yt.displayName;const vs=l.forwardRef(({className:s,...t},r)=>e.jsx(bt,{ref:r,className:V("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Mn,{className:"flex items-center justify-center",children:e.jsx(zr,{className:"h-3.5 w-3.5 fill-primary"})})}));vs.displayName=bt.displayName;function Tn(s,t,{checkForDefaultPrevented:r=!0}={}){return function(n){if(s?.(n),r===!1||!n.defaultPrevented)return t?.(n)}}var $n=Symbol("radix.slottable");function Fn(s){const t=({children:r})=>e.jsx(e.Fragment,{children:r});return t.displayName=`${s}.Slottable`,t.__radixId=$n,t}var wt="AlertDialog",[Vn]=Ue(wt,[et]),fe=et(),_t=s=>{const{__scopeAlertDialog:t,...r}=s,a=fe(t);return e.jsx(fr,{...a,...r,modal:!0})};_t.displayName=wt;var On="AlertDialogTrigger",In=l.forwardRef((s,t)=>{const{__scopeAlertDialog:r,...a}=s,n=fe(r);return e.jsx(wr,{...n,...a,ref:t})});In.displayName=On;var qn="AlertDialogPortal",Ct=s=>{const{__scopeAlertDialog:t,...r}=s,a=fe(t);return e.jsx(gr,{...a,...r})};Ct.displayName=qn;var zn="AlertDialogOverlay",St=l.forwardRef((s,t)=>{const{__scopeAlertDialog:r,...a}=s,n=fe(r);return e.jsx(Nr,{...n,...a,ref:t})});St.displayName=zn;var Ae="AlertDialogContent",[Gn,Ln]=Vn(Ae),Bn=Fn("AlertDialogContent"),At=l.forwardRef((s,t)=>{const{__scopeAlertDialog:r,children:a,...n}=s,i=fe(r),o=l.useRef(null),d=we(t,o),g=l.useRef(null);return e.jsx(jr,{contentName:Ae,titleName:Rt,docsSlug:"alert-dialog",children:e.jsx(Gn,{scope:r,cancelRef:g,children:e.jsxs(vr,{role:"alertdialog",...i,...n,ref:d,onOpenAutoFocus:Tn(n.onOpenAutoFocus,m=>{m.preventDefault(),g.current?.focus({preventScroll:!0})}),onPointerDownOutside:m=>m.preventDefault(),onInteractOutside:m=>m.preventDefault(),children:[e.jsx(Bn,{children:a}),e.jsx(Wn,{contentRef:o})]})})})});At.displayName=Ae;var Rt="AlertDialogTitle",kt=l.forwardRef((s,t)=>{const{__scopeAlertDialog:r,...a}=s,n=fe(r);return e.jsx(yr,{...n,...a,ref:t})});kt.displayName=Rt;var Dt="AlertDialogDescription",Et=l.forwardRef((s,t)=>{const{__scopeAlertDialog:r,...a}=s,n=fe(r);return e.jsx(br,{...n,...a,ref:t})});Et.displayName=Dt;var Kn="AlertDialogAction",Pt=l.forwardRef((s,t)=>{const{__scopeAlertDialog:r,...a}=s,n=fe(r);return e.jsx(st,{...n,...a,ref:t})});Pt.displayName=Kn;var Mt="AlertDialogCancel",Tt=l.forwardRef((s,t)=>{const{__scopeAlertDialog:r,...a}=s,{cancelRef:n}=Ln(Mt,r),i=fe(r),o=we(t,n);return e.jsx(st,{...i,...a,ref:o})});Tt.displayName=Mt;var Wn=({contentRef:s})=>{const t=`\`${Ae}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Ae}\` by passing a \`${Dt}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Ae}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return l.useEffect(()=>{document.getElementById(s.current?.getAttribute("aria-describedby"))||console.warn(t)},[t,s]),null},Hn=_t,Un=Ct,$t=St,Ft=At,Vt=Pt,Ot=Tt,It=kt,qt=Et;const rs=Hn,Qn=Un,zt=l.forwardRef(({className:s,...t},r)=>e.jsx($t,{className:V("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:r}));zt.displayName=$t.displayName;const qe=l.forwardRef(({className:s,...t},r)=>e.jsxs(Qn,{children:[e.jsx(zt,{}),e.jsx(Ft,{ref:r,className:V("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t})]}));qe.displayName=Ft.displayName;const ze=({className:s,...t})=>e.jsx("div",{className:V("flex flex-col space-y-2 text-center sm:text-left",s),...t});ze.displayName="AlertDialogHeader";const Ge=({className:s,...t})=>e.jsx("div",{className:V("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});Ge.displayName="AlertDialogFooter";const Le=l.forwardRef(({className:s,...t},r)=>e.jsx(It,{ref:r,className:V("text-lg font-semibold",s),...t}));Le.displayName=It.displayName;const Be=l.forwardRef(({className:s,...t},r)=>e.jsx(qt,{ref:r,className:V("text-sm text-muted-foreground",s),...t}));Be.displayName=qt.displayName;const Ke=l.forwardRef(({className:s,...t},r)=>e.jsx(Vt,{ref:r,className:V(at(),s),...t}));Ke.displayName=Vt.displayName;const We=l.forwardRef(({className:s,...t},r)=>e.jsx(Ot,{ref:r,className:V(at({variant:"outline"}),"mt-2 sm:mt-0",s),...t}));We.displayName=Ot.displayName;const Vs=[{key:"endurance",label:"Endurance",fieldSuffix:"endurance"},{key:"hypertrophie",label:"Hypertrophie",fieldSuffix:"hypertrophie"},{key:"force",label:"Force",fieldSuffix:"force"}],Os=s=>s==="endurance"||s==="hypertrophie"||s==="force"?s:"endurance",Is=({exercise:s,onChange:t,disabled:r=!1})=>e.jsxs(Gr,{defaultValue:"endurance",className:"w-full",children:[e.jsx(Lr,{className:"grid w-full grid-cols-3",children:Vs.map(a=>e.jsx(Br,{value:a.key,children:a.label},a.key))}),Vs.map(a=>{const n=`pct_1rm_${a.fieldSuffix}`,i=`Nb_series_${a.fieldSuffix}`,o=`Nb_reps_${a.fieldSuffix}`,d=`recup_${a.fieldSuffix}`,g=`recup_exercices_${a.fieldSuffix}`;return e.jsxs(Kr,{value:a.key,className:`space-y-3 rounded-lg border p-3 ${r?"opacity-60":""}`,children:[e.jsx("p",{className:"text-sm font-semibold",children:a.label}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"% 1RM"}),e.jsx(I,{type:"number",value:s[n]??"",disabled:r,onChange:m=>t({[n]:m.target.value===""?null:Number(m.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Nb séries"}),e.jsx(I,{type:"number",value:s[i]??"",disabled:r,onChange:m=>t({[i]:m.target.value===""?null:Number(m.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Nb reps"}),e.jsx(I,{type:"number",value:s[o]??"",disabled:r,onChange:m=>t({[o]:m.target.value===""?null:Number(m.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Récup. séries (s)"}),e.jsx(I,{type:"number",value:s[d]??"",disabled:r,onChange:m=>t({[d]:m.target.value===""?null:Number(m.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Récup. exercices (s)"}),e.jsx(I,{type:"number",value:s[g]??"",disabled:r,onChange:m=>t({[g]:m.target.value===""?null:Number(m.target.value)})})]})]})]},a.key)})]}),Jn={pct_1rm_endurance:60,pct_1rm_hypertrophie:75,pct_1rm_force:85,Nb_series_endurance:4,Nb_series_hypertrophie:3,Nb_series_force:3,Nb_reps_endurance:16,Nb_reps_hypertrophie:8,Nb_reps_force:3,recup_endurance:120,recup_hypertrophie:200,recup_force:300,recup_exercices_endurance:300,recup_exercices_hypertrophie:400,recup_exercices_force:500},Ye=s=>{const t=Number(s);return Number.isFinite(t)?t:0},qs=(s,t,r,a)=>{const n=t==="force"?"force":t==="hypertrophie"?"hypertrophie":"endurance",i=`Nb_series_${n}`,o=`Nb_reps_${n}`,d=`pct_1rm_${n}`,g=`recup_${n}`;return{exercise_id:s.id,order_index:r,sets:Ye(s[i]),reps:Ye(s[o]),rest_seconds:Ye(s[g]),percent_1rm:Ye(s[d]),cycle_type:t,notes:a?.notes??""}},Xn=()=>({nom_exercice:"",description:null,illustration_gif:null,exercise_type:"strength",warmup_reps:null,warmup_duration:null,...Jn}),zs=({exercise:s,warmupMode:t,onChange:r,onWarmupModeChange:a,idPrefix:n})=>e.jsxs("div",{className:"space-y-3 rounded-lg border p-3",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Paramètres d’échauffement"}),e.jsxs(Nt,{value:t,onValueChange:i=>{a(i==="duration"?"duration":"reps"),r(i==="duration"?{warmup_reps:null,warmup_duration:s.warmup_duration??0}:{warmup_duration:null,warmup_reps:s.warmup_reps??0})},className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(vs,{value:"reps",id:`${n}-warmup-reps`}),e.jsx(A,{htmlFor:`${n}-warmup-reps`,children:"Nombre de répétitions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(vs,{value:"duration",id:`${n}-warmup-duration`}),e.jsx(A,{htmlFor:`${n}-warmup-duration`,children:"Durée (secondes)"})]})]}),t==="duration"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Durée (s)"}),e.jsx(I,{type:"number",value:s.warmup_duration??"",onChange:i=>r({warmup_duration:i.target.value===""?null:Number(i.target.value)})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Nombre de répétitions"}),e.jsx(I,{type:"number",value:s.warmup_reps??"",onChange:i=>r({warmup_reps:i.target.value===""?null:Number(i.target.value)})})]})]});function Yn(){const{toast:s}=os(),t=nt(),[r,a]=l.useState(!1),[n,i]=l.useState(null),[o,d]=l.useState("all"),[g,m]=l.useState(!1),[x,p]=l.useState(!1),[f,_]=l.useState(null),[N,q]=l.useState(null),[v,ee]=l.useState(!1),[X,w]=l.useState(null),[M,ne]=l.useState(null),[D,Y]=l.useState(null),[ye,h]=l.useState("reps"),[T,H]=l.useState("reps"),[R,C]=l.useState({title:"",description:"",cycle:"endurance",items:[]}),[E,K]=l.useState({...Xn()});l.useEffect(()=>{f&&H(f.warmup_duration!=null?"duration":"reps")},[f]);const{data:B}=me({queryKey:["exercises"],queryFn:()=>z.getExercises()}),{data:ue}=me({queryKey:["strength_catalog"],queryFn:()=>z.getStrengthSessions()}),Z=l.useMemo(()=>new Map((B??[]).map(c=>[c.id,c])),[B]),ke=ae({mutationFn:c=>z.createExercise(c),onSuccess:()=>{t.invalidateQueries({queryKey:["exercises"]}),m(!1),s({title:"Exercice ajouté"})}}),_e=ae({mutationFn:c=>z.createStrengthSession(c),onSuccess:()=>{t.invalidateQueries({queryKey:["strength_catalog"]}),a(!1),C({title:"",description:"",cycle:"endurance",items:[]}),s({title:"Séance créée avec succès"})}}),Ce=ae({mutationFn:c=>z.updateExercise(c),onSuccess:()=>{t.invalidateQueries({queryKey:["exercises"]}),t.invalidateQueries({queryKey:["strength_catalog"]}),p(!1),_(null),s({title:"Exercice mis à jour"})}}),Se=ae({mutationFn:c=>z.deleteExercise(c),onSuccess:()=>{t.invalidateQueries({queryKey:["exercises"]}),t.invalidateQueries({queryKey:["strength_catalog"]}),ne(null),s({title:"Exercice supprimé"})}}),De=ae({mutationFn:c=>z.deleteStrengthSession(c),onSuccess:()=>{t.invalidateQueries({queryKey:["strength_catalog"]}),w(null),s({title:"Séance supprimée"})}}),O=ae({mutationFn:c=>z.updateStrengthSession(c),onSuccess:()=>{t.invalidateQueries({queryKey:["strength_catalog"]}),a(!1),i(null),C({title:"",description:"",cycle:"endurance",items:[]}),s({title:"Séance mise à jour"})}}),se=ae({mutationFn:c=>z.persistStrengthSessionOrder(c)}),be=()=>{a(!1),i(null),C({title:"",description:"",cycle:"endurance",items:[]})},Ne=c=>{i(c.id),C({title:c.title??"",description:c.description??"",cycle:Os(c.cycle),items:c.items?.map(y=>({exercise_id:y.exercise_id,order_index:y.order_index??0,sets:y.sets,reps:y.reps,rest_seconds:y.rest_seconds,percent_1rm:y.percent_1rm,cycle_type:y.cycle_type,notes:y.notes??""}))??[]}),a(!0)},u=c=>{_(c),p(!0)},j=()=>{const c={...R,items:b(R.items)};n?O.mutate({...c,id:n}):_e.mutate(c)},b=c=>c.map((y,k)=>({...y,order_index:k})),$=()=>{const c=B?.[0];C(y=>({...y,items:[...y.items,c?qs(c,y.cycle,y.items.length):{exercise_id:1,order_index:y.items.length,sets:0,reps:0,rest_seconds:0,percent_1rm:0}]}))},F=(c,y,k)=>{const re=[...R.items];if(y==="exercise_id"){const Me=B?.find(xr=>xr.id===k);Me?re[c]=qs(Me,R.cycle,re[c].order_index??c,re[c]):re[c]={...re[c],exercise_id:Number(k)}}else re[c]={...re[c],[y]:k};C({...R,items:re})},te=c=>{const y=b(R.items.filter((k,re)=>re!==c));C({...R,items:y})},P=(c,y)=>{if(c===y)return;const k=[...R.items],[re]=k.splice(c,1);k.splice(y,0,re);const Me=b(k);C({...R,items:Me}),n&&se.mutate({id:n,title:R.title,description:R.description,cycle:R.cycle,items:Me})},Ee=new Set(R.items.map(c=>c.exercise_id)),Pe=B?.filter(c=>o==="all"||Ee.has(c.id)?!0:c.exercise_type===o)??[],Je=e.jsx($e,{open:x,onOpenChange:p,children:e.jsxs(Fe,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(ms,{children:e.jsx(ps,{children:"Modifier l’exercice"})}),f&&e.jsxs("div",{className:"space-y-4",children:[f.exercise_type==="warmup"?e.jsx(zs,{exercise:f,warmupMode:T,onChange:c=>_(y=>y&&{...y,...c}),onWarmupModeChange:H,idPrefix:"edit"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Nom"}),e.jsx(I,{value:f.nom_exercice,onChange:c=>_({...f,nom_exercice:c.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Description"}),e.jsx(Te,{value:f.description??"",onChange:c=>_({...f,description:c.target.value===""?null:c.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Illustration (GIF)"}),e.jsx(I,{value:f.illustration_gif??"",onChange:c=>_({...f,illustration_gif:c.target.value===""?null:c.target.value}),placeholder:"https://..."})]}),f.exercise_type!=="warmup"?e.jsx(Is,{exercise:f,onChange:c=>_(y=>y&&{...y,...c})}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{id:"warmup-flag-edit",checked:f.exercise_type==="warmup",onCheckedChange:c=>_({...f,exercise_type:c===!0?"warmup":"strength"})}),e.jsx(A,{htmlFor:"warmup-flag-edit",children:"Exercice d’échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(S,{variant:"outline",onClick:()=>{p(!1),_(null)},children:"Annuler"}),e.jsxs(S,{onClick:()=>{f?.id&&Ce.mutate(f)},disabled:!f.nom_exercice.trim(),children:[e.jsx(ss,{className:"mr-2 h-4 w-4"})," Enregistrer"]})]})]})]})}),Xe=e.jsx($e,{open:g,onOpenChange:m,children:e.jsxs(Fe,{className:"sm:max-w-3xl max-h-[85vh] overflow-y-auto pb-safe",children:[e.jsx(ms,{children:e.jsx(ps,{children:"Créer un exercice"})}),e.jsxs("div",{className:"space-y-4",children:[E.exercise_type==="warmup"?e.jsx(zs,{exercise:E,warmupMode:ye,onChange:c=>K(y=>({...y,...c})),onWarmupModeChange:h,idPrefix:"create"}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Nom"}),e.jsx(I,{value:E.nom_exercice,onChange:c=>K({...E,nom_exercice:c.target.value}),placeholder:"ex: Rotations Élastique"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Description"}),e.jsx(Te,{value:E.description??"",onChange:c=>K({...E,description:c.target.value===""?null:c.target.value}),placeholder:"Détails, consignes..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Illustration (GIF)"}),e.jsx(I,{value:E.illustration_gif??"",onChange:c=>K({...E,illustration_gif:c.target.value===""?null:c.target.value}),placeholder:"https://..."})]}),E.exercise_type!=="warmup"?e.jsx(Is,{exercise:E,onChange:c=>K(y=>({...y,...c}))}):null,e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{id:"warmup-flag",checked:E.exercise_type==="warmup",onCheckedChange:c=>K({...E,exercise_type:c===!0?"warmup":"strength"})}),e.jsx(A,{htmlFor:"warmup-flag",children:"Exercice d’échauffement (warmup)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(S,{variant:"outline",onClick:()=>m(!1),children:"Annuler"}),e.jsxs(S,{onClick:()=>ke.mutate(E),disabled:!E.nom_exercice.trim(),children:[e.jsx(ss,{className:"mr-2 h-4 w-4"})," Enregistrer"]})]})]})]})}),Cs=e.jsx($e,{open:v,onOpenChange:c=>{ee(c),c||q(null)},children:e.jsxs(Fe,{className:"sm:max-w-3xl",children:[e.jsx(ms,{children:e.jsx(ps,{children:"Détails de la séance"})}),N&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-lg font-semibold",children:N.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:N.description||"—"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Cycle : ",N.cycle]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Exercices"}),e.jsx("div",{className:"space-y-2",children:(N.items??[]).slice().sort((c,y)=>(c.order_index??0)-(y.order_index??0)).map((c,y)=>{const k=Z.get(c.exercise_id);return e.jsxs("div",{className:"rounded-md border px-3 py-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("span",{className:"font-medium",children:[y+1,". ",k?.nom_exercice??c.exercise_name??"Exercice"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:k?.exercise_type==="warmup"||c.category==="warmup"?"Échauffement":"Travail"})]}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[c.sets," séries • ",c.reps," reps • ",c.percent_1rm,"% 1RM • ",c.rest_seconds,"s"]})]},`${c.exercise_id}-${y}`)})})]})]})]})}),Ss=e.jsx(rs,{open:!!X,onOpenChange:c=>{c||w(null)},children:e.jsxs(qe,{children:[e.jsxs(ze,{children:[e.jsx(Le,{children:"Supprimer la séance ?"}),e.jsxs(Be,{children:['Cette action est définitive. La séance "',X?.title,'" sera supprimée.']})]}),e.jsxs(Ge,{children:[e.jsx(We,{children:"Annuler"}),e.jsx(Ke,{onClick:()=>{X?.id&&De.mutate(X.id)},children:"Supprimer"})]})]})}),As=e.jsx(rs,{open:!!M,onOpenChange:c=>{c||ne(null)},children:e.jsxs(qe,{children:[e.jsxs(ze,{children:[e.jsx(Le,{children:"Supprimer l’exercice ?"}),e.jsxs(Be,{children:['Cette action est définitive. L’exercice "',M?.nom_exercice,'" sera supprimé.']})]}),e.jsxs(Ge,{children:[e.jsx(We,{children:"Annuler"}),e.jsx(Ke,{onClick:()=>{M?.id&&Se.mutate(M.id)},children:"Supprimer"})]})]})});return r?e.jsxs("div",{className:"space-y-6 animate-in slide-in-from-bottom-4",children:[Xe,Je,Cs,Ss,As,e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold uppercase",children:n?"Modifier Séance Muscu":"Nouvelle Séance Muscu"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{variant:"outline",onClick:be,children:"Annuler"}),e.jsxs(S,{onClick:j,children:[e.jsx(ss,{className:"mr-2 h-4 w-4"})," Enregistrer"]})]})]}),e.jsxs(L,{children:[e.jsx(U,{children:e.jsx(Q,{children:"Informations Générales"})}),e.jsxs(W,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Titre"}),e.jsx(I,{value:R.title,onChange:c=>C({...R,title:c.target.value}),placeholder:"ex: Full Body A"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Cycle"}),e.jsxs(ie,{value:R.cycle,onValueChange:c=>C({...R,cycle:Os(c)}),children:[e.jsx(le,{children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(G,{value:"endurance",children:"Endurance"}),e.jsx(G,{value:"hypertrophie",children:"Hypertrophie"}),e.jsx(G,{value:"force",children:"Force"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Description"}),e.jsx(Te,{value:R.description,onChange:c=>C({...R,description:c.target.value})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold",children:"Exercices"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(S,{size:"sm",variant:"outline",onClick:()=>m(!0),children:[e.jsx(xe,{className:"mr-2 h-4 w-4"})," Nouvel exercice"]}),e.jsxs(S,{size:"sm",onClick:$,children:[e.jsx(xe,{className:"mr-2 h-4 w-4"})," Ajouter"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-[220px_1fr] items-end",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(xn,{className:"h-4 w-4"})," Filtre exercices"]}),e.jsxs(ie,{value:o,onValueChange:c=>d(c),children:[e.jsx(le,{children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(G,{value:"all",children:"Tous"}),e.jsx(G,{value:"strength",children:"Séries de travail"}),e.jsx(G,{value:"warmup",children:"Échauffement"})]})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Les exercices marqués warmup sont affichés dans les séances avec le badge « Échauffement »."})]}),R.items.map((c,y)=>e.jsxs(L,{className:"relative",onDragOver:k=>k.preventDefault(),onDrop:()=>{D!==null&&(P(D,y),Y(null))},children:[e.jsx(S,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 text-destructive",onClick:()=>te(y),"aria-label":"Supprimer l'exercice",children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsxs(W,{className:"pt-6 grid md:grid-cols-12 gap-4 items-end",children:[e.jsx("div",{className:"md:col-span-1 flex items-center justify-center",children:e.jsx("button",{type:"button",className:"cursor-grab rounded-md border p-1 text-muted-foreground hover:text-foreground",draggable:!0,onDragStart:()=>Y(y),onDragEnd:()=>Y(null),"aria-label":"Réordonner",children:e.jsx(lt,{className:"h-4 w-4"})})}),e.jsxs("div",{className:"md:col-span-3 space-y-2",children:[e.jsx(A,{children:"Exercice"}),e.jsxs(ie,{value:c.exercise_id.toString(),onValueChange:k=>F(y,"exercise_id",parseInt(k)),children:[e.jsx(le,{children:e.jsx(oe,{})}),e.jsx(ce,{children:Pe.length?Pe.map(k=>e.jsxs(G,{value:k.id.toString(),children:[k.nom_exercice,k.exercise_type==="warmup"?" • Échauffement":""]},k.id)):e.jsx(G,{value:"no-exercise",disabled:!0,children:"Aucun exercice disponible"})})]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(A,{children:"Séries"}),e.jsx(I,{type:"number",value:c.sets===0?"":c.sets,onChange:k=>F(y,"sets",k.target.value===""?0:Number(k.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(A,{children:"Reps"}),e.jsx(I,{type:"number",value:c.reps===0?"":c.reps,onChange:k=>F(y,"reps",k.target.value===""?0:Number(k.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(A,{children:"% 1RM"}),e.jsx(I,{type:"number",value:c.percent_1rm===0?"":c.percent_1rm,onChange:k=>F(y,"percent_1rm",k.target.value===""?0:Number(k.target.value))})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx(A,{children:"Repos (s)"}),e.jsx(I,{type:"number",value:c.rest_seconds===0?"":c.rest_seconds,onChange:k=>F(y,"rest_seconds",k.target.value===""?0:Number(k.target.value))})]})]})]},`${c.exercise_id}-${y}`))]})]}):e.jsxs("div",{className:"space-y-4",children:[Xe,Je,Cs,Ss,As,e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Catalogue Séances Musculation"}),e.jsxs(S,{onClick:()=>{i(null),C({title:"",description:"",cycle:"endurance",items:[]}),a(!0)},children:[e.jsx(xe,{className:"mr-2 h-4 w-4"})," Créer"]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:ue?.map(c=>e.jsxs(L,{children:[e.jsxs(U,{children:[e.jsx(Q,{children:c.title}),e.jsxs(J,{children:[c.items?.length||0," exercices • ",c.cycle]})]}),e.jsx(W,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{variant:"outline",size:"icon","aria-label":"Voir détails",onClick:()=>{q(c),ee(!0)},children:e.jsx(mn,{className:"h-4 w-4"})}),e.jsx(S,{variant:"secondary",size:"icon","aria-label":"Modifier",onClick:()=>Ne(c),children:e.jsx(ks,{className:"h-4 w-4"})}),e.jsx(S,{variant:"destructive",size:"icon","aria-label":"Supprimer",onClick:()=>w(c),children:e.jsx(ge,{className:"h-4 w-4"})})]})})]},c.id))}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Catalogue Exercices"}),e.jsxs(S,{variant:"outline",onClick:()=>m(!0),children:[e.jsx(xe,{className:"mr-2 h-4 w-4"})," Ajouter un exercice"]})]}),e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:B?.map(c=>e.jsx(L,{children:e.jsxs(W,{className:"flex flex-col gap-3 py-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[c.illustration_gif?e.jsx("img",{src:c.illustration_gif,alt:`Illustration ${c.nom_exercice}`,className:"h-14 w-14 rounded-md object-cover",loading:"lazy",decoding:"async"}):null,e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:c.nom_exercice}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c.exercise_type==="warmup"?"Échauffement":"Séries de travail"})]})]}),e.jsxs("div",{className:"flex w-full gap-2 sm:w-auto",children:[e.jsx(S,{variant:"outline",size:"icon","aria-label":"Modifier",onClick:()=>u(c),children:e.jsx(ks,{className:"h-4 w-4"})}),e.jsx(S,{variant:"destructive",size:"icon","aria-label":"Supprimer",onClick:()=>ne(c),children:e.jsx(ge,{className:"h-4 w-4"})})]})]})},c.id))})]})]})}const Gs=["V0","V1","V2","V3","Max"],Zn={V0:"bg-emerald-500",V1:"bg-green-500",V2:"bg-yellow-500",V3:"bg-orange-500",Max:"bg-red-600"},Ls={souple:"V0",facile:"V0",relache:"V0",relâché:"V0"},ea=s=>{if(!s)return"V0";const t=s.trim();if(!t)return"V0";const r=t.toLowerCase();if(Ls[r])return Ls[r];const a=t.toUpperCase();if(a==="MAX")return"Max";if(a.startsWith("V")){const n=a.replace("V","V");return n==="V4"||n==="V5"?"Max":n}return t};function sa({value:s,onChange:t,className:r,ariaLabel:a="Sélection d'intensité"}){const n=ea(s),i=Gs.includes(n)?n:"Max";return e.jsx("div",{role:"radiogroup","aria-label":a,className:V("flex flex-wrap items-center gap-2",r),children:Gs.map(o=>{const d=i===o;return e.jsxs("button",{type:"button",role:"radio","aria-checked":d,"aria-label":`Intensité ${o==="Max"?"MAX":o}`,onClick:()=>t(o),className:V("flex flex-col items-center gap-1 rounded-full px-2 py-1 text-[10px] font-semibold text-muted-foreground transition","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",d?"text-foreground":"hover:text-foreground"),children:[e.jsx("span",{className:V("h-3 w-3 rounded-full",d?Zn[o]??"bg-primary":"bg-muted")}),e.jsx("span",{children:o==="Max"?"MAX":o})]},o)})})}function ta(s){l.useEffect(()=>{if(!s)return;const t=r=>{r.preventDefault()};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[s])}function Bs(s){return`Séance du ${Jr(s,"dd/MM/yyyy")} - Soir - Matin`}const Ks={souple:"V0",facile:"V0",relache:"V0",relâché:"V0"},ra=["V0","V1","V2","V3","Max"],He=s=>{if(!s)return"V0";const t=s.trim();if(!t)return"V0";const r=t.toLowerCase();if(Ks[r])return Ks[r];const a=t.toUpperCase();if(a==="MAX")return"Max";if(a.startsWith("V")){const n=Number.parseInt(a.slice(1),10);if(Number.isFinite(n)&&n>=4)return"Max";if(ra.includes(a))return a}return t},Ws=s=>s==="Max"?"MAX":s,fs=s=>{let t=0;return s.flatMap((r,a)=>r.exercises.map((n,i)=>{const o={block_title:r.title,block_description:r.description||null,block_order:a,block_repetitions:r.repetitions??null,block_modalities:r.modalities||null,block_equipment:r.equipment??[],exercise_repetitions:n.repetitions??null,exercise_rest:n.rest??null,exercise_stroke:n.stroke||null,exercise_stroke_type:n.strokeType||null,exercise_intensity:n.intensity?He(n.intensity):null,exercise_modalities:n.modalities||null,exercise_equipment:n.equipment??[],exercise_order:i},d=n.repetitions&&n.distance?`${n.repetitions}x${n.distance}m`:n.distance?`${n.distance}m`:null;return{ordre:t++,label:d,distance:n.distance??null,duration:null,intensity:n.intensity?He(n.intensity):null,notes:n.modalities||null,raw_payload:o}}))},na=(s=[])=>{const t=new Map;return s.forEach(r=>{const a=r.raw_payload??{},n=a.block_title||a.section||"Bloc",i=Number(a.block_order??0),o=`${i}-${n}`,d=a.block_equipment??a.equipment??[],g=(Array.isArray(d)?d:String(d).split(",")).map(f=>String(f)).map(f=>Hs(f)).filter(Boolean);t.has(o)||t.set(o,{title:n,repetitions:a.block_repetitions??null,description:a.block_description??"",modalities:a.block_modalities??a.modalities??"",equipment:g,exercises:[],order:Number.isFinite(i)?i:0,exerciseOrder:new Map});const m=t.get(o),x=Number(a.exercise_order??r.ordre??m.exercises.length),p=He(a.exercise_intensity??r.intensity??"V1");m.exerciseOrder.set(x,{repetitions:a.exercise_repetitions??null,distance:r.distance??null,rest:a.exercise_rest??null,stroke:a.exercise_stroke??a.stroke??"crawl",strokeType:a.exercise_stroke_type??a.stroke_type??"nc",intensity:p,modalities:a.exercise_modalities??r.notes??"",equipment:Array.isArray(a.exercise_equipment)?a.exercise_equipment.map(f=>Hs(f)):[]})}),Array.from(t.values()).sort((r,a)=>r.order-a.order).map(r=>({title:r.title,repetitions:r.repetitions,description:r.description,modalities:r.modalities,equipment:r.equipment,exercises:Array.from(r.exerciseOrder.entries()).sort(([a],[n])=>a-n).map(([,a])=>a)}))},aa=s=>s?s.length>48?`${s.slice(0,45).trim()}…`:s:"",Hs=s=>{const t=s.trim().toLowerCase();return t&&(t.startsWith("plaquette")?"plaquettes":t.startsWith("palm")?"palmes":t.startsWith("tuba")?"tuba":t.startsWith("pull")?"pull":t.startsWith("elas")?"elastique":t)},ia=(s=[])=>new Set(s.map(r=>{const a=r.raw_payload;return a?.block_title||a?.section||"Bloc"})).size,la=s=>{const t=it(s.items??[]),a=s.items?.some(i=>i.duration!=null)??!1?s.items?.reduce((i,o)=>i+(o.duration??0),0)??0:null,n=ia(s.items??[]);return{totalDistance:t,totalDuration:a,blockCount:n}},Us="swim_catalog_archived_ids",oa=(s,t)=>t===null?!1:!t.some(r=>r.session_type==="swim"&&r.session_id===s);function ca(){const{toast:s}=os(),t=nt(),{userId:r,role:a}=Ze(),[n,i]=l.useState(!1);ta(n);const[o,d]=l.useState(null),[g,m]=l.useState(null),[x,p]=l.useState(null),[f,_]=l.useState(""),[N,q]=l.useState("compact"),[v,ee]=l.useState(new Set),X=()=>({id:null,name:Bs(new Date),description:"",estimatedDuration:0,blocks:[]}),[w,M]=l.useState(X),{data:ne,isLoading:D}=me({queryKey:["swim_catalog"],queryFn:()=>z.getSwimCatalog()}),{data:Y,isError:ye}=me({queryKey:["coach-assignments"],queryFn:()=>z.getAssignmentsForCoach(),enabled:a==="coach"||a==="admin"});l.useEffect(()=>{if(typeof window>"u")return;const u=window.localStorage.getItem(Us);if(u)try{const j=JSON.parse(u);Array.isArray(j)&&ee(new Set(j.map(b=>Number(b)).filter(b=>Number.isFinite(b))))}catch{return}},[]),l.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(Us,JSON.stringify(Array.from(v.values())))},[v]);const T=l.useMemo(()=>{const u=f.trim().toLowerCase();return u?(ne??[]).filter(j=>j.name.toLowerCase().includes(u)):ne??[]},[ne,f]).filter(u=>!v.has(u.id)),H=ae({mutationFn:u=>z.createSwimSession(u),onSuccess:(u,j)=>{t.invalidateQueries({queryKey:["swim_catalog"]}),i(!1),M(X()),s({title:j?.id?"Séance natation mise à jour":"Séance natation créée"})}}),R=ae({mutationFn:u=>z.deleteSwimSession(u),onSuccess:()=>{t.invalidateQueries({queryKey:["swim_catalog"]}),m(null),s({title:"Séance supprimée"})},onError:()=>{s({title:"Suppression impossible",description:"Cette séance est utilisée dans une assignation.",variant:"destructive"})}}),C=()=>{M(u=>({...u,blocks:[...u.blocks,{title:"Nouveau bloc",repetitions:1,description:"",modalities:"",equipment:[],exercises:[{repetitions:4,distance:50,rest:null,stroke:"crawl",strokeType:"nc",intensity:"V2",modalities:"",equipment:[]}]}]}))},E=(u,j,b)=>{const $=[...w.blocks];$[u]={...$[u],[j]:b},M({...w,blocks:$})},K=u=>{const j=w.blocks.filter((b,$)=>$!==u);M({...w,blocks:j})},B=(u,j)=>{const b=j==="up"?u-1:u+1;if(b<0||b>=w.blocks.length)return;const $=[...w.blocks],[F]=$.splice(u,1);$.splice(b,0,F),M({...w,blocks:$})},ue=u=>{const j=[...w.blocks];j[u].exercises.push({repetitions:4,distance:50,rest:null,stroke:"crawl",strokeType:"nc",intensity:"V2",modalities:"",equipment:[]}),M({...w,blocks:j})},Z=(u,j,b,$)=>{const F=[...w.blocks],te=[...F[u].exercises];te[j]={...te[j],[b]:$},F[u]={...F[u],exercises:te},M({...w,blocks:F})},ke=(u,j)=>{const b=[...w.blocks];b[u].exercises=b[u].exercises.filter(($,F)=>F!==j),M({...w,blocks:b})},_e=[{value:"palmes",label:"Palmes"},{value:"tuba",label:"Tuba"},{value:"plaquettes",label:"Plaquettes"},{value:"pull",label:"Pull"},{value:"elastique",label:"Élastique"}],Ce=[{value:"pap",label:"Papillon"},{value:"dos",label:"Dos"},{value:"brasse",label:"Brasse"},{value:"crawl",label:"Crawl"},{value:"4n",label:"4 nages"},{value:"spe",label:"Spé"}],Se=[{value:"nc",label:"NC"},{value:"educ",label:"Educ"},{value:"jambes",label:"Jambes"}];Ce.reduce((u,j)=>(u[j.value]=j.label,u),{});const De=Se.reduce((u,j)=>(u[j.value]=j.label,u),{});w.id;const O=l.useMemo(()=>it(fs(w.blocks)),[w.blocks]),se={nc:"bg-sky-100 text-sky-900 ring-sky-200",educ:"bg-violet-100 text-violet-900 ring-violet-200",jambes:"bg-teal-100 text-teal-900 ring-teal-200"},be={V0:"text-emerald-800",V1:"text-lime-800",V2:"text-yellow-800",V3:"text-orange-800",Max:"text-red-900"},Ne={V0:"ring-emerald-200",V1:"ring-lime-200",V2:"ring-yellow-200",V3:"ring-orange-200",Max:"ring-red-300"};return n?e.jsxs("div",{className:"animate-in slide-in-from-bottom-4 motion-reduce:animate-none",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{i(!1),M(X())},className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Retour",children:e.jsx(Xr,{className:"h-4 w-4"})}),e.jsx("div",{className:"text-base font-semibold",children:"Édition"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>d({id:w.id??Date.now(),name:w.name,description:w.description,created_by:r??null,items:fs(w.blocks)}),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Aperçu nageur",title:"Aperçu nageur",children:e.jsx(Ps,{className:"h-4 w-4"})}),e.jsxs("button",{type:"button",onClick:()=>{if(!w.name.trim()){s({title:"Titre requis",description:"Ajoutez un nom de séance avant d'enregistrer.",variant:"destructive"});return}H.mutate({id:w.id??void 0,name:w.name,description:w.description,estimated_duration:w.estimatedDuration||null,items:fs(w.blocks),created_by:r})},className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(ss,{className:"h-4 w-4"})," Sauver"]})]})]}),e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(L,{className:"rounded-2xl border-border",children:e.jsxs("div",{className:"space-y-3 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Infos séance"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Nom"}),e.jsx("div",{className:"mt-1",children:e.jsx(I,{value:w.name,onChange:u=>M({...w,name:u.target.value}),placeholder:"Nom de la séance",className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Durée estimée (min)"}),e.jsx("div",{className:"mt-1",children:e.jsx(I,{type:"number",min:0,value:w.estimatedDuration||"",onChange:u=>M({...w,estimatedDuration:u.target.value===""?0:Number(u.target.value)}),placeholder:"55",className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Distance totale"}),e.jsxs("div",{className:"mt-1 rounded-2xl border border-border bg-muted px-3 py-2 text-sm font-semibold",children:[O,"m"]})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Vue coach"}),e.jsxs("div",{className:"inline-flex rounded-full border border-border bg-card p-1 text-xs font-semibold",children:[e.jsx("button",{type:"button",onClick:()=>q("compact"),className:V("rounded-full px-3 py-1",N==="compact"?"bg-primary text-primary-foreground":"text-muted-foreground"),children:"Condensé"}),e.jsx("button",{type:"button",onClick:()=>q("detailed"),className:V("rounded-full px-3 py-1",N==="detailed"?"bg-primary text-primary-foreground":"text-muted-foreground"),children:"Détail"})]})]}),N==="compact"?e.jsx(L,{className:"rounded-2xl border-border",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:"Plan (ultra compact)"}),e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:"Manipule les blocs vite. Passe en “Détail” pour éditer."})]}),e.jsxs(S,{variant:"secondary",size:"sm",onClick:C,className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(xe,{className:"h-4 w-4"})," Bloc"]})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[w.blocks.map((u,j)=>e.jsx("div",{className:"rounded-2xl border border-border bg-card px-3 py-2",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-primary px-2 py-0.5 text-[11px] font-semibold text-primary-foreground",children:[e.jsx(Wr,{className:"inline h-3 w-3"})," ",u.repetitions??1,"x"]}),e.jsx("div",{className:"truncate text-xs font-semibold",children:u.title?u.title:`Bloc ${j+1}`}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:["· ",u.exercises.length," ex"]})]}),e.jsxs("div",{className:"mt-1 flex flex-wrap gap-1",children:[u.exercises.slice(0,4).map((b,$)=>{const F=He(b.intensity),te=De[b.strokeType]??b.strokeType;return e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted px-2 py-0.5 text-[11px] font-semibold text-muted-foreground",title:b.modalities?aa(b.modalities):"",children:[b.repetitions&&b.distance?`${b.repetitions}x`:"",b.distance?`${b.distance}m`:"—",e.jsx("span",{className:V("ml-1 inline-flex items-center rounded-full px-2 py-0.5 ring-1",se[b.strokeType]??"bg-muted text-muted-foreground ring-border"),children:te}),e.jsxs("span",{className:V("ml-1 inline-flex items-center gap-1 rounded-full bg-card px-2 py-0.5 ring-1",Ne[F],be[F]),children:[e.jsx("span",{className:V("h-2 w-2 rounded-full",Ds[F]??"bg-muted")}),Ws(F)]})]},`${j}-${$}`)}),u.exercises.length>4?e.jsxs("span",{className:"text-[11px] text-muted-foreground",children:["+",u.exercises.length-4]}):null]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>B(j,"up"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Monter",title:"Monter",disabled:j===0,children:e.jsx($s,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>B(j,"down"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Descendre",title:"Descendre",disabled:j===w.blocks.length-1,children:e.jsx(Ts,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>K(j),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer bloc",title:"Supprimer bloc",children:e.jsx(ge,{className:"h-4 w-4"})})]})]})},j)),w.blocks.length?null:e.jsx("div",{className:"rounded-2xl border border-dashed border-border bg-muted px-3 py-6 text-center text-sm text-muted-foreground",children:"Aucun bloc. Ajoute un bloc pour commencer."})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Édition détaillée"}),e.jsxs(S,{variant:"secondary",size:"sm",onClick:C,className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(xe,{className:"h-4 w-4"})," Ajouter bloc"]})]}),e.jsx("div",{className:"space-y-4",children:w.blocks.map((u,j)=>e.jsx(L,{className:"rounded-2xl border-border",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"mt-1 inline-flex h-9 w-9 items-center justify-center rounded-2xl bg-muted text-muted-foreground",children:e.jsx(lt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Titre bloc"}),e.jsx(I,{value:u.title,onChange:b=>E(j,"title",b.target.value),placeholder:`Bloc ${j+1}`,className:"rounded-2xl"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>B(j,"up"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Monter",title:"Monter",disabled:j===0,children:e.jsx($s,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>B(j,"down"),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted disabled:opacity-40","aria-label":"Descendre",title:"Descendre",disabled:j===w.blocks.length-1,children:e.jsx(Ts,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>K(j),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer bloc",title:"Supprimer bloc",children:e.jsx(ge,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Répétitions du bloc"}),e.jsx("div",{className:"mt-1",children:e.jsx(I,{type:"number",min:1,value:u.repetitions??"",onChange:b=>E(j,"repetitions",b.target.value===""?null:Number(b.target.value)),placeholder:"1",className:"rounded-2xl"})})]}),e.jsx("div",{className:"flex items-end justify-end",children:e.jsxs(S,{variant:"secondary",size:"sm",onClick:()=>ue(j),className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(xe,{className:"h-4 w-4"})," Exercice"]})})]}),e.jsx("div",{className:"mt-4 space-y-3",children:u.exercises.map((b,$)=>{const F=He(b.intensity),te=b.modalities??"";return e.jsx("div",{className:"rounded-2xl border border-border bg-card p-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"grid flex-1 grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Répétitions"}),e.jsx("div",{className:"mt-1",children:e.jsx(I,{type:"number",min:1,value:b.repetitions??"",onChange:P=>Z(j,$,"repetitions",P.target.value===""?null:Number(P.target.value)),className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Distance (m)"}),e.jsx("div",{className:"mt-1",children:e.jsx(I,{type:"number",min:0,value:b.distance??"",onChange:P=>Z(j,$,"distance",P.target.value===""?null:Number(P.target.value)),className:"rounded-2xl"})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Nage"}),e.jsx("div",{className:"mt-1",children:e.jsxs(ie,{value:b.stroke,onValueChange:P=>Z(j,$,"stroke",P),children:[e.jsx(le,{className:"rounded-2xl",children:e.jsx(oe,{})}),e.jsx(ce,{children:Ce.map(P=>e.jsx(G,{value:P.value,children:P.label},P.value))})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Type"}),e.jsx("div",{className:"mt-1",children:e.jsxs(ie,{value:b.strokeType,onValueChange:P=>Z(j,$,"strokeType",P),children:[e.jsx(le,{className:"rounded-2xl",children:e.jsx(oe,{})}),e.jsx(ce,{children:Se.map(P=>e.jsx(G,{value:P.value,children:P.label},P.value))})]})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Intensité (clic sur points)"}),e.jsxs("span",{className:V("inline-flex items-center gap-2 rounded-full bg-card px-2.5 py-1 text-xs font-semibold ring-1",Ne[F],be[F]),children:[e.jsx("span",{className:V("h-2 w-2 rounded-full",Ds[F]??"bg-muted")}),Ws(F)]})]}),e.jsx("div",{className:"mt-2 flex items-center justify-between gap-2",children:e.jsx(sa,{value:b.intensity,onChange:P=>Z(j,$,"intensity",P)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Équipements"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:_e.map(P=>{const Ee=b.equipment.includes(P.value),Pe=Hr(P.value);return e.jsxs("button",{type:"button",onClick:()=>{const Je=Ee?b.equipment.filter(Xe=>Xe!==P.value):[...b.equipment,P.value];Z(j,$,"equipment",Je)},className:V("inline-flex items-center gap-2 rounded-full border px-3 py-2 text-xs font-semibold",Ee?"border-primary bg-primary text-primary-foreground":"border-border bg-card text-muted-foreground hover:bg-muted"),children:[e.jsx("span",{className:V("inline-flex h-7 w-7 items-center justify-center rounded-full",Ee?"bg-white/10":"bg-muted"),children:Pe?e.jsx("img",{src:Pe,alt:"",className:"h-4 w-4","aria-hidden":"true",loading:"lazy"}):null}),P.label]},P.value)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-muted-foreground",children:"Modalités"}),e.jsx("div",{className:"mt-1",children:e.jsx(Te,{value:te,onChange:P=>Z(j,$,"modalities",P.target.value),placeholder:"Une modalité par ligne",rows:3,className:"rounded-2xl"})})]})]}),e.jsx("button",{type:"button",onClick:()=>ke(j,$),className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-destructive hover:bg-destructive/10","aria-label":"Supprimer exercice",title:"Supprimer exercice",children:e.jsx(ge,{className:"h-4 w-4"})})]})},$)})}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs(S,{variant:"secondary",size:"sm",onClick:()=>ue(j),className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(xe,{className:"h-4 w-4"})," Ajouter exercice"]}),e.jsxs(S,{variant:"destructive",size:"sm",onClick:()=>K(j),className:"h-9 rounded-full px-3 text-xs",children:[e.jsx(ge,{className:"h-4 w-4"})," Supprimer bloc"]})]})]})},j))})]}),e.jsx("div",{className:"h-8"})]}),e.jsx($e,{open:!!o,onOpenChange:u=>{u||d(null)},children:e.jsx(Fe,{className:"max-w-4xl",children:e.jsx(Es,{title:o?.name??"",description:o?.description??void 0,items:o?.items})})})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:"Coach"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Création"})]}),e.jsxs("button",{type:"button",onClick:()=>{M(X()),q("compact"),i(!0)},className:"inline-flex items-center gap-2 rounded-full bg-primary px-3 py-2 text-xs font-semibold text-primary-foreground",children:[e.jsx(xe,{className:"h-4 w-4"})," Nouvelle"]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl border border-border bg-card px-3 py-2",children:[e.jsx(Yr,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("input",{className:"w-full bg-transparent text-sm outline-none placeholder:text-muted-foreground",placeholder:"Rechercher une séance",value:f,onChange:u=>_(u.target.value)})]}),ye&&e.jsx("div",{className:"mt-4 rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:"Impossible de charger les assignations."}),D&&e.jsx("div",{className:"mt-4 space-y-4",children:[1,2,3].map(u=>e.jsx("div",{className:"h-24 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},u))}),e.jsx("div",{className:"mt-4 space-y-3",children:T.map(u=>{const{totalDistance:j,totalDuration:b,blockCount:$}=la(u),F=oa(u.id,Y??null),te=!F||R.isPending;return e.jsx(L,{className:"rounded-2xl border-border",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold tracking-tight",children:u.name}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Ur,{className:"h-3.5 w-3.5"}),j,"m"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Zr,{className:"h-3.5 w-3.5"}),"~",b??"—"," min"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Qr,{className:"h-3.5 w-3.5"}),$]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>d(u),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Aperçu nageur",title:"Aperçu nageur",children:e.jsx(Ps,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>{M({id:u.id??null,name:u.name??Bs(new Date),description:u.description??"",estimatedDuration:Number(u.estimated_duration??0),blocks:na(u.items??[])}),q("compact"),i(!0)},className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Modifier",title:"Modifier",children:e.jsx(jn,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>p(u),className:"inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted","aria-label":"Archiver",title:"Archiver",children:e.jsx(ln,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>{te||m(u)},className:V("inline-flex h-9 w-9 items-center justify-center rounded-full hover:bg-muted",te&&"cursor-not-allowed text-muted-foreground"),"aria-label":"Supprimer",title:Y===null?"Suppression désactivée":F?"Supprimer":"Séance déjà assignée",children:e.jsx(ge,{className:"h-4 w-4"})})]})]})})},u.id)})}),e.jsx("div",{className:"h-8"})]}),e.jsx($e,{open:!!o,onOpenChange:u=>{u||d(null)},children:e.jsx(Fe,{className:"max-w-4xl",children:e.jsx(Es,{title:o?.name??"",description:o?.description??void 0,items:o?.items})})}),e.jsx(rs,{open:!!x,onOpenChange:u=>{u||p(null)},children:e.jsxs(qe,{children:[e.jsxs(ze,{children:[e.jsx(Le,{children:"Archiver la séance ?"}),e.jsx(Be,{children:"La séance sera masquée du catalogue (sans suppression)."})]}),e.jsxs(Ge,{children:[e.jsx(We,{children:"Annuler"}),e.jsx(Ke,{onClick:()=>{x&&(ee(u=>new Set([...Array.from(u),x.id])),p(null),s({title:"Séance archivée"}))},children:"Archiver"})]})]})}),e.jsx(rs,{open:!!g,onOpenChange:u=>{u||m(null)},children:e.jsxs(qe,{children:[e.jsxs(ze,{children:[e.jsx(Le,{children:"Supprimer la séance ?"}),e.jsx(Be,{children:"Cette action est définitive. La séance sera supprimée du catalogue."})]}),e.jsxs(Ge,{children:[e.jsx(We,{children:"Annuler"}),e.jsx(Ke,{onClick:()=>{g&&R.mutate(g.id)},children:"Supprimer"})]})]})})]})}function da(s,t,{checkForDefaultPrevented:r=!0}={}){return function(n){if(s?.(n),r===!1||!n.defaultPrevented)return t?.(n)}}var ua=as[" useInsertionEffect ".trim().toString()]||is;function ma({prop:s,defaultProp:t,onChange:r=()=>{},caller:a}){const[n,i,o]=pa({defaultProp:t,onChange:r}),d=s!==void 0,g=d?s:n;{const x=l.useRef(s!==void 0);l.useEffect(()=>{const p=x.current;p!==d&&console.warn(`${a} is changing from ${p?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),x.current=d},[d,a])}const m=l.useCallback(x=>{if(d){const p=xa(x)?x(s):x;p!==s&&o.current?.(p)}else i(x)},[d,s,i,o]);return[g,m]}function pa({defaultProp:s,onChange:t}){const[r,a]=l.useState(s),n=l.useRef(r),i=l.useRef(t);return ua(()=>{i.current=t},[t]),l.useEffect(()=>{n.current!==r&&(i.current?.(r),n.current=r)},[r,n]),[r,a,i]}function xa(s){return typeof s=="function"}var Gt="Toggle",Ns=l.forwardRef((s,t)=>{const{pressed:r,defaultPressed:a,onPressedChange:n,...i}=s,[o,d]=ma({prop:r,onChange:n,defaultProp:a??!1,caller:Gt});return e.jsx(he.button,{type:"button","aria-pressed":o,"data-state":o?"on":"off","data-disabled":s.disabled?"":void 0,...i,ref:t,onClick:da(s.onClick,()=>{s.disabled||d(!o)})})});Ns.displayName=Gt;var Lt=Ns,ha=as[" useInsertionEffect ".trim().toString()]||is;function Bt({prop:s,defaultProp:t,onChange:r=()=>{},caller:a}){const[n,i,o]=fa({defaultProp:t,onChange:r}),d=s!==void 0,g=d?s:n;{const x=l.useRef(s!==void 0);l.useEffect(()=>{const p=x.current;p!==d&&console.warn(`${a} is changing from ${p?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),x.current=d},[d,a])}const m=l.useCallback(x=>{if(d){const p=ga(x)?x(s):x;p!==s&&o.current?.(p)}else i(x)},[d,s,i,o]);return[g,m]}function fa({defaultProp:s,onChange:t}){const[r,a]=l.useState(s),n=l.useRef(r),i=l.useRef(t);return ha(()=>{i.current=t},[t]),l.useEffect(()=>{n.current!==r&&(i.current?.(r),n.current=r)},[r,n]),[r,a,i]}function ga(s){return typeof s=="function"}var je="ToggleGroup",[Kt]=Ue(je,[ls]),Wt=ls(),ws=de.forwardRef((s,t)=>{const{type:r,...a}=s;if(r==="single"){const n=a;return e.jsx(ja,{...n,ref:t})}if(r==="multiple"){const n=a;return e.jsx(va,{...n,ref:t})}throw new Error(`Missing prop \`type\` expected on \`${je}\``)});ws.displayName=je;var[Ht,Ut]=Kt(je),ja=de.forwardRef((s,t)=>{const{value:r,defaultValue:a,onValueChange:n=()=>{},...i}=s,[o,d]=Bt({prop:r,defaultProp:a??"",onChange:n,caller:je});return e.jsx(Ht,{scope:s.__scopeToggleGroup,type:"single",value:de.useMemo(()=>o?[o]:[],[o]),onItemActivate:d,onItemDeactivate:de.useCallback(()=>d(""),[d]),children:e.jsx(Qt,{...i,ref:t})})}),va=de.forwardRef((s,t)=>{const{value:r,defaultValue:a,onValueChange:n=()=>{},...i}=s,[o,d]=Bt({prop:r,defaultProp:a??[],onChange:n,caller:je}),g=de.useCallback(x=>d((p=[])=>[...p,x]),[d]),m=de.useCallback(x=>d((p=[])=>p.filter(f=>f!==x)),[d]);return e.jsx(Ht,{scope:s.__scopeToggleGroup,type:"multiple",value:o,onItemActivate:g,onItemDeactivate:m,children:e.jsx(Qt,{...i,ref:t})})});ws.displayName=je;var[ya,ba]=Kt(je),Qt=de.forwardRef((s,t)=>{const{__scopeToggleGroup:r,disabled:a=!1,rovingFocus:n=!0,orientation:i,dir:o,loop:d=!0,...g}=s,m=Wt(r),x=Xs(o),p={role:"group",dir:x,...g};return e.jsx(ya,{scope:r,rovingFocus:n,disabled:a,children:n?e.jsx(Ys,{asChild:!0,...m,orientation:i,dir:x,loop:d,children:e.jsx(he.div,{...p,ref:t})}):e.jsx(he.div,{...p,ref:t})})}),ns="ToggleGroupItem",Jt=de.forwardRef((s,t)=>{const r=Ut(ns,s.__scopeToggleGroup),a=ba(ns,s.__scopeToggleGroup),n=Wt(s.__scopeToggleGroup),i=r.value.includes(s.value),o=a.disabled||s.disabled,d={...s,pressed:i,disabled:o},g=de.useRef(null);return a.rovingFocus?e.jsx(Zs,{asChild:!0,...n,focusable:!o,active:i,ref:g,children:e.jsx(Qs,{...d,ref:t})}):e.jsx(Qs,{...d,ref:t})});Jt.displayName=ns;var Qs=de.forwardRef((s,t)=>{const{__scopeToggleGroup:r,value:a,...n}=s,i=Ut(ns,r),o={role:"radio","aria-checked":s.pressed,"aria-pressed":void 0},d=i.type==="single"?o:void 0;return e.jsx(Ns,{...d,...n,ref:t,onPressedChange:g=>{g?i.onItemActivate(a):i.onItemDeactivate(a)}})}),Xt=ws,Yt=Jt;const Zt=$r("inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-2 min-w-9",sm:"h-8 px-1.5 min-w-8",lg:"h-10 px-2.5 min-w-10"}},defaultVariants:{variant:"default",size:"default"}}),Na=l.forwardRef(({className:s,variant:t,size:r,...a},n)=>e.jsx(Lt,{ref:n,className:V(Zt({variant:t,size:r,className:s})),...a}));Na.displayName=Lt.displayName;const er=l.createContext({size:"default",variant:"default"}),sr=l.forwardRef(({className:s,variant:t,size:r,children:a,...n},i)=>e.jsx(Xt,{ref:i,className:V("flex items-center justify-center gap-1",s),...n,children:e.jsx(er.Provider,{value:{variant:t,size:r},children:a})}));sr.displayName=Xt.displayName;const ts=l.forwardRef(({className:s,children:t,variant:r,size:a,...n},i)=>{const o=l.useContext(er);return e.jsx(Yt,{ref:i,className:V(Zt({variant:o.variant||r,size:o.size||a}),s),...n,children:t})});ts.displayName=Yt.displayName;const Ve=({title:s,description:t,onBack:r,actions:a})=>e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(S,{variant:"ghost",size:"sm",className:"-ml-2",onClick:r,children:[e.jsx(nn,{className:"mr-2 h-4 w-4"}),"Retour à l'accueil"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:s}),t?e.jsx("p",{className:"text-sm text-muted-foreground",children:t}):null]}),a?e.jsx("div",{className:"flex items-center gap-2",children:a}):null]});function Oe(s,t,{checkForDefaultPrevented:r=!0}={}){return function(n){if(s?.(n),r===!1||!n.defaultPrevented)return t?.(n)}}function wa(s){const t=_a(s),r=l.forwardRef((a,n)=>{const{children:i,...o}=a,d=l.Children.toArray(i),g=d.find(Sa);if(g){const m=g.props.children,x=d.map(p=>p===g?l.Children.count(m)>1?l.Children.only(null):l.isValidElement(m)?m.props.children:null:p);return e.jsx(t,{...o,ref:n,children:l.isValidElement(m)?l.cloneElement(m,void 0,x):null})}return e.jsx(t,{...o,ref:n,children:i})});return r.displayName=`${s}.Slot`,r}function _a(s){const t=l.forwardRef((r,a)=>{const{children:n,...i}=r;if(l.isValidElement(n)){const o=Ra(n),d=Aa(i,n.props);return n.type!==l.Fragment&&(d.ref=a?_r(a,o):o),l.cloneElement(n,d)}return l.Children.count(n)>1?l.Children.only(null):null});return t.displayName=`${s}.SlotClone`,t}var Ca=Symbol("radix.slottable");function Sa(s){return l.isValidElement(s)&&typeof s.type=="function"&&"__radixId"in s.type&&s.type.__radixId===Ca}function Aa(s,t){const r={...t};for(const a in t){const n=s[a],i=t[a];/^on[A-Z]/.test(a)?n&&i?r[a]=(...d)=>{const g=i(...d);return n(...d),g}:n&&(r[a]=n):a==="style"?r[a]={...n,...i}:a==="className"&&(r[a]=[n,i].filter(Boolean).join(" "))}return{...s,...r}}function Ra(s){let t=Object.getOwnPropertyDescriptor(s.props,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?s.ref:(t=Object.getOwnPropertyDescriptor(s,"ref")?.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?s.props.ref:s.props.ref||s.ref)}var ka=as[" useInsertionEffect ".trim().toString()]||is;function Da({prop:s,defaultProp:t,onChange:r=()=>{},caller:a}){const[n,i,o]=Ea({defaultProp:t,onChange:r}),d=s!==void 0,g=d?s:n;{const x=l.useRef(s!==void 0);l.useEffect(()=>{const p=x.current;p!==d&&console.warn(`${a} is changing from ${p?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),x.current=d},[d,a])}const m=l.useCallback(x=>{if(d){const p=Pa(x)?x(s):x;p!==s&&o.current?.(p)}else i(x)},[d,s,i,o]);return[g,m]}function Ea({defaultProp:s,onChange:t}){const[r,a]=l.useState(s),n=l.useRef(r),i=l.useRef(t);return ka(()=>{i.current=t},[t]),l.useEffect(()=>{n.current!==r&&(i.current?.(r),n.current=r)},[r,n]),[r,a,i]}function Pa(s){return typeof s=="function"}var us="Popover",[tr]=Ue(us,[tt]),Qe=tt(),[Ma,ve]=tr(us),rr=s=>{const{__scopePopover:t,children:r,open:a,defaultOpen:n,onOpenChange:i,modal:o=!1}=s,d=Qe(t),g=l.useRef(null),[m,x]=l.useState(!1),[p,f]=Da({prop:a,defaultProp:n??!1,onChange:i,caller:us});return e.jsx(Cr,{...d,children:e.jsx(Ma,{scope:t,contentId:Sr(),triggerRef:g,open:p,onOpenChange:f,onOpenToggle:l.useCallback(()=>f(_=>!_),[f]),hasCustomAnchor:m,onCustomAnchorAdd:l.useCallback(()=>x(!0),[]),onCustomAnchorRemove:l.useCallback(()=>x(!1),[]),modal:o,children:r})})};rr.displayName=us;var nr="PopoverAnchor",Ta=l.forwardRef((s,t)=>{const{__scopePopover:r,...a}=s,n=ve(nr,r),i=Qe(r),{onCustomAnchorAdd:o,onCustomAnchorRemove:d}=n;return l.useEffect(()=>(o(),()=>d()),[o,d]),e.jsx(rt,{...i,...a,ref:t})});Ta.displayName=nr;var ar="PopoverTrigger",ir=l.forwardRef((s,t)=>{const{__scopePopover:r,...a}=s,n=ve(ar,r),i=Qe(r),o=we(t,n.triggerRef),d=e.jsx(he.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":ur(n.open),...a,ref:o,onClick:Oe(s.onClick,n.onOpenToggle)});return n.hasCustomAnchor?d:e.jsx(rt,{asChild:!0,...i,children:d})});ir.displayName=ar;var _s="PopoverPortal",[$a,Fa]=tr(_s,{forceMount:void 0}),lr=s=>{const{__scopePopover:t,forceMount:r,children:a,container:n}=s,i=ve(_s,t);return e.jsx($a,{scope:t,forceMount:r,children:e.jsx(ys,{present:r||i.open,children:e.jsx(Ar,{asChild:!0,container:n,children:a})})})};lr.displayName=_s;var Re="PopoverContent",or=l.forwardRef((s,t)=>{const r=Fa(Re,s.__scopePopover),{forceMount:a=r.forceMount,...n}=s,i=ve(Re,s.__scopePopover);return e.jsx(ys,{present:a||i.open,children:i.modal?e.jsx(Oa,{...n,ref:t}):e.jsx(Ia,{...n,ref:t})})});or.displayName=Re;var Va=wa("PopoverContent.RemoveScroll"),Oa=l.forwardRef((s,t)=>{const r=ve(Re,s.__scopePopover),a=l.useRef(null),n=we(t,a),i=l.useRef(!1);return l.useEffect(()=>{const o=a.current;if(o)return Rr(o)},[]),e.jsx(kr,{as:Va,allowPinchZoom:!0,children:e.jsx(cr,{...s,ref:n,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Oe(s.onCloseAutoFocus,o=>{o.preventDefault(),i.current||r.triggerRef.current?.focus()}),onPointerDownOutside:Oe(s.onPointerDownOutside,o=>{const d=o.detail.originalEvent,g=d.button===0&&d.ctrlKey===!0,m=d.button===2||g;i.current=m},{checkForDefaultPrevented:!1}),onFocusOutside:Oe(s.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),Ia=l.forwardRef((s,t)=>{const r=ve(Re,s.__scopePopover),a=l.useRef(!1),n=l.useRef(!1);return e.jsx(cr,{...s,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{s.onCloseAutoFocus?.(i),i.defaultPrevented||(a.current||r.triggerRef.current?.focus(),i.preventDefault()),a.current=!1,n.current=!1},onInteractOutside:i=>{s.onInteractOutside?.(i),i.defaultPrevented||(a.current=!0,i.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const o=i.target;r.triggerRef.current?.contains(o)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&n.current&&i.preventDefault()}})}),cr=l.forwardRef((s,t)=>{const{__scopePopover:r,trapFocus:a,onOpenAutoFocus:n,onCloseAutoFocus:i,disableOutsidePointerEvents:o,onEscapeKeyDown:d,onPointerDownOutside:g,onFocusOutside:m,onInteractOutside:x,...p}=s,f=ve(Re,r),_=Qe(r);return Dr(),e.jsx(Er,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:n,onUnmountAutoFocus:i,children:e.jsx(Pr,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:x,onEscapeKeyDown:d,onPointerDownOutside:g,onFocusOutside:m,onDismiss:()=>f.onOpenChange(!1),children:e.jsx(Mr,{"data-state":ur(f.open),role:"dialog",id:f.contentId,..._,...p,ref:t,style:{...p.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),dr="PopoverClose",qa=l.forwardRef((s,t)=>{const{__scopePopover:r,...a}=s,n=ve(dr,r);return e.jsx(he.button,{type:"button",...a,ref:t,onClick:Oe(s.onClick,()=>n.onOpenChange(!1))})});qa.displayName=dr;var za="PopoverArrow",Ga=l.forwardRef((s,t)=>{const{__scopePopover:r,...a}=s,n=Qe(r);return e.jsx(Tr,{...n,...a,ref:t})});Ga.displayName=za;function ur(s){return s?"open":"closed"}var La=rr,Ba=ir,Ka=lr,mr=or;const Wa=La,Ha=Ba,pr=l.forwardRef(({className:s,align:t="center",sideOffset:r=4,...a},n)=>e.jsx(Ka,{children:e.jsx(mr,{ref:n,align:t,sideOffset:r,className:V("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",s),...a})}));pr.displayName=mr.displayName;const Ua=({onBack:s,swimSessions:t,strengthSessions:r,athletes:a,groups:n})=>{const{toast:i}=os(),[o,d]=l.useState({session_type:"swim",session_id:"",assigned_date:new Date().toISOString().split("T")[0],assigned_slot:"morning"}),[g,m]=l.useState(!1),[x,p]=l.useState("user"),[f,_]=l.useState(""),[N,q]=l.useState([]),v=h=>{const T=typeof h=="number"?h:Number(h);return Number.isFinite(T)&&T>0?T:null},ee=l.useMemo(()=>a.map(h=>({value:h.id?`id:${h.id}`:`name:${h.display_name}`,label:h.group_label?`${h.display_name} · ${h.group_label}`:h.display_name,id:h.id,name:h.display_name})),[a]),X=l.useMemo(()=>new Map(ee.map(h=>[h.value,h])),[ee]),w=l.useMemo(()=>n.map(h=>{const T=v(h.id);return T?{...h,gid:T}:null}).filter(h=>!!h),[n]),M=l.useMemo(()=>w.filter(h=>N.includes(h.gid)),[w,N]),ne=l.useMemo(()=>{if(M.length===0)return"Choisir des groupes";const h=M.slice(0,2).map(H=>H.name).join(", "),T=M.length>2?` +${M.length-2}`:"";return`${h}${T}`},[M]),D=ae({mutationFn:async h=>z.assignments_create(h),onSuccess:()=>{i({title:"Séance assignée & notifiée"})},onError:h=>{const T="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",H=h instanceof Error?h.message:typeof h=="string"?h:T;let R=H;const C=H.match(/HTTP \d+:\s*(\{.*\})/);if(C)try{R=JSON.parse(C[1])?.error||T}catch{R=T}i({title:"Erreur d'assignation",description:R})}}),Y=async()=>{const h=Number(o.session_id);if(!Number.isInteger(h)||h<=0){i({title:"Séance invalide",description:"Sélectionnez une séance valide."});return}if(x==="group"){if(N.length===0){i({title:"Groupe manquant",description:"Sélectionnez au moins un groupe."});return}m(!0);try{const E={assignment_type:o.session_type,session_id:h,scheduled_date:o.assigned_date,scheduled_slot:o.assigned_slot},K=Array.from(new Set(N));await Promise.all(K.map(B=>z.assignments_create({...E,target_group_id:B}))),i({title:"Séance assignée & notifiée"})}catch(E){const K="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",B=E instanceof Error?E.message:typeof E=="string"?E:K;let ue=B;const Z=B.match(/HTTP \d+:\s*(\{.*\})/);if(Z)try{ue=JSON.parse(Z[1])?.error||K}catch{ue=K}i({title:"Erreur d'assignation",description:ue})}finally{m(!1)}return}const T=f.trim();if(!T){i({title:"Nageur manquant",description:"Sélectionnez un nageur."});return}const H=X.get(T),R=H?.id??(Number.isFinite(Number(T))&&Number(T)>0?Number(T):void 0);if(!Number.isFinite(R)||Number(R)<=0){i({title:"Nageur invalide",description:"Sélectionnez un nageur avec un identifiant valide."});return}const C=H?.name??T.replace(/^name:/,"");D.mutate({assignment_type:o.session_type,session_id:h,target_athlete:C,target_user_id:R,scheduled_date:o.assigned_date,scheduled_slot:o.assigned_slot})},ye=!o.session_id||(x==="group"?N.length===0:!f.trim())||D.isPending||g;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(Ve,{title:"Assigner une séance",description:"Planifiez une séance pour un nageur ou un ou plusieurs groupes.",onBack:s}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(L,{className:"border-l-4 border-l-primary",children:[e.jsxs(U,{children:[e.jsx(Q,{children:"Séance"}),e.jsx(J,{children:"Choisissez le type et la séance à envoyer."})]}),e.jsxs(W,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Type"}),e.jsxs(ie,{value:o.session_type,onValueChange:h=>d({...o,session_type:h,session_id:""}),children:[e.jsx(le,{children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(G,{value:"swim",children:"Natation"}),e.jsx(G,{value:"strength",children:"Musculation"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Séance"}),e.jsxs(ie,{value:o.session_id,onValueChange:h=>d({...o,session_id:h}),children:[e.jsx(le,{children:e.jsx(oe,{placeholder:"Choisir..."})}),e.jsx(ce,{children:o.session_type==="swim"?t?.map(h=>e.jsx(G,{value:h.id.toString(),children:h.name},h.id)):r?.map(h=>e.jsx(G,{value:h.id.toString(),children:h.title},h.id))})]})]})]})]}),e.jsxs(L,{children:[e.jsxs(U,{children:[e.jsx(Q,{children:"Cible & planification"}),e.jsx(J,{children:"Définissez le destinataire, la date et le créneau."})]}),e.jsxs(W,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Cible"}),e.jsxs(ie,{value:x,onValueChange:h=>{p(h),_(""),q([])},children:[e.jsx(le,{children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(G,{value:"user",children:"Nageur"}),e.jsx(G,{value:"group",children:"Groupe(s)"})]})]})]}),x==="user"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Nageur"}),ee.length>0?e.jsxs(ie,{value:f,onValueChange:_,children:[e.jsx(le,{children:e.jsx(oe,{placeholder:"Choisir un nageur"})}),e.jsx(ce,{children:ee.map(h=>e.jsx(G,{value:h.value,children:h.label},h.value))})]}):e.jsx(I,{value:f,onChange:h=>_(h.target.value),placeholder:"ex: Camille"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Groupes"}),n.length>0?e.jsxs(Wa,{children:[e.jsx(Ha,{asChild:!0,children:e.jsxs(S,{type:"button",variant:"outline",className:"w-full justify-between","aria-label":"Sélection des groupes",children:[e.jsx("span",{className:"truncate",children:ne}),e.jsx(qr,{className:"ml-2 h-4 w-4 opacity-50"})]})}),e.jsxs(pr,{className:"w-[--radix-popover-trigger-width] p-2",align:"start",children:[e.jsx("div",{className:"max-h-64 overflow-auto",children:e.jsx("div",{className:"space-y-1",children:w.map(h=>{const T=N.includes(h.gid);return e.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 hover:bg-muted",children:[e.jsx(gs,{checked:T,onCheckedChange:H=>{const R=H===!0;q(C=>R?C.includes(h.gid)?C:[...C,h.gid]:C.filter(E=>E!==h.gid))}}),e.jsx("span",{className:"text-sm",children:h.name})]},h.gid)})})}),N.length>0?e.jsx(S,{type:"button",variant:"ghost",size:"sm",className:"mt-2 w-full",onClick:()=>q([]),children:"Tout désélectionner"}):null]})]}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"Aucun groupe disponible."}),N.length>0?e.jsxs("div",{className:"text-xs text-muted-foreground",children:[N.length," groupe",N.length>1?"s":""," sélectionné",N.length>1?"s":"","."]}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Date"}),e.jsx(I,{type:"date",value:o.assigned_date,onChange:h=>d({...o,assigned_date:h.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Créneau"}),e.jsxs(ie,{value:o.assigned_slot,onValueChange:h=>d({...o,assigned_slot:h}),children:[e.jsx(le,{children:e.jsx(oe,{placeholder:"Choisir..."})}),e.jsxs(ce,{children:[e.jsx(G,{value:"morning",children:"Matin"}),e.jsx(G,{value:"evening",children:"Soir"})]})]})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(S,{className:"w-full sm:w-auto",onClick:Y,disabled:ye,children:[e.jsx(Ie,{className:"mr-2 h-4 w-4"}),D.isPending||g?"Assignation...":"Assigner & notifier"]})})]})},Qa=({onBack:s,athletes:t,groups:r,athletesLoading:a})=>{const{toast:n}=os(),[i,o]=l.useState(""),[d,g]=l.useState("Message Coach"),[m,x]=l.useState(""),p=l.useMemo(()=>t.filter(v=>v.id).map(v=>({value:`user:${v.id}`,label:v.group_label?`${v.display_name} · ${v.group_label}`:v.display_name,id:v.id})),[t]),f=l.useMemo(()=>r.map(v=>({value:`group:${v.id}`,label:v.name,id:v.id})),[r]),_=l.useMemo(()=>new Map([...p,...f].map(v=>[v.value,v])),[p,f]),N=ae({mutationFn:v=>z.notifications_send({...v,type:"message"}),onSuccess:()=>{n({title:"Message envoyé"}),o("")}}),q=()=>{if(!d.trim()||!i.trim()){n({title:"Message incomplet",description:"Ajoutez un titre et un contenu."});return}if(!m){n({title:"Destinataire manquant",description:"Sélectionnez un nageur ou un groupe."});return}const v=_.get(m);if(!v?.id){n({title:"Destinataire invalide",description:"Sélectionnez un destinataire valide."});return}if(m.startsWith("group:")){N.mutate({title:d,body:i,targets:[{target_group_id:v.id}]});return}N.mutate({title:d,body:i,targets:[{target_user_id:v.id}]})};return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(Ve,{title:"Messagerie rapide",description:"Envoyez un message ciblé à vos nageurs.",onBack:s}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(L,{className:"border-l-4 border-l-primary",children:[e.jsxs(U,{children:[e.jsx(Q,{children:"Destinataire"}),e.jsx(J,{children:"Sélectionnez un nageur ou un groupe à prévenir."})]}),e.jsx(W,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Destinataire"}),e.jsxs(ie,{value:m,onValueChange:x,children:[e.jsx(le,{children:e.jsx(oe,{placeholder:a?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(ce,{children:[f.length?e.jsxs(e.Fragment,{children:[e.jsx(G,{value:"section-group",disabled:!0,children:"Groupes"}),f.map(v=>e.jsx(G,{value:v.value,children:v.label},v.value))]}):null,p.length?e.jsxs(e.Fragment,{children:[e.jsx(G,{value:"section-athlete",disabled:!0,children:"Nageurs"}),p.map(v=>e.jsx(G,{value:v.value,children:v.label},v.value))]}):null]})]})]})})]}),e.jsxs(L,{children:[e.jsxs(U,{children:[e.jsx(Q,{children:"Contenu"}),e.jsx(J,{children:"Rédigez votre message en quelques lignes."})]}),e.jsxs(W,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"msg-title",children:"Titre"}),e.jsx(I,{id:"msg-title",value:d,onChange:v=>g(v.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"msg-body",children:"Message"}),e.jsx(Te,{id:"msg-body",placeholder:"Message...",value:i,onChange:v=>o(v.target.value),rows:5,maxLength:500}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[i.length,"/500"]})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(S,{className:"w-full sm:w-auto",onClick:q,disabled:N.isPending,children:[e.jsx(cs,{className:"mr-2 h-4 w-4"}),N.isPending?"Envoi...":"Envoyer"]})})]})},Ja=({onNavigate:s})=>e.jsxs(L,{className:"border-l-4 border-l-primary",children:[e.jsxs(U,{children:[e.jsx(Q,{children:"Actions rapides"}),e.jsx(J,{children:"Accélérez vos tâches les plus fréquentes."})]}),e.jsxs(W,{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs(S,{className:"justify-start",variant:"outline",onClick:()=>s("assignments"),children:[e.jsx(Ie,{className:"mr-2 h-4 w-4"}),"Assigner une séance"]}),e.jsxs(S,{className:"justify-start",variant:"outline",onClick:()=>s("messaging"),children:[e.jsx(cs,{className:"mr-2 h-4 w-4"}),"Message rapide"]})]})]}),Xa=({onNavigate:s,onOpenRecordsAdmin:t,athletes:r,athletesLoading:a,upcomingBirthdays:n,birthdaysLoading:i,kpiLoading:o,kpiPeriod:d,onKpiPeriodChange:g,fatigueAlerts:m,mostLoadedAthlete:x})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Espace Coach"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Votre tableau de bord pour gérer les séances, les nageurs et la communication."})]}),e.jsxs("div",{className:"space-y-3 sm:hidden",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-[0.2em] text-muted-foreground",children:"Par où commencer"})}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("button",{type:"button",onClick:()=>s("swim"),className:"rounded-xl border bg-white p-4 text-left shadow-sm transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Créer une séance natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Structurer un nouveau plan."})]}),e.jsx(Rs,{className:"h-5 w-5 text-primary"})]})}),e.jsx("button",{type:"button",onClick:()=>s("assignments"),className:"rounded-xl border bg-white p-4 text-left shadow-sm transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Assigner une séance"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Envoyer une séance à un nageur."})]}),e.jsx(Ie,{className:"h-5 w-5 text-primary"})]})}),e.jsx("button",{type:"button",onClick:()=>s("messaging"),className:"rounded-xl border bg-white p-4 text-left shadow-sm transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Envoyer un message"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Relancer ou féliciter un nageur."})]}),e.jsx(cs,{className:"h-5 w-5 text-primary"})]})})]})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsx(Ja,{onNavigate:s})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(L,{className:"shadow-sm",children:[e.jsxs(U,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(Rs,{className:"h-5 w-5 text-primary"}),"Natation"]}),e.jsx(J,{children:"Consultez et créez des séances natation."})]}),e.jsx(W,{children:e.jsx(S,{className:"w-full",onClick:()=>s("swim"),children:"Accéder à la bibliothèque"})})]}),e.jsxs(L,{className:"shadow-sm",children:[e.jsxs(U,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(Vr,{className:"h-5 w-5 text-primary"}),"Musculation"]}),e.jsx(J,{children:"Préparez les plans muscu et les suivis."})]}),e.jsx(W,{children:e.jsx(S,{className:"w-full",onClick:()=>s("strength"),children:"Accéder à la bibliothèque"})})]}),e.jsxs(L,{className:"shadow-sm",children:[e.jsxs(U,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(es,{className:"h-5 w-5 text-primary"}),"Mes nageurs"]}),e.jsx(J,{children:"Accédez aux fiches individuelles et aux groupes."})]}),e.jsx(W,{children:e.jsx(S,{className:"w-full",onClick:()=>s("swimmers"),children:"Voir les nageurs"})})]}),e.jsxs(L,{className:"shadow-sm",children:[e.jsxs(U,{children:[e.jsxs(Q,{className:"flex items-center gap-2",children:[e.jsx(Or,{className:"h-5 w-5 text-primary"}),"Records club"]}),e.jsx(J,{children:"Importer les performances FFN et reconstruire les records."})]}),e.jsx(W,{children:e.jsx(S,{className:"w-full",variant:"outline",onClick:t,children:"Administration des records"})})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(L,{className:"sm:hidden bg-primary text-primary-foreground",children:[e.jsxs(U,{className:"space-y-1",children:[e.jsx(Q,{className:"text-base",children:"Indicateurs clés"}),e.jsx(J,{className:"text-primary-foreground/70",children:"Synthèse rapide pour aujourd'hui."})]}),e.jsxs(W,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-primary-foreground/10 bg-primary-foreground/5 p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-primary-foreground/70",children:"Fatigue 5/5"}),e.jsx("p",{className:"text-2xl font-semibold",children:o?"…":m.length}),e.jsx("p",{className:"text-xs text-primary-foreground/70",children:o?"Chargement...":m.length?m.slice(0,2).map(p=>p.athleteName).join(", "):"Aucune alerte"})]}),e.jsx(Fs,{className:"h-5 w-5 text-primary-foreground/70"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-primary-foreground/10 bg-primary-foreground/5 p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-primary-foreground/70",children:"Nageur le plus chargé"}),e.jsx("p",{className:"text-lg font-semibold",children:o?"…":x?.athleteName??"-"}),e.jsx("p",{className:"text-xs text-primary-foreground/70",children:o?"Calcul en cours":x?`Charge ${Math.round(x.loadScore)}`:"Pas de données récentes"})]}),e.jsx(es,{className:"h-5 w-5 text-primary-foreground/70"})]})]})]}),e.jsxs(L,{className:"hidden sm:block",children:[e.jsx(U,{className:"space-y-2",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Q,{children:"Signaux clés"}),e.jsx(J,{children:"Vue d'ensemble rapide de votre groupe."})]}),e.jsxs(sr,{type:"single",size:"sm",variant:"outline",value:String(d),onValueChange:p=>{p&&g(Number(p))},children:[e.jsx(ts,{value:"7","aria-label":"Période 7 jours","aria-pressed":d===7,children:"7j"}),e.jsx(ts,{value:"30","aria-label":"Période 30 jours","aria-pressed":d===30,children:"30j"}),e.jsx(ts,{value:"365","aria-label":"Période 365 jours","aria-pressed":d===365,children:"365j"})]})]})}),e.jsxs(W,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border bg-muted/30 p-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Fatigue 5/5 (",d,"j)"]}),e.jsx("p",{className:"text-xl font-semibold",children:o?"…":m.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o?"Chargement...":m.length?m.slice(0,2).map(p=>p.athleteName).join(", "):"Aucune alerte"})]}),e.jsx(Fs,{className:"h-5 w-5 text-muted-foreground"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border bg-muted/30 p-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Nageur le plus chargé (",d,"j)"]}),e.jsx("p",{className:"text-xl font-semibold",children:o?"…":x?.athleteName??"-"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:o?"Calcul en cours":x?`Charge ${Math.round(x.loadScore)}`:"Pas de données récentes"})]}),e.jsx(es,{className:"h-5 w-5 text-muted-foreground"})]})]})]}),e.jsxs(L,{children:[e.jsxs(U,{children:[e.jsx(Q,{children:"Anniversaires à venir"}),e.jsx(J,{children:"Les 30 prochains jours."})]}),e.jsxs(W,{className:"space-y-3",children:[i?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Chargement..."}):n&&n.length>0?n.slice(0,3).map(p=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:p.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Ya(p.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-semibold text-primary",children:["J-",p.days_until]})]},p.id)):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun anniversaire dans les 30 prochains jours."}),e.jsx(S,{variant:"outline",className:"w-full",onClick:()=>s("swimmers"),children:"Voir tous les nageurs"})]})]})]})]}),Ya=s=>{if(!s)return"-";const t=new Date(s);return Number.isNaN(t.getTime())?s:t.toLocaleDateString("fr-FR")},Js=s=>s.toISOString().split("T")[0],Za=s=>new Date(s.completed_at||s.started_at||s.date||s.created_at||0).getTime(),ei=s=>{if(!s.length)return null;const t=s.reduce((a,n)=>a+n,0)/s.length,r=Math.min(5,Math.max(1,Math.round(t/10*5)));return{average:t,rating:r}};function ki(){const s=Ze(D=>D.role);Ze(D=>D.selectedAthleteId);const t=Ze(D=>D.setSelectedAthlete),[,r]=Fr(),[a,n]=l.useState("home"),[i,o]=l.useState(7),d=s==="coach"||s==="admin",g=a==="assignments",m=a==="home"||a==="assignments"||a==="messaging"||a==="swimmers",x=a==="assignments"||a==="messaging",p=a==="home"||a==="swimmers",{data:f}=me({queryKey:["swim_catalog"],queryFn:()=>z.getSwimCatalog(),enabled:d&&g}),{data:_}=me({queryKey:["strength_catalog"],queryFn:()=>z.getStrengthSessions(),enabled:d&&g}),{data:N=[],isLoading:q}=me({queryKey:["athletes"],queryFn:()=>z.getAthletes(),enabled:d&&m}),v=l.useMemo(()=>N.slice(0,5),[N]),{data:ee=[]}=me({queryKey:["groups"],queryFn:()=>z.getGroups(),enabled:d&&x}),X=me({queryKey:["upcoming-birthdays"],queryFn:()=>z.getUpcomingBirthdays({days:30}),enabled:d&&p}),w=X.data,M=me({queryKey:["coach-kpis",i,v.map(D=>D.id??D.display_name)],enabled:d&&a==="home"&&v.length>0,queryFn:async()=>{const D=i,Y=new Date;Y.setDate(Y.getDate()-D);const ye=Js(Y),h=Js(new Date),T=await Promise.all(v.map(async C=>{const[E,K]=await Promise.all([z.getSessions(C.display_name,C.id),z.getStrengthHistory(C.display_name,{athleteId:C.id,limit:50,from:ye,to:h})]),B=E.filter(O=>new Date(O.date).getTime()>=Y.getTime()),ue=B.map(O=>O.fatigue??O.feeling).filter(O=>Number.isFinite(O)),Z=B.reduce((O,se)=>O+(Number(se.duration)||0)*(Number(se.effort)||0),0),_e=(K?.runs??[]).filter(O=>Za(O)>=Y.getTime()),Ce=_e.map(O=>O.fatigue??O.feeling??O.rpe).filter(O=>Number.isFinite(Number(O))).map(O=>Number(O)),Se=_e.reduce((O,se)=>{const be=Number(se.feeling??se.rpe??0),Ne=Number(se.duration??0);if(Ne>0&&be>0)return O+Ne*be;const u=Array.isArray(se.logs)?se.logs.length:0;return O+u*5},0),De=ei([...ue,...Ce]);return{athleteName:C.display_name,loadScore:Z+Se,fatigueRating:De}})),H=T.filter(C=>C.fatigueRating?.rating===5).map(C=>({athleteName:C.athleteName,rating:C.fatigueRating?.rating??0})),R=T.filter(C=>C.loadScore>0).sort((C,E)=>E.loadScore-C.loadScore)[0];return{fatigueAlerts:H,mostLoadedAthlete:R??null}}}),ne=D=>{t({id:D.id??null,name:D.display_name}),r("/progress")};return d?e.jsxs("div",{className:"space-y-6",children:[a==="home"?e.jsx(Xa,{onNavigate:n,onOpenRecordsAdmin:()=>r("/records-admin"),athletes:N,athletesLoading:q,upcomingBirthdays:w,birthdaysLoading:X.isLoading,kpiLoading:M.isLoading,kpiPeriod:i,onKpiPeriodChange:o,fatigueAlerts:M.data?.fatigueAlerts??[],mostLoadedAthlete:M.data?.mostLoadedAthlete??null}):null,a==="assignments"?e.jsx(Ua,{onBack:()=>n("home"),swimSessions:f,strengthSessions:_,athletes:N,groups:ee}):null,a==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ve,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>n("home"),actions:e.jsxs(S,{variant:"outline",onClick:()=>n("assignments"),children:[e.jsx(Ie,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(ca,{})]}):null,a==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ve,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>n("home"),actions:e.jsxs(S,{variant:"outline",onClick:()=>n("assignments"),children:[e.jsx(Ie,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(Yn,{})]}):null,a==="swimmers"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ve,{title:"Nageurs",description:"Accédez aux fiches individuelles des nageurs.",onBack:()=>n("home"),actions:e.jsxs(S,{variant:"outline",onClick:()=>n("messaging"),children:[e.jsx(cs,{className:"mr-2 h-4 w-4"}),"Message rapide"]})}),e.jsxs(L,{children:[e.jsxs(U,{children:[e.jsx(Q,{children:"Suivi des Nageurs"}),e.jsx(J,{children:"Accédez aux fiches individuelles des nageurs."})]}),e.jsx(W,{children:q?e.jsx("div",{className:"space-y-3 p-2",children:[1,2,3,4,5].map(D=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-1/3 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"h-4 w-1/4 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"ml-auto h-8 w-16 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"})]},D))}):N.length?e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs(en,{children:[e.jsx(sn,{children:e.jsxs(Ms,{children:[e.jsx(xs,{children:"Nageur"}),e.jsx(xs,{children:"Groupe"}),e.jsx(xs,{className:"text-right",children:"Fiche"})]})}),e.jsx(tn,{children:N.map(D=>e.jsxs(Ms,{children:[e.jsx(hs,{className:"font-medium",children:D.display_name}),e.jsx(hs,{children:D.group_label?e.jsx(rn,{variant:"secondary",children:D.group_label}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"Sans groupe"})}),e.jsx(hs,{className:"text-right",children:e.jsx(S,{size:"sm",variant:"outline",onClick:()=>ne(D),children:"Voir la fiche"})})]},D.id??D.display_name))})]})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun nageur disponible."})})]})]}):null,a==="messaging"?e.jsx(Qa,{onBack:()=>n("home"),athletes:N,groups:ee,athletesLoading:q}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(L,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(U,{children:[e.jsxs(Q,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(es,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(J,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(W,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}export{ki as default};
