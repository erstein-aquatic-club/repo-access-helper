import{b as I,j as e}from"./vendor-ui-M0btmmZ9.js";import{u as k,R,n as q,C as n,g as o,h as u,j as x,L as D,d as f,o as H}from"./index-Dd2k2fWK.js";import{u as j}from"./vendor-query-CwV3kFk7.js";import{S as K,a as O,b as V,c as z,d as E}from"./select-Mkriabtx.js";import{C as P}from"./checkbox-CkMwwa9M.js";import{c as Q,f as a,g as $}from"./timesheetHelpers-Bz--l20Q.js";import{f as B}from"./vendor-date-B8Mnp-Vt.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-D_WtzBoI.js";import"./vendor-supabase-B7dJFgIA.js";import"./chevron-down-CuPUPRYs.js";import"./check-myxeqXmH.js";import"./chevron-up-CiadIhkJ.js";const _=r=>{if(!r)return"—";if(/^\d{2}:\d{2}(:\d{2})?$/.test(r))return r.slice(0,5);const d=new Date(r);return Number.isNaN(d.getTime())?"—":B(d,"HH:mm")};function le(){const{useMemo:r,useState:d}=I,g=typeof window>"u"?k.getState().role:k(s=>s.role),h=g==="comite"||g==="admin",[p,A]=d("all"),[c,F]=d(!1),{data:L=[]}=j({queryKey:["timesheet-coaches"],queryFn:()=>f.listTimesheetCoaches(),enabled:h}),b=p==="all"?void 0:Number(p),{data:m=[],error:v}=j({queryKey:["timesheet-shifts",b??"all"],queryFn:()=>f.listTimesheetShifts({coachId:b}),enabled:h}),{data:y,error:N}=j({queryKey:["capabilities","timesheet"],queryFn:()=>f.getCapabilities(),enabled:H.hasSupabase}),i=Q(m),T=r(()=>c?m.filter(s=>s.is_travel):m,[m,c]),C=r(()=>{const s=new Map;return T.forEach(l=>{const t=l.shift_date;s.has(t)||s.set(t,[]),s.get(t)?.push(l)}),Array.from(s.entries()).sort(([l],[t])=>l<t?1:-1)},[T]);if(!h)return typeof window>"u"?null:e.jsx(R,{to:"/"});const w=N?q(N,"Impossible de vérifier le module de pointage.").message:y?.mode==="supabase"&&!y.timesheet.available?"Pointage heures indisponible (tables manquantes côté D1).":null,S=v?q(v,"Impossible de charger les shifts.").message:null;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Comité"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Tableau de bord shifts"})]}),w?e.jsx(n,{className:"border-dashed",children:e.jsx(o,{className:"py-4 text-sm text-muted-foreground",children:w})}):null,S?e.jsx(n,{className:"border-destructive/40",children:e.jsx(o,{className:"py-4 text-sm text-destructive",children:S})}):null,e.jsxs(n,{children:[e.jsx(u,{children:e.jsx(x,{children:"Filtrer par coach"})}),e.jsx(o,{children:e.jsxs(K,{value:p,onValueChange:A,children:[e.jsx(O,{className:"w-full md:w-80",children:e.jsx(V,{placeholder:"Tous les coachs"})}),e.jsxs(z,{children:[e.jsx(E,{value:"all",children:"Tous les coachs"}),L.map(s=>e.jsx(E,{value:String(s.id),children:s.display_name},s.id))]})]})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(n,{children:[e.jsx(u,{children:e.jsx(x,{children:"Totals semaine"})}),e.jsxs(o,{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Travail: ",a(i.week.workMinutes)]}),e.jsxs("div",{children:["Trajet: ",a(i.week.travelMinutes)]}),e.jsxs("div",{className:"font-semibold text-foreground",children:["Total: ",a(i.week.totalMinutes)]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Les shifts en cours ne sont pas comptabilisés."})]})]}),e.jsxs(n,{children:[e.jsx(u,{children:e.jsx(x,{children:"Totals mois"})}),e.jsxs(o,{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Travail: ",a(i.month.workMinutes)]}),e.jsxs("div",{children:["Trajet: ",a(i.month.travelMinutes)]}),e.jsxs("div",{className:"font-semibold text-foreground",children:["Total: ",a(i.month.totalMinutes)]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Les shifts en cours ne sont pas comptabilisés."})]})]})]}),e.jsxs(n,{children:[e.jsx(u,{children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx(x,{children:"Shifts enregistrés"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(P,{id:"shift-travel-filter",checked:c,onCheckedChange:s=>F(s===!0)}),e.jsx(D,{htmlFor:"shift-travel-filter",children:"Trajet uniquement"})]})]})}),e.jsx(o,{className:"space-y-4",children:C.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:c?"Aucun trajet disponible.":"Aucun shift disponible."}):C.map(([s,l])=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:s}),e.jsx("div",{className:"space-y-2",children:l.map(t=>{const M=$(t);return e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 rounded-lg border border-border/60 bg-muted/30 px-3 py-2 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium text-foreground",children:[_(t.start_time)," →"," ",t.end_time?_(t.end_time):"En cours · non comptabilisé"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.coach_name||"Coach"," · ",t.location||"Lieu non précisé"," ·"," ",t.is_travel?"Trajet":"Travail"]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:M!==null?a(M):"En cours"})]},t.id)})})]},s))})]})]})}export{le as default};
