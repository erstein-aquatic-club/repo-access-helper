import{r as c,j as e}from"./vendor-ui-CMUPCwTD.js";import{h as ss,u as ts,i as rs,C as $,f as q,W as D,D as ue,T as xe,B as C,X as Se,g as v}from"./index-T_agY1No.js";import{b as ns,u as A,c as B}from"./vendor-query-WtxIVPOV.js";import{L as _}from"./label-CQnZ0Rjc.js";import{I as E}from"./input-3OPSM2FB.js";import{T as pe}from"./textarea-BCpiBz8Q.js";import{T as is,a as as,b as he,c as fe}from"./tabs-Ba-ZukLq.js";import{S as ge,a as je,b as ve,c as be,d as H}from"./select-CiW2Vdzo.js";import{R as Ne,s as os}from"./Profile-B6pw0yNG.js";import{C as we}from"./clock-Cvxx-Eg3.js";import{P as ye}from"./save-D_Rd3jtG.js";import{C as _e}from"./check-DdXCpPtH.js";import{R as ls,e as ds,C as cs,X as ms,Y as us,T as xs,L as ps}from"./vendor-charts-BHfjz9SJ.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-CrvtPqJM.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],fs=ss("download",hs),z=(...n)=>n.filter(Boolean).join(" ");function W(n){if(!n)return"—";const r=new Date(n);return Number.isNaN(r.getTime())?n:r.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"2-digit"})}function U(n){if(n==null)return"—";const r=Math.round(Math.max(0,n*1e3)),u=Math.floor(r/6e4),l=Math.floor(r%6e4/1e3),h=Math.floor(r%1e3/10);return u>0?`${u}:${String(l).padStart(2,"0")}.${String(h).padStart(2,"0")}`:`${l}.${String(h).padStart(2,"0")}`}function gs(n){const r=n.trim();if(!r)return null;if(r.includes(":")){const[l,h]=r.split(":"),f=Number(l);if(!Number.isFinite(f)||f<0)return null;const F=h.replace(",","."),N=Number(F);return!Number.isFinite(N)||N<0?null:f*60+N}const u=Number(r.replace(",","."));return!Number.isFinite(u)||u<0?null:u}function js(n){if(!n)return null;const r=n.match(/FFN\s*\((\d+)\s*pts\)/i);if(!r)return null;const u=Number(r[1]);return Number.isFinite(u)?u:null}function vs({value:n,placeholder:r,onSave:u,onCancel:l,inputMode:h="decimal",hint:f}){const[F,N]=c.useState(n);return c.useEffect(()=>{N(n)},[n]),e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(E,{value:F,onChange:a=>N(a.target.value),placeholder:r,inputMode:h,className:"h-10 rounded-xl",autoFocus:!0}),f?e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:f}):null]}),e.jsx(C,{type:"button",onClick:()=>u(F),className:"h-10 w-10 p-0 rounded-xl","aria-label":"Valider",children:e.jsx(_e,{className:"h-5 w-5"})}),e.jsx(C,{type:"button",variant:"outline",onClick:l,className:"h-10 w-10 p-0 rounded-xl","aria-label":"Annuler",children:e.jsx(Se,{className:"h-5 w-5"})})]})})}const b=()=>e.jsx("div",{className:"h-10 rounded-xl bg-muted animate-pulse motion-reduce:animate-none"});function Ds(){const{user:n,userId:r,role:u}=ts(),{toast:l}=rs(),h=ns(),f={id:null,event_name:"",pool_length:"",time_seconds:"",record_date:"",notes:""},[F,N]=c.useState("swim"),[a,p]=c.useState(f),[i,Ce]=c.useState("training"),[M,Fe]=c.useState(25),[G,K]=c.useState(null),[ke,J]=c.useState(null),[Re,Z]=c.useState(""),[Q,Ee]=c.useState(25),[w,Me]=c.useState("all"),k=os(u);c.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[]);const ee=s=>{const t=s?.pool_length??s?.poolLength??s?.poolLen??s?.pool;if(t==null)return null;if(typeof t=="number")return t===25||t===50?t:null;const d=String(t).match(/\b(25|50)\b/);if(!d)return null;const m=Number(d[1]);return m===25||m===50?m:null},Ie=A({queryKey:["1rm",n,r],queryFn:()=>v.get1RM({athleteName:n,athleteId:r}),enabled:!!n&&k}),Te=A({queryKey:["exercises"],queryFn:()=>v.getExercises(),enabled:k}),Pe=A({queryKey:["swim-records",r,n],queryFn:()=>v.getSwimRecords({athleteId:r??void 0,athleteName:n??void 0}),enabled:!!n&&k}),Le=A({queryKey:["profile",r],queryFn:()=>v.getProfile({userId:r??void 0}),enabled:!!r&&k}),y=String(Le.data?.ffn_iuf??"").trim(),$e=A({queryKey:["swimmer-performances",r,y,Q],queryFn:()=>v.getSwimmerPerformances({userId:r??void 0,iuf:y||void 0,poolLength:Q}),enabled:!!y&&k&&i==="history"}),{data:R,isLoading:qe,isError:De}=$e,V=B({mutationFn:()=>{if(!y)throw new Error("IUF FFN manquant. Ajoutez-le dans votre profil.");return v.importSwimmerPerformances({iuf:y,userId:r??void 0})},onSuccess:s=>{h.invalidateQueries({queryKey:["swimmer-performances"]}),l({title:"Import terminé",description:`${s.total_found} trouvée(s), ${s.new_imported} importée(s), ${s.already_existed} déjà existante(s)`})},onError:s=>{l({title:"Import impossible",description:String(s?.message||s),variant:"destructive"})}}),se=c.useMemo(()=>R?[...new Set(R.map(t=>t.event_code))].sort():[],[R]),I=c.useMemo(()=>{if(!R)return[];let s=R;return w!=="all"&&(s=s.filter(t=>t.event_code===w)),s},[R,w]),te=c.useMemo(()=>w==="all"||!I.length?[]:[...I].filter(s=>s.competition_date).sort((s,t)=>(s.competition_date??"").localeCompare(t.competition_date??"")).map(s=>({date:W(s.competition_date),time:s.time_seconds,display:s.time_display??U(s.time_seconds)})),[I,w]),{data:Ae,isLoading:ze,isError:Ke}=Ie,{data:Qe,isLoading:Ve,isError:Oe}=Te,{data:re,isLoading:Be,isFetching:bs,isError:He,refetch:We}=Pe,Ue=()=>{We()};c.useEffect(()=>{i==="comp"&&Ue()},[i]);const ne=B({mutationFn:s=>v.update1RM({...s,athlete_id:r,athlete_name:n}),onSuccess:()=>{h.invalidateQueries({queryKey:["1rm"]}),l({title:"1RM mis à jour"})}}),X=B({mutationFn:s=>v.upsertSwimRecord(s),onSuccess:()=>{h.invalidateQueries({queryKey:["swim-records"]}),p(f),K(null),l({title:"Record mis à jour"})}});B({mutationFn:s=>v.syncFfnSwimRecords({athleteId:r??void 0,athleteName:n??void 0,iuf:s}),onSuccess:s=>{h.invalidateQueries({queryKey:["swim-records"]}),l({title:"Synchro FFN terminée",description:`${s?.inserted??0} ajouté(s), ${s?.updated??0} mis à jour, ${s?.skipped??0} inchangé(s)`})},onError:s=>{l({title:"Synchro FFN impossible",description:String(s?.message||s),variant:"destructive"})}});const O=()=>{p(f),K(null)},Xe=s=>{const t=ee(s);p({id:s.id,event_name:s.event_name??"",pool_length:t?String(t):"",time_seconds:s.time_seconds!=null?U(Number(s.time_seconds)):"",record_date:s.record_date?String(s.record_date).split("T")[0]:"",notes:s.notes??""}),K(s.id)},ie=()=>{if(!a.event_name.trim()){l({title:"Nom d'épreuve requis",variant:"destructive"});return}if(!a.pool_length){l({title:"Bassin requis",variant:"destructive"});return}const s=gs(a.time_seconds);if(s===null){l({title:"Temps invalide",description:"Ex: 1:02.34 ou 62.34",variant:"destructive"});return}X.mutate({id:a.id||null,athlete_id:r,athleteName:n,athlete_name:n,event_name:a.event_name,pool_length:parseInt(a.pool_length,10),time_seconds:s,record_date:a.record_date||null,notes:a.notes||null,record_type:i})},Ye=s=>{s.preventDefault(),ie()},ae=c.useMemo(()=>(re?.records??[]).filter(o=>{const d=ee(o);if(!d||d!==M)return!1;const m=String(o.record_type??"training");return i==="comp"?m==="comp":m==="training"}).sort((o,d)=>{const m=String(o.event_name??""),g=String(d.event_name??""),j=L=>String(L??"").toLowerCase().replace(/\./g,"").replace(/\s+/g," ").trim(),T=L=>{const x=j(L);return x.includes("nl")||x.includes("nage libre")?0:x.includes("dos")?1:x.includes("bra")||x.includes("brasse")?2:x.includes("pap")||x.includes("papillon")?3:x.includes("4n")||x.includes("4 n")||x.includes("4 nages")?4:99},P=L=>{const x=String(L??"").match(/^(\d+)/);return x?Number(x[1]):Number.POSITIVE_INFINITY},S=T(m),de=T(g);if(S!==de)return S-de;const ce=P(m),me=P(g);return ce!==me?ce-me:j(m).localeCompare(j(g),"fr")}),[re,M,i]),Ge=()=>{p({...f,pool_length:String(M)}),K("add")},Y=s=>{Ce(s),O()},Je=()=>{Fe(s=>s===25?50:25),O()},Ze=(s,t)=>{J(s),Z(t!=null&&Number(t)>0?String(t):"")},oe=()=>{J(null),Z("")},es=(s,t)=>{const o=Number(String(t??"").replace(",","."));if(!Number.isFinite(o)||o<=0){l({title:"Valeur invalide",description:"Entrez un nombre > 0",variant:"destructive"});return}ne.mutate({exercise_id:s,one_rm:o}),oe()},le=i==="training"?"grid-cols-[minmax(0,1fr)_4.75rem_4.75rem_2.5rem]":"grid-cols-[minmax(0,1fr)_4.75rem_3.75rem_4.75rem]";return k?e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg",children:[e.jsx("div",{className:"sticky top-0 z-20 scroll-mt-16 backdrop-blur bg-background/80 border-b border-border",children:e.jsxs("div",{className:"px-4 pt-4 pb-3",children:[e.jsx("div",{className:"text-xl font-semibold tracking-tight",children:"Records"}),e.jsx("div",{className:"mt-0.5 text-sm text-muted-foreground",children:"Natation & 1RM musculation"})]})}),e.jsx("div",{className:"px-2 sm:px-4 pt-3",children:e.jsxs(is,{value:F,onValueChange:s=>N(s),children:[e.jsxs(as,{className:"w-full rounded-3xl bg-muted/60 border border-border shadow-sm p-1.5 flex",children:[e.jsxs(he,{value:"swim","aria-label":"Records de natation",className:`flex-1 rounded-2xl px-4 py-2.5 text-sm font-semibold uppercase tracking-wide gap-2
                  data-[state=active]:bg-background data-[state=active]:text-foreground
                  data-[state=inactive]:text-muted-foreground`,children:[e.jsx(D,{className:"h-4 w-4"}),"Natation"]}),e.jsxs(he,{value:"1rm","aria-label":"Records de musculation",className:`flex-1 rounded-2xl px-4 py-2.5 text-sm font-semibold uppercase tracking-wide gap-2
                  data-[state=active]:bg-background data-[state=active]:text-foreground
                  data-[state=inactive]:text-muted-foreground`,children:[e.jsx(ue,{className:"h-4 w-4"}),"Musculation"]})]}),F==="swim"?e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"w-full rounded-2xl bg-muted/25 border border-border/60 p-1 flex",children:[e.jsxs("button",{type:"button",onClick:()=>Y("training"),className:z("flex-1 rounded-2xl px-3 py-2 text-sm max-[360px]:text-xs font-semibold transition inline-flex items-center justify-center gap-2 whitespace-nowrap",i==="training"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),"aria-pressed":i==="training",children:[e.jsx(xe,{className:"h-4 w-4 max-[360px]:hidden"}),"Entraînement"]}),e.jsxs("button",{type:"button",onClick:()=>Y("comp"),className:z("flex-1 rounded-2xl px-3 py-2 text-sm max-[360px]:text-xs font-semibold transition inline-flex items-center justify-center gap-2 whitespace-nowrap",i==="comp"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),"aria-pressed":i==="comp",children:[e.jsx(D,{className:"h-4 w-4 max-[360px]:hidden"}),"Compétition"]}),e.jsxs("button",{type:"button",onClick:()=>Y("history"),className:z("flex-1 rounded-2xl px-3 py-2 text-sm max-[360px]:text-xs font-semibold transition inline-flex items-center justify-center gap-2 whitespace-nowrap",i==="history"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),"aria-pressed":i==="history",children:[e.jsx(we,{className:"h-4 w-4 max-[360px]:hidden"}),"Historique"]})]})}):null,e.jsxs(fe,{value:"swim",className:"mt-0",children:[i!=="history"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-5 mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted/50 border border-border flex items-center justify-center",children:i==="training"?e.jsx(xe,{className:"h-5 w-5"}):e.jsx(D,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-sm font-semibold",children:[i==="training"?"Records entraînement":"Records compétition"," "]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:Je,className:"inline-flex items-center gap-2 whitespace-nowrap rounded-2xl bg-muted/25 border border-border/60 px-3 py-2 text-sm font-semibold active:scale-[0.99] transition cursor-pointer focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary","aria-label":"Changer le bassin",title:"Appuie pour basculer 25m / 50m",children:[e.jsx("span",{className:"inline-flex items-center justify-center h-6 w-6 rounded-xl bg-background/60 border border-border",children:e.jsx(D,{className:"h-4 w-4"})}),e.jsxs("span",{className:"tabular-nums",children:[M,"m"]})]}),i!=="comp"?e.jsx(C,{type:"button",size:"sm",onClick:Ge,className:"rounded-2xl",children:"Ajouter"}):null]})]}),i==="comp"?e.jsx("div",{className:"-mt-1 mb-2 text-xs text-muted-foreground",children:"Records fédération (lecture seule)."}):null,e.jsx($,{className:"w-full min-w-0 overflow-x-auto overflow-hidden rounded-2xl",children:e.jsx(q,{className:"p-0",children:Be?e.jsxs("div",{className:"p-4 grid gap-3",children:[e.jsx(b,{}),e.jsx(b,{}),e.jsx(b,{})]}):He?e.jsx("div",{className:"mx-4 my-4 rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:"Impossible de charger les records natation."}):ae.length===0?e.jsxs("div",{className:"px-4 py-6 text-sm text-muted-foreground",children:["Aucun record en bassin ",M,"m."]}):e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"px-3 sm:px-4 py-2 text-[11px] text-muted-foreground border-b border-border",children:e.jsxs("div",{className:z("grid items-center gap-2",le),children:[e.jsx("div",{className:"truncate justify-self-start",children:"Épreuve"}),e.jsx("div",{className:"whitespace-nowrap justify-self-end",children:"Temps"}),i==="comp"?e.jsx("div",{className:"whitespace-nowrap justify-self-end",children:"Pts"}):e.jsx("div",{className:"whitespace-nowrap justify-self-end",children:"Date"}),i==="comp"?e.jsx("div",{className:"whitespace-nowrap justify-self-end",children:"Date"}):e.jsx("div",{className:"sr-only",children:"Actions"})]})}),e.jsx("div",{className:"divide-y divide-border",children:ae.map(s=>{const t=G===s.id,o=U(s.time_seconds),d=W(s.record_date),m=(s.notes??"").trim(),g=s?.ffn_points??s?.ffnPoints??s?.points??s?.pts??null,j=g==null?NaN:Number(g),T=Number.isFinite(j)?j:js(s?.notes),P=(s?.meet??s?.meet_name??s?.meetName??s?.competition??"").trim?.()??"";return e.jsxs("div",{className:"px-3 sm:px-4 py-3",children:[e.jsxs("div",{className:z("grid items-center gap-2",le),children:[e.jsx("div",{className:"min-w-0 justify-self-start",children:e.jsx("div",{className:"text-sm font-semibold truncate",children:s.event_name})}),e.jsx("div",{className:"justify-self-end text-sm font-semibold tabular-nums whitespace-nowrap overflow-hidden font-mono",children:o}),i==="comp"?e.jsx("div",{className:"justify-self-end text-sm tabular-nums text-muted-foreground whitespace-nowrap overflow-hidden",children:T==null?"—":String(T)}):e.jsx("div",{className:"justify-self-end text-sm tabular-nums text-muted-foreground whitespace-nowrap overflow-hidden",children:d}),i==="comp"?e.jsx("div",{className:"justify-self-end text-sm tabular-nums text-muted-foreground whitespace-nowrap overflow-hidden",children:d}):e.jsx("button",{type:"button",onClick:()=>Xe(s),className:"justify-self-end inline-flex items-center justify-center h-9 w-9 rounded-xl bg-transparent text-muted-foreground hover:text-foreground hover:bg-muted/60 focus:outline-none focus:ring-2 focus:ring-ring/20","aria-label":`Modifier ${s.event_name}`,title:"Modifier",children:e.jsx(ye,{className:"h-4 w-4"})})]}),i==="comp"&&P?e.jsx("div",{className:"mt-1 text-xs text-muted-foreground truncate",children:P}):null,i==="training"&&m?e.jsx("div",{className:"mt-1 text-xs text-muted-foreground truncate",children:m}):null,i==="training"&&t?e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"rounded-2xl bg-muted/30 border border-border p-4 space-y-4",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{children:"Temps"}),e.jsx(E,{value:a.time_seconds,inputMode:"decimal",placeholder:"1:02.34",onChange:S=>p({...a,time_seconds:S.target.value}),className:"rounded-xl"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Format: mm:ss.cc ou secondes"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{children:"Date"}),e.jsx(E,{type:"date",value:a.record_date,onChange:S=>p({...a,record_date:S.target.value}),className:"rounded-xl"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{children:"Notes"}),e.jsx(pe,{value:a.notes,onChange:S=>p({...a,notes:S.target.value}),rows:2,className:"rounded-xl"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs(C,{type:"button",size:"sm",variant:"outline",onClick:O,className:"rounded-2xl gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),"Annuler"]}),e.jsxs(C,{type:"button",size:"sm",onClick:ie,disabled:X.isPending,className:"rounded-2xl gap-2",children:[e.jsx(_e,{className:"h-4 w-4"}),"Enregistrer"]})]})]})}):null]},s.id)})})]})})}),i==="training"&&G==="add"?e.jsx("div",{className:"px-4 mt-4",children:e.jsx("form",{onSubmit:Ye,children:e.jsxs("div",{className:"rounded-2xl border border-border p-4 space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{children:"Épreuve"}),e.jsx(E,{value:a.event_name,onChange:s=>p({...a,event_name:s.target.value}),placeholder:"Ex: 100 NL, 200 Dos",className:"rounded-xl"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{children:"Bassin (m)"}),e.jsxs(ge,{value:a.pool_length,onValueChange:s=>p({...a,pool_length:s}),children:[e.jsx(je,{className:"rounded-xl",children:e.jsx(ve,{placeholder:"Choisir"})}),e.jsxs(be,{children:[e.jsx(H,{value:"25",children:"25"}),e.jsx(H,{value:"50",children:"50"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{children:"Temps"}),e.jsx(E,{value:a.time_seconds,inputMode:"decimal",placeholder:"1:02.34",onChange:s=>p({...a,time_seconds:s.target.value}),className:"rounded-xl"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{children:"Date"}),e.jsx(E,{type:"date",value:a.record_date,onChange:s=>p({...a,record_date:s.target.value}),className:"rounded-xl"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{children:"Notes"}),e.jsx(pe,{value:a.notes,onChange:s=>p({...a,notes:s.target.value}),rows:3,className:"rounded-xl"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(C,{type:"button",variant:"outline",onClick:O,className:"rounded-2xl",children:"Annuler"}),e.jsx(C,{type:"submit",disabled:X.isPending,className:"rounded-2xl",children:"Ajouter"})]})]})})}):null]}):null,i==="history"?e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted/50 border border-border flex items-center justify-center",children:e.jsx(we,{className:"h-5 w-5"})}),e.jsx("div",{className:"text-sm font-semibold",children:"Historique FFN"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{type:"button",onClick:()=>Ee(s=>s===25?50:25),className:"inline-flex items-center gap-2 whitespace-nowrap rounded-2xl bg-muted/25 border border-border/60 px-3 py-2 text-sm font-semibold active:scale-[0.99] transition cursor-pointer focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary","aria-label":"Changer le bassin",children:[e.jsx("span",{className:"inline-flex items-center justify-center h-6 w-6 rounded-xl bg-background/60 border border-border",children:e.jsx(D,{className:"h-4 w-4"})}),e.jsxs("span",{className:"tabular-nums",children:[Q,"m"]})]})})]}),e.jsxs(C,{type:"button",onClick:()=>V.mutate(),disabled:V.isPending||!y,className:"w-full rounded-2xl gap-2",children:[V.isPending?e.jsx(Ne,{className:"h-4 w-4 animate-spin"}):e.jsx(fs,{className:"h-4 w-4"}),V.isPending?"Import en cours...":"Importer mes performances FFN"]}),y?null:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ajoutez votre IUF FFN dans votre profil pour importer vos performances."}),se.length>0?e.jsxs(ge,{value:w,onValueChange:s=>Me(s),children:[e.jsx(je,{className:"rounded-xl",children:e.jsx(ve,{placeholder:"Filtrer par épreuve"})}),e.jsxs(be,{children:[e.jsx(H,{value:"all",children:"Toutes les épreuves"}),se.map(s=>e.jsx(H,{value:s,children:s},s))]})]}):null,w!=="all"&&te.length>1?e.jsx($,{className:"rounded-2xl",children:e.jsxs(q,{className:"pt-4 pb-2 px-2",children:[e.jsxs("div",{className:"text-xs text-muted-foreground mb-2 px-2",children:["Progression : ",w," (",Q,"m)"]}),e.jsx(ls,{width:"100%",height:220,children:e.jsxs(ds,{data:te,margin:{top:5,right:10,left:0,bottom:5},children:[e.jsx(cs,{strokeDasharray:"3 3",className:"stroke-border"}),e.jsx(ms,{dataKey:"date",tick:{fontSize:10},className:"text-muted-foreground"}),e.jsx(us,{domain:["auto","auto"],tick:{fontSize:10},className:"text-muted-foreground",reversed:!0,tickFormatter:s=>{const t=Math.floor(s/60),o=Math.floor(s%60),d=Math.round(s%1*100);return t>0?`${t}:${String(o).padStart(2,"0")}`:`${o}.${String(d).padStart(2,"0")}`}}),e.jsx(xs,{formatter:s=>{const t=Math.floor(s/60),o=Math.floor(s%60),d=Math.round(s%1*100);return[t>0?`${t}:${String(o).padStart(2,"0")}.${String(d).padStart(2,"0")}`:`${o}.${String(d).padStart(2,"0")}`,"Temps"]},labelStyle:{fontSize:11},contentStyle:{borderRadius:12,fontSize:12}}),e.jsx(ps,{type:"monotone",dataKey:"time",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{r:3},activeDot:{r:5}})]})})]})}):null,e.jsx($,{className:"w-full min-w-0 overflow-hidden rounded-2xl",children:e.jsx(q,{className:"p-0",children:qe?e.jsxs("div",{className:"p-4 grid gap-3",children:[e.jsx(b,{}),e.jsx(b,{}),e.jsx(b,{})]}):De?e.jsx("div",{className:"mx-4 my-4 rounded-lg border border-destructive/20 bg-destructive/10 p-4 text-sm text-destructive",children:"Impossible de charger les performances."}):I.length===0?e.jsx("div",{className:"px-4 py-6 text-sm text-muted-foreground",children:y?'Aucune performance trouvée. Cliquez sur "Importer" pour récupérer vos données FFN.':"Ajoutez votre IUF FFN dans votre profil pour commencer."}):e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"px-3 sm:px-4 py-2 text-[11px] text-muted-foreground border-b border-border",children:e.jsxs("div",{className:"grid items-center gap-2 grid-cols-[minmax(0,1fr)_4.75rem_3.75rem_4.75rem]",children:[e.jsx("div",{className:"truncate justify-self-start",children:"Épreuve"}),e.jsx("div",{className:"whitespace-nowrap justify-self-end",children:"Temps"}),e.jsx("div",{className:"whitespace-nowrap justify-self-end",children:"Pts"}),e.jsx("div",{className:"whitespace-nowrap justify-self-end",children:"Date"})]})}),e.jsx("div",{className:"divide-y divide-border",children:I.map(s=>e.jsxs("div",{className:"px-3 sm:px-4 py-3",children:[e.jsxs("div",{className:"grid items-center gap-2 grid-cols-[minmax(0,1fr)_4.75rem_3.75rem_4.75rem]",children:[e.jsx("div",{className:"min-w-0 justify-self-start",children:e.jsx("div",{className:"text-sm font-semibold truncate",children:s.event_code})}),e.jsx("div",{className:"justify-self-end text-sm font-semibold tabular-nums whitespace-nowrap overflow-hidden font-mono",children:s.time_display??U(s.time_seconds)}),e.jsx("div",{className:"justify-self-end text-sm tabular-nums text-muted-foreground whitespace-nowrap overflow-hidden",children:s.ffn_points!=null?String(s.ffn_points):"—"}),e.jsx("div",{className:"justify-self-end text-sm tabular-nums text-muted-foreground whitespace-nowrap overflow-hidden",children:W(s.competition_date)})]}),s.competition_name?e.jsx("div",{className:"mt-1 text-xs text-muted-foreground truncate",children:s.competition_name}):null]},s.id))})]})})})]}):null,e.jsx("div",{className:"h-10"})]}),e.jsxs(fe,{value:"1rm",className:"mt-0",children:[e.jsx("div",{className:"mt-5 mb-2 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted/50 border border-border flex items-center justify-center",children:e.jsx(ue,{className:"h-5 w-5"})}),e.jsx("div",{className:"text-sm font-semibold",children:"1RM musculation"})]})}),e.jsx($,{className:"w-full min-w-0 overflow-x-auto overflow-hidden rounded-2xl",children:e.jsxs(q,{className:"p-0",children:[ze||Ve?e.jsxs("div",{className:"p-4 grid gap-3",children:[e.jsx(b,{}),e.jsx(b,{}),e.jsx(b,{})]}):Ke||Oe?e.jsx("div",{className:"p-4 text-sm text-muted-foreground",children:"Impossible de charger les records musculation."}):e.jsx("div",{className:"divide-y divide-border",children:Qe?.filter(s=>s.exercise_type!=="warmup").map(s=>{const t=Ae?.find(j=>j.exercise_id===s.id),o=Number(t?.weight??0),d=o>0?`${o} kg`:"—",m=t?.recorded_at??t?.date??null,g=ke===s.id;return e.jsxs("div",{className:"px-3 sm:px-4 py-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold truncate",children:s.nom_exercice}),e.jsx("div",{className:"mt-0.5 text-xs text-muted-foreground tabular-nums",children:W(m)})]}),e.jsxs("div",{className:"text-right shrink-0",children:[e.jsx("div",{className:"text-base font-semibold tabular-nums whitespace-nowrap font-mono",children:d}),g?null:e.jsxs("button",{type:"button",onClick:()=>Ze(s.id,t?.weight??null),className:"mt-1 inline-flex items-center gap-1 text-xs text-muted-foreground hover:text-foreground",children:[e.jsx(ye,{className:"h-3.5 w-3.5"}),"Modifier"]})]})]}),g?e.jsx("div",{className:"mt-3",children:e.jsx(vs,{value:Re,placeholder:"Ex: 100",inputMode:"decimal",hint:"Charge max (kg).",onCancel:oe,onSave:j=>es(s.id,j)})}):null]},s.id)})}),ne.isPending?e.jsxs("div",{className:"px-4 pb-4 text-xs text-muted-foreground flex items-center gap-2",children:[e.jsx(Ne,{className:"h-3 w-3 animate-spin"})," Mise à jour..."]}):null]})}),e.jsx("div",{className:"h-10"})]})]})}),e.jsx("div",{className:"pb-10"})]})}):e.jsx("div",{className:"min-h-[100dvh]",children:e.jsxs("div",{className:"mx-auto max-w-lg",children:[e.jsx("div",{className:"sticky top-0 z-20 scroll-mt-16 backdrop-blur bg-background/80 border-b border-border",children:e.jsxs("div",{className:"px-4 pt-4 pb-3",children:[e.jsx("div",{className:"text-xl font-semibold tracking-tight",children:"Records"}),e.jsx("div",{className:"mt-0.5 text-sm text-muted-foreground",children:"Natation & 1RM musculation"})]})}),e.jsx("div",{className:"px-4 pt-4 pb-10",children:e.jsx($,{className:"rounded-2xl",children:e.jsx(q,{className:"pt-6 text-sm text-muted-foreground",children:"Cette page est réservée aux nageurs."})})})]})})}export{Ds as default};
