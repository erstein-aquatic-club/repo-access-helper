import{R as d,T as Ts,L as Ds,G as Ms,H as As,J as Is,r as m,O as Os,j as e}from"./vendor-ui-C9ymspZo.js";import{b as $s,u as mt,d as Ps,c as at}from"./vendor-query-kM2vrB_e.js";import{h as kt,k as he,i as is,D as tt,B as F,C as Ye,b as _t,c as Lt,d as ls,f as Ct,L as it,o as Ls,X as Rt,p as Fs,u as Hs,I as Mt,g as Ce}from"./index-CMwkteNF.js";import{S as Ft,a as Ht,b as zt,c as Bt,d as zs}from"./sheet-vPilbQ6-.js";import{S as qt}from"./switch-rHLhurB6.js";import{S as Bs,a as qs,b as Vs,c as Us,d as yt}from"./select-DnkUOUCr.js";import{T as Ws,a as Ks,b as Qt,c as Yt}from"./tabs-g3XwtasH.js";import{B as gt}from"./badge-sCkYel0L.js";import{S as je}from"./skeleton-BPWQVQTV.js";import{L as Qs,A as Ys,a as Xs,b as Gs,c as Js,d as Zs,e as en,f as tn,g as sn,P as Xt}from"./alert-dialog-DGyPdOMM.js";import{S as nn}from"./sticky-note-awAaC82B.js";import{C as Gt}from"./check-BrYunlGc.js";import{T as rn}from"./timer-CIX_87Hk.js";import{C as Vt,I as an}from"./info-DcggkP4i.js";import{C as ln}from"./circle-alert-CxTvPpY0.js";import{S as on}from"./search-Dy7qrnyY.js";import{C as Jt}from"./chevron-left-CDvOfBB3.js";import{f as wt}from"./fr-CqUxEDd2.js";import{f as jt}from"./vendor-date-cQbdWov0.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-DSuxWnoS.js";import"./vendor-supabase-B2MyMyC0.js";import"./chevron-up-BonayVPE.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cn=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],dn=kt("calendar",cn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const un=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],mn=kt("circle-check",un);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fn=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],hn=kt("pause",fn);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pn=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],xn=kt("sliders-horizontal",pn);function gn(t){if(typeof document>"u")return;let n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",n.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}const os=d.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),vt=()=>{const t=d.useContext(os);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};gn(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}`);function vn(){const t=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(t)&&/Mobile/.test(t)||/FxiOS/.test(t))}function bn(){return Kt(/^Mac/)}function yn(){return Kt(/^iPhone/)}function Zt(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function wn(){return Kt(/^iPad/)||bn()&&navigator.maxTouchPoints>1}function cs(){return yn()||wn()}function Kt(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const jn=24,Nn=typeof window<"u"?m.useLayoutEffect:m.useEffect;function es(...t){return(...n)=>{for(let r of t)typeof r=="function"&&r(...n)}}const At=typeof document<"u"&&window.visualViewport;function ts(t){let n=window.getComputedStyle(t);return/(auto|scroll)/.test(n.overflow+n.overflowX+n.overflowY)}function ds(t){for(ts(t)&&(t=t.parentElement);t&&!ts(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const Sn=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let Nt=0,It;function _n(t={}){let{isDisabled:n}=t;Nn(()=>{if(!n)return Nt++,Nt===1&&cs()&&(It=Cn()),()=>{Nt--,Nt===0&&It?.()}},[n])}function Cn(){let t,n=0,r=S=>{t=ds(S.target),!(t===document.documentElement&&t===document.body)&&(n=S.changedTouches[0].pageY)},i=S=>{if(!t||t===document.documentElement||t===document.body){S.preventDefault();return}let b=S.changedTouches[0].pageY,H=t.scrollTop,W=t.scrollHeight-t.clientHeight;W!==0&&((H<=0&&b>n||H>=W&&b<n)&&S.preventDefault(),n=b)},o=S=>{let b=S.target;Ut(b)&&b!==document.activeElement&&(S.preventDefault(),b.style.transform="translateY(-2000px)",b.focus(),requestAnimationFrame(()=>{b.style.transform=""}))},l=S=>{let b=S.target;Ut(b)&&(b.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{b.style.transform="",At&&(At.height<window.innerHeight?requestAnimationFrame(()=>{ss(b)}):At.addEventListener("resize",()=>ss(b),{once:!0}))}))},h=()=>{window.scrollTo(0,0)},p=window.pageXOffset,u=window.pageYOffset,T=es(Rn(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let x=es(ft(document,"touchstart",r,{passive:!1,capture:!0}),ft(document,"touchmove",i,{passive:!1,capture:!0}),ft(document,"touchend",o,{passive:!1,capture:!0}),ft(document,"focus",l,!0),ft(window,"scroll",h));return()=>{T(),x(),window.scrollTo(p,u)}}function Rn(t,n,r){let i=t.style[n];return t.style[n]=r,()=>{t.style[n]=i}}function ft(t,n,r,i){return t.addEventListener(n,r,i),()=>{t.removeEventListener(n,r,i)}}function ss(t){let n=document.scrollingElement||document.documentElement;for(;t&&t!==n;){let r=ds(t);if(r!==document.documentElement&&r!==document.body&&r!==t){let i=r.getBoundingClientRect().top,o=t.getBoundingClientRect().top,l=t.getBoundingClientRect().bottom;const h=r.getBoundingClientRect().bottom+jn;l>h&&(r.scrollTop+=o-i)}t=r.parentElement}}function Ut(t){return t instanceof HTMLInputElement&&!Sn.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function En(t,n){typeof t=="function"?t(n):t!=null&&(t.current=n)}function kn(...t){return n=>t.forEach(r=>En(r,n))}function us(...t){return m.useCallback(kn(...t),t)}const ms=new WeakMap;function re(t,n,r=!1){if(!t||!(t instanceof HTMLElement))return;let i={};Object.entries(n).forEach(([o,l])=>{if(o.startsWith("--")){t.style.setProperty(o,l);return}i[o]=t.style[o],t.style[o]=l}),!r&&ms.set(t,i)}function Tn(t,n){if(!t||!(t instanceof HTMLElement))return;let r=ms.get(t);r&&(t.style[n]=r[n])}const se=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function St(t,n){if(!t)return null;const r=window.getComputedStyle(t),i=r.transform||r.webkitTransform||r.mozTransform;let o=i.match(/^matrix3d\((.+)\)$/);return o?parseFloat(o[1].split(", ")[se(n)?13:12]):(o=i.match(/^matrix\((.+)\)$/),o?parseFloat(o[1].split(", ")[se(n)?5:4]):null)}function Dn(t){return 8*(Math.log(t+1)-2)}function Ot(t,n){if(!t)return()=>{};const r=t.style.cssText;return Object.assign(t.style,n),()=>{t.style.cssText=r}}function Mn(...t){return(...n)=>{for(const r of t)typeof r=="function"&&r(...n)}}const G={DURATION:.5,EASE:[.32,.72,0,1]},fs=.4,An=.25,In=100,hs=8,Ze=16,Wt=26,$t="vaul-dragging";function ps(t){const n=d.useRef(t);return d.useEffect(()=>{n.current=t}),d.useMemo(()=>(...r)=>n.current==null?void 0:n.current.call(n,...r),[])}function On({defaultProp:t,onChange:n}){const r=d.useState(t),[i]=r,o=d.useRef(i),l=ps(n);return d.useEffect(()=>{o.current!==i&&(l(i),o.current=i)},[i,o,l]),r}function xs({prop:t,defaultProp:n,onChange:r=()=>{}}){const[i,o]=On({defaultProp:n,onChange:r}),l=t!==void 0,h=l?t:i,p=ps(r),u=d.useCallback(T=>{if(l){const S=typeof T=="function"?T(t):T;S!==t&&p(S)}else o(T)},[l,t,o,p]);return[h,u]}function $n({activeSnapPointProp:t,setActiveSnapPointProp:n,snapPoints:r,drawerRef:i,overlayRef:o,fadeFromIndex:l,onSnapPointChange:h,direction:p="bottom",container:u,snapToSequentialPoint:T}){const[x,S]=xs({prop:t,defaultProp:r?.[0],onChange:n}),[b,H]=d.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);d.useEffect(()=>{function N(){H({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",N),()=>window.removeEventListener("resize",N)},[]);const W=d.useMemo(()=>x===r?.[r.length-1]||null,[r,x]),D=d.useMemo(()=>{var N;return(N=r?.findIndex(M=>M===x))!=null?N:null},[r,x]),J=r&&r.length>0&&(l||l===0)&&!Number.isNaN(l)&&r[l]===x||!r,y=d.useMemo(()=>{const N=u?{width:u.getBoundingClientRect().width,height:u.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var M;return(M=r?.map(I=>{const $=typeof I=="string";let te=0;if($&&(te=parseInt(I,10)),se(p)){const f=$?te:b?I*N.height:0;return b?p==="bottom"?N.height-f:-N.height+f:f}const V=$?te:b?I*N.width:0;return b?p==="right"?N.width-V:-N.width+V:V}))!=null?M:[]},[r,b,u]),R=d.useMemo(()=>D!==null?y?.[D]:null,[y,D]),O=d.useCallback(N=>{var M;const I=(M=y?.findIndex($=>$===N))!=null?M:null;h(I),re(i.current,{transition:`transform ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`,transform:se(p)?`translate3d(0, ${N}px, 0)`:`translate3d(${N}px, 0, 0)`}),y&&I!==y.length-1&&l!==void 0&&I!==l&&I<l?re(o.current,{transition:`opacity ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`,opacity:"0"}):re(o.current,{transition:`opacity ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`,opacity:"1"}),S(r?.[Math.max(I,0)])},[i.current,r,y,l,o,S]);d.useEffect(()=>{if(x||t){var N;const M=(N=r?.findIndex(I=>I===t||I===x))!=null?N:-1;y&&M!==-1&&typeof y[M]=="number"&&O(y[M])}},[x,t,r,y,O]);function w({draggedDistance:N,closeDrawer:M,velocity:I,dismissible:$}){if(l===void 0)return;const te=p==="bottom"||p==="right"?(R??0)-N:(R??0)+N,V=D===l-1,f=D===0,K=N>0;if(V&&re(o.current,{transition:`opacity ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`}),!T&&I>2&&!K){$?M():O(y[0]);return}if(!T&&I>2&&K&&y&&r){O(y[r.length-1]);return}const Y=y?.reduce((U,X)=>typeof U!="number"||typeof X!="number"?U:Math.abs(X-te)<Math.abs(U-te)?X:U),Z=se(p)?window.innerHeight:window.innerWidth;if(I>fs&&Math.abs(N)<Z*.4){const U=K?1:-1;if(U>0&&W&&r){O(y[r.length-1]);return}if(f&&U<0&&$&&M(),D===null)return;O(y[D+U]);return}O(Y)}function ne({draggedDistance:N}){if(R===null)return;const M=p==="bottom"||p==="right"?R-N:R+N;(p==="bottom"||p==="right")&&M<y[y.length-1]||(p==="top"||p==="left")&&M>y[y.length-1]||re(i.current,{transform:se(p)?`translate3d(0, ${M}px, 0)`:`translate3d(${M}px, 0, 0)`})}function me(N,M){if(!r||typeof D!="number"||!y||l===void 0)return null;const I=D===l-1;if(D>=l&&M)return 0;if(I&&!M)return 1;if(!J&&!I)return null;const te=I?D+1:D-1,V=I?y[te]-y[te-1]:y[te+1]-y[te],f=N/Math.abs(V);return I?1-f:f}return{isLastSnapPoint:W,activeSnapPoint:x,shouldFade:J,getPercentageDragged:me,setActiveSnapPoint:S,activeSnapPointIndex:D,onRelease:w,onDrag:ne,snapPointsOffset:y}}const Pn=()=>()=>{};function Ln(){const{direction:t,isOpen:n,shouldScaleBackground:r,setBackgroundColorOnScale:i,noBodyStyles:o}=vt(),l=d.useRef(null),h=m.useMemo(()=>document.body.style.backgroundColor,[]);function p(){return(window.innerWidth-Wt)/window.innerWidth}d.useEffect(()=>{if(n&&r){l.current&&clearTimeout(l.current);const u=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!u)return;Mn(i&&!o?Ot(document.body,{background:"black"}):Pn,Ot(u,{transformOrigin:se(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${G.DURATION}s`,transitionTimingFunction:`cubic-bezier(${G.EASE.join(",")})`}));const T=Ot(u,{borderRadius:`${hs}px`,overflow:"hidden",...se(t)?{transform:`scale(${p()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${p()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{T(),l.current=window.setTimeout(()=>{h?document.body.style.background=h:document.body.style.removeProperty("background")},G.DURATION*1e3)}}},[n,r,h])}let ht=null;function Fn({isOpen:t,modal:n,nested:r,hasBeenOpened:i,preventScrollRestoration:o,noBodyStyles:l}){const[h,p]=d.useState(()=>typeof window<"u"?window.location.href:""),u=d.useRef(0),T=d.useCallback(()=>{if(Zt()&&ht===null&&t&&!l){ht={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:S,innerHeight:b}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-u.current}px`,left:`${-S}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const H=b-window.innerHeight;H&&u.current>=b&&(document.body.style.top=`${-(u.current+H)}px`)}),300)}},[t]),x=d.useCallback(()=>{if(Zt()&&ht!==null&&!l){const S=-parseInt(document.body.style.top,10),b=-parseInt(document.body.style.left,10);Object.assign(document.body.style,ht),window.requestAnimationFrame(()=>{if(o&&h!==window.location.href){p(window.location.href);return}window.scrollTo(b,S)}),ht=null}},[h]);return d.useEffect(()=>{function S(){u.current=window.scrollY}return S(),window.addEventListener("scroll",S),()=>{window.removeEventListener("scroll",S)}},[]),d.useEffect(()=>{if(n)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||x()}},[n,x]),d.useEffect(()=>{r||!i||(t?(!window.matchMedia("(display-mode: standalone)").matches&&T(),n||window.setTimeout(()=>{x()},500)):x())},[t,i,h,n,r,T,x]),{restorePositionSetting:x}}function Hn({open:t,onOpenChange:n,children:r,onDrag:i,onRelease:o,snapPoints:l,shouldScaleBackground:h=!1,setBackgroundColorOnScale:p=!0,closeThreshold:u=An,scrollLockTimeout:T=In,dismissible:x=!0,handleOnly:S=!1,fadeFromIndex:b=l&&l.length-1,activeSnapPoint:H,setActiveSnapPoint:W,fixed:D,modal:J=!0,onClose:y,nested:R,noBodyStyles:O=!1,direction:w="bottom",defaultOpen:ne=!1,disablePreventScroll:me=!0,snapToSequentialPoint:N=!1,preventScrollRestoration:M=!1,repositionInputs:I=!0,onAnimationEnd:$,container:te,autoFocus:V=!1}){var f,K;const[Y=!1,Z]=xs({defaultProp:ne,prop:t,onChange:g=>{n?.(g),!g&&!R&&lt(),setTimeout(()=>{$?.(g)},G.DURATION*1e3),g&&!J&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),g||(document.body.style.pointerEvents="auto")}}),[U,X]=d.useState(!1),[ie,Re]=d.useState(!1),[le,De]=d.useState(!1),pe=d.useRef(null),Ee=d.useRef(null),Ve=d.useRef(null),Ue=d.useRef(null),Me=d.useRef(null),$e=d.useRef(!1),B=d.useRef(null),Ne=d.useRef(0),Ae=d.useRef(!1),Xe=d.useRef(!ne),ke=d.useRef(0),_=d.useRef(null),xe=d.useRef(((f=_.current)==null?void 0:f.getBoundingClientRect().height)||0),We=d.useRef(((K=_.current)==null?void 0:K.getBoundingClientRect().width)||0),be=d.useRef(0),Se=d.useCallback(g=>{l&&g===Le.length-1&&(Ee.current=new Date)},[]),{activeSnapPoint:Ke,activeSnapPointIndex:ge,setActiveSnapPoint:_e,onRelease:Pe,snapPointsOffset:Le,onDrag:ee,shouldFade:Fe,getPercentageDragged:Ge}=$n({snapPoints:l,activeSnapPointProp:H,setActiveSnapPointProp:W,drawerRef:_,fadeFromIndex:b,overlayRef:pe,onSnapPointChange:Se,direction:w,container:te,snapToSequentialPoint:N});_n({isDisabled:!Y||ie||!J||le||!U||!I||!me});const{restorePositionSetting:lt}=Fn({isOpen:Y,modal:J,nested:R??!1,hasBeenOpened:U,preventScrollRestoration:M,noBodyStyles:O});function Ie(){return(window.innerWidth-Wt)/window.innerWidth}function st(g){var A,P;!x&&!l||_.current&&!_.current.contains(g.target)||(xe.current=((A=_.current)==null?void 0:A.getBoundingClientRect().height)||0,We.current=((P=_.current)==null?void 0:P.getBoundingClientRect().width)||0,Re(!0),Ve.current=new Date,cs()&&window.addEventListener("touchend",()=>$e.current=!1,{once:!0}),g.target.setPointerCapture(g.pointerId),Ne.current=se(w)?g.pageY:g.pageX)}function Je(g,A){var P;let E=g;const k=(P=window.getSelection())==null?void 0:P.toString(),z=_.current?St(_.current,w):null,Q=new Date;if(E.tagName==="SELECT"||E.hasAttribute("data-vaul-no-drag")||E.closest("[data-vaul-no-drag]"))return!1;if(w==="right"||w==="left")return!0;if(Ee.current&&Q.getTime()-Ee.current.getTime()<500)return!1;if(z!==null&&(w==="bottom"?z>0:z<0))return!0;if(k&&k.length>0)return!1;if(Me.current&&Q.getTime()-Me.current.getTime()<T&&z===0||A)return Me.current=Q,!1;for(;E;){if(E.scrollHeight>E.clientHeight){if(E.scrollTop!==0)return Me.current=new Date,!1;if(E.getAttribute("role")==="dialog")return!0}E=E.parentNode}return!0}function oe(g){if(_.current&&ie){const A=w==="bottom"||w==="right"?1:-1,P=(Ne.current-(se(w)?g.pageY:g.pageX))*A,E=P>0,k=l&&!x&&!E;if(k&&ge===0)return;const z=Math.abs(P),Q=document.querySelector("[data-vaul-drawer-wrapper]"),ye=w==="bottom"||w==="top"?xe.current:We.current;let ue=z/ye;const ve=Ge(z,E);if(ve!==null&&(ue=ve),k&&ue>=1||!$e.current&&!Je(g.target,E))return;if(_.current.classList.add($t),$e.current=!0,re(_.current,{transition:"none"}),re(pe.current,{transition:"none"}),l&&ee({draggedDistance:P}),E&&!l){const s=Dn(P),c=Math.min(s*-1,0)*A;re(_.current,{transform:se(w)?`translate3d(0, ${c}px, 0)`:`translate3d(${c}px, 0, 0)`});return}const Te=1-ue;if((Fe||b&&ge===b-1)&&(i?.(g,ue),re(pe.current,{opacity:`${Te}`,transition:"none"},!0)),Q&&pe.current&&h){const s=Math.min(Ie()+ue*(1-Ie()),1),c=8-ue*8,L=Math.max(0,14-ue*14);re(Q,{borderRadius:`${c}px`,transform:se(w)?`scale(${s}) translate3d(0, ${L}px, 0)`:`scale(${s}) translate3d(${L}px, 0, 0)`,transition:"none"},!0)}if(!l){const s=z*A;re(_.current,{transform:se(w)?`translate3d(0, ${s}px, 0)`:`translate3d(${s}px, 0, 0)`})}}}d.useEffect(()=>{window.requestAnimationFrame(()=>{Xe.current=!0})},[]),d.useEffect(()=>{var g;function A(){if(!_.current||!I)return;const P=document.activeElement;if(Ut(P)||Ae.current){var E;const k=((E=window.visualViewport)==null?void 0:E.height)||0,z=window.innerHeight;let Q=z-k;const ye=_.current.getBoundingClientRect().height||0,ue=ye>z*.8;be.current||(be.current=ye);const ve=_.current.getBoundingClientRect().top;if(Math.abs(ke.current-Q)>60&&(Ae.current=!Ae.current),l&&l.length>0&&Le&&ge){const Te=Le[ge]||0;Q+=Te}if(ke.current=Q,ye>k||Ae.current){const Te=_.current.getBoundingClientRect().height;let s=Te;Te>k&&(s=k-(ue?ve:Wt)),D?_.current.style.height=`${Te-Math.max(Q,0)}px`:_.current.style.height=`${Math.max(s,k-ve)}px`}else vn()||(_.current.style.height=`${be.current}px`);l&&l.length>0&&!Ae.current?_.current.style.bottom="0px":_.current.style.bottom=`${Math.max(Q,0)}px`}}return(g=window.visualViewport)==null||g.addEventListener("resize",A),()=>{var P;return(P=window.visualViewport)==null?void 0:P.removeEventListener("resize",A)}},[ge,l,Le]);function Oe(g){ae(),y?.(),g||Z(!1),setTimeout(()=>{l&&_e(l[0])},G.DURATION*1e3)}function j(){if(!_.current)return;const g=document.querySelector("[data-vaul-drawer-wrapper]"),A=St(_.current,w);re(_.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`}),re(pe.current,{transition:`opacity ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`,opacity:"1"}),h&&A&&A>0&&Y&&re(g,{borderRadius:`${hs}px`,overflow:"hidden",...se(w)?{transform:`scale(${Ie()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Ie()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${G.DURATION}s`,transitionTimingFunction:`cubic-bezier(${G.EASE.join(",")})`},!0)}function ae(){!ie||!_.current||(_.current.classList.remove($t),$e.current=!1,Re(!1),Ue.current=new Date)}function nt(g){if(!ie||!_.current)return;_.current.classList.remove($t),$e.current=!1,Re(!1),Ue.current=new Date;const A=St(_.current,w);if(!g||!Je(g.target,!1)||!A||Number.isNaN(A)||Ve.current===null)return;const P=Ue.current.getTime()-Ve.current.getTime(),E=Ne.current-(se(w)?g.pageY:g.pageX),k=Math.abs(E)/P;if(k>.05&&(De(!0),setTimeout(()=>{De(!1)},200)),l){Pe({draggedDistance:E*(w==="bottom"||w==="right"?1:-1),closeDrawer:Oe,velocity:k,dismissible:x}),o?.(g,!0);return}if(w==="bottom"||w==="right"?E>0:E<0){j(),o?.(g,!0);return}if(k>fs){Oe(),o?.(g,!1);return}var z;const Q=Math.min((z=_.current.getBoundingClientRect().height)!=null?z:0,window.innerHeight);var ye;const ue=Math.min((ye=_.current.getBoundingClientRect().width)!=null?ye:0,window.innerWidth),ve=w==="left"||w==="right";if(Math.abs(A)>=(ve?ue:Q)*u){Oe(),o?.(g,!1);return}o?.(g,!0),j()}d.useEffect(()=>(Y&&(re(document.documentElement,{scrollBehavior:"auto"}),Ee.current=new Date),()=>{Tn(document.documentElement,"scrollBehavior")}),[Y]);function ot(g){const A=g?(window.innerWidth-Ze)/window.innerWidth:1,P=g?-Ze:0;B.current&&window.clearTimeout(B.current),re(_.current,{transition:`transform ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`,transform:se(w)?`scale(${A}) translate3d(0, ${P}px, 0)`:`scale(${A}) translate3d(${P}px, 0, 0)`}),!g&&_.current&&(B.current=setTimeout(()=>{const E=St(_.current,w);re(_.current,{transition:"none",transform:se(w)?`translate3d(0, ${E}px, 0)`:`translate3d(${E}px, 0, 0)`})},500))}function Qe(g,A){if(A<0)return;const P=(window.innerWidth-Ze)/window.innerWidth,E=P+A*(1-P),k=-Ze+A*Ze;re(_.current,{transform:se(w)?`scale(${E}) translate3d(0, ${k}px, 0)`:`scale(${E}) translate3d(${k}px, 0, 0)`,transition:"none"})}function de(g,A){const P=se(w)?window.innerHeight:window.innerWidth,E=A?(P-Ze)/P:1,k=A?-Ze:0;A&&re(_.current,{transition:`transform ${G.DURATION}s cubic-bezier(${G.EASE.join(",")})`,transform:se(w)?`scale(${E}) translate3d(0, ${k}px, 0)`:`scale(${E}) translate3d(${k}px, 0, 0)`})}return d.useEffect(()=>{J||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[J]),d.createElement(Ms,{defaultOpen:ne,onOpenChange:g=>{!x&&!g||(g?X(!0):Oe(!0),Z(g))},open:Y},d.createElement(os.Provider,{value:{activeSnapPoint:Ke,snapPoints:l,setActiveSnapPoint:_e,drawerRef:_,overlayRef:pe,onOpenChange:n,onPress:st,onRelease:nt,onDrag:oe,dismissible:x,shouldAnimate:Xe,handleOnly:S,isOpen:Y,isDragging:ie,shouldFade:Fe,closeDrawer:Oe,onNestedDrag:Qe,onNestedOpenChange:ot,onNestedRelease:de,keyboardIsOpen:Ae,modal:J,snapPointsOffset:Le,activeSnapPointIndex:ge,direction:w,shouldScaleBackground:h,setBackgroundColorOnScale:p,noBodyStyles:O,container:te,autoFocus:V}},r))}const gs=d.forwardRef(function({...t},n){const{overlayRef:r,snapPoints:i,onRelease:o,shouldFade:l,isOpen:h,modal:p,shouldAnimate:u}=vt(),T=us(n,r),x=i&&i.length>0;if(!p)return null;const S=d.useCallback(b=>o(b),[o]);return d.createElement(Os,{onMouseUp:S,ref:T,"data-vaul-overlay":"","data-vaul-snap-points":h&&x?"true":"false","data-vaul-snap-points-overlay":h&&l?"true":"false","data-vaul-animate":u?.current?"true":"false",...t})});gs.displayName="Drawer.Overlay";const vs=d.forwardRef(function({onPointerDownOutside:t,style:n,onOpenAutoFocus:r,...i},o){const{drawerRef:l,onPress:h,onRelease:p,onDrag:u,keyboardIsOpen:T,snapPointsOffset:x,activeSnapPointIndex:S,modal:b,isOpen:H,direction:W,snapPoints:D,container:J,handleOnly:y,shouldAnimate:R,autoFocus:O}=vt(),[w,ne]=d.useState(!1),me=us(o,l),N=d.useRef(null),M=d.useRef(null),I=d.useRef(!1),$=D&&D.length>0;Ln();const te=(f,K,Y=0)=>{if(I.current)return!0;const Z=Math.abs(f.y),U=Math.abs(f.x),X=U>Z,ie=["bottom","right"].includes(K)?1:-1;if(K==="left"||K==="right"){if(!(f.x*ie<0)&&U>=0&&U<=Y)return X}else if(!(f.y*ie<0)&&Z>=0&&Z<=Y)return!X;return I.current=!0,!0};d.useEffect(()=>{$&&window.requestAnimationFrame(()=>{ne(!0)})},[]);function V(f){N.current=null,I.current=!1,p(f)}return d.createElement(Is,{"data-vaul-drawer-direction":W,"data-vaul-drawer":"","data-vaul-delayed-snap-points":w?"true":"false","data-vaul-snap-points":H&&$?"true":"false","data-vaul-custom-container":J?"true":"false","data-vaul-animate":R?.current?"true":"false",...i,ref:me,style:x&&x.length>0?{"--snap-point-height":`${x[S??0]}px`,...n}:n,onPointerDown:f=>{y||(i.onPointerDown==null||i.onPointerDown.call(i,f),N.current={x:f.pageX,y:f.pageY},h(f))},onOpenAutoFocus:f=>{r?.(f),O||f.preventDefault()},onPointerDownOutside:f=>{if(t?.(f),!b||f.defaultPrevented){f.preventDefault();return}T.current&&(T.current=!1)},onFocusOutside:f=>{if(!b){f.preventDefault();return}},onPointerMove:f=>{if(M.current=f,y||(i.onPointerMove==null||i.onPointerMove.call(i,f),!N.current))return;const K=f.pageY-N.current.y,Y=f.pageX-N.current.x,Z=f.pointerType==="touch"?10:2;te({x:Y,y:K},W,Z)?u(f):(Math.abs(Y)>Z||Math.abs(K)>Z)&&(N.current=null)},onPointerUp:f=>{i.onPointerUp==null||i.onPointerUp.call(i,f),N.current=null,I.current=!1,p(f)},onPointerOut:f=>{i.onPointerOut==null||i.onPointerOut.call(i,f),V(M.current)},onContextMenu:f=>{i.onContextMenu==null||i.onContextMenu.call(i,f),M.current&&V(M.current)}})});vs.displayName="Drawer.Content";const zn=250,Bn=120,qn=d.forwardRef(function({preventCycle:t=!1,children:n,...r},i){const{closeDrawer:o,isDragging:l,snapPoints:h,activeSnapPoint:p,setActiveSnapPoint:u,dismissible:T,handleOnly:x,isOpen:S,onPress:b,onDrag:H}=vt(),W=d.useRef(null),D=d.useRef(!1);function J(){if(D.current){O();return}window.setTimeout(()=>{y()},Bn)}function y(){if(l||t||D.current){O();return}if(O(),!h||h.length===0){T||o();return}if(p===h[h.length-1]&&T){o();return}const ne=h.findIndex(N=>N===p);if(ne===-1)return;const me=h[ne+1];u(me)}function R(){W.current=window.setTimeout(()=>{D.current=!0},zn)}function O(){W.current&&window.clearTimeout(W.current),D.current=!1}return d.createElement("div",{onClick:J,onPointerCancel:O,onPointerDown:w=>{x&&b(w),R()},onPointerMove:w=>{x&&H(w)},ref:i,"data-vaul-drawer-visible":S?"true":"false","data-vaul-handle":"","aria-hidden":"true",...r},d.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},n))});qn.displayName="Drawer.Handle";function Vn(t){const n=vt(),{container:r=n.container,...i}=t;return d.createElement(As,{container:r,...i})}const qe={Root:Hn,Content:vs,Overlay:gs,Portal:Vn,Title:Ts,Description:Ds},bs=({shouldScaleBackground:t=!0,...n})=>e.jsx(qe.Root,{shouldScaleBackground:t,...n});bs.displayName="Drawer";const Un=qe.Portal,ys=m.forwardRef(({className:t,...n},r)=>e.jsx(qe.Overlay,{ref:r,className:he("fixed inset-0 z-50 bg-black/80",t),...n}));ys.displayName=qe.Overlay.displayName;const ws=m.forwardRef(({className:t,children:n,...r},i)=>e.jsxs(Un,{children:[e.jsx(ys,{}),e.jsxs(qe.Content,{ref:i,className:he("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",t),...r,children:[e.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),n]})]}));ws.displayName="DrawerContent";const js=({className:t,...n})=>e.jsx("div",{className:he("grid gap-1.5 p-4 text-center sm:text-left",t),...n});js.displayName="DrawerHeader";const Ns=m.forwardRef(({className:t,...n},r)=>e.jsx(qe.Title,{ref:r,className:he("text-lg font-semibold leading-none tracking-tight",t),...n}));Ns.displayName=qe.Title.displayName;const Ss=m.forwardRef(({className:t,...n},r)=>e.jsx(qe.Description,{ref:r,className:he("text-sm text-muted-foreground",t),...n}));Ss.displayName=qe.Description.displayName;function _s({children:t,className:n,containerClassName:r}){return e.jsx("div",{role:"region","aria-label":"Actions",className:he("fixed bottom-16 left-0 right-0 z-bar md:bottom-0 md:z-bar",n),children:e.jsx("div",{className:he("mx-auto flex w-full max-w-md items-center justify-between gap-2 border-t bg-background px-4 py-3 shadow-[0_-2px_10px_rgba(0,0,0,0.1)]","md:supports-[padding:env(safe-area-inset-bottom)]:pb-[calc(env(safe-area-inset-bottom)+0.75rem)]",r),children:t})})}const Wn=[1,2,3,4,5];function ns({value:t,onChange:n,className:r,disabled:i=!1,size:o="md",ariaLabel:l="Sélecteur d'échelle 1 à 5"}){const h=o==="sm"?"h-10 w-10 text-xs":"h-11 w-11 text-sm";return e.jsx("div",{className:he("flex items-center gap-2",r),role:"group","aria-label":l,children:Wn.map(p=>{const u=t===p;return e.jsx("button",{type:"button",className:he("flex items-center justify-center rounded-full border font-semibold transition",h,u?"border-primary bg-primary text-primary-foreground":"border-muted-foreground/30 bg-background text-foreground",i&&"opacity-60"),"aria-pressed":u,disabled:i,onClick:()=>{i||n?.(p)},children:p},p)})})}const rs=()=>{try{const t=new(window.AudioContext||window.webkitAudioContext),n=t.createOscillator(),r=t.createGain();n.connect(r),r.connect(t.destination),n.frequency.value=880,r.gain.value=.3,n.start(),n.stop(t.currentTime+.25);const i=t.createOscillator(),o=t.createGain();i.connect(o),o.connect(t.destination),i.frequency.value=1100,o.gain.value=.3,i.start(t.currentTime+.35),i.stop(t.currentTime+.6),i.onended=()=>t.close()}catch{}try{navigator.vibrate?.([200,100,200])}catch{}},Et=(t,n)=>{const r=Number(t?.set_index??t?.set_number??t?.setIndex??n);return!Number.isFinite(r)||r<=0?n:r},Cs=(t=[],n,r)=>{if(!t.length)return 0;const i=Array.isArray(n)?n:[];if(i.length>0){const h=new Map;i.forEach((u,T)=>{if(!u?.exercise_id)return;const x=h.get(u.exercise_id)??[];x.push({...u,set_index:Et(u,T+1)}),h.set(u.exercise_id,x)});let p=t.length+1;for(let u=0;u<t.length;u+=1){const T=t[u];if((h.get(T.exercise_id)??[]).length<(T.sets??0)){p=u+1;break}}return p}const o=Number(r??0);if(!Number.isFinite(o)||o<=0)return 0;const l=Math.min(t.length,Math.max(0,Math.round(o/100*t.length)));return Math.min(t.length,l+1)},Be=(t,n)=>{const r=Number(t);return!Number.isFinite(r)||r<=0?"—":n?`${r}${n}`:String(r)};function Kn({session:t,exercises:n,oneRMs:r,onFinish:i,onStart:o,onLogSets:l,onProgress:h,initialLogs:p,isFinishing:u,initialStep:T,onStepChange:x,initialInputOpen:S,initialSeriesOpen:b,onExitFocus:H,exerciseNotes:W,onUpdateNote:D}){const{toast:J}=is(),y=m.useRef(!1),[R,O]=m.useState(T??0),[w,ne]=m.useState([]),[me,N]=m.useState(0),[M,I]=m.useState(!0),$=m.useRef(Date.now()),te=m.useRef(0),[V,f]=m.useState(0),[K,Y]=m.useState(!1),[Z,U]=m.useState(!1),X=m.useRef(0),[ie,Re]=m.useState(!0),[le,De]=m.useState(3),[pe,Ee]=m.useState(3),[Ve,Ue]=m.useState(""),[Me,$e]=m.useState(!1),[B,Ne]=m.useState(1),[Ae,Xe]=m.useState(b??!1),[ke,_]=m.useState(S??!1),[xe,We]=m.useState("weight"),[be,Se]=m.useState(""),[Ke,ge]=m.useState(!1),[_e,Pe]=m.useState(!1),[Le,ee]=m.useState(!1),[Fe,Ge]=m.useState(!1),[lt,Ie]=m.useState(!1),[st,Je]=m.useState("");m.useEffect(()=>{if(!M)return;const a=()=>{N(Math.floor((Date.now()-$.current)/1e3)+te.current)};a();const v=setInterval(a,1e3),q=()=>{document.visibilityState==="visible"&&a()};return document.addEventListener("visibilitychange",q),()=>{clearInterval(v),document.removeEventListener("visibilitychange",q)}},[M]),m.useEffect(()=>{if(!_e)return;const a=v=>{v.key==="Escape"&&Pe(!1)};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[_e]),m.useEffect(()=>{let a=null;K&&!Z&&V>0?a=setInterval(()=>f(q=>q-1),1e3):V===0&&K&&(rs(),J({title:"Temps de récupération terminé"}),Y(!1),U(!1));const v=()=>{if(document.visibilityState==="visible"&&K&&!Z&&X.current>0){const q=Math.max(0,Math.ceil((X.current-Date.now())/1e3));f(q),q<=0&&(rs(),J({title:"Temps de récupération terminé"}),Y(!1),U(!1))}};return document.addEventListener("visibilitychange",v),()=>{a&&clearInterval(a),document.removeEventListener("visibilitychange",v)}},[K,Z,V]);const oe=t.items||[],Oe=R-1,j=R>0&&R<=oe.length?oe[Oe]:null,ae=j?n.find(a=>a.id===j.exercise_id):null,nt=R<oe.length?oe[R]:null,ot=nt?n.find(a=>a.id===nt.exercise_id):null,Qe=(()=>{const a=ae?.muscle_groups??ae?.muscles??ae?.muscleGroups??[];return Array.isArray(a)?a:[]})(),de=j?.rest_seconds??0,g=oe.length?Math.min(100,Math.max(0,Math.round((R-1)/oe.length*100))):0,A=Number(j?.percent_1rm),P=Number.isFinite(A)&&A>0,E=P&&r.find(a=>a.exercise_id===j?.exercise_id)?.weight||0,k=P?Math.round(E*(A/100)):0,[z,Q]=m.useState({}),ye=m.useMemo(()=>{const a=new Map;return w.forEach((v,q)=>{const C=Et(v,q+1);v.exercise_id&&a.set(`${v.exercise_id}-${C}`,v)}),a},[w]),ue=j?`${j.exercise_id}-${B}`:null,ve=ue?ye.get(ue):null,Te=ve?.weight??z[B-1]?.weight??k,s=ve?.reps??z[B-1]?.reps??j?.reps??"",c=()=>{if(typeof window>"u")return;const a=["#22c55e","#3b82f6","#f97316","#e11d48","#a855f7"],v=120;for(let q=0;q<v;q+=1){const C=document.createElement("div"),He=Math.random()*6+6;C.style.position="fixed",C.style.top="-10px",C.style.left=`${Math.random()*100}vw`,C.style.width=`${He}px`,C.style.height=`${He*.6}px`,C.style.backgroundColor=a[q%a.length],C.style.opacity="0.9",C.style.pointerEvents="none",C.style.zIndex="9999",C.style.borderRadius="2px",document.body.appendChild(C);const ze=(Math.random()-.5)*200,ut=1200+Math.random()*800,bt=Math.random()*360;C.animate([{transform:"translate3d(0, 0, 0) rotate(0deg)",opacity:1},{transform:`translate3d(${ze}px, ${window.innerHeight+200}px, 0) rotate(${bt}deg)`,opacity:0}],{duration:ut,easing:"ease-out"}).onfinish=()=>C.remove()}};m.useEffect(()=>{if(y.current){p&&ne(p);return}if(!p){ne(C=>C.length?[]:C),Q(C=>Object.keys(C).length?{}:C);return}if(ne(p),!p.length){Q(C=>Object.keys(C).length?{}:C),O(C=>C===0?C:0);return}const a=t.items||[];if(!a.length)return;const v=new Map;p.forEach((C,He)=>{if(!C.exercise_id)return;const ze=v.get(C.exercise_id)??[];ze.push({...C,set_index:Et(C,He+1)}),v.set(C.exercise_id,ze)});const q=Cs(a,p);if(q>0&&q<=a.length){const C=a[q-1],He=v.get(C.exercise_id)??[],ze=He.reduce((bt,Dt,Es)=>{const ks=Et(Dt,Es+1);return bt[ks-1]={reps:Dt.reps??void 0,weight:Dt.weight??void 0},bt},{});Q(ze);const ut=Math.min(C.sets??1,He.length+1);Ne(ut)}else Q({}),Ne(1);O(C=>C===q?C:q)},[p,t.items]),m.useEffect(()=>{R<=oe.length||Me||(c(),$e(!0))},[R,oe.length,Me]);const L=a=>{O(a),x?.(a)},ce=a=>{a<=0||(X.current=Date.now()+a*1e3,f(a),Y(!0),U(!1))},fe=async()=>{window.scrollTo({top:0,behavior:"smooth"});const a=R+1;Ne(1),Q({}),L(a);const v=Math.round(Math.min(a-1,oe.length)/oe.length*100);try{await h?.(v)}catch{J({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}},we=async()=>{if(!j)return;if(ve){B>=j.sets?await fe():Ne(v=>Math.min(j.sets,v+1));return}const a={exercise_id:j.exercise_id,set_number:B,reps:z[B-1]?.reps||j.reps,weight:z[B-1]?.weight||k};ne(v=>[...v,a]),y.current=!0;try{await l?.([a])}catch{J({title:"Erreur de sauvegarde",description:"Réessayez",variant:"destructive"})}finally{y.current=!1}if(ie&&j.rest_seconds>0&&ce(j.rest_seconds),B>=j.sets){await fe();return}Ne(v=>Math.min(j.sets,v+1))},ct=a=>{We(a);const v=a==="weight"?z[B-1]?.weight??k??"":z[B-1]?.reps??j?.reps??"";Se(v?String(v):""),ge(!!v),_(!0)},Tt=()=>{if(!j)return;const a=Number(xe==="weight"?be.replace(",","."):be);Number.isFinite(a)&&(Q(v=>({...v,[B-1]:{...v[B-1],[xe]:a}})),_(!1))},rt=a=>{if(Ke){ge(!1),Se(a);return}Se(v=>a==="."&&v.includes(".")?v:v+a)},dt=a=>{if(!j)return;We(a);const v=a==="weight"?z[B-1]?.weight??k??"":z[B-1]?.reps??j?.reps??"";Se(v?String(v):""),ge(!!v)};return R===0?e.jsxs("div",{className:"space-y-6 text-center py-8 animate-in zoom-in duration-300",children:[e.jsx("div",{className:"h-24 w-24 bg-primary/10 rounded-full flex items-center justify-center mx-auto animate-pulse",children:e.jsx(tt,{className:"h-10 w-10 text-primary ml-1"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold font-display uppercase",children:t.title}),e.jsx("p",{className:"text-muted-foreground text-lg",children:t.description}),e.jsxs("div",{className:"flex gap-2 justify-center mt-4",children:[e.jsx(gt,{variant:"outline",className:"text-sm px-3 py-1",children:t.cycle}),e.jsxs(gt,{variant:"secondary",className:"text-sm px-3 py-1",children:[oe.length," Exercices"]})]})]}),e.jsx(F,{size:"lg",className:"w-full text-xl h-14 font-bold uppercase tracking-wider shadow-lg hover:scale-[1.02] transition-transform",disabled:Le,onClick:async()=>{ee(!0);try{await o?.(),L(1)}finally{ee(!1)}},children:Le?e.jsxs(e.Fragment,{children:[e.jsx(Qs,{className:"mr-2 h-5 w-5 animate-spin"}),"CHARGEMENT..."]}):"COMMENCER SÉANCE"})]}):R>oe.length?e.jsx("div",{className:"space-y-6 animate-in fade-in",children:e.jsxs(Ye,{className:"border-t-8 border-t-primary shadow-xl",children:[e.jsxs(_t,{className:"text-center pb-2",children:[e.jsx("div",{className:"mx-auto bg-primary/10 p-4 rounded-full w-fit mb-4",children:e.jsx(mn,{className:"h-12 w-12 text-primary"})}),e.jsx(Lt,{className:"text-3xl uppercase font-display italic",children:"Séance Terminée !"}),e.jsxs(ls,{className:"text-lg",children:["Durée totale: ",Math.floor(me/60),"m ",me%60,"s"]})]}),e.jsxs(Ct,{className:"space-y-6 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Volume"}),e.jsxs("div",{className:"text-2xl font-mono font-bold",children:[w.reduce((a,v)=>a+(Number(v.weight)||0)*(Number(v.reps)||0),0)," kg"]})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs uppercase font-bold text-muted-foreground",children:"Séries"}),e.jsx("div",{className:"text-2xl font-mono font-bold",children:w.length})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(it,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Difficulté de la séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Facile"}),e.jsx("span",{children:"Très dur"})]}),e.jsx(ns,{value:le,onChange:De})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(it,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Fatigue fin de séance"}),e.jsxs("div",{className:"flex items-center justify-between text-[11px] font-semibold text-muted-foreground",children:[e.jsx("span",{children:"Frais"}),e.jsx("span",{children:"Épuisé"})]}),e.jsx(ns,{value:pe,onChange:Ee})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(it,{className:"uppercase font-bold text-xs text-muted-foreground",children:"Notes"}),e.jsx("textarea",{placeholder:"Sensations, douleurs...",value:Ve,onChange:a=>Ue(a.target.value),rows:3,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none"})]})]}),e.jsx(Ls,{children:e.jsx(F,{className:"w-full h-14 text-lg font-bold uppercase",disabled:u,onClick:()=>{u||i({duration:Math.floor(me/60),feeling:le,fatigue:pe,comments:Ve,logs:w})},children:u?"ENREGISTREMENT...":"ENREGISTRER & FERMER"})})]})}):e.jsxs("div",{className:"space-y-6 pb-32",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button","aria-label":"Voir l’animation de l’exercice",onClick:()=>{ae?.illustration_gif&&Pe(!0)},className:"flex h-12 w-12 items-center justify-center overflow-hidden rounded-full border bg-card shadow-sm",children:ae?.illustration_gif?e.jsx("img",{src:ae.illustration_gif,alt:"",className:"h-full w-full object-cover",loading:"lazy",decoding:"async"}):e.jsx(tt,{className:"h-5 w-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold",children:["Ex ",R,"/",oe.length]}),e.jsxs("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold",children:["S ",B,"/",Be(j?.sets)]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Séance"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-28 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${g}%`}})}),e.jsxs("div",{className:"text-sm font-semibold",children:[g,"%"]})]}),H?e.jsx(F,{variant:"ghost",size:"icon","aria-label":"Quitter le focus",onClick:()=>{w.length>0?Ge(!0):H()},children:e.jsx(Rt,{className:"h-4 w-4"})}):null]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-2xl font-semibold tracking-tight",children:ae?.nom_exercice??"Exercice"}),D&&j&&e.jsx(F,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",onClick:()=>{Je(W?.[j.exercise_id]??""),Ie(!0)},"aria-label":"Notes personnelles",children:e.jsx(nn,{className:he("h-4 w-4",W?.[j?.exercise_id]?"text-primary":"text-muted-foreground")})})]}),j&&W?.[j.exercise_id]&&e.jsx("p",{className:"mt-1 text-xs italic text-muted-foreground line-clamp-2",children:W[j.exercise_id]}),Qe.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:Qe.map(a=>e.jsx("span",{className:"rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:a},a))})]}),e.jsxs(Ye,{className:"rounded-3xl border bg-card p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-base font-semibold",children:"Série en cours"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(qt,{checked:ie,onCheckedChange:Re}),"Auto repos"]})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border bg-muted/20 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"En cours"}),e.jsxs("div",{className:"mt-2 text-lg font-semibold",children:["Série ",B,"/",Be(j?.sets)," · Objectif"," ",Be(j?.reps)," reps"]}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:"Appuie sur une tuile pour saisir."})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>ct("weight"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:Te||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:"group relative rounded-2xl border-2 border-primary/20 bg-gradient-to-br from-card to-muted/30 p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:border-primary/40 hover:shadow-md",onClick:()=>ct("reps"),children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-wide text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 flex items-baseline gap-0.5",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums tracking-tight",children:s||"—"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"reps"})]})]})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border bg-muted/10 p-4",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Notes"}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:j?.notes||ae?.description||"Aucune note spécifique."})]}),e.jsx(F,{type:"button",variant:"outline",className:"mt-4 w-full rounded-2xl",onClick:()=>Xe(!0),children:"Voir les séries"})]}),!ke&&!K?e.jsxs(_s,{className:"bottom-0 z-[60]",containerClassName:"gap-3 py-4",children:[e.jsxs(F,{className:"flex-1 min-w-0 h-12 rounded-xl text-sm font-bold shadow-lg active:scale-95 transition-transform",onClick:we,children:[e.jsx(Gt,{className:"mr-2 h-5 w-5"})," Valider série"]}),e.jsx(F,{type:"button",variant:"outline",className:"h-12 w-12 rounded-xl p-0 active:scale-95 transition-transform",onClick:()=>{de<=0||ce(de)},"aria-label":"Démarrer le repos",children:e.jsx(rn,{className:"h-5 w-5"})}),e.jsx(F,{type:"button",variant:"outline",className:"h-12 w-12 rounded-xl p-0 active:scale-95 transition-transform",onClick:()=>fe(),"aria-label":"Exercice suivant",children:e.jsx(Vt,{className:"h-5 w-5"})})]}):null,K&&e.jsxs("div",{className:"fixed inset-0 z-50 flex flex-col bg-background/95 pb-[env(safe-area-inset-bottom)]",children:[e.jsxs("div",{className:"flex items-start justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground",children:"Timer"}),e.jsx("div",{className:"text-lg font-semibold",children:"Transition inter-exercice"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Prochain exercice : ",ot?.nom_exercice??"À venir"]})]}),e.jsx(F,{variant:"ghost",size:"icon",onClick:()=>{Y(!1),U(!1)},"aria-label":"Fermer le timer de repos",children:e.jsx(Rt,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-1 flex-col items-center justify-center gap-6 px-6 py-8",children:[e.jsxs(Ye,{className:"w-full max-w-sm rounded-3xl border p-6 shadow-sm",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Temps restant"}),e.jsxs("div",{className:"mt-2 text-5xl font-semibold tracking-tight",children:[Math.floor(V/60),":",String(V%60).padStart(2,"0")]}),e.jsx("div",{className:"mt-6 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:de?`${V/de*100}%`:"0%"}})}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[e.jsx(F,{variant:"outline",className:"rounded-full",onClick:()=>{X.current+=15*1e3,f(a=>a+15)},children:"+15s"}),e.jsx(F,{variant:"outline",className:"rounded-full",onClick:()=>{X.current+=30*1e3,f(a=>a+30)},children:"+30s"}),e.jsx(F,{variant:"outline",className:"rounded-full",onClick:()=>{X.current=Math.max(Date.now(),X.current-15*1e3),f(a=>Math.max(0,a-15))},children:"-15s"}),e.jsxs(F,{variant:"outline",className:"ml-auto rounded-full",onClick:()=>{X.current=Date.now()+de*1e3,f(de)},children:[e.jsx(Fs,{className:"mr-2 h-4 w-4"}),"Reset"]})]})]}),e.jsxs("div",{className:"flex w-full max-w-sm flex-wrap gap-3",children:[e.jsxs(F,{className:"flex-1 rounded-full py-6 text-base font-semibold",onClick:()=>{Z&&(X.current=Date.now()+V*1e3),U(a=>!a)},children:[e.jsx(hn,{className:"mr-2 h-4 w-4"})," ",Z?"Reprendre":"Pause"]}),e.jsxs(F,{variant:"outline",className:"rounded-full px-6 py-6 text-base font-semibold",onClick:()=>{X.current=0,Y(!1),f(0),U(!1)},children:["Passer ",e.jsx(Vt,{className:"ml-2 h-4 w-4"})]})]})]})]}),_e&&ae?.illustration_gif&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50",onClick:()=>Pe(!1),children:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button","aria-label":"Fermer",className:"absolute -right-3 -top-3 rounded-full bg-background p-2 shadow",onClick:()=>Pe(!1),children:e.jsx(Rt,{className:"h-4 w-4"})}),e.jsx("img",{src:ae.illustration_gif,alt:"",className:"max-h-[80vh] w-auto max-w-[92vw] rounded-2xl",loading:"lazy"})]})})}),e.jsx(Ft,{open:Ae,onOpenChange:Xe,children:e.jsxs(Ht,{side:"bottom",className:"max-h-[80vh] overflow-y-auto",children:[e.jsx(zt,{children:e.jsx(Bt,{children:"Aperçu séance"})}),e.jsx("div",{className:"mt-4 space-y-4",children:oe.map((a,v)=>{const q=n.find(ze=>ze.id===a.exercise_id),C=Array.from({length:a.sets}).filter((ze,ut)=>ye.get(`${a.exercise_id}-${ut+1}`)).length,He=a.sets?Math.round(C/a.sets*100):0;return e.jsxs(Ye,{className:"rounded-3xl border bg-muted/10 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold",children:q?.nom_exercice??a.exercise_name}),e.jsxs("div",{className:"mt-1 text-sm text-muted-foreground",children:[Be(a.sets),"x",Be(a.reps)," ·"," ",a.percent_1rm?`${Be(a.percent_1rm)} 1RM`:"—"]})]}),e.jsxs("div",{className:"rounded-full bg-muted px-3 py-1 text-sm font-semibold",children:[C,"/",Be(a.sets)]})]}),e.jsx("div",{className:"mt-4 h-3 w-full overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:`${He}%`}})})]},`${a.exercise_id}-${v}`)})})]})}),e.jsx(bs,{open:ke,onOpenChange:_,children:e.jsx(ws,{className:"max-h-[90vh]",children:e.jsxs("div",{className:"mx-auto w-full max-w-md px-4 pb-8",children:[e.jsxs(js,{className:"pb-2",children:[e.jsx(Ns,{className:"text-center",children:xe==="weight"?"Charge":"Répétitions"}),e.jsxs(Ss,{className:"text-center",children:["Série ",B,"/",Be(j?.sets)," · Objectif"," ",Be(j?.reps)," reps"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("button",{type:"button",className:he("rounded-xl border-2 p-4 text-center transition-all",xe==="weight"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>dt("weight"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Charge"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[xe==="weight"?be||"—":String(z[B-1]?.weight??k??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"kg"})]})]}),e.jsxs("button",{type:"button",className:he("rounded-xl border-2 p-4 text-center transition-all",xe==="reps"?"border-primary bg-primary/10 shadow-sm":"border-muted bg-card hover:border-muted-foreground/30"),onClick:()=>dt("reps"),children:[e.jsx("div",{className:"text-xs font-semibold uppercase text-muted-foreground",children:"Reps"}),e.jsxs("div",{className:"mt-1 text-2xl font-bold tabular-nums",children:[xe==="reps"?be||"—":String(z[B-1]?.reps??j?.reps??"—"),e.jsx("span",{className:"ml-1 text-base font-normal text-muted-foreground",children:"reps"})]})]})]}),xe==="weight"&&k>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[k-10,k-5,k,k+5,k+10].filter(a=>a>0).map(a=>e.jsxs(F,{variant:Number(be)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>Se(String(a)),children:[a," kg"]},a))})]}),xe==="reps"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold text-muted-foreground mb-2",children:"Suggestions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[6,8,10,12,15,20].map(a=>e.jsx(F,{variant:Number(be)===a?"default":"outline",size:"sm",className:"rounded-full px-4 h-10 text-sm font-semibold",onClick:()=>Se(String(a)),children:a},a))})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4",children:[[1,2,3,4,5,6,7,8,9].map(a=>e.jsx(F,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>rt(String(a)),children:a},a)),e.jsx(F,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>rt("."),children:","}),e.jsx(F,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>rt("0"),children:"0"}),e.jsx(F,{variant:"outline",className:"h-14 text-xl font-semibold rounded-xl active:scale-95 transition-transform",onClick:()=>{ge(!1),Se(a=>a.slice(0,-1))},children:"⌫"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(F,{variant:"outline",className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:()=>{ge(!1),Se("")},children:"Effacer"}),e.jsxs(F,{className:"flex-1 h-14 text-base font-semibold rounded-xl",onClick:Tt,children:[e.jsx(Gt,{className:"mr-2 h-5 w-5"}),"Valider"]})]})]})})}),H&&e.jsx(Ys,{open:Fe,onOpenChange:Ge,children:e.jsxs(Xs,{children:[e.jsxs(Gs,{children:[e.jsx(Js,{children:"Quitter la séance ?"}),e.jsx(Zs,{children:"Les séries enregistrées seront conservées."})]}),e.jsxs(en,{children:[e.jsx(tn,{children:"Annuler"}),e.jsx(sn,{onClick:()=>{Ge(!1),H()},children:"Quitter"})]})]})}),D&&e.jsx(Ft,{open:lt,onOpenChange:a=>{if(!a&&j){const v=st.trim()||null,q=W?.[j.exercise_id]??null;v!==q&&D(j.exercise_id,v)}Ie(a)},children:e.jsxs(Ht,{side:"bottom",className:"max-h-[60vh]",children:[e.jsx(zt,{children:e.jsxs(Bt,{children:["Notes — ",ae?.nom_exercice]})}),e.jsx("textarea",{value:st,onChange:a=>Je(a.target.value),placeholder:"Réglages machine, repères personnels...",rows:4,className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm mt-4 resize-none ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"})]})})]})}const et=t=>t==="endurance"||t==="hypertrophie"||t==="force"?t:"endurance",pt=t=>{const n=Number(t);return!Number.isFinite(n)||n<=0?null:n},Qn=(t,n)=>{if(!t)return{sets:null,reps:null,percent1rm:null,restSeries:null,restExercise:null};const r={endurance:{sets:t.Nb_series_endurance,reps:t.Nb_reps_endurance,percent1rm:t.pct_1rm_endurance,restSeries:t.recup_endurance,restExercise:t.recup_exercices_endurance},hypertrophie:{sets:t.Nb_series_hypertrophie,reps:t.Nb_reps_hypertrophie,percent1rm:t.pct_1rm_hypertrophie,restSeries:t.recup_hypertrophie,restExercise:t.recup_exercices_hypertrophie},force:{sets:t.Nb_series_force,reps:t.Nb_reps_force,percent1rm:t.pct_1rm_force,restSeries:t.recup_force,restExercise:t.recup_exercices_force}}[n];return{sets:pt(r.sets),reps:pt(r.reps),percent1rm:pt(r.percent1rm),restSeries:pt(r.restSeries),restExercise:pt(r.restExercise)}},xt=(t=[],n,r)=>Xn(t,n).map(i=>{const o=Qn(r.get(i.exercise_id),n);return{...i,sets:o.sets??0,reps:o.reps??0,rest_seconds:o.restSeries??0,percent_1rm:o.percent1rm??0}}),as=t=>{const n=Number(t);return!Number.isFinite(n)||n<=0?"—":String(n)},Yn=t=>{const n=Number(t);return!Number.isFinite(n)||n<=0?"—":`${n}s`},Rs=(t=[])=>{if(!t.length)return t;const n=t.map((i,o)=>{const l=Number(i.order_index);return{item:i,index:o,order:Number.isFinite(l)?l:null}});return n.some(i=>i.order!==null)?n.sort((i,o)=>i.order===null&&o.order===null?i.index-o.index:i.order===null?1:o.order===null?-1:i.order===o.order?i.index-o.index:i.order-o.order).map(i=>i.item):t},Xn=(t=[],n)=>{const r=t.filter(o=>o.cycle_type===n),i=r.length?r:t;return Rs(i)},Gn=t=>{t.setActiveSession(null),t.setActiveAssignment(null),t.setActiveRunId(null),t.setActiveRunLogs(null),t.setActiveRunnerStep(0),t.setScreenMode("list")},Jn=({runId:t,assignmentId:n,startedAt:r})=>({id:t,assignment_id:n??null,started_at:r,progress_pct:0,status:"in_progress",logs:[]}),Pt=t=>({runs:t?[t]:[],pagination:{limit:1,offset:0,total:t?1:0},exercise_summary:[]});function jr(){const{user:t,userId:n,role:r,selectedAthleteId:i,selectedAthleteName:o}=Hs(),{toast:l}=is(),h=$s(),p="strength-preferences",[u,T]=m.useState(null),[x,S]=m.useState(null),[b,H]=m.useState(null),[W,D]=m.useState(null),[J,y]=m.useState(0),[R,O]=m.useState("list"),[w,ne]=m.useState(!1),[me,N]=m.useState({poolMode:!1,largeText:!1}),[M,I]=m.useState(""),[$,te]=m.useState("endurance"),[V,f]=m.useState("all"),[K,Y]=m.useState(""),[Z,U]=m.useState(""),X=(r==="coach"||r==="admin")&&(i!==null||!!o),ie=X?o:t,Re=X?i:n,le=Re??ie,De=m.useMemo(()=>`strength-focus-state-${le??"anonymous"}`,[le]),{poolMode:pe,largeText:Ee}=me;m.useEffect(()=>{if(typeof window>"u")return;const s=window.localStorage.getItem(p);if(s)try{const c=JSON.parse(s);N(L=>({...L,...c??{}}))}catch{return}},[]),m.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(p,JSON.stringify(me))},[p,me]),m.useEffect(()=>{if(!(typeof document>"u")){if(R==="focus")return document.body.dataset.focusMode="strength",()=>{document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode};document.body.dataset.focusMode==="strength"&&delete document.body.dataset.focusMode}},[R]),m.useEffect(()=>{if(typeof window>"u"||u)return;const s=window.localStorage.getItem(De);if(s)try{const c=JSON.parse(s),L=c?.screenMode==="focus"?"focus":c?.screenMode==="reader"?"reader":null;if(!L||!c?.session)return;T(c.session),S(c.assignment??null),H(typeof c.runId=="number"?c.runId:null),D(Array.isArray(c.runLogs)?c.runLogs:null),y(Number.isFinite(c.runnerStep)?c.runnerStep:0),c.cycleType&&te(et(c.cycleType)),O(L)}catch{return}},[u,De]),m.useEffect(()=>{if(typeof window>"u")return;if(!(R==="focus"||R==="reader")||!u){window.localStorage.removeItem(De);return}const c={screenMode:R,session:u,assignment:x,runId:b,runLogs:W,runnerStep:J,cycleType:$};window.localStorage.setItem(De,JSON.stringify(c))},[x,b,W,J,u,$,De,R]);const{data:Ve,isLoading:Ue,error:Me,refetch:$e}=mt({queryKey:["assignments",t,"strength"],queryFn:()=>Ce.getAssignments(t,n,{assignmentType:"strength"}),enabled:!!t}),{data:B,isLoading:Ne,error:Ae,refetch:Xe}=mt({queryKey:["strength_catalog"],queryFn:()=>Ce.getStrengthSessions()}),{data:ke,error:_,refetch:xe}=mt({queryKey:["exercises"],queryFn:()=>Ce.getExercises()}),We=Ue||Ne,be=Me||Ae||_,Se=()=>{$e(),Xe(),xe()},{data:Ke}=mt({queryKey:["1rm",t,n],queryFn:()=>Ce.get1RM({athleteName:t,athleteId:n}),enabled:!!t}),ge=m.useMemo(()=>{const s={};return(Ke??[]).forEach(c=>{c.notes&&(s[c.exercise_id]=c.notes)}),s},[Ke]),_e=Ps({queryKey:["strength_history",le,V,K,Z],queryFn:({pageParam:s=0})=>Ce.getStrengthHistory(ie,{athleteId:Re,limit:10,offset:s,order:"desc",status:V==="all"?void 0:V,from:K||void 0,to:Z||void 0}),enabled:!!ie,getNextPageParam:s=>{const c=s.pagination.offset+s.pagination.limit;return c<s.pagination.total?c:void 0},initialPageParam:0}),Pe=_e.data?.pages.flatMap(s=>s.runs)??[],ee=mt({queryKey:["strength_run_in_progress",le],queryFn:()=>Ce.getStrengthHistory(ie,{limit:1,offset:0,order:"desc",status:"in_progress",athleteId:Re}),enabled:!!ie}).data?.runs?.[0]??null,Fe=ee?.status==="completed"||(ee?.progress_pct??0)>=100,Ge=at({mutationFn:s=>Ce.startStrengthRun(s),onSuccess:s=>{if(s?.run_id&&(H(s.run_id),D(c=>c??[]),le)){const c=Jn({runId:s.run_id,assignmentId:x?.id??null,startedAt:new Date().toISOString()});h.setQueryData(["strength_run_in_progress",le],Pt(c))}h.invalidateQueries({queryKey:["assignments",t,"strength"]}),h.invalidateQueries({queryKey:["strength_run_in_progress",le]}),h.invalidateQueries({queryKey:["strength_history"]})},onError:()=>{l({title:"Erreur",description:"Impossible de démarrer la séance.",variant:"destructive"})}}),lt=at({mutationFn:s=>Ce.logStrengthSet(s),onSuccess:s=>{s?.one_rm_updated&&(h.invalidateQueries({queryKey:["1rm",t,n]}),l({title:"Nouveau 1RM détecté",description:"Ton record vient d'être mis à jour."}))},onError:()=>{l({title:"Erreur",description:"Impossible d'enregistrer une série.",variant:"destructive"})}}),Ie=at({mutationFn:s=>Ce.updateStrengthRun(s),onSuccess:(s,c)=>{ne(!1),h.invalidateQueries({queryKey:["strength_history"]}),c?.status==="completed"&&(le&&h.setQueryData(["strength_run_in_progress",le],Pt(null)),h.invalidateQueries({queryKey:["assignments",t]}),h.invalidateQueries({queryKey:["assignments",t,"strength"]}),h.invalidateQueries({queryKey:["1rm",t,n]}),S(null),H(null),T(null),D(null),O("list"),l({title:"Séance sauvegardée",description:"Bravo pour l'effort !"}))},onError:(s,c)=>{c?.status==="completed"&&(ne(!1),l({title:"Erreur",description:"Impossible d'enregistrer la séance. Réessayez.",variant:"destructive"}))}}),st=at({mutationFn:s=>Ce.updateExerciseNote({athlete_id:n??0,exercise_id:s.exercise_id,notes:s.notes}),onSuccess:()=>{h.invalidateQueries({queryKey:["1rm",t,n]})},onError:()=>{l({title:"Erreur",description:"Impossible de sauvegarder la note.",variant:"destructive"})}});at({mutationFn:s=>Ce.startStrengthRun(s),onError:()=>{l({title:"Erreur",description:"Impossible de mettre à jour la séance.",variant:"destructive"})}});const Je=(s,c)=>{const L=s.items??[],ce=et(c??s.cycle??L.find(we=>we.cycle_type)?.cycle_type),fe=xt(L,ce,de);S(s),T({...s,title:s.title,description:s.description,cycle:ce,items:fe}),H(null),D(null),y(0),O("reader")},Oe=(Ve?.filter(s=>s.session_type==="strength")||[]).filter(s=>s.status!=="completed"),j=ee?Oe.find(s=>s.id===ee.assignment_id)??null:null,ae=ee&&!j?B?.find(s=>s.id===ee.session_id)??null:null,nt=(!!j?.items?.length||!!ae?.items?.length)&&!Fe,ot=Oe.map(s=>({...s,session:{id:s.session_id,title:s.title,description:s.description,cycle:et(s.cycle),items:s.items??[]}})),Qe=[{value:"endurance",label:"Endurance"},{value:"hypertrophie",label:"Hypertrophie"},{value:"force",label:"Force"}],de=m.useMemo(()=>ke?new Map(ke.map(s=>[s.id,s])):new Map,[ke]),g=ot.map(s=>{const c=xt(s.items??[],$,de);return{key:`assignment-${s.id}`,title:s.title,description:s.description,type:"assignment",assignedDate:s.assigned_date,session:{id:s.session_id,title:s.title,description:s.description,cycle:et(s.cycle),items:c},assignment:s,exerciseCount:c.length}}),A=(B??[]).map(s=>{const c=xt(s.items??[],$,de);return{key:`catalog-${s.id}`,title:s.title,description:s.description,type:"catalog",session:{...s,items:c,cycle:$},exerciseCount:c.length}}),P=M.trim().toLowerCase(),E=[...g,...A].filter(s=>P?`${s.title} ${s.description}`.toLowerCase().includes(P):!0),k=m.useMemo(()=>u?xt(u.items??[],$,de):[],[u,$,de]),z=s=>{if((s.items??[]).length===0){l({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}Je(s,$),H(null),D(null)},Q=s=>{const c=s.items??[],ce=c.filter(we=>we.cycle_type===$).length>0?$:et(s.cycle??c.find(we=>we.cycle_type)?.cycle_type),fe=xt(c,ce,de);if(fe.length===0){l({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}T({...s,cycle:ce,items:fe}),S(null),H(null),D(null),y(0),O("reader")},ye=()=>{if(u){if(k.length===0){l({title:"Séance vide",description:"Aucun exercice n'est disponible pour cette séance."});return}T({...u,cycle:$,items:k}),y(0),O("focus")}},ue=()=>{Gn({setActiveSession:T,setActiveAssignment:S,setActiveRunId:H,setActiveRunLogs:D,setActiveRunnerStep:y,setScreenMode:O})},ve=at({mutationFn:s=>Ce.deleteStrengthRun(s),onSuccess:s=>{ue(),le&&h.setQueryData(["strength_run_in_progress",le],Pt(null)),h.invalidateQueries({queryKey:["strength_run_in_progress",le]}),h.invalidateQueries({queryKey:["strength_history"]}),h.invalidateQueries({queryKey:["assignments",t,"strength"]});const c=s?.source==="local"?"Suppression locale : le serveur n'est pas disponible.":void 0;l({title:"Séance supprimée",description:c})},onError:()=>{l({title:"Erreur",description:"Impossible de supprimer la séance en cours.",variant:"destructive"})}});return Ue||Ne?e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(je,{className:"h-8 w-32"}),e.jsx(je,{className:"h-10 w-10 rounded-full"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(je,{className:"h-10 w-32"}),e.jsx(je,{className:"h-10 w-32"})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[e.jsx(je,{className:"h-9 w-28 rounded-full"}),e.jsx(je,{className:"h-9 w-32 rounded-full"}),e.jsx(je,{className:"h-9 w-24 rounded-full"})]}),e.jsx(je,{className:"h-10 w-full rounded-lg"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((s,c)=>e.jsxs(Ye,{className:"overflow-hidden",children:[e.jsx(_t,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(je,{className:"h-5 w-48"}),e.jsx(je,{className:"h-4 w-32"})]}),e.jsx(je,{className:"h-6 w-20 rounded-full"})]})}),e.jsxs(Ct,{className:"space-y-2",children:[e.jsx(je,{className:"h-4 w-full"}),e.jsx(je,{className:"h-4 w-3/4"})]})]},`skeleton-${c}`))})]}):be?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(ln,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:be.message}),e.jsx(F,{onClick:()=>Se(),className:"mt-4",children:"Réessayer"})]}):e.jsx("div",{className:he("space-y-4 md:space-y-6",pe&&"dark bg-background text-foreground contrast-125",Ee&&"text-lg leading-relaxed [&_.text-xs]:text-sm [&_.text-sm]:text-base"),children:R==="focus"&&u?ke?e.jsx("div",{className:"animate-in fade-in motion-reduce:animate-none",children:e.jsx(Kn,{session:u,exercises:ke,oneRMs:Ke||[],exerciseNotes:ge,onUpdateNote:(s,c)=>st.mutate({exercise_id:s,notes:c}),initialLogs:W,initialStep:J,isFinishing:w,onStepChange:s=>y(s),onExitFocus:()=>O("reader"),onStart:async()=>{if(b)return;const s=x?.session_id??u?.id??null;if(!s){l({title:"Session manquante",description:"Impossible de démarrer sans session associée.",variant:"destructive"});return}const c={assignment_id:x?.id??null,athlete_id:n??null,athleteName:t??void 0,progress_pct:0,session_id:s,cycle_type:u?.cycle};try{const L=await Ge.mutateAsync(c);L?.run_id&&H(L.run_id)}catch{return}},onLogSets:async s=>{b&&(D(c=>[...c??[],...s]),await Promise.all(s.map((c,L)=>lt.mutateAsync({run_id:b,exercise_id:c.exercise_id,set_index:c.set_number??L+1,reps:c.reps??null,weight:c.weight??null,athlete_id:n??null,athlete_name:t??null}))))},onProgress:async s=>{b&&await Ie.mutateAsync({run_id:b,progress_pct:s,status:"in_progress"})},onFinish:s=>{b&&(ne(!0),Ie.mutate({assignment_id:x?.id??void 0,run_id:b,session_id:x?.session_id??u?.id??void 0,athlete_id:n??void 0,date:new Date().toISOString(),progress_pct:100,status:"completed",...s}))}})}):e.jsxs("div",{className:"space-y-4 py-10",children:[e.jsx("div",{className:"mx-auto h-8 w-48 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"mx-auto h-4 w-32 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"space-y-3 pt-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-20 w-full rounded-xl bg-muted animate-pulse motion-reduce:animate-none"},s))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Musculation"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(F,{variant:"ghost",size:"sm","aria-label":"Informations sur le calcul du 1RM",onClick:()=>{window.location.hash="#/records?tab=1rm"},className:"text-muted-foreground",children:[e.jsx(tt,{className:"mr-2 h-4 w-4"})," Info 1RM"]}),e.jsx(F,{variant:"ghost",size:"icon",onClick:()=>O("settings"),className:"rounded-full border border-muted/50 text-muted-foreground","aria-label":"Paramètres",children:e.jsx(xn,{className:"h-4 w-4"})})]})]}),e.jsxs(Ws,{defaultValue:"start",className:"w-full",children:[e.jsxs(Ks,{className:"grid w-full grid-cols-2",children:[e.jsx(Qt,{value:"start",children:"S'entraîner"}),e.jsx(Qt,{value:"history",children:"Historique"})]}),e.jsxs(Yt,{value:"start",className:"space-y-5 pt-4",children:[R==="list"&&We&&e.jsxs("div",{className:"space-y-5 pt-4",children:[e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3].map(s=>e.jsx("div",{className:"h-10 w-28 rounded-full bg-muted animate-pulse"},s))}),e.jsx("div",{className:"h-12 rounded-2xl bg-muted/30 animate-pulse"}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4].map(s=>e.jsx("div",{className:"rounded-2xl border bg-card p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 shrink-0 rounded-xl bg-muted animate-pulse"}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[e.jsx("div",{className:"h-4 w-3/4 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-1/2 rounded bg-muted animate-pulse"})]}),e.jsx("div",{className:"h-10 w-10 shrink-0 rounded-full bg-muted animate-pulse"})]})},s))})]}),R==="list"&&!We&&e.jsxs("div",{className:"space-y-5 animate-in fade-in motion-reduce:animate-none",children:[e.jsxs("p",{className:"text-center text-sm text-muted-foreground py-1",children:[E.length," séance",E.length>1?"s":""," disponible",E.length>1?"s":""]}),e.jsx("div",{className:"flex justify-center gap-2",children:Qe.map(s=>e.jsx("button",{type:"button",onClick:()=>te(et(s.value)),className:he("px-5 py-2.5 rounded-full text-sm font-semibold transition-all active:scale-95",$===s.value?"bg-primary text-primary-foreground shadow-md":"bg-muted/50 text-muted-foreground hover:bg-muted"),children:s.label},s.value))}),e.jsxs("div",{className:"relative",children:[e.jsx(on,{className:"absolute left-4 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground pointer-events-none"}),e.jsx(Mt,{placeholder:"Rechercher une séance...",className:"h-12 rounded-2xl bg-muted/30 pl-11 pr-4 border-0 shadow-sm focus-visible:ring-2",value:M,onChange:s=>I(s.target.value),"aria-label":"Rechercher une séance"})]}),ee&&e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border-2 border-primary/30 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-primary/10 rounded-full blur-2xl -mr-8 -mt-8"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-primary"})]}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-primary",children:Fe?"Complétée":"En cours"})]}),e.jsx("h3",{className:"text-xl font-bold tracking-tight mb-1",children:j?.title??"Séance en cours"}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Démarrée le ",jt(new Date(ee.started_at||new Date),"dd MMMM",{locale:wt})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs font-semibold mb-1.5",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progression"}),e.jsxs("span",{className:"text-primary",children:[Math.round(ee.progress_pct??0),"%"]})]}),e.jsx("div",{className:"h-2 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-primary transition-all duration-500",style:{width:`${ee.progress_pct??0}%`}})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{className:"flex-1 h-12 rounded-xl font-semibold",disabled:!nt,onClick:()=>{const s=j??ae;if(!s)return;const c=j?.items??ae?.items??[],L=et(j?.cycle??ae?.cycle??c.find(we=>we.cycle_type)?.cycle_type),ce=c.filter(we=>we.cycle_type===L),fe=Rs(ce.length?ce:c);S(j??null),T({...s,title:s.title,description:s.description??null,cycle:L,items:fe}),H(ee.id),D(ee.logs??[]),y(Cs(fe,ee.logs??[],ee.progress_pct)),O("focus")},children:Fe?"Voir le résumé":"Reprendre"}),!Fe&&e.jsx(F,{variant:"outline",className:"h-12 w-12 rounded-xl p-0",disabled:ve.isPending,onClick:()=>{!ee||!window.confirm("Supprimer la séance en cours ?")||ve.mutate(ee.id)},"aria-label":"Supprimer la séance",children:e.jsx(Rt,{className:"h-5 w-5"})})]})]})]}),!ee&&E.length>0&&e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(tt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Choisir une séance"})]}),E.length>0?e.jsx("div",{className:"space-y-3",children:E.map(s=>e.jsx("button",{type:"button",className:"group w-full rounded-2xl border bg-card p-4 text-left shadow-sm transition-all active:scale-[0.98] hover:shadow-md hover:border-primary/30",onClick:()=>{if(s.type==="assignment"){z(s.assignment);return}Q(s.session)},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:he("flex h-12 w-12 shrink-0 items-center justify-center rounded-xl",s.type==="assignment"?"bg-primary/10 text-primary":"bg-muted text-muted-foreground"),children:e.jsx(tt,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[s.type==="assignment"&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-primary/10 px-2 py-0.5 text-[10px] font-bold uppercase text-primary",children:"Assignée"}),s.type==="assignment"&&s.assignedDate&&e.jsx("span",{className:"text-xs text-muted-foreground",children:jt(new Date(s.assignedDate),"dd MMM",{locale:wt})})]}),e.jsx("h3",{className:"font-semibold tracking-tight truncate",children:s.title}),e.jsxs("p",{className:"text-sm text-muted-foreground truncate",children:[s.exerciseCount," exercice",s.exerciseCount>1?"s":"",s.description?` · ${s.description}`:""]})]}),e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors group-hover:bg-primary group-hover:text-primary-foreground",children:e.jsx(Xt,{className:"h-4 w-4 ml-0.5"})})]})},s.key))}):e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-muted",children:e.jsx(tt,{className:"h-7 w-7 text-muted-foreground"})}),e.jsx("h3",{className:"font-semibold",children:"Aucune séance"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Essayez un autre mot-clé ou changez de cycle."})]})]}),R==="settings"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(F,{variant:"ghost",size:"sm",onClick:()=>O("list"),className:"gap-2",children:[e.jsx(Jt,{className:"h-4 w-4"}),"Retour"]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-muted-foreground",children:"Préférences"}),e.jsx("h2",{className:"text-2xl font-display font-bold uppercase text-primary",children:"Paramètres"})]})]}),e.jsxs(Ye,{className:"border border-muted/60 shadow-sm",children:[e.jsxs(_t,{children:[e.jsx(Lt,{className:"text-lg uppercase",children:"Lisibilité & contrastes"}),e.jsx(ls,{children:"Ajuste l'écran pour rester lisible en bassin comme en extérieur."})]}),e.jsxs(Ct,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Mode piscine"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Contraste renforcé et lisibilité optimisée."})]}),e.jsx(qt,{checked:pe,onCheckedChange:s=>N(c=>({...c,poolMode:s}))})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 rounded-lg border bg-muted/30 p-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold uppercase",children:"Texte grand"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Police plus large pour lire pendant l'effort."})]}),e.jsx(qt,{checked:Ee,onCheckedChange:s=>N(c=>({...c,largeText:s}))})]})]})]}),e.jsx(Ye,{className:"border border-muted/60 shadow-sm",children:e.jsxs(Ct,{className:"space-y-3 pt-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsx(an,{className:"h-4 w-4"}),e.jsx("span",{children:"Les préférences sont enregistrées sur cet appareil."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs font-semibold uppercase text-muted-foreground",children:[pe&&e.jsx(gt,{variant:"secondary",children:"Mode piscine activé"}),Ee&&e.jsx(gt,{variant:"secondary",children:"Texte grand activé"}),!pe&&!Ee&&e.jsx(gt,{variant:"outline",children:"Réglages par défaut"})]})]})})]}),R==="reader"&&u&&e.jsxs("div",{className:"space-y-5 animate-in fade-in motion-reduce:animate-none pb-40",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:()=>O("list"),className:"flex h-10 w-10 items-center justify-center rounded-full bg-muted/50 text-muted-foreground transition-colors hover:bg-muted active:scale-95","aria-label":"Retour",children:e.jsx(Jt,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground truncate",children:Qe.find(s=>s.value===$)?.label}),e.jsx("h1",{className:"text-xl font-bold tracking-tight truncate",children:u.title})]})]}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border border-primary/20 p-5",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-primary/10 rounded-full blur-3xl -mr-12 -mt-12"}),e.jsxs("div",{className:"relative space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[x&&e.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full bg-primary/20 px-3 py-1 text-xs font-bold uppercase text-primary",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-primary"}),"Assignée"]}),!x&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-3 py-1 text-xs font-semibold text-muted-foreground",children:"Catalogue"}),x?.assigned_date&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Prévue le ",jt(new Date(x.assigned_date),"dd MMM",{locale:wt})]})]}),u.description&&e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:u.description}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(tt,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:k.length}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Exercices"})]})]}),e.jsx("div",{className:"h-8 w-px bg-border"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-background/80",children:e.jsx(dn,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:Qe.find(s=>s.value===$)?.label}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold",children:"Cycle"})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-1",children:[e.jsxs("span",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:[k.length," exercice",k.length>1?"s":""]}),e.jsx("div",{className:"flex-1 h-px bg-border"})]}),e.jsxs("div",{className:"space-y-2",children:[k.map((s,c)=>{const L=de.get(s.exercise_id),ce=Number(s.percent_1rm),fe=Number.isFinite(ce)&&ce>0,we=fe?Ke?.find(q=>q.exercise_id===s.exercise_id)?.weight??0:0,ct=fe?Math.round(we*(ce/100)):0,Tt=fe?ct>0?`${ct} kg (${ce}% 1RM)`:`${ce}% 1RM`:null,rt=s.notes?.trim(),dt=as(s.sets),a=as(s.reps),v=Yn(s.rest_seconds);return e.jsxs(Ft,{children:[e.jsx(zs,{asChild:!0,children:e.jsxs("button",{type:"button",className:"w-full flex items-center gap-3 rounded-xl border bg-card px-3 py-3 text-left transition-all active:scale-[0.98] hover:border-primary/50 hover:shadow-sm",children:[e.jsx("div",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-primary text-xs font-bold text-primary-foreground",children:c+1}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"font-semibold text-sm truncate",children:L?.nom_exercice??s.exercise_name??"Exercice"})}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 text-xs font-medium text-muted-foreground",children:[e.jsxs("span",{className:"font-mono",children:[dt,"×",a]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("span",{className:"font-mono",children:v}),e.jsx(Vt,{className:"h-4 w-4 text-muted-foreground/50"})]})]})}),e.jsxs(Ht,{side:"bottom",className:"max-h-[90vh] overflow-y-auto rounded-t-3xl pb-8",children:[e.jsx(zt,{className:"text-left pb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-primary text-sm font-bold text-primary-foreground",children:c+1}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(Bt,{className:"text-xl leading-tight",children:L?.nom_exercice??s.exercise_name??"Exercice"}),L?.exercise_type&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:L.exercise_type})]})]})}),e.jsxs("div",{className:"space-y-4",children:[L?.illustration_gif&&e.jsx("div",{className:"rounded-xl overflow-hidden bg-muted/20 border aspect-video flex items-center justify-center",children:e.jsx("img",{src:L.illustration_gif,alt:L.nom_exercice??"Exercice",className:"w-full h-full max-h-36 object-contain",loading:"lazy",decoding:"async"})}),L?.description&&e.jsx("div",{className:"text-sm text-muted-foreground leading-relaxed",children:L.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:dt}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Séries"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold leading-none",children:a}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Reps"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:Tt??"—"}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Charge"})]}),e.jsxs("div",{className:"rounded-xl bg-muted/40 p-3 text-center",children:[e.jsx("p",{className:"text-lg font-bold leading-none",children:v}),e.jsx("p",{className:"text-[10px] uppercase text-muted-foreground font-semibold mt-1",children:"Repos"})]})]}),rt&&e.jsxs("div",{className:"rounded-xl bg-primary/5 border border-primary/20 p-4",children:[e.jsx("div",{className:"text-[10px] uppercase text-primary font-semibold mb-1",children:"Notes coach"}),e.jsx("div",{className:"text-sm text-foreground",children:rt})]})]})]})]},`${s.exercise_id}-${c}`)}),k.length===0&&e.jsx("div",{className:"p-6 border-2 border-dashed rounded-xl text-center text-muted-foreground",children:"Aucun exercice disponible pour cette séance."})]}),e.jsx(_s,{children:e.jsxs(F,{className:"flex-1 h-14 rounded-xl font-bold text-base bg-primary hover:bg-primary/90 shadow-lg",onClick:ye,children:[e.jsx(Xt,{className:"h-5 w-5 mr-2"}),"Lancer la séance"]})})]})]}),e.jsxs(Yt,{value:"history",className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(it,{htmlFor:"strength-history-status",children:"Statut"}),e.jsxs(Bs,{value:V,onValueChange:f,children:[e.jsx(qs,{id:"strength-history-status",children:e.jsx(Vs,{placeholder:"Tous"})}),e.jsxs(Us,{children:[e.jsx(yt,{value:"all",children:"Tous"}),e.jsx(yt,{value:"in_progress",children:"En cours"}),e.jsx(yt,{value:"completed",children:"Terminé"}),e.jsx(yt,{value:"abandoned",children:"Abandonné"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(it,{htmlFor:"strength-history-from",children:"Du"}),e.jsx(Mt,{id:"strength-history-from",type:"date",value:K,onChange:s=>Y(s.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(it,{htmlFor:"strength-history-to",children:"Au"}),e.jsx(Mt,{id:"strength-history-to",type:"date",value:Z,onChange:s=>U(s.target.value)})]})]}),Pe.map(s=>e.jsx(Ye,{className:"group hover:border-primary/50 transition-colors",children:e.jsxs(_t,{className:"pb-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(Lt,{className:"text-base font-bold uppercase",children:jt(new Date(s.started_at||s.date||s.created_at||new Date),"dd MMM yyyy",{locale:wt})}),e.jsxs("div",{className:"text-sm font-mono font-bold text-muted-foreground group-hover:text-primary",children:[s.duration??0," min"]})]}),e.jsxs("div",{className:"flex gap-2 text-xs font-bold text-muted-foreground",children:[e.jsxs("span",{children:["Difficulté ",s.feeling??s.rpe??0,"/5"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[s.logs?.length||0," Séries"]})]})]})},s.id)),Pe.length===0&&e.jsx("div",{className:"text-center text-muted-foreground py-10",children:"Aucun historique."}),_e.hasNextPage&&e.jsx(F,{variant:"outline",size:"sm",className:"w-full",onClick:()=>_e.fetchNextPage(),disabled:_e.isFetchingNextPage,children:_e.isFetchingNextPage?"Chargement...":"Charger plus"})]})]})]})})}export{Pt as buildInProgressRunCache,Jn as createInProgressRun,jr as default,Rs as orderStrengthItems,Gn as resetStrengthRunState};
