const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StrengthCatalog-C25_EO0s.js","assets/vendor-ui-DJQMR4VV.js","assets/vendor-react-BzrpNAyj.js","assets/vendor-query-BT4y-huw.js","assets/index-z3useTMX.js","assets/vendor-charts-Db4xOvcx.js","assets/vendor-supabase-D7B1G6YZ.js","assets/index-BeFE1WTb.css","assets/select-2Kw1Thu3.js","assets/chevron-up-CvUh4QOl.js","assets/check-7K5nxiCH.js","assets/circle-BQVWOXq7.js","assets/textarea-Cu-FDyyF.js","assets/dialog-DRNS3_dA.js","assets/checkbox-C3YgpEIz.js","assets/alert-dialog-Dgnopvp6.js","assets/tabs-CqeKwDdZ.js","assets/FormActions-CVcTU-03.js","assets/chevron-left-DcIQfTDw.js","assets/save-D1C23Vdm.js","assets/trash-2-B75zHwTw.js","assets/loader-circle-BXZz_PNh.js","assets/circle-alert-CIs0mzRc.js","assets/pen-ClrilBmy.js","assets/SwimCatalog-C_1LzgoS.js","assets/SwimSessionConsultation-CMSLUrSP.js","assets/badge-BadjYOYM.js","assets/timer-CcrDHMQH.js","assets/vendor-date-cQbdWov0.js","assets/search-DfVsTs0L.js"])))=>i.map(i=>d[i]);
import{c as Fe,k as bs,a as ue,B as b,f as ve,d as T,C,g as w,h as _,l as P,i as S,L as F,I as je,M as me,u as fe,b as Ns,U as le,P as Ae,m as Cs,W as Te,D as ws,T as _s,_ as De}from"./index-z3useTMX.js";import{r as d,b as ye,h as be,j as e,l as ee,R as I,d as Oe,m as Ge,I as Ps,n as Ss,o as Rs,c as As,p as $e,q as Ts,s as Es,u as ze,A as Ve,t as qe,v as ks,w as Ms,x as Is,y as Fs,F as Ds,D as Os,z as Gs,B as $s}from"./vendor-ui-DJQMR4VV.js";import{c as Ne,u as H,b as zs}from"./vendor-query-BT4y-huw.js";import{T as Vs,a as qs,b as Ee,c as oe,d as Ls,e as ie}from"./table-dApkGLiL.js";import{B as Bs}from"./badge-BadjYOYM.js";import{A as Hs}from"./arrow-left-rXPY-vhN.js";import{C as Us}from"./checkbox-C3YgpEIz.js";import{S as U,a as K,b as W,c as Q,d as R}from"./select-2Kw1Thu3.js";import{C as Ks}from"./chevron-up-CvUh4QOl.js";import{T as Ws}from"./textarea-Cu-FDyyF.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-Db4xOvcx.js";import"./vendor-supabase-D7B1G6YZ.js";import"./check-7K5nxiCH.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],se=Fe("bell",Qs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],ke=Fe("heart-pulse",Js);function Zs(s,a,{checkForDefaultPrevented:n=!0}={}){return function(t){if(s?.(t),n===!1||!t.defaultPrevented)return a?.(t)}}var Xs=ye[" useInsertionEffect ".trim().toString()]||be;function Ys({prop:s,defaultProp:a,onChange:n=()=>{},caller:r}){const[t,i,c]=et({defaultProp:a,onChange:n}),l=s!==void 0,h=l?s:t;{const u=d.useRef(s!==void 0);d.useEffect(()=>{const m=u.current;m!==l&&console.warn(`${r} is changing from ${m?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=l},[l,r])}const g=d.useCallback(u=>{if(l){const m=st(u)?u(s):u;m!==s&&c.current?.(m)}else i(u)},[l,s,i,c]);return[h,g]}function et({defaultProp:s,onChange:a}){const[n,r]=d.useState(s),t=d.useRef(n),i=d.useRef(a);return Xs(()=>{i.current=a},[a]),d.useEffect(()=>{t.current!==n&&(i.current?.(n),t.current=n)},[n,t]),[n,r,i]}function st(s){return typeof s=="function"}var Le="Toggle",Ce=d.forwardRef((s,a)=>{const{pressed:n,defaultPressed:r,onPressedChange:t,...i}=s,[c,l]=Ys({prop:n,onChange:t,defaultProp:r??!1,caller:Le});return e.jsx(ee.button,{type:"button","aria-pressed":c,"data-state":c?"on":"off","data-disabled":s.disabled?"":void 0,...i,ref:a,onClick:Zs(s.onClick,()=>{s.disabled||l(!c)})})});Ce.displayName=Le;var Be=Ce,tt=ye[" useInsertionEffect ".trim().toString()]||be;function He({prop:s,defaultProp:a,onChange:n=()=>{},caller:r}){const[t,i,c]=nt({defaultProp:a,onChange:n}),l=s!==void 0,h=l?s:t;{const u=d.useRef(s!==void 0);d.useEffect(()=>{const m=u.current;m!==l&&console.warn(`${r} is changing from ${m?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=l},[l,r])}const g=d.useCallback(u=>{if(l){const m=rt(u)?u(s):u;m!==s&&c.current?.(m)}else i(u)},[l,s,i,c]);return[h,g]}function nt({defaultProp:s,onChange:a}){const[n,r]=d.useState(s),t=d.useRef(n),i=d.useRef(a);return tt(()=>{i.current=a},[a]),d.useEffect(()=>{t.current!==n&&(i.current?.(n),t.current=n)},[n,t]),[n,r,i]}function rt(s){return typeof s=="function"}var $="ToggleGroup",[Ue]=Oe($,[Ge]),Ke=Ge(),we=I.forwardRef((s,a)=>{const{type:n,...r}=s;if(n==="single"){const t=r;return e.jsx(at,{...t,ref:a})}if(n==="multiple"){const t=r;return e.jsx(ot,{...t,ref:a})}throw new Error(`Missing prop \`type\` expected on \`${$}\``)});we.displayName=$;var[We,Qe]=Ue($),at=I.forwardRef((s,a)=>{const{value:n,defaultValue:r,onValueChange:t=()=>{},...i}=s,[c,l]=He({prop:n,defaultProp:r??"",onChange:t,caller:$});return e.jsx(We,{scope:s.__scopeToggleGroup,type:"single",value:I.useMemo(()=>c?[c]:[],[c]),onItemActivate:l,onItemDeactivate:I.useCallback(()=>l(""),[l]),children:e.jsx(Je,{...i,ref:a})})}),ot=I.forwardRef((s,a)=>{const{value:n,defaultValue:r,onValueChange:t=()=>{},...i}=s,[c,l]=He({prop:n,defaultProp:r??[],onChange:t,caller:$}),h=I.useCallback(u=>l((m=[])=>[...m,u]),[l]),g=I.useCallback(u=>l((m=[])=>m.filter(f=>f!==u)),[l]);return e.jsx(We,{scope:s.__scopeToggleGroup,type:"multiple",value:c,onItemActivate:h,onItemDeactivate:g,children:e.jsx(Je,{...i,ref:a})})});we.displayName=$;var[it,lt]=Ue($),Je=I.forwardRef((s,a)=>{const{__scopeToggleGroup:n,disabled:r=!1,rovingFocus:t=!0,orientation:i,dir:c,loop:l=!0,...h}=s,g=Ke(n),u=Ss(c),m={role:"group",dir:u,...h};return e.jsx(it,{scope:n,rovingFocus:t,disabled:r,children:t?e.jsx(Rs,{asChild:!0,...g,orientation:i,dir:u,loop:l,children:e.jsx(ee.div,{...m,ref:a})}):e.jsx(ee.div,{...m,ref:a})})}),de="ToggleGroupItem",Ze=I.forwardRef((s,a)=>{const n=Qe(de,s.__scopeToggleGroup),r=lt(de,s.__scopeToggleGroup),t=Ke(s.__scopeToggleGroup),i=n.value.includes(s.value),c=r.disabled||s.disabled,l={...s,pressed:i,disabled:c},h=I.useRef(null);return r.rovingFocus?e.jsx(Ps,{asChild:!0,...t,focusable:!c,active:i,ref:h,children:e.jsx(Me,{...l,ref:a})}):e.jsx(Me,{...l,ref:a})});Ze.displayName=de;var Me=I.forwardRef((s,a)=>{const{__scopeToggleGroup:n,value:r,...t}=s,i=Qe(de,n),c={role:"radio","aria-checked":s.pressed,"aria-pressed":void 0},l=i.type==="single"?c:void 0;return e.jsx(Ce,{...l,...t,ref:a,onPressedChange:h=>{h?i.onItemActivate(r):i.onItemDeactivate(r)}})}),Xe=we,Ye=Ze;const es=bs("inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-2 min-w-9",sm:"h-8 px-1.5 min-w-8",lg:"h-10 px-2.5 min-w-10"}},defaultVariants:{variant:"default",size:"default"}}),ct=d.forwardRef(({className:s,variant:a,size:n,...r},t)=>e.jsx(Be,{ref:t,className:ue(es({variant:a,size:n,className:s})),...r}));ct.displayName=Be.displayName;const ss=d.createContext({size:"default",variant:"default"}),ts=d.forwardRef(({className:s,variant:a,size:n,children:r,...t},i)=>e.jsx(Xe,{ref:i,className:ue("flex items-center justify-center gap-1",s),...t,children:e.jsx(ss.Provider,{value:{variant:a,size:n},children:r})}));ts.displayName=Xe.displayName;const ce=d.forwardRef(({className:s,children:a,variant:n,size:r,...t},i)=>{const c=d.useContext(ss);return e.jsx(Ye,{ref:i,className:ue(es({variant:c.variant||n,size:c.size||r}),s),...t,children:a})});ce.displayName=Ye.displayName;const X=({title:s,description:a,onBack:n,actions:r})=>e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(b,{variant:"ghost",size:"sm",className:"-ml-2",onClick:n,children:[e.jsx(Hs,{className:"mr-2 h-4 w-4"}),"Retour à l'accueil"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:s}),a?e.jsx("p",{className:"text-sm text-muted-foreground",children:a}):null]}),r?e.jsx("div",{className:"flex items-center gap-2",children:r}):null]});function Y(s,a,{checkForDefaultPrevented:n=!0}={}){return function(t){if(s?.(t),n===!1||!t.defaultPrevented)return a?.(t)}}function dt(s){const a=ut(s),n=d.forwardRef((r,t)=>{const{children:i,...c}=r,l=d.Children.toArray(i),h=l.find(pt);if(h){const g=h.props.children,u=l.map(m=>m===h?d.Children.count(g)>1?d.Children.only(null):d.isValidElement(g)?g.props.children:null:m);return e.jsx(a,{...c,ref:t,children:d.isValidElement(g)?d.cloneElement(g,void 0,u):null})}return e.jsx(a,{...c,ref:t,children:i})});return n.displayName=`${s}.Slot`,n}function ut(s){const a=d.forwardRef((n,r)=>{const{children:t,...i}=n;if(d.isValidElement(t)){const c=ht(t),l=gt(i,t.props);return t.type!==d.Fragment&&(l.ref=r?As(r,c):c),d.cloneElement(t,l)}return d.Children.count(t)>1?d.Children.only(null):null});return a.displayName=`${s}.SlotClone`,a}var mt=Symbol("radix.slottable");function pt(s){return d.isValidElement(s)&&typeof s.type=="function"&&"__radixId"in s.type&&s.type.__radixId===mt}function gt(s,a){const n={...a};for(const r in a){const t=s[r],i=a[r];/^on[A-Z]/.test(r)?t&&i?n[r]=(...l)=>{const h=i(...l);return t(...l),h}:t&&(n[r]=t):r==="style"?n[r]={...t,...i}:r==="className"&&(n[r]=[t,i].filter(Boolean).join(" "))}return{...s,...n}}function ht(s){let a=Object.getOwnPropertyDescriptor(s.props,"ref")?.get,n=a&&"isReactWarning"in a&&a.isReactWarning;return n?s.ref:(a=Object.getOwnPropertyDescriptor(s,"ref")?.get,n=a&&"isReactWarning"in a&&a.isReactWarning,n?s.props.ref:s.props.ref||s.ref)}var xt=ye[" useInsertionEffect ".trim().toString()]||be;function ft({prop:s,defaultProp:a,onChange:n=()=>{},caller:r}){const[t,i,c]=jt({defaultProp:a,onChange:n}),l=s!==void 0,h=l?s:t;{const u=d.useRef(s!==void 0);d.useEffect(()=>{const m=u.current;m!==l&&console.warn(`${r} is changing from ${m?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=l},[l,r])}const g=d.useCallback(u=>{if(l){const m=vt(u)?u(s):u;m!==s&&c.current?.(m)}else i(u)},[l,s,i,c]);return[h,g]}function jt({defaultProp:s,onChange:a}){const[n,r]=d.useState(s),t=d.useRef(n),i=d.useRef(a);return xt(()=>{i.current=a},[a]),d.useEffect(()=>{t.current!==n&&(i.current?.(n),t.current=n)},[n,t]),[n,r,i]}function vt(s){return typeof s=="function"}var pe="Popover",[ns]=Oe(pe,[$e]),te=$e(),[yt,z]=ns(pe),rs=s=>{const{__scopePopover:a,children:n,open:r,defaultOpen:t,onOpenChange:i,modal:c=!1}=s,l=te(a),h=d.useRef(null),[g,u]=d.useState(!1),[m,f]=ft({prop:r,defaultProp:t??!1,onChange:i,caller:pe});return e.jsx(Ts,{...l,children:e.jsx(yt,{scope:a,contentId:Es(),triggerRef:h,open:m,onOpenChange:f,onOpenToggle:d.useCallback(()=>f(N=>!N),[f]),hasCustomAnchor:g,onCustomAnchorAdd:d.useCallback(()=>u(!0),[]),onCustomAnchorRemove:d.useCallback(()=>u(!1),[]),modal:c,children:n})})};rs.displayName=pe;var as="PopoverAnchor",bt=d.forwardRef((s,a)=>{const{__scopePopover:n,...r}=s,t=z(as,n),i=te(n),{onCustomAnchorAdd:c,onCustomAnchorRemove:l}=t;return d.useEffect(()=>(c(),()=>l()),[c,l]),e.jsx(Ve,{...i,...r,ref:a})});bt.displayName=as;var os="PopoverTrigger",is=d.forwardRef((s,a)=>{const{__scopePopover:n,...r}=s,t=z(os,n),i=te(n),c=ze(a,t.triggerRef),l=e.jsx(ee.button,{type:"button","aria-haspopup":"dialog","aria-expanded":t.open,"aria-controls":t.contentId,"data-state":ms(t.open),...r,ref:c,onClick:Y(s.onClick,t.onOpenToggle)});return t.hasCustomAnchor?l:e.jsx(Ve,{asChild:!0,...i,children:l})});is.displayName=os;var _e="PopoverPortal",[Nt,Ct]=ns(_e,{forceMount:void 0}),ls=s=>{const{__scopePopover:a,forceMount:n,children:r,container:t}=s,i=z(_e,a);return e.jsx(Nt,{scope:a,forceMount:n,children:e.jsx(qe,{present:n||i.open,children:e.jsx(ks,{asChild:!0,container:t,children:r})})})};ls.displayName=_e;var J="PopoverContent",cs=d.forwardRef((s,a)=>{const n=Ct(J,s.__scopePopover),{forceMount:r=n.forceMount,...t}=s,i=z(J,s.__scopePopover);return e.jsx(qe,{present:r||i.open,children:i.modal?e.jsx(_t,{...t,ref:a}):e.jsx(Pt,{...t,ref:a})})});cs.displayName=J;var wt=dt("PopoverContent.RemoveScroll"),_t=d.forwardRef((s,a)=>{const n=z(J,s.__scopePopover),r=d.useRef(null),t=ze(a,r),i=d.useRef(!1);return d.useEffect(()=>{const c=r.current;if(c)return Ms(c)},[]),e.jsx(Is,{as:wt,allowPinchZoom:!0,children:e.jsx(ds,{...s,ref:t,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Y(s.onCloseAutoFocus,c=>{c.preventDefault(),i.current||n.triggerRef.current?.focus()}),onPointerDownOutside:Y(s.onPointerDownOutside,c=>{const l=c.detail.originalEvent,h=l.button===0&&l.ctrlKey===!0,g=l.button===2||h;i.current=g},{checkForDefaultPrevented:!1}),onFocusOutside:Y(s.onFocusOutside,c=>c.preventDefault(),{checkForDefaultPrevented:!1})})})}),Pt=d.forwardRef((s,a)=>{const n=z(J,s.__scopePopover),r=d.useRef(!1),t=d.useRef(!1);return e.jsx(ds,{...s,ref:a,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{s.onCloseAutoFocus?.(i),i.defaultPrevented||(r.current||n.triggerRef.current?.focus(),i.preventDefault()),r.current=!1,t.current=!1},onInteractOutside:i=>{s.onInteractOutside?.(i),i.defaultPrevented||(r.current=!0,i.detail.originalEvent.type==="pointerdown"&&(t.current=!0));const c=i.target;n.triggerRef.current?.contains(c)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&t.current&&i.preventDefault()}})}),ds=d.forwardRef((s,a)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:t,onCloseAutoFocus:i,disableOutsidePointerEvents:c,onEscapeKeyDown:l,onPointerDownOutside:h,onFocusOutside:g,onInteractOutside:u,...m}=s,f=z(J,n),N=te(n);return Fs(),e.jsx(Ds,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:t,onUnmountAutoFocus:i,children:e.jsx(Os,{asChild:!0,disableOutsidePointerEvents:c,onInteractOutside:u,onEscapeKeyDown:l,onPointerDownOutside:h,onFocusOutside:g,onDismiss:()=>f.onOpenChange(!1),children:e.jsx(Gs,{"data-state":ms(f.open),role:"dialog",id:f.contentId,...N,...m,ref:a,style:{...m.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),us="PopoverClose",St=d.forwardRef((s,a)=>{const{__scopePopover:n,...r}=s,t=z(us,n);return e.jsx(ee.button,{type:"button",...r,ref:a,onClick:Y(s.onClick,()=>t.onOpenChange(!1))})});St.displayName=us;var Rt="PopoverArrow",At=d.forwardRef((s,a)=>{const{__scopePopover:n,...r}=s,t=te(n);return e.jsx($s,{...t,...r,ref:a})});At.displayName=Rt;function ms(s){return s?"open":"closed"}var Tt=rs,Et=is,kt=ls,ps=cs;const Mt=Tt,It=Et,gs=d.forwardRef(({className:s,align:a="center",sideOffset:n=4,...r},t)=>e.jsx(kt,{children:e.jsx(ps,{ref:t,align:a,sideOffset:n,className:ue("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",s),...r})}));gs.displayName=ps.displayName;const Ft=({onBack:s,swimSessions:a,strengthSessions:n,athletes:r,groups:t})=>{const{toast:i}=ve(),[c,l]=d.useState({session_type:"swim",session_id:"",assigned_date:new Date().toISOString().split("T")[0],assigned_slot:"morning"}),[h,g]=d.useState(!1),[u,m]=d.useState("user"),[f,N]=d.useState(""),[j,D]=d.useState([]),p=o=>{const x=typeof o=="number"?o:Number(o);return Number.isFinite(x)&&x>0?x:null},V=d.useMemo(()=>r.map(o=>({value:o.id?`id:${o.id}`:`name:${o.display_name}`,label:o.group_label?`${o.display_name} · ${o.group_label}`:o.display_name,id:o.id,name:o.display_name})),[r]),ne=d.useMemo(()=>new Map(V.map(o=>[o.value,o])),[V]),Z=d.useMemo(()=>t.map(o=>{const x=p(o.id);return x?{...o,gid:x}:null}).filter(o=>!!o),[t]),O=d.useMemo(()=>Z.filter(o=>j.includes(o.gid)),[Z,j]),ge=d.useMemo(()=>{if(O.length===0)return"Choisir des groupes";const o=O.slice(0,2).map(E=>E.name).join(", "),x=O.length>2?` +${O.length-2}`:"";return`${o}${x}`},[O]),B=Ne({mutationFn:async o=>T.assignments_create(o),onSuccess:()=>{i({title:"Séance assignée & notifiée"})},onError:o=>{const x="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",E=o instanceof Error?o.message:typeof o=="string"?o:x;let k=E;const A=E.match(/HTTP \d+:\s*(\{.*\})/);if(A)try{k=JSON.parse(A[1])?.error||x}catch{k=x}i({title:"Erreur d'assignation",description:k})}}),he=async()=>{const o=Number(c.session_id);if(!Number.isInteger(o)||o<=0){i({title:"Séance invalide",description:"Sélectionnez une séance valide."});return}if(u==="group"){if(j.length===0){i({title:"Groupe manquant",description:"Sélectionnez au moins un groupe."});return}g(!0);try{const M={assignment_type:c.session_type,session_id:o,scheduled_date:c.assigned_date,scheduled_slot:c.assigned_slot},q=Array.from(new Set(j));await Promise.all(q.map(y=>T.assignments_create({...M,target_group_id:y}))),i({title:"Séance assignée & notifiée"})}catch(M){const q="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",y=M instanceof Error?M.message:typeof M=="string"?M:q;let L=y;const ae=y.match(/HTTP \d+:\s*(\{.*\})/);if(ae)try{L=JSON.parse(ae[1])?.error||q}catch{L=q}i({title:"Erreur d'assignation",description:L})}finally{g(!1)}return}const x=f.trim();if(!x){i({title:"Nageur manquant",description:"Sélectionnez un nageur."});return}const E=ne.get(x),k=E?.id??(Number.isFinite(Number(x))&&Number(x)>0?Number(x):void 0);if(!Number.isFinite(k)||Number(k)<=0){i({title:"Nageur invalide",description:"Sélectionnez un nageur avec un identifiant valide."});return}const A=E?.name??x.replace(/^name:/,"");B.mutate({assignment_type:c.session_type,session_id:o,target_athlete:A,target_user_id:k,scheduled_date:c.assigned_date,scheduled_slot:c.assigned_slot})},re=!c.session_id||(u==="group"?j.length===0:!f.trim())||B.isPending||h;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(X,{title:"Assigner une séance",description:"Planifiez une séance pour un nageur ou un ou plusieurs groupes.",onBack:s}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(C,{className:"border-l-4 border-l-primary",children:[e.jsxs(w,{children:[e.jsx(_,{children:"Séance"}),e.jsx(P,{children:"Choisissez le type et la séance à envoyer."})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Type"}),e.jsxs(U,{value:c.session_type,onValueChange:o=>l({...c,session_type:o,session_id:""}),children:[e.jsx(K,{children:e.jsx(W,{})}),e.jsxs(Q,{children:[e.jsx(R,{value:"swim",children:"Natation"}),e.jsx(R,{value:"strength",children:"Musculation"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Séance"}),e.jsxs(U,{value:c.session_id,onValueChange:o=>l({...c,session_id:o}),children:[e.jsx(K,{children:e.jsx(W,{placeholder:"Choisir..."})}),e.jsx(Q,{children:c.session_type==="swim"?a?.map(o=>e.jsx(R,{value:o.id.toString(),children:o.name},o.id)):n?.map(o=>e.jsx(R,{value:o.id.toString(),children:o.title},o.id))})]})]})]})]}),e.jsxs(C,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Cible & planification"}),e.jsx(P,{children:"Définissez le destinataire, la date et le créneau."})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Cible"}),e.jsxs(U,{value:u,onValueChange:o=>{m(o),N(""),D([])},children:[e.jsx(K,{children:e.jsx(W,{})}),e.jsxs(Q,{children:[e.jsx(R,{value:"user",children:"Nageur"}),e.jsx(R,{value:"group",children:"Groupe(s)"})]})]})]}),u==="user"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Nageur"}),V.length>0?e.jsxs(U,{value:f,onValueChange:N,children:[e.jsx(K,{children:e.jsx(W,{placeholder:"Choisir un nageur"})}),e.jsx(Q,{children:V.map(o=>e.jsx(R,{value:o.value,children:o.label},o.value))})]}):e.jsx(je,{value:f,onChange:o=>N(o.target.value),placeholder:"ex: Camille"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Groupes"}),t.length>0?e.jsxs(Mt,{children:[e.jsx(It,{asChild:!0,children:e.jsxs(b,{type:"button",variant:"outline",className:"w-full justify-between","aria-label":"Sélection des groupes",children:[e.jsx("span",{className:"truncate",children:ge}),e.jsx(Ks,{className:"ml-2 h-4 w-4 opacity-50"})]})}),e.jsxs(gs,{className:"w-[--radix-popover-trigger-width] p-2",align:"start",children:[e.jsx("div",{className:"max-h-64 overflow-auto",children:e.jsx("div",{className:"space-y-1",children:Z.map(o=>{const x=j.includes(o.gid);return e.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 hover:bg-muted",children:[e.jsx(Us,{checked:x,onCheckedChange:E=>{const k=E===!0;D(A=>k?A.includes(o.gid)?A:[...A,o.gid]:A.filter(M=>M!==o.gid))}}),e.jsx("span",{className:"text-sm",children:o.name})]},o.gid)})})}),j.length>0?e.jsx(b,{type:"button",variant:"ghost",size:"sm",className:"mt-2 w-full",onClick:()=>D([]),children:"Tout désélectionner"}):null]})]}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"Aucun groupe disponible."}),j.length>0?e.jsxs("div",{className:"text-xs text-muted-foreground",children:[j.length," groupe",j.length>1?"s":""," sélectionné",j.length>1?"s":"","."]}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Date"}),e.jsx(je,{type:"date",value:c.assigned_date,onChange:o=>l({...c,assigned_date:o.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Créneau"}),e.jsxs(U,{value:c.assigned_slot,onValueChange:o=>l({...c,assigned_slot:o}),children:[e.jsx(K,{children:e.jsx(W,{placeholder:"Choisir..."})}),e.jsxs(Q,{children:[e.jsx(R,{value:"morning",children:"Matin"}),e.jsx(R,{value:"evening",children:"Soir"})]})]})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(b,{className:"w-full sm:w-auto",onClick:he,disabled:re,children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),B.isPending||h?"Assignation...":"Assigner & notifier"]})})]})},Dt=({onBack:s,athletes:a,groups:n,athletesLoading:r})=>{const{toast:t}=ve(),[i,c]=d.useState(""),[l,h]=d.useState("Message Coach"),[g,u]=d.useState(""),m=d.useMemo(()=>a.filter(p=>p.id).map(p=>({value:`user:${p.id}`,label:p.group_label?`${p.display_name} · ${p.group_label}`:p.display_name,id:p.id})),[a]),f=d.useMemo(()=>n.map(p=>({value:`group:${p.id}`,label:p.name,id:p.id})),[n]),N=d.useMemo(()=>new Map([...m,...f].map(p=>[p.value,p])),[m,f]),j=Ne({mutationFn:p=>T.notifications_send({...p,type:"message"}),onSuccess:()=>{t({title:"Message envoyé"}),c("")}}),D=()=>{if(!l.trim()||!i.trim()){t({title:"Message incomplet",description:"Ajoutez un titre et un contenu."});return}if(!g){t({title:"Destinataire manquant",description:"Sélectionnez un nageur ou un groupe."});return}const p=N.get(g);if(!p?.id){t({title:"Destinataire invalide",description:"Sélectionnez un destinataire valide."});return}if(g.startsWith("group:")){j.mutate({title:l,body:i,targets:[{target_group_id:p.id}]});return}j.mutate({title:l,body:i,targets:[{target_user_id:p.id}]})};return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(X,{title:"Messagerie rapide",description:"Envoyez un message ciblé à vos nageurs.",onBack:s}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(C,{className:"border-l-4 border-l-primary",children:[e.jsxs(w,{children:[e.jsx(_,{children:"Destinataire"}),e.jsx(P,{children:"Sélectionnez un nageur ou un groupe à prévenir."})]}),e.jsx(S,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:"Destinataire"}),e.jsxs(U,{value:g,onValueChange:u,children:[e.jsx(K,{children:e.jsx(W,{placeholder:r?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(Q,{children:[f.length?e.jsxs(e.Fragment,{children:[e.jsx(R,{value:"section-group",disabled:!0,children:"Groupes"}),f.map(p=>e.jsx(R,{value:p.value,children:p.label},p.value))]}):null,m.length?e.jsxs(e.Fragment,{children:[e.jsx(R,{value:"section-athlete",disabled:!0,children:"Nageurs"}),m.map(p=>e.jsx(R,{value:p.value,children:p.label},p.value))]}):null]})]})]})})]}),e.jsxs(C,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Contenu"}),e.jsx(P,{children:"Rédigez votre message en quelques lignes."})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"msg-title",children:"Titre"}),e.jsx(je,{id:"msg-title",value:l,onChange:p=>h(p.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"msg-body",children:"Message"}),e.jsx(Ws,{id:"msg-body",placeholder:"Message...",value:i,onChange:p=>c(p.target.value),rows:5,maxLength:500}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[i.length,"/500"]})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(b,{className:"w-full sm:w-auto",onClick:D,disabled:j.isPending,children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),j.isPending?"Envoi...":"Envoyer"]})})]})},Ot=d.lazy(()=>De(()=>import("./StrengthCatalog-C25_EO0s.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]))),Gt=d.lazy(()=>De(()=>import("./SwimCatalog-C_1LzgoS.js"),__vite__mapDeps([24,1,2,3,4,5,6,7,13,15,25,26,27,22,20,12,8,9,10,17,18,19,28,29]))),$t=({onNavigate:s})=>e.jsxs(C,{className:"border-l-4 border-l-primary",children:[e.jsxs(w,{children:[e.jsx(_,{children:"Actions rapides"}),e.jsx(P,{children:"Accélérez vos tâches les plus fréquentes."})]}),e.jsxs(S,{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs(b,{className:"justify-start",variant:"outline",onClick:()=>s("assignments"),children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Assigner une séance"]}),e.jsxs(b,{className:"justify-start",variant:"outline",onClick:()=>s("messaging"),children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),"Message rapide"]})]})]}),zt=({onNavigate:s,onOpenRecordsAdmin:a,athletes:n,athletesLoading:r,upcomingBirthdays:t,birthdaysLoading:i,kpiLoading:c,kpiPeriod:l,onKpiPeriodChange:h,fatigueAlerts:g,mostLoadedAthlete:u})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Espace Coach"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Votre tableau de bord pour gérer les séances, les nageurs et la communication."})]}),e.jsxs("div",{className:"space-y-3 sm:hidden",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-sm font-semibold uppercase tracking-[0.2em] text-muted-foreground",children:"Par où commencer"})}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("button",{type:"button",onClick:()=>s("swim"),className:"rounded-xl border bg-white p-4 text-left shadow-sm transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Créer une séance natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Structurer un nouveau plan."})]}),e.jsx(Te,{className:"h-5 w-5 text-primary"})]})}),e.jsx("button",{type:"button",onClick:()=>s("assignments"),className:"rounded-xl border bg-white p-4 text-left shadow-sm transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Assigner une séance"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Envoyer une séance à un nageur."})]}),e.jsx(se,{className:"h-5 w-5 text-primary"})]})}),e.jsx("button",{type:"button",onClick:()=>s("messaging"),className:"rounded-xl border bg-white p-4 text-left shadow-sm transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold",children:"Envoyer un message"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Relancer ou féliciter un nageur."})]}),e.jsx(me,{className:"h-5 w-5 text-primary"})]})})]})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsx($t,{onNavigate:s})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(C,{className:"shadow-sm",children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5 text-primary"}),"Natation"]}),e.jsx(P,{children:"Consultez et créez des séances natation."})]}),e.jsx(S,{children:e.jsx(b,{className:"w-full",onClick:()=>s("swim"),children:"Accéder à la bibliothèque"})})]}),e.jsxs(C,{className:"shadow-sm",children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(ws,{className:"h-5 w-5 text-primary"}),"Musculation"]}),e.jsx(P,{children:"Préparez les plans muscu et les suivis."})]}),e.jsx(S,{children:e.jsx(b,{className:"w-full",onClick:()=>s("strength"),children:"Accéder à la bibliothèque"})})]}),e.jsxs(C,{className:"shadow-sm",children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5 text-primary"}),"Mes nageurs"]}),e.jsx(P,{children:"Accédez aux fiches individuelles et aux groupes."})]}),e.jsx(S,{children:e.jsx(b,{className:"w-full",onClick:()=>s("swimmers"),children:"Voir les nageurs"})})]}),e.jsxs(C,{className:"shadow-sm",children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(_s,{className:"h-5 w-5 text-primary"}),"Records club"]}),e.jsx(P,{children:"Importer les performances FFN et reconstruire les records."})]}),e.jsxs(S,{children:[e.jsx(b,{className:"w-full",variant:"outline",onClick:a,children:"Administration des records"}),e.jsx(b,{className:"w-full mt-2",variant:"outline",onClick:()=>{window.location.hash="#/records-club"},children:"Voir les records du club"})]})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(C,{className:"sm:hidden bg-primary text-primary-foreground",children:[e.jsxs(w,{className:"space-y-1",children:[e.jsx(_,{className:"text-base",children:"Indicateurs clés"}),e.jsx(P,{className:"text-primary-foreground/70",children:"Synthèse rapide pour aujourd'hui."})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-primary-foreground/10 bg-primary-foreground/5 p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-primary-foreground/70",children:"Fatigue 5/5"}),e.jsx("p",{className:"text-2xl font-semibold",children:c?"…":g.length}),e.jsx("p",{className:"text-xs text-primary-foreground/70",children:c?"Chargement...":g.length?g.slice(0,2).map(m=>m.athleteName).join(", "):"Aucune alerte"})]}),e.jsx(ke,{className:"h-5 w-5 text-primary-foreground/70"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-primary-foreground/10 bg-primary-foreground/5 p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-primary-foreground/70",children:"Nageur le plus chargé"}),e.jsx("p",{className:"text-lg font-semibold",children:c?"…":u?.athleteName??"-"}),e.jsx("p",{className:"text-xs text-primary-foreground/70",children:c?"Calcul en cours":u?`Charge ${Math.round(u.loadScore)}`:"Pas de données récentes"})]}),e.jsx(le,{className:"h-5 w-5 text-primary-foreground/70"})]})]})]}),e.jsxs(C,{className:"hidden sm:block",children:[e.jsx(w,{className:"space-y-2",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(_,{children:"Signaux clés"}),e.jsx(P,{children:"Vue d'ensemble rapide de votre groupe."})]}),e.jsxs(ts,{type:"single",size:"sm",variant:"outline",value:String(l),onValueChange:m=>{m&&h(Number(m))},children:[e.jsx(ce,{value:"7","aria-label":"Période 7 jours","aria-pressed":l===7,children:"7j"}),e.jsx(ce,{value:"30","aria-label":"Période 30 jours","aria-pressed":l===30,children:"30j"}),e.jsx(ce,{value:"365","aria-label":"Période 365 jours","aria-pressed":l===365,children:"365j"})]})]})}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border bg-muted/30 p-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Fatigue 5/5 (",l,"j)"]}),e.jsx("p",{className:"text-xl font-semibold",children:c?"…":g.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c?"Chargement...":g.length?g.slice(0,2).map(m=>m.athleteName).join(", "):"Aucune alerte"})]}),e.jsx(ke,{className:"h-5 w-5 text-muted-foreground"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border bg-muted/30 p-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Nageur le plus chargé (",l,"j)"]}),e.jsx("p",{className:"text-xl font-semibold",children:c?"…":u?.athleteName??"-"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:c?"Calcul en cours":u?`Charge ${Math.round(u.loadScore)}`:"Pas de données récentes"})]}),e.jsx(le,{className:"h-5 w-5 text-muted-foreground"})]})]})]}),e.jsxs(C,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Anniversaires à venir"}),e.jsx(P,{children:"Les 30 prochains jours."})]}),e.jsxs(S,{className:"space-y-3",children:[i?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Chargement..."}):t&&t.length>0?t.slice(0,3).map(m=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:m.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Vt(m.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-semibold text-primary",children:["J-",m.days_until]})]},m.id)):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun anniversaire dans les 30 prochains jours."}),e.jsx(b,{variant:"outline",className:"w-full",onClick:()=>s("swimmers"),children:"Voir tous les nageurs"})]})]})]})]}),Vt=s=>{if(!s)return"-";const a=new Date(s);return Number.isNaN(a.getTime())?s:a.toLocaleDateString("fr-FR")},Ie=s=>s.toISOString().split("T")[0],qt=s=>new Date(s.completed_at||s.started_at||s.date||s.created_at||0).getTime(),Lt=s=>{if(!s.length)return null;const a=s.reduce((r,t)=>r+t,0)/s.length,n=Math.min(5,Math.max(1,Math.round(a/10*5)));return{average:a,rating:n}};function an(){const s=fe(o=>o.role);fe(o=>o.selectedAthleteId);const a=fe(o=>o.setSelectedAthlete),[,n]=Ns(),[r,t]=d.useState("home"),[i,c]=d.useState(7),l=s==="coach"||s==="admin",h=r==="assignments",g=r==="home"||r==="assignments"||r==="messaging"||r==="swimmers",u=r==="assignments"||r==="messaging",m=r==="home"||r==="swimmers",{data:f}=H({queryKey:["swim_catalog"],queryFn:()=>T.getSwimCatalog(),enabled:l&&h}),{data:N}=H({queryKey:["strength_catalog"],queryFn:()=>T.getStrengthSessions(),enabled:l&&h}),{data:j=[],isLoading:D}=H({queryKey:["athletes"],queryFn:()=>T.getAthletes(),enabled:l&&g}),p=d.useMemo(()=>j.slice(0,5),[j]),{data:V=[]}=H({queryKey:["groups"],queryFn:()=>T.getGroups(),enabled:l&&u}),ne=H({queryKey:["upcoming-birthdays"],queryFn:()=>T.getUpcomingBirthdays({days:30}),enabled:l&&m}),Z=ne.data,O=H({queryKey:["coach-kpis",i,p.map(o=>o.id??o.display_name)],enabled:l&&r==="home"&&p.length>0,queryFn:async()=>{const o=i,x=new Date;x.setDate(x.getDate()-o);const E=Ie(x),k=Ie(new Date),A=await Promise.all(p.map(async y=>{const[L,ae]=await Promise.all([T.getSessions(y.display_name,y.id),T.getStrengthHistory(y.display_name,{athleteId:y.id,limit:50,from:E,to:k})]),xe=L.filter(v=>new Date(v.date).getTime()>=x.getTime()),hs=xe.map(v=>v.fatigue??v.feeling).filter(v=>Number.isFinite(v)),xs=xe.reduce((v,G)=>v+(Number(G.duration)||0)*(Number(G.effort)||0),0),Pe=(ae?.runs??[]).filter(v=>qt(v)>=x.getTime()),fs=Pe.map(v=>v.fatigue??v.feeling??v.rpe).filter(v=>Number.isFinite(Number(v))).map(v=>Number(v)),js=Pe.reduce((v,G)=>{const Se=Number(G.feeling??G.rpe??0),Re=Number(G.duration??0);if(Re>0&&Se>0)return v+Re*Se;const ys=Array.isArray(G.logs)?G.logs.length:0;return v+ys*5},0),vs=Lt([...hs,...fs]);return{athleteName:y.display_name,loadScore:xs+js,fatigueRating:vs}})),M=A.filter(y=>y.fatigueRating?.rating===5).map(y=>({athleteName:y.athleteName,rating:y.fatigueRating?.rating??0})),q=A.filter(y=>y.loadScore>0).sort((y,L)=>L.loadScore-y.loadScore)[0];return{fatigueAlerts:M,mostLoadedAthlete:q??null}}}),ge=o=>{a({id:o.id??null,name:o.display_name}),n("/progress")},{toast:B}=ve(),he=zs(),re=Ne({mutationFn:async o=>{const x=await T.importSingleSwimmer(o.iuf,o.name);return await T.recalculateClubRecords(),x},onSuccess:o=>{B({title:"Import terminé",description:`${o.total_found} trouvées, ${o.new_imported} nouvelles.`}),he.invalidateQueries({queryKey:["club-records"]})},onError:o=>{B({title:"Erreur import",description:o.message,variant:"destructive"})}});return l?e.jsxs("div",{className:"space-y-6",children:[r==="home"?e.jsx(zt,{onNavigate:t,onOpenRecordsAdmin:()=>n("/records-admin"),athletes:j,athletesLoading:D,upcomingBirthdays:Z,birthdaysLoading:ne.isLoading,kpiLoading:O.isLoading,kpiPeriod:i,onKpiPeriodChange:c,fatigueAlerts:O.data?.fatigueAlerts??[],mostLoadedAthlete:O.data?.mostLoadedAthlete??null}):null,r==="assignments"?e.jsx(Ft,{onBack:()=>t("home"),swimSessions:f,strengthSessions:N,athletes:j,groups:V}):null,r==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(X,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>t("home"),actions:e.jsxs(b,{variant:"outline",onClick:()=>t("assignments"),children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(d.Suspense,{fallback:e.jsx(Ae,{}),children:e.jsx(Gt,{})})]}):null,r==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(X,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>t("home"),actions:e.jsxs(b,{variant:"outline",onClick:()=>t("assignments"),children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(d.Suspense,{fallback:e.jsx(Ae,{}),children:e.jsx(Ot,{})})]}):null,r==="swimmers"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(X,{title:"Nageurs",description:"Accédez aux fiches individuelles des nageurs.",onBack:()=>t("home"),actions:e.jsxs(b,{variant:"outline",onClick:()=>t("messaging"),children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),"Message rapide"]})}),e.jsxs(C,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Suivi des Nageurs"}),e.jsx(P,{children:"Accédez aux fiches individuelles des nageurs."})]}),e.jsx(S,{children:D?e.jsx("div",{className:"space-y-3 p-2",children:[1,2,3,4,5].map(o=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-1/3 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"h-4 w-1/4 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"ml-auto h-8 w-16 rounded-lg bg-muted animate-pulse motion-reduce:animate-none"})]},o))}):j.length?e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs(Vs,{children:[e.jsx(qs,{children:e.jsxs(Ee,{children:[e.jsx(oe,{children:"Nageur"}),e.jsx(oe,{children:"Groupe"}),e.jsx(oe,{children:"IUF"}),e.jsx(oe,{className:"text-right",children:"Actions"})]})}),e.jsx(Ls,{children:j.map(o=>e.jsxs(Ee,{children:[e.jsx(ie,{className:"font-medium",children:o.display_name}),e.jsx(ie,{children:o.group_label?e.jsx(Bs,{variant:"secondary",children:o.group_label}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"Sans groupe"})}),e.jsx(ie,{children:o.ffn_iuf?e.jsx("span",{className:"text-xs font-mono text-muted-foreground",children:o.ffn_iuf}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"-"})}),e.jsx(ie,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[o.ffn_iuf?e.jsx(b,{size:"sm",variant:"ghost",disabled:re.isPending,onClick:()=>re.mutate({iuf:o.ffn_iuf,name:o.display_name}),title:"Importer performances FFN",children:e.jsx(Cs,{className:"h-4 w-4"})}):null,e.jsx(b,{size:"sm",variant:"outline",onClick:()=>ge(o),children:"Voir la fiche"})]})})]},o.id??o.display_name))})]})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun nageur disponible."})})]})]}):null,r==="messaging"?e.jsx(Dt,{onBack:()=>t("home"),athletes:j,groups:V,athletesLoading:D}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(C,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(le,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(P,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(S,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}export{an as default};
