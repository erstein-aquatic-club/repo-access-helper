import{r,j as e}from"./vendor-ui-CDk0TPZB.js";import{u as q,a as W,C as X,b as J,e as Y,c as Z,d as $,f as ee,B as w,s as C,g as se}from"./index-DkY2h0px.js";import{u as re}from"./vendor-query-aL7hzhW6.js";import{I as c}from"./input-Dyipb55u.js";import{D as te,a as ae,b as ie,c as ne,d as oe}from"./dialog-D01RxeH2.js";import{L as l}from"./label-CqV2Lp4b.js";import{S as le,a as ce,b as de,c as ue,d as me}from"./select-BhyF-CVR.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-bGfQb4ap.js";import"./vendor-supabase-CgI36rMY.js";import"./check-DxsCHFcs.js";const pe=i=>i,ge=i=>{switch(i){case"coach":return"/coach";case"admin":return"/admin";case"comite":return"/comite";default:return"/"}};function Re(){const[i,M]=r.useState(""),[m,O]=r.useState(""),[S,f]=r.useState(null),[E,R]=r.useState(!1),[n,p]=r.useState(!1),[g,P]=r.useState(""),[x,I]=r.useState(""),[j,z]=r.useState(""),[v,F]=r.useState(""),[d,b]=r.useState(""),[D,a]=r.useState(null),[A,y]=r.useState(!1),[U,N]=r.useState(!1),{loginFromSession:V,loadUser:B}=q(),[,G]=W(),L=r.useRef(null),k=r.useRef(null),{data:u=[],isLoading:T,isError:H}=re({queryKey:["register-groups"],queryFn:()=>se.getGroups(),enabled:n,retry:2});r.useEffect(()=>{n&&!d&&u.length>0&&b(String(u[0].id))},[u,d,n]),r.useEffect(()=>{pe(n)&&k.current?.focus()},[n]);const _=s=>s.includes("Invalid login")?"Identifiant ou mot de passe incorrect.":s.includes("Email not confirmed")?"Veuillez confirmer votre email avant de vous connecter.":s,K=async s=>{s.preventDefault();const o=i.trim();if(o){if(!m.trim()){f("Mot de passe requis."),L.current?.focus();return}R(!0),f(null);try{const{data:t,error:h}=await C.auth.signInWithPassword({email:o,password:m});if(h)throw new Error(_(h.message));if(!t.session)throw new Error("Session non reçue.");if(V(t.session),!await B())throw new Error("Impossible de récupérer le profil utilisateur.");const Q=q.getState().role;G(ge(Q),{replace:!0})}catch(t){const h=t instanceof Error?t.message:"Connexion impossible.";f(h)}finally{R(!1)}}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-[-20%] right-[-10%] w-[600px] h-[600px] bg-primary/10 rounded-full blur-3xl pointer-events-none"}),e.jsxs(X,{className:"w-full max-w-sm relative z-10 shadow-2xl border-t-8 border-t-primary animate-in fade-in zoom-in duration-500 motion-reduce:animate-none",children:[e.jsxs(J,{className:"text-center pb-2",children:[e.jsx("div",{className:"mx-auto mb-6 h-24 w-24 rounded-full bg-foreground flex items-center justify-center border-4 border-primary shadow-lg",children:e.jsx("img",{src:Y,alt:"EAC Logo",loading:"lazy",className:"h-full w-full object-cover rounded-full opacity-90"})}),e.jsxs(Z,{className:"text-3xl font-display italic uppercase tracking-tighter",children:["SUIVI",e.jsx("span",{className:"text-primary",children:"NATATION"})]}),e.jsx($,{className:"uppercase tracking-widest text-xs font-bold",children:"Erstein Aquatic Club"})]}),e.jsx(ee,{children:e.jsxs("form",{onSubmit:K,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"login-email",className:"sr-only",children:"Email"}),e.jsx(c,{id:"login-email","aria-label":"Email",placeholder:"Email",type:"email",value:i,onChange:s=>{M(s.target.value),n&&p(!1)},className:"text-center text-lg h-12 border-2 focus-visible:ring-primary",autoFocus:!0}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Saisissez votre email et votre mot de passe."}),e.jsx(l,{htmlFor:"login-password",className:"sr-only",children:"Mot de passe"}),e.jsx(c,{id:"login-password","aria-label":"Mot de passe",placeholder:"Mot de passe",type:"password",value:m,onChange:s=>O(s.target.value),ref:L,className:"text-center text-lg h-12 border-2 focus-visible:ring-primary"}),S?e.jsx("div",{className:"rounded-lg border border-destructive/20 bg-destructive/10 p-3 text-sm text-destructive text-center",children:S}):null]}),e.jsx(w,{type:"submit",className:"w-full h-12 text-lg font-bold uppercase tracking-wider shadow-md hover:scale-[1.02] transition-transform",disabled:!i.trim()||!m.trim()||E,children:E?"Connexion...":"CONNEXION"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",onClick:()=>{p(!0);const s=i.trim();I(s)},className:"text-xs text-muted-foreground underline underline-offset-4 transition-colors hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2",children:"Créer un compte"})})]})})]}),e.jsx(te,{open:n,onOpenChange:s=>{p(s),s||(a(null),z(""),F(""),b(""),N(!1))},children:e.jsx(ae,{className:"sm:max-w-md",children:U?e.jsxs("div",{className:"text-center space-y-4 py-4",children:[e.jsx("div",{className:"mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-green-100",children:e.jsx("span",{className:"text-3xl text-green-600",children:"✓"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Compte créé avec succès !"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Un coach ou un administrateur doit valider votre inscription avant votre première connexion."}),e.jsx(w,{className:"w-full",variant:"outline",onClick:()=>{N(!1),p(!1)},children:"Retour à la connexion"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(ie,{children:[e.jsx(ne,{children:"Créer un compte"}),e.jsx(oe,{children:"Complétez les informations pour créer votre profil."})]}),e.jsxs("form",{className:"space-y-4",onSubmit:async s=>{if(s.preventDefault(),!g.trim()){a("Ajoutez votre nom.");return}if(!x.trim()){a("Ajoutez votre email.");return}if(!d){a("Sélectionnez un groupe.");return}if(!v){a("Ajoutez votre date de naissance.");return}if(!j){a("Choisissez un mot de passe.");return}a(null),y(!0);try{const{data:o,error:t}=await C.auth.signUp({email:x.trim(),password:j,options:{data:{display_name:g.trim(),birthdate:v,group_id:Number(d)}}});if(t)throw new Error(t.message);if(o.user){await C.auth.signOut(),N(!0),y(!1);return}a("Création impossible.")}catch(o){const t=o instanceof Error?o.message:"Création impossible.";a(t)}finally{y(!1)}},children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"register-name",children:"Nom d'affichage"}),e.jsx(c,{id:"register-name",value:g,onChange:s=>P(s.target.value),placeholder:"Votre nom",ref:k})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"register-email",children:"Email"}),e.jsx(c,{id:"register-email",type:"email",value:x,onChange:s=>I(s.target.value),placeholder:"prenom.nom@email.com",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"register-birthdate",children:"Date de naissance"}),e.jsx(c,{id:"register-birthdate",type:"date",value:v,onChange:s=>F(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"register-group",children:"Groupe"}),e.jsxs(le,{value:d,onValueChange:b,disabled:T||u.length===0,children:[e.jsx(ce,{id:"register-group",children:e.jsx(de,{placeholder:T?"Chargement...":H?"Erreur de chargement":"Sélectionnez un groupe"})}),e.jsx(ue,{children:u.map(s=>e.jsx(me,{value:String(s.id),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"register-password",children:"Mot de passe"}),e.jsx(c,{id:"register-password",type:"password",value:j,onChange:s=>z(s.target.value),placeholder:"Choisissez un mot de passe"})]}),D?e.jsx("p",{className:"text-sm text-destructive",children:D}):null,e.jsx(w,{type:"submit",className:"w-full",disabled:A||!g.trim(),children:A?"Création...":"Créer le compte"})]})]})})}),e.jsx("div",{className:"absolute bottom-4 text-xs text-muted-foreground opacity-50 uppercase font-bold tracking-widest",children:"EAC Performance Tracking"})]})}export{Re as default};
