const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StrengthCatalog-B968nV2t.js","assets/vendor-query-BiSH4r2z.js","assets/vendor-react-BzrpNAyj.js","assets/index-_y5kB8mM.js","assets/vendor-supabase-6k692oZB.js","assets/index-DNSVul-D.css","assets/index-CK3hWotA.js","assets/index-7m84-oo9.js","assets/index-C_umaiSt.js","assets/select-CcQQaX0j.js","assets/index-CqKFQndx.js","assets/chevron-down-CBfcTE7r.js","assets/check-BXpNZTSm.js","assets/circle-CWysUGVw.js","assets/textarea-Dbew3MpH.js","assets/dialog-fwXaVybW.js","assets/index-3yNw33db.js","assets/checkbox-CRubrvFx.js","assets/alert-dialog-BsgAiOn6.js","assets/tabs-DaMY-BzJ.js","assets/SessionListView-DgMKIqi7.js","assets/chevron-left-DvkOBg_X.js","assets/save-B7S686xy.js","assets/circle-alert-hdtHSv2p.js","assets/trash-2-DcgL8tq7.js","assets/drawer-D8Qa04kO.js","assets/search-NzBFQ_2N.js","assets/plus-qJIHTsgi.js","assets/chevron-right-DqCQPdz-.js","assets/loader-circle-CeOpS39t.js","assets/pen-C0PStEYh.js","assets/badge-BGbAtk0p.js","assets/toggle-group-Dl-bIMDh.js","assets/arrow-left-CzdUuSTX.js","assets/SwimCatalog-_0bhYNDG.js","assets/SwimSessionConsultation-VgOChDrl.js","assets/timer-D9aKQoHr.js","assets/format-B9mPVj_w.js"])))=>i.map(i=>d[i]);
import{c as be,B as E,m as He,n as Ke,o as ye,R as We,p as Ue,q as Ne,P as Ce,A as _e,r as we,t as Qe,v as Je,w as Ze,x as Xe,a as Ye,f as de,d as S,C as U,i as Q,k as J,y as Z,h as X,L as M,I as le,M as ue,u as fe,b as es,U as ce,z as ve,E as ss,W as ts,D as ns,l as as,_ as Se}from"./index-_y5kB8mM.js";import{j as e,r as l,R as rs,d as me,u as $,c as os}from"./vendor-query-BiSH4r2z.js";import{B as is}from"./badge-BGbAtk0p.js";import{T as ls,a as ie}from"./toggle-group-Dl-bIMDh.js";import{A as cs}from"./arrow-left-CzdUuSTX.js";import{C as ds}from"./checkbox-CRubrvFx.js";import{h as us,R as ms,u as ps,F as gs}from"./index-CqKFQndx.js";import{u as hs}from"./index-C_umaiSt.js";import{S as L,a as q,b as V,c as B,d as C}from"./select-CcQQaX0j.js";import{C as xs}from"./chevron-down-CBfcTE7r.js";import{T as fs}from"./textarea-Dbew3MpH.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],te=be("bell",vs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],bs=be("heart-pulse",js),K=({title:t,description:r,onBack:o,actions:a})=>e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(E,{variant:"ghost",size:"sm",className:"-ml-2",onClick:o,children:[e.jsx(cs,{className:"mr-2 h-4 w-4"}),"Retour à l'accueil"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:t}),r?e.jsx("p",{className:"text-sm text-muted-foreground",children:r}):null]}),a?e.jsx("div",{className:"flex items-center gap-2",children:a}):null]});function W(t,r,{checkForDefaultPrevented:o=!0}={}){return function(n){if(t?.(n),o===!1||!n.defaultPrevented)return r?.(n)}}function ys(t){const r=Ns(t),o=l.forwardRef((a,n)=>{const{children:i,...c}=a,d=l.Children.toArray(i),v=d.find(_s);if(v){const x=v.props.children,g=d.map(h=>h===v?l.Children.count(x)>1?l.Children.only(null):l.isValidElement(x)?x.props.children:null:h);return e.jsx(r,{...c,ref:n,children:l.isValidElement(x)?l.cloneElement(x,void 0,g):null})}return e.jsx(r,{...c,ref:n,children:i})});return o.displayName=`${t}.Slot`,o}function Ns(t){const r=l.forwardRef((o,a)=>{const{children:n,...i}=o;if(l.isValidElement(n)){const c=Ss(n),d=ws(i,n.props);return n.type!==l.Fragment&&(d.ref=a?He(a,c):c),l.cloneElement(n,d)}return l.Children.count(n)>1?l.Children.only(null):null});return r.displayName=`${t}.SlotClone`,r}var Cs=Symbol("radix.slottable");function _s(t){return l.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Cs}function ws(t,r){const o={...r};for(const a in r){const n=t[a],i=r[a];/^on[A-Z]/.test(a)?n&&i?o[a]=(...d)=>{const v=i(...d);return n(...d),v}:n&&(o[a]=n):a==="style"?o[a]={...n,...i}:a==="className"&&(o[a]=[n,i].filter(Boolean).join(" "))}return{...t,...o}}function Ss(t){let r=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,o=r&&"isReactWarning"in r&&r.isReactWarning;return o?t.ref:(r=Object.getOwnPropertyDescriptor(t,"ref")?.get,o=r&&"isReactWarning"in r&&r.isReactWarning,o?t.props.ref:t.props.ref||t.ref)}var Ps=rs[" useInsertionEffect ".trim().toString()]||Ke;function As({prop:t,defaultProp:r,onChange:o=()=>{},caller:a}){const[n,i,c]=Rs({defaultProp:r,onChange:o}),d=t!==void 0,v=d?t:n;{const g=l.useRef(t!==void 0);l.useEffect(()=>{const h=g.current;h!==d&&console.warn(`${a} is changing from ${h?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),g.current=d},[d,a])}const x=l.useCallback(g=>{if(d){const h=ks(g)?g(t):g;h!==t&&c.current?.(h)}else i(g)},[d,t,i,c]);return[v,x]}function Rs({defaultProp:t,onChange:r}){const[o,a]=l.useState(t),n=l.useRef(o),i=l.useRef(r);return Ps(()=>{i.current=r},[r]),l.useEffect(()=>{n.current!==o&&(i.current?.(o),n.current=o)},[o,n]),[o,a,i]}function ks(t){return typeof t=="function"}var ne="Popover",[Pe]=Ue(ne,[ye]),Y=ye(),[Ms,O]=Pe(ne),Ae=t=>{const{__scopePopover:r,children:o,open:a,defaultOpen:n,onOpenChange:i,modal:c=!1}=t,d=Y(r),v=l.useRef(null),[x,g]=l.useState(!1),[h,f]=As({prop:a,defaultProp:n??!1,onChange:i,caller:ne});return e.jsx(We,{...d,children:e.jsx(Ms,{scope:r,contentId:hs(),triggerRef:v,open:h,onOpenChange:f,onOpenToggle:l.useCallback(()=>f(y=>!y),[f]),hasCustomAnchor:x,onCustomAnchorAdd:l.useCallback(()=>g(!0),[]),onCustomAnchorRemove:l.useCallback(()=>g(!1),[]),modal:c,children:o})})};Ae.displayName=ne;var Re="PopoverAnchor",Es=l.forwardRef((t,r)=>{const{__scopePopover:o,...a}=t,n=O(Re,o),i=Y(o),{onCustomAnchorAdd:c,onCustomAnchorRemove:d}=n;return l.useEffect(()=>(c(),()=>d()),[c,d]),e.jsx(_e,{...i,...a,ref:r})});Es.displayName=Re;var ke="PopoverTrigger",Me=l.forwardRef((t,r)=>{const{__scopePopover:o,...a}=t,n=O(ke,o),i=Y(o),c=Ne(r,n.triggerRef),d=e.jsx(Ce.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":Fe(n.open),...a,ref:c,onClick:W(t.onClick,n.onOpenToggle)});return n.hasCustomAnchor?d:e.jsx(_e,{asChild:!0,...i,children:d})});Me.displayName=ke;var pe="PopoverPortal",[Ts,Ds]=Pe(pe,{forceMount:void 0}),Ee=t=>{const{__scopePopover:r,forceMount:o,children:a,container:n}=t,i=O(pe,r);return e.jsx(Ts,{scope:r,forceMount:o,children:e.jsx(we,{present:o||i.open,children:e.jsx(Qe,{asChild:!0,container:n,children:a})})})};Ee.displayName=pe;var G="PopoverContent",Te=l.forwardRef((t,r)=>{const o=Ds(G,t.__scopePopover),{forceMount:a=o.forceMount,...n}=t,i=O(G,t.__scopePopover);return e.jsx(we,{present:a||i.open,children:i.modal?e.jsx(Fs,{...n,ref:r}):e.jsx(Is,{...n,ref:r})})});Te.displayName=G;var Os=ys("PopoverContent.RemoveScroll"),Fs=l.forwardRef((t,r)=>{const o=O(G,t.__scopePopover),a=l.useRef(null),n=Ne(r,a),i=l.useRef(!1);return l.useEffect(()=>{const c=a.current;if(c)return us(c)},[]),e.jsx(ms,{as:Os,allowPinchZoom:!0,children:e.jsx(De,{...t,ref:n,trapFocus:o.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:W(t.onCloseAutoFocus,c=>{c.preventDefault(),i.current||o.triggerRef.current?.focus()}),onPointerDownOutside:W(t.onPointerDownOutside,c=>{const d=c.detail.originalEvent,v=d.button===0&&d.ctrlKey===!0,x=d.button===2||v;i.current=x},{checkForDefaultPrevented:!1}),onFocusOutside:W(t.onFocusOutside,c=>c.preventDefault(),{checkForDefaultPrevented:!1})})})}),Is=l.forwardRef((t,r)=>{const o=O(G,t.__scopePopover),a=l.useRef(!1),n=l.useRef(!1);return e.jsx(De,{...t,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{t.onCloseAutoFocus?.(i),i.defaultPrevented||(a.current||o.triggerRef.current?.focus(),i.preventDefault()),a.current=!1,n.current=!1},onInteractOutside:i=>{t.onInteractOutside?.(i),i.defaultPrevented||(a.current=!0,i.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const c=i.target;o.triggerRef.current?.contains(c)&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&n.current&&i.preventDefault()}})}),De=l.forwardRef((t,r)=>{const{__scopePopover:o,trapFocus:a,onOpenAutoFocus:n,onCloseAutoFocus:i,disableOutsidePointerEvents:c,onEscapeKeyDown:d,onPointerDownOutside:v,onFocusOutside:x,onInteractOutside:g,...h}=t,f=O(G,o),y=Y(o);return ps(),e.jsx(gs,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:n,onUnmountAutoFocus:i,children:e.jsx(Je,{asChild:!0,disableOutsidePointerEvents:c,onInteractOutside:g,onEscapeKeyDown:d,onPointerDownOutside:v,onFocusOutside:x,onDismiss:()=>f.onOpenChange(!1),children:e.jsx(Ze,{"data-state":Fe(f.open),role:"dialog",id:f.contentId,...y,...h,ref:r,style:{...h.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Oe="PopoverClose",zs=l.forwardRef((t,r)=>{const{__scopePopover:o,...a}=t,n=O(Oe,o);return e.jsx(Ce.button,{type:"button",...a,ref:r,onClick:W(t.onClick,()=>n.onOpenChange(!1))})});zs.displayName=Oe;var $s="PopoverArrow",Ls=l.forwardRef((t,r)=>{const{__scopePopover:o,...a}=t,n=Y(o);return e.jsx(Xe,{...n,...a,ref:r})});Ls.displayName=$s;function Fe(t){return t?"open":"closed"}var qs=Ae,Vs=Me,Bs=Ee,Ie=Te;const Gs=qs,Hs=Vs,ze=l.forwardRef(({className:t,align:r="center",sideOffset:o=4,...a},n)=>e.jsx(Bs,{children:e.jsx(Ie,{ref:n,align:r,sideOffset:o,className:Ye("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",t),...a})}));ze.displayName=Ie.displayName;const Ks=({onBack:t,swimSessions:r,strengthSessions:o,athletes:a,groups:n})=>{const{toast:i}=de(),[c,d]=l.useState({session_type:"swim",session_id:"",assigned_date:new Date().toISOString().split("T")[0],assigned_slot:"morning"}),[v,x]=l.useState(!1),[g,h]=l.useState("user"),[f,y]=l.useState(""),[m,_]=l.useState([]),u=s=>{const p=typeof s=="number"?s:Number(s);return Number.isFinite(p)&&p>0?p:null},P=l.useMemo(()=>a.map(s=>({value:s.id?`id:${s.id}`:`name:${s.display_name}`,label:s.group_label?`${s.display_name} · ${s.group_label}`:s.display_name,id:s.id,name:s.display_name})),[a]),N=l.useMemo(()=>new Map(P.map(s=>[s.value,s])),[P]),H=l.useMemo(()=>n.map(s=>{const p=u(s.id);return p?{...s,gid:p}:null}).filter(s=>!!s),[n]),T=l.useMemo(()=>H.filter(s=>m.includes(s.gid)),[H,m]),ae=l.useMemo(()=>{if(T.length===0)return"Choisir des groupes";const s=T.slice(0,2).map(A=>A.name).join(", "),p=T.length>2?` +${T.length-2}`:"";return`${s}${p}`},[T]),z=me({mutationFn:async s=>S.assignments_create(s),onSuccess:()=>{i({title:"Séance assignée & notifiée"})},onError:s=>{const p="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",A=s instanceof Error?s.message:typeof s=="string"?s:p;let R=A;const w=A.match(/HTTP \d+:\s*(\{.*\})/);if(w)try{R=JSON.parse(w[1])?.error||p}catch{R=p}i({title:"Erreur d'assignation",description:R})}}),re=async()=>{const s=Number(c.session_id);if(!Number.isInteger(s)||s<=0){i({title:"Séance invalide",description:"Sélectionnez une séance valide."});return}if(g==="group"){if(m.length===0){i({title:"Groupe manquant",description:"Sélectionnez au moins un groupe."});return}x(!0);try{const k={assignment_type:c.session_type,session_id:s,scheduled_date:c.assigned_date,scheduled_slot:c.assigned_slot},F=Array.from(new Set(m));await Promise.all(F.map(b=>S.assignments_create({...k,target_group_id:b}))),i({title:"Séance assignée & notifiée"})}catch(k){const F="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",b=k instanceof Error?k.message:typeof k=="string"?k:F;let I=b;const se=b.match(/HTTP \d+:\s*(\{.*\})/);if(se)try{I=JSON.parse(se[1])?.error||F}catch{I=F}i({title:"Erreur d'assignation",description:I})}finally{x(!1)}return}const p=f.trim();if(!p){i({title:"Nageur manquant",description:"Sélectionnez un nageur."});return}const A=N.get(p),R=A?.id??(Number.isFinite(Number(p))&&Number(p)>0?Number(p):void 0);if(!Number.isFinite(R)||Number(R)<=0){i({title:"Nageur invalide",description:"Sélectionnez un nageur avec un identifiant valide."});return}const w=A?.name??p.replace(/^name:/,"");z.mutate({assignment_type:c.session_type,session_id:s,target_athlete:w,target_user_id:R,scheduled_date:c.assigned_date,scheduled_slot:c.assigned_slot})},ee=!c.session_id||(g==="group"?m.length===0:!f.trim())||z.isPending||v;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(K,{title:"Assigner une séance",description:"Planifiez une séance pour un nageur ou un ou plusieurs groupes.",onBack:t}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(U,{className:"border-l-4 border-l-primary",children:[e.jsxs(Q,{children:[e.jsx(J,{children:"Séance"}),e.jsx(Z,{children:"Choisissez le type et la séance à envoyer."})]}),e.jsxs(X,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Type"}),e.jsxs(L,{value:c.session_type,onValueChange:s=>d({...c,session_type:s,session_id:""}),children:[e.jsx(q,{children:e.jsx(V,{})}),e.jsxs(B,{children:[e.jsx(C,{value:"swim",children:"Natation"}),e.jsx(C,{value:"strength",children:"Musculation"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Séance"}),e.jsxs(L,{value:c.session_id,onValueChange:s=>d({...c,session_id:s}),children:[e.jsx(q,{children:e.jsx(V,{placeholder:"Choisir..."})}),e.jsx(B,{children:c.session_type==="swim"?r?.map(s=>e.jsx(C,{value:s.id.toString(),children:s.name},s.id)):o?.map(s=>e.jsx(C,{value:s.id.toString(),children:s.title},s.id))})]})]})]})]}),e.jsxs(U,{children:[e.jsxs(Q,{children:[e.jsx(J,{children:"Cible & planification"}),e.jsx(Z,{children:"Définissez le destinataire, la date et le créneau."})]}),e.jsxs(X,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Cible"}),e.jsxs(L,{value:g,onValueChange:s=>{h(s),y(""),_([])},children:[e.jsx(q,{children:e.jsx(V,{})}),e.jsxs(B,{children:[e.jsx(C,{value:"user",children:"Nageur"}),e.jsx(C,{value:"group",children:"Groupe(s)"})]})]})]}),g==="user"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Nageur"}),P.length>0?e.jsxs(L,{value:f,onValueChange:y,children:[e.jsx(q,{children:e.jsx(V,{placeholder:"Choisir un nageur"})}),e.jsx(B,{children:P.map(s=>e.jsx(C,{value:s.value,children:s.label},s.value))})]}):e.jsx(le,{value:f,onChange:s=>y(s.target.value),placeholder:"ex: Camille"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Groupes"}),n.length>0?e.jsxs(Gs,{children:[e.jsx(Hs,{asChild:!0,children:e.jsxs(E,{type:"button",variant:"outline",className:"w-full justify-between","aria-label":"Sélection des groupes",children:[e.jsx("span",{className:"truncate",children:ae}),e.jsx(xs,{className:"ml-2 h-4 w-4 opacity-50"})]})}),e.jsxs(ze,{className:"w-[--radix-popover-trigger-width] p-2",align:"start",children:[e.jsx("div",{className:"max-h-64 overflow-auto",children:e.jsx("div",{className:"space-y-1",children:H.map(s=>{const p=m.includes(s.gid);return e.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 hover:bg-muted",children:[e.jsx(ds,{checked:p,onCheckedChange:A=>{const R=A===!0;_(w=>R?w.includes(s.gid)?w:[...w,s.gid]:w.filter(k=>k!==s.gid))}}),e.jsx("span",{className:"text-sm",children:s.name})]},s.gid)})})}),m.length>0?e.jsx(E,{type:"button",variant:"ghost",size:"sm",className:"mt-2 w-full",onClick:()=>_([]),children:"Tout désélectionner"}):null]})]}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"Aucun groupe disponible."}),m.length>0?e.jsxs("div",{className:"text-xs text-muted-foreground",children:[m.length," groupe",m.length>1?"s":""," sélectionné",m.length>1?"s":"","."]}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Date"}),e.jsx(le,{type:"date",value:c.assigned_date,onChange:s=>d({...c,assigned_date:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Créneau"}),e.jsxs(L,{value:c.assigned_slot,onValueChange:s=>d({...c,assigned_slot:s}),children:[e.jsx(q,{children:e.jsx(V,{placeholder:"Choisir..."})}),e.jsxs(B,{children:[e.jsx(C,{value:"morning",children:"Matin"}),e.jsx(C,{value:"evening",children:"Soir"})]})]})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(E,{className:"w-full sm:w-auto",onClick:re,disabled:ee,children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),z.isPending||v?"Assignation...":"Assigner & notifier"]})})]})},Ws=({onBack:t,athletes:r,groups:o,athletesLoading:a})=>{const{toast:n}=de(),[i,c]=l.useState(""),[d,v]=l.useState("Message Coach"),[x,g]=l.useState(""),h=l.useMemo(()=>r.filter(u=>u.id).map(u=>({value:`user:${u.id}`,label:u.group_label?`${u.display_name} · ${u.group_label}`:u.display_name,id:u.id})),[r]),f=l.useMemo(()=>o.map(u=>({value:`group:${u.id}`,label:u.name,id:u.id})),[o]),y=l.useMemo(()=>new Map([...h,...f].map(u=>[u.value,u])),[h,f]),m=me({mutationFn:u=>S.notifications_send({...u,type:"message"}),onSuccess:()=>{n({title:"Message envoyé"}),c("")}}),_=()=>{if(!d.trim()||!i.trim()){n({title:"Message incomplet",description:"Ajoutez un titre et un contenu."});return}if(!x){n({title:"Destinataire manquant",description:"Sélectionnez un nageur ou un groupe."});return}const u=y.get(x);if(!u?.id){n({title:"Destinataire invalide",description:"Sélectionnez un destinataire valide."});return}if(x.startsWith("group:")){m.mutate({title:d,body:i,targets:[{target_group_id:u.id}]});return}m.mutate({title:d,body:i,targets:[{target_user_id:u.id}]})};return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(K,{title:"Messagerie rapide",description:"Envoyez un message ciblé à vos nageurs.",onBack:t}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(U,{className:"border-l-4 border-l-primary",children:[e.jsxs(Q,{children:[e.jsx(J,{children:"Destinataire"}),e.jsx(Z,{children:"Sélectionnez un nageur ou un groupe à prévenir."})]}),e.jsx(X,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Destinataire"}),e.jsxs(L,{value:x,onValueChange:g,children:[e.jsx(q,{children:e.jsx(V,{placeholder:a?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(B,{children:[f.length?e.jsxs(e.Fragment,{children:[e.jsx(C,{value:"section-group",disabled:!0,children:"Groupes"}),f.map(u=>e.jsx(C,{value:u.value,children:u.label},u.value))]}):null,h.length?e.jsxs(e.Fragment,{children:[e.jsx(C,{value:"section-athlete",disabled:!0,children:"Nageurs"}),h.map(u=>e.jsx(C,{value:u.value,children:u.label},u.value))]}):null]})]})]})})]}),e.jsxs(U,{children:[e.jsxs(Q,{children:[e.jsx(J,{children:"Contenu"}),e.jsx(Z,{children:"Rédigez votre message en quelques lignes."})]}),e.jsxs(X,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"msg-title",children:"Titre"}),e.jsx(le,{id:"msg-title",value:d,onChange:u=>v(u.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"msg-body",children:"Message"}),e.jsx(fs,{id:"msg-body",placeholder:"Message...",value:i,onChange:u=>c(u.target.value),rows:5,maxLength:500}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[i.length,"/500"]})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(E,{className:"w-full sm:w-auto",onClick:_,disabled:m.isPending,children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),m.isPending?"Envoi...":"Envoyer"]})})]})},Us=l.lazy(()=>Se(()=>import("./StrengthCatalog-B968nV2t.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33]))),Qs=l.lazy(()=>Se(()=>import("./SwimCatalog-_0bhYNDG.js"),__vite__mapDeps([34,1,2,3,4,5,15,16,8,10,18,28,35,31,36,20,11,21,22,23,24,14,9,7,12,27,37,26]))),Js=({onNavigate:t,onOpenRecordsAdmin:r,onOpenRecordsClub:o,athletes:a,athletesLoading:n,upcomingBirthdays:i,birthdaysLoading:c,kpiLoading:d,kpiPeriod:v,onKpiPeriodChange:x,fatigueAlerts:g,mostLoadedAthlete:h,swimSessionCount:f,strengthSessionCount:y})=>{const m=new Date().getHours(),_=m<12?"Bonjour":m<18?"Bon après-midi":"Bonsoir",u=new Date().toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}),P=g.length>0;return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold uppercase italic",children:[_,", ",e.jsx("span",{className:"text-primary",children:"Coach"})]}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:u})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Signaux · ",v,"j"]}),e.jsxs(ls,{type:"single",size:"sm",variant:"outline",value:String(v),onValueChange:N=>{N&&x(Number(N))},children:[e.jsx(ie,{value:"7",className:"h-7 px-2 text-xs","aria-label":"7 jours",children:"7j"}),e.jsx(ie,{value:"30",className:"h-7 px-2 text-xs","aria-label":"30 jours",children:"30j"}),e.jsx(ie,{value:"365",className:"h-7 px-2 text-xs","aria-label":"1 an",children:"1an"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:`rounded-xl border p-3 ${P?"border-destructive/30 bg-destructive/5":"bg-muted/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Fatigue 5/5"}),e.jsx(bs,{className:`h-3.5 w-3.5 ${P?"text-destructive":"text-muted-foreground"}`})]}),e.jsx("p",{className:"text-xl font-bold tabular-nums",children:d?"–":g.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground truncate",children:d?"Chargement…":P?g.slice(0,2).map(N=>N.athleteName.split(" ")[0]).join(", "):"Aucune alerte"})]}),e.jsxs("div",{className:"rounded-xl border bg-muted/30 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Plus chargé"}),e.jsx(ce,{className:"h-3.5 w-3.5 text-muted-foreground"})]}),e.jsx("p",{className:"text-xl font-bold truncate",children:d?"–":h?.athleteName?.split(" ")[0]??"–"}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:d?"Calcul…":h?`Charge ${Math.round(h.loadScore)}`:"Pas de données"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>t("assignments"),className:"flex items-center gap-1.5 rounded-full bg-primary text-primary-foreground px-4 py-2 text-sm font-semibold active:opacity-80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(te,{className:"h-3.5 w-3.5"}),"Assigner"]}),e.jsxs("button",{type:"button",onClick:()=>t("messaging"),className:"flex items-center gap-1.5 rounded-full border px-4 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(ue,{className:"h-3.5 w-3.5"}),"Message"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>t("swim"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ts,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:f!=null?`${f} séance${f!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>t("strength"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ns,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Musculation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:y!=null?`${y} séance${y!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>t("swimmers"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(ce,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Nageurs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n?"Chargement…":`${a.length} nageur${a.length!==1?"s":""}`})]}),e.jsxs("button",{type:"button",onClick:r,className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(as,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Records club"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Import & administration"})]})]}),e.jsx("button",{type:"button",onClick:o,className:"w-full text-center text-sm text-primary font-semibold py-1 active:opacity-70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring rounded",children:"Voir les records du club"}),!c&&i&&i.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Anniversaires"}),e.jsx("div",{className:"space-y-1.5",children:i.slice(0,3).map(N=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:N.display_name}),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:Zs(N.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-bold text-primary",children:["J-",N.days_until]})]},N.id))})]}):null]})},Zs=t=>{if(!t)return"-";const r=new Date(t);return Number.isNaN(r.getTime())?t:r.toLocaleDateString("fr-FR")},je=t=>t.toISOString().split("T")[0],Xs=t=>new Date(t.completed_at||t.started_at||t.date||t.created_at||0).getTime(),Ys=t=>{if(!t.length)return null;const r=t.reduce((a,n)=>a+n,0)/t.length,o=Math.min(5,Math.max(1,Math.round(r/10*5)));return{average:r,rating:o}};function et(){const t=fe(s=>s.role),r=fe(s=>s.setSelectedAthlete),[,o]=es(),[a,n]=l.useState("home"),[i,c]=l.useState(7),d=t==="coach"||t==="admin",v=a==="home"||a==="assignments",x=a==="home"||a==="assignments"||a==="messaging"||a==="swimmers",g=a==="assignments"||a==="messaging",h=a==="home"||a==="swimmers",{data:f}=$({queryKey:["swim_catalog"],queryFn:()=>S.getSwimCatalog(),enabled:d&&v}),{data:y}=$({queryKey:["strength_catalog"],queryFn:()=>S.getStrengthSessions(),enabled:d&&v}),{data:m=[],isLoading:_}=$({queryKey:["athletes"],queryFn:()=>S.getAthletes(),enabled:d&&x}),u=l.useMemo(()=>m.slice(0,5),[m]),{data:P=[]}=$({queryKey:["groups"],queryFn:()=>S.getGroups(),enabled:d&&g}),N=$({queryKey:["upcoming-birthdays"],queryFn:()=>S.getUpcomingBirthdays({days:30}),enabled:d&&h}),H=N.data,T=$({queryKey:["coach-kpis",i,u.map(s=>s.id??s.display_name)],enabled:d&&a==="home"&&u.length>0,queryFn:async()=>{const s=i,p=new Date;p.setDate(p.getDate()-s);const A=je(p),R=je(new Date),w=await Promise.all(u.map(async b=>{const[I,se]=await Promise.all([S.getSessions(b.display_name,b.id),S.getStrengthHistory(b.display_name,{athleteId:b.id,limit:50,from:A,to:R})]),oe=I.filter(j=>new Date(j.date).getTime()>=p.getTime()),$e=oe.map(j=>j.fatigue??j.feeling).filter(j=>Number.isFinite(j)),Le=oe.reduce((j,D)=>j+(Number(D.duration)||0)*(Number(D.effort)||0),0),ge=(se?.runs??[]).filter(j=>Xs(j)>=p.getTime()),qe=ge.map(j=>j.fatigue??j.feeling??j.rpe).filter(j=>Number.isFinite(Number(j))).map(j=>Number(j)),Ve=ge.reduce((j,D)=>{const he=Number(D.feeling??D.rpe??0),xe=Number(D.duration??0);if(xe>0&&he>0)return j+xe*he;const Ge=Array.isArray(D.logs)?D.logs.length:0;return j+Ge*5},0),Be=Ys([...$e,...qe]);return{athleteName:b.display_name,loadScore:Le+Ve,fatigueRating:Be}})),k=w.filter(b=>b.fatigueRating?.rating===5).map(b=>({athleteName:b.athleteName,rating:b.fatigueRating?.rating??0})),F=w.filter(b=>b.loadScore>0).sort((b,I)=>I.loadScore-b.loadScore)[0];return{fatigueAlerts:k,mostLoadedAthlete:F??null}}}),ae=s=>{r({id:s.id??null,name:s.display_name}),o("/progress")},{toast:z}=de(),re=os(),ee=me({mutationFn:async s=>{const p=await S.importSingleSwimmer(s.iuf,s.name);return await S.recalculateClubRecords(),p},onSuccess:s=>{z({title:"Import terminé",description:`${s.total_found} trouvées, ${s.new_imported} nouvelles.`}),re.invalidateQueries({queryKey:["club-records"]})},onError:s=>{z({title:"Erreur import",description:s.message,variant:"destructive"})}});return d?e.jsxs("div",{className:"space-y-6",children:[a==="home"?e.jsx(Js,{onNavigate:n,onOpenRecordsAdmin:()=>o("/records-admin"),onOpenRecordsClub:()=>o("/records-club"),athletes:m,athletesLoading:_,upcomingBirthdays:H,birthdaysLoading:N.isLoading,kpiLoading:T.isLoading,kpiPeriod:i,onKpiPeriodChange:c,fatigueAlerts:T.data?.fatigueAlerts??[],mostLoadedAthlete:T.data?.mostLoadedAthlete??null,swimSessionCount:f?.length,strengthSessionCount:y?.length}):null,a==="assignments"?e.jsx(Ks,{onBack:()=>n("home"),swimSessions:f,strengthSessions:y,athletes:m,groups:P}):null,a==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(K,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>n("home"),actions:e.jsxs(E,{variant:"outline",onClick:()=>n("assignments"),children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(l.Suspense,{fallback:e.jsx(ve,{}),children:e.jsx(Qs,{})})]}):null,a==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(K,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>n("home"),actions:e.jsxs(E,{variant:"outline",onClick:()=>n("assignments"),children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(l.Suspense,{fallback:e.jsx(ve,{}),children:e.jsx(Us,{})})]}):null,a==="swimmers"?e.jsxs("div",{className:"space-y-4",children:[e.jsx(K,{title:"Nageurs",description:_?"Chargement…":`${m.length} nageur${m.length!==1?"s":""} inscrit${m.length!==1?"s":""}`,onBack:()=>n("home"),actions:e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>n("messaging"),children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Message"]})}),_?e.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(s=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-8 w-16 rounded bg-muted"})]})},s))}):m.length?e.jsx("div",{className:"space-y-2",children:m.map(s=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border bg-card p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:s.display_name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[s.group_label?e.jsx(is,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:s.group_label}):null,s.ffn_iuf?e.jsx("span",{className:"text-[10px] font-mono text-muted-foreground",children:s.ffn_iuf}):null]})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[s.ffn_iuf?e.jsx(E,{size:"icon",variant:"ghost",className:"h-8 w-8",disabled:ee.isPending,onClick:()=>ee.mutate({iuf:s.ffn_iuf,name:s.display_name}),title:"Importer performances FFN",children:e.jsx(ss,{className:"h-4 w-4"})}):null,e.jsx(E,{size:"sm",variant:"outline",onClick:()=>ae(s),children:"Fiche"})]})]},s.id??s.display_name))}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Aucun nageur disponible."})]}):null,a==="messaging"?e.jsx(Ws,{onBack:()=>n("home"),athletes:m,groups:P,athletesLoading:_}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(U,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(Q,{children:[e.jsxs(J,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(ce,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(Z,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(X,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}const pt=Object.freeze(Object.defineProperty({__proto__:null,default:et},Symbol.toStringTag,{value:"Module"}));export{pt as C,Gs as P,Hs as a,ze as b};
