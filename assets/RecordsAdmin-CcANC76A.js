import{r as n,j as e}from"./vendor-ui-CMUPCwTD.js";import{c as f}from"./vendor-query-WtxIVPOV.js";import{u as H,d as L,b as u,h as G}from"./index-BDGnhHrZ.js";import{C as N,a as F,b as I,c as A,d as E}from"./card-BVRwMXiB.js";import{B as T}from"./button-BuXE02p3.js";import{I as m}from"./input-DqGwk8UO.js";import{S as O}from"./switch-BRm9_cV9.js";import{B as D}from"./badge-BPZGxebf.js";import{T as K,a as X,b as R,c as o,d as q,e as d}from"./table-Bu1b63OG.js";import{S as w,a as B,b as M,c as $,d as k}from"./select-Ci-_VFAs.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-BHfjz9SJ.js";import"./vendor-supabase-CrvtPqJM.js";import"./index-Bm0RG47H.js";import"./check-CsaGej-t.js";const P=[{value:"M",label:"Garçon"},{value:"F",label:"Fille"}],J=p=>p==="user"?"Compte":"Ancien";function ue(){const p=H(s=>s.role),{toast:i}=L(),[a,c]=n.useState({display_name:"",iuf:"",sex:"",birthdate:""}),[x,S]=n.useState([]),[v,y]=n.useState(!1),[h,_]=n.useState(null),g=p==="coach"||p==="admin",l=n.useCallback(async()=>{if(g){y(!0),_(null);try{const s=await u.getClubRecordSwimmers();S(s)}catch(s){const r=G(s,"Impossible de charger la liste.");_(r.message),S([])}finally{y(!1)}}},[g]);n.useEffect(()=>{l()},[l]);const C=f({mutationFn:()=>u.createClubRecordSwimmer({display_name:a.display_name.trim(),iuf:a.iuf.trim()||null,sex:a.sex?a.sex:null,birthdate:a.birthdate||null,is_active:!0}),onSuccess:()=>{i({title:"Nageur ajouté"}),c({display_name:"",iuf:"",sex:"",birthdate:""}),l()},onError:()=>{i({title:"Impossible d'ajouter le nageur",variant:"destructive"})}}),U=f({mutationFn:({id:s,payload:r})=>u.updateClubRecordSwimmer(s,r),onSuccess:()=>{l(),i({title:"Sauvegardé"})},onError:()=>{i({title:"Mise à jour impossible",variant:"destructive"})}}),V=f({mutationFn:({userId:s,payload:r})=>u.updateClubRecordSwimmerForUser(s,r),onSuccess:()=>{l(),i({title:"Sauvegardé"})},onError:()=>{i({title:"Mise à jour impossible",variant:"destructive"})}}),j=(s,r)=>{if(s.source_type==="user"&&s.user_id){V.mutate({userId:s.user_id,payload:r});return}s.id&&U.mutate({id:s.id,payload:r})},b=f({mutationFn:()=>u.importClubRecords(),onSuccess:s=>{i({title:"Import terminé",description:s?`Performances importées: ${s.imported??0}. Erreurs: ${s.errors??0}.`:""}),l()},onError:()=>{i({title:"Import impossible",variant:"destructive"})}}),z=n.useMemo(()=>[...x].sort((s,r)=>s.source_type!==r.source_type?s.source_type.localeCompare(r.source_type):s.display_name.localeCompare(r.display_name)),[x]);return g?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Administration des records"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Gérez les nageurs pris en compte pour les records et lancez l'import FFN."})]}),e.jsx(T,{onClick:()=>b.mutate(),disabled:b.isPending,children:b.isPending?"Import en cours...":"Mettre à jour les records"})]}),e.jsxs(N,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"Ajouter un ancien nageur"}),e.jsx(A,{children:"Ajoutez un nageur sans compte pour l'import des performances FFN."})]}),e.jsxs(E,{className:"grid gap-4 md:grid-cols-[2fr_1fr_1fr_1fr_auto]",children:[e.jsx(m,{placeholder:"Nom du nageur",value:a.display_name,onChange:s=>c(r=>({...r,display_name:s.target.value}))}),e.jsx(m,{placeholder:"IUF",value:a.iuf,onChange:s=>c(r=>({...r,iuf:s.target.value}))}),e.jsxs(w,{value:a.sex,onValueChange:s=>c(r=>({...r,sex:s})),children:[e.jsx(B,{children:e.jsx(M,{placeholder:"Sexe"})}),e.jsx($,{children:P.map(s=>e.jsx(k,{value:s.value,children:s.label},s.value))})]}),e.jsx(m,{type:"date",value:a.birthdate,onChange:s=>c(r=>({...r,birthdate:s.target.value}))}),e.jsx(T,{onClick:()=>C.mutate(),disabled:!a.display_name.trim()||C.isPending,children:"Ajouter"})]})]}),e.jsxs(N,{children:[e.jsxs(F,{children:[e.jsx(I,{children:"Liste des nageurs suivis"}),e.jsx(A,{children:"Mettre à jour l'IUF, le sexe ou l'activation pour l'import FFN."})]}),e.jsxs(E,{children:[v&&e.jsx("div",{className:"space-y-3",children:[1,2,3,4].map(s=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"h-4 w-20 rounded bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"h-4 w-16 rounded bg-muted animate-pulse motion-reduce:animate-none"}),e.jsx("div",{className:"h-4 w-24 rounded bg-muted animate-pulse motion-reduce:animate-none"})]},s))}),h&&e.jsx("p",{className:"text-sm text-destructive",children:h}),!v&&!h&&x.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun nageur disponible."}),!v&&!h&&x.length>0&&e.jsxs(K,{children:[e.jsx(X,{children:e.jsxs(R,{children:[e.jsx(o,{children:"Nageur"}),e.jsx(o,{children:"Source"}),e.jsx(o,{children:"IUF"}),e.jsx(o,{children:"Sexe"}),e.jsx(o,{children:"Naissance"}),e.jsx(o,{children:"Actif"})]})}),e.jsx(q,{children:z.map(s=>{const r=s.id??`user-${s.user_id??"unknown"}`;return e.jsxs(R,{children:[e.jsx(d,{className:"font-medium",children:s.display_name}),e.jsx(d,{children:e.jsx(D,{variant:s.source_type==="manual"?"secondary":"outline",children:J(s.source_type)})}),e.jsx(d,{children:e.jsx(m,{defaultValue:s.iuf??"",onBlur:t=>j(s,{iuf:t.target.value.trim()||null})},`${r}-${s.iuf??""}`)}),e.jsx(d,{children:e.jsxs(w,{value:s.sex??"",onValueChange:t=>j(s,{sex:t||null}),children:[e.jsx(B,{children:e.jsx(M,{placeholder:"Sexe"})}),e.jsx($,{children:P.map(t=>e.jsx(k,{value:t.value,children:t.label},t.value))})]})}),e.jsx(d,{children:e.jsx(m,{type:"date",defaultValue:s.birthdate??"",onBlur:t=>j(s,{birthdate:t.target.value||null})},`${r}-${s.birthdate??""}`)}),e.jsx(d,{children:e.jsx(O,{checked:!!s.is_active,onCheckedChange:t=>j(s,{is_active:t})})})]},r)})})]})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Administration des records"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Accès réservé aux coachs."})]})}export{ue as default};
