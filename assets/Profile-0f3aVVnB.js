import{r as l,j as e,g as ie,h as R}from"./vendor-ui-C9ymspZo.js";import{h as ne,q as oe,r as ce,k as M,u as de,i as le,C as _,b as F,B as N,f as P,L as h,I as w,o as ue,c as L,d as E,j as me,g as C}from"./index-BJidZWdX.js";import{b as pe,u as B,c as I}from"./vendor-query-kM2vrB_e.js";import{T as fe}from"./textarea-DP8CfJdc.js";import{S as xe,a as he,b as ge,c as ve,d as je}from"./select-mVPEJ3WN.js";import{P as Ne,S as be}from"./save-BScLM58J.js";import{R as Se}from"./refresh-cw-hwWGq6yI.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-DSuxWnoS.js";import"./vendor-supabase-B2MyMyC0.js";import"./chevron-up-WA80GE6h.js";import"./check-DL9OaKkA.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Ce=ne("log-out",we);function ye(s,r=[]){let i=[];function o(a,c){const d=l.createContext(c);d.displayName=a+"Context";const m=i.length;i=[...i,c];const f=x=>{const{scope:b,children:S,...j}=x,p=b?.[s]?.[m]||d,v=l.useMemo(()=>j,Object.values(j));return e.jsx(p.Provider,{value:v,children:S})};f.displayName=a+"Provider";function g(x,b){const S=b?.[s]?.[m]||d,j=l.useContext(S);if(j)return j;if(c!==void 0)return c;throw new Error(`\`${x}\` must be used within \`${a}\``)}return[f,g]}const n=()=>{const a=i.map(c=>l.createContext(c));return function(d){const m=d?.[s]||a;return l.useMemo(()=>({[`__scope${s}`]:{...d,[s]:m}}),[d,m])}};return n.scopeName=s,[o,_e(n,...r)]}function _e(...s){const r=s[0];if(s.length===1)return r;const i=()=>{const o=s.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(a){const c=o.reduce((d,{useScope:m,scopeName:f})=>{const x=m(a)[`__scope${f}`];return{...d,...x}},{});return l.useMemo(()=>({[`__scope${r.scopeName}`]:c}),[c])}};return i.scopeName=r.scopeName,i}var Fe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],k=Fe.reduce((s,r)=>{const i=oe(`Primitive.${r}`),o=l.forwardRef((n,a)=>{const{asChild:c,...d}=n,m=c?i:r;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(m,{...d,ref:a})});return o.displayName=`Primitive.${r}`,{...s,[r]:o}},{});function Pe(){return ce.useSyncExternalStore(Ae,()=>!0,()=>!1)}function Ae(){return()=>{}}var $="Avatar",[Le]=ye($),[Ee,H]=Le($),z=l.forwardRef((s,r)=>{const{__scopeAvatar:i,...o}=s,[n,a]=l.useState("idle");return e.jsx(Ee,{scope:i,imageLoadingStatus:n,onImageLoadingStatusChange:a,children:e.jsx(k.span,{...o,ref:r})})});z.displayName=$;var K="AvatarImage",V=l.forwardRef((s,r)=>{const{__scopeAvatar:i,src:o,onLoadingStatusChange:n=()=>{},...a}=s,c=H(K,i),d=Ie(o,a),m=ie(f=>{n(f),c.onImageLoadingStatusChange(f)});return R(()=>{d!=="idle"&&m(d)},[d,m]),d==="loaded"?e.jsx(k.img,{...a,ref:r,src:o}):null});V.displayName=K;var G="AvatarFallback",O=l.forwardRef((s,r)=>{const{__scopeAvatar:i,delayMs:o,...n}=s,a=H(G,i),[c,d]=l.useState(o===void 0);return l.useEffect(()=>{if(o!==void 0){const m=window.setTimeout(()=>d(!0),o);return()=>window.clearTimeout(m)}},[o]),c&&a.imageLoadingStatus!=="loaded"?e.jsx(k.span,{...n,ref:r}):null});O.displayName=G;function D(s,r){return s?r?(s.src!==r&&(s.src=r),s.complete&&s.naturalWidth>0?"loaded":"loading"):"error":"idle"}function Ie(s,{referrerPolicy:r,crossOrigin:i}){const o=Pe(),n=l.useRef(null),a=o?(n.current||(n.current=new window.Image),n.current):null,[c,d]=l.useState(()=>D(a,s));return R(()=>{d(D(a,s))},[a,s]),R(()=>{const m=x=>()=>{d(x)};if(!a)return;const f=m("loaded"),g=m("error");return a.addEventListener("load",f),a.addEventListener("error",g),r&&(a.referrerPolicy=r),typeof i=="string"&&(a.crossOrigin=i),()=>{a.removeEventListener("load",f),a.removeEventListener("error",g)}},[a,i,r]),c}var Q=z,W=V,J=O;const X=l.forwardRef(({className:s,...r},i)=>e.jsx(Q,{ref:i,className:M("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...r}));X.displayName=Q.displayName;const Y=l.forwardRef(({className:s,...r},i)=>e.jsx(W,{ref:i,className:M("aspect-square h-full w-full",s),...r}));Y.displayName=W.displayName;const Z=l.forwardRef(({className:s,...r},i)=>e.jsx(J,{ref:i,className:M("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...r}));Z.displayName=J.displayName;const Re=s=>s!=="coach"&&s!=="admin"&&s!=="comite",Me=s=>{switch(s){case"coach":return"Entraineur EAC";case"admin":return"Admin";case"comite":return"Comité";default:return"Nageur"}};function ke(s){if(!s)return"-";const r=new Date(s);return Number.isNaN(r.getTime())?s:r.toLocaleDateString("fr-FR")}function Qe(){const{user:s,userId:r,logout:i,role:o}=de(),{toast:n}=le(),a=pe(),c=Re(o),d=o==="athlete"||o==="coach"||o==="admin",m=Me(o),[f,g]=l.useState(!1),[x,b]=l.useState(""),[S,j]=l.useState(""),[p,v]=l.useState({group_id:"",objectives:"",bio:"",avatar_url:"",birthdate:"",ffn_iuf:""}),{data:u}=B({queryKey:["profile",s,r],queryFn:()=>C.getProfile({displayName:s,userId:r}),enabled:!!s}),{data:q=[],isLoading:U}=B({queryKey:["profile-groups"],queryFn:()=>C.getGroups(),enabled:!!s}),ee=l.useMemo(()=>{const t=u?.avatar_url;return t||(s?`https://api.dicebear.com/7.x/initials/svg?seed=${encodeURIComponent(s)}`:"")},[u,s]),A=I({mutationFn:t=>C.updateProfile({userId:r,profile:{group_id:t.group_id?Number(t.group_id):null,birthdate:t.birthdate||null,objectives:t.objectives,bio:t.bio,avatar_url:t.avatar_url,ffn_iuf:(t.ffn_iuf||"").trim()||null}}),onSuccess:()=>{a.invalidateQueries({queryKey:["profile"]}),g(!1),n({title:"Profil mis à jour"})},onError:t=>{n({title:"Mise à jour impossible",description:String(t?.message||t),variant:"destructive"})}}),T=I({mutationFn:t=>C.authPasswordUpdate(t),onSuccess:()=>{b(""),j(""),n({title:"Mot de passe mis à jour"})},onError:t=>{n({title:"Mise à jour impossible",description:String(t?.message||t),variant:"destructive"})}}),y=I({mutationFn:async()=>{const t=String(u?.ffn_iuf??"").trim();if(!t)throw new Error("IUF FFN manquant. Ajoutez-le dans votre profil.");return C.syncFfnSwimRecords({athleteId:r??void 0,athleteName:s??void 0,iuf:t})},onSuccess:t=>{a.invalidateQueries({queryKey:["swim-records"]}),n({title:"Records FFN importés",description:`${t?.inserted??0} ajouté(s), ${t?.updated??0} mis à jour, ${t?.skipped??0} inchangé(s)`})},onError:t=>{n({title:"Import FFN impossible",description:String(t?.message||t),variant:"destructive"})}}),se=()=>{v({group_id:u?.group_id?String(u.group_id):"",objectives:u?.objectives||"",bio:u?.bio||"",avatar_url:u?.avatar_url||"",birthdate:u?.birthdate?String(u.birthdate).split("T")[0]:"",ffn_iuf:u?.ffn_iuf?String(u.ffn_iuf):""}),g(!0)},te=()=>A.mutate(p),re=()=>{if(!x||x.length<6){n({title:"Mot de passe invalide",description:"Minimum 6 caractères.",variant:"destructive"});return}if(x!==S){n({title:"Mot de passe invalide",description:"Les mots de passe ne correspondent pas.",variant:"destructive"});return}T.mutate({password:x})},ae=q.find(t=>t.id===u?.group_id)?.name||u?.group_label||"Non défini";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Profil"}),e.jsxs(_,{children:[e.jsxs(F,{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(X,{className:"h-16 w-16",children:[e.jsx(Y,{src:ee,alt:s||"Profil"}),e.jsx(Z,{children:(s||"?").slice(0,2).toUpperCase()})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xl font-semibold truncate",children:s}),e.jsx("p",{className:"text-sm text-muted-foreground uppercase font-bold tracking-wider",children:m})]})]}),!f&&e.jsx(N,{variant:"ghost",size:"icon",className:"absolute top-4 right-4",onClick:se,"aria-label":"Modifier le profil",children:e.jsx(Ne,{className:"h-4 w-4"})})]}),e.jsx(P,{className:"space-y-4",children:f?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{children:"Groupe"}),e.jsxs(xe,{value:p.group_id,onValueChange:t=>v({...p,group_id:t}),disabled:U,children:[e.jsx(he,{children:e.jsx(ge,{placeholder:U?"Chargement...":"Choisir un groupe"})}),e.jsx(ve,{children:q.map(t=>e.jsx(je,{value:String(t.id),children:t.name},t.id))})]})]}),c?e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{children:"IUF FFN"}),e.jsx(w,{value:p.ffn_iuf,onChange:t=>v({...p,ffn_iuf:t.target.value}),placeholder:"879576",inputMode:"numeric"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Identifiant unique FFN (utilisé pour importer vos records compétition)."})]}):null,e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{children:"Objectifs"}),e.jsx(w,{value:p.objectives,onChange:t=>v({...p,objectives:t.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{children:"Bio"}),e.jsx(fe,{value:p.bio,onChange:t=>v({...p,bio:t.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{children:"Avatar (URL)"}),e.jsx(w,{value:p.avatar_url,onChange:t=>v({...p,avatar_url:t.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{children:"Date de naissance"}),e.jsx(w,{type:"date",value:p.birthdate,onChange:t=>v({...p,birthdate:t.target.value})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{onClick:te,disabled:A.isPending,className:"w-full",children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Enregistrer"]}),e.jsx(N,{variant:"outline",onClick:()=>g(!1),disabled:A.isPending,children:"Annuler"})]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-xs text-muted-foreground uppercase",children:"Groupe"}),e.jsx("div",{className:"font-medium",children:ae})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-xs text-muted-foreground uppercase",children:"Date de naissance"}),e.jsx("div",{className:"font-medium",children:ke(u?.birthdate??null)})]}),c?e.jsxs("div",{children:[e.jsx(h,{className:"text-xs text-muted-foreground uppercase",children:"IUF FFN"}),e.jsx("div",{className:"font-medium",children:String(u?.ffn_iuf??"")||"Non renseigné"})]}):null,e.jsxs("div",{className:c?"":"col-span-2",children:[e.jsx(h,{className:"text-xs text-muted-foreground uppercase",children:"Objectifs"}),e.jsx("div",{className:"font-medium",children:u?.objectives||"Aucun objectif défini."})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(h,{className:"text-xs text-muted-foreground uppercase",children:"Bio"}),e.jsx("div",{className:"font-medium",children:u?.bio||"Non renseignée."})]})]})}),e.jsx(ue,{className:"flex justify-end",children:e.jsxs(N,{variant:"outline",onClick:i,className:"gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),"Se déconnecter"]})})]}),c?e.jsxs(_,{children:[e.jsxs(F,{children:[e.jsx(L,{children:"FFN"}),e.jsx(E,{children:"Importer vos records compétition depuis Extranat."})]}),e.jsxs(P,{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["IUF enregistré : ",e.jsx("span",{className:"font-medium text-foreground",children:String(u?.ffn_iuf??"")||"—"})]}),e.jsxs(N,{className:"w-full gap-2",onClick:()=>y.mutate(),disabled:y.isPending||!String(u?.ffn_iuf??"").trim(),children:[e.jsx(Se,{className:["h-4 w-4",y.isPending?"animate-spin":""].join(" ")}),y.isPending?"Import en cours...":"Récupérer records depuis FFN"]}),String(u?.ffn_iuf??"").trim()?null:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ajoutez votre IUF FFN dans le profil (bouton crayon) pour activer l’import."})]})]}):null,d?e.jsxs(_,{children:[e.jsxs(F,{children:[e.jsx(L,{children:"Mot de passe"}),e.jsx(E,{children:"Modifiez votre mot de passe."})]}),e.jsxs(P,{className:"space-y-3",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{children:"Nouveau mot de passe"}),e.jsx(w,{type:"password",value:x,onChange:t=>b(t.target.value),placeholder:"••••••••"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{children:"Confirmer"}),e.jsx(w,{type:"password",value:S,onChange:t=>j(t.target.value),placeholder:"••••••••"})]}),e.jsx(N,{className:"w-full",onClick:re,disabled:T.isPending,children:"Mettre à jour le mot de passe"})]})]}):null,c?e.jsxs(_,{children:[e.jsxs(F,{children:[e.jsx(L,{children:"Records"}),e.jsx(E,{children:"Consultez vos records de natation et musculation."})]}),e.jsx(P,{children:e.jsx(me,{href:"/records",children:e.jsx(N,{asChild:!0,children:e.jsx("a",{children:"Voir mes records"})})})})]}):null]})}export{Qe as default,Me as getRoleLabel,Re as shouldShowRecords};
