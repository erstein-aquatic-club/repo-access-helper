import{r as j,c as k,u as A,d as T,j as e}from"./vendor-query-BiSH4r2z.js";import{u as E,b as I,d as L,B as l,C as B,g as R,S as i}from"./index-B84kP_4I.js";import{B as N}from"./badge-BfPV4TwL.js";import{S as q}from"./separator-BZ6qFO90.js";import{S as M,a as _,b as D,c as F}from"./sheet-BRM8nJkg.js";import{S as Q}from"./SwimSessionTimeline-CbaefM8q.js";import{a as y}from"./api-B3SYsFV4.js";import{C as z}from"./circle-alert-DsNU3Zjq.js";import{C as H}from"./chevron-left-BrS-s74k.js";import{f as K}from"./format-B9mPVj_w.js";import{f as $}from"./fr-CFyqyHeU.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-6k692oZB.js";import"./index-B2LDpcqA.js";import"./index-Di9oD5fB.js";import"./index-D4p2JjkK.js";import"./eye-Deipv7ae.js";import"./chevron-down-BxXR5EDx.js";import"./clock-XYuKRXSg.js";const O={assigned:"Assignée",pending:"Assignée",in_progress:"En cours",completed:"Terminée",cancelled:"Annulée"},P=r=>{if(!r)return"-";const a=new Date(r);return Number.isNaN(a.getTime())?r:K(a,"dd MMM",{locale:$})};function me(){const{user:r,userId:a}=E(),[c,o]=I(),[s,d]=j.useState(null),{toast:m}=L(),b=k(),u=j.useMemo(()=>{const[,t]=c.split("?");if(!t)return null;const h=new URLSearchParams(t).get("assignmentId"),g=h?Number(h):NaN;return Number.isFinite(g)?g:null},[c]),{data:v,isLoading:w,error:x,refetch:S}=A({queryKey:["assignments",r],queryFn:()=>y.getAssignments(r,a),enabled:!!r}),p=v?.filter(t=>t.session_type==="swim")||[],n=u?p.find(t=>t.id===u):p[0],C=T({mutationFn:t=>y.assignments_delete(t),onSuccess:()=>{b.invalidateQueries({queryKey:["assignments"]}),m({title:"Séance retirée",description:"La séance a été retirée de votre feed."}),o("/")},onError:()=>{m({title:"Erreur",description:"Impossible de retirer la séance.",variant:"destructive"})}});return x?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(z,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:x.message}),e.jsx(l,{onClick:()=>S(),className:"mt-4",children:"Réessayer"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>o("/"),"aria-label":"Retour à l'accueil",children:e.jsx(H,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.2em] text-muted-foreground",children:"Séance natation"}),e.jsx("h1",{className:"text-2xl font-display font-bold uppercase",children:"Lecture"})]})]}),n?e.jsx(N,{variant:"secondary",className:"text-xs",children:O[n.status]??"Assignée"}):null]}),e.jsx(B,{className:"border border-border shadow-sm",children:e.jsxs(R,{className:"space-y-4 p-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-lg font-semibold tracking-tight",children:n?.title??"Séance natation"}),n?.description?e.jsx("p",{className:"text-sm text-muted-foreground",children:n.description}):null]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx(N,{variant:"outline",className:"text-xs",children:P(n?.assigned_date)}),n?e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>{window.confirm("Retirer cette séance de votre feed ?")&&C.mutate(n.id)},className:"text-xs text-muted-foreground hover:text-foreground",children:"Retirer de mon feed"}):null]}),e.jsx(q,{}),w?e.jsxs("div",{className:"space-y-4","aria-live":"polite","aria-busy":"true",children:[e.jsx("div",{className:"sr-only",children:"Chargement de la séance..."}),e.jsx(i,{className:"h-6 w-48"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((t,f)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"h-5 w-32"}),e.jsx(i,{className:"h-4 w-full"}),e.jsx(i,{className:"h-4 w-3/4"})]},`skeleton-${f}`))})]}):n?e.jsx(Q,{title:n.title,description:n.description,items:n.items,showHeader:!0,onExerciseSelect:t=>{d(t)}}):e.jsx("div",{className:"rounded-2xl border border-dashed border-muted/70 bg-muted/30 p-6 text-sm text-muted-foreground",children:"Aucune séance de natation assignée pour le moment."})]})}),e.jsx(M,{open:!!s,onOpenChange:t=>{t||d(null)},children:e.jsxs(_,{side:"bottom",className:"max-h-[80vh] overflow-y-auto",children:[e.jsx(D,{children:e.jsx(F,{children:"Détails de l'exercice"})}),s?e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-muted-foreground",children:s.blockTitle&&s.blockIndex!==void 0?`Bloc ${s.blockIndex+1}`:"Bloc"}),e.jsx("p",{className:"text-lg font-semibold",children:s.label})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:[s.repetitions?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:[s.repetitions,"x"]}):null,s.distance?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:[s.distance,"m"]}):null,s.rest?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:["Récup ",s.rest,"s"]}):null,s.stroke?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:["Nage : ",s.stroke]}):null,s.strokeType?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:["Type : ",s.strokeType]}):null,s.intensity?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:["Intensité : ",s.intensity]}):null]}),s.modalities?e.jsx("div",{className:"rounded-2xl border bg-muted/10 p-3 text-sm text-muted-foreground",children:s.modalities}):null,s.equipment?.length?e.jsx("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:s.equipment.map(t=>e.jsx("span",{className:"rounded-full border px-2 py-1",children:t},t))}):null]}):null]})})]})}export{me as default};
