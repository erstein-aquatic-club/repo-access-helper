import{r as d,j as e,R as yt}from"./vendor-ui-DJQMR4VV.js";import{b as jt,u as Ye,c as _e}from"./vendor-query-BT4y-huw.js";import{c as xe,b as Nt,X as Be,W as Te,F as vt,u as wt,f as kt,B as St,d as je}from"./index-CTSBy5ex.js";import{C as Mt}from"./chevron-left-XVXE7Pan.js";import{C as dt,A as Se,B as Dt,I as Qe}from"./BottomActionBar-CVIj93mi.js";import{C as Me}from"./circle-DLF3AS1I.js";import{m as ee,a as At,s as Ct,l as Ve}from"./animations-BTr26p-C.js";import{d as We}from"./design-tokens-CGMys_0P.js";import{C as He}from"./check-C5YVkh5w.js";import{P as ct}from"./plus-BYrmyYkS.js";import{C as Ot}from"./circle-alert-DOURnK4b.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-charts-Db4xOvcx.js";import"./vendor-supabase-D7B1G6YZ.js";import"./loader-circle-BbnkgNen.js";import"./circle-check-B7CrV7DN.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=[["path",{d:"M5 12h14",key:"1ays0h"}]],ut=xe("minus",Ft);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],$t=xe("moon",_t);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],Et=xe("power",It);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],Ue=xe("settings-2",Pt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Kt=xe("sun",Lt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Xe=xe("user-check",Bt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],ve=xe("user-x",Tt),Ge={NL:"",DOS:"",BR:"",PAP:"",QN:""};function Ze(t){return String(t).padStart(2,"0")}function et(t){return`${t.getFullYear()}-${Ze(t.getMonth()+1)}-${Ze(t.getDate())}`}function tt(t){return new Date(t.getFullYear(),t.getMonth(),1)}function st(t,s){const n=new Date(t);return n.setDate(n.getDate()+s),n}function $e(t){return(t.getDay()+6)%7}function De(t){const s=Number(t);return Number.isFinite(s)?Math.round(s/1e3*100)/100:0}function Rt(t){const s=Number(t);return Number.isFinite(s)?Math.round(s*1e3):0}function qt(t){return t?String(t).replaceAll(`\r
`,`
`).split(`
`).map(n=>n.trim()).filter(Boolean).flatMap(n=>{const r=n.replace(/^[•\\-–—]\\s*/,"").trim();return r?[r]:[]}):[]}function zt(t){if(!t)return null;const n=String(t).match(/(\\d+(?:[\\.,]\\d+)?)\\s*(km|m)\\b/i);if(!n)return null;const r=Number(String(n[1]).replace(",","."));return Number.isFinite(r)?n[2].toLowerCase()==="m"?De(r):r:null}function Jt(t,s){const n=t?.slot??t?.session_slot??t?.assigned_slot??t?.time_slot??t?.timeOfDay??t?.slot_key??t?.slotKey,r=String(n||"").toLowerCase();if(r.includes("mat")||r.includes("morning")||r==="am")return"AM";if(r.includes("soir")||r.includes("evening")||r==="pm")return"PM";const m=`${t?.title??""} ${t?.description??""}`.toLowerCase();return m.includes("matin")||m.includes(" am ")||m.includes("(am)")?"AM":m.includes("soir")||m.includes(" pm ")||m.includes("(pm)")?"PM":s===0?"AM":"PM"}function Yt(t){const s=t?.assigned_date??t?.date??t?.day??t?.scheduled_for??t?.scheduledAt??null;if(!s)return null;const n=String(s),r=n.length>=10?n.slice(0,10):n;return/\d{4}-\d{2}-\d{2}/.test(r)?r:null}function Qt(t){const s=t?.distance_meters??t?.distanceMeters??t?.meters??t?.planned_meters??t?.plannedMeters??t?.distance??null;if(s!=null&&Number.isFinite(Number(s))){const m=Number(s);return m>0&&m<=50?m:De(m)}const n=t?.km??t?.distance_km??t?.distanceKm??t?.planned_km??t?.plannedKm??null;if(n!=null&&Number.isFinite(Number(n)))return Number(n);const r=zt(`${t?.title??""} ${t?.description??""}`);return r??null}function nt(t){const s=Number(t);if(!Number.isFinite(s))return"—";const n=Math.round(s*100)/100,r=String(n);return r.endsWith(".0")?r.slice(0,-2):r}function Vt(){const t={};for(let s=0;s<7;s++)t[s]={AM:!0,PM:!0};return t}function Ie(t){if(!t)return null;try{return JSON.parse(t)}catch{return null}}function Wt({sessions:t,assignments:s,userId:n,user:r}){const m=`swim-dashboard-v2:${n??r??"anon"}`,u=`${m}:presenceDefaults`,C=`${m}:attendanceOverrides`,x=`${m}:stableFields`,[b,w]=d.useState(()=>Vt()),[h,v]=d.useState({}),[T,z]=d.useState(90);d.useEffect(()=>{if(typeof window>"u")return;const a=Ie(window.localStorage.getItem(u));a&&w(a);const i=Ie(window.localStorage.getItem(C));i&&v(i);const l=Ie(window.localStorage.getItem(x));l?.duration&&Number.isFinite(l.duration)&&l.duration>=30&&l.duration<=240&&z(l.duration)},[u,C,x]),d.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(u,JSON.stringify(b))},[b,u]),d.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(C,JSON.stringify(h))},[h,C]),d.useEffect(()=>{typeof window>"u"||window.localStorage.setItem(x,JSON.stringify({duration:T}))},[T,x]);const J=d.useMemo(()=>new Date,[]),[L,R]=d.useState(()=>tt(new Date)),[O,te]=d.useState(()=>et(new Date)),[Y,Q]=d.useState(!1),[fe,be]=d.useState(!1),[k,y]=d.useState(!1),[S,A]=d.useState(null),[F,M]=d.useState(!1),[U,X]=d.useState(null),[se,g]=d.useState(!1),[j,I]=d.useTransition(),ne=d.useMemo(()=>(Array.isArray(s)?s:[]).filter(i=>i?.session_type==="swim"),[s]),le=d.useMemo(()=>{const a=new Map;for(const i of ne){const l=Yt(i);l&&(a.has(l)||a.set(l,[]),a.get(l).push(i))}for(const[i,l]of a.entries())l.sort((f,p)=>Number(f?.id??0)-Number(p?.id??0)),a.set(i,l);return a},[ne]),E=d.useMemo(()=>{const a=Array.isArray(t)?t:[],i={};for(const l of a){const f=String(l?.date??"").slice(0,10),p=l?.slot==="Soir"?"PM":"AM";i[`${f}__${p}`]=l}return i},[t]),he=d.useRef(new Map);d.useEffect(()=>{he.current.clear()},[le]);const re=d.useCallback(a=>{const i=he.current;if(i.has(a))return i.get(a);const l=[{id:`${a}__AM`,iso:a,slotKey:"AM",title:"Séance vide",km:null,details:[],isEmpty:!0},{id:`${a}__PM`,iso:a,slotKey:"PM",title:"Séance vide",km:null,details:[],isEmpty:!0}],f=le.get(a)??[],p=new Set;return f.forEach((_,ae)=>{const H=_,Z=Jt(H,ae);if(p.has(Z))return;const me=Z==="AM"?0:1,Ae=Qt(H),Ce=Array.isArray(H?.details)?H.details.map(String):qt(_?.description);l[me]={id:`${a}__${Z}`,iso:a,slotKey:Z,title:String(_?.title??"Séance coach"),km:Ae,details:Ce,assignmentId:typeof _?.id=="number"?_.id:Number(_?.id)||void 0,isEmpty:!1},p.add(Z)}),i.set(a,l),l},[le]),de=d.useCallback((a,i)=>{const l=$e(i),f=!!b?.[l]?.[a.slotKey],p=h[a.id];return p==="present"?{status:"present",expected:!0,expectedByDefault:f}:p==="absent"?{status:"absent",expected:!0,expectedByDefault:f}:f?{status:"present",expected:!0,expectedByDefault:f}:{status:"not_expected",expected:!1,expectedByDefault:f}},[h,b]),q=d.useMemo(()=>tt(L),[L]),V=d.useMemo(()=>{const a=$e(q),i=st(q,-a),l=[];for(let f=0;f<42;f++)l.push(st(i,f));return l},[q]),ce=d.useMemo(()=>{const a={};for(const i of V){const l=et(i),f=re(l);let p=0,_=0;for(const ae of f){const H=de(ae,i);if(!H.expected)continue;p+=1;const Z=!!E[ae.id],me=H.status==="absent";(Z||me)&&(_+=1)}a[l]={completed:_,total:p}}return a},[V,re,de,E]),oe=d.useMemo(()=>{const[a,i,l]=O.split("-").map(Number);return new Date(a,i-1,l)},[O]),G=d.useMemo(()=>re(O),[re,O]),W=ce[O]||{completed:0,total:2},K=d.useMemo(()=>{const a=Array.isArray(t)?t:[];let i=0;for(const l of a){const f=String(l?.date??"").slice(0,10),p=l?.slot==="Soir"?"PM":"AM",_=`${f}__${p}`;if(h[_]==="absent")continue;const ae=$e(new Date(f));(b?.[ae]?.[p]||h[_]==="present")&&Number.isFinite(Number(l?.distance))&&(i+=Number(l.distance))}return nt(De(i))},[t,h,b]),P=d.useMemo(()=>{const a=G;let i=0;for(const l of a){const f=de(l,oe);if(!f.expected||f.status==="absent")continue;const p=E[l.id];p&&Number.isFinite(Number(p?.distance))&&(i+=Number(p.distance))}return nt(De(i))},[G,de,oe,E]),ue=d.useMemo(()=>S&&E[S]||null,[S,E]),ie=d.useMemo(()=>{const a=ue||{},i=a?.stroke_distances,l=i?{NL:i.NL?String(i.NL):"",DOS:i.DOS?String(i.DOS):"",BR:i.BR?String(i.BR):"",PAP:i.PAP?String(i.PAP):"",QN:i.QN?String(i.QN):""}:Ge;return{difficulty:a?.effort??null,fatigue_end:a?.fatigue??a?.feeling??null,performance:a?.performance??a?.feeling??null,engagement:a?.engagement??a?.feeling??null,comment:String(a?.comments??""),distanceMeters:Number.isFinite(Number(a?.distance))?Number(a.distance):null,showStrokeDetail:!!(i&&Object.values(i).some(f=>f&&f>0)),strokes:l}},[ue]),[B,ge]=d.useState(()=>({difficulty:null,fatigue_end:null,performance:null,engagement:null,comment:"",distanceMeters:null,showStrokeDetail:!1,strokes:Ge}));return d.useEffect(()=>{const a=G.find(i=>i.id===S);if(a){const i=Rt(a.km??0);ge(l=>({...l,...ie,distanceMeters:ie.distanceMeters==null?i:ie.distanceMeters}));return}ge(i=>({...i,...ie}))},[ie,S,G]),d.useEffect(()=>{Y&&se&&W.total>0&&W.completed>=W.total&&(Q(!1),A(null),M(!1),g(!1))},[Y,se,W.completed,W.total]),{today:J,monthCursor:L,selectedISO:O,drawerOpen:Y,settingsOpen:fe,infoOpen:k,activeSessionId:S,detailsOpen:F,selectedDayIndex:U,isPending:j,presenceDefaults:b,attendanceOverrideBySessionId:h,stableDurationMin:T,draftState:B,gridDates:V,completionByISO:ce,selectedDate:oe,sessionsForSelectedDay:G,selectedDayStatus:W,globalKm:K,dayKm:P,logsBySessionId:E,setMonthCursor:R,setSelectedISO:te,setDrawerOpen:Q,setSettingsOpen:be,setInfoOpen:y,setActiveSessionId:A,setDetailsOpen:M,setSelectedDayIndex:X,setPresenceDefaults:w,setAttendanceOverrideBySessionId:v,setStableDurationMin:z,setDraftState:ge,setAutoCloseArmed:g,startTransition:I,getSessionStatus:de,getSessionsForISO:re}}function Re(...t){return t.filter(Boolean).join(" ")}function Ht(t){return t.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})}function Ee({onClick:t,label:s,children:n,tone:r="neutral",disabled:m}){const u={neutral:"bg-background border-border text-foreground hover:bg-muted",dark:"bg-foreground border-foreground text-background hover:opacity-90",sky:"bg-primary/10 border-primary/30 text-primary hover:bg-primary/20"};return e.jsxs("button",{type:"button",onClick:t,disabled:m,className:Re("inline-flex items-center justify-center rounded-2xl border p-2 transition",u[r],m&&"opacity-50 cursor-not-allowed hover:bg-background"),"aria-label":s,title:s,children:[n,e.jsx("span",{className:"sr-only",children:s})]})}function Ut({monthCursor:t,selectedDayStatus:s,onPrevMonth:n,onNextMonth:r,onJumpToday:m}){return e.jsxs("div",{className:"flex items-center justify-between px-3 sm:px-5 py-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ee,{onClick:n,label:"Mois précédent",children:e.jsx(Mt,{className:"h-5 w-5"})}),e.jsx(Ee,{onClick:r,label:"Mois suivant",children:e.jsx(dt,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"min-w-0 text-center",children:[e.jsx("div",{className:"text-base font-semibold text-foreground capitalize truncate",children:Ht(t)}),e.jsxs("div",{className:"mt-1 flex items-center justify-center gap-1",children:[e.jsx("span",{className:Re("h-1.5 w-1.5 rounded-full",s.total>0&&s.completed>=1?"bg-status-success":"bg-muted-foreground/30")}),e.jsx("span",{className:Re("h-1.5 w-1.5 rounded-full",s.total>0&&s.completed>=2?"bg-status-success":"bg-muted-foreground/30")})]})]}),e.jsx(Ee,{onClick:m,label:"Aller à aujourd'hui",tone:"neutral",children:e.jsx(Me,{className:"h-5 w-5"})})]})}function we(...t){return t.filter(Boolean).join(" ")}function Xt(t){const s=n=>String(n).padStart(2,"0");return`${t.getFullYear()}-${s(t.getMonth()+1)}-${s(t.getDate())}`}function Gt({completed:t,total:s}){return s===0?"rest":t>=s?"full":t>0?"half":"none"}const Zt=d.memo(function({date:s,inMonth:n,isToday:r,isSelected:m,isFocused:u,status:C,onClick:x,onKeyDown:b}){const{completed:w,total:h}=C,v=Gt(C),T=v==="full"?"bg-primary":v==="half"?"bg-primary/10":v==="none"?"bg-muted":"bg-muted/50",z=v==="full"?"border-primary":v==="half"?"border-primary/30":v==="none"?"border-muted-foreground/20":"border-border",J=v==="full"?"text-primary-foreground":"text-foreground",L=v==="full"?"bg-primary-foreground/25":"bg-muted-foreground/30",R=v==="full"?"bg-primary-foreground":"bg-primary",O=m?v==="full"?"ring-2 ring-primary-foreground/50":"ring-2 ring-primary/30":"",te=r?v==="full"?"ring-2 ring-primary-foreground/40":"ring-2 ring-primary/50":"",Y=u?"ring-2 ring-primary":"";return e.jsx("button",{type:"button",onClick:x,onKeyDown:b,tabIndex:u?0:-1,"data-calendar-cell":"true",className:we("aspect-square min-w-0 rounded-2xl border p-1 transition",T,z,!n&&"opacity-40","hover:shadow-sm focus:outline-none",O,te,Y),"aria-label":`${Xt(s)} — ${h===0?"Repos":`${w}/${h}`}`,children:e.jsxs("div",{className:"flex h-full flex-col justify-between",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:we("text-[12px] font-semibold",J),children:s.getDate()}),e.jsx("div",{className:"h-[14px] w-[14px]"})]}),e.jsx("div",{className:"flex items-center justify-end",children:h>0&&e.jsx("div",{className:"w-6",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:we("h-1.5 flex-1 rounded-full",w>=1?R:L)}),e.jsx("span",{className:we("h-1.5 flex-1 rounded-full",w>=2?R:L)})]})})})]})})}),es=["L","M","M","J","V","S","D"],ts=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"];function ss(t){const s=n=>String(n).padStart(2,"0");return`${t.getFullYear()}-${s(t.getMonth()+1)}-${s(t.getDate())}`}function ns(t,s){return t.getFullYear()===s.getFullYear()&&t.getMonth()===s.getMonth()&&t.getDate()===s.getDate()}function rs({monthCursor:t,gridDates:s,completionByISO:n,selectedISO:r,selectedDayIndex:m,today:u,onDayClick:C,onKeyDown:x}){return e.jsx("div",{className:"p-3 sm:p-5",children:e.jsxs("div",{className:"grid grid-cols-7 gap-1.5 sm:gap-2",children:[es.map((b,w)=>e.jsxs("div",{className:"px-0.5 pb-1 text-[10px] font-semibold text-muted-foreground text-center",children:[e.jsx("span",{className:"sm:hidden",children:b}),e.jsx("span",{className:"hidden sm:inline",children:ts[w]})]},b+w)),s.map((b,w)=>{const h=ss(b),v=b.getMonth()===t.getMonth(),T=h===r,z=n[h]||{completed:0,total:2},J=ns(b,u),L=m===w||m===null&&J;return e.jsx(Zt,{date:b,inMonth:v,isToday:J,isSelected:T,isFocused:L,status:z,onClick:()=>C(h),onKeyDown:R=>x(R,w)},h)})]})})}function Pe(...t){return t.filter(Boolean).join(" ")}const rt={NL:"NL",DOS:"Dos",BR:"Brasse",PAP:"Pap",QN:"4N"};function os({strokes:t,showStrokeDetail:s,disabled:n=!1,onToggle:r,onChange:m}){return e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{type:"button",disabled:n,onClick:r,className:Pe("flex w-full items-center justify-between rounded-2xl border px-3 py-2 text-sm font-semibold transition",n?"text-muted-foreground border-border cursor-not-allowed":"text-foreground border-border hover:bg-muted"),children:[e.jsx("span",{children:"Détail par nage"}),e.jsx(dt,{className:Pe("h-4 w-4 transition-transform",s&&"rotate-90")})]}),s&&e.jsx("div",{className:"mt-2 grid grid-cols-5 gap-2",children:Object.keys(rt).map(u=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block text-center text-xs font-medium text-muted-foreground",children:rt[u]}),e.jsx("input",{type:"number",inputMode:"numeric",min:0,step:100,disabled:n,value:t[u],onChange:C=>m({...t,[u]:C.target.value}),placeholder:"0",className:Pe("w-full rounded-xl border px-1 py-2 text-center text-sm outline-none",n?"bg-muted text-muted-foreground":"bg-card text-foreground border-border focus:ring-2 focus:ring-foreground/10")}),e.jsx("div",{className:"text-center text-[10px] text-muted-foreground",children:"m"})]},u))})]})}function D(...t){return t.filter(Boolean).join(" ")}function is(t){return t.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})}function qe(t){const s=Number(t);if(!Number.isFinite(s))return"—";const n=Math.round(s*100)/100,r=String(n);return r.endsWith(".0")?r.slice(0,-2):r}function as(t){const s=Number(t);return Number.isFinite(s)?Math.round(s/1e3*100)/100:0}function ls(t){const s=Number(t);return Number.isFinite(s)?Math.round(s*1e3):0}const Le=[{key:"difficulty",label:"Difficulté",mode:"hard"},{key:"fatigue_end",label:"Fatigue fin",mode:"hard"},{key:"performance",label:"Perf perçue",mode:"good"},{key:"engagement",label:"Engagement",mode:"good"}],ds=[{key:"AM",label:"Matin",Icon:Kt},{key:"PM",label:"Soir",Icon:$t}];function ke({children:t}){return e.jsx("span",{className:"inline-flex items-center rounded-full bg-muted px-2 py-0.5 text-xs font-semibold text-muted-foreground",children:t})}function Ne({onClick:t,label:s,children:n,tone:r="neutral",disabled:m}){const u={neutral:"bg-background border-border text-foreground hover:bg-muted",dark:"bg-foreground border-foreground text-background hover:opacity-90",sky:"bg-primary/10 border-primary/30 text-primary hover:bg-primary/20"};return e.jsxs("button",{type:"button",onClick:t,disabled:m,className:D("inline-flex items-center justify-center rounded-2xl border p-2 transition",u[r],m&&"opacity-50 cursor-not-allowed hover:bg-background"),"aria-label":s,title:s,children:[n,e.jsx("span",{className:"sr-only",children:s})]})}function cs(t,s){const n=Number(s);return!Number.isFinite(n)||n<1||n>5?"neutral":t==="hard"?{1:"bg-intensity-1 border-intensity-1 text-white",2:"bg-intensity-2 border-intensity-2 text-white",3:"bg-intensity-3 border-intensity-3 text-white",4:"bg-intensity-4 border-intensity-4 text-white",5:"bg-intensity-5 border-intensity-5 text-white"}[n]:{1:"bg-intensity-5 border-intensity-5 text-white",2:"bg-intensity-4 border-intensity-4 text-white",3:"bg-intensity-3 border-intensity-3 text-white",4:"bg-intensity-2 border-intensity-2 text-white",5:"bg-intensity-1 border-intensity-1 text-white"}[n]}function us({plannedMeters:t,valueMeters:s,onChange:n,disabled:r}){const x=Number.isFinite(Number(s))?Number(s):t,b=x-t;return e.jsxs("div",{className:D("mt-4 rounded-3xl border px-4 py-3",r?"bg-muted border-border":"bg-card border-border"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:D("text-xs font-semibold",r?"text-muted-foreground":"text-foreground"),children:"Ajuster kilométrage"}),e.jsx("div",{className:D("text-xs","text-muted-foreground"),children:b===0?"":b>0?`+${b}m`:`${b}m`})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-center gap-3",children:[e.jsx("button",{type:"button",disabled:r||x-100<0,onClick:()=>n(x-100),className:D("h-11 w-11 rounded-2xl border flex items-center justify-center",r?"bg-muted border-border text-muted-foreground":"bg-card border-border text-foreground hover:bg-muted"),"aria-label":"-100m",children:e.jsx(ut,{className:"h-5 w-5"})}),e.jsxs("div",{className:"min-w-[120px] text-center",children:[e.jsxs("div",{className:D("text-lg font-semibold",r?"text-muted-foreground":"text-foreground"),children:[x,"m"]}),e.jsxs("div",{className:D("text-xs","text-muted-foreground"),children:["(",qe(as(x))," km)"]})]}),e.jsx("button",{type:"button",disabled:r||x+100>3e4,onClick:()=>n(x+100),className:D("h-11 w-11 rounded-2xl border flex items-center justify-center",r?"bg-muted border-border text-muted-foreground":"bg-card border-border text-foreground hover:bg-muted"),"aria-label":"+100m",children:e.jsx(ct,{className:"h-5 w-5"})})]})]})}function ms({open:t,selectedDate:s,sessionsForSelectedDay:n,selectedDayStatus:r,dayKm:m,activeSessionId:u,detailsOpen:C,draftState:x,saveState:b,isPending:w,logsBySessionId:h,onClose:v,onDayOffAll:T,onOpenSession:z,onCloseSession:J,onToggleDetails:L,onMarkAbsent:R,onMarkPresent:O,onClearOverride:te,onSaveFeedback:Y,onDraftStateChange:Q,getSessionStatus:fe}){const[,be]=Nt(),k=d.useMemo(()=>u&&n.find(y=>y.id===u)||null,[u,n]);return e.jsx(Se,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(ee.div,{className:"fixed inset-0 z-overlay bg-black/30",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:v}),e.jsx(ee.div,{className:D("fixed z-modal bg-background shadow-2xl","left-0 right-0 bottom-0 top-auto max-h-[calc(100dvh-env(safe-area-inset-top))] h-[88dvh] rounded-t-3xl","sm:right-0 sm:top-0 sm:left-auto sm:bottom-auto sm:h-full sm:w-full sm:max-w-xl sm:rounded-none"),variants:At,initial:"hidden",animate:"visible",exit:"exit",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx("div",{className:"px-5 pt-3 sm:hidden",children:e.jsx("div",{className:"mx-auto h-1.5 w-12 rounded-full bg-muted"})}),e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b bg-background px-4 sm:px-5 py-3",children:[e.jsx("div",{className:"min-w-0",children:e.jsx("div",{className:"truncate text-base font-semibold text-foreground",children:is(s)})}),e.jsx(Ne,{onClick:v,label:"Fermer",children:e.jsx(Be,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 pb-24 sm:p-5 sm:pb-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-2xl border border-border bg-card flex items-center justify-center",children:e.jsx(Te,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"text-sm font-semibold text-foreground",children:[m," km"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:D("h-1.5 w-1.5 rounded-full",r.total>0&&r.completed>=1?"bg-status-success":"bg-muted-foreground/30")}),e.jsx("span",{className:D("h-1.5 w-1.5 rounded-full",r.total>0&&r.completed>=2?"bg-status-success":"bg-muted-foreground/30")})]})]})]}),e.jsx(Ne,{onClick:T,label:"OFF (absent journée)",tone:"dark",disabled:w,children:e.jsx(Et,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"mt-4 grid gap-2",children:n.map(y=>{const S=fe(y,s),A=!!h[y.id],F=S.status==="absent",M=S.status==="not_expected",U=F||M,X=S.expected&&!A&&!F,se=A?"bg-status-success-bg border-status-success/30":U?"bg-sky-50 border-sky-200":X?"bg-status-warning-bg border-status-warning/30":"bg-card border-border",g=ds.find(j=>j.key===y.slotKey)?.Icon||Me;return e.jsx("button",{type:"button",onClick:()=>z(y.id),className:D("w-full rounded-3xl border px-3 py-3 text-left transition",se,"hover:shadow-sm"),children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:D("h-10 w-10 rounded-2xl border flex items-center justify-center",A?"border-status-success/30 bg-status-success-bg":U?"border-sky-200 bg-sky-100":X?"border-status-warning/30 bg-status-warning-bg":"border-border bg-muted"),children:e.jsx(g,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:y.title}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[y.isEmpty?e.jsx(ke,{children:"Vide"}):e.jsxs(ke,{children:[qe(y.km)," km"]}),A&&e.jsxs("span",{className:"inline-flex items-center text-emerald-800",children:[e.jsx(He,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Présent"})]}),U&&!A&&e.jsxs("span",{className:"inline-flex items-center text-sky-800",children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Absent"})]}),X&&e.jsxs("span",{className:"inline-flex items-center text-orange-900",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"En attente"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[M&&e.jsx(Ne,{onClick:j=>{j.stopPropagation(),O(y.id)},label:"Je suis venu",disabled:w,children:e.jsx(Xe,{className:"h-5 w-5"})}),S.expected&&!A&&!F&&e.jsx(Ne,{onClick:j=>{j.stopPropagation(),R(y.id)},label:"Absent",tone:"sky",disabled:w,children:e.jsx(ve,{className:"h-5 w-5"})})]})]})},y.id)})}),e.jsx(Se,{children:k&&e.jsx(ee.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:8},transition:{duration:We.normal},className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:(()=>{const y=fe(k,s),S=y.status==="absent",A=y.status==="not_expected",F=!!h[k.id],M=y.expected&&!S,U=S?"Annuler":A?"Je suis venu":"Absent",X=S?()=>te(k.id):A?()=>O(k.id):()=>R(k.id),se=ls(k.km??0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-foreground",children:k.title}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[k.isEmpty?e.jsx(ke,{children:"Vide"}):e.jsxs(ke,{children:[qe(k.km)," km"]}),F?e.jsxs("span",{className:"inline-flex items-center text-emerald-800",children:[e.jsx(He,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Présent"})]}):S||A?e.jsxs("span",{className:"inline-flex items-center text-sky-800",children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Absent"})]}):e.jsxs("span",{className:"inline-flex items-center text-orange-900",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"En attente"})]})]})]}),e.jsx(Ne,{onClick:J,label:"Retour",children:e.jsx(Be,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 p-3",children:[e.jsxs("button",{type:"button",onClick:X,className:D("rounded-2xl px-3 py-3 text-sm font-semibold border transition inline-flex items-center justify-center gap-2",A?"bg-foreground text-background border-foreground hover:opacity-90":"bg-card text-foreground border-border hover:bg-muted"),children:[A?e.jsx(Xe,{className:"h-4 w-4"}):e.jsx(ve,{className:"h-4 w-4"}),U]}),e.jsxs("button",{type:"button",onClick:L,className:"rounded-2xl px-3 py-3 text-sm font-semibold border border-border bg-card hover:bg-muted inline-flex items-center justify-center gap-2",children:[e.jsx(vt,{className:"h-4 w-4"}),"Fiche"]})]}),e.jsx(Se,{children:C&&e.jsxs(ee.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},exit:{opacity:0,y:6},transition:{duration:We.normal},className:"mx-3 mb-3 rounded-2xl border border-border bg-muted p-3",children:[k.details?.length?e.jsx("ul",{className:"list-disc pl-5 space-y-1 text-sm text-foreground",children:k.details.map((g,j)=>e.jsx("li",{children:g},j))}):e.jsx("div",{className:"text-sm text-muted-foreground",children:k.assignmentId?"Séance coach — détails dans la fiche.":"Aucun détail pour ce créneau."}),k.assignmentId?e.jsx("div",{className:"mt-3",children:e.jsx("button",{type:"button",onClick:()=>be(`/swim-session?assignmentId=${k.assignmentId}`),className:"w-full rounded-2xl border border-border bg-card px-3 py-2 text-sm font-semibold text-foreground hover:bg-muted",children:"Ouvrir la fiche complète"})}):null]})}),e.jsxs("div",{className:"px-4 pb-4",children:[!M&&e.jsx("div",{className:"mb-3 rounded-2xl bg-sky-50 text-sky-900 px-3 py-2 text-xs",children:S?"Absent: aucun ressenti.":'Non prévu: appuyez "Je suis venu".'}),e.jsxs(ee.div,{className:"space-y-4",variants:Ct,initial:"hidden",animate:"visible",children:[Le.map(g=>{const j=x[g.key];return e.jsxs(ee.div,{className:"space-y-2",variants:Ve,children:[e.jsx("div",{className:D("text-sm font-semibold",M?"text-foreground":"text-muted-foreground"),children:g.label}),e.jsx("div",{className:"flex items-center gap-2",children:[1,2,3,4,5].map(I=>{const ne=j===I;return e.jsx("button",{type:"button",disabled:!M,onClick:()=>Q({...x,[g.key]:I}),className:D("h-11 w-11 rounded-2xl border text-sm font-semibold transition",M?ne?cs(g.mode,I):"bg-card text-foreground border-border hover:bg-muted":"bg-muted text-muted-foreground border-border cursor-not-allowed"),children:I},I)})})]},g.key)}),e.jsxs(ee.div,{className:"space-y-2",variants:Ve,children:[e.jsx("div",{className:D("text-sm font-semibold",M?"text-foreground":"text-muted-foreground"),children:"Commentaire"}),e.jsx("textarea",{value:x.comment,onChange:g=>Q({...x,comment:g.target.value}),disabled:!M,rows:3,placeholder:"Sensations, points techniques…",className:D("w-full resize-none rounded-3xl border px-4 py-3 text-sm outline-none",M?"bg-card text-foreground border-border focus:ring-2 focus:ring-foreground/10":"bg-muted text-muted-foreground border-border")})]})]}),e.jsx(us,{plannedMeters:se,valueMeters:x.distanceMeters,onChange:g=>Q({...x,distanceMeters:g}),disabled:!M}),e.jsx(os,{strokes:x.strokes,showStrokeDetail:x.showStrokeDetail,disabled:!M,onToggle:()=>Q({...x,showStrokeDetail:!x.showStrokeDetail}),onChange:g=>Q({...x,strokes:g})}),e.jsxs(Dt,{saveState:b,children:[e.jsx("button",{type:"button",onClick:Y,disabled:w||!M||!Le.every(g=>Number.isInteger(x[g.key])),className:D("rounded-2xl px-4 py-3 text-sm font-semibold transition flex-1",w||!M?"bg-muted text-muted-foreground cursor-not-allowed":Le.every(g=>Number.isInteger(x[g.key]))?"bg-status-success text-white hover:opacity-90":"bg-status-success-bg text-status-success cursor-not-allowed"),children:"Valider"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"→ km"})]})]})]})})()},k.id)})]})]})})]})})}const xs=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],fs=[{key:"AM",label:"Matin"},{key:"PM",label:"Soir"}],bs=[{key:"difficulty",label:"Difficulté",mode:"hard"},{key:"fatigue_end",label:"Fatigue fin",mode:"hard"},{key:"performance",label:"Perf perçue",mode:"good"},{key:"engagement",label:"Engagement",mode:"good"}];function ot(...t){return t.filter(Boolean).join(" ")}function it(t){return String(t).padStart(2,"0")}function Ke(t){return`${t.getFullYear()}-${it(t.getMonth()+1)}-${it(t.getDate())}`}function gs(t){return new Date(t.getFullYear(),t.getMonth(),1)}function ps(t){const s=String(t).split("__");return{iso:s[0],slotKey:s[1]||""}}function at(t,s){return Number.isFinite(t)?Math.round(t/s)*s:0}function lt({open:t,title:s,onClose:n,children:r}){return e.jsx(Se,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(ee.div,{className:"fixed inset-0 z-overlay bg-black/30",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n}),e.jsx(ee.div,{className:"fixed inset-0 z-modal flex items-end sm:items-center justify-center p-3 pb-24 sm:p-4 sm:pb-4",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},children:e.jsxs("div",{className:"w-full max-w-md rounded-3xl border bg-background shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[e.jsx("div",{className:"truncate text-base font-semibold text-foreground",children:s}),e.jsxs("button",{type:"button",onClick:n,className:"inline-flex items-center justify-center rounded-2xl border border-border bg-background p-2 transition hover:bg-muted","aria-label":"Fermer",children:[e.jsx(Be,{className:"h-5 w-5"}),e.jsx("span",{className:"sr-only",children:"Fermer"})]})]}),e.jsx("div",{className:"p-4",children:r})]})})]})})}function Is(){const{user:t,userId:s}=wt(),{toast:n}=kt(),r=jt(),[m,u]=yt.useState("idle"),{data:C,isLoading:x,error:b,refetch:w}=Ye({queryKey:["sessions",s??t],queryFn:()=>je.getSessions(t,s),enabled:!!t}),{data:h,isLoading:v,error:T,refetch:z}=Ye({queryKey:["assignments",t],queryFn:()=>je.getAssignments(t,s),enabled:!!t}),J=x||v,L=b||T,R=()=>{w(),z()},O=_e({mutationFn:o=>je.deleteSession(o),onMutate:()=>{u("saving")},onSuccess:()=>{r.invalidateQueries({queryKey:["sessions"]}),n({title:"Séance supprimée",description:"La saisie a été supprimée."}),u("saved"),setTimeout(()=>u("idle"),2e3)},onError:()=>{n({title:"Erreur",description:"Impossible de supprimer la séance.",variant:"destructive"}),u("error"),setTimeout(()=>u("idle"),3e3)}}),te=_e({mutationFn:o=>je.syncSession({...o,athlete_name:t,athlete_id:s??void 0}),onMutate:()=>{u("saving")},onSuccess:()=>{r.invalidateQueries({queryKey:["sessions"]}),r.invalidateQueries({queryKey:["assignments"]}),n({title:"Séance enregistrée",description:"Vos données ont été synchronisées."}),u("saved"),setTimeout(()=>u("idle"),2e3)},onError:()=>{n({title:"Erreur",description:"Impossible d'enregistrer la séance.",variant:"destructive"}),u("error"),setTimeout(()=>u("idle"),3e3)}}),Y=_e({mutationFn:o=>je.updateSession(o),onMutate:()=>{u("saving")},onSuccess:()=>{r.invalidateQueries({queryKey:["sessions"]}),n({title:"Séance mise à jour",description:"Votre saisie a été mise à jour."}),u("saved"),setTimeout(()=>u("idle"),2e3)},onError:()=>{n({title:"Erreur",description:"Impossible de mettre à jour la séance.",variant:"destructive"}),u("error"),setTimeout(()=>u("idle"),3e3)}}),Q=Wt({sessions:C,assignments:h,userId:s,user:t}),{today:fe,monthCursor:be,selectedISO:k,drawerOpen:y,settingsOpen:S,infoOpen:A,activeSessionId:F,detailsOpen:M,selectedDayIndex:U,isPending:X,presenceDefaults:se,stableDurationMin:g,draftState:j,gridDates:I,completionByISO:ne,selectedDate:le,sessionsForSelectedDay:E,selectedDayStatus:he,globalKm:re,dayKm:de,logsBySessionId:q,setMonthCursor:V,setSelectedISO:ce,setDrawerOpen:oe,setSettingsOpen:G,setInfoOpen:W,setActiveSessionId:K,setDetailsOpen:P,setSelectedDayIndex:ue,setPresenceDefaults:ie,setAttendanceOverrideBySessionId:B,setStableDurationMin:ge,setDraftState:a,setAutoCloseArmed:i,startTransition:l,getSessionStatus:f}=Q,p=d.useCallback(o=>{ce(o),oe(!0),K(null),P(!1);const c=ne[o]||{completed:0,total:2};i(c.total>0&&c.completed<c.total)},[ne,ce,oe,K,P,i]),_=d.useCallback(()=>{oe(!1),K(null),P(!1),i(!1),ue(null)},[oe,K,P,i,ue]),ae=d.useCallback(()=>{V(o=>new Date(o.getFullYear(),o.getMonth()-1,1))},[V]),H=d.useCallback(()=>{V(o=>new Date(o.getFullYear(),o.getMonth()+1,1))},[V]),Z=d.useCallback(()=>{const o=new Date;V(gs(o)),p(Ke(o))},[p,V]),me=d.useCallback(o=>{K(o),P(!1)},[K,P]),Ae=d.useCallback(o=>{l(()=>{B(N=>({...N,[o]:"absent"}))});const c=q[o];c?.id&&O.mutate(Number(c.id))},[O,q,l,B]),Ce=d.useCallback(o=>{l(()=>{B(c=>({...c,[o]:"present"}))})},[l,B]),mt=d.useCallback(o=>{l(()=>{B(c=>{const N={...c};return delete N[o],N})})},[l,B]),xt=d.useCallback(()=>{const o=E.map(c=>f(c,le).expected?c.id:null).filter(Boolean);o.length!==0&&(l(()=>{B(c=>{const N={...c};for(const $ of o)N[$]="absent";return N}),K(null),P(!1)}),o.forEach(c=>{const N=q[c];N?.id&&O.mutate(Number(N.id))}))},[E,f,le,l,q,O,B,K,P]),ft=d.useCallback(()=>{if(!F||!t||!bs.every(ye=>Number.isInteger(j[ye.key])))return;const{iso:c,slotKey:N}=ps(F),$=N==="PM"?"Soir":"Matin",pe=at(Number(j.distanceMeters??0),100),pt=at(Number(g),15),Oe={};for(const[ye,ht]of Object.entries(j.strokes)){const Je=Number(ht);Je>0&&(Oe[ye]=Je)}const ze={date:c,slot:$,distance:pe,duration:pt,effort:Number(j.difficulty),feeling:Number(j.fatigue_end),performance:Number(j.performance),engagement:Number(j.engagement),comments:String(j.comment||"").slice(0,400),athlete_name:t,athlete_id:s??void 0,stroke_distances:Object.keys(Oe).length>0?Oe:null},Fe=q[F];l(()=>{B(ye=>({...ye,[F]:"present"}))}),Fe?.id?Y.mutate({...ze,id:Fe.id,created_at:Fe.created_at??new Date().toISOString()}):te.mutate(ze),K(null),P(!1)},[F,t,s,j,g,q,l,Y,te,B,K,P]),bt=d.useCallback((o,c)=>{ie(N=>({...N,[o]:{...N[o],[c]:!N[o][c]}}))},[ie]);d.useEffect(()=>{if(!y)return;const o=c=>{if(c.key==="Escape"){c.preventDefault(),_();return}(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),E.length>0&&!F&&me(E[0].id))};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[y,_,E,F,me]);const gt=d.useCallback((o,c)=>{if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"," "].includes(o.key))return;if(o.preventDefault(),o.key==="Enter"||o.key===" "){const pe=Ke(I[c]);p(pe);return}let $=c;o.key==="ArrowLeft"&&($=Math.max(0,c-1)),o.key==="ArrowRight"&&($=Math.min(I.length-1,c+1)),o.key==="ArrowUp"&&($=Math.max(0,c-7)),o.key==="ArrowDown"&&($=Math.min(I.length-1,c+7)),ue($),ce(Ke(I[$])),setTimeout(()=>{const pe=document.querySelectorAll('[data-calendar-cell="true"]');pe[$]&&pe[$].focus()},0)},[I,p,ue,ce]);return J?e.jsxs("div",{className:"min-h-screen bg-muted",children:[e.jsx("div",{className:"sm:hidden fixed top-0 left-0 right-0 z-overlay border-b border-border bg-card/90 backdrop-blur",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-3 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-2xl bg-muted animate-pulse"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"h-4 w-12 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-3 w-16 rounded bg-muted animate-pulse"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"})]})]})}),e.jsx("div",{className:"mx-auto max-w-6xl px-3 sm:px-4 pt-20 pb-5 sm:py-8",children:e.jsxs("div",{className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 sm:px-5 py-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"})]}),e.jsx("div",{className:"h-6 w-32 rounded bg-muted animate-pulse"}),e.jsx("div",{className:"h-9 w-9 rounded-2xl bg-muted animate-pulse"})]}),e.jsx("div",{className:"p-3 sm:p-5",children:e.jsxs("div",{className:"grid grid-cols-7 gap-1.5 sm:gap-2",children:[Array.from({length:7}).map((o,c)=>e.jsx("div",{className:"px-0.5 pb-1 flex justify-center",children:e.jsx("div",{className:"h-3 w-4 rounded bg-muted animate-pulse"})},`wh-${c}`)),Array.from({length:35}).map((o,c)=>e.jsx("div",{className:"aspect-square rounded-2xl bg-muted/50 animate-pulse"},`cs-${c}`))]})})]})})]}):L?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(Ot,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:L.message}),e.jsx(St,{onClick:()=>R(),className:"mt-4",children:"Réessayer"})]}):e.jsxs("div",{className:"min-h-screen bg-muted",children:[e.jsx("div",{className:"sm:hidden fixed top-0 left-0 right-0 z-overlay border-b border-border bg-card/90 backdrop-blur",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-3 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-2xl bg-card border border-border flex items-center justify-center",children:e.jsx(Te,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:"Suivi"}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[re," km"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>W(!0),className:"inline-flex items-center justify-center rounded-2xl border border-border bg-background p-2 transition hover:bg-muted","aria-label":"Infos",children:e.jsx(Qe,{className:"h-5 w-5"})}),e.jsx("button",{type:"button",onClick:()=>G(!0),className:"inline-flex items-center justify-center rounded-2xl border border-border bg-background p-2 transition hover:bg-muted","aria-label":"Paramètres",children:e.jsx(Ue,{className:"h-5 w-5"})})]})]})}),e.jsxs("div",{className:"mx-auto max-w-6xl px-3 sm:px-4 pt-20 pb-5 sm:py-8",children:[e.jsxs("div",{className:"invisible sm:visible flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-2xl bg-card border border-border flex items-center justify-center",children:e.jsx(Te,{className:"h-5 w-5 text-foreground"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:"Suivi"}),e.jsxs("div",{className:"text-[11px] text-muted-foreground",children:[re," km"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>W(!0),className:"inline-flex items-center justify-center rounded-2xl border border-border bg-background p-2 transition hover:bg-muted","aria-label":"Infos",children:e.jsx(Qe,{className:"h-5 w-5"})}),e.jsx("button",{type:"button",onClick:()=>G(!0),className:"inline-flex items-center justify-center rounded-2xl border border-border bg-background p-2 transition hover:bg-muted","aria-label":"Paramètres",children:e.jsx(Ue,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"mt-4 rounded-3xl border border-border bg-card overflow-hidden",children:[e.jsx(Ut,{monthCursor:be,selectedDayStatus:he,onPrevMonth:ae,onNextMonth:H,onJumpToday:Z}),e.jsx(rs,{monthCursor:be,gridDates:I,completionByISO:ne,selectedISO:k,selectedDayIndex:U,today:fe,onDayClick:p,onKeyDown:gt})]}),e.jsx(lt,{open:A,title:"Codes",onClose:()=>W(!1),children:e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-orange-200 bg-orange-50 px-3 py-2",children:[e.jsx("span",{className:"font-semibold",children:"Orange"}),e.jsx("span",{className:"text-foreground",children:"À compléter"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-emerald-200 bg-emerald-50 px-3 py-2",children:[e.jsx("span",{className:"font-semibold",children:"Vert"}),e.jsx("span",{className:"text-foreground",children:"Validé → km"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-2xl border border-sky-200 bg-sky-50 px-3 py-2",children:[e.jsx("span",{className:"font-semibold",children:"Bleu"}),e.jsx("span",{className:"text-foreground",children:"Absent / Non prévu"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Les km comptent uniquement après validation."})]})}),e.jsx(lt,{open:S,title:"Présence",onClose:()=>G(!1),children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Toggle hebdo (séances attendues)."}),e.jsxs("div",{className:"overflow-hidden rounded-2xl border border-border bg-card",children:[e.jsxs("div",{className:"grid grid-cols-[1fr_110px_110px] bg-muted border-b border-border px-3 py-2 text-xs font-semibold text-muted-foreground",children:[e.jsx("div",{children:"Jour"}),e.jsx("div",{className:"text-center",children:"Matin"}),e.jsx("div",{className:"text-center",children:"Soir"})]}),xs.map((o,c)=>e.jsxs("div",{className:ot("grid grid-cols-[1fr_110px_110px] items-center px-3 py-2",c!==6&&"border-b border-border"),children:[e.jsx("div",{className:"text-sm font-medium text-foreground",children:o}),fs.map(N=>{const $=!!se?.[c]?.[N.key];return e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",onClick:()=>bt(c,N.key),className:ot("w-24 rounded-2xl border px-3 py-2 text-sm font-semibold transition",$?"bg-foreground text-background border-foreground":"bg-card text-foreground border-border hover:bg-muted"),"aria-label":`${o} ${N.label}`,children:$?"On":"Off"})},N.key)})]},o))]}),e.jsxs("div",{className:"rounded-2xl border border-border bg-muted px-3 py-2",children:[e.jsx("div",{className:"text-xs font-semibold text-foreground",children:"Durée (valeur par défaut)"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"h-9 w-9 rounded-2xl border border-border bg-card hover:bg-muted flex items-center justify-center",onClick:()=>ge(o=>Math.max(30,o-15)),"aria-label":"Diminuer la durée",children:e.jsx(ut,{className:"h-4 w-4"})}),e.jsxs("div",{className:"text-sm font-semibold text-foreground",children:[g," min"]}),e.jsx("button",{type:"button",className:"h-9 w-9 rounded-2xl border border-border bg-card hover:bg-muted flex items-center justify-center",onClick:()=>ge(o=>Math.min(240,o+15)),"aria-label":"Augmenter la durée",children:e.jsx(ct,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"mt-1 text-[11px] text-muted-foreground",children:"Durée envoyée au back-end (non affichée dans la maquette)."})]})]})}),e.jsx(ms,{open:y,selectedDate:le,sessionsForSelectedDay:E,selectedDayStatus:he,dayKm:de,activeSessionId:F,detailsOpen:M,draftState:j,saveState:m,isPending:X,logsBySessionId:q,onClose:_,onDayOffAll:xt,onOpenSession:me,onCloseSession:()=>{K(null),P(!1)},onToggleDetails:()=>P(o=>!o),onMarkAbsent:Ae,onMarkPresent:Ce,onClearOverride:mt,onSaveFeedback:ft,onDraftStateChange:a,getSessionStatus:f})]})]})}export{Is as default};
