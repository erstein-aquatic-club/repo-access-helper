import{u as k,m as L,a as j,j as e,ak as D,al as _,C as l,i as n,g as u,h as x,S as H,b as K,d as R,e as O,f as q,Z as V,k as p,am as z}from"./index-DqxBy9a5.js";import{C as P}from"./checkbox-b1J-JRiM.js";import{c as Q,f as r,g as Z}from"./timesheetHelpers-VLuSeS_R.js";import{f as B}from"./format-B9mPVj_w.js";const E=d=>{if(!d)return"—";const c=new Date(d);return Number.isNaN(c.getTime())?"—":B(c,"HH:mm")};function X(){const{useMemo:d,useState:c}=L,g=typeof window>"u"?k.getState().role:k(s=>s.role),h=g==="comite"||g==="admin",[f,A]=c("all"),[o,F]=c(!1),{data:I=[]}=j({queryKey:["timesheet-coaches"],queryFn:()=>p.listTimesheetCoaches(),enabled:h}),b=f==="all"?void 0:Number(f),{data:m=[],error:v}=j({queryKey:["timesheet-shifts",b??"all"],queryFn:()=>p.listTimesheetShifts({coachId:b}),enabled:h}),{data:y,error:N}=j({queryKey:["capabilities","timesheet"],queryFn:()=>p.getCapabilities(),enabled:z.hasSupabase}),i=Q(m),T=d(()=>o?m.filter(s=>s.is_travel):m,[m,o]),C=d(()=>{const s=new Map;return T.forEach(a=>{const t=a.shift_date||a.start_time.split("T")[0];s.has(t)||s.set(t,[]),s.get(t)?.push(a)}),Array.from(s.entries()).sort(([a],[t])=>a<t?1:-1)},[T]);if(!h)return typeof window>"u"?null:e.jsx(D,{to:"/"});const w=N?_(N,"Impossible de vérifier le module de pointage.").message:y?.mode==="supabase"&&!y.timesheet.available?"Pointage heures indisponible (tables manquantes côté D1).":null,S=v?_(v,"Impossible de charger les shifts.").message:null;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Comité"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Tableau de bord shifts"})]}),w?e.jsx(l,{className:"border-dashed",children:e.jsx(n,{className:"py-4 text-sm text-muted-foreground",children:w})}):null,S?e.jsx(l,{className:"border-destructive/40",children:e.jsx(n,{className:"py-4 text-sm text-destructive",children:S})}):null,e.jsxs(l,{children:[e.jsx(u,{children:e.jsx(x,{children:"Filtrer par coach"})}),e.jsx(n,{children:e.jsxs(H,{value:f,onValueChange:A,children:[e.jsx(K,{className:"w-full md:w-80",children:e.jsx(R,{placeholder:"Tous les coachs"})}),e.jsxs(O,{children:[e.jsx(q,{value:"all",children:"Tous les coachs"}),I.map(s=>e.jsx(q,{value:String(s.id),children:s.display_name},s.id))]})]})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(l,{children:[e.jsx(u,{children:e.jsx(x,{children:"Totals semaine"})}),e.jsxs(n,{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Travail: ",r(i.week.workMinutes)]}),e.jsxs("div",{children:["Trajet: ",r(i.week.travelMinutes)]}),e.jsxs("div",{className:"font-semibold text-foreground",children:["Total: ",r(i.week.totalMinutes)]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Les shifts en cours ne sont pas comptabilisés."})]})]}),e.jsxs(l,{children:[e.jsx(u,{children:e.jsx(x,{children:"Totals mois"})}),e.jsxs(n,{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Travail: ",r(i.month.workMinutes)]}),e.jsxs("div",{children:["Trajet: ",r(i.month.travelMinutes)]}),e.jsxs("div",{className:"font-semibold text-foreground",children:["Total: ",r(i.month.totalMinutes)]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Les shifts en cours ne sont pas comptabilisés."})]})]})]}),e.jsxs(l,{children:[e.jsx(u,{children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx(x,{children:"Shifts enregistrés"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(P,{id:"shift-travel-filter",checked:o,onCheckedChange:s=>F(s===!0)}),e.jsx(V,{htmlFor:"shift-travel-filter",children:"Trajet uniquement"})]})]})}),e.jsx(n,{className:"space-y-4",children:C.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:o?"Aucun trajet disponible.":"Aucun shift disponible."}):C.map(([s,a])=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:s}),e.jsx("div",{className:"space-y-2",children:a.map(t=>{const M=Z(t);return e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 rounded-lg border border-border/60 bg-muted/30 px-3 py-2 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-medium text-foreground",children:[E(t.start_time)," →"," ",t.end_time?E(t.end_time):"En cours · non comptabilisé"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.coach_name||"Coach"," · ",t.location||"Lieu non précisé"," ·"," ",t.is_travel?"Trajet":"Travail"]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:M!==null?r(M):"En cours"})]},t.id)})})]},s))})]})]})}export{X as default};
