const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StrengthCatalog-ByDAadry.js","assets/vendor-query-BiSH4r2z.js","assets/vendor-react-BzrpNAyj.js","assets/api-8BQmtHDf.js","assets/index-DsaNPytN.js","assets/vendor-supabase-6k692oZB.js","assets/index-D4lHQpdP.css","assets/index-BAwUApkf.js","assets/index-DyOdBwur.js","assets/index-Db_9MdWy.js","assets/select-DQU8_Ioh.js","assets/index-33El5C9F.js","assets/chevron-down-D9IGHmUJ.js","assets/check-BoqZBXY7.js","assets/CalendarGrid-SJU6b_Fu.js","assets/chevron-left-DJBKruix.js","assets/chevron-right-pw1Wf3Z2.js","assets/textarea-DRXiYQI1.js","assets/dialog-CJPyFbE5.js","assets/index-Bk5ZtNBD.js","assets/checkbox-CYAr4o3u.js","assets/alert-dialog-DvS_QH4G.js","assets/tabs-CuKU7mdi.js","assets/SessionListView-CVk3W7W3.js","assets/circle-alert-BfaCWj8Y.js","assets/trash-2-DC3TfBKj.js","assets/drawer-t__xmHgY.js","assets/search-BhplnGon.js","assets/plus-2XHdJgIV.js","assets/loader-circle-ZO90rxIl.js","assets/pen-DMBf5onV.js","assets/badge-CyTPcz7V.js","assets/toggle-group-DAYuN43X.js","assets/sheet-CGlVU30W.js","assets/SwimCatalog-BdVvTXYV.js","assets/SwimSessionConsultation-B0nidN5c.js","assets/timer-DhbWm2OQ.js","assets/format-B9mPVj_w.js"])))=>i.map(i=>d[i]);
import{c as Q,B as E,l as es,m as ss,n as ke,R as ts,o as ns,p as Pe,P as Me,A as Ae,q as De,r as as,t as rs,v as os,w as is,a as ls,d as ge,C as ne,h as ae,j as re,x as oe,g as ie,L as V,I as me,W as Re,D as Oe,u as be,b as cs,U as pe,y as Ne,z as ds,k as us,_ as Ie}from"./index-DsaNPytN.js";import{j as e,r as o,R as ms,d as Fe,u as Y,c as ps}from"./vendor-query-BiSH4r2z.js";import{a as I}from"./api-8BQmtHDf.js";import{B as he}from"./badge-CyTPcz7V.js";import{T as Ee,a as se}from"./toggle-group-DAYuN43X.js";import{C as hs}from"./checkbox-CYAr4o3u.js";import{h as gs,R as xs,u as fs,F as vs}from"./index-33El5C9F.js";import{u as js}from"./index-Db_9MdWy.js";import{S as q,a as B,b as G,c as K,d as D}from"./select-DQU8_Ioh.js";import{C as ys}from"./chevron-down-D9IGHmUJ.js";import{a as bs,b as Ns}from"./CalendarGrid-SJU6b_Fu.js";import{S as Cs,a as ws,b as Ss,c as _s,d as ks}from"./sheet-CGlVU30W.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Ms=Q("arrow-left",Ps);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],ce=Q("bell",As);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],Rs=Q("calendar-days",Ds);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=[["path",{d:"M16 19h6",key:"xwg31i"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M19 16v6",key:"tddt3s"}],["path",{d:"M21 12.598V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8.5",key:"1glfrc"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}]],Is=Q("calendar-plus",Os);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Es=Q("external-link",Fs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}],["path",{d:"M3.22 13H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"auskq0"}]],$s=Q("heart-pulse",Ts);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],xe=Q("mail",Ls),J=({title:s,description:n,onBack:i,actions:r})=>e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(E,{variant:"ghost",size:"sm",className:"-ml-2",onClick:i,children:[e.jsx(Ms,{className:"mr-2 h-4 w-4"}),"Retour à l'accueil"]}),e.jsx("h2",{className:"text-2xl font-display font-semibold uppercase italic text-primary",children:s}),n?e.jsx("p",{className:"text-sm text-muted-foreground",children:n}):null]}),r?e.jsx("div",{className:"flex items-center gap-2",children:r}):null]});function te(s,n,{checkForDefaultPrevented:i=!0}={}){return function(a){if(s?.(a),i===!1||!a.defaultPrevented)return n?.(a)}}function zs(s){const n=Vs(s),i=o.forwardRef((r,a)=>{const{children:l,...u}=r,d=o.Children.toArray(l),v=d.find(Bs);if(v){const y=v.props.children,x=d.map(j=>j===v?o.Children.count(y)>1?o.Children.only(null):o.isValidElement(y)?y.props.children:null:j);return e.jsx(n,{...u,ref:a,children:o.isValidElement(y)?o.cloneElement(y,void 0,x):null})}return e.jsx(n,{...u,ref:a,children:l})});return i.displayName=`${s}.Slot`,i}function Vs(s){const n=o.forwardRef((i,r)=>{const{children:a,...l}=i;if(o.isValidElement(a)){const u=Ks(a),d=Gs(l,a.props);return a.type!==o.Fragment&&(d.ref=r?es(r,u):u),o.cloneElement(a,d)}return o.Children.count(a)>1?o.Children.only(null):null});return n.displayName=`${s}.SlotClone`,n}var qs=Symbol("radix.slottable");function Bs(s){return o.isValidElement(s)&&typeof s.type=="function"&&"__radixId"in s.type&&s.type.__radixId===qs}function Gs(s,n){const i={...n};for(const r in n){const a=s[r],l=n[r];/^on[A-Z]/.test(r)?a&&l?i[r]=(...d)=>{const v=l(...d);return a(...d),v}:a&&(i[r]=a):r==="style"?i[r]={...a,...l}:r==="className"&&(i[r]=[a,l].filter(Boolean).join(" "))}return{...s,...i}}function Ks(s){let n=Object.getOwnPropertyDescriptor(s.props,"ref")?.get,i=n&&"isReactWarning"in n&&n.isReactWarning;return i?s.ref:(n=Object.getOwnPropertyDescriptor(s,"ref")?.get,i=n&&"isReactWarning"in n&&n.isReactWarning,i?s.props.ref:s.props.ref||s.ref)}var Hs=ms[" useInsertionEffect ".trim().toString()]||ss;function Us({prop:s,defaultProp:n,onChange:i=()=>{},caller:r}){const[a,l,u]=Ws({defaultProp:n,onChange:i}),d=s!==void 0,v=d?s:a;{const x=o.useRef(s!==void 0);o.useEffect(()=>{const j=x.current;j!==d&&console.warn(`${r} is changing from ${j?"controlled":"uncontrolled"} to ${d?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),x.current=d},[d,r])}const y=o.useCallback(x=>{if(d){const j=Ys(x)?x(s):x;j!==s&&u.current?.(j)}else l(x)},[d,s,l,u]);return[v,y]}function Ws({defaultProp:s,onChange:n}){const[i,r]=o.useState(s),a=o.useRef(i),l=o.useRef(n);return Hs(()=>{l.current=n},[n]),o.useEffect(()=>{a.current!==i&&(l.current?.(i),a.current=i)},[i,a]),[i,r,l]}function Ys(s){return typeof s=="function"}var de="Popover",[Te]=ns(de,[ke]),le=ke(),[Qs,H]=Te(de),$e=s=>{const{__scopePopover:n,children:i,open:r,defaultOpen:a,onOpenChange:l,modal:u=!1}=s,d=le(n),v=o.useRef(null),[y,x]=o.useState(!1),[j,b]=Us({prop:r,defaultProp:a??!1,onChange:l,caller:de});return e.jsx(ts,{...d,children:e.jsx(Qs,{scope:n,contentId:js(),triggerRef:v,open:j,onOpenChange:b,onOpenToggle:o.useCallback(()=>b(h=>!h),[b]),hasCustomAnchor:y,onCustomAnchorAdd:o.useCallback(()=>x(!0),[]),onCustomAnchorRemove:o.useCallback(()=>x(!1),[]),modal:u,children:i})})};$e.displayName=de;var Le="PopoverAnchor",Js=o.forwardRef((s,n)=>{const{__scopePopover:i,...r}=s,a=H(Le,i),l=le(i),{onCustomAnchorAdd:u,onCustomAnchorRemove:d}=a;return o.useEffect(()=>(u(),()=>d()),[u,d]),e.jsx(Ae,{...l,...r,ref:n})});Js.displayName=Le;var ze="PopoverTrigger",Ve=o.forwardRef((s,n)=>{const{__scopePopover:i,...r}=s,a=H(ze,i),l=le(i),u=Pe(n,a.triggerRef),d=e.jsx(Me.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":He(a.open),...r,ref:u,onClick:te(s.onClick,a.onOpenToggle)});return a.hasCustomAnchor?d:e.jsx(Ae,{asChild:!0,...l,children:d})});Ve.displayName=ze;var fe="PopoverPortal",[Zs,Xs]=Te(fe,{forceMount:void 0}),qe=s=>{const{__scopePopover:n,forceMount:i,children:r,container:a}=s,l=H(fe,n);return e.jsx(Zs,{scope:n,forceMount:i,children:e.jsx(De,{present:i||l.open,children:e.jsx(as,{asChild:!0,container:a,children:r})})})};qe.displayName=fe;var Z="PopoverContent",Be=o.forwardRef((s,n)=>{const i=Xs(Z,s.__scopePopover),{forceMount:r=i.forceMount,...a}=s,l=H(Z,s.__scopePopover);return e.jsx(De,{present:r||l.open,children:l.modal?e.jsx(st,{...a,ref:n}):e.jsx(tt,{...a,ref:n})})});Be.displayName=Z;var et=zs("PopoverContent.RemoveScroll"),st=o.forwardRef((s,n)=>{const i=H(Z,s.__scopePopover),r=o.useRef(null),a=Pe(n,r),l=o.useRef(!1);return o.useEffect(()=>{const u=r.current;if(u)return gs(u)},[]),e.jsx(xs,{as:et,allowPinchZoom:!0,children:e.jsx(Ge,{...s,ref:a,trapFocus:i.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:te(s.onCloseAutoFocus,u=>{u.preventDefault(),l.current||i.triggerRef.current?.focus()}),onPointerDownOutside:te(s.onPointerDownOutside,u=>{const d=u.detail.originalEvent,v=d.button===0&&d.ctrlKey===!0,y=d.button===2||v;l.current=y},{checkForDefaultPrevented:!1}),onFocusOutside:te(s.onFocusOutside,u=>u.preventDefault(),{checkForDefaultPrevented:!1})})})}),tt=o.forwardRef((s,n)=>{const i=H(Z,s.__scopePopover),r=o.useRef(!1),a=o.useRef(!1);return e.jsx(Ge,{...s,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:l=>{s.onCloseAutoFocus?.(l),l.defaultPrevented||(r.current||i.triggerRef.current?.focus(),l.preventDefault()),r.current=!1,a.current=!1},onInteractOutside:l=>{s.onInteractOutside?.(l),l.defaultPrevented||(r.current=!0,l.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const u=l.target;i.triggerRef.current?.contains(u)&&l.preventDefault(),l.detail.originalEvent.type==="focusin"&&a.current&&l.preventDefault()}})}),Ge=o.forwardRef((s,n)=>{const{__scopePopover:i,trapFocus:r,onOpenAutoFocus:a,onCloseAutoFocus:l,disableOutsidePointerEvents:u,onEscapeKeyDown:d,onPointerDownOutside:v,onFocusOutside:y,onInteractOutside:x,...j}=s,b=H(Z,i),h=le(i);return fs(),e.jsx(vs,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:a,onUnmountAutoFocus:l,children:e.jsx(rs,{asChild:!0,disableOutsidePointerEvents:u,onInteractOutside:x,onEscapeKeyDown:d,onPointerDownOutside:v,onFocusOutside:y,onDismiss:()=>b.onOpenChange(!1),children:e.jsx(os,{"data-state":He(b.open),role:"dialog",id:b.contentId,...h,...j,ref:n,style:{...j.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Ke="PopoverClose",nt=o.forwardRef((s,n)=>{const{__scopePopover:i,...r}=s,a=H(Ke,i);return e.jsx(Me.button,{type:"button",...r,ref:n,onClick:te(s.onClick,()=>a.onOpenChange(!1))})});nt.displayName=Ke;var at="PopoverArrow",rt=o.forwardRef((s,n)=>{const{__scopePopover:i,...r}=s,a=le(i);return e.jsx(is,{...a,...r,ref:n})});rt.displayName=at;function He(s){return s?"open":"closed"}var ot=$e,it=Ve,lt=qe,Ue=Be;const ct=ot,dt=it,We=o.forwardRef(({className:s,align:n="center",sideOffset:i=4,...r},a)=>e.jsx(lt,{children:e.jsx(Ue,{ref:a,align:n,sideOffset:i,className:ls("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",s),...r})}));We.displayName=Ue.displayName;const ut=({onBack:s,swimSessions:n,strengthSessions:i,athletes:r,groups:a})=>{const{toast:l}=ge(),[u,d]=o.useState({session_type:"swim",session_id:"",assigned_date:new Date().toISOString().split("T")[0],assigned_slot:"morning"}),[v,y]=o.useState(!1),[x,j]=o.useState("user"),[b,h]=o.useState(""),[c,C]=o.useState([]),O=t=>{const g=typeof t=="number"?t:Number(t);return Number.isFinite(g)&&g>0?g:null},k=o.useMemo(()=>r.map(t=>({value:t.id?`id:${t.id}`:`name:${t.display_name}`,label:t.group_label?`${t.display_name} · ${t.group_label}`:t.display_name,id:t.id,name:t.display_name})),[r]),S=o.useMemo(()=>new Map(k.map(t=>[t.value,t])),[k]),T=o.useMemo(()=>a.map(t=>{const g=O(t.id);return g?{...t,gid:g}:null}).filter(t=>!!t),[a]),M=o.useMemo(()=>T.filter(t=>c.includes(t.gid)),[T,c]),U=o.useMemo(()=>{if(M.length===0)return"Choisir des groupes";const t=M.slice(0,2).map(p=>p.name).join(", "),g=M.length>2?` +${M.length-2}`:"";return`${t}${g}`},[M]),$=Fe({mutationFn:async t=>I.assignments_create(t),onSuccess:()=>{l({title:"Séance assignée & notifiée"})},onError:t=>{const g="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",p=t instanceof Error?t.message:typeof t=="string"?t:g;let w=p;const N=p.match(/HTTP \d+:\s*(\{.*\})/);if(N)try{w=JSON.parse(N[1])?.error||g}catch{w=g}l({title:"Erreur d'assignation",description:w})}}),W=async()=>{const t=Number(u.session_id);if(!Number.isInteger(t)||t<=0){l({title:"Séance invalide",description:"Sélectionnez une séance valide."});return}if(x==="group"){if(c.length===0){l({title:"Groupe manquant",description:"Sélectionnez au moins un groupe."});return}y(!0);try{const m={assignment_type:u.session_type,session_id:t,scheduled_date:u.assigned_date,scheduled_slot:u.assigned_slot},P=Array.from(new Set(c));await Promise.all(P.map(f=>I.assignments_create({...m,target_group_id:f}))),l({title:"Séance assignée & notifiée"})}catch(m){const P="Impossible d'assigner la séance. Vérifiez les champs et réessayez.",f=m instanceof Error?m.message:typeof m=="string"?m:P;let A=f;const R=f.match(/HTTP \d+:\s*(\{.*\})/);if(R)try{A=JSON.parse(R[1])?.error||P}catch{A=P}l({title:"Erreur d'assignation",description:A})}finally{y(!1)}return}const g=b.trim();if(!g){l({title:"Nageur manquant",description:"Sélectionnez un nageur."});return}const p=S.get(g),w=p?.id??(Number.isFinite(Number(g))&&Number(g)>0?Number(g):void 0);if(!Number.isFinite(w)||Number(w)<=0){l({title:"Nageur invalide",description:"Sélectionnez un nageur avec un identifiant valide."});return}const N=p?.name??g.replace(/^name:/,"");$.mutate({assignment_type:u.session_type,session_id:t,target_athlete:N,target_user_id:w,scheduled_date:u.assigned_date,scheduled_slot:u.assigned_slot})},L=!u.session_id||(x==="group"?c.length===0:!b.trim())||$.isPending||v;return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(J,{title:"Assigner une séance",description:"Planifiez une séance pour un nageur ou un ou plusieurs groupes.",onBack:s}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(ne,{className:"border-l-4 border-l-primary",children:[e.jsxs(ae,{children:[e.jsx(re,{children:"Séance"}),e.jsx(oe,{children:"Choisissez le type et la séance à envoyer."})]}),e.jsxs(ie,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Type"}),e.jsxs(q,{value:u.session_type,onValueChange:t=>d({...u,session_type:t,session_id:""}),children:[e.jsx(B,{children:e.jsx(G,{})}),e.jsxs(K,{children:[e.jsx(D,{value:"swim",children:"Natation"}),e.jsx(D,{value:"strength",children:"Musculation"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Séance"}),e.jsxs(q,{value:u.session_id,onValueChange:t=>d({...u,session_id:t}),children:[e.jsx(B,{children:e.jsx(G,{placeholder:"Choisir..."})}),e.jsx(K,{children:u.session_type==="swim"?n?.map(t=>e.jsx(D,{value:t.id.toString(),children:t.name},t.id)):i?.map(t=>e.jsx(D,{value:t.id.toString(),children:t.title},t.id))})]})]})]})]}),e.jsxs(ne,{children:[e.jsxs(ae,{children:[e.jsx(re,{children:"Cible & planification"}),e.jsx(oe,{children:"Définissez le destinataire, la date et le créneau."})]}),e.jsxs(ie,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Cible"}),e.jsxs(q,{value:x,onValueChange:t=>{j(t),h(""),C([])},children:[e.jsx(B,{children:e.jsx(G,{})}),e.jsxs(K,{children:[e.jsx(D,{value:"user",children:"Nageur"}),e.jsx(D,{value:"group",children:"Groupe(s)"})]})]})]}),x==="user"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Nageur"}),k.length>0?e.jsxs(q,{value:b,onValueChange:h,children:[e.jsx(B,{children:e.jsx(G,{placeholder:"Choisir un nageur"})}),e.jsx(K,{children:k.map(t=>e.jsx(D,{value:t.value,children:t.label},t.value))})]}):e.jsx(me,{value:b,onChange:t=>h(t.target.value),placeholder:"ex: Camille"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Groupes"}),a.length>0?e.jsxs(ct,{children:[e.jsx(dt,{asChild:!0,children:e.jsxs(E,{type:"button",variant:"outline",className:"w-full justify-between","aria-label":"Sélection des groupes",children:[e.jsx("span",{className:"truncate",children:U}),e.jsx(ys,{className:"ml-2 h-4 w-4 opacity-50"})]})}),e.jsxs(We,{className:"w-[--radix-popover-trigger-width] p-2",align:"start",children:[e.jsx("div",{className:"max-h-64 overflow-auto",children:e.jsx("div",{className:"space-y-1",children:T.map(t=>{const g=c.includes(t.gid);return e.jsxs("label",{className:"flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 hover:bg-muted",children:[e.jsx(hs,{checked:g,onCheckedChange:p=>{const w=p===!0;C(N=>w?N.includes(t.gid)?N:[...N,t.gid]:N.filter(m=>m!==t.gid))}}),e.jsx("span",{className:"text-sm",children:t.name})]},t.gid)})})}),c.length>0?e.jsx(E,{type:"button",variant:"ghost",size:"sm",className:"mt-2 w-full",onClick:()=>C([]),children:"Tout désélectionner"}):null]})]}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"Aucun groupe disponible."}),c.length>0?e.jsxs("div",{className:"text-xs text-muted-foreground",children:[c.length," groupe",c.length>1?"s":""," sélectionné",c.length>1?"s":"","."]}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Date"}),e.jsx(me,{type:"date",value:u.assigned_date,onChange:t=>d({...u,assigned_date:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Créneau"}),e.jsxs(q,{value:u.assigned_slot,onValueChange:t=>d({...u,assigned_slot:t}),children:[e.jsx(B,{children:e.jsx(G,{placeholder:"Choisir..."})}),e.jsxs(K,{children:[e.jsx(D,{value:"morning",children:"Matin"}),e.jsx(D,{value:"evening",children:"Soir"})]})]})]})]})]})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(E,{className:"w-full sm:w-auto",onClick:W,disabled:L,children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),$.isPending||v?"Assignation...":"Assigner & notifier"]})})]})},mt=({onBack:s,athletes:n,groups:i,athletesLoading:r})=>{const{toast:a}=ge(),[l,u]=o.useState(""),[d,v]=o.useState(""),y=o.useMemo(()=>n.filter(c=>c.id&&c.email).map(c=>({value:`user:${c.id}`,label:c.group_label?`${c.display_name} · ${c.group_label}`:c.display_name,email:c.email})),[n]),x=o.useMemo(()=>i.map(c=>({value:`group:${c.id}`,label:c.name,id:c.id})),[i]),j=()=>{if(!d)return[];if(d.startsWith("user:")){const c=y.find(C=>C.value===d);return c?[c.email]:[]}if(d.startsWith("group:")){const c=Number(d.split(":")[1]);return n.filter(C=>C.group_id===c&&C.email).map(C=>C.email)}return[]},b=()=>{const c=j();if(!c.length){a({title:"Aucune adresse email",description:"Aucun nageur avec une adresse email dans cette sélection."});return}const C=new URLSearchParams;C.set("bcc",c.join(",")),l.trim()&&C.set("subject",l.trim()),window.location.href=`mailto:?${C.toString()}`},h=j();return e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx(J,{title:"Contacter par email",description:"Ouvre votre application mail avec les destinataires en CCI.",onBack:s}),e.jsxs(ne,{className:"border-l-4 border-l-primary",children:[e.jsxs(ae,{children:[e.jsx(re,{children:"Destinataire"}),e.jsx(oe,{children:"Sélectionnez un nageur ou un groupe."})]}),e.jsxs(ie,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Destinataire"}),e.jsxs(q,{value:d,onValueChange:v,children:[e.jsx(B,{children:e.jsx(G,{placeholder:r?"Chargement...":"Choisir un nageur ou un groupe"})}),e.jsxs(K,{children:[x.length?e.jsxs(e.Fragment,{children:[e.jsx(D,{value:"section-group",disabled:!0,children:"Groupes"}),x.map(c=>e.jsx(D,{value:c.value,children:c.label},c.value))]}):null,y.length?e.jsxs(e.Fragment,{children:[e.jsx(D,{value:"section-athlete",disabled:!0,children:"Nageurs"}),y.map(c=>e.jsx(D,{value:c.value,children:c.label},c.value))]}):null]})]})]}),d&&h.length>0?e.jsxs("p",{className:"text-xs text-muted-foreground",children:[h.length," adresse",h.length>1?"s":""," email",h.length>1?" (envoi en CCI)":""]}):null,d&&h.length===0?e.jsx("p",{className:"text-xs text-destructive",children:"Aucune adresse email disponible pour cette sélection."}):null]})]}),e.jsxs(ne,{children:[e.jsxs(ae,{children:[e.jsx(re,{children:"Objet"}),e.jsx(oe,{children:"Optionnel — pré-rempli dans votre application mail."})]}),e.jsx(ie,{children:e.jsx(me,{value:l,onChange:c=>u(c.target.value),placeholder:"Objet du mail…"})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 -mx-4 border-t bg-background/95 p-4 backdrop-blur sm:static sm:mx-0 sm:border-0 sm:p-0",children:e.jsxs(E,{className:"w-full sm:w-auto",onClick:b,disabled:!d||h.length===0,children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Ouvrir dans l'app mail",e.jsx(Es,{className:"ml-2 h-3 w-3"})]})})]})};function Ce(s){return String(s).padStart(2,"0")}function ee(s){return`${s.getFullYear()}-${Ce(s.getMonth()+1)}-${Ce(s.getDate())}`}function ue(s){return new Date(s.getFullYear(),s.getMonth(),1)}function we(s,n){const i=new Date(s);return i.setDate(i.getDate()+n),i}function pt(s){return(s.getDay()+6)%7}function Se(s){if(!s)return"AM";const n=s.toLowerCase();return n==="evening"||n.includes("soir")||n==="pm"?"PM":"AM"}function ht({groupId:s,userId:n,enabled:i}){const r=o.useMemo(()=>new Date,[]),[a,l]=o.useState(()=>ue(new Date)),[u,d]=o.useState(()=>ee(new Date)),[v,y]=o.useState(null),[x,j]=o.useState(!1),b=o.useMemo(()=>ue(a),[a]),h=o.useMemo(()=>{const p=pt(b),w=we(b,-p),N=[];for(let m=0;m<42;m++)N.push(we(w,m));return N},[b]),c=o.useMemo(()=>{const p=ee(h[0]),w=ee(h[h.length-1]);return{from:p,to:w}},[h]),C=!!(s||n),{data:O=[],isLoading:k}=Y({queryKey:["coach-calendar-assignments",s,n,c.from,c.to],queryFn:()=>I.getCoachAssignments({groupId:s??null,userId:n??null,from:c.from,to:c.to}),enabled:C}),S=o.useMemo(()=>{const p=new Map;for(const w of O){const N=w.scheduledDate?.slice(0,10);N&&(p.has(N)||p.set(N,[]),p.get(N).push(w))}return p},[O]),T=o.useMemo(()=>{const p={};for(const w of h){const N=ee(w),m=S.get(N)??[],P=m.some(F=>Se(F.scheduledSlot)==="AM"),f=m.some(F=>Se(F.scheduledSlot)==="PM"),A=(P?1:0)+(f?1:0),R=[{slotKey:"AM",expected:P,completed:P,absent:!1},{slotKey:"PM",expected:f,completed:f,absent:!1}];p[N]={completed:A,total:A,slots:R}}return p},[h,S]),M=o.useMemo(()=>{const[p,w,N]=u.split("-").map(Number);return new Date(p,w-1,N)},[u]),U=o.useMemo(()=>S.get(u)??[],[S,u]),$=T[u]??{completed:0,total:0,slots:[{slotKey:"AM",expected:!1,completed:!1,absent:!1},{slotKey:"PM",expected:!1,completed:!1,absent:!1}]},W=o.useCallback(()=>{l(p=>new Date(p.getFullYear(),p.getMonth()-1,1))},[]),L=o.useCallback(()=>{l(p=>new Date(p.getFullYear(),p.getMonth()+1,1))},[]),t=o.useCallback(()=>{l(ue(new Date)),d(ee(new Date))},[]),g=o.useCallback(p=>{d(p),j(!0)},[]);return{today:r,monthCursor:a,selectedISO:u,selectedDayIndex:v,drawerOpen:x,gridDates:h,completionByISO:T,selectedDate:M,selectedDayStatus:$,assignmentsForSelectedDay:U,isLoading:k,hasFilter:C,setSelectedISO:d,setSelectedDayIndex:y,setDrawerOpen:j,prevMonth:W,nextMonth:L,jumpToday:t,openDay:g}}function gt(s){if(!s)return"—";const n=s.toLowerCase();return n==="morning"||n.includes("mat")||n==="am"?"Matin":n==="evening"||n.includes("soir")||n==="pm"?"Soir":s}function xt(s){switch(s){case"assigned":return"Assigné";case"in_progress":return"En cours";case"completed":return"Terminé";default:return s}}function ft(s){switch(s){case"completed":return"default";case"in_progress":return"secondary";default:return"outline"}}function vt(s){const[n,i,r]=s.split("-").map(Number);return new Date(n,i-1,r).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})}function jt({onBack:s,onAssign:n,athletes:i,groups:r}){const[a,l]=o.useState("group"),[u,d]=o.useState(""),[v,y]=o.useState(""),x=a==="group"&&u?Number(u):null,j=a==="user"&&v?Number(v):null,{today:b,monthCursor:h,selectedISO:c,selectedDayIndex:C,drawerOpen:O,gridDates:k,completionByISO:S,selectedDayStatus:T,assignmentsForSelectedDay:M,hasFilter:U,setSelectedISO:$,setSelectedDayIndex:W,setDrawerOpen:L,prevMonth:t,nextMonth:g,jumpToday:p,openDay:w}=ht({groupId:x,userId:j,enabled:!0}),N=(m,P)=>{let f=P;if(m.key==="ArrowLeft"&&(f=Math.max(0,P-1)),m.key==="ArrowRight"&&(f=Math.min(k.length-1,P+1)),m.key==="ArrowUp"&&(f=Math.max(0,P-7)),m.key==="ArrowDown"&&(f=Math.min(k.length-1,P+7)),f!==P){m.preventDefault(),W(f);const A=X=>String(X).padStart(2,"0"),R=k[f],F=`${R.getFullYear()}-${A(R.getMonth()+1)}-${A(R.getDate())}`;$(F)}if(m.key==="Enter"||m.key===" "){m.preventDefault();const A=X=>String(X).padStart(2,"0"),R=k[P],F=`${R.getFullYear()}-${A(R.getMonth()+1)}-${A(R.getDate())}`;w(F)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(J,{title:"Calendrier",description:"Vue mensuelle des assignations",onBack:s}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs(Ee,{type:"single",value:a,onValueChange:m=>{(m==="group"||m==="user")&&l(m)},className:"shrink-0",children:[e.jsx(se,{value:"group",className:"text-xs px-3",children:"Groupe"}),e.jsx(se,{value:"user",className:"text-xs px-3",children:"Nageur"})]}),a==="group"?e.jsxs(q,{value:u,onValueChange:d,children:[e.jsx(B,{className:"w-full sm:w-56",children:e.jsx(G,{placeholder:"Choisir un groupe"})}),e.jsx(K,{children:r.map(m=>e.jsx(D,{value:String(m.id),children:m.name},String(m.id)))})]}):e.jsxs(q,{value:v,onValueChange:y,children:[e.jsx(B,{className:"w-full sm:w-56",children:e.jsx(G,{placeholder:"Choisir un nageur"})}),e.jsx(K,{children:i.filter(m=>m.id!=null).map(m=>e.jsxs(D,{value:String(m.id),children:[m.display_name,m.group_label?` · ${m.group_label}`:""]},String(m.id)))})]})]}),U?e.jsxs("div",{className:"rounded-2xl border bg-card shadow-sm",children:[e.jsx(bs,{monthCursor:h,selectedDayStatus:T,onPrevMonth:t,onNextMonth:g,onJumpToday:p}),e.jsx(Ns,{monthCursor:h,gridDates:k,completionByISO:S,selectedISO:c,selectedDayIndex:C,today:b,onDayClick:w,onKeyDown:N})]}):e.jsx("div",{className:"py-12 text-center text-sm text-muted-foreground",children:"S\\u00e9lectionnez un groupe ou un nageur pour afficher le calendrier."}),e.jsx(Cs,{open:O,onOpenChange:L,children:e.jsxs(ws,{side:"bottom",className:"max-h-[70vh] overflow-y-auto rounded-t-2xl",children:[e.jsxs(Ss,{className:"pb-3",children:[e.jsxs(_s,{className:"capitalize text-left",children:[vt(c),M.length>0&&e.jsxs("span",{className:"ml-2 text-sm font-normal text-muted-foreground",children:["(",M.length," assignation",M.length!==1?"s":"",")"]})]}),e.jsx(ks,{className:"sr-only",children:"D\\u00e9tail des assignations pour cette journ\\u00e9e"})]}),M.length===0?e.jsx("p",{className:"py-6 text-center text-sm text-muted-foreground",children:"Aucune assignation ce jour."}):e.jsx("div",{className:"space-y-2",children:M.map(m=>e.jsx(yt,{assignment:m},m.id))}),e.jsx("div",{className:"pt-4",children:e.jsxs(E,{className:"w-full",onClick:()=>n(c),children:[e.jsx(Is,{className:"mr-2 h-4 w-4"}),"Assigner une s\\u00e9ance"]})})]})})]})}function yt({assignment:s}){const n=s.type==="swim";return e.jsxs("div",{className:"flex items-start gap-3 rounded-xl border p-3",children:[e.jsx("div",{className:"mt-0.5",children:n?e.jsx(Re,{className:"h-4 w-4 text-blue-500"}):e.jsx(Oe,{className:"h-4 w-4 text-orange-500"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:s.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 mt-1",children:[e.jsx(he,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:n?"Nage":"Muscu"}),e.jsx("span",{className:"text-[11px] text-muted-foreground",children:gt(s.scheduledSlot)}),e.jsx(he,{variant:ft(s.status),className:"text-[10px] px-1.5 py-0",children:xt(s.status)})]})]})]})}const bt=o.lazy(()=>Ie(()=>import("./StrengthCatalog-ByDAadry.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33]))),Nt=o.lazy(()=>Ie(()=>import("./SwimCatalog-BdVvTXYV.js"),__vite__mapDeps([34,1,2,3,4,5,6,18,19,9,11,21,16,35,31,36,23,12,15,17,24,25,10,8,13,28,37,27]))),Ct=({onNavigate:s,onOpenRecordsAdmin:n,onOpenRecordsClub:i,athletes:r,athletesLoading:a,upcomingBirthdays:l,birthdaysLoading:u,kpiLoading:d,kpiPeriod:v,onKpiPeriodChange:y,fatigueAlerts:x,mostLoadedAthlete:j,swimSessionCount:b,strengthSessionCount:h})=>{const c=new Date().getHours(),C=c<12?"Bonjour":c<18?"Bon après-midi":"Bonsoir",O=new Date().toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"}),k=x.length>0;return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold uppercase italic",children:[C,", ",e.jsx("span",{className:"text-primary",children:"Coach"})]}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:O})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:["Signaux · ",v,"j"]}),e.jsxs(Ee,{type:"single",size:"sm",variant:"outline",value:String(v),onValueChange:S=>{S&&y(Number(S))},children:[e.jsx(se,{value:"7",className:"h-7 px-2 text-xs","aria-label":"7 jours",children:"7j"}),e.jsx(se,{value:"30",className:"h-7 px-2 text-xs","aria-label":"30 jours",children:"30j"}),e.jsx(se,{value:"365",className:"h-7 px-2 text-xs","aria-label":"1 an",children:"1an"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:`rounded-xl border p-3 ${k?"border-destructive/30 bg-destructive/5":"bg-muted/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Fatigue 5/5"}),e.jsx($s,{className:`h-3.5 w-3.5 ${k?"text-destructive":"text-muted-foreground"}`})]}),e.jsx("p",{className:"text-xl font-bold tabular-nums",children:d?"–":x.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground truncate",children:d?"Chargement…":k?x.slice(0,2).map(S=>S.athleteName.split(" ")[0]).join(", "):"Aucune alerte"})]}),e.jsxs("div",{className:"rounded-xl border bg-muted/30 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:"Plus chargé"}),e.jsx(pe,{className:"h-3.5 w-3.5 text-muted-foreground"})]}),e.jsx("p",{className:"text-xl font-bold truncate",children:d?"–":j?.athleteName?.split(" ")[0]??"–"}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:d?"Calcul…":j?`Charge ${Math.round(j.loadScore)}`:"Pas de données"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>s("assignments"),className:"flex items-center gap-1.5 rounded-full bg-primary text-primary-foreground px-4 py-2 text-sm font-semibold active:opacity-80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(ce,{className:"h-3.5 w-3.5"}),"Assigner"]}),e.jsxs("button",{type:"button",onClick:()=>s("messaging"),className:"flex items-center gap-1.5 rounded-full border px-4 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(xe,{className:"h-3.5 w-3.5"}),"Email"]}),e.jsxs("button",{type:"button",onClick:()=>s("calendar"),className:"flex items-center gap-1.5 rounded-full border px-4 py-2 text-sm font-semibold active:bg-muted focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:[e.jsx(Rs,{className:"h-3.5 w-3.5"}),"Calendrier"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>s("swim"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Re,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Natation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:b!=null?`${b} séance${b!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>s("strength"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(Oe,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Musculation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:h!=null?`${h} séance${h!==1?"s":""}`:"Bibliothèque"})]}),e.jsxs("button",{type:"button",onClick:()=>s("swimmers"),className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(pe,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Nageurs"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a?"Chargement…":`${r.length} nageur${r.length!==1?"s":""}`})]}),e.jsxs("button",{type:"button",onClick:n,className:"rounded-xl border bg-card p-4 text-left shadow-sm active:bg-muted/50 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",children:[e.jsx(us,{className:"h-5 w-5 text-primary mb-2"}),e.jsx("p",{className:"text-sm font-bold",children:"Records club"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Import & administration"})]})]}),e.jsx("button",{type:"button",onClick:i,className:"w-full text-center text-sm text-primary font-semibold py-1 active:opacity-70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring rounded",children:"Voir les records du club"}),!u&&l&&l.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xs font-semibold uppercase tracking-[0.15em] text-muted-foreground",children:"Anniversaires"}),e.jsx("div",{className:"space-y-1.5",children:l.slice(0,3).map(S=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:S.display_name}),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:wt(S.next_birthday)})]}),e.jsxs("span",{className:"text-xs font-bold text-primary",children:["J-",S.days_until]})]},S.id))})]}):null]})},wt=s=>{if(!s)return"-";const n=new Date(s);return Number.isNaN(n.getTime())?s:n.toLocaleDateString("fr-FR")},_e=s=>s.toISOString().split("T")[0],St=s=>new Date(s.completed_at||s.started_at||s.date||s.created_at||0).getTime(),_t=s=>{if(!s.length)return null;const n=s.reduce((r,a)=>r+a,0)/s.length,i=Math.min(5,Math.max(1,Math.round(n/10*5)));return{average:n,rating:i}};function kt(){const s=be(t=>t.role),n=be(t=>t.setSelectedAthlete),[,i]=cs(),[r,a]=o.useState("home"),[l,u]=o.useState(7),d=s==="coach"||s==="admin",v=r==="home"||r==="assignments",y=r==="home"||r==="assignments"||r==="messaging"||r==="swimmers"||r==="calendar",x=r==="assignments"||r==="messaging"||r==="calendar",j=r==="home"||r==="swimmers",{data:b}=Y({queryKey:["swim_catalog"],queryFn:()=>I.getSwimCatalog(),enabled:d&&v}),{data:h}=Y({queryKey:["strength_catalog"],queryFn:()=>I.getStrengthSessions(),enabled:d&&v}),{data:c=[],isLoading:C}=Y({queryKey:["athletes"],queryFn:()=>I.getAthletes(),enabled:d&&y}),O=o.useMemo(()=>c.slice(0,5),[c]),{data:k=[]}=Y({queryKey:["groups"],queryFn:()=>I.getGroups(),enabled:d&&x}),S=Y({queryKey:["upcoming-birthdays"],queryFn:()=>I.getUpcomingBirthdays({days:30}),enabled:d&&j}),T=S.data,M=Y({queryKey:["coach-kpis",l,O.map(t=>t.id??t.display_name)],enabled:d&&r==="home"&&O.length>0,queryFn:async()=>{const t=l,g=new Date;g.setDate(g.getDate()-t);const p=_e(g),w=_e(new Date),N=await Promise.all(O.map(async f=>{const[A,R]=await Promise.all([I.getSessions(f.display_name,f.id),I.getStrengthHistory(f.display_name,{athleteId:f.id,limit:50,from:p,to:w})]),F=A.filter(_=>new Date(_.date).getTime()>=g.getTime()),X=F.map(_=>_.fatigue??_.feeling).filter(_=>Number.isFinite(_)),Ye=F.reduce((_,z)=>_+(Number(z.duration)||0)*(Number(z.effort)||0),0),ve=(R?.runs??[]).filter(_=>St(_)>=g.getTime()),Qe=ve.map(_=>_.fatigue??_.feeling??_.rpe).filter(_=>Number.isFinite(Number(_))).map(_=>Number(_)),Je=ve.reduce((_,z)=>{const je=Number(z.feeling??z.rpe??0),ye=Number(z.duration??0);if(ye>0&&je>0)return _+ye*je;const Xe=Array.isArray(z.logs)?z.logs.length:0;return _+Xe*5},0),Ze=_t([...X,...Qe]);return{athleteName:f.display_name,loadScore:Ye+Je,fatigueRating:Ze}})),m=N.filter(f=>f.fatigueRating?.rating===5).map(f=>({athleteName:f.athleteName,rating:f.fatigueRating?.rating??0})),P=N.filter(f=>f.loadScore>0).sort((f,A)=>A.loadScore-f.loadScore)[0];return{fatigueAlerts:m,mostLoadedAthlete:P??null}}}),U=t=>{n({id:t.id??null,name:t.display_name}),i("/progress")},{toast:$}=ge(),W=ps(),L=Fe({mutationFn:async t=>{const g=await I.importSingleSwimmer(t.iuf,t.name);return await I.recalculateClubRecords(),g},onSuccess:t=>{$({title:"Import terminé",description:`${t.total_found} trouvées, ${t.new_imported} nouvelles.`}),W.invalidateQueries({queryKey:["club-records"]})},onError:t=>{$({title:"Erreur import",description:t.message,variant:"destructive"})}});return d?e.jsxs("div",{className:"space-y-6",children:[r==="home"?e.jsx(Ct,{onNavigate:a,onOpenRecordsAdmin:()=>i("/records-admin"),onOpenRecordsClub:()=>i("/records-club"),athletes:c,athletesLoading:C,upcomingBirthdays:T,birthdaysLoading:S.isLoading,kpiLoading:M.isLoading,kpiPeriod:l,onKpiPeriodChange:u,fatigueAlerts:M.data?.fatigueAlerts??[],mostLoadedAthlete:M.data?.mostLoadedAthlete??null,swimSessionCount:b?.length,strengthSessionCount:h?.length}):null,r==="assignments"?e.jsx(ut,{onBack:()=>a("home"),swimSessions:b,strengthSessions:h,athletes:c,groups:k}):null,r==="swim"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{title:"Bibliothèque natation",description:"Accédez aux séances et aux templates natation.",onBack:()=>a("home"),actions:e.jsxs(E,{variant:"outline",onClick:()=>a("assignments"),children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(o.Suspense,{fallback:e.jsx(Ne,{}),children:e.jsx(Nt,{})})]}):null,r==="strength"?e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{title:"Bibliothèque musculation",description:"Consultez et créez des séances musculation.",onBack:()=>a("home"),actions:e.jsxs(E,{variant:"outline",onClick:()=>a("assignments"),children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Nouvelle assignation"]})}),e.jsx(o.Suspense,{fallback:e.jsx(Ne,{}),children:e.jsx(bt,{})})]}):null,r==="swimmers"?e.jsxs("div",{className:"space-y-4",children:[e.jsx(J,{title:"Nageurs",description:C?"Chargement…":`${c.length} nageur${c.length!==1?"s":""} inscrit${c.length!==1?"s":""}`,onBack:()=>a("home"),actions:e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>a("messaging"),children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Email"]})}),C?e.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(t=>e.jsx("div",{className:"rounded-xl border p-3 animate-pulse motion-reduce:animate-none",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-4 w-32 rounded bg-muted"}),e.jsx("div",{className:"ml-auto h-8 w-16 rounded bg-muted"})]})},t))}):c.length?e.jsx("div",{className:"space-y-2",children:c.map(t=>e.jsxs("div",{className:"flex items-center gap-3 rounded-xl border bg-card p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-semibold truncate",children:t.display_name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[t.group_label?e.jsx(he,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:t.group_label}):null,t.ffn_iuf?e.jsx("span",{className:"text-[10px] font-mono text-muted-foreground",children:t.ffn_iuf}):null]})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[t.ffn_iuf?e.jsx(E,{size:"icon",variant:"ghost",className:"h-8 w-8",disabled:L.isPending,onClick:()=>L.mutate({iuf:t.ffn_iuf,name:t.display_name}),title:"Importer performances FFN",children:e.jsx(ds,{className:"h-4 w-4"})}):null,e.jsx(E,{size:"sm",variant:"outline",onClick:()=>U(t),children:"Fiche"})]})]},t.id??t.display_name))}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Aucun nageur disponible."})]}):null,r==="messaging"?e.jsx(mt,{onBack:()=>a("home"),athletes:c,groups:k,athletesLoading:C}):null,r==="calendar"?e.jsx(jt,{onBack:()=>a("home"),onAssign:t=>{a("assignments")},athletes:c,groups:k}):null]}):e.jsx("div",{className:"flex items-center justify-center min-h-[60vh] animate-in fade-in motion-reduce:animate-none",children:e.jsxs(ne,{className:"w-full max-w-sm shadow-xl border-t-4 border-t-primary",children:[e.jsxs(ae,{children:[e.jsxs(re,{className:"flex items-center gap-2 uppercase italic",children:[e.jsx(pe,{className:"h-5 w-5 text-primary"}),"Accès Coach"]}),e.jsx(oe,{children:"Cette section est réservée aux coachs et administrateurs."})]}),e.jsx(ie,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connectez-vous avec un compte autorisé pour accéder aux outils de gestion."})})]})})}const Vt=Object.freeze(Object.defineProperty({__proto__:null,default:kt},Symbol.toStringTag,{value:"Module"}));export{Vt as C,ct as P,dt as a,We as b};
