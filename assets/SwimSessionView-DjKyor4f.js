import{r as m,j as e,c as R,u as I,d as L}from"./vendor-query-BiSH4r2z.js";import{Q as O,a as P,u as B,b as M,d as q,B as x,C as z,g as _,S as p}from"./index-DPr5u6nH.js";import{B as v}from"./badge-EgvwRMXF.js";import{S as D,a as $,b as F,c as Q}from"./sheet-9bKNCI3a.js";import{S as H}from"./SwimSessionTimeline-DEyhRDzD.js";import{a as y}from"./api-CFuaNslW.js";import{C as K}from"./circle-alert-AYQFgFc5.js";import{C as U}from"./chevron-left-BFYZ6m-n.js";import{f as V}from"./format-B9mPVj_w.js";import{f as G}from"./fr-CFyqyHeU.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-6k692oZB.js";import"./index-NXNp0fzN.js";import"./index-CIe4j-wy.js";import"./index-DFYKZZ72.js";import"./eye-vFB89TqR.js";import"./chevron-down-dKzR1nNt.js";import"./clock-h6lnaitq.js";var J=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],W=J.reduce((r,a)=>{const l=O(`Primitive.${a}`),i=m.forwardRef((s,o)=>{const{asChild:c,...d}=s,u=c?l:a;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(u,{...d,ref:o})});return i.displayName=`Primitive.${a}`,{...r,[a]:i}},{}),X="Separator",b="horizontal",Y=["horizontal","vertical"],w=m.forwardRef((r,a)=>{const{decorative:l,orientation:i=b,...s}=r,o=Z(i)?i:b,d=l?{role:"none"}:{"aria-orientation":o==="vertical"?o:void 0,role:"separator"};return e.jsx(W.div,{"data-orientation":o,...d,...s,ref:a})});w.displayName=X;function Z(r){return Y.includes(r)}var S=w;const C=m.forwardRef(({className:r,orientation:a="horizontal",decorative:l=!0,...i},s)=>e.jsx(S,{ref:s,decorative:l,orientation:a,className:P("shrink-0 bg-border",a==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",r),...i}));C.displayName=S.displayName;const ee={assigned:"Assignée",pending:"Assignée",in_progress:"En cours",completed:"Terminée",cancelled:"Annulée"},se=r=>{if(!r)return"-";const a=new Date(r);return Number.isNaN(a.getTime())?r:V(a,"dd MMM",{locale:G})};function ve(){const{user:r,userId:a}=B(),[l,i]=M(),[s,o]=m.useState(null),{toast:c}=q(),d=R(),u=m.useMemo(()=>{const[,t]=l.split("?");if(!t)return null;const N=new URLSearchParams(t).get("assignmentId"),j=N?Number(N):NaN;return Number.isFinite(j)?j:null},[l]),{data:k,isLoading:A,error:f,refetch:T}=I({queryKey:["assignments",r],queryFn:()=>y.getAssignments(r,a),enabled:!!r}),h=k?.filter(t=>t.session_type==="swim")||[],n=u?h.find(t=>t.id===u):h[0],E=L({mutationFn:t=>y.assignments_delete(t),onSuccess:()=>{d.invalidateQueries({queryKey:["assignments"]}),c({title:"Séance retirée",description:"La séance a été retirée de votre feed."}),i("/")},onError:()=>{c({title:"Erreur",description:"Impossible de retirer la séance.",variant:"destructive"})}});return f?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[e.jsx(K,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h3",{className:"font-semibold",children:"Impossible de charger les données"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:f.message}),e.jsx(x,{onClick:()=>T(),className:"mt-4",children:"Réessayer"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>i("/"),"aria-label":"Retour à l'accueil",children:e.jsx(U,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-[0.2em] text-muted-foreground",children:"Séance natation"}),e.jsx("h1",{className:"text-2xl font-display font-bold uppercase",children:"Lecture"})]})]}),n?e.jsx(v,{variant:"secondary",className:"text-xs",children:ee[n.status]??"Assignée"}):null]}),e.jsx(z,{className:"border border-border shadow-sm",children:e.jsxs(_,{className:"space-y-4 p-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-lg font-semibold tracking-tight",children:n?.title??"Séance natation"}),n?.description?e.jsx("p",{className:"text-sm text-muted-foreground",children:n.description}):null]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx(v,{variant:"outline",className:"text-xs",children:se(n?.assigned_date)}),n?e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>{window.confirm("Retirer cette séance de votre feed ?")&&E.mutate(n.id)},className:"text-xs text-muted-foreground hover:text-foreground",children:"Retirer de mon feed"}):null]}),e.jsx(C,{}),A?e.jsxs("div",{className:"space-y-4","aria-live":"polite","aria-busy":"true",children:[e.jsx("div",{className:"sr-only",children:"Chargement de la séance..."}),e.jsx(p,{className:"h-6 w-48"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((t,g)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"h-5 w-32"}),e.jsx(p,{className:"h-4 w-full"}),e.jsx(p,{className:"h-4 w-3/4"})]},`skeleton-${g}`))})]}):n?e.jsx(H,{title:n.title,description:n.description,items:n.items,showHeader:!0,onExerciseSelect:t=>{o(t)}}):e.jsx("div",{className:"rounded-2xl border border-dashed border-muted/70 bg-muted/30 p-6 text-sm text-muted-foreground",children:"Aucune séance de natation assignée pour le moment."})]})}),e.jsx(D,{open:!!s,onOpenChange:t=>{t||o(null)},children:e.jsxs($,{side:"bottom",className:"max-h-[80vh] overflow-y-auto",children:[e.jsx(F,{children:e.jsx(Q,{children:"Détails de l'exercice"})}),s?e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-muted-foreground",children:s.blockTitle&&s.blockIndex!==void 0?`Bloc ${s.blockIndex+1}`:"Bloc"}),e.jsx("p",{className:"text-lg font-semibold",children:s.label})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:[s.repetitions?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:[s.repetitions,"x"]}):null,s.distance?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:[s.distance,"m"]}):null,s.rest?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:["Récup ",s.rest,"s"]}):null,s.stroke?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:["Nage : ",s.stroke]}):null,s.strokeType?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:["Type : ",s.strokeType]}):null,s.intensity?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-muted/40 px-2 py-1",children:["Intensité : ",s.intensity]}):null]}),s.modalities?e.jsx("div",{className:"rounded-2xl border bg-muted/10 p-3 text-sm text-muted-foreground",children:s.modalities}):null,s.equipment?.length?e.jsx("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:s.equipment.map(t=>e.jsx("span",{className:"rounded-full border px-2 py-1",children:t},t))}):null]}):null]})})]})}export{ve as default};
