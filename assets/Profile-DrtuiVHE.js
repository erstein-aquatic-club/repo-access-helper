import{l as H,r as l,j as e,az as ce,aA as de,aB as le,n as I,w as R,u as ue,M as me,N as pe,a as B,Q as A,C as _,g as F,B as N,i as P,Z as x,S as fe,b as he,d as xe,e as ve,f as ge,_ as w,aq as je,h as E,a0 as M,L as Ne,k as y}from"./index-DqxBy9a5.js";import{T as be}from"./textarea-DAeIa66o.js";import{P as Se,S as we}from"./save-BRIS4vk0.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Ce=H("log-out",ye);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Fe=H("refresh-cw",_e);function Pe(s,a=[]){let n=[];function o(r,c){const d=l.createContext(c);d.displayName=r+"Context";const m=n.length;n=[...n,c];const f=h=>{const{scope:b,children:S,...j}=h,p=b?.[s]?.[m]||d,g=l.useMemo(()=>j,Object.values(j));return e.jsx(p.Provider,{value:g,children:S})};f.displayName=r+"Provider";function v(h,b){const S=b?.[s]?.[m]||d,j=l.useContext(S);if(j)return j;if(c!==void 0)return c;throw new Error(`\`${h}\` must be used within \`${r}\``)}return[f,v]}const i=()=>{const r=n.map(c=>l.createContext(c));return function(d){const m=d?.[s]||r;return l.useMemo(()=>({[`__scope${s}`]:{...d,[s]:m}}),[d,m])}};return i.scopeName=s,[o,Le(i,...a)]}function Le(...s){const a=s[0];if(s.length===1)return a;const n=()=>{const o=s.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(r){const c=o.reduce((d,{useScope:m,scopeName:f})=>{const h=m(r)[`__scope${f}`];return{...d,...h}},{});return l.useMemo(()=>({[`__scope${a.scopeName}`]:c}),[c])}};return n.scopeName=a.scopeName,n}var Ae=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],k=Ae.reduce((s,a)=>{const n=ce(`Primitive.${a}`),o=l.forwardRef((i,r)=>{const{asChild:c,...d}=i,m=c?n:a;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(m,{...d,ref:r})});return o.displayName=`Primitive.${a}`,{...s,[a]:o}},{});function Ee(){return de.useSyncExternalStore(Me,()=>!0,()=>!1)}function Me(){return()=>{}}var $="Avatar",[Ie]=Pe($),[Re,D]=Ie($),O=l.forwardRef((s,a)=>{const{__scopeAvatar:n,...o}=s,[i,r]=l.useState("idle");return e.jsx(Re,{scope:n,imageLoadingStatus:i,onImageLoadingStatusChange:r,children:e.jsx(k.span,{...o,ref:a})})});O.displayName=$;var K="AvatarImage",Q=l.forwardRef((s,a)=>{const{__scopeAvatar:n,src:o,onLoadingStatusChange:i=()=>{},...r}=s,c=D(K,n),d=ke(o,r),m=le(f=>{i(f),c.onImageLoadingStatusChange(f)});return I(()=>{d!=="idle"&&m(d)},[d,m]),d==="loaded"?e.jsx(k.img,{...r,ref:a,src:o}):null});Q.displayName=K;var V="AvatarFallback",G=l.forwardRef((s,a)=>{const{__scopeAvatar:n,delayMs:o,...i}=s,r=D(V,n),[c,d]=l.useState(o===void 0);return l.useEffect(()=>{if(o!==void 0){const m=window.setTimeout(()=>d(!0),o);return()=>window.clearTimeout(m)}},[o]),c&&r.imageLoadingStatus!=="loaded"?e.jsx(k.span,{...i,ref:a}):null});G.displayName=V;function z(s,a){return s?a?(s.src!==a&&(s.src=a),s.complete&&s.naturalWidth>0?"loaded":"loading"):"error":"idle"}function ke(s,{referrerPolicy:a,crossOrigin:n}){const o=Ee(),i=l.useRef(null),r=o?(i.current||(i.current=new window.Image),i.current):null,[c,d]=l.useState(()=>z(r,s));return I(()=>{d(z(r,s))},[r,s]),I(()=>{const m=h=>()=>{d(h)};if(!r)return;const f=m("loaded"),v=m("error");return r.addEventListener("load",f),r.addEventListener("error",v),a&&(r.referrerPolicy=a),typeof n=="string"&&(r.crossOrigin=n),()=>{r.removeEventListener("load",f),r.removeEventListener("error",v)}},[r,n,a]),c}var W=O,Z=Q,J=G;const X=l.forwardRef(({className:s,...a},n)=>e.jsx(W,{ref:n,className:R("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...a}));X.displayName=W.displayName;const Y=l.forwardRef(({className:s,...a},n)=>e.jsx(Z,{ref:n,className:R("aspect-square h-full w-full",s),...a}));Y.displayName=Z.displayName;const ee=l.forwardRef(({className:s,...a},n)=>e.jsx(J,{ref:n,className:R("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...a}));ee.displayName=J.displayName;const se=s=>s!=="coach"&&s!=="admin"&&s!=="comite",te=s=>{switch(s){case"coach":return"Entraineur EAC";case"admin":return"Admin";case"comite":return"Comité";default:return"Nageur"}};function $e(s){if(!s)return"-";const a=new Date(s);return Number.isNaN(a.getTime())?s:a.toLocaleDateString("fr-FR")}function qe(){const{user:s,userId:a,logout:n,role:o}=ue(),{toast:i}=me(),r=pe(),c=se(o),d=o==="athlete"||o==="coach"||o==="admin",m=te(o),[f,v]=l.useState(!1),[h,b]=l.useState(""),[S,j]=l.useState(""),[p,g]=l.useState({group_id:"",objectives:"",bio:"",avatar_url:"",birthdate:"",ffn_iuf:""}),{data:u}=B({queryKey:["profile",s,a],queryFn:()=>y.getProfile({displayName:s,userId:a}),enabled:!!s}),{data:q=[],isLoading:T}=B({queryKey:["profile-groups"],queryFn:()=>y.getGroups(),enabled:!!s}),ae=l.useMemo(()=>{const t=u?.avatar_url;return t||(s?`https://api.dicebear.com/7.x/initials/svg?seed=${encodeURIComponent(s)}`:"")},[u,s]),L=A({mutationFn:t=>y.updateProfile({userId:a,profile:{group_id:t.group_id?Number(t.group_id):null,birthdate:t.birthdate||null,objectives:t.objectives,bio:t.bio,avatar_url:t.avatar_url,ffn_iuf:(t.ffn_iuf||"").trim()||null}}),onSuccess:()=>{r.invalidateQueries({queryKey:["profile"]}),v(!1),i({title:"Profil mis à jour"})},onError:t=>{i({title:"Mise à jour impossible",description:String(t?.message||t),variant:"destructive"})}}),U=A({mutationFn:t=>y.authPasswordUpdate(t),onSuccess:()=>{b(""),j(""),i({title:"Mot de passe mis à jour"})},onError:t=>{i({title:"Mise à jour impossible",description:String(t?.message||t),variant:"destructive"})}}),C=A({mutationFn:async()=>{const t=String(u?.ffn_iuf??"").trim();if(!t)throw new Error("IUF FFN manquant. Ajoutez-le dans votre profil.");return y.syncFfnSwimRecords({athleteId:a??void 0,athleteName:s??void 0,iuf:t})},onSuccess:t=>{r.invalidateQueries({queryKey:["swim-records"]}),i({title:"Records FFN importés",description:`${t?.inserted??0} ajouté(s), ${t?.updated??0} mis à jour, ${t?.skipped??0} inchangé(s)`})},onError:t=>{i({title:"Import FFN impossible",description:String(t?.message||t),variant:"destructive"})}}),re=()=>{g({group_id:u?.group_id?String(u.group_id):"",objectives:u?.objectives||"",bio:u?.bio||"",avatar_url:u?.avatar_url||"",birthdate:u?.birthdate?String(u.birthdate).split("T")[0]:"",ffn_iuf:u?.ffn_iuf?String(u.ffn_iuf):""}),v(!0)},ne=()=>L.mutate(p),ie=()=>{if(!h||h.length<6){i({title:"Mot de passe invalide",description:"Minimum 6 caractères.",variant:"destructive"});return}if(h!==S){i({title:"Mot de passe invalide",description:"Les mots de passe ne correspondent pas.",variant:"destructive"});return}U.mutate({password:h})},oe=q.find(t=>t.id===u?.group_id)?.name||u?.group_label||"Non défini";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Profil"}),e.jsxs(_,{children:[e.jsxs(F,{className:"relative",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(X,{className:"h-16 w-16",children:[e.jsx(Y,{src:ae,alt:s||"Profil"}),e.jsx(ee,{children:(s||"?").slice(0,2).toUpperCase()})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xl font-semibold truncate",children:s}),e.jsx("p",{className:"text-sm text-muted-foreground uppercase font-bold tracking-wider",children:m})]})]}),!f&&e.jsx(N,{variant:"ghost",size:"icon",className:"absolute top-4 right-4",onClick:re,"aria-label":"Modifier le profil",children:e.jsx(Se,{className:"h-4 w-4"})})]}),e.jsx(P,{className:"space-y-4",children:f?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"Groupe"}),e.jsxs(fe,{value:p.group_id,onValueChange:t=>g({...p,group_id:t}),disabled:T,children:[e.jsx(he,{children:e.jsx(xe,{placeholder:T?"Chargement...":"Choisir un groupe"})}),e.jsx(ve,{children:q.map(t=>e.jsx(ge,{value:String(t.id),children:t.name},t.id))})]})]}),c?e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"IUF FFN"}),e.jsx(w,{value:p.ffn_iuf,onChange:t=>g({...p,ffn_iuf:t.target.value}),placeholder:"879576",inputMode:"numeric"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Identifiant unique FFN (utilisé pour importer vos records compétition)."})]}):null,e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"Objectifs"}),e.jsx(w,{value:p.objectives,onChange:t=>g({...p,objectives:t.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"Bio"}),e.jsx(be,{value:p.bio,onChange:t=>g({...p,bio:t.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"Avatar (URL)"}),e.jsx(w,{value:p.avatar_url,onChange:t=>g({...p,avatar_url:t.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"Date de naissance"}),e.jsx(w,{type:"date",value:p.birthdate,onChange:t=>g({...p,birthdate:t.target.value})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{onClick:ne,disabled:L.isPending,className:"w-full",children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Enregistrer"]}),e.jsx(N,{variant:"outline",onClick:()=>v(!1),disabled:L.isPending,children:"Annuler"})]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx(x,{className:"text-xs text-muted-foreground uppercase",children:"Groupe"}),e.jsx("div",{className:"font-medium",children:oe})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-xs text-muted-foreground uppercase",children:"Date de naissance"}),e.jsx("div",{className:"font-medium",children:$e(u?.birthdate??null)})]}),c?e.jsxs("div",{children:[e.jsx(x,{className:"text-xs text-muted-foreground uppercase",children:"IUF FFN"}),e.jsx("div",{className:"font-medium",children:String(u?.ffn_iuf??"")||"Non renseigné"})]}):null,e.jsxs("div",{className:c?"":"col-span-2",children:[e.jsx(x,{className:"text-xs text-muted-foreground uppercase",children:"Objectifs"}),e.jsx("div",{className:"font-medium",children:u?.objectives||"Aucun objectif défini."})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(x,{className:"text-xs text-muted-foreground uppercase",children:"Bio"}),e.jsx("div",{className:"font-medium",children:u?.bio||"Non renseignée."})]})]})}),e.jsx(je,{className:"flex justify-end",children:e.jsxs(N,{variant:"outline",onClick:n,className:"gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),"Se déconnecter"]})})]}),c?e.jsxs(_,{children:[e.jsxs(F,{children:[e.jsx(E,{children:"FFN"}),e.jsx(M,{children:"Importer vos records compétition depuis Extranat."})]}),e.jsxs(P,{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["IUF enregistré : ",e.jsx("span",{className:"font-medium text-foreground",children:String(u?.ffn_iuf??"")||"—"})]}),e.jsxs(N,{className:"w-full gap-2",onClick:()=>C.mutate(),disabled:C.isPending||!String(u?.ffn_iuf??"").trim(),children:[e.jsx(Fe,{className:["h-4 w-4",C.isPending?"animate-spin":""].join(" ")}),C.isPending?"Import en cours...":"Récupérer records depuis FFN"]}),String(u?.ffn_iuf??"").trim()?null:e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ajoutez votre IUF FFN dans le profil (bouton crayon) pour activer l’import."})]})]}):null,d?e.jsxs(_,{children:[e.jsxs(F,{children:[e.jsx(E,{children:"Mot de passe"}),e.jsx(M,{children:"Modifiez votre mot de passe."})]}),e.jsxs(P,{className:"space-y-3",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"Nouveau mot de passe"}),e.jsx(w,{type:"password",value:h,onChange:t=>b(t.target.value),placeholder:"••••••••"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{children:"Confirmer"}),e.jsx(w,{type:"password",value:S,onChange:t=>j(t.target.value),placeholder:"••••••••"})]}),e.jsx(N,{className:"w-full",onClick:ie,disabled:U.isPending,children:"Mettre à jour le mot de passe"})]})]}):null,c?e.jsxs(_,{children:[e.jsxs(F,{children:[e.jsx(E,{children:"Records"}),e.jsx(M,{children:"Consultez vos records de natation et musculation."})]}),e.jsx(P,{children:e.jsx(Ne,{href:"/records",children:e.jsx(N,{asChild:!0,children:e.jsx("a",{children:"Voir mes records"})})})})]}):null]})}const ze=Object.freeze(Object.defineProperty({__proto__:null,default:qe,getRoleLabel:te,shouldShowRecords:se},Symbol.toStringTag,{value:"Module"}));export{ze as P,Fe as R,se as s};
