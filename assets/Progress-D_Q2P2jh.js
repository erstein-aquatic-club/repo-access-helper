import{r as R,j as e}from"./vendor-ui-CMUPCwTD.js";import{u as ae,d as Ie}from"./vendor-query-WtxIVPOV.js";import{u as ze,b as Q}from"./index-BDGnhHrZ.js";import{C as l,a as o,b as i,d}from"./card-BVRwMXiB.js";import{T as We,a as $e,b as ne,c as L,d as Oe,e as S}from"./table-Bu1b63OG.js";import{T as Qe,a as Ge,b as fe,c as pe}from"./tabs-eC7QLSed.js";import{S as je,a as Ne,b as ye,c as ve,d as T}from"./select-Ci-_VFAs.js";import{s as G}from"./score-CwBbkHfb.js";import{B as Xe}from"./button-BuXE02p3.js";import{B as Se}from"./badge-BPZGxebf.js";import{s as Ye,a as re,e as Je,f as V}from"./vendor-date-cQbdWov0.js";import{R as F,B as le,C as K,X as E,T as H,a as q,Y as be,b as Ue,d as Ze,L as oe,e as et}from"./vendor-charts-BHfjz9SJ.js";import"./vendor-react-BzrpNAyj.js";import"./vendor-supabase-CrvtPqJM.js";import"./check-CsaGej-t.js";import"./index-Bm0RG47H.js";const Ce="rounded-full px-3 py-1 text-sm font-mono font-bold",we=v=>{const C=v.match(/hsl\((\d+(?:\.\d+)?)\s+(\d+(?:\.\d+)?)%\s+(\d+(?:\.\d+)?)%\)/);if(!C)return"#000";const[,w,k,D]=C,n=Number(w),c=Number(k)/100,j=Number(D)/100,u=(1-Math.abs(2*j-1))*c,g=u*(1-Math.abs(n/60%2-1)),I=j-u/2;let N=0,M=0,y=0;n>=0&&n<60?(N=u,M=g):n>=60&&n<120?(N=g,M=u):n>=120&&n<180?(M=u,y=g):n>=180&&n<240?(M=g,y=u):n>=240&&n<300?(N=g,y=u):(N=u,y=g);const ie=Math.round((N+I)*255),b=Math.round((M+I)*255),X=Math.round((y+I)*255);return .2126*ie+.7152*b+.0722*X>155?"#000":"#fff"};function tt({avgRpe:v,avgPerformance:C,avgEngagement:w,avgFatigue:k}){const D=[{key:"rpe",title:"Difficulté Moy",value:v,invert:!0},{key:"performance",title:"Performance Moy",value:C,invert:!1},{key:"engagement",title:"Engagement Moy",value:w,invert:!1},{key:"fatigue",title:"Fatigue Moy",value:k,invert:!0}];return e.jsx("div",{className:"grid grid-cols-2 gap-3 md:grid-cols-4",children:D.map(n=>{const c=G(n.value??null,{invert:n.invert})??"hsl(var(--muted-foreground))";return e.jsxs(l,{children:[e.jsx(o,{className:"p-4 pb-2",children:e.jsx(i,{className:"text-xs uppercase text-muted-foreground",children:n.title})}),e.jsx(d,{className:"p-4 pt-0",children:e.jsx(Se,{className:Ce,style:{backgroundColor:c,color:we(c)},children:n.value?n.value.toFixed(1):"-"})})]},n.key)})})}function B(){return e.jsxs("div",{className:"space-y-4 animate-pulse motion-reduce:animate-none",children:[e.jsx("div",{className:"h-6 w-48 rounded-lg bg-muted"}),e.jsx("div",{className:"h-[200px] w-full rounded-xl bg-muted"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3].map(v=>e.jsx("div",{className:"h-4 w-16 rounded bg-muted"},v))})]})}function jt(){const{user:v,userId:C,role:w,selectedAthleteId:k,selectedAthleteName:D}=ze(),n=(w==="coach"||w==="admin")&&(k!==null||!!D),c=n?D:v,j=n?k:C,u=j??c,[g,I]=R.useState("all"),[N,M]=R.useState(""),[y,ie]=R.useState(""),[b,X]=R.useState(30),[f,ke]=R.useState(30),{data:z,isLoading:de}=ae({queryKey:["sessions",u],queryFn:()=>Q.getSessions(c,j),enabled:!!c}),A=Ie({queryKey:["strength_history",u,"progress",g,N,y],queryFn:({pageParam:t=0})=>Q.getStrengthHistory(c,{athleteId:j,limit:10,offset:t,order:"desc",status:g==="all"?void 0:g,from:N||void 0,to:y||void 0}),enabled:!!c,getNextPageParam:t=>{const s=t.pagination.offset+t.pagination.limit;return s<t.pagination.total?s:void 0},initialPageParam:0}),ce=A.data?.pages.flatMap(t=>t.runs)??[],W=Ye(re(new Date,f)).toISOString(),$=Je(new Date).toISOString(),{data:ue,isLoading:De}=ae({queryKey:["strength_history_summary",u,"progress",f,W,$],queryFn:()=>Q.getStrengthHistory(c,{athleteId:j,limit:200,order:"desc",from:W,to:$}),enabled:!!c}),{data:Me,isLoading:Le}=ae({queryKey:["strength_history_aggregate",u,"progress",f,W,$],queryFn:()=>Q.getStrengthHistoryAggregate(c,{athleteId:j,period:"day",limit:200,order:"asc",from:W,to:$}),enabled:!!c}),Y=De||Le,J=ue?.runs??[],Te=ue?.exercise_summary??[],U=Me?.periods??[],Ae=t=>{if(!z)return[];const s=re(new Date,t),p=z.filter(a=>new Date(a.date)>=s).reverse(),h=new Map;return p.forEach(a=>{const m=V(new Date(a.date),"dd/MM");h.has(m)||h.set(m,{date:m,distance:0,effort:0,rpe:0,performance:0,engagement:0,fatigue:0,count:0,rpeCount:0,performanceCount:0,engagementCount:0,fatigueCount:0});const x=h.get(m);x.distance+=a.distance,x.effort+=a.effort,x.count+=1,a.rpe!==null&&a.rpe!==void 0&&(x.rpe+=a.rpe,x.rpeCount+=1),a.performance!==null&&a.performance!==void 0&&(x.performance+=a.performance,x.performanceCount+=1),a.engagement!==null&&a.engagement!==void 0&&(x.engagement+=a.engagement,x.engagementCount+=1),a.fatigue!==null&&a.fatigue!==void 0&&(x.fatigue+=a.fatigue,x.fatigueCount+=1)}),Array.from(h.values()).map(a=>({...a,effort:Math.round(a.effort/a.count*10)/10,rpe:a.rpeCount?Math.round(a.rpe/a.rpeCount*10)/10:null,performance:a.performanceCount?Math.round(a.performance/a.performanceCount*10)/10:null,engagement:a.engagementCount?Math.round(a.engagement/a.engagementCount*10)/10:null,fatigue:a.fatigueCount?Math.round(a.fatigue/a.fatigueCount*10)/10:null}))},me=z?z.filter(t=>new Date(t.date)>=re(new Date,b)):[],P=me.length,r=me.reduce((t,s)=>(t.distance+=s.distance,t.duration+=s.duration,s.rpe!==null&&s.rpe!==void 0&&(t.rpeSum+=s.rpe,t.rpeCount+=1),s.performance!==null&&s.performance!==void 0&&(t.performanceSum+=s.performance,t.performanceCount+=1),s.engagement!==null&&s.engagement!==void 0&&(t.engagementSum+=s.engagement,t.engagementCount+=1),s.fatigue!==null&&s.fatigue!==void 0&&(t.fatigueSum+=s.fatigue,t.fatigueCount+=1),t),{distance:0,duration:0,rpeSum:0,rpeCount:0,performanceSum:0,performanceCount:0,engagementSum:0,engagementCount:0,fatigueSum:0,fatigueCount:0}),Pe=r.rpeCount?r.rpeSum/r.rpeCount:null,_e=r.performanceCount?r.performanceSum/r.performanceCount:null,Re=r.engagementCount?r.engagementSum/r.engagementCount:null,Ve=r.fatigueCount?r.fatigueSum/r.fatigueCount:null;P&&r.duration/P;const Fe=P?r.distance/P:0,_=Ae(b),Z=t=>t==="rpe"||t==="effort"||t==="fatigue",ee=t=>{const p=(Array.isArray(t?.logs)?t.logs:[]).map(m=>m?.rpe!==null&&m?.rpe!==void 0?Number(m.rpe):null).filter(m=>m!==null&&Number.isFinite(m));if(p.length>0)return p.reduce((m,x)=>m+x,0)/p.length;const h=t?.feeling??t?.rpe??null,a=h!=null?Number(h):null;return a!==null&&Number.isFinite(a)?a:null},Ke=t=>t==null||Number.isNaN(t)?"-":t.toFixed(1),xe=[...J].sort((t,s)=>{const p=new Date(t.started_at||t.date||t.created_at||0).getTime(),h=new Date(s.started_at||s.date||s.created_at||0).getTime();return p-h}).map(t=>({date:V(new Date(t.started_at||t.date||t.created_at||new Date),"dd/MM"),feeling:ee(t)})),ge=U.map(t=>({date:t.period,label:V(new Date(t.period),"dd/MM"),tonnage:Math.round(t.tonnage??0),volume:Math.round(t.volume??0)})),Ee=U.reduce((t,s)=>t+(s.tonnage??0),0),He=U.reduce((t,s)=>t+(s.volume??0),0),qe=J.length,te=J.map(t=>ee(t)).filter(t=>t!==null&&Number.isFinite(t)),O=te.length?te.reduce((t,s)=>t+s,0)/te.length:null,se=[...Te].map(t=>({exerciseId:Number(t.exercise_id),name:t.exercise_name||`Exercice ${t.exercise_id}`,totalSets:Number(t.total_sets??0),totalReps:Number(t.total_reps??0),totalVolume:Number(t.total_volume??0),maxWeight:t.max_weight!==null&&t.max_weight!==void 0?Number(t.max_weight):null,lastPerformedAt:t.last_performed_at??null})).sort((t,s)=>s.totalVolume-t.totalVolume),he=se.slice(0,8),Be=t=>{if(!t)return"-";const s=new Date(t);return Number.isNaN(s.getTime())?"-":V(s,"dd/MM/yyyy")};return e.jsxs("div",{className:"space-y-6 pb-8",children:[e.jsx("h1",{className:"text-3xl font-display font-bold uppercase italic text-primary",children:"Progression"}),e.jsxs(Qe,{defaultValue:"swim",className:"w-full",children:[e.jsxs(Ge,{className:"grid w-full grid-cols-2",children:[e.jsx(fe,{value:"swim",children:"Natation"}),e.jsx(fe,{value:"strength",children:"Musculation"})]}),e.jsxs(pe,{value:"swim",className:"space-y-6 animate-in fade-in motion-reduce:animate-none",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[e.jsx("span",{className:"text-xs uppercase text-muted-foreground",children:"Période"}),e.jsxs(je,{value:String(b),onValueChange:t=>X(Number(t)),children:[e.jsx(Ne,{className:"h-8 w-[140px]",children:e.jsx(ye,{})}),e.jsxs(ve,{children:[e.jsx(T,{value:"7",children:"7 jours"}),e.jsx(T,{value:"30",children:"30 jours"}),e.jsx(T,{value:"365",children:"365 jours"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-3",children:[e.jsxs(l,{children:[e.jsx(o,{className:"p-4 pb-2",children:e.jsxs(i,{className:"text-xs uppercase text-muted-foreground",children:["Volume (",b,"j)"]})}),e.jsxs(d,{className:"p-4 pt-0 text-2xl font-bold font-mono",children:[r.distance.toLocaleString(),"m"]})]}),e.jsxs(l,{children:[e.jsx(o,{className:"p-4 pb-2",children:e.jsxs(i,{className:"text-xs uppercase text-muted-foreground",children:["Séances (",b,"j)"]})}),e.jsx(d,{className:"p-4 pt-0 text-2xl font-bold font-mono",children:P})]}),e.jsxs(l,{children:[e.jsx(o,{className:"p-4 pb-2",children:e.jsx(i,{className:"text-xs uppercase text-muted-foreground",children:"Distance Moy"})}),e.jsxs(d,{className:"p-4 pt-0 text-2xl font-bold font-mono",children:[Math.round(Fe).toLocaleString(),"m"]})]})]}),e.jsx(tt,{avgRpe:Pe,avgPerformance:_e,avgEngagement:Re,avgFatigue:Ve}),e.jsxs(l,{children:[e.jsx(o,{children:e.jsx(i,{children:"Volume Quotidien"})}),e.jsx(d,{className:"h-[250px] w-full",children:de?e.jsx(B,{}):_.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground",children:"Aucune donnée disponible."}):e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(le,{data:_,children:[e.jsx(K,{strokeDasharray:"3 3",opacity:.1,vertical:!1}),e.jsx(E,{dataKey:"date",fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(H,{cursor:{fill:"transparent"}}),e.jsx(q,{dataKey:"distance",fill:"hsl(var(--primary))",radius:[4,4,0,0]})]})})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[{key:"rpe",title:"RPE"},{key:"performance",title:"Performance"},{key:"engagement",title:"Engagement"},{key:"fatigue",title:"Fatigue"}].map(t=>e.jsxs(l,{children:[e.jsx(o,{children:e.jsx(i,{children:t.title})}),e.jsx(d,{className:"h-[240px] w-full",children:de?e.jsx(B,{}):_.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground",children:"Aucune donnée disponible."}):e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(le,{data:_,children:[e.jsx(K,{strokeDasharray:"3 3",opacity:.1,vertical:!1}),e.jsx(E,{dataKey:"date",fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(be,{domain:[0,5],tickLine:!1,axisLine:!1,fontSize:10}),e.jsx(H,{cursor:{fill:"transparent"},formatter:s=>[s??"-",t.title]}),e.jsx(q,{dataKey:t.key,radius:[4,4,0,0],children:_.map((s,p)=>e.jsx(Ue,{fill:G(s[t.key],{invert:Z(t.key)})},`${t.key}-${s.date}-${p}`))})]})})})]},t.key))})]}),e.jsxs(pe,{value:"strength",className:"space-y-6 animate-in fade-in motion-reduce:animate-none",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[e.jsx("span",{className:"text-xs uppercase text-muted-foreground",children:"Période"}),e.jsxs(je,{value:String(f),onValueChange:t=>ke(Number(t)),children:[e.jsx(Ne,{className:"h-8 w-[140px]",children:e.jsx(ye,{})}),e.jsxs(ve,{children:[e.jsx(T,{value:"7",children:"7 jours"}),e.jsx(T,{value:"30",children:"30 jours"}),e.jsx(T,{value:"365",children:"365 jours"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:[e.jsxs(l,{children:[e.jsx(o,{className:"p-4 pb-2",children:e.jsxs(i,{className:"text-xs uppercase text-muted-foreground",children:["Tonnage (",f,"j)"]})}),e.jsxs(d,{className:"p-4 pt-0 text-2xl font-bold font-mono",children:[Math.round(Ee).toLocaleString()," kg"]})]}),e.jsxs(l,{children:[e.jsx(o,{className:"p-4 pb-2",children:e.jsxs(i,{className:"text-xs uppercase text-muted-foreground",children:["Volume (",f,"j)"]})}),e.jsxs(d,{className:"p-4 pt-0 text-2xl font-bold font-mono",children:[Math.round(He).toLocaleString()," reps"]})]}),e.jsxs(l,{children:[e.jsx(o,{className:"p-4 pb-2",children:e.jsxs(i,{className:"text-xs uppercase text-muted-foreground",children:["Séances (",f,"j)"]})}),e.jsx(d,{className:"p-4 pt-0 text-2xl font-bold font-mono",children:qe})]}),e.jsxs(l,{children:[e.jsx(o,{className:"p-4 pb-2",children:e.jsx(i,{className:"text-xs uppercase text-muted-foreground",children:"Ressenti Moy"})}),e.jsx(d,{className:"p-4 pt-0",children:e.jsx(Se,{className:Ce,style:{backgroundColor:G(O??null,{invert:Z("rpe")})??"hsl(var(--muted-foreground))",color:we(G(O??null,{invert:Z("rpe")})??"hsl(var(--muted-foreground))")},children:O!==null?O.toFixed(1):"-"})})]})]}),e.jsxs(l,{children:[e.jsx(o,{children:e.jsxs(i,{children:["Tonnage & Volume (",f,"j)"]})}),e.jsx(d,{className:"h-[250px] w-full",children:Y?e.jsx(B,{}):ge.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground",children:"Aucune donnée disponible."}):e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(Ze,{data:ge,children:[e.jsx(K,{strokeDasharray:"3 3",opacity:.1,vertical:!1}),e.jsx(E,{dataKey:"label",fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(H,{}),e.jsx(q,{dataKey:"tonnage",name:"Tonnage",fill:"hsl(var(--primary))",radius:[4,4,0,0]}),e.jsx(q,{dataKey:"volume",name:"Volume",fill:"hsl(var(--accent))",radius:[4,4,0,0]}),e.jsx(oe,{type:"monotone",dataKey:"tonnage",stroke:"hsl(var(--primary))",strokeWidth:2,dot:!1}),e.jsx(oe,{type:"monotone",dataKey:"volume",stroke:"hsl(var(--accent))",strokeWidth:2,dot:!1})]})})})]}),e.jsxs(l,{children:[e.jsx(o,{children:e.jsx(i,{children:"Ressenti Séances"})}),e.jsx(d,{className:"h-[250px] w-full",children:Y?e.jsx(B,{}):xe.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground",children:"Aucune donnée disponible."}):e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(et,{data:xe,children:[e.jsx(K,{strokeDasharray:"3 3",opacity:.1,vertical:!1}),e.jsx(E,{dataKey:"date",fontSize:10,tickLine:!1,axisLine:!1}),e.jsx(be,{domain:[0,10],hide:!0}),e.jsx(H,{}),e.jsx(oe,{type:"monotone",dataKey:"feeling",stroke:"hsl(var(--foreground))",strokeWidth:2,dot:{r:4}})]})})})]}),e.jsxs(l,{children:[e.jsx(o,{children:e.jsx(i,{children:"Volume par exercice"})}),e.jsx(d,{className:"h-[260px] w-full",children:Y?e.jsx(B,{}):he.length===0?e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground",children:"Aucune donnée d'exercice disponible."}):e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(le,{data:he,children:[e.jsx(K,{strokeDasharray:"3 3",opacity:.1,vertical:!1}),e.jsx(E,{dataKey:"name",fontSize:10,tickLine:!1,axisLine:!1,interval:0}),e.jsx(H,{cursor:{fill:"transparent"},formatter:t=>[`${Number(t).toLocaleString()} kg`,"Volume"]}),e.jsx(q,{dataKey:"totalVolume",fill:"hsl(var(--primary))",radius:[4,4,0,0]})]})})})]}),e.jsxs(l,{children:[e.jsx(o,{children:e.jsx(i,{children:"Stats par exercice"})}),e.jsx(d,{children:e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs(We,{children:[e.jsx($e,{children:e.jsxs(ne,{children:[e.jsx(L,{children:"Exercice"}),e.jsx(L,{className:"text-right",children:"Séries"}),e.jsx(L,{className:"text-right",children:"Répétitions"}),e.jsx(L,{className:"text-right",children:"Volume"}),e.jsx(L,{className:"text-right",children:"Charge max"}),e.jsx(L,{className:"text-right",children:"Dernière séance"})]})}),e.jsx(Oe,{children:se.length===0?e.jsx(ne,{children:e.jsx(S,{colSpan:6,className:"text-center text-sm text-muted-foreground",children:"Aucun exercice enregistré."})}):se.map(t=>e.jsxs(ne,{children:[e.jsx(S,{className:"font-medium",children:t.name}),e.jsx(S,{className:"text-right font-mono",children:t.totalSets}),e.jsx(S,{className:"text-right font-mono",children:t.totalReps}),e.jsxs(S,{className:"text-right font-mono",children:[t.totalVolume.toLocaleString()," kg"]}),e.jsx(S,{className:"text-right font-mono",children:t.maxWeight!==null?`${t.maxWeight} kg`:"-"}),e.jsx(S,{className:"text-right text-sm text-muted-foreground",children:Be(t.lastPerformedAt)})]},t.exerciseId))})]})})})]}),e.jsxs(l,{children:[e.jsx(o,{children:e.jsx(i,{children:"Historique récent"})}),e.jsxs(d,{className:"space-y-3",children:[ce.length===0&&e.jsx("div",{className:"text-center text-sm text-muted-foreground py-6",children:"Aucun historique disponible."}),ce.map(t=>e.jsxs("div",{className:"flex items-center justify-between border-b border-border/60 pb-2 last:border-b-0 last:pb-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:V(new Date(t.started_at||t.date||t.created_at||new Date),"dd/MM/yyyy")}),e.jsx("div",{className:"text-xs uppercase text-muted-foreground",children:t.status||"Séance"})]}),e.jsxs("div",{className:"text-sm font-mono font-semibold",children:[Ke(ee(t)),"/10"]})]},t.id)),A.hasNextPage&&e.jsx(Xe,{variant:"outline",size:"sm",className:"w-full",onClick:()=>A.fetchNextPage(),disabled:A.isFetchingNextPage,children:A.isFetchingNextPage?"Chargement...":"Charger plus"})]})]})]})]})]})}export{tt as SwimKpiCompactGrid,jt as default};
